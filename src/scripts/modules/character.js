"use strict";
/* a class to provide methods to work with PC & NPC
*/
export class Character {
    static defaultData() {
        return({
        name: '',
        location : "Home",
        inv: [],  //inventory data, needs to be mapped to Inventory-Instance
        wardrobe: [],  //separate wardobe data, needs to be mapped to outfit-Instance
        outfit: [],  // needs to be mapped to outfit-Instance
        stats: [],
        effects: [],
        rel: []
        });
    }
    constructor(externlist) {
        this._data = externlist ? externlist : Character.defaultData();
        this.Outfit = new Outfit(this._data.outfit);
        this.Outfit._parent = (function(me){ return function(){return me;}}(this));
        this.Inv = new Inventory(this._data.inv);
        this.Inv._parent = (function(me){ return function(){return me;}}(this));
        this.Wardrobe = new Inventory(this._data.wardrobe);
        this.Wardrobe._parent = (function(me){ return function(){return me;}}(this));
        this.Stats = new StatsDictionary(this._data.stats);
        this.Stats._parent = (function(me){ return function(){return me;}}(this));
        this.Effects = new Effects(this._data.effects);
        this.Effects._parent = (function(me){ return function(){return me;}}(this));
        this.Rel = new StatsDictionary(this._data.rel); //Todo Relation similiar to stats?
        this.Rel._parent = (function(me){ return function(){return me;}}(this));
        //create basic stats
        stPerversion.setup(this.Stats,1,15),stArousal.setup(this.Stats,1,100);
        stHealth.setup(this.Stats,50,60),stEnergy.setup(this.Stats,30,100),stPAttack.setup(this.Stats,4,100),stPDefense.setup(this.Stats,4,100),
        stAgility.setup(this.Stats,3,100),stStrength.setup(this.Stats,3,100),stEndurance.setup(this.Stats,3,100);

        this.Effects.addItem('Tired',window.gm.EffectLib.NotTired); //depending on sleep Tired will be set to NotTired or Tired
        window.storage.registerConstructor(Character);
    }
    toJSON() {return window.storage.Generic_toJSON("Character", this); };
    static fromJSON(value) { return window.storage.Generic_fromJSON(Character, value.data);};
    get name() {
        return(this._data.name);    
    }
    set name(name) {this._data.name=name;}
    get location() {
        return(this._data.location);    
    }
    set location(name) {this._data.location=name;}
    health() {
        return({value:this.Stats.get('health').value, max:this.Stats.get('healthMax').value, min:0});
    }
    energy() {
        return({value:this.Stats.get('energy').value, max:this.Stats.get('energyMax').value, min:0});
    }

    addEffect(id,effect) {
        this.Effects.addItem(id,effect);   // CanOfCoffee:Energyzed,Energyzed
    }
    /*gainStat(id,val) {
        var _x = this.Stats.get(id);
        var old = _x.value; 
        var _new = Math.max(_x.min,Math.min(_x.max,old+val));
        _x.value = _new;
        if(_new-old>=0) {
            window.gm.pushLog('<statup>'+id+" regenerated by "+(_new-old).toString()+"</statup></br>");
        } else {
            window.gm.pushLog('<statdown>'+id+" decreased by "+(_new-old).toString()+"</statdown></br>");
        }
    }*/

    gainRelation(char,val) {
        this.Rel.addItem(char);
        var _x = this.Rel.get(char);
        var old = _x.value; 
        var _new =old+val; //Math.max(_x.min,Math.min(_x.max,old+val));
        _x.value = _new;
        var diff = _new-old;
        if(diff>0) {
            window.gm.pushLog('<statup>Your relation to '+char+" improved by "+diff.toString()+"</statup></br>");
        } else if (diff<0) {
            window.gm.pushLog('<statdown>Your relation to '+char+" worsend by "+diff.toString()+"</statdown></br>");
        } else {
            window.gm.pushLog('Your relation to '+char+" wasnt affected at all by your behaviour.</br>");
        }
    }
}