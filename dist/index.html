<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta charset="utf-8">
		<title>TwistedTrinkets</title>
		<style>
		/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}details,main,tw-passage{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}a{background-color:transparent;color:#222;text-decoration-color:#ccc}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:ButtonText dotted 1px}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}[hidden],template,tw-storydata{display:none}body{font:1.5em "Helvetica Neue",Helvetica,Arial,sans-serif;color:#222;margin:.5em}tw-story{max-width:35em;margin:0 auto;line-height:150%;display:block}a:hover{color:#cc8929;text-decoration-color:#cc8929}a:active{color:#ffb040;text-decoration-color:#cc8929}@media screen and (max-width:480px){#passage{font-size:70%}}
		</style>
	<script id="script-module-FileSaver" type="text/javascript">(function(a,b){if("function"==typeof define&&define.amd)define([],b);else if("undefined"!=typeof exports)b();else{b(),a.FileSaver={exports:{}}.exports}})(this,function(){"use strict";function b(a,b){return"undefined"==typeof b?b={autoBom:!1}:"object"!=typeof b&&(console.warn("Deprecated: Expected third argument to be a object"),b={autoBom:!b}),b.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob(["\uFEFF",a],{type:a.type}):a}function c(a,b,c){var d=new XMLHttpRequest;d.open("GET",a),d.responseType="blob",d.onload=function(){g(d.response,b,c)},d.onerror=function(){console.error("could not download file")},d.send()}function d(a){var b=new XMLHttpRequest;b.open("HEAD",a,!1);try{b.send()}catch(a){}return 200<=b.status&&299>=b.status}function e(a){try{a.dispatchEvent(new MouseEvent("click"))}catch(c){var b=document.createEvent("MouseEvents");b.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(b)}}var f="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,a=/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),g=f.saveAs||("object"!=typeof window||window!==f?function(){}:"download"in HTMLAnchorElement.prototype&&!a?function(b,g,h){var i=f.URL||f.webkitURL,j=document.createElement("a");g=g||b.name||"download",j.download=g,j.rel="noopener","string"==typeof b?(j.href=b,j.origin===location.origin?e(j):d(j.href)?c(b,g,h):e(j,j.target="_blank")):(j.href=i.createObjectURL(b),setTimeout(function(){i.revokeObjectURL(j.href)},4E4),setTimeout(function(){e(j)},0))}:"msSaveOrOpenBlob"in navigator?function(f,g,h){if(g=g||f.name||"download","string"!=typeof f)navigator.msSaveOrOpenBlob(b(f,h),g);else if(d(f))c(f,g,h);else{var i=document.createElement("a");i.href=f,i.target="_blank",setTimeout(function(){e(i)})}}:function(b,d,e,g){if(g=g||open("","_blank"),g&&(g.document.title=g.document.body.innerText="downloading..."),"string"==typeof b)return c(b,d,e);var h="application/octet-stream"===b.type,i=/constructor/i.test(f.HTMLElement)||f.safari,j=/CriOS\/[\d]+/.test(navigator.userAgent);if((j||h&&i||a)&&"undefined"!=typeof FileReader){var k=new FileReader;k.onloadend=function(){var a=k.result;a=j?a:a.replace(/^data:[^;]*;/,"data:attachment/file;"),g?g.location.href=a:location=a,g=null},k.readAsDataURL(b)}else{var l=f.URL||f.webkitURL,m=l.createObjectURL(b);g?g.location=m:location.href=m,g=null,setTimeout(function(){l.revokeObjectURL(m)},4E4)}});f.saveAs=g.saveAs=g,"undefined"!=typeof module&&(module.exports=g)});

//# sourceMappingURL=FileSaver.min.js.map</script>
<script id="script-module-md5" type="text/javascript">!function(n){"use strict";function d(n,t){var r=(65535&n)+(65535&t);return(n>>16)+(t>>16)+(r>>16)<<16|65535&r}function f(n,t,r,e,o,u){return d((c=d(d(t,n),d(e,u)))<<(f=o)|c>>>32-f,r);var c,f}function l(n,t,r,e,o,u,c){return f(t&r|~t&e,n,t,o,u,c)}function v(n,t,r,e,o,u,c){return f(t&e|r&~e,n,t,o,u,c)}function g(n,t,r,e,o,u,c){return f(t^r^e,n,t,o,u,c)}function m(n,t,r,e,o,u,c){return f(r^(t|~e),n,t,o,u,c)}function i(n,t){var r,e,o,u;n[t>>5]|=128<<t%32,n[14+(t+64>>>9<<4)]=t;for(var c=1732584193,f=-271733879,i=-1732584194,a=271733878,h=0;h<n.length;h+=16)c=l(r=c,e=f,o=i,u=a,n[h],7,-680876936),a=l(a,c,f,i,n[h+1],12,-389564586),i=l(i,a,c,f,n[h+2],17,606105819),f=l(f,i,a,c,n[h+3],22,-1044525330),c=l(c,f,i,a,n[h+4],7,-176418897),a=l(a,c,f,i,n[h+5],12,1200080426),i=l(i,a,c,f,n[h+6],17,-1473231341),f=l(f,i,a,c,n[h+7],22,-45705983),c=l(c,f,i,a,n[h+8],7,1770035416),a=l(a,c,f,i,n[h+9],12,-1958414417),i=l(i,a,c,f,n[h+10],17,-42063),f=l(f,i,a,c,n[h+11],22,-1990404162),c=l(c,f,i,a,n[h+12],7,1804603682),a=l(a,c,f,i,n[h+13],12,-40341101),i=l(i,a,c,f,n[h+14],17,-1502002290),c=v(c,f=l(f,i,a,c,n[h+15],22,1236535329),i,a,n[h+1],5,-165796510),a=v(a,c,f,i,n[h+6],9,-1069501632),i=v(i,a,c,f,n[h+11],14,643717713),f=v(f,i,a,c,n[h],20,-373897302),c=v(c,f,i,a,n[h+5],5,-701558691),a=v(a,c,f,i,n[h+10],9,38016083),i=v(i,a,c,f,n[h+15],14,-660478335),f=v(f,i,a,c,n[h+4],20,-405537848),c=v(c,f,i,a,n[h+9],5,568446438),a=v(a,c,f,i,n[h+14],9,-1019803690),i=v(i,a,c,f,n[h+3],14,-187363961),f=v(f,i,a,c,n[h+8],20,1163531501),c=v(c,f,i,a,n[h+13],5,-1444681467),a=v(a,c,f,i,n[h+2],9,-51403784),i=v(i,a,c,f,n[h+7],14,1735328473),c=g(c,f=v(f,i,a,c,n[h+12],20,-1926607734),i,a,n[h+5],4,-378558),a=g(a,c,f,i,n[h+8],11,-2022574463),i=g(i,a,c,f,n[h+11],16,1839030562),f=g(f,i,a,c,n[h+14],23,-35309556),c=g(c,f,i,a,n[h+1],4,-1530992060),a=g(a,c,f,i,n[h+4],11,1272893353),i=g(i,a,c,f,n[h+7],16,-155497632),f=g(f,i,a,c,n[h+10],23,-1094730640),c=g(c,f,i,a,n[h+13],4,681279174),a=g(a,c,f,i,n[h],11,-358537222),i=g(i,a,c,f,n[h+3],16,-722521979),f=g(f,i,a,c,n[h+6],23,76029189),c=g(c,f,i,a,n[h+9],4,-640364487),a=g(a,c,f,i,n[h+12],11,-421815835),i=g(i,a,c,f,n[h+15],16,530742520),c=m(c,f=g(f,i,a,c,n[h+2],23,-995338651),i,a,n[h],6,-198630844),a=m(a,c,f,i,n[h+7],10,1126891415),i=m(i,a,c,f,n[h+14],15,-1416354905),f=m(f,i,a,c,n[h+5],21,-57434055),c=m(c,f,i,a,n[h+12],6,1700485571),a=m(a,c,f,i,n[h+3],10,-1894986606),i=m(i,a,c,f,n[h+10],15,-1051523),f=m(f,i,a,c,n[h+1],21,-2054922799),c=m(c,f,i,a,n[h+8],6,1873313359),a=m(a,c,f,i,n[h+15],10,-30611744),i=m(i,a,c,f,n[h+6],15,-1560198380),f=m(f,i,a,c,n[h+13],21,1309151649),c=m(c,f,i,a,n[h+4],6,-145523070),a=m(a,c,f,i,n[h+11],10,-1120210379),i=m(i,a,c,f,n[h+2],15,718787259),f=m(f,i,a,c,n[h+9],21,-343485551),c=d(c,r),f=d(f,e),i=d(i,o),a=d(a,u);return[c,f,i,a]}function a(n){for(var t="",r=32*n.length,e=0;e<r;e+=8)t+=String.fromCharCode(n[e>>5]>>>e%32&255);return t}function h(n){var t=[];for(t[(n.length>>2)-1]=void 0,e=0;e<t.length;e+=1)t[e]=0;for(var r=8*n.length,e=0;e<r;e+=8)t[e>>5]|=(255&n.charCodeAt(e/8))<<e%32;return t}function e(n){for(var t,r="0123456789abcdef",e="",o=0;o<n.length;o+=1)t=n.charCodeAt(o),e+=r.charAt(t>>>4&15)+r.charAt(15&t);return e}function r(n){return unescape(encodeURIComponent(n))}function o(n){return a(i(h(t=r(n)),8*t.length));var t}function u(n,t){return function(n,t){var r,e,o=h(n),u=[],c=[];for(u[15]=c[15]=void 0,16<o.length&&(o=i(o,8*n.length)),r=0;r<16;r+=1)u[r]=909522486^o[r],c[r]=1549556828^o[r];return e=i(u.concat(h(t)),512+8*t.length),a(i(c.concat(e),640))}(r(n),r(t))}function t(n,t,r){return t?r?u(t,n):e(u(t,n)):r?o(n):e(o(n))}"function"==typeof define&&define.amd?define(function(){return t}):"object"==typeof module&&module.exports?module.exports=t:n.md5=t}(this);
//# sourceMappingURL=md5.min.js.map</script>
<script id="script-module-pako" type="text/javascript">/*! pako 2.0.4 https://github.com/nodeca/pako @license (MIT AND Zlib) */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).pako={})}(this,(function(t){"use strict";function e(t){let e=t.length;for(;--e>=0;)t[e]=0}const a=256,i=286,n=30,s=15,r=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),l=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),o=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),h=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),d=new Array(576);e(d);const _=new Array(60);e(_);const f=new Array(512);e(f);const c=new Array(256);e(c);const u=new Array(29);e(u);const w=new Array(n);function b(t,e,a,i,n){this.static_tree=t,this.extra_bits=e,this.extra_base=a,this.elems=i,this.max_length=n,this.has_stree=t&&t.length}let g,p,m;function k(t,e){this.dyn_tree=t,this.max_code=0,this.stDngAT_desc=e}e(w);const v=t=>t<256?f[t]:f[256+(t>>>7)],y=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},x=(t,e,a)=>{t.bi_valid>16-a?(t.bi_buf|=e<<t.bi_valid&65535,y(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=a-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=a)},z=(t,e,a)=>{x(t,a[2*e],a[2*e+1])},A=(t,e)=>{let a=0;do{a|=1&t,t>>>=1,a<<=1}while(--e>0);return a>>>1},E=(t,e,a)=>{const i=new Array(16);let n,r,l=0;for(n=1;n<=s;n++)i[n]=l=l+a[n-1]<<1;for(r=0;r<=e;r++){let e=t[2*r+1];0!==e&&(t[2*r]=A(i[e]++,e))}},R=t=>{let e;for(e=0;e<i;e++)t.dyn_ltree[2*e]=0;for(e=0;e<n;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0},Z=t=>{t.bi_valid>8?y(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},U=(t,e,a,i)=>{const n=2*e,s=2*a;return t[n]<t[s]||t[n]===t[s]&&i[e]<=i[a]},S=(t,e,a)=>{const i=t.heap[a];let n=a<<1;for(;n<=t.heap_len&&(n<t.heap_len&&U(e,t.heap[n+1],t.heap[n],t.depth)&&n++,!U(e,i,t.heap[n],t.depth));)t.heap[a]=t.heap[n],a=n,n<<=1;t.heap[a]=i},D=(t,e,i)=>{let n,s,o,h,d=0;if(0!==t.last_lit)do{n=t.pending_buf[t.d_buf+2*d]<<8|t.pending_buf[t.d_buf+2*d+1],s=t.pending_buf[t.l_buf+d],d++,0===n?z(t,s,e):(o=c[s],z(t,o+a+1,e),h=r[o],0!==h&&(s-=u[o],x(t,s,h)),n--,o=v(n),z(t,o,i),h=l[o],0!==h&&(n-=w[o],x(t,n,h)))}while(d<t.last_lit);z(t,256,e)},T=(t,e)=>{const a=e.dyn_tree,i=e.stDngAT_desc.static_tree,n=e.stDngAT_desc.has_stree,r=e.stDngAT_desc.elems;let l,o,h,d=-1;for(t.heap_len=0,t.heap_max=573,l=0;l<r;l++)0!==a[2*l]?(t.heap[++t.heap_len]=d=l,t.depth[l]=0):a[2*l+1]=0;for(;t.heap_len<2;)h=t.heap[++t.heap_len]=d<2?++d:0,a[2*h]=1,t.depth[h]=0,t.opt_len--,n&&(t.static_len-=i[2*h+1]);for(e.max_code=d,l=t.heap_len>>1;l>=1;l--)S(t,a,l);h=r;do{l=t.heap[1],t.heap[1]=t.heap[t.heap_len--],S(t,a,1),o=t.heap[1],t.heap[--t.heap_max]=l,t.heap[--t.heap_max]=o,a[2*h]=a[2*l]+a[2*o],t.depth[h]=(t.depth[l]>=t.depth[o]?t.depth[l]:t.depth[o])+1,a[2*l+1]=a[2*o+1]=h,t.heap[1]=h++,S(t,a,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((t,e)=>{const a=e.dyn_tree,i=e.max_code,n=e.stDngAT_desc.static_tree,r=e.stDngAT_desc.has_stree,l=e.stDngAT_desc.extra_bits,o=e.stDngAT_desc.extra_base,h=e.stDngAT_desc.max_length;let d,_,f,c,u,w,b=0;for(c=0;c<=s;c++)t.bl_count[c]=0;for(a[2*t.heap[t.heap_max]+1]=0,d=t.heap_max+1;d<573;d++)_=t.heap[d],c=a[2*a[2*_+1]+1]+1,c>h&&(c=h,b++),a[2*_+1]=c,_>i||(t.bl_count[c]++,u=0,_>=o&&(u=l[_-o]),w=a[2*_],t.opt_len+=w*(c+u),r&&(t.static_len+=w*(n[2*_+1]+u)));if(0!==b){do{for(c=h-1;0===t.bl_count[c];)c--;t.bl_count[c]--,t.bl_count[c+1]+=2,t.bl_count[h]--,b-=2}while(b>0);for(c=h;0!==c;c--)for(_=t.bl_count[c];0!==_;)f=t.heap[--d],f>i||(a[2*f+1]!==c&&(t.opt_len+=(c-a[2*f+1])*a[2*f],a[2*f+1]=c),_--)}})(t,e),E(a,d,t.bl_count)},O=(t,e,a)=>{let i,n,s=-1,r=e[1],l=0,o=7,h=4;for(0===r&&(o=138,h=3),e[2*(a+1)+1]=65535,i=0;i<=a;i++)n=r,r=e[2*(i+1)+1],++l<o&&n===r||(l<h?t.bl_tree[2*n]+=l:0!==n?(n!==s&&t.bl_tree[2*n]++,t.bl_tree[32]++):l<=10?t.bl_tree[34]++:t.bl_tree[36]++,l=0,s=n,0===r?(o=138,h=3):n===r?(o=6,h=3):(o=7,h=4))},I=(t,e,a)=>{let i,n,s=-1,r=e[1],l=0,o=7,h=4;for(0===r&&(o=138,h=3),i=0;i<=a;i++)if(n=r,r=e[2*(i+1)+1],!(++l<o&&n===r)){if(l<h)do{z(t,n,t.bl_tree)}while(0!=--l);else 0!==n?(n!==s&&(z(t,n,t.bl_tree),l--),z(t,16,t.bl_tree),x(t,l-3,2)):l<=10?(z(t,17,t.bl_tree),x(t,l-3,3)):(z(t,18,t.bl_tree),x(t,l-11,7));l=0,s=n,0===r?(o=138,h=3):n===r?(o=6,h=3):(o=7,h=4)}};let F=!1;const L=(t,e,a,i)=>{x(t,0+(i?1:0),3),((t,e,a,i)=>{Z(t),i&&(y(t,a),y(t,~a)),t.pending_buf.set(t.window.subarray(e,e+a),t.pending),t.pending+=a})(t,e,a,!0)};var N={_tr_init:t=>{F||((()=>{let t,e,a,h,k;const v=new Array(16);for(a=0,h=0;h<28;h++)for(u[h]=a,t=0;t<1<<r[h];t++)c[a++]=h;for(c[a-1]=h,k=0,h=0;h<16;h++)for(w[h]=k,t=0;t<1<<l[h];t++)f[k++]=h;for(k>>=7;h<n;h++)for(w[h]=k<<7,t=0;t<1<<l[h]-7;t++)f[256+k++]=h;for(e=0;e<=s;e++)v[e]=0;for(t=0;t<=143;)d[2*t+1]=8,t++,v[8]++;for(;t<=255;)d[2*t+1]=9,t++,v[9]++;for(;t<=279;)d[2*t+1]=7,t++,v[7]++;for(;t<=287;)d[2*t+1]=8,t++,v[8]++;for(E(d,287,v),t=0;t<n;t++)_[2*t+1]=5,_[2*t]=A(t,5);g=new b(d,r,257,i,s),p=new b(_,l,0,n,s),m=new b(new Array(0),o,0,19,7)})(),F=!0),t.l_desc=new k(t.dyn_ltree,g),t.d_desc=new k(t.dyn_dtree,p),t.bl_desc=new k(t.bl_tree,m),t.bi_buf=0,t.bi_valid=0,R(t)},_tr_stored_block:L,_tr_flush_block:(t,e,i,n)=>{let s,r,l=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=(t=>{let e,i=4093624447;for(e=0;e<=31;e++,i>>>=1)if(1&i&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<a;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0})(t)),T(t,t.l_desc),T(t,t.d_desc),l=(t=>{let e;for(O(t,t.dyn_ltree,t.l_desc.max_code),O(t,t.dyn_dtree,t.d_desc.max_code),T(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*h[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e})(t),s=t.opt_len+3+7>>>3,r=t.static_len+3+7>>>3,r<=s&&(s=r)):s=r=i+5,i+4<=s&&-1!==e?L(t,e,i,n):4===t.strategy||r===s?(x(t,2+(n?1:0),3),D(t,d,_)):(x(t,4+(n?1:0),3),((t,e,a,i)=>{let n;for(x(t,e-257,5),x(t,a-1,5),x(t,i-4,4),n=0;n<i;n++)x(t,t.bl_tree[2*h[n]+1],3);I(t,t.dyn_ltree,e-1),I(t,t.dyn_dtree,a-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,l+1),D(t,t.dyn_ltree,t.dyn_dtree)),R(t),n&&Z(t)},_tr_tally:(t,e,i)=>(t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&i,t.last_lit++,0===e?t.dyn_ltree[2*i]++:(t.matches++,e--,t.dyn_ltree[2*(c[i]+a+1)]++,t.dyn_dtree[2*v(e)]++),t.last_lit===t.lit_bufsize-1),_tr_align:t=>{x(t,2,3),z(t,256,d),(t=>{16===t.bi_valid?(y(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(t)}};var B=(t,e,a,i)=>{let n=65535&t|0,s=t>>>16&65535|0,r=0;for(;0!==a;){r=a>2e3?2e3:a,a-=r;do{n=n+e[i++]|0,s=s+n|0}while(--r);n%=65521,s%=65521}return n|s<<16|0};const C=new Uint32Array((()=>{let t,e=[];for(var a=0;a<256;a++){t=a;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[a]=t}return e})());var M=(t,e,a,i)=>{const n=C,s=i+a;t^=-1;for(let a=i;a<s;a++)t=t>>>8^n[255&(t^e[a])];return-1^t},H={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},j={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:K,_tr_stored_block:P,_tr_flush_block:Y,_tr_tally:G,_tr_align:X}=N,{Z_NO_FLUSH:W,Z_PARTIAL_FLUSH:q,Z_FULL_FLUSH:J,Z_FINISH:Q,Z_BLOCK:V,Z_OK:$,Z_STREAM_END:tt,Z_STREAM_ERROR:et,Z_DATA_ERROR:at,Z_BUF_ERROR:it,Z_DEFAULT_COMPRESSION:nt,Z_FILTERED:st,Z_HUFFMAN_ONLY:rt,Z_RLE:lt,Z_FIXED:ot,Z_DEFAULT_STRATEGY:ht,Z_UNKNOWN:dt,Z_DEFLATED:_t}=j,ft=258,ct=262,ut=103,wt=113,bt=666,gt=(t,e)=>(t.msg=H[e],e),pt=t=>(t<<1)-(t>4?9:0),mt=t=>{let e=t.length;for(;--e>=0;)t[e]=0};let kt=(t,e,a)=>(e<<t.hash_shift^a)&t.hash_mask;const vt=t=>{const e=t.state;let a=e.pending;a>t.avail_out&&(a=t.avail_out),0!==a&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+a),t.next_out),t.next_out+=a,e.pending_out+=a,t.total_out+=a,t.avail_out-=a,e.pending-=a,0===e.pending&&(e.pending_out=0))},yt=(t,e)=>{Y(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,vt(t.strm)},xt=(t,e)=>{t.pending_buf[t.pending++]=e},zt=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},At=(t,e,a,i)=>{let n=t.avail_in;return n>i&&(n=i),0===n?0:(t.avail_in-=n,e.set(t.input.subarray(t.next_in,t.next_in+n),a),1===t.state.wrap?t.adler=B(t.adler,e,n,a):2===t.state.wrap&&(t.adler=M(t.adler,e,n,a)),t.next_in+=n,t.total_in+=n,n)},Et=(t,e)=>{let a,i,n=t.max_chain_length,s=t.strstart,r=t.prev_length,l=t.nice_match;const o=t.strstart>t.w_size-ct?t.strstart-(t.w_size-ct):0,h=t.window,d=t.w_mask,_=t.prev,f=t.strstart+ft;let c=h[s+r-1],u=h[s+r];t.prev_length>=t.good_match&&(n>>=2),l>t.lookahead&&(l=t.lookahead);do{if(a=e,h[a+r]===u&&h[a+r-1]===c&&h[a]===h[s]&&h[++a]===h[s+1]){s+=2,a++;do{}while(h[++s]===h[++a]&&h[++s]===h[++a]&&h[++s]===h[++a]&&h[++s]===h[++a]&&h[++s]===h[++a]&&h[++s]===h[++a]&&h[++s]===h[++a]&&h[++s]===h[++a]&&s<f);if(i=ft-(f-s),s=f-ft,i>r){if(t.match_start=e,r=i,i>=l)break;c=h[s+r-1],u=h[s+r]}}}while((e=_[e&d])>o&&0!=--n);return r<=t.lookahead?r:t.lookahead},Rt=t=>{const e=t.w_size;let a,i,n,s,r;do{if(s=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-ct)){t.window.set(t.window.subarray(e,e+e),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,i=t.hash_size,a=i;do{n=t.head[--a],t.head[a]=n>=e?n-e:0}while(--i);i=e,a=i;do{n=t.prev[--a],t.prev[a]=n>=e?n-e:0}while(--i);s+=e}if(0===t.strm.avail_in)break;if(i=At(t.strm,t.window,t.strstart+t.lookahead,s),t.lookahead+=i,t.lookahead+t.insert>=3)for(r=t.strstart-t.insert,t.ins_h=t.window[r],t.ins_h=kt(t,t.ins_h,t.window[r+1]);t.insert&&(t.ins_h=kt(t,t.ins_h,t.window[r+3-1]),t.prev[r&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=r,r++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<ct&&0!==t.strm.avail_in)},Zt=(t,e)=>{let a,i;for(;;){if(t.lookahead<ct){if(Rt(t),t.lookahead<ct&&e===W)return 1;if(0===t.lookahead)break}if(a=0,t.lookahead>=3&&(t.ins_h=kt(t,t.ins_h,t.window[t.strstart+3-1]),a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==a&&t.strstart-a<=t.w_size-ct&&(t.match_length=Et(t,a)),t.match_length>=3)if(i=G(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=kt(t,t.ins_h,t.window[t.strstart+3-1]),a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=kt(t,t.ins_h,t.window[t.strstart+1]);else i=G(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(yt(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,e===Q?(yt(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(yt(t,!1),0===t.strm.avail_out)?1:2},Ut=(t,e)=>{let a,i,n;for(;;){if(t.lookahead<ct){if(Rt(t),t.lookahead<ct&&e===W)return 1;if(0===t.lookahead)break}if(a=0,t.lookahead>=3&&(t.ins_h=kt(t,t.ins_h,t.window[t.strstart+3-1]),a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==a&&t.prev_length<t.max_lazy_match&&t.strstart-a<=t.w_size-ct&&(t.match_length=Et(t,a),t.match_length<=5&&(t.strategy===st||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){n=t.strstart+t.lookahead-3,i=G(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=n&&(t.ins_h=kt(t,t.ins_h,t.window[t.strstart+3-1]),a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,i&&(yt(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if(i=G(t,0,t.window[t.strstart-1]),i&&yt(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=G(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===Q?(yt(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(yt(t,!1),0===t.strm.avail_out)?1:2};function St(t,e,a,i,n){this.good_length=t,this.max_lazy=e,this.nice_length=a,this.max_chain=i,this.func=n}const Dt=[new St(0,0,0,0,((t,e)=>{let a=65535;for(a>t.pending_buf_size-5&&(a=t.pending_buf_size-5);;){if(t.lookahead<=1){if(Rt(t),0===t.lookahead&&e===W)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;const i=t.block_start+a;if((0===t.strstart||t.strstart>=i)&&(t.lookahead=t.strstart-i,t.strstart=i,yt(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-ct&&(yt(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===Q?(yt(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&(yt(t,!1),t.strm.avail_out),1)})),new St(4,4,8,4,Zt),new St(4,5,16,8,Zt),new St(4,6,32,32,Zt),new St(4,4,16,16,Ut),new St(8,16,32,32,Ut),new St(8,16,128,128,Ut),new St(8,32,128,256,Ut),new St(32,128,258,1024,Ut),new St(32,258,258,4096,Ut)];function Tt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=_t,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),mt(this.dyn_ltree),mt(this.dyn_dtree),mt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),mt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),mt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Ot=t=>{if(!t||!t.state)return gt(t,et);t.total_in=t.total_out=0,t.data_type=dt;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?42:wt,t.adler=2===e.wrap?0:1,e.last_flush=W,K(e),$},It=t=>{const e=Ot(t);var a;return e===$&&((a=t.state).window_size=2*a.w_size,mt(a.head),a.max_lazy_match=Dt[a.level].max_lazy,a.good_match=Dt[a.level].good_length,a.nice_match=Dt[a.level].nice_length,a.max_chain_length=Dt[a.level].max_chain,a.strstart=0,a.block_start=0,a.lookahead=0,a.insert=0,a.match_length=a.prev_length=2,a.match_available=0,a.ins_h=0),e},Ft=(t,e,a,i,n,s)=>{if(!t)return et;let r=1;if(e===nt&&(e=6),i<0?(r=0,i=-i):i>15&&(r=2,i-=16),n<1||n>9||a!==_t||i<8||i>15||e<0||e>9||s<0||s>ot)return gt(t,et);8===i&&(i=9);const l=new Tt;return t.state=l,l.strm=t,l.wrap=r,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=n+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new Uint8Array(2*l.w_size),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<n+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new Uint8Array(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=e,l.strategy=s,l.method=a,It(t)};var Lt={deflateInit:(t,e)=>Ft(t,e,_t,15,8,ht),deflateInit2:Ft,deflateReset:It,deflateResetKeep:Ot,deflateSetHeader:(t,e)=>t&&t.state?2!==t.state.wrap?et:(t.state.gzhead=e,$):et,deflate:(t,e)=>{let a,i;if(!t||!t.state||e>V||e<0)return t?gt(t,et):et;const n=t.state;if(!t.output||!t.input&&0!==t.avail_in||n.status===bt&&e!==Q)return gt(t,0===t.avail_out?it:et);n.strm=t;const s=n.last_flush;if(n.last_flush=e,42===n.status)if(2===n.wrap)t.adler=0,xt(n,31),xt(n,139),xt(n,8),n.gzhead?(xt(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),xt(n,255&n.gzhead.time),xt(n,n.gzhead.time>>8&255),xt(n,n.gzhead.time>>16&255),xt(n,n.gzhead.time>>24&255),xt(n,9===n.level?2:n.strategy>=rt||n.level<2?4:0),xt(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(xt(n,255&n.gzhead.extra.length),xt(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=M(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69):(xt(n,0),xt(n,0),xt(n,0),xt(n,0),xt(n,0),xt(n,9===n.level?2:n.strategy>=rt||n.level<2?4:0),xt(n,3),n.status=wt);else{let e=_t+(n.w_bits-8<<4)<<8,a=-1;a=n.strategy>=rt||n.level<2?0:n.level<6?1:6===n.level?2:3,e|=a<<6,0!==n.strstart&&(e|=32),e+=31-e%31,n.status=wt,zt(n,e),0!==n.strstart&&(zt(n,t.adler>>>16),zt(n,65535&t.adler)),t.adler=1}if(69===n.status)if(n.gzhead.extra){for(a=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>a&&(t.adler=M(t.adler,n.pending_buf,n.pending-a,a)),vt(t),a=n.pending,n.pending!==n.pending_buf_size));)xt(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>a&&(t.adler=M(t.adler,n.pending_buf,n.pending-a,a)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=73)}else n.status=73;if(73===n.status)if(n.gzhead.name){a=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>a&&(t.adler=M(t.adler,n.pending_buf,n.pending-a,a)),vt(t),a=n.pending,n.pending===n.pending_buf_size)){i=1;break}i=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,xt(n,i)}while(0!==i);n.gzhead.hcrc&&n.pending>a&&(t.adler=M(t.adler,n.pending_buf,n.pending-a,a)),0===i&&(n.gzindex=0,n.status=91)}else n.status=91;if(91===n.status)if(n.gzhead.comment){a=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>a&&(t.adler=M(t.adler,n.pending_buf,n.pending-a,a)),vt(t),a=n.pending,n.pending===n.pending_buf_size)){i=1;break}i=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,xt(n,i)}while(0!==i);n.gzhead.hcrc&&n.pending>a&&(t.adler=M(t.adler,n.pending_buf,n.pending-a,a)),0===i&&(n.status=ut)}else n.status=ut;if(n.status===ut&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&vt(t),n.pending+2<=n.pending_buf_size&&(xt(n,255&t.adler),xt(n,t.adler>>8&255),t.adler=0,n.status=wt)):n.status=wt),0!==n.pending){if(vt(t),0===t.avail_out)return n.last_flush=-1,$}else if(0===t.avail_in&&pt(e)<=pt(s)&&e!==Q)return gt(t,it);if(n.status===bt&&0!==t.avail_in)return gt(t,it);if(0!==t.avail_in||0!==n.lookahead||e!==W&&n.status!==bt){let a=n.strategy===rt?((t,e)=>{let a;for(;;){if(0===t.lookahead&&(Rt(t),0===t.lookahead)){if(e===W)return 1;break}if(t.match_length=0,a=G(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,a&&(yt(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===Q?(yt(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(yt(t,!1),0===t.strm.avail_out)?1:2})(n,e):n.strategy===lt?((t,e)=>{let a,i,n,s;const r=t.window;for(;;){if(t.lookahead<=ft){if(Rt(t),t.lookahead<=ft&&e===W)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(n=t.strstart-1,i=r[n],i===r[++n]&&i===r[++n]&&i===r[++n])){s=t.strstart+ft;do{}while(i===r[++n]&&i===r[++n]&&i===r[++n]&&i===r[++n]&&i===r[++n]&&i===r[++n]&&i===r[++n]&&i===r[++n]&&n<s);t.match_length=ft-(s-n),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(a=G(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(a=G(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),a&&(yt(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===Q?(yt(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(yt(t,!1),0===t.strm.avail_out)?1:2})(n,e):Dt[n.level].func(n,e);if(3!==a&&4!==a||(n.status=bt),1===a||3===a)return 0===t.avail_out&&(n.last_flush=-1),$;if(2===a&&(e===q?X(n):e!==V&&(P(n,0,0,!1),e===J&&(mt(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),vt(t),0===t.avail_out))return n.last_flush=-1,$}return e!==Q?$:n.wrap<=0?tt:(2===n.wrap?(xt(n,255&t.adler),xt(n,t.adler>>8&255),xt(n,t.adler>>16&255),xt(n,t.adler>>24&255),xt(n,255&t.total_in),xt(n,t.total_in>>8&255),xt(n,t.total_in>>16&255),xt(n,t.total_in>>24&255)):(zt(n,t.adler>>>16),zt(n,65535&t.adler)),vt(t),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?$:tt)},deflateEnd:t=>{if(!t||!t.state)return et;const e=t.state.status;return 42!==e&&69!==e&&73!==e&&91!==e&&e!==ut&&e!==wt&&e!==bt?gt(t,et):(t.state=null,e===wt?gt(t,at):$)},deflateSetDictionary:(t,e)=>{let a=e.length;if(!t||!t.state)return et;const i=t.state,n=i.wrap;if(2===n||1===n&&42!==i.status||i.lookahead)return et;if(1===n&&(t.adler=B(t.adler,e,a,0)),i.wrap=0,a>=i.w_size){0===n&&(mt(i.head),i.strstart=0,i.block_start=0,i.insert=0);let t=new Uint8Array(i.w_size);t.set(e.subarray(a-i.w_size,a),0),e=t,a=i.w_size}const s=t.avail_in,r=t.next_in,l=t.input;for(t.avail_in=a,t.next_in=0,t.input=e,Rt(i);i.lookahead>=3;){let t=i.strstart,e=i.lookahead-2;do{i.ins_h=kt(i,i.ins_h,i.window[t+3-1]),i.prev[t&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=t,t++}while(--e);i.strstart=t,i.lookahead=2,Rt(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,t.next_in=r,t.input=l,t.avail_in=s,i.wrap=n,$},deflateInfo:"pako deflate (from Nodeca project)"};const Nt=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Bt=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const a=e.shift();if(a){if("object"!=typeof a)throw new TypeError(a+"must be non-object");for(const e in a)Nt(a,e)&&(t[e]=a[e])}}return t},Ct=t=>{let e=0;for(let a=0,i=t.length;a<i;a++)e+=t[a].length;const a=new Uint8Array(e);for(let e=0,i=0,n=t.length;e<n;e++){let n=t[e];a.set(n,i),i+=n.length}return a};let Mt=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){Mt=!1}const Ht=new Uint8Array(256);for(let t=0;t<256;t++)Ht[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Ht[254]=Ht[254]=1;var jt=t=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(t);let e,a,i,n,s,r=t.length,l=0;for(n=0;n<r;n++)a=t.charCodeAt(n),55296==(64512&a)&&n+1<r&&(i=t.charCodeAt(n+1),56320==(64512&i)&&(a=65536+(a-55296<<10)+(i-56320),n++)),l+=a<128?1:a<2048?2:a<65536?3:4;for(e=new Uint8Array(l),s=0,n=0;s<l;n++)a=t.charCodeAt(n),55296==(64512&a)&&n+1<r&&(i=t.charCodeAt(n+1),56320==(64512&i)&&(a=65536+(a-55296<<10)+(i-56320),n++)),a<128?e[s++]=a:a<2048?(e[s++]=192|a>>>6,e[s++]=128|63&a):a<65536?(e[s++]=224|a>>>12,e[s++]=128|a>>>6&63,e[s++]=128|63&a):(e[s++]=240|a>>>18,e[s++]=128|a>>>12&63,e[s++]=128|a>>>6&63,e[s++]=128|63&a);return e},Kt=(t,e)=>{const a=e||t.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(t.subarray(0,e));let i,n;const s=new Array(2*a);for(n=0,i=0;i<a;){let e=t[i++];if(e<128){s[n++]=e;continue}let r=Ht[e];if(r>4)s[n++]=65533,i+=r-1;else{for(e&=2===r?31:3===r?15:7;r>1&&i<a;)e=e<<6|63&t[i++],r--;r>1?s[n++]=65533:e<65536?s[n++]=e:(e-=65536,s[n++]=55296|e>>10&1023,s[n++]=56320|1023&e)}}return((t,e)=>{if(e<65534&&t.subarray&&Mt)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let a="";for(let i=0;i<e;i++)a+=String.fromCharCode(t[i]);return a})(s,n)},Pt=(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let a=e-1;for(;a>=0&&128==(192&t[a]);)a--;return a<0||0===a?e:a+Ht[t[a]]>e?a:e};var Yt=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Gt=Object.prototype.toString,{Z_NO_FLUSH:Xt,Z_SYNC_FLUSH:Wt,Z_FULL_FLUSH:qt,Z_FINISH:Jt,Z_OK:Qt,Z_STREAM_END:Vt,Z_DEFAULT_COMPRESSION:$t,Z_DEFAULT_STRATEGY:te,Z_DEFLATED:ee}=j;function ae(t){this.options=Bt({level:$t,method:ee,chunkSize:16384,windowBits:15,memLevel:8,strategy:te},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Yt,this.strm.avail_out=0;let a=Lt.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(a!==Qt)throw new Error(H[a]);if(e.header&&Lt.deflateSetHeader(this.strm,e.header),e.dictionary){let t;if(t="string"==typeof e.dictionary?jt(e.dictionary):"[object ArrayBuffer]"===Gt.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,a=Lt.deflateSetDictionary(this.strm,t),a!==Qt)throw new Error(H[a]);this._dict_set=!0}}function ie(t,e){const a=new ae(e);if(a.push(t,!0),a.err)throw a.msg||H[a.err];return a.result}ae.prototype.push=function(t,e){const a=this.strm,i=this.options.chunkSize;let n,s;if(this.ended)return!1;for(s=e===~~e?e:!0===e?Jt:Xt,"string"==typeof t?a.input=jt(t):"[object ArrayBuffer]"===Gt.call(t)?a.input=new Uint8Array(t):a.input=t,a.next_in=0,a.avail_in=a.input.length;;)if(0===a.avail_out&&(a.output=new Uint8Array(i),a.next_out=0,a.avail_out=i),(s===Wt||s===qt)&&a.avail_out<=6)this.onData(a.output.subarray(0,a.next_out)),a.avail_out=0;else{if(n=Lt.deflate(a,s),n===Vt)return a.next_out>0&&this.onData(a.output.subarray(0,a.next_out)),n=Lt.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Qt;if(0!==a.avail_out){if(s>0&&a.next_out>0)this.onData(a.output.subarray(0,a.next_out)),a.avail_out=0;else if(0===a.avail_in)break}else this.onData(a.output)}return!0},ae.prototype.onData=function(t){this.chunks.push(t)},ae.prototype.onEnd=function(t){t===Qt&&(this.result=Ct(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var ne={Deflate:ae,deflate:ie,deflateRaw:function(t,e){return(e=e||{}).raw=!0,ie(t,e)},gzip:function(t,e){return(e=e||{}).gzip=!0,ie(t,e)},constants:j};var se=function(t,e){let a,i,n,s,r,l,o,h,d,_,f,c,u,w,b,g,p,m,k,v,y,x,z,A;const E=t.state;a=t.next_in,z=t.input,i=a+(t.avail_in-5),n=t.next_out,A=t.output,s=n-(e-t.avail_out),r=n+(t.avail_out-257),l=E.dmax,o=E.wsize,h=E.whave,d=E.wnext,_=E.window,f=E.hold,c=E.bits,u=E.lencode,w=E.distcode,b=(1<<E.lenbits)-1,g=(1<<E.distbits)-1;t:do{c<15&&(f+=z[a++]<<c,c+=8,f+=z[a++]<<c,c+=8),p=u[f&b];e:for(;;){if(m=p>>>24,f>>>=m,c-=m,m=p>>>16&255,0===m)A[n++]=65535&p;else{if(!(16&m)){if(0==(64&m)){p=u[(65535&p)+(f&(1<<m)-1)];continue e}if(32&m){E.mode=12;break t}t.msg="invalid literal/length code",E.mode=30;break t}k=65535&p,m&=15,m&&(c<m&&(f+=z[a++]<<c,c+=8),k+=f&(1<<m)-1,f>>>=m,c-=m),c<15&&(f+=z[a++]<<c,c+=8,f+=z[a++]<<c,c+=8),p=w[f&g];a:for(;;){if(m=p>>>24,f>>>=m,c-=m,m=p>>>16&255,!(16&m)){if(0==(64&m)){p=w[(65535&p)+(f&(1<<m)-1)];continue a}t.msg="invalid distance code",E.mode=30;break t}if(v=65535&p,m&=15,c<m&&(f+=z[a++]<<c,c+=8,c<m&&(f+=z[a++]<<c,c+=8)),v+=f&(1<<m)-1,v>l){t.msg="invalid distance too far back",E.mode=30;break t}if(f>>>=m,c-=m,m=n-s,v>m){if(m=v-m,m>h&&E.sane){t.msg="invalid distance too far back",E.mode=30;break t}if(y=0,x=_,0===d){if(y+=o-m,m<k){k-=m;do{A[n++]=_[y++]}while(--m);y=n-v,x=A}}else if(d<m){if(y+=o+d-m,m-=d,m<k){k-=m;do{A[n++]=_[y++]}while(--m);if(y=0,d<k){m=d,k-=m;do{A[n++]=_[y++]}while(--m);y=n-v,x=A}}}else if(y+=d-m,m<k){k-=m;do{A[n++]=_[y++]}while(--m);y=n-v,x=A}for(;k>2;)A[n++]=x[y++],A[n++]=x[y++],A[n++]=x[y++],k-=3;k&&(A[n++]=x[y++],k>1&&(A[n++]=x[y++]))}else{y=n-v;do{A[n++]=A[y++],A[n++]=A[y++],A[n++]=A[y++],k-=3}while(k>2);k&&(A[n++]=A[y++],k>1&&(A[n++]=A[y++]))}break}}break}}while(a<i&&n<r);k=c>>3,a-=k,c-=k<<3,f&=(1<<c)-1,t.next_in=a,t.next_out=n,t.avail_in=a<i?i-a+5:5-(a-i),t.avail_out=n<r?r-n+257:257-(n-r),E.hold=f,E.bits=c};const re=15,le=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),oe=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),he=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),de=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var _e=(t,e,a,i,n,s,r,l)=>{const o=l.bits;let h,d,_,f,c,u,w=0,b=0,g=0,p=0,m=0,k=0,v=0,y=0,x=0,z=0,A=null,E=0;const R=new Uint16Array(16),Z=new Uint16Array(16);let U,S,D,T=null,O=0;for(w=0;w<=re;w++)R[w]=0;for(b=0;b<i;b++)R[e[a+b]]++;for(m=o,p=re;p>=1&&0===R[p];p--);if(m>p&&(m=p),0===p)return n[s++]=20971520,n[s++]=20971520,l.bits=1,0;for(g=1;g<p&&0===R[g];g++);for(m<g&&(m=g),y=1,w=1;w<=re;w++)if(y<<=1,y-=R[w],y<0)return-1;if(y>0&&(0===t||1!==p))return-1;for(Z[1]=0,w=1;w<re;w++)Z[w+1]=Z[w]+R[w];for(b=0;b<i;b++)0!==e[a+b]&&(r[Z[e[a+b]]++]=b);if(0===t?(A=T=r,u=19):1===t?(A=le,E-=257,T=oe,O-=257,u=256):(A=he,T=de,u=-1),z=0,b=0,w=g,c=s,k=m,v=0,_=-1,x=1<<m,f=x-1,1===t&&x>852||2===t&&x>592)return 1;for(;;){U=w-v,r[b]<u?(S=0,D=r[b]):r[b]>u?(S=T[O+r[b]],D=A[E+r[b]]):(S=96,D=0),h=1<<w-v,d=1<<k,g=d;do{d-=h,n[c+(z>>v)+d]=U<<24|S<<16|D|0}while(0!==d);for(h=1<<w-1;z&h;)h>>=1;if(0!==h?(z&=h-1,z+=h):z=0,b++,0==--R[w]){if(w===p)break;w=e[a+r[b]]}if(w>m&&(z&f)!==_){for(0===v&&(v=m),c+=g,k=w-v,y=1<<k;k+v<p&&(y-=R[k+v],!(y<=0));)k++,y<<=1;if(x+=1<<k,1===t&&x>852||2===t&&x>592)return 1;_=z&f,n[_]=m<<24|k<<16|c-s|0}}return 0!==z&&(n[c+z]=w-v<<24|64<<16|0),l.bits=m,0};const{Z_FINISH:fe,Z_BLOCK:ce,Z_TREES:ue,Z_OK:we,Z_STREAM_END:be,Z_NEED_DICT:ge,Z_STREAM_ERROR:pe,Z_DATA_ERROR:me,Z_MEM_ERROR:ke,Z_BUF_ERROR:ve,Z_DEFLATED:ye}=j,xe=12,ze=30,Ae=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function Ee(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Re=t=>{if(!t||!t.state)return pe;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,we},Ze=t=>{if(!t||!t.state)return pe;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,Re(t)},Ue=(t,e)=>{let a;if(!t||!t.state)return pe;const i=t.state;return e<0?(a=0,e=-e):(a=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?pe:(null!==i.window&&i.wbits!==e&&(i.window=null),i.wrap=a,i.wbits=e,Ze(t))},Se=(t,e)=>{if(!t)return pe;const a=new Ee;t.state=a,a.window=null;const i=Ue(t,e);return i!==we&&(t.state=null),i};let De,Te,Oe=!0;const Ie=t=>{if(Oe){De=new Int32Array(512),Te=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(_e(1,t.lens,0,288,De,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;_e(2,t.lens,0,32,Te,0,t.work,{bits:5}),Oe=!1}t.lencode=De,t.lenbits=9,t.distcode=Te,t.distbits=5},Fe=(t,e,a,i)=>{let n;const s=t.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),i>=s.wsize?(s.window.set(e.subarray(a-s.wsize,a),0),s.wnext=0,s.whave=s.wsize):(n=s.wsize-s.wnext,n>i&&(n=i),s.window.set(e.subarray(a-i,a-i+n),s.wnext),(i-=n)?(s.window.set(e.subarray(a-i,a),0),s.wnext=i,s.whave=s.wsize):(s.wnext+=n,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=n))),0};var Le={inflateReset:Ze,inflateReset2:Ue,inflateResetKeep:Re,inflateInit:t=>Se(t,15),inflateInit2:Se,inflate:(t,e)=>{let a,i,n,s,r,l,o,h,d,_,f,c,u,w,b,g,p,m,k,v,y,x,z=0;const A=new Uint8Array(4);let E,R;const Z=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return pe;a=t.state,a.mode===xe&&(a.mode=13),r=t.next_out,n=t.output,o=t.avail_out,s=t.next_in,i=t.input,l=t.avail_in,h=a.hold,d=a.bits,_=l,f=o,x=we;t:for(;;)switch(a.mode){case 1:if(0===a.wrap){a.mode=13;break}for(;d<16;){if(0===l)break t;l--,h+=i[s++]<<d,d+=8}if(2&a.wrap&&35615===h){a.check=0,A[0]=255&h,A[1]=h>>>8&255,a.check=M(a.check,A,2,0),h=0,d=0,a.mode=2;break}if(a.flags=0,a.head&&(a.head.done=!1),!(1&a.wrap)||(((255&h)<<8)+(h>>8))%31){t.msg="incorrect header check",a.mode=ze;break}if((15&h)!==ye){t.msg="unknown compression method",a.mode=ze;break}if(h>>>=4,d-=4,y=8+(15&h),0===a.wbits)a.wbits=y;else if(y>a.wbits){t.msg="invalid window size",a.mode=ze;break}a.dmax=1<<a.wbits,t.adler=a.check=1,a.mode=512&h?10:xe,h=0,d=0;break;case 2:for(;d<16;){if(0===l)break t;l--,h+=i[s++]<<d,d+=8}if(a.flags=h,(255&a.flags)!==ye){t.msg="unknown compression method",a.mode=ze;break}if(57344&a.flags){t.msg="unknown header flags set",a.mode=ze;break}a.head&&(a.head.text=h>>8&1),512&a.flags&&(A[0]=255&h,A[1]=h>>>8&255,a.check=M(a.check,A,2,0)),h=0,d=0,a.mode=3;case 3:for(;d<32;){if(0===l)break t;l--,h+=i[s++]<<d,d+=8}a.head&&(a.head.time=h),512&a.flags&&(A[0]=255&h,A[1]=h>>>8&255,A[2]=h>>>16&255,A[3]=h>>>24&255,a.check=M(a.check,A,4,0)),h=0,d=0,a.mode=4;case 4:for(;d<16;){if(0===l)break t;l--,h+=i[s++]<<d,d+=8}a.head&&(a.head.xflags=255&h,a.head.os=h>>8),512&a.flags&&(A[0]=255&h,A[1]=h>>>8&255,a.check=M(a.check,A,2,0)),h=0,d=0,a.mode=5;case 5:if(1024&a.flags){for(;d<16;){if(0===l)break t;l--,h+=i[s++]<<d,d+=8}a.length=h,a.head&&(a.head.extra_len=h),512&a.flags&&(A[0]=255&h,A[1]=h>>>8&255,a.check=M(a.check,A,2,0)),h=0,d=0}else a.head&&(a.head.extra=null);a.mode=6;case 6:if(1024&a.flags&&(c=a.length,c>l&&(c=l),c&&(a.head&&(y=a.head.extra_len-a.length,a.head.extra||(a.head.extra=new Uint8Array(a.head.extra_len)),a.head.extra.set(i.subarray(s,s+c),y)),512&a.flags&&(a.check=M(a.check,i,c,s)),l-=c,s+=c,a.length-=c),a.length))break t;a.length=0,a.mode=7;case 7:if(2048&a.flags){if(0===l)break t;c=0;do{y=i[s+c++],a.head&&y&&a.length<65536&&(a.head.name+=String.fromCharCode(y))}while(y&&c<l);if(512&a.flags&&(a.check=M(a.check,i,c,s)),l-=c,s+=c,y)break t}else a.head&&(a.head.name=null);a.length=0,a.mode=8;case 8:if(4096&a.flags){if(0===l)break t;c=0;do{y=i[s+c++],a.head&&y&&a.length<65536&&(a.head.comment+=String.fromCharCode(y))}while(y&&c<l);if(512&a.flags&&(a.check=M(a.check,i,c,s)),l-=c,s+=c,y)break t}else a.head&&(a.head.comment=null);a.mode=9;case 9:if(512&a.flags){for(;d<16;){if(0===l)break t;l--,h+=i[s++]<<d,d+=8}if(h!==(65535&a.check)){t.msg="header crc mismatch",a.mode=ze;break}h=0,d=0}a.head&&(a.head.hcrc=a.flags>>9&1,a.head.done=!0),t.adler=a.check=0,a.mode=xe;break;case 10:for(;d<32;){if(0===l)break t;l--,h+=i[s++]<<d,d+=8}t.adler=a.check=Ae(h),h=0,d=0,a.mode=11;case 11:if(0===a.havedict)return t.next_out=r,t.avail_out=o,t.next_in=s,t.avail_in=l,a.hold=h,a.bits=d,ge;t.adler=a.check=1,a.mode=xe;case xe:if(e===ce||e===ue)break t;case 13:if(a.last){h>>>=7&d,d-=7&d,a.mode=27;break}for(;d<3;){if(0===l)break t;l--,h+=i[s++]<<d,d+=8}switch(a.last=1&h,h>>>=1,d-=1,3&h){case 0:a.mode=14;break;case 1:if(Ie(a),a.mode=20,e===ue){h>>>=2,d-=2;break t}break;case 2:a.mode=17;break;case 3:t.msg="invalid block type",a.mode=ze}h>>>=2,d-=2;break;case 14:for(h>>>=7&d,d-=7&d;d<32;){if(0===l)break t;l--,h+=i[s++]<<d,d+=8}if((65535&h)!=(h>>>16^65535)){t.msg="invalid stored block lengths",a.mode=ze;break}if(a.length=65535&h,h=0,d=0,a.mode=15,e===ue)break t;case 15:a.mode=16;case 16:if(c=a.length,c){if(c>l&&(c=l),c>o&&(c=o),0===c)break t;n.set(i.subarray(s,s+c),r),l-=c,s+=c,o-=c,r+=c,a.length-=c;break}a.mode=xe;break;case 17:for(;d<14;){if(0===l)break t;l--,h+=i[s++]<<d,d+=8}if(a.nlen=257+(31&h),h>>>=5,d-=5,a.ndist=1+(31&h),h>>>=5,d-=5,a.ncode=4+(15&h),h>>>=4,d-=4,a.nlen>286||a.ndist>30){t.msg="too many length or distance symbols",a.mode=ze;break}a.have=0,a.mode=18;case 18:for(;a.have<a.ncode;){for(;d<3;){if(0===l)break t;l--,h+=i[s++]<<d,d+=8}a.lens[Z[a.have++]]=7&h,h>>>=3,d-=3}for(;a.have<19;)a.lens[Z[a.have++]]=0;if(a.lencode=a.lendyn,a.lenbits=7,E={bits:a.lenbits},x=_e(0,a.lens,0,19,a.lencode,0,a.work,E),a.lenbits=E.bits,x){t.msg="invalid code lengths set",a.mode=ze;break}a.have=0,a.mode=19;case 19:for(;a.have<a.nlen+a.ndist;){for(;z=a.lencode[h&(1<<a.lenbits)-1],b=z>>>24,g=z>>>16&255,p=65535&z,!(b<=d);){if(0===l)break t;l--,h+=i[s++]<<d,d+=8}if(p<16)h>>>=b,d-=b,a.lens[a.have++]=p;else{if(16===p){for(R=b+2;d<R;){if(0===l)break t;l--,h+=i[s++]<<d,d+=8}if(h>>>=b,d-=b,0===a.have){t.msg="invalid bit length repeat",a.mode=ze;break}y=a.lens[a.have-1],c=3+(3&h),h>>>=2,d-=2}else if(17===p){for(R=b+3;d<R;){if(0===l)break t;l--,h+=i[s++]<<d,d+=8}h>>>=b,d-=b,y=0,c=3+(7&h),h>>>=3,d-=3}else{for(R=b+7;d<R;){if(0===l)break t;l--,h+=i[s++]<<d,d+=8}h>>>=b,d-=b,y=0,c=11+(127&h),h>>>=7,d-=7}if(a.have+c>a.nlen+a.ndist){t.msg="invalid bit length repeat",a.mode=ze;break}for(;c--;)a.lens[a.have++]=y}}if(a.mode===ze)break;if(0===a.lens[256]){t.msg="invalid code -- missing end-of-block",a.mode=ze;break}if(a.lenbits=9,E={bits:a.lenbits},x=_e(1,a.lens,0,a.nlen,a.lencode,0,a.work,E),a.lenbits=E.bits,x){t.msg="invalid literal/lengths set",a.mode=ze;break}if(a.distbits=6,a.distcode=a.distdyn,E={bits:a.distbits},x=_e(2,a.lens,a.nlen,a.ndist,a.distcode,0,a.work,E),a.distbits=E.bits,x){t.msg="invalid distances set",a.mode=ze;break}if(a.mode=20,e===ue)break t;case 20:a.mode=21;case 21:if(l>=6&&o>=258){t.next_out=r,t.avail_out=o,t.next_in=s,t.avail_in=l,a.hold=h,a.bits=d,se(t,f),r=t.next_out,n=t.output,o=t.avail_out,s=t.next_in,i=t.input,l=t.avail_in,h=a.hold,d=a.bits,a.mode===xe&&(a.back=-1);break}for(a.back=0;z=a.lencode[h&(1<<a.lenbits)-1],b=z>>>24,g=z>>>16&255,p=65535&z,!(b<=d);){if(0===l)break t;l--,h+=i[s++]<<d,d+=8}if(g&&0==(240&g)){for(m=b,k=g,v=p;z=a.lencode[v+((h&(1<<m+k)-1)>>m)],b=z>>>24,g=z>>>16&255,p=65535&z,!(m+b<=d);){if(0===l)break t;l--,h+=i[s++]<<d,d+=8}h>>>=m,d-=m,a.back+=m}if(h>>>=b,d-=b,a.back+=b,a.length=p,0===g){a.mode=26;break}if(32&g){a.back=-1,a.mode=xe;break}if(64&g){t.msg="invalid literal/length code",a.mode=ze;break}a.extra=15&g,a.mode=22;case 22:if(a.extra){for(R=a.extra;d<R;){if(0===l)break t;l--,h+=i[s++]<<d,d+=8}a.length+=h&(1<<a.extra)-1,h>>>=a.extra,d-=a.extra,a.back+=a.extra}a.was=a.length,a.mode=23;case 23:for(;z=a.distcode[h&(1<<a.distbits)-1],b=z>>>24,g=z>>>16&255,p=65535&z,!(b<=d);){if(0===l)break t;l--,h+=i[s++]<<d,d+=8}if(0==(240&g)){for(m=b,k=g,v=p;z=a.distcode[v+((h&(1<<m+k)-1)>>m)],b=z>>>24,g=z>>>16&255,p=65535&z,!(m+b<=d);){if(0===l)break t;l--,h+=i[s++]<<d,d+=8}h>>>=m,d-=m,a.back+=m}if(h>>>=b,d-=b,a.back+=b,64&g){t.msg="invalid distance code",a.mode=ze;break}a.offset=p,a.extra=15&g,a.mode=24;case 24:if(a.extra){for(R=a.extra;d<R;){if(0===l)break t;l--,h+=i[s++]<<d,d+=8}a.offset+=h&(1<<a.extra)-1,h>>>=a.extra,d-=a.extra,a.back+=a.extra}if(a.offset>a.dmax){t.msg="invalid distance too far back",a.mode=ze;break}a.mode=25;case 25:if(0===o)break t;if(c=f-o,a.offset>c){if(c=a.offset-c,c>a.whave&&a.sane){t.msg="invalid distance too far back",a.mode=ze;break}c>a.wnext?(c-=a.wnext,u=a.wsize-c):u=a.wnext-c,c>a.length&&(c=a.length),w=a.window}else w=n,u=r-a.offset,c=a.length;c>o&&(c=o),o-=c,a.length-=c;do{n[r++]=w[u++]}while(--c);0===a.length&&(a.mode=21);break;case 26:if(0===o)break t;n[r++]=a.length,o--,a.mode=21;break;case 27:if(a.wrap){for(;d<32;){if(0===l)break t;l--,h|=i[s++]<<d,d+=8}if(f-=o,t.total_out+=f,a.total+=f,f&&(t.adler=a.check=a.flags?M(a.check,n,f,r-f):B(a.check,n,f,r-f)),f=o,(a.flags?h:Ae(h))!==a.check){t.msg="incorrect data check",a.mode=ze;break}h=0,d=0}a.mode=28;case 28:if(a.wrap&&a.flags){for(;d<32;){if(0===l)break t;l--,h+=i[s++]<<d,d+=8}if(h!==(4294967295&a.total)){t.msg="incorrect length check",a.mode=ze;break}h=0,d=0}a.mode=29;case 29:x=be;break t;case ze:x=me;break t;case 31:return ke;case 32:default:return pe}return t.next_out=r,t.avail_out=o,t.next_in=s,t.avail_in=l,a.hold=h,a.bits=d,(a.wsize||f!==t.avail_out&&a.mode<ze&&(a.mode<27||e!==fe))&&Fe(t,t.output,t.next_out,f-t.avail_out),_-=t.avail_in,f-=t.avail_out,t.total_in+=_,t.total_out+=f,a.total+=f,a.wrap&&f&&(t.adler=a.check=a.flags?M(a.check,n,f,t.next_out-f):B(a.check,n,f,t.next_out-f)),t.data_type=a.bits+(a.last?64:0)+(a.mode===xe?128:0)+(20===a.mode||15===a.mode?256:0),(0===_&&0===f||e===fe)&&x===we&&(x=ve),x},inflateEnd:t=>{if(!t||!t.state)return pe;let e=t.state;return e.window&&(e.window=null),t.state=null,we},inflateGetHeader:(t,e)=>{if(!t||!t.state)return pe;const a=t.state;return 0==(2&a.wrap)?pe:(a.head=e,e.done=!1,we)},inflateSetDictionary:(t,e)=>{const a=e.length;let i,n,s;return t&&t.state?(i=t.state,0!==i.wrap&&11!==i.mode?pe:11===i.mode&&(n=1,n=B(n,e,a,0),n!==i.check)?me:(s=Fe(t,e,a,a),s?(i.mode=31,ke):(i.havedict=1,we))):pe},inflateInfo:"pako inflate (from Nodeca project)"};var Ne=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Be=Object.prototype.toString,{Z_NO_FLUSH:Ce,Z_FINISH:Me,Z_OK:He,Z_STREAM_END:je,Z_NEED_DICT:Ke,Z_STREAM_ERROR:Pe,Z_DATA_ERROR:Ye,Z_MEM_ERROR:Ge}=j;function Xe(t){this.options=Bt({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Yt,this.strm.avail_out=0;let a=Le.inflateInit2(this.strm,e.windowBits);if(a!==He)throw new Error(H[a]);if(this.header=new Ne,Le.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=jt(e.dictionary):"[object ArrayBuffer]"===Be.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(a=Le.inflateSetDictionary(this.strm,e.dictionary),a!==He)))throw new Error(H[a])}function We(t,e){const a=new Xe(e);if(a.push(t),a.err)throw a.msg||H[a.err];return a.result}Xe.prototype.push=function(t,e){const a=this.strm,i=this.options.chunkSize,n=this.options.dictionary;let s,r,l;if(this.ended)return!1;for(r=e===~~e?e:!0===e?Me:Ce,"[object ArrayBuffer]"===Be.call(t)?a.input=new Uint8Array(t):a.input=t,a.next_in=0,a.avail_in=a.input.length;;){for(0===a.avail_out&&(a.output=new Uint8Array(i),a.next_out=0,a.avail_out=i),s=Le.inflate(a,r),s===Ke&&n&&(s=Le.inflateSetDictionary(a,n),s===He?s=Le.inflate(a,r):s===Ye&&(s=Ke));a.avail_in>0&&s===je&&a.state.wrap>0&&0!==t[a.next_in];)Le.inflateReset(a),s=Le.inflate(a,r);switch(s){case Pe:case Ye:case Ke:case Ge:return this.onEnd(s),this.ended=!0,!1}if(l=a.avail_out,a.next_out&&(0===a.avail_out||s===je))if("string"===this.options.to){let t=Pt(a.output,a.next_out),e=a.next_out-t,n=Kt(a.output,t);a.next_out=e,a.avail_out=i-e,e&&a.output.set(a.output.subarray(t,t+e),0),this.onData(n)}else this.onData(a.output.length===a.next_out?a.output:a.output.subarray(0,a.next_out));if(s!==He||0!==l){if(s===je)return s=Le.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(0===a.avail_in)break}}return!0},Xe.prototype.onData=function(t){this.chunks.push(t)},Xe.prototype.onEnd=function(t){t===He&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Ct(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var qe={Inflate:Xe,inflate:We,inflateRaw:function(t,e){return(e=e||{}).raw=!0,We(t,e)},ungzip:We,constants:j};const{Deflate:Je,deflate:Qe,deflateRaw:Ve,gzip:$e}=ne,{Inflate:ta,inflate:ea,inflateRaw:aa,ungzip:ia}=qe;var na=Je,sa=Qe,ra=Ve,la=$e,oa=ta,ha=ea,da=aa,_a=ia,fa=j,ca={Deflate:na,deflate:sa,deflateRaw:ra,gzip:la,Inflate:oa,inflate:ha,inflateRaw:da,ungzip:_a,constants:fa};t.Deflate=na,t.Inflate=oa,t.constants=fa,t.default=ca,t.deflate=sa,t.deflateRaw=ra,t.gzip=la,t.inflate=ha,t.inflateRaw=da,t.ungzip=_a,Object.defineProperty(t,"__esModule",{value:!0})}));</script>
<script id="script-module-svg" type="text/javascript">/*! @svgdotjs/svg.js v3.1.1 MIT*/;
/*!
* @svgdotjs/svg.js - A lightweight library for manipulating and animating SVG.
* @version 3.1.1
* https://svgjs.dev/
*
* @copyright Wout Fierens <wout@mick-wout.com>
* @license MIT
*
* BUILT: Fri Jun 25 2021 15:37:54 GMT+0200 (Mitteleuropäische Sommerzeit)
*/
var SVG=function(){"use strict";const t={},e=[];function n(e,i){if(Array.isArray(e))for(const t of e)n(t,i);else if("object"!=typeof e)r(Object.getOwnPropertyNames(i)),t[e]=Object.assign(t[e]||{},i);else for(const t in e)n(t,e[t])}function i(e){return t[e]||{}}function r(t){e.push(...t)}function s(t,e){let n;const i=t.length,r=[];for(n=0;n<i;n++)r.push(e(t[n]));return r}function o(t,e){let n;const i=t.length,r=[];for(n=0;n<i;n++)e(t[n])&&r.push(t[n]);return r}function h(t){return t%360*Math.PI/180}function u(t){return t.toLowerCase().replace(/-(.)/g,(function(t,e){return e.toUpperCase()}))}function a(t){return t.replace(/([A-Z])/g,(function(t,e){return"-"+e.toLowerCase()}))}function l(t){return t.charAt(0).toUpperCase()+t.slice(1)}function c(t,e,n,i){return null!=e&&null!=n||(i=i||t.bbox(),null==e?e=i.width/i.height*n:null==n&&(n=i.height/i.width*e)),{width:e,height:n}}function f(t,e){const n=t.origin;let i=null!=t.ox?t.ox:null!=t.originX?t.originX:"center",r=null!=t.oy?t.oy:null!=t.originY?t.originY:"center";null!=n&&([i,r]=Array.isArray(n)?n:"object"==typeof n?[n.x,n.y]:[n,n]);const s="string"==typeof i,o="string"==typeof r;if(s||o){const{height:t,width:n,x:h,y:u}=e.bbox();s&&(i=i.includes("left")?h:i.includes("right")?h+n:h+n/2),o&&(r=r.includes("top")?u:r.includes("bottom")?u+t:u+t/2)}return[i,r]}var d={__proto__:null,map:s,filter:o,radians:h,degrees:function(t){return 180*t/Math.PI%360},camelCase:u,unCamelCase:a,capitalize:l,proportionalSize:c,getOrigin:f};const m="http://www.w3.org/2000/svg",p="http://www.w3.org/1999/xhtml",y="http://www.w3.org/2000/xmlns/",w="http://www.w3.org/1999/xlink",_="http://svgjs.dev/svgjs";var g={__proto__:null,svg:m,html:p,xmlns:y,xlink:w,svgjs:_};const x={window:"undefined"==typeof window?null:window,document:"undefined"==typeof document?null:document};function b(t=null,e=null){x.window=t,x.document=e}const v={};function M(){v.window=x.window,v.document=x.document}function O(){x.window=v.window,x.document=v.document}class k{}const T={},C="___SYMBOL___ROOT___";function N(t,e=m){return x.document.createElementNS(e,t)}function S(t,e=!1){if(t instanceof k)return t;if("object"==typeof t)return D(t);if(null==t)return new T[C];if("string"==typeof t&&"<"!==t.charAt(0))return D(x.document.querySelector(t));const n=e?x.document.createElement("div"):N("svg");return n.innerHTML=t,t=D(n.firstChild),n.removeChild(n.firstChild),t}function E(t,e){return e instanceof x.window.Node?e:N(t)}function j(t){if(!t)return null;if(t.instance instanceof k)return t.instance;if("#document-fragment"===t.nodeName)return new T.Fragment(t);let e=l(t.nodeName||"Dom");return"LinearGradient"===e||"RadialGradient"===e?e="Gradient":T[e]||(e="Dom"),new T[e](t)}let D=j;function I(t,e=t.name,n=!1){return T[e]=t,n&&(T[C]=t),r(Object.getOwnPropertyNames(t.prototype)),t}function z(t){return T[t]}let R=1e3;function L(t){return"Svgjs"+l(t)+R++}function P(t){for(let e=t.children.length-1;e>=0;e--)P(t.children[e]);return t.id?(t.id=L(t.nodeName),t):t}function F(t,e){let n,i;for(i=(t=Array.isArray(t)?t:[t]).length-1;i>=0;i--)for(n in e)t[i].prototype[n]=e[n]}function q(t){return function(...e){const n=e[e.length-1];return!n||n.constructor!==Object||n instanceof Array?t.apply(this,e):t.apply(this,e.slice(0,-1)).attr(n)}}n("Dom",{siblings:function(){return this.parent().children()},position:function(){return this.parent().index(this)},next:function(){return this.siblings()[this.position()+1]},prev:function(){return this.siblings()[this.position()-1]},forward:function(){const t=this.position();return this.parent().add(this.remove(),t+1),this},backward:function(){const t=this.position();return this.parent().add(this.remove(),t?t-1:0),this},front:function(){return this.parent().add(this.remove()),this},back:function(){return this.parent().add(this.remove(),0),this},before:function(t){(t=S(t)).remove();const e=this.position();return this.parent().add(t,e),this},after:function(t){(t=S(t)).remove();const e=this.position();return this.parent().add(t,e+1),this},insertBefore:function(t){return(t=S(t)).before(this),this},insertAfter:function(t){return(t=S(t)).after(this),this}});const X=/^([+-]?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?)([a-z%]*)$/i,Y=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,B=/rgb\((\d+),(\d+),(\d+)\)/,H=/(#[a-z_][a-z0-9\-_]*)/i,V=/\)\s*,?\s*/,$=/\s/g,U=/^#[a-f0-9]{3}$|^#[a-f0-9]{6}$/i,W=/^rgb\(/,Q=/^(\s+)?$/,J=/^[+-]?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Z=/\.(jpg|jpeg|png|gif|svg)(\?[^=]+.*)?/i,K=/[\s,]+/,tt=/[MLHVCSQTAZ]/i;var et={__proto__:null,numberAndUnit:X,hex:Y,rgb:B,reference:H,transforms:V,whitespace:$,isHex:U,isRgb:W,isBlank:Q,isNumber:J,isImage:Z,delimiter:K,isPathLetter:tt};function nt(t){const e=Math.round(t),n=Math.max(0,Math.min(255,e)).toString(16);return 1===n.length?"0"+n:n}function it(t,e){for(let n=e.length;n--;)if(null==t[e[n]])return!1;return!0}function rt(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t}n("Dom",{classes:function(){const t=this.attr("class");return null==t?[]:t.trim().split(K)},hasClass:function(t){return-1!==this.classes().indexOf(t)},addClass:function(t){if(!this.hasClass(t)){const e=this.classes();e.push(t),this.attr("class",e.join(" "))}return this},removeClass:function(t){return this.hasClass(t)&&this.attr("class",this.classes().filter((function(e){return e!==t})).join(" ")),this},toggleClass:function(t){return this.hasClass(t)?this.removeClass(t):this.addClass(t)}}),n("Dom",{css:function(t,e){const n={};if(0===arguments.length)return this.node.style.cssText.split(/\s*;\s*/).filter((function(t){return!!t.length})).forEach((function(t){const e=t.split(/\s*:\s*/);n[e[0]]=e[1]})),n;if(arguments.length<2){if(Array.isArray(t)){for(const e of t){const t=u(e);n[t]=this.node.style[t]}return n}if("string"==typeof t)return this.node.style[u(t)];if("object"==typeof t)for(const e in t)this.node.style[u(e)]=null==t[e]||Q.test(t[e])?"":t[e]}return 2===arguments.length&&(this.node.style[u(t)]=null==e||Q.test(e)?"":e),this},show:function(){return this.css("display","")},hide:function(){return this.css("display","none")},visible:function(){return"none"!==this.css("display")}}),n("Dom",{data:function(t,e,n){if(null==t)return this.data(s(o(this.node.attributes,(t=>0===t.nodeName.indexOf("data-"))),(t=>t.nodeName.slice(5))));if(t instanceof Array){const e={};for(const n of t)e[n]=this.data(n);return e}if("object"==typeof t)for(e in t)this.data(e,t[e]);else if(arguments.length<2)try{return JSON.parse(this.attr("data-"+t))}catch(e){return this.attr("data-"+t)}else this.attr("data-"+t,null===e?null:!0===n||"string"==typeof e||"number"==typeof e?e:JSON.stringify(e));return this}}),n("Dom",{remember:function(t,e){if("object"==typeof arguments[0])for(const e in t)this.remember(e,t[e]);else{if(1===arguments.length)return this.memory()[t];this.memory()[t]=e}return this},forget:function(){if(0===arguments.length)this._memory={};else for(let t=arguments.length-1;t>=0;t--)delete this.memory()[arguments[t]];return this},memory:function(){return this._memory=this._memory||{}}});class st{constructor(...t){this.init(...t)}static isColor(t){return t&&(t instanceof st||this.isRgb(t)||this.test(t))}static isRgb(t){return t&&"number"==typeof t.r&&"number"==typeof t.g&&"number"==typeof t.b}static random(t="vibrant",e,n){const{random:i,round:r,sin:s,PI:o}=Math;if("vibrant"===t){const t=24*i()+57,e=38*i()+45,n=360*i();return new st(t,e,n,"lch")}if("sine"===t){const t=r(80*s(2*o*(e=null==e?i():e)/.5+.01)+150),n=r(50*s(2*o*e/.5+4.6)+200),h=r(100*s(2*o*e/.5+2.3)+150);return new st(t,n,h)}if("pastel"===t){const t=8*i()+86,e=17*i()+9,n=360*i();return new st(t,e,n,"lch")}if("dark"===t){const t=10+10*i(),e=50*i()+86,n=360*i();return new st(t,e,n,"lch")}if("rgb"===t){const t=255*i(),e=255*i(),n=255*i();return new st(t,e,n)}if("lab"===t){const t=100*i(),e=256*i()-128,n=256*i()-128;return new st(t,e,n,"lab")}if("grey"===t){const t=255*i();return new st(t,t,t)}throw new Error("Unsupported random color mode")}static test(t){return"string"==typeof t&&(U.test(t)||W.test(t))}cmyk(){const{_a:t,_b:e,_c:n}=this.rgb(),[i,r,s]=[t,e,n].map((t=>t/255)),o=Math.min(1-i,1-r,1-s);if(1===o)return new st(0,0,0,1,"cmyk");return new st((1-i-o)/(1-o),(1-r-o)/(1-o),(1-s-o)/(1-o),o,"cmyk")}hsl(){const{_a:t,_b:e,_c:n}=this.rgb(),[i,r,s]=[t,e,n].map((t=>t/255)),o=Math.max(i,r,s),h=Math.min(i,r,s),u=(o+h)/2,a=o===h,l=o-h;return new st(360*(a?0:o===i?((r-s)/l+(r<s?6:0))/6:o===r?((s-i)/l+2)/6:o===s?((i-r)/l+4)/6:0),100*(a?0:u>.5?l/(2-o-h):l/(o+h)),100*u,"hsl")}init(t=0,e=0,n=0,i=0,r="rgb"){if(t=t||0,this.space)for(const t in this.space)delete this[this.space[t]];if("number"==typeof t)r="string"==typeof i?i:r,i="string"==typeof i?0:i,Object.assign(this,{_a:t,_b:e,_c:n,_d:i,space:r});else if(t instanceof Array)this.space=e||("string"==typeof t[3]?t[3]:t[4])||"rgb",Object.assign(this,{_a:t[0],_b:t[1],_c:t[2],_d:t[3]||0});else if(t instanceof Object){const n=function(t,e){const n=it(t,"rgb")?{_a:t.r,_b:t.g,_c:t.b,_d:0,space:"rgb"}:it(t,"xyz")?{_a:t.x,_b:t.y,_c:t.z,_d:0,space:"xyz"}:it(t,"hsl")?{_a:t.h,_b:t.s,_c:t.l,_d:0,space:"hsl"}:it(t,"lab")?{_a:t.l,_b:t.a,_c:t.b,_d:0,space:"lab"}:it(t,"lch")?{_a:t.l,_b:t.c,_c:t.h,_d:0,space:"lch"}:it(t,"cmyk")?{_a:t.c,_b:t.m,_c:t.y,_d:t.k,space:"cmyk"}:{_a:0,_b:0,_c:0,space:"rgb"};return n.space=e||n.space,n}(t,e);Object.assign(this,n)}else if("string"==typeof t)if(W.test(t)){const e=t.replace($,""),[n,i,r]=B.exec(e).slice(1,4).map((t=>parseInt(t)));Object.assign(this,{_a:n,_b:i,_c:r,_d:0,space:"rgb"})}else{if(!U.test(t))throw Error("Unsupported string format, can't construct Color");{const e=t=>parseInt(t,16),[,n,i,r]=Y.exec(function(t){return 4===t.length?["#",t.substring(1,2),t.substring(1,2),t.substring(2,3),t.substring(2,3),t.substring(3,4),t.substring(3,4)].join(""):t}(t)).map(e);Object.assign(this,{_a:n,_b:i,_c:r,_d:0,space:"rgb"})}}const{_a:s,_b:o,_c:h,_d:u}=this,a="rgb"===this.space?{r:s,g:o,b:h}:"xyz"===this.space?{x:s,y:o,z:h}:"hsl"===this.space?{h:s,s:o,l:h}:"lab"===this.space?{l:s,a:o,b:h}:"lch"===this.space?{l:s,c:o,h:h}:"cmyk"===this.space?{c:s,m:o,y:h,k:u}:{};Object.assign(this,a)}lab(){const{x:t,y:e,z:n}=this.xyz();return new st(116*e-16,500*(t-e),200*(e-n),"lab")}lch(){const{l:t,a:e,b:n}=this.lab(),i=Math.sqrt(e**2+n**2);let r=180*Math.atan2(n,e)/Math.PI;r<0&&(r*=-1,r=360-r);return new st(t,i,r,"lch")}rgb(){if("rgb"===this.space)return this;if("lab"===(t=this.space)||"xyz"===t||"lch"===t){let{x:t,y:e,z:n}=this;if("lab"===this.space||"lch"===this.space){let{l:i,a:r,b:s}=this;if("lch"===this.space){const{c:t,h:e}=this,n=Math.PI/180;r=t*Math.cos(n*e),s=t*Math.sin(n*e)}const o=(i+16)/116,h=r/500+o,u=o-s/200,a=16/116,l=.008856,c=7.787;t=.95047*(h**3>l?h**3:(h-a)/c),e=1*(o**3>l?o**3:(o-a)/c),n=1.08883*(u**3>l?u**3:(u-a)/c)}const i=3.2406*t+-1.5372*e+-.4986*n,r=-.9689*t+1.8758*e+.0415*n,s=.0557*t+-.204*e+1.057*n,o=Math.pow,h=.0031308,u=i>h?1.055*o(i,1/2.4)-.055:12.92*i,a=r>h?1.055*o(r,1/2.4)-.055:12.92*r,l=s>h?1.055*o(s,1/2.4)-.055:12.92*s;return new st(255*u,255*a,255*l)}if("hsl"===this.space){let{h:t,s:e,l:n}=this;if(t/=360,e/=100,n/=100,0===e){n*=255;return new st(n,n,n)}const i=n<.5?n*(1+e):n+e-n*e,r=2*n-i,s=255*rt(r,i,t+1/3),o=255*rt(r,i,t),h=255*rt(r,i,t-1/3);return new st(s,o,h)}if("cmyk"===this.space){const{c:t,m:e,y:n,k:i}=this,r=255*(1-Math.min(1,t*(1-i)+i)),s=255*(1-Math.min(1,e*(1-i)+i)),o=255*(1-Math.min(1,n*(1-i)+i));return new st(r,s,o)}return this;var t}toArray(){const{_a:t,_b:e,_c:n,_d:i,space:r}=this;return[t,e,n,i,r]}toHex(){const[t,e,n]=this._clamped().map(nt);return`#${t}${e}${n}`}toRgb(){const[t,e,n]=this._clamped();return`rgb(${t},${e},${n})`}toString(){return this.toHex()}xyz(){const{_a:t,_b:e,_c:n}=this.rgb(),[i,r,s]=[t,e,n].map((t=>t/255)),o=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92,h=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92,u=s>.04045?Math.pow((s+.055)/1.055,2.4):s/12.92,a=(.4124*o+.3576*h+.1805*u)/.95047,l=(.2126*o+.7152*h+.0722*u)/1,c=(.0193*o+.1192*h+.9505*u)/1.08883,f=a>.008856?Math.pow(a,1/3):7.787*a+16/116,d=l>.008856?Math.pow(l,1/3):7.787*l+16/116,m=c>.008856?Math.pow(c,1/3):7.787*c+16/116;return new st(f,d,m,"xyz")}_clamped(){const{_a:t,_b:e,_c:n}=this.rgb(),{max:i,min:r,round:s}=Math;return[t,e,n].map((t=>i(0,r(s(t),255))))}}class ot{constructor(...t){this.init(...t)}clone(){return new ot(this)}init(t,e){const n=0,i=0,r=Array.isArray(t)?{x:t[0],y:t[1]}:"object"==typeof t?{x:t.x,y:t.y}:{x:t,y:e};return this.x=null==r.x?n:r.x,this.y=null==r.y?i:r.y,this}toArray(){return[this.x,this.y]}transform(t){return this.clone().transformO(t)}transformO(t){ut.isMatrixLike(t)||(t=new ut(t));const{x:e,y:n}=this;return this.x=t.a*e+t.c*n+t.e,this.y=t.b*e+t.d*n+t.f,this}}function ht(t,e,n){return Math.abs(e-t)<(n||1e-6)}class ut{constructor(...t){this.init(...t)}static formatTransforms(t){const e="both"===t.flip||!0===t.flip,n=t.flip&&(e||"x"===t.flip)?-1:1,i=t.flip&&(e||"y"===t.flip)?-1:1,r=t.skew&&t.skew.length?t.skew[0]:isFinite(t.skew)?t.skew:isFinite(t.skewX)?t.skewX:0,s=t.skew&&t.skew.length?t.skew[1]:isFinite(t.skew)?t.skew:isFinite(t.skewY)?t.skewY:0,o=t.scale&&t.scale.length?t.scale[0]*n:isFinite(t.scale)?t.scale*n:isFinite(t.scaleX)?t.scaleX*n:n,h=t.scale&&t.scale.length?t.scale[1]*i:isFinite(t.scale)?t.scale*i:isFinite(t.scaleY)?t.scaleY*i:i,u=t.shear||0,a=t.rotate||t.theta||0,l=new ot(t.origin||t.around||t.ox||t.originX,t.oy||t.originY),c=l.x,f=l.y,d=new ot(t.position||t.px||t.positionX||NaN,t.py||t.positionY||NaN),m=d.x,p=d.y,y=new ot(t.translate||t.tx||t.translateX,t.ty||t.translateY),w=y.x,_=y.y,g=new ot(t.relative||t.rx||t.relativeX,t.ry||t.relativeY);return{scaleX:o,scaleY:h,skewX:r,skewY:s,shear:u,theta:a,rx:g.x,ry:g.y,tx:w,ty:_,ox:c,oy:f,px:m,py:p}}static fromArray(t){return{a:t[0],b:t[1],c:t[2],d:t[3],e:t[4],f:t[5]}}static isMatrixLike(t){return null!=t.a||null!=t.b||null!=t.c||null!=t.d||null!=t.e||null!=t.f}static matrixMultiply(t,e,n){const i=t.a*e.a+t.c*e.b,r=t.b*e.a+t.d*e.b,s=t.a*e.c+t.c*e.d,o=t.b*e.c+t.d*e.d,h=t.e+t.a*e.e+t.c*e.f,u=t.f+t.b*e.e+t.d*e.f;return n.a=i,n.b=r,n.c=s,n.d=o,n.e=h,n.f=u,n}around(t,e,n){return this.clone().aroundO(t,e,n)}aroundO(t,e,n){const i=t||0,r=e||0;return this.translateO(-i,-r).lmultiplyO(n).translateO(i,r)}clone(){return new ut(this)}decompose(t=0,e=0){const n=this.a,i=this.b,r=this.c,s=this.d,o=this.e,h=this.f,u=n*s-i*r,a=u>0?1:-1,l=a*Math.sqrt(n*n+i*i),c=Math.atan2(a*i,a*n),f=180/Math.PI*c,d=Math.cos(c),m=Math.sin(c),p=(n*r+i*s)/u,y=r*l/(p*n-i)||s*l/(p*i+n);return{scaleX:l,scaleY:y,shear:p,rotate:f,translateX:o-t+t*d*l+e*(p*d*l-m*y),translateY:h-e+t*m*l+e*(p*m*l+d*y),originX:t,originY:e,a:this.a,b:this.b,c:this.c,d:this.d,e:this.e,f:this.f}}equals(t){if(t===this)return!0;const e=new ut(t);return ht(this.a,e.a)&&ht(this.b,e.b)&&ht(this.c,e.c)&&ht(this.d,e.d)&&ht(this.e,e.e)&&ht(this.f,e.f)}flip(t,e){return this.clone().flipO(t,e)}flipO(t,e){return"x"===t?this.scaleO(-1,1,e,0):"y"===t?this.scaleO(1,-1,0,e):this.scaleO(-1,-1,t,e||t)}init(t){const e=ut.fromArray([1,0,0,1,0,0]);return t=t instanceof Element?t.matrixify():"string"==typeof t?ut.fromArray(t.split(K).map(parseFloat)):Array.isArray(t)?ut.fromArray(t):"object"==typeof t&&ut.isMatrixLike(t)?t:"object"==typeof t?(new ut).transform(t):6===arguments.length?ut.fromArray([].slice.call(arguments)):e,this.a=null!=t.a?t.a:e.a,this.b=null!=t.b?t.b:e.b,this.c=null!=t.c?t.c:e.c,this.d=null!=t.d?t.d:e.d,this.e=null!=t.e?t.e:e.e,this.f=null!=t.f?t.f:e.f,this}inverse(){return this.clone().inverseO()}inverseO(){const t=this.a,e=this.b,n=this.c,i=this.d,r=this.e,s=this.f,o=t*i-e*n;if(!o)throw new Error("Cannot invert "+this);const h=i/o,u=-e/o,a=-n/o,l=t/o,c=-(h*r+a*s),f=-(u*r+l*s);return this.a=h,this.b=u,this.c=a,this.d=l,this.e=c,this.f=f,this}lmultiply(t){return this.clone().lmultiplyO(t)}lmultiplyO(t){const e=t instanceof ut?t:new ut(t);return ut.matrixMultiply(e,this,this)}multiply(t){return this.clone().multiplyO(t)}multiplyO(t){const e=t instanceof ut?t:new ut(t);return ut.matrixMultiply(this,e,this)}rotate(t,e,n){return this.clone().rotateO(t,e,n)}rotateO(t,e=0,n=0){t=h(t);const i=Math.cos(t),r=Math.sin(t),{a:s,b:o,c:u,d:a,e:l,f:c}=this;return this.a=s*i-o*r,this.b=o*i+s*r,this.c=u*i-a*r,this.d=a*i+u*r,this.e=l*i-c*r+n*r-e*i+e,this.f=c*i+l*r-e*r-n*i+n,this}scale(t,e,n,i){return this.clone().scaleO(...arguments)}scaleO(t,e=t,n=0,i=0){3===arguments.length&&(i=n,n=e,e=t);const{a:r,b:s,c:o,d:h,e:u,f:a}=this;return this.a=r*t,this.b=s*e,this.c=o*t,this.d=h*e,this.e=u*t-n*t+n,this.f=a*e-i*e+i,this}shear(t,e,n){return this.clone().shearO(t,e,n)}shearO(t,e=0,n=0){const{a:i,b:r,c:s,d:o,e:h,f:u}=this;return this.a=i+r*t,this.c=s+o*t,this.e=h+u*t-n*t,this}skew(t,e,n,i){return this.clone().skewO(...arguments)}skewO(t,e=t,n=0,i=0){3===arguments.length&&(i=n,n=e,e=t),t=h(t),e=h(e);const r=Math.tan(t),s=Math.tan(e),{a:o,b:u,c:a,d:l,e:c,f:f}=this;return this.a=o+u*r,this.b=u+o*s,this.c=a+l*r,this.d=l+a*s,this.e=c+f*r-i*r,this.f=f+c*s-n*s,this}skewX(t,e,n){return this.skew(t,0,e,n)}skewY(t,e,n){return this.skew(0,t,e,n)}toArray(){return[this.a,this.b,this.c,this.d,this.e,this.f]}toString(){return"matrix("+this.a+","+this.b+","+this.c+","+this.d+","+this.e+","+this.f+")"}transform(t){if(ut.isMatrixLike(t)){return new ut(t).multiplyO(this)}const e=ut.formatTransforms(t),{x:n,y:i}=new ot(e.ox,e.oy).transform(this),r=(new ut).translateO(e.rx,e.ry).lmultiplyO(this).translateO(-n,-i).scaleO(e.scaleX,e.scaleY).skewO(e.skewX,e.skewY).shearO(e.shear).rotateO(e.theta).translateO(n,i);if(isFinite(e.px)||isFinite(e.py)){const t=new ot(n,i).transform(r),s=isFinite(e.px)?e.px-t.x:0,o=isFinite(e.py)?e.py-t.y:0;r.translateO(s,o)}return r.translateO(e.tx,e.ty),r}translate(t,e){return this.clone().translateO(t,e)}translateO(t,e){return this.e+=t||0,this.f+=e||0,this}valueOf(){return{a:this.a,b:this.b,c:this.c,d:this.d,e:this.e,f:this.f}}}function at(){if(!at.nodes){const t=S().size(2,0);t.node.style.cssText=["opacity: 0","position: absolute","left: -100%","top: -100%","overflow: hidden"].join(";"),t.attr("focusable","false"),t.attr("aria-hidden","true");const e=t.path().node;at.nodes={svg:t,path:e}}if(!at.nodes.svg.node.parentNode){const t=x.document.body||x.document.documentElement;at.nodes.svg.addTo(t)}return at.nodes}function lt(t){return!(t.width||t.height||t.x||t.y)}I(ut,"Matrix");class ct{constructor(...t){this.init(...t)}addOffset(){return this.x+=x.window.pageXOffset,this.y+=x.window.pageYOffset,new ct(this)}init(t){return t="string"==typeof t?t.split(K).map(parseFloat):Array.isArray(t)?t:"object"==typeof t?[null!=t.left?t.left:t.x,null!=t.top?t.top:t.y,t.width,t.height]:4===arguments.length?[].slice.call(arguments):[0,0,0,0],this.x=t[0]||0,this.y=t[1]||0,this.width=this.w=t[2]||0,this.height=this.h=t[3]||0,this.x2=this.x+this.w,this.y2=this.y+this.h,this.cx=this.x+this.w/2,this.cy=this.y+this.h/2,this}isNulled(){return lt(this)}merge(t){const e=Math.min(this.x,t.x),n=Math.min(this.y,t.y),i=Math.max(this.x+this.width,t.x+t.width)-e,r=Math.max(this.y+this.height,t.y+t.height)-n;return new ct(e,n,i,r)}toArray(){return[this.x,this.y,this.width,this.height]}toString(){return this.x+" "+this.y+" "+this.width+" "+this.height}transform(t){t instanceof ut||(t=new ut(t));let e=1/0,n=-1/0,i=1/0,r=-1/0;return[new ot(this.x,this.y),new ot(this.x2,this.y),new ot(this.x,this.y2),new ot(this.x2,this.y2)].forEach((function(s){s=s.transform(t),e=Math.min(e,s.x),n=Math.max(n,s.x),i=Math.min(i,s.y),r=Math.max(r,s.y)})),new ct(e,i,n-e,r-i)}}function ft(t,e,n){let i;try{if(i=e(t.node),lt(i)&&((r=t.node)!==x.document&&!(x.document.documentElement.contains||function(t){for(;t.parentNode;)t=t.parentNode;return t===x.document}).call(x.document.documentElement,r)))throw new Error("Element not in the dom")}catch(e){i=n(t)}var r;return i}n({viewbox:{viewbox(t,e,n,i){return null==t?new ct(this.attr("viewBox")):this.attr("viewBox",new ct(t,e,n,i))},zoom(t,e){let{width:n,height:i}=this.attr(["width","height"]);if((n||i)&&"string"!=typeof n&&"string"!=typeof i||(n=this.node.clientWidth,i=this.node.clientHeight),!n||!i)throw new Error("Impossible to get absolute width and height. Please provide an absolute width and height attribute on the zooming element");const r=this.viewbox(),s=n/r.width,o=i/r.height,h=Math.min(s,o);if(null==t)return h;let u=h/t;u===1/0&&(u=Number.MAX_SAFE_INTEGER/100),e=e||new ot(n/2/s+r.x,i/2/o+r.y);const a=new ct(r).transform(new ut({scale:u,origin:e}));return this.viewbox(a)}}}),I(ct,"Box");class dt extends Array{constructor(t=[],...e){if(super(t,...e),"number"==typeof t)return this;this.length=0,this.push(...t)}}F([dt],{each(t,...e){return"function"==typeof t?this.map(((e,n,i)=>t.call(e,e,n,i))):this.map((n=>n[t](...e)))},toArray(){return Array.prototype.concat.apply([],this)}});const mt=["toArray","constructor","each"];function pt(t,e){return new dt(s((e||x.document).querySelectorAll(t),(function(t){return j(t)})))}dt.extend=function(t){t=t.reduce(((t,e)=>(mt.includes(e)||"_"===e[0]||(t[e]=function(...t){return this.each(e,...t)}),t)),{}),F([dt],t)};let yt=0;const wt={};function _t(t){let e=t.getEventHolder();return e===x.window&&(e=wt),e.events||(e.events={}),e.events}function gt(t){return t.getEventTarget()}function xt(t){let e=t.getEventHolder();e===x.window&&(e=wt),e.events&&(e.events={})}function bt(t,e,n,i,r){const s=n.bind(i||t),o=S(t),h=_t(o),u=gt(o);e=Array.isArray(e)?e:e.split(K),n._svgjsListenerId||(n._svgjsListenerId=++yt),e.forEach((function(t){const e=t.split(".")[0],i=t.split(".")[1]||"*";h[e]=h[e]||{},h[e][i]=h[e][i]||{},h[e][i][n._svgjsListenerId]=s,u.addEventListener(e,s,r||!1)}))}function vt(t,e,n,i){const r=S(t),s=_t(r),o=gt(r);("function"!=typeof n||(n=n._svgjsListenerId))&&(e=Array.isArray(e)?e:(e||"").split(K)).forEach((function(t){const e=t&&t.split(".")[0],h=t&&t.split(".")[1];let u,a;if(n)s[e]&&s[e][h||"*"]&&(o.removeEventListener(e,s[e][h||"*"][n],i||!1),delete s[e][h||"*"][n]);else if(e&&h){if(s[e]&&s[e][h]){for(a in s[e][h])vt(o,[e,h].join("."),a);delete s[e][h]}}else if(h)for(t in s)for(u in s[t])h===u&&vt(o,[t,h].join("."));else if(e){if(s[e]){for(u in s[e])vt(o,[e,u].join("."));delete s[e]}}else{for(t in s)vt(o,t);xt(r)}}))}function Mt(t,e,n,i){const r=gt(t);return e instanceof x.window.Event||(e=new x.window.CustomEvent(e,{detail:n,cancelable:!0,...i})),r.dispatchEvent(e),e}class Ot extends k{addEventListener(){}dispatch(t,e,n){return Mt(this,t,e,n)}dispatchEvent(t){const e=this.getEventHolder().events;if(!e)return!0;const n=e[t.type];for(const e in n)for(const i in n[e])n[e][i](t);return!t.defaultPrevented}fire(t,e,n){return this.dispatch(t,e,n),this}getEventHolder(){return this}getEventTarget(){return this}off(t,e){return vt(this,t,e),this}on(t,e,n,i){return bt(this,t,e,n,i),this}removeEventListener(){}}function At(){}I(Ot,"EventTarget");const kt={duration:400,ease:">",delay:0},Tt={"fill-opacity":1,"stroke-opacity":1,"stroke-width":0,"stroke-linejoin":"miter","stroke-linecap":"butt",fill:"#000000",stroke:"#000000",opacity:1,x:0,y:0,cx:0,cy:0,width:0,height:0,r:0,rx:0,ry:0,offset:0,"stop-opacity":1,"stop-color":"#000000","text-anchor":"start"};var Ct={__proto__:null,noop:At,timeline:kt,attrs:Tt};class Nt extends Array{constructor(...t){super(...t),this.init(...t)}clone(){return new this.constructor(this)}init(t){return"number"==typeof t||(this.length=0,this.push(...this.parse(t))),this}parse(t=[]){return t instanceof Array?t:t.trim().split(K).map(parseFloat)}toArray(){return Array.prototype.concat.apply([],this)}toSet(){return new Set(this)}toString(){return this.join(" ")}valueOf(){const t=[];return t.push(...this),t}}class St{constructor(...t){this.init(...t)}convert(t){return new St(this.value,t)}divide(t){return t=new St(t),new St(this/t,this.unit||t.unit)}init(t,e){return e=Array.isArray(t)?t[1]:e,t=Array.isArray(t)?t[0]:t,this.value=0,this.unit=e||"","number"==typeof t?this.value=isNaN(t)?0:isFinite(t)?t:t<0?-34e37:34e37:"string"==typeof t?(e=t.match(X))&&(this.value=parseFloat(e[1]),"%"===e[5]?this.value/=100:"s"===e[5]&&(this.value*=1e3),this.unit=e[5]):t instanceof St&&(this.value=t.valueOf(),this.unit=t.unit),this}minus(t){return t=new St(t),new St(this-t,this.unit||t.unit)}plus(t){return t=new St(t),new St(this+t,this.unit||t.unit)}times(t){return t=new St(t),new St(this*t,this.unit||t.unit)}toArray(){return[this.value,this.unit]}toJSON(){return this.toString()}toString(){return("%"===this.unit?~~(1e8*this.value)/1e6:"s"===this.unit?this.value/1e3:this.value)+this.unit}valueOf(){return this.value}}const Et=[];class Dom extends Ot{constructor(t,e){super(),this.node=t,this.type=t.nodeName,e&&t!==e&&this.attr(e)}add(t,e){return(t=S(t)).removeNamespace&&this.node instanceof x.window.SVGElement&&t.removeNamespace(),null==e?this.node.appendChild(t.node):t.node!==this.node.childNodes[e]&&this.node.insertBefore(t.node,this.node.childNodes[e]),this}addTo(t,e){return S(t).put(this,e)}children(){return new dt(s(this.node.children,(function(t){return j(t)})))}clear(){for(;this.node.hasChildNodes();)this.node.removeChild(this.node.lastChild);return this}clone(t=!0){return this.writeDataToDom(),new this.constructor(P(this.node.cloneNode(t)))}each(t,e){const n=this.children();let i,r;for(i=0,r=n.length;i<r;i++)t.apply(n[i],[i,n]),e&&n[i].each(t,e);return this}element(t,e){return this.put(new Dom(N(t),e))}first(){return j(this.node.firstChild)}get(t){return j(this.node.childNodes[t])}getEventHolder(){return this.node}getEventTarget(){return this.node}has(t){return this.index(t)>=0}html(t,e){return this.xml(t,e,p)}id(t){return void 0!==t||this.node.id||(this.node.id=L(this.type)),this.attr("id",t)}index(t){return[].slice.call(this.node.childNodes).indexOf(t.node)}last(){return j(this.node.lastChild)}matches(t){const e=this.node,n=e.matches||e.matchesSelector||e.msMatchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.oMatchesSelector||null;return n&&n.call(e,t)}parent(t){let e=this;if(!e.node.parentNode)return null;if(e=j(e.node.parentNode),!t)return e;do{if("string"==typeof t?e.matches(t):e instanceof t)return e}while(e=j(e.node.parentNode));return e}put(t,e){return t=S(t),this.add(t,e),t}putIn(t,e){return S(t).add(this,e)}remove(){return this.parent()&&this.parent().removeElement(this),this}removeElement(t){return this.node.removeChild(t.node),this}replace(t){return t=S(t),this.node.parentNode&&this.node.parentNode.replaceChild(t.node,this.node),t}round(t=2,e=null){const n=10**t,i=this.attr(e);for(const t in i)"number"==typeof i[t]&&(i[t]=Math.round(i[t]*n)/n);return this.attr(i),this}svg(t,e){return this.xml(t,e,m)}toString(){return this.id()}words(t){return this.node.textContent=t,this}wrap(t){const e=this.parent();if(!e)return this.addTo(t);const n=e.index(this);return e.put(t,n).put(this)}writeDataToDom(){return this.each((function(){this.writeDataToDom()})),this}xml(t,e,n){if("boolean"==typeof t&&(n=e,e=t,t=null),null==t||"function"==typeof t){e=null==e||e,this.writeDataToDom();let n=this;if(null!=t){if(n=j(n.node.cloneNode(!0)),e){const e=t(n);if(n=e||n,!1===e)return""}n.each((function(){const e=t(this),n=e||this;!1===e?this.remove():e&&this!==n&&this.replace(n)}),!0)}return e?n.node.outerHTML:n.node.innerHTML}e=null!=e&&e;const i=N("wrapper",n),r=x.document.createDocumentFragment();i.innerHTML=t;for(let t=i.children.length;t--;)r.appendChild(i.firstElementChild);const s=this.parent();return e?this.replace(r)&&s:this.add(r)}}F(Dom,{attr:function(t,e,n){if(null==t){t={},e=this.node.attributes;for(const n of e)t[n.nodeName]=J.test(n.nodeValue)?parseFloat(n.nodeValue):n.nodeValue;return t}if(t instanceof Array)return t.reduce(((t,e)=>(t[e]=this.attr(e),t)),{});if("object"==typeof t&&t.constructor===Object)for(e in t)this.attr(e,t[e]);else if(null===e)this.node.removeAttribute(t);else{if(null==e)return null==(e=this.node.getAttribute(t))?Tt[t]:J.test(e)?parseFloat(e):e;"number"==typeof(e=Et.reduce(((e,n)=>n(t,e,this)),e))?e=new St(e):st.isColor(e)?e=new st(e):e.constructor===Array&&(e=new Nt(e)),"leading"===t?this.leading&&this.leading(e):"string"==typeof n?this.node.setAttributeNS(n,t,e.toString()):this.node.setAttribute(t,e.toString()),!this.rebuild||"font-size"!==t&&"x"!==t||this.rebuild()}return this},find:function(t){return pt(t,this.node)},findOne:function(t){return j(this.node.querySelector(t))}}),I(Dom,"Dom");class Element extends Dom{constructor(t,e){super(t,e),this.dom={},this.node.instance=this,t.hasAttribute("svgjs:data")&&this.setData(JSON.parse(t.getAttribute("svgjs:data"))||{})}center(t,e){return this.cx(t).cy(e)}cx(t){return null==t?this.x()+this.width()/2:this.x(t-this.width()/2)}cy(t){return null==t?this.y()+this.height()/2:this.y(t-this.height()/2)}defs(){const t=this.root();return t&&t.defs()}dmove(t,e){return this.dx(t).dy(e)}dx(t=0){return this.x(new St(t).plus(this.x()))}dy(t=0){return this.y(new St(t).plus(this.y()))}getEventHolder(){return this}height(t){return this.attr("height",t)}move(t,e){return this.x(t).y(e)}parents(t=this.root()){t=S(t);const e=new dt;let n=this;for(;(n=n.parent())&&n.node!==x.document&&"#document-fragment"!==n.nodeName&&(e.push(n),n.node!==t.node););return e}reference(t){if(!(t=this.attr(t)))return null;const e=(t+"").match(H);return e?S(e[1]):null}root(){const t=this.parent(z(C));return t&&t.root()}setData(t){return this.dom=t,this}size(t,e){const n=c(this,t,e);return this.width(new St(n.width)).height(new St(n.height))}width(t){return this.attr("width",t)}writeDataToDom(){return this.node.removeAttribute("svgjs:data"),Object.keys(this.dom).length&&this.node.setAttribute("svgjs:data",JSON.stringify(this.dom)),super.writeDataToDom()}x(t){return this.attr("x",t)}y(t){return this.attr("y",t)}}F(Element,{bbox:function(){const t=ft(this,(t=>t.getBBox()),(t=>{try{const e=t.clone().addTo(at().svg).show(),n=e.node.getBBox();return e.remove(),n}catch(e){throw new Error(`Getting bbox of element "${t.node.nodeName}" is not possible: ${e.toString()}`)}}));return new ct(t)},rbox:function(t){const e=ft(this,(t=>t.getBoundingClientRect()),(t=>{throw new Error(`Getting rbox of element "${t.node.nodeName}" is not possible`)})),n=new ct(e);return t?n.transform(t.screenCTM().inverseO()):n.addOffset()},inside:function(t,e){const n=this.bbox();return t>n.x&&e>n.y&&t<n.x+n.width&&e<n.y+n.height},point:function(t,e){return new ot(t,e).transform(this.screenCTM().inverse())},ctm:function(){return new ut(this.node.getCTM())},screenCTM:function(){if("function"==typeof this.isRoot&&!this.isRoot()){const t=this.rect(1,1),e=t.node.getScreenCTM();return t.remove(),new ut(e)}return new ut(this.node.getScreenCTM())}}),I(Element,"Element");const jt={stroke:["color","width","opacity","linecap","linejoin","miterlimit","dasharray","dashoffset"],fill:["color","opacity","rule"],prefix:function(t,e){return"color"===e?t:t+"-"+e}};["fill","stroke"].forEach((function(t){const e={};let i;e[t]=function(e){if(void 0===e)return this.attr(t);if("string"==typeof e||e instanceof st||st.isRgb(e)||e instanceof Element)this.attr(t,e);else for(i=jt[t].length-1;i>=0;i--)null!=e[jt[t][i]]&&this.attr(jt.prefix(t,jt[t][i]),e[jt[t][i]]);return this},n(["Element","Runner"],e)})),n(["Element","Runner"],{matrix:function(t,e,n,i,r,s){return null==t?new ut(this):this.attr("transform",new ut(t,e,n,i,r,s))},rotate:function(t,e,n){return this.transform({rotate:t,ox:e,oy:n},!0)},skew:function(t,e,n,i){return 1===arguments.length||3===arguments.length?this.transform({skew:t,ox:e,oy:n},!0):this.transform({skew:[t,e],ox:n,oy:i},!0)},shear:function(t,e,n){return this.transform({shear:t,ox:e,oy:n},!0)},scale:function(t,e,n,i){return 1===arguments.length||3===arguments.length?this.transform({scale:t,ox:e,oy:n},!0):this.transform({scale:[t,e],ox:n,oy:i},!0)},translate:function(t,e){return this.transform({translate:[t,e]},!0)},relative:function(t,e){return this.transform({relative:[t,e]},!0)},flip:function(t="both",e="center"){return-1==="xybothtrue".indexOf(t)&&(e=t,t="both"),this.transform({flip:t,origin:e},!0)},opacity:function(t){return this.attr("opacity",t)}}),n("radius",{radius:function(t,e=t){return"radialGradient"===(this._element||this).type?this.attr("r",new St(t)):this.rx(t).ry(e)}}),n("Path",{length:function(){return this.node.getTotalLength()},pointAt:function(t){return new ot(this.node.getPointAtLength(t))}}),n(["Element","Runner"],{font:function(t,e){if("object"==typeof t){for(e in t)this.font(e,t[e]);return this}return"leading"===t?this.leading(e):"anchor"===t?this.attr("text-anchor",e):"size"===t||"family"===t||"weight"===t||"stretch"===t||"variant"===t||"style"===t?this.attr("font-"+t,e):this.attr(t,e)}});n("Element",["click","dblclick","mousedown","mouseup","mouseover","mouseout","mousemove","mouseenter","mouseleave","touchstart","touchmove","touchleave","touchend","touchcancel"].reduce((function(t,e){return t[e]=function(t){return null===t?this.off(e):this.on(e,t),this},t}),{})),n("Element",{untransform:function(){return this.attr("transform",null)},matrixify:function(){return(this.attr("transform")||"").split(V).slice(0,-1).map((function(t){const e=t.trim().split("(");return[e[0],e[1].split(K).map((function(t){return parseFloat(t)}))]})).reverse().reduce((function(t,e){return"matrix"===e[0]?t.lmultiply(ut.fromArray(e[1])):t[e[0]].apply(t,e[1])}),new ut)},toParent:function(t,e){if(this===t)return this;const n=this.screenCTM(),i=t.screenCTM().inverse();return this.addTo(t,e).untransform().transform(i.multiply(n)),this},toRoot:function(t){return this.toParent(this.root(),t)},transform:function(t,e){if(null==t||"string"==typeof t){const e=new ut(this).decompose();return null==t?e:e[t]}ut.isMatrixLike(t)||(t={...t,origin:f(t,this)});const n=new ut(!0===e?this:e||!1).transform(t);return this.attr("transform",n)}});class Container extends Element{flatten(t=this,e){return this.each((function(){if(this instanceof Container)return this.flatten().ungroup()})),this}ungroup(t=this.parent(),e=t.index(this)){return e=-1===e?t.children().length:e,this.each((function(n,i){return i[i.length-n-1].toParent(t,e)})),this.remove()}}I(Container,"Container");class Defs extends Container{constructor(t,e=t){super(E("defs",t),e)}flatten(){return this}ungroup(){return this}}I(Defs,"Defs");class Shape extends Element{}function Dt(t){return this.attr("rx",t)}function It(t){return this.attr("ry",t)}function zt(t){return null==t?this.cx()-this.rx():this.cx(t+this.rx())}function Rt(t){return null==t?this.cy()-this.ry():this.cy(t+this.ry())}function Lt(t){return this.attr("cx",t)}function Pt(t){return this.attr("cy",t)}function Ft(t){return null==t?2*this.rx():this.rx(new St(t).divide(2))}function qt(t){return null==t?2*this.ry():this.ry(new St(t).divide(2))}I(Shape,"Shape");var Xt={__proto__:null,rx:Dt,ry:It,x:zt,y:Rt,cx:Lt,cy:Pt,width:Ft,height:qt};class Ellipse extends Shape{constructor(t,e=t){super(E("ellipse",t),e)}size(t,e){const n=c(this,t,e);return this.rx(new St(n.width).divide(2)).ry(new St(n.height).divide(2))}}F(Ellipse,Xt),n("Container",{ellipse:q((function(t=0,e=t){return this.put(new Ellipse).size(t,e).move(0,0)}))}),I(Ellipse,"Ellipse");class Yt extends Dom{constructor(t=x.document.createDocumentFragment()){super(t)}xml(t,e,n){if("boolean"==typeof t&&(n=e,e=t,t=null),null==t||"function"==typeof t){const t=new Dom(N("wrapper",n));return t.add(this.node.cloneNode(!0)),t.xml(!1,n)}return super.xml(t,!1,n)}}function Bt(t,e){return"radialGradient"===(this._element||this).type?this.attr({fx:new St(t),fy:new St(e)}):this.attr({x1:new St(t),y1:new St(e)})}function Ht(t,e){return"radialGradient"===(this._element||this).type?this.attr({cx:new St(t),cy:new St(e)}):this.attr({x2:new St(t),y2:new St(e)})}I(Yt,"Fragment");var Gt,Vt={__proto__:null,from:Bt,to:Ht};class Gradient extends Container{constructor(t,e){super(E(t+"Gradient","string"==typeof t?null:t),e)}attr(t,e,n){return"transform"===t&&(t="gradientTransform"),super.attr(t,e,n)}bbox(){return new ct}targets(){return pt('svg [fill*="'+this.id()+'"]')}toString(){return this.url()}update(t){return this.clear(),"function"==typeof t&&t.call(this,this),this}url(){return'url("#'+this.id()+'")'}}F(Gradient,Vt),n({Container:{gradient(...t){return this.defs().gradient(...t)}},Defs:{gradient:q((function(t,e){return this.put(new Gradient(t)).update(e)}))}}),I(Gradient,"Gradient");class Pattern extends Container{constructor(t,e=t){super(E("pattern",t),e)}attr(t,e,n){return"transform"===t&&(t="patternTransform"),super.attr(t,e,n)}bbox(){return new ct}targets(){return pt('svg [fill*="'+this.id()+'"]')}toString(){return this.url()}update(t){return this.clear(),"function"==typeof t&&t.call(this,this),this}url(){return'url("#'+this.id()+'")'}}n({Container:{pattern(...t){return this.defs().pattern(...t)}},Defs:{pattern:q((function(t,e,n){return this.put(new Pattern).update(n).attr({x:0,y:0,width:t,height:e,patternUnits:"userSpaceOnUse"})}))}}),I(Pattern,"Pattern");class Image extends Shape{constructor(t,e=t){super(E("image",t),e)}load(t,e){if(!t)return this;const n=new x.window.Image;return bt(n,"load",(function(t){const i=this.parent(Pattern);0===this.width()&&0===this.height()&&this.size(n.width,n.height),i instanceof Pattern&&0===i.width()&&0===i.height()&&i.size(this.width(),this.height()),"function"==typeof e&&e.call(this,t)}),this),bt(n,"load error",(function(){vt(n)})),this.attr("href",n.src=t,w)}}Gt=function(t,e,n){return"fill"!==t&&"stroke"!==t||Z.test(e)&&(e=n.root().defs().image(e)),e instanceof Image&&(e=n.root().defs().pattern(0,0,(t=>{t.add(e)}))),e},Et.push(Gt),n({Container:{image:q((function(t,e){return this.put(new Image).size(0,0).load(t,e)}))}}),I(Image,"Image");class $t extends Nt{bbox(){let t=-1/0,e=-1/0,n=1/0,i=1/0;return this.forEach((function(r){t=Math.max(r[0],t),e=Math.max(r[1],e),n=Math.min(r[0],n),i=Math.min(r[1],i)})),new ct(n,i,t-n,e-i)}move(t,e){const n=this.bbox();if(t-=n.x,e-=n.y,!isNaN(t)&&!isNaN(e))for(let n=this.length-1;n>=0;n--)this[n]=[this[n][0]+t,this[n][1]+e];return this}parse(t=[0,0]){const e=[];(t=t instanceof Array?Array.prototype.concat.apply([],t):t.trim().split(K).map(parseFloat)).length%2!=0&&t.pop();for(let n=0,i=t.length;n<i;n+=2)e.push([t[n],t[n+1]]);return e}size(t,e){let n;const i=this.bbox();for(n=this.length-1;n>=0;n--)i.width&&(this[n][0]=(this[n][0]-i.x)*t/i.width+i.x),i.height&&(this[n][1]=(this[n][1]-i.y)*e/i.height+i.y);return this}toLine(){return{x1:this[0][0],y1:this[0][1],x2:this[1][0],y2:this[1][1]}}toString(){const t=[];for(let e=0,n=this.length;e<n;e++)t.push(this[e].join(","));return t.join(" ")}transform(t){return this.clone().transformO(t)}transformO(t){ut.isMatrixLike(t)||(t=new ut(t));for(let e=this.length;e--;){const[n,i]=this[e];this[e][0]=t.a*n+t.c*i+t.e,this[e][1]=t.b*n+t.d*i+t.f}return this}}var Ut={__proto__:null,MorphArray:$t,x:function(t){return null==t?this.bbox().x:this.move(t,this.bbox().y)},y:function(t){return null==t?this.bbox().y:this.move(this.bbox().x,t)},width:function(t){const e=this.bbox();return null==t?e.width:this.size(t,e.height)},height:function(t){const e=this.bbox();return null==t?e.height:this.size(e.width,t)}};class Line extends Shape{constructor(t,e=t){super(E("line",t),e)}array(){return new $t([[this.attr("x1"),this.attr("y1")],[this.attr("x2"),this.attr("y2")]])}move(t,e){return this.attr(this.array().move(t,e).toLine())}plot(t,e,n,i){return null==t?this.array():(t=void 0!==e?{x1:t,y1:e,x2:n,y2:i}:new $t(t).toLine(),this.attr(t))}size(t,e){const n=c(this,t,e);return this.attr(this.array().size(n.width,n.height).toLine())}}F(Line,Ut),n({Container:{line:q((function(...t){return Line.prototype.plot.apply(this.put(new Line),null!=t[0]?t:[0,0,0,0])}))}}),I(Line,"Line");class Marker extends Container{constructor(t,e=t){super(E("marker",t),e)}height(t){return this.attr("markerHeight",t)}orient(t){return this.attr("orient",t)}ref(t,e){return this.attr("refX",t).attr("refY",e)}toString(){return"url(#"+this.id()+")"}update(t){return this.clear(),"function"==typeof t&&t.call(this,this),this}width(t){return this.attr("markerWidth",t)}}function Wt(t,e){return function(n){return null==n?this[t]:(this[t]=n,e&&e.call(this),this)}}n({Container:{marker(...t){return this.defs().marker(...t)}},Defs:{marker:q((function(t,e,n){return this.put(new Marker).size(t,e).ref(t/2,e/2).viewbox(0,0,t,e).attr("orient","auto").update(n)}))},marker:{marker(t,e,n,i){let r=["marker"];return"all"!==t&&r.push(t),r=r.join("-"),t=arguments[1]instanceof Marker?arguments[1]:this.defs().marker(e,n,i),this.attr(r,t)}}}),I(Marker,"Marker");const Qt={"-":function(t){return t},"<>":function(t){return-Math.cos(t*Math.PI)/2+.5},">":function(t){return Math.sin(t*Math.PI/2)},"<":function(t){return 1-Math.cos(t*Math.PI/2)},bezier:function(t,e,n,i){return function(r){return r<0?t>0?e/t*r:n>0?i/n*r:0:r>1?n<1?(1-i)/(1-n)*r+(i-n)/(1-n):t<1?(1-e)/(1-t)*r+(e-t)/(1-t):1:3*r*(1-r)**2*e+3*r**2*(1-r)*i+r**3}},steps:function(t,e="end"){e=e.split("-").reverse()[0];let n=t;return"none"===e?--n:"both"===e&&++n,(i,r=!1)=>{let s=Math.floor(i*t);const o=i*s%1==0;return"start"!==e&&"both"!==e||++s,r&&o&&--s,i>=0&&s<0&&(s=0),i<=1&&s>n&&(s=n),s/n}}};class Jt{done(){return!1}}class Zt extends Jt{constructor(t=kt.ease){super(),this.ease=Qt[t]||t}step(t,e,n){return"number"!=typeof t?n<1?t:e:t+(e-t)*this.ease(n)}}class Kt extends Jt{constructor(t){super(),this.stepper=t}done(t){return t.done}step(t,e,n,i){return this.stepper(t,e,n,i)}}function te(){const t=(this._duration||500)/1e3,e=this._overshoot||0,n=Math.PI,i=Math.log(e/100+1e-10),r=-i/Math.sqrt(n*n+i*i),s=3.9/(r*t);this.d=2*r*s,this.k=s*s}class ee extends Kt{constructor(t=500,e=0){super(),this.duration(t).overshoot(e)}step(t,e,n,i){if("string"==typeof t)return t;if(i.done=n===1/0,n===1/0)return e;if(0===n)return t;n>100&&(n=16),n/=1e3;const r=i.velocity||0,s=-this.d*r-this.k*(t-e),o=t+r*n+s*n*n/2;return i.velocity=r+s*n,i.done=Math.abs(e-o)+Math.abs(r)<.002,i.done?e:o}}F(ee,{duration:Wt("_duration",te),overshoot:Wt("_overshoot",te)});class ne extends Kt{constructor(t=.1,e=.01,n=0,i=1e3){super(),this.p(t).i(e).d(n).windup(i)}step(t,e,n,i){if("string"==typeof t)return t;if(i.done=n===1/0,n===1/0)return e;if(0===n)return t;const r=e-t;let s=(i.integral||0)+r*n;const o=(r-(i.error||0))/n,h=this._windup;return!1!==h&&(s=Math.max(-h,Math.min(s,h))),i.error=r,i.integral=s,i.done=Math.abs(r)<.001,i.done?e:t+(this.P*r+this.I*s+this.D*o)}}F(ne,{windup:Wt("_windup"),p:Wt("P"),i:Wt("I"),d:Wt("D")});const ie={M:2,L:2,H:1,V:1,C:6,S:4,Q:4,T:2,A:7,Z:0},re={M:function(t,e,n){return e.x=n.x=t[0],e.y=n.y=t[1],["M",e.x,e.y]},L:function(t,e){return e.x=t[0],e.y=t[1],["L",t[0],t[1]]},H:function(t,e){return e.x=t[0],["H",t[0]]},V:function(t,e){return e.y=t[0],["V",t[0]]},C:function(t,e){return e.x=t[4],e.y=t[5],["C",t[0],t[1],t[2],t[3],t[4],t[5]]},S:function(t,e){return e.x=t[2],e.y=t[3],["S",t[0],t[1],t[2],t[3]]},Q:function(t,e){return e.x=t[2],e.y=t[3],["Q",t[0],t[1],t[2],t[3]]},T:function(t,e){return e.x=t[0],e.y=t[1],["T",t[0],t[1]]},Z:function(t,e,n){return e.x=n.x,e.y=n.y,["Z"]},A:function(t,e){return e.x=t[5],e.y=t[6],["A",t[0],t[1],t[2],t[3],t[4],t[5],t[6]]}},se="mlhvqtcsaz".split("");for(let t=0,e=se.length;t<e;++t)re[se[t]]=function(t){return function(e,n,i){if("H"===t)e[0]=e[0]+n.x;else if("V"===t)e[0]=e[0]+n.y;else if("A"===t)e[5]=e[5]+n.x,e[6]=e[6]+n.y;else for(let t=0,i=e.length;t<i;++t)e[t]=e[t]+(t%2?n.y:n.x);return re[t](e,n,i)}}(se[t].toUpperCase());function oe(t){return t.segment.length&&t.segment.length-1===ie[t.segment[0].toUpperCase()]}function he(t,e){t.inNumber&&ue(t,!1);const n=tt.test(e);if(n)t.segment=[e];else{const e=t.lastCommand,n=e.toLowerCase(),i=e===n;t.segment=["m"===n?i?"l":"L":e]}return t.inSegment=!0,t.lastCommand=t.segment[0],n}function ue(t,e){if(!t.inNumber)throw new Error("Parser Error");t.number&&t.segment.push(parseFloat(t.number)),t.inNumber=e,t.number="",t.pointSeen=!1,t.hasExponent=!1,oe(t)&&ae(t)}function ae(t){t.inSegment=!1,t.absolute&&(t.segment=function(t){const e=t.segment[0];return re[e](t.segment.slice(1),t.p,t.p0)}(t)),t.segments.push(t.segment)}function le(t){if(!t.segment.length)return!1;const e="A"===t.segment[0].toUpperCase(),n=t.segment.length;return e&&(4===n||5===n)}function ce(t){return"E"===t.lastToken.toUpperCase()}class fe extends Nt{bbox(){return at().path.setAttribute("d",this.toString()),new ct(at.nodes.path.getBBox())}move(t,e){const n=this.bbox();if(t-=n.x,e-=n.y,!isNaN(t)&&!isNaN(e))for(let n,i=this.length-1;i>=0;i--)n=this[i][0],"M"===n||"L"===n||"T"===n?(this[i][1]+=t,this[i][2]+=e):"H"===n?this[i][1]+=t:"V"===n?this[i][1]+=e:"C"===n||"S"===n||"Q"===n?(this[i][1]+=t,this[i][2]+=e,this[i][3]+=t,this[i][4]+=e,"C"===n&&(this[i][5]+=t,this[i][6]+=e)):"A"===n&&(this[i][6]+=t,this[i][7]+=e);return this}parse(t="M0 0"){return Array.isArray(t)&&(t=Array.prototype.concat.apply([],t).toString()),function(t,e=!0){let n=0,i="";const r={segment:[],inNumber:!1,number:"",lastToken:"",inSegment:!1,segments:[],pointSeen:!1,hasExponent:!1,absolute:e,p0:new ot,p:new ot};for(;r.lastToken=i,i=t.charAt(n++);)if(r.inSegment||!he(r,i))if("."!==i)if(isNaN(parseInt(i)))if(" "!==i&&","!==i)if("-"!==i)if("E"!==i.toUpperCase()){if(tt.test(i)){if(r.inNumber)ue(r,!1);else{if(!oe(r))throw new Error("parser Error");ae(r)}--n}}else r.number+=i,r.hasExponent=!0;else{if(r.inNumber&&!ce(r)){ue(r,!1),--n;continue}r.number+=i,r.inNumber=!0}else r.inNumber&&ue(r,!1);else{if("0"===r.number||le(r)){r.inNumber=!0,r.number=i,ue(r,!0);continue}r.inNumber=!0,r.number+=i}else{if(r.pointSeen||r.hasExponent){ue(r,!1),--n;continue}r.inNumber=!0,r.pointSeen=!0,r.number+=i}return r.inNumber&&ue(r,!1),r.inSegment&&oe(r)&&ae(r),r.segments}(t)}size(t,e){const n=this.bbox();let i,r;for(n.width=0===n.width?1:n.width,n.height=0===n.height?1:n.height,i=this.length-1;i>=0;i--)r=this[i][0],"M"===r||"L"===r||"T"===r?(this[i][1]=(this[i][1]-n.x)*t/n.width+n.x,this[i][2]=(this[i][2]-n.y)*e/n.height+n.y):"H"===r?this[i][1]=(this[i][1]-n.x)*t/n.width+n.x:"V"===r?this[i][1]=(this[i][1]-n.y)*e/n.height+n.y:"C"===r||"S"===r||"Q"===r?(this[i][1]=(this[i][1]-n.x)*t/n.width+n.x,this[i][2]=(this[i][2]-n.y)*e/n.height+n.y,this[i][3]=(this[i][3]-n.x)*t/n.width+n.x,this[i][4]=(this[i][4]-n.y)*e/n.height+n.y,"C"===r&&(this[i][5]=(this[i][5]-n.x)*t/n.width+n.x,this[i][6]=(this[i][6]-n.y)*e/n.height+n.y)):"A"===r&&(this[i][1]=this[i][1]*t/n.width,this[i][2]=this[i][2]*e/n.height,this[i][6]=(this[i][6]-n.x)*t/n.width+n.x,this[i][7]=(this[i][7]-n.y)*e/n.height+n.y);return this}toString(){return function(t){let e="";for(let n=0,i=t.length;n<i;n++)e+=t[n][0],null!=t[n][1]&&(e+=t[n][1],null!=t[n][2]&&(e+=" ",e+=t[n][2],null!=t[n][3]&&(e+=" ",e+=t[n][3],e+=" ",e+=t[n][4],null!=t[n][5]&&(e+=" ",e+=t[n][5],e+=" ",e+=t[n][6],null!=t[n][7]&&(e+=" ",e+=t[n][7])))));return e+" "}(this)}}const de=t=>{const e=typeof t;return"number"===e?St:"string"===e?st.isColor(t)?st:K.test(t)?tt.test(t)?fe:Nt:X.test(t)?St:pe:ge.indexOf(t.constructor)>-1?t.constructor:Array.isArray(t)?Nt:"object"===e?_e:pe};class me{constructor(t){this._stepper=t||new Zt("-"),this._from=null,this._to=null,this._type=null,this._context=null,this._morphObj=null}at(t){const e=this;return this._morphObj.fromArray(this._from.map((function(n,i){return e._stepper.step(n,e._to[i],t,e._context[i],e._context)})))}done(){return this._context.map(this._stepper.done).reduce((function(t,e){return t&&e}),!0)}from(t){return null==t?this._from:(this._from=this._set(t),this)}stepper(t){return null==t?this._stepper:(this._stepper=t,this)}to(t){return null==t?this._to:(this._to=this._set(t),this)}type(t){return null==t?this._type:(this._type=t,this)}_set(t){this._type||this.type(de(t));let e=new this._type(t);return this._type===st&&(e=this._to?e[this._to[4]]():this._from?e[this._from[4]]():e),this._type===_e&&(e=this._to?e.align(this._to):this._from?e.align(this._from):e),e=e.toArray(),this._morphObj=this._morphObj||new this._type,this._context=this._context||Array.apply(null,Array(e.length)).map(Object).map((function(t){return t.done=!0,t})),e}}class pe{constructor(...t){this.init(...t)}init(t){return t=Array.isArray(t)?t[0]:t,this.value=t,this}toArray(){return[this.value]}valueOf(){return this.value}}class ye{constructor(...t){this.init(...t)}init(t){return Array.isArray(t)&&(t={scaleX:t[0],scaleY:t[1],shear:t[2],rotate:t[3],translateX:t[4],translateY:t[5],originX:t[6],originY:t[7]}),Object.assign(this,ye.defaults,t),this}toArray(){const t=this;return[t.scaleX,t.scaleY,t.shear,t.rotate,t.translateX,t.translateY,t.originX,t.originY]}}ye.defaults={scaleX:1,scaleY:1,shear:0,rotate:0,translateX:0,translateY:0,originX:0,originY:0};const we=(t,e)=>t[0]<e[0]?-1:t[0]>e[0]?1:0;class _e{constructor(...t){this.init(...t)}align(t){for(let e=0,n=this.values.length;e<n;++e)if(this.values[e]===st){const n=t[e+6],i=new st(this.values.splice(e+2,5))[n]().toArray();this.values.splice(e+2,0,...i)}return this}init(t){if(this.values=[],Array.isArray(t))return void(this.values=t.slice());t=t||{};const e=[];for(const n in t){const i=de(t[n]),r=new i(t[n]).toArray();e.push([n,i,r.length,...r])}return e.sort(we),this.values=e.reduce(((t,e)=>t.concat(e)),[]),this}toArray(){return this.values}valueOf(){const t={},e=this.values;for(;e.length;){const n=e.shift(),i=e.shift(),r=e.shift(),s=e.splice(0,r);t[n]=new i(s).valueOf()}return t}}const ge=[pe,ye,_e];function xe(t=[]){ge.push(...[].concat(t))}function be(){F(ge,{to(t){return(new me).type(this.constructor).from(this.valueOf()).to(t)},fromArray(t){return this.init(t),this}})}class Path extends Shape{constructor(t,e=t){super(E("path",t),e)}array(){return this._array||(this._array=new fe(this.attr("d")))}clear(){return delete this._array,this}height(t){return null==t?this.bbox().height:this.size(this.bbox().width,t)}move(t,e){return this.attr("d",this.array().move(t,e))}plot(t){return null==t?this.array():this.clear().attr("d","string"==typeof t?t:this._array=new fe(t))}size(t,e){const n=c(this,t,e);return this.attr("d",this.array().size(n.width,n.height))}width(t){return null==t?this.bbox().width:this.size(t,this.bbox().height)}x(t){return null==t?this.bbox().x:this.move(t,this.bbox().y)}y(t){return null==t?this.bbox().y:this.move(this.bbox().x,t)}}Path.prototype.MorphArray=fe,n({Container:{path:q((function(t){return this.put(new Path).plot(t||new fe)}))}}),I(Path,"Path");var ve={__proto__:null,array:function(){return this._array||(this._array=new $t(this.attr("points")))},clear:function(){return delete this._array,this},move:function(t,e){return this.attr("points",this.array().move(t,e))},plot:function(t){return null==t?this.array():this.clear().attr("points","string"==typeof t?t:this._array=new $t(t))},size:function(t,e){const n=c(this,t,e);return this.attr("points",this.array().size(n.width,n.height))}};class Polygon extends Shape{constructor(t,e=t){super(E("polygon",t),e)}}n({Container:{polygon:q((function(t){return this.put(new Polygon).plot(t||new $t)}))}}),F(Polygon,Ut),F(Polygon,ve),I(Polygon,"Polygon");class Polyline extends Shape{constructor(t,e=t){super(E("polyline",t),e)}}n({Container:{polyline:q((function(t){return this.put(new Polyline).plot(t||new $t)}))}}),F(Polyline,Ut),F(Polyline,ve),I(Polyline,"Polyline");class Rect extends Shape{constructor(t,e=t){super(E("rect",t),e)}}F(Rect,{rx:Dt,ry:It}),n({Container:{rect:q((function(t,e){return this.put(new Rect).size(t,e)}))}}),I(Rect,"Rect");class Me{constructor(){this._first=null,this._last=null}first(){return this._first&&this._first.value}last(){return this._last&&this._last.value}push(t){const e=void 0!==t.next?t:{value:t,next:null,prev:null};return this._last?(e.prev=this._last,this._last.next=e,this._last=e):(this._last=e,this._first=e),e}remove(t){t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t===this._last&&(this._last=t.prev),t===this._first&&(this._first=t.next),t.prev=null,t.next=null}shift(){const t=this._first;return t?(this._first=t.next,this._first&&(this._first.prev=null),this._last=this._first?this._last:null,t.value):null}}const Oe={nextDraw:null,frames:new Me,timeouts:new Me,immediates:new Me,timer:()=>x.window.performance||x.window.Date,transforms:[],frame(t){const e=Oe.frames.push({run:t});return null===Oe.nextDraw&&(Oe.nextDraw=x.window.requestAnimationFrame(Oe._draw)),e},timeout(t,e){e=e||0;const n=Oe.timer().now()+e,i=Oe.timeouts.push({run:t,time:n});return null===Oe.nextDraw&&(Oe.nextDraw=x.window.requestAnimationFrame(Oe._draw)),i},immediate(t){const e=Oe.immediates.push(t);return null===Oe.nextDraw&&(Oe.nextDraw=x.window.requestAnimationFrame(Oe._draw)),e},cancelFrame(t){null!=t&&Oe.frames.remove(t)},clearTimeout(t){null!=t&&Oe.timeouts.remove(t)},cancelImmediate(t){null!=t&&Oe.immediates.remove(t)},_draw(t){let e=null;const n=Oe.timeouts.last();for(;(e=Oe.timeouts.shift())&&(t>=e.time?e.run():Oe.timeouts.push(e),e!==n););let i=null;const r=Oe.frames.last();for(;i!==r&&(i=Oe.frames.shift());)i.run(t);let s=null;for(;s=Oe.immediates.shift();)s();Oe.nextDraw=Oe.timeouts.first()||Oe.frames.first()?x.window.requestAnimationFrame(Oe._draw):null}},Ae=function(t){const e=t.start,n=t.runner.duration();return{start:e,duration:n,end:e+n,runner:t.runner}},ke=function(){const t=x.window;return(t.performance||t.Date).now()};class Te extends Ot{constructor(t=ke){super(),this._timeSource=t,this._startTime=0,this._speed=1,this._persist=0,this._nextFrame=null,this._paused=!0,this._runners=[],this._runnerIds=[],this._lastRunnerId=-1,this._time=0,this._lastSourceTime=0,this._lastStepTime=0,this._step=this._stepFn.bind(this,!1),this._stepImmediate=this._stepFn.bind(this,!0)}active(){return!!this._nextFrame}finish(){return this.time(this.getEndTimeOfTimeline()+1),this.pause()}getEndTime(){const t=this.getLastRunnerInfo(),e=t?t.runner.duration():0;return(t?t.start:this._time)+e}getEndTimeOfTimeline(){const t=this._runners.map((t=>t.start+t.runner.duration()));return Math.max(0,...t)}getLastRunnerInfo(){return this.getRunnerInfoById(this._lastRunnerId)}getRunnerInfoById(t){return this._runners[this._runnerIds.indexOf(t)]||null}pause(){return this._paused=!0,this._continue()}persist(t){return null==t?this._persist:(this._persist=t,this)}play(){return this._paused=!1,this.updateTime()._continue()}reverse(t){const e=this.speed();if(null==t)return this.speed(-e);const n=Math.abs(e);return this.speed(t?-n:n)}schedule(t,e,n){if(null==t)return this._runners.map(Ae);let i=0;const r=this.getEndTime();if(e=e||0,null==n||"last"===n||"after"===n)i=r;else if("absolute"===n||"start"===n)i=e,e=0;else if("now"===n)i=this._time;else if("relative"===n){const n=this.getRunnerInfoById(t.id);n&&(i=n.start+e,e=0)}else{if("with-last"!==n)throw new Error('Invalid value for the "when" parameter');{const t=this.getLastRunnerInfo();i=t?t.start:this._time}}t.unschedule(),t.timeline(this);const s=t.persist(),o={persist:null===s?this._persist:s,start:i+e,runner:t};return this._lastRunnerId=t.id,this._runners.push(o),this._runners.sort(((t,e)=>t.start-e.start)),this._runnerIds=this._runners.map((t=>t.runner.id)),this.updateTime()._continue(),this}seek(t){return this.time(this._time+t)}source(t){return null==t?this._timeSource:(this._timeSource=t,this)}speed(t){return null==t?this._speed:(this._speed=t,this)}stop(){return this.time(0),this.pause()}time(t){return null==t?this._time:(this._time=t,this._continue(!0))}unschedule(t){const e=this._runnerIds.indexOf(t.id);return e<0||(this._runners.splice(e,1),this._runnerIds.splice(e,1),t.timeline(null)),this}updateTime(){return this.active()||(this._lastSourceTime=this._timeSource()),this}_continue(t=!1){return Oe.cancelFrame(this._nextFrame),this._nextFrame=null,t?this._stepImmediate():(this._paused||(this._nextFrame=Oe.frame(this._step)),this)}_stepFn(t=!1){const e=this._timeSource();let n=e-this._lastSourceTime;t&&(n=0);const i=this._speed*n+(this._time-this._lastStepTime);this._lastSourceTime=e,t||(this._time+=i,this._time=this._time<0?0:this._time),this._lastStepTime=this._time,this.fire("time",this._time);for(let t=this._runners.length;t--;){const e=this._runners[t],n=e.runner;this._time-e.start<=0&&n.reset()}let r=!1;for(let t=0,e=this._runners.length;t<e;t++){const n=this._runners[t],s=n.runner;let o=i;const h=this._time-n.start;if(h<=0){r=!0;continue}if(h<o&&(o=h),!s.active())continue;if(s.step(o).done){if(!0!==n.persist){s.duration()-s.time()+this._time+n.persist<this._time&&(s.unschedule(),--t,--e)}}else r=!0}return r&&!(this._speed<0&&0===this._time)||this._runnerIds.length&&this._speed<0&&this._time>0?this._continue():(this.pause(),this.fire("finished")),this}}n({Element:{timeline:function(t){return null==t?(this._timeline=this._timeline||new Te,this._timeline):(this._timeline=t,this)}}});class Ce extends Ot{constructor(t){super(),this.id=Ce.id++,t="function"==typeof(t=null==t?kt.duration:t)?new Kt(t):t,this._element=null,this._timeline=null,this.done=!1,this._queue=[],this._duration="number"==typeof t&&t,this._isDeclarative=t instanceof Kt,this._stepper=this._isDeclarative?t:new Zt,this._history={},this.enabled=!0,this._time=0,this._lastTime=0,this._reseted=!0,this.transforms=new ut,this.transformId=1,this._haveReversed=!1,this._reverse=!1,this._loopsDone=0,this._swing=!1,this._wait=0,this._times=1,this._frameId=null,this._persist=!!this._isDeclarative||null}static sanitise(t,e,n){let i=1,r=!1,s=0;return e=e||kt.delay,n=n||"last","object"!=typeof(t=t||kt.duration)||t instanceof Jt||(e=t.delay||e,n=t.when||n,r=t.swing||r,i=t.times||i,s=t.wait||s,t=t.duration||kt.duration),{duration:t,delay:e,swing:r,times:i,wait:s,when:n}}active(t){return null==t?this.enabled:(this.enabled=t,this)}addTransform(t,e){return this.transforms.lmultiplyO(t),this}after(t){return this.on("finished",t)}animate(t,e,n){const i=Ce.sanitise(t,e,n),r=new Ce(i.duration);return this._timeline&&r.timeline(this._timeline),this._element&&r.element(this._element),r.loop(i).schedule(i.delay,i.when)}clearTransform(){return this.transforms=new ut,this}clearTransformsFromQueue(){this.done&&this._timeline&&this._timeline._runnerIds.includes(this.id)||(this._queue=this._queue.filter((t=>!t.isTransform)))}delay(t){return this.animate(0,t)}duration(){return this._times*(this._wait+this._duration)-this._wait}during(t){return this.queue(null,t)}ease(t){return this._stepper=new Zt(t),this}element(t){return null==t?this._element:(this._element=t,t._prepareRunner(),this)}finish(){return this.step(1/0)}loop(t,e,n){return"object"==typeof t&&(e=t.swing,n=t.wait,t=t.times),this._times=t||1/0,this._swing=e||!1,this._wait=n||0,!0===this._times&&(this._times=1/0),this}loops(t){const e=this._duration+this._wait;if(null==t){const t=Math.floor(this._time/e),n=(this._time-t*e)/this._duration;return Math.min(t+n,this._times)}const n=t%1,i=e*Math.floor(t)+this._duration*n;return this.time(i)}persist(t){return null==t?this._persist:(this._persist=t,this)}position(t){const e=this._time,n=this._duration,i=this._wait,r=this._times,s=this._swing,o=this._reverse;let h;if(null==t){const t=function(t){const e=s*Math.floor(t%(2*(i+n))/(i+n)),r=e&&!o||!e&&o,h=Math.pow(-1,r)*(t%(i+n))/n+r;return Math.max(Math.min(h,1),0)},u=r*(i+n)-i;return h=e<=0?Math.round(t(1e-5)):e<u?t(e):Math.round(t(u-1e-5)),h}const u=Math.floor(this.loops()),a=s&&u%2==0;return h=u+(a&&!o||o&&a?t:1-t),this.loops(h)}progress(t){return null==t?Math.min(1,this._time/this.duration()):this.time(t*this.duration())}queue(t,e,n,i){this._queue.push({initialiser:t||At,runner:e||At,retarget:n,isTransform:i,initialised:!1,finished:!1});return this.timeline()&&this.timeline()._continue(),this}reset(){return this._reseted||(this.time(0),this._reseted=!0),this}reverse(t){return this._reverse=null==t?!this._reverse:t,this}schedule(t,e,n){if(t instanceof Te||(n=e,e=t,t=this.timeline()),!t)throw Error("Runner cannot be scheduled without timeline");return t.schedule(this,e,n),this}step(t){if(!this.enabled)return this;t=null==t?16:t,this._time+=t;const e=this.position(),n=this._lastPosition!==e&&this._time>=0;this._lastPosition=e;const i=this.duration(),r=this._lastTime<=0&&this._time>0,s=this._lastTime<i&&this._time>=i;this._lastTime=this._time,r&&this.fire("start",this);const o=this._isDeclarative;this.done=!o&&!s&&this._time>=i,this._reseted=!1;let h=!1;return(n||o)&&(this._initialise(n),this.transforms=new ut,h=this._run(o?t:e),this.fire("step",this)),this.done=this.done||h&&o,s&&this.fire("finished",this),this}time(t){if(null==t)return this._time;const e=t-this._time;return this.step(e),this}timeline(t){return void 0===t?this._timeline:(this._timeline=t,this)}unschedule(){const t=this.timeline();return t&&t.unschedule(this),this}_initialise(t){if(t||this._isDeclarative)for(let e=0,n=this._queue.length;e<n;++e){const n=this._queue[e],i=this._isDeclarative||!n.initialised&&t;t=!n.finished,i&&t&&(n.initialiser.call(this),n.initialised=!0)}}_rememberMorpher(t,e){if(this._history[t]={morpher:e,caller:this._queue[this._queue.length-1]},this._isDeclarative){const t=this.timeline();t&&t.play()}}_run(t){let e=!0;for(let n=0,i=this._queue.length;n<i;++n){const i=this._queue[n],r=i.runner.call(this,t);i.finished=i.finished||!0===r,e=e&&i.finished}return e}_tryRetarget(t,e,n){if(this._history[t]){if(!this._history[t].caller.initialised){const e=this._queue.indexOf(this._history[t].caller);return this._queue.splice(e,1),!1}this._history[t].caller.retarget?this._history[t].caller.retarget.call(this,e,n):this._history[t].morpher.to(e),this._history[t].caller.finished=!1;const i=this.timeline();return i&&i.play(),!0}return!1}}Ce.id=0;class Ne{constructor(t=new ut,e=-1,n=!0){this.transforms=t,this.id=e,this.done=n}clearTransformsFromQueue(){}}F([Ce,Ne],{mergeWith(t){return new Ne(t.transforms.lmultiply(this.transforms),t.id)}});const Se=(t,e)=>t.lmultiplyO(e),Ee=t=>t.transforms;function je(){const t=this._transformationRunners.runners.map(Ee).reduce(Se,new ut);this.transform(t),this._transformationRunners.merge(),1===this._transformationRunners.length()&&(this._frameId=null)}class De{constructor(){this.runners=[],this.ids=[]}add(t){if(this.runners.includes(t))return;const e=t.id+1;return this.runners.push(t),this.ids.push(e),this}clearBefore(t){const e=this.ids.indexOf(t+1)||1;return this.ids.splice(0,e,0),this.runners.splice(0,e,new Ne).forEach((t=>t.clearTransformsFromQueue())),this}edit(t,e){const n=this.ids.indexOf(t+1);return this.ids.splice(n,1,t+1),this.runners.splice(n,1,e),this}getByID(t){return this.runners[this.ids.indexOf(t+1)]}length(){return this.ids.length}merge(){let t=null;for(let e=0;e<this.runners.length;++e){const n=this.runners[e];if(t&&n.done&&t.done&&(!n._timeline||!n._timeline._runnerIds.includes(n.id))&&(!t._timeline||!t._timeline._runnerIds.includes(t.id))){this.remove(n.id);const i=n.mergeWith(t);this.edit(t.id,i),t=i,--e}else t=n}return this}remove(t){const e=this.ids.indexOf(t+1);return this.ids.splice(e,1),this.runners.splice(e,1),this}}n({Element:{animate(t,e,n){const i=Ce.sanitise(t,e,n),r=this.timeline();return new Ce(i.duration).loop(i).element(this).timeline(r.play()).schedule(i.delay,i.when)},delay(t,e){return this.animate(0,t,e)},_clearTransformRunnersBefore(t){this._transformationRunners.clearBefore(t.id)},_currentTransform(t){return this._transformationRunners.runners.filter((e=>e.id<=t.id)).map(Ee).reduce(Se,new ut)},_addRunner(t){this._transformationRunners.add(t),Oe.cancelImmediate(this._frameId),this._frameId=Oe.immediate(je.bind(this))},_prepareRunner(){null==this._frameId&&(this._transformationRunners=(new De).add(new Ne(new ut(this))))}}});F(Ce,{attr(t,e){return this.styleAttr("attr",t,e)},css(t,e){return this.styleAttr("css",t,e)},styleAttr(t,e,n){if("string"==typeof e)return this.styleAttr(t,{[e]:n});let i=e;if(this._tryRetarget(t,i))return this;let r=new me(this._stepper).to(i),s=Object.keys(i);return this.queue((function(){r=r.from(this.element()[t](s))}),(function(e){return this.element()[t](r.at(e).valueOf()),r.done()}),(function(e){const n=Object.keys(e),o=(h=s,n.filter((t=>!h.includes(t))));var h;if(o.length){const e=this.element()[t](o),n=new _e(r.from()).valueOf();Object.assign(n,e),r.from(n)}const u=new _e(r.to()).valueOf();Object.assign(u,e),r.to(u),s=n,i=e})),this._rememberMorpher(t,r),this},zoom(t,e){if(this._tryRetarget("zoom",t,e))return this;let n=new me(this._stepper).to(new St(t));return this.queue((function(){n=n.from(this.element().zoom())}),(function(t){return this.element().zoom(n.at(t),e),n.done()}),(function(t,i){e=i,n.to(t)})),this._rememberMorpher("zoom",n),this},transform(t,e,n){if(e=t.relative||e,this._isDeclarative&&!e&&this._tryRetarget("transform",t))return this;const i=ut.isMatrixLike(t);n=null!=t.affine?t.affine:null!=n?n:!i;const r=new me(this._stepper).type(n?ye:ut);let s,o,h,u,a;return this.queue((function(){o=o||this.element(),s=s||f(t,o),a=new ut(e?void 0:o),o._addRunner(this),e||o._clearTransformRunnersBefore(this)}),(function(l){e||this.clearTransform();const{x:c,y:f}=new ot(s).transform(o._currentTransform(this));let d=new ut({...t,origin:[c,f]}),m=this._isDeclarative&&h?h:a;if(n){d=d.decompose(c,f),m=m.decompose(c,f);const t=d.rotate,e=m.rotate,n=[t-360,t,t+360],i=n.map((t=>Math.abs(t-e))),r=Math.min(...i),s=i.indexOf(r);d.rotate=n[s]}e&&(i||(d.rotate=t.rotate||0),this._isDeclarative&&u&&(m.rotate=u)),r.from(m),r.to(d);const p=r.at(l);return u=p.rotate,h=new ut(p),this.addTransform(h),o._addRunner(this),r.done()}),(function(e){(e.origin||"center").toString()!==(t.origin||"center").toString()&&(s=f(e,o)),t={...e,origin:s}}),!0),this._isDeclarative&&this._rememberMorpher("transform",r),this},x(t,e){return this._queueNumber("x",t)},y(t){return this._queueNumber("y",t)},dx(t=0){return this._queueNumberDelta("x",t)},dy(t=0){return this._queueNumberDelta("y",t)},dmove(t,e){return this.dx(t).dy(e)},_queueNumberDelta(t,e){if(e=new St(e),this._tryRetarget(t,e))return this;const n=new me(this._stepper).to(e);let i=null;return this.queue((function(){i=this.element()[t](),n.from(i),n.to(i+e)}),(function(e){return this.element()[t](n.at(e)),n.done()}),(function(t){n.to(i+new St(t))})),this._rememberMorpher(t,n),this},_queueObject(t,e){if(this._tryRetarget(t,e))return this;const n=new me(this._stepper).to(e);return this.queue((function(){n.from(this.element()[t]())}),(function(e){return this.element()[t](n.at(e)),n.done()})),this._rememberMorpher(t,n),this},_queueNumber(t,e){return this._queueObject(t,new St(e))},cx(t){return this._queueNumber("cx",t)},cy(t){return this._queueNumber("cy",t)},move(t,e){return this.x(t).y(e)},center(t,e){return this.cx(t).cy(e)},size(t,e){let n;return t&&e||(n=this._element.bbox()),t||(t=n.width/n.height*e),e||(e=n.height/n.width*t),this.width(t).height(e)},width(t){return this._queueNumber("width",t)},height(t){return this._queueNumber("height",t)},plot(t,e,n,i){if(4===arguments.length)return this.plot([t,e,n,i]);if(this._tryRetarget("plot",t))return this;const r=new me(this._stepper).type(this._element.MorphArray).to(t);return this.queue((function(){r.from(this._element.array())}),(function(t){return this._element.plot(r.at(t)),r.done()})),this._rememberMorpher("plot",r),this},leading(t){return this._queueNumber("leading",t)},viewbox(t,e,n,i){return this._queueObject("viewbox",new ct(t,e,n,i))},update(t){return"object"!=typeof t?this.update({offset:arguments[0],color:arguments[1],opacity:arguments[2]}):(null!=t.opacity&&this.attr("stop-opacity",t.opacity),null!=t.color&&this.attr("stop-color",t.color),null!=t.offset&&this.attr("offset",t.offset),this)}}),F(Ce,{rx:Dt,ry:It,from:Bt,to:Ht}),I(Ce,"Runner");class Svg extends Container{constructor(t,e=t){super(E("svg",t),e),this.namespace()}defs(){return this.isRoot()?j(this.node.querySelector("defs"))||this.put(new Defs):this.root().defs()}isRoot(){return!this.node.parentNode||!(this.node.parentNode instanceof x.window.SVGElement)&&"#document-fragment"!==this.node.parentNode.nodeName}namespace(){return this.isRoot()?this.attr({xmlns:m,version:"1.1"}).attr("xmlns:xlink",w,y).attr("xmlns:svgjs",_,y):this.root().namespace()}removeNamespace(){return this.attr({xmlns:null,version:null}).attr("xmlns:xlink",null,y).attr("xmlns:svgjs",null,y)}root(){return this.isRoot()?this:super.root()}}n({Container:{nested:q((function(){return this.put(new Svg)}))}}),I(Svg,"Svg",!0);class Symbol extends Container{constructor(t,e=t){super(E("symbol",t),e)}}n({Container:{symbol:q((function(){return this.put(new Symbol)}))}}),I(Symbol,"Symbol");var Ie={__proto__:null,plain:function(t){return!1===this._build&&this.clear(),this.node.appendChild(x.document.createTextNode(t)),this},length:function(){return this.node.getComputedTextLength()},x:function(t,e=this.bbox()){return null==t?e.x:this.attr("x",this.attr("x")+t-e.x)},y:function(t,e=this.bbox()){return null==t?e.y:this.attr("y",this.attr("y")+t-e.y)},move:function(t,e,n=this.bbox()){return this.x(t,n).y(e,n)},cx:function(t,e=this.bbox()){return null==t?e.cx:this.attr("x",this.attr("x")+t-e.cx)},cy:function(t,e=this.bbox()){return null==t?e.cy:this.attr("y",this.attr("y")+t-e.cy)},center:function(t,e,n=this.bbox()){return this.cx(t,n).cy(e,n)},ax:function(t){return this.attr("x",t)},ay:function(t){return this.attr("y",t)},amove:function(t,e){return this.ax(t).ay(e)},build:function(t){return this._build=!!t,this}};class Text extends Shape{constructor(t,e=t){super(E("text",t),e),this.dom.leading=new St(1.3),this._rebuild=!0,this._build=!1}leading(t){return null==t?this.dom.leading:(this.dom.leading=new St(t),this.rebuild())}rebuild(t){if("boolean"==typeof t&&(this._rebuild=t),this._rebuild){const t=this;let e=0;const n=this.dom.leading;this.each((function(i){const r=x.window.getComputedStyle(this.node).getPropertyValue("font-size"),s=n*new St(r);this.dom.newLined&&(this.attr("x",t.attr("x")),"\n"===this.text()?e+=s:(this.attr("dy",i?s+e:0),e=0))})),this.fire("rebuild")}return this}setData(t){return this.dom=t,this.dom.leading=new St(t.leading||1.3),this}text(t){if(void 0===t){const e=this.node.childNodes;let n=0;t="";for(let i=0,r=e.length;i<r;++i)"textPath"!==e[i].nodeName?(i!==n&&3!==e[i].nodeType&&!0===j(e[i]).dom.newLined&&(t+="\n"),t+=e[i].textContent):0===i&&(n=1);return t}if(this.clear().build(!0),"function"==typeof t)t.call(this,this);else for(let e=0,n=(t=(t+"").split("\n")).length;e<n;e++)this.newLine(t[e]);return this.build(!1).rebuild()}}F(Text,Ie),n({Container:{text:q((function(t=""){return this.put(new Text).text(t)})),plain:q((function(t=""){return this.put(new Text).plain(t)}))}}),I(Text,"Text");class Tspan extends Shape{constructor(t,e=t){super(E("tspan",t),e),this._build=!1}dx(t){return this.attr("dx",t)}dy(t){return this.attr("dy",t)}newLine(){this.dom.newLined=!0;const t=this.parent();if(!(t instanceof Text))return this;const e=t.index(this),n=x.window.getComputedStyle(this.node).getPropertyValue("font-size"),i=t.dom.leading*new St(n);return this.dy(e?i:0).attr("x",t.x())}text(t){return null==t?this.node.textContent+(this.dom.newLined?"\n":""):("function"==typeof t?(this.clear().build(!0),t.call(this,this),this.build(!1)):this.plain(t),this)}}F(Tspan,Ie),n({Tspan:{tspan:q((function(t=""){const e=new Tspan;return this._build||this.clear(),this.put(e).text(t)}))},Text:{newLine:function(t=""){return this.tspan(t).newLine()}}}),I(Tspan,"Tspan");class Circle extends Shape{constructor(t,e=t){super(E("circle",t),e)}radius(t){return this.attr("r",t)}rx(t){return this.attr("r",t)}ry(t){return this.rx(t)}size(t){return this.radius(new St(t).divide(2))}}F(Circle,{x:zt,y:Rt,cx:Lt,cy:Pt,width:Ft,height:qt}),n({Container:{circle:q((function(t=0){return this.put(new Circle).size(t).move(0,0)}))}}),I(Circle,"Circle");class ClipPath extends Container{constructor(t,e=t){super(E("clipPath",t),e)}remove(){return this.targets().forEach((function(t){t.unclip()})),super.remove()}targets(){return pt('svg [clip-path*="'+this.id()+'"]')}}n({Container:{clip:q((function(){return this.defs().put(new ClipPath)}))},Element:{clipper(){return this.reference("clip-path")},clipWith(t){const e=t instanceof ClipPath?t:this.parent().clip().add(t);return this.attr("clip-path",'url("#'+e.id()+'")')},unclip(){return this.attr("clip-path",null)}}}),I(ClipPath,"ClipPath");class ze extends Element{constructor(t,e=t){super(E("foreignObject",t),e)}}n({Container:{foreignObject:q((function(t,e){return this.put(new ze).size(t,e)}))}}),I(ze,"ForeignObject");var Re={__proto__:null,dmove:function(t,e){return this.children().forEach(((n,i)=>{let r;try{r=n.bbox()}catch(t){return}const s=new ut(n),o=s.translate(t,e).transform(s.inverse()),h=new ot(r.x,r.y).transform(o);n.move(h.x,h.y)})),this},dx:function(t){return this.dmove(t,0)},dy:function(t){return this.dmove(0,t)},height:function(t,e=this.bbox()){return null==t?e.height:this.size(e.width,t,e)},move:function(t=0,e=0,n=this.bbox()){const i=t-n.x,r=e-n.y;return this.dmove(i,r)},size:function(t,e,n=this.bbox()){const i=c(this,t,e,n),r=i.width/n.width,s=i.height/n.height;return this.children().forEach(((t,e)=>{const i=new ot(n).transform(new ut(t).inverse());t.scale(r,s,i.x,i.y)})),this},width:function(t,e=this.bbox()){return null==t?e.width:this.size(t,e.height,e)},x:function(t,e=this.bbox()){return null==t?e.x:this.move(t,e.y,e)},y:function(t,e=this.bbox()){return null==t?e.y:this.move(e.x,t,e)}};class G extends Container{constructor(t,e=t){super(E("g",t),e)}}F(G,Re),n({Container:{group:q((function(){return this.put(new G)}))}}),I(G,"G");class A extends Container{constructor(t,e=t){super(E("a",t),e)}target(t){return this.attr("target",t)}to(t){return this.attr("href",t,w)}}F(A,Re),n({Container:{link:q((function(t){return this.put(new A).to(t)}))},Element:{unlink(){const t=this.linker();if(!t)return this;const e=t.parent();if(!e)return this.remove();const n=e.index(t);return e.add(this,n),t.remove(),this},linkTo(t){let e=this.linker();return e||(e=new A,this.wrap(e)),"function"==typeof t?t.call(e,e):e.to(t),this},linker(){const t=this.parent();return t&&"a"===t.node.nodeName.toLowerCase()?t:null}}}),I(A,"A");class Mask extends Container{constructor(t,e=t){super(E("mask",t),e)}remove(){return this.targets().forEach((function(t){t.unmask()})),super.remove()}targets(){return pt('svg [mask*="'+this.id()+'"]')}}n({Container:{mask:q((function(){return this.defs().put(new Mask)}))},Element:{masker(){return this.reference("mask")},maskWith(t){const e=t instanceof Mask?t:this.parent().mask().add(t);return this.attr("mask",'url("#'+e.id()+'")')},unmask(){return this.attr("mask",null)}}}),I(Mask,"Mask");class Stop extends Element{constructor(t,e=t){super(E("stop",t),e)}update(t){return("number"==typeof t||t instanceof St)&&(t={offset:arguments[0],color:arguments[1],opacity:arguments[2]}),null!=t.opacity&&this.attr("stop-opacity",t.opacity),null!=t.color&&this.attr("stop-color",t.color),null!=t.offset&&this.attr("offset",new St(t.offset)),this}}n({Gradient:{stop:function(t,e,n){return this.put(new Stop).update(t,e,n)}}}),I(Stop,"Stop");class Style extends Element{constructor(t,e=t){super(E("style",t),e)}addText(t=""){return this.node.textContent+=t,this}font(t,e,n={}){return this.rule("@font-face",{fontFamily:t,src:e,...n})}rule(t,e){return this.addText(function(t,e){if(!t)return"";if(!e)return t;let n=t+"{";for(const t in e)n+=a(t)+":"+e[t]+";";return n+="}",n}(t,e))}}n("Dom",{style(t,e){return this.put(new Style).rule(t,e)},fontface(t,e,n){return this.put(new Style).font(t,e,n)}}),I(Style,"Style");class TextPath extends Text{constructor(t,e=t){super(E("textPath",t),e)}array(){const t=this.track();return t?t.array():null}plot(t){const e=this.track();let n=null;return e&&(n=e.plot(t)),null==t?n:this}track(){return this.reference("href")}}n({Container:{textPath:q((function(t,e){return t instanceof Text||(t=this.text(t)),t.path(e)}))},Text:{path:q((function(t,e=!0){const n=new TextPath;let i;if(t instanceof Path||(t=this.defs().path(t)),n.attr("href","#"+t,w),e)for(;i=this.node.firstChild;)n.node.appendChild(i);return this.put(n)})),textPath(){return this.findOne("textPath")}},Path:{text:q((function(t){return t instanceof Text||(t=(new Text).addTo(this.parent()).text(t)),t.path(this)})),targets(){return pt("svg textPath").filter((t=>(t.attr("href")||"").includes(this.id())))}}}),TextPath.prototype.MorphArray=fe,I(TextPath,"TextPath");class Use extends Shape{constructor(t,e=t){super(E("use",t),e)}use(t,e){return this.attr("href",(e||"")+"#"+t,w)}}n({Container:{use:q((function(t,e){return this.put(new Use).use(t,e)}))}}),I(Use,"Use");const Le=S;F([Svg,Symbol,Image,Pattern,Marker],i("viewbox")),F([Line,Polyline,Polygon,Path],i("marker")),F(Text,i("Text")),F(Path,i("Path")),F(Defs,i("Defs")),F([Text,Tspan],i("Tspan")),F([Rect,Ellipse,Gradient,Ce],i("radius")),F(Ot,i("EventTarget")),F(Dom,i("Dom")),F(Element,i("Element")),F(Shape,i("Shape")),F([Container,Yt],i("Container")),F(Gradient,i("Gradient")),F(Ce,i("Runner")),dt.extend([...new Set(e)]),xe([St,st,ct,ut,Nt,$t,fe]),be();var Pe={__proto__:null,Morphable:me,registerMorphableType:xe,makeMorphable:be,TransformBag:ye,ObjectBag:_e,NonMorphable:pe,defaults:Ct,utils:d,namespaces:g,regex:et,SVG:Le,parser:at,find:pt,getWindow:function(){return x.window},registerWindow:b,restoreWindow:O,saveWindow:M,withWindow:function(t,e){M(),b(t,t.document),e(t,t.document),O()},Animator:Oe,Controller:Kt,Ease:Zt,PID:ne,Spring:ee,easing:Qt,Queue:Me,Runner:Ce,Timeline:Te,Array:Nt,Box:ct,Color:st,EventTarget:Ot,Matrix:ut,Number:St,PathArray:fe,Point:ot,PointArray:$t,List:dt,Circle:Circle,ClipPath:ClipPath,Container:Container,Defs:Defs,Dom:Dom,Element:Element,Ellipse:Ellipse,ForeignObject:ze,Fragment:Yt,Gradient:Gradient,G:G,A:A,Image:Image,Line:Line,Marker:Marker,Mask:Mask,Path:Path,Pattern:Pattern,Polygon:Polygon,Polyline:Polyline,Rect:Rect,Shape:Shape,Stop:Stop,Style:Style,Svg:Svg,Symbol:Symbol,Text:Text,TextPath:TextPath,Tspan:Tspan,Use:Use,windowEvents:wt,getEvents:_t,getEventTarget:gt,clearEvents:xt,on:bt,off:vt,dispatch:Mt,root:C,create:N,makeInstance:S,nodeOrNew:E,adopt:j,mockAdopt:function(t=j){D=t},register:I,getClass:z,eid:L,assignNewId:P,extend:F,wrapWithAttrCheck:q};function Fe(t,e){return S(t,e)}return Object.assign(Fe,Pe),Fe}();
//# sourceMappingURL=svg.min.js.map</script>
<link rel="icon" type="image/png" href="./assets/favicon.png" />
<link rel="stylesheet" href="./css/font-awesome.min.css">
<link rel="stylesheet" href="./css/regular.min.css">
<link rel="stylesheet" href="./css/solid.min.css">
<link rel="stylesheet" href="./css/toasty.css">
<link rel="stylesheet" href="./css/default.css" type="text/css" media="screen, projection">
<link rel="stylesheet" href="./css/light.css" type="text/css" media="screen, projection">
<link rel="alternate stylesheet" href="./css/gray.css" title='gray' type="text/css" media="screen, projection" disabled="">
<link rel="alternate stylesheet" href="./css/dark.css" title='dark' type="text/css" media="screen, projection" disabled="">
<script src="imagesMaps.js"></script>
<script src="imagesBattlers.js"></script>
<script src="imagesEquip.js"></script>
<script src="imagesItems.js"></script>
<script src="imagesIcons.js"></script>
<script src="imagesScenes.js"></script>
</head>
	<body>
		<tw-story tags></tw-story>
		<!-- UUID://0D5669D2-19D4-45E7-85C0-74D2348369F9// --><tw-storydata name="TwistedTrinkets" startnode="158" creator="Tweego" creator-version="2.1.1+81d1d71" ifid="0D5669D2-19D4-45E7-85C0-74D2348369F9" zoom="1" format="snowman" format-version="2.0.3" options="" hidden><style role="stylesheet" id="twine-user-stylesheet" type="text/twine-css">/* twine-user-stylesheet #1: "user.min.css" */
carrots{color:red}carrots{color:#00f}
/* twine-user-stylesheet #2: "Story Stylesheet" */
/*cube svg*/
.cube-unit {
  fill-opacity: .9;
  stroke-miterlimit:0;
}
.blue-cube {
  --mainColor: #009CDE;
  --strokeColor: #0079ad;
  --lightColor: #00affa;
  --darkColor: #008bc7;
}
.pink-cube {
  --mainColor: #de0063;
  --strokeColor: #ad004e;
  --lightColor: #fa0070;
  --darkColor: #c7005a;
}

@keyframes moveX {
  to { transform: translateX(var(--translate, 35px)); }
}
@keyframes moveY {
  to { transform: translateY(var(--translate, -35px)); }
}

.m-left, .m-right { 
  animation: 2s moveX alternate infinite paused; 
}
.m-up, .m-down { 
  animation: 2s moveY alternate infinite paused; 
}
.m-left { --translate: -50px; }
.m-right { --translate: 50px; }

svg:hover * { animation-play-state: running; }

.main {
  background: white;
  width: 250px;
  height: 345px;
/*   box-shadow: 3px 3px 3px 1px rgba(0,0,0,0.4); */
  margin: auto;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

@media only screen and (min-width: 768px){
  .main {
    width: 310px;
    height: 285px;
  }
}

@media only screen and (min-width: 1024px){
  .main {
    width: 410px;
    height: 375px;
  }
}
.box {
  background: #6186aa;
/*   background-image: linear-gradient(to top left, #9b59b6, #1abc9c); */
  background-size: 250%;
  width: 50px;
  height: 50px;
  float: left;
  margin: 10px 0 0 10px;
}

@media only screen and (min-width: 1024px){
  .box {
    width: 70px;
    height: 70px;
  }
}

.play:hover {
  opacity: 0.7;
  cursor: pointer;
}

img {
  width: 100%;
  display: block;
}

/* STATUS bar */
#state {
  background: #6186aa;
/*   background-image: linear-gradient(to top left, #9b59b6, #1abc9c); */
  background-size: 250%;
  width: 230px;
  line-height: 25px;
  float: left;
  margin: 10px 0 0 10px;
  padding: 0 10px;
  color: white;
  font-size: 16px;
}
@media only screen and (min-width: 768px){
  #state {
    width: 290px;
  }
}
@media only screen and (min-width: 1024px){
  #state {
    width: 390px;
    line-height: 35px;
  }
}
#time {
  float: left;
}
#time::after {
  content: " sec";
}
#score {
  float: right;
}
#score::after {
  content: " points";
}
.hidden {
  display: none !important;
}
.show {
  display: block;
}
.outlined {
  outline: solid 2px #34495e;
  background: #9b59b6;
}
.meter {
	position: relative;
	height: 1.5em;
	width: 90%;
	background-color: gray;
	text-align: center;
}
.bar {
	position: absolute;
	left: 0;
	top: 0;
	height: 1.5em;
	background-color: red;
}
/*hangman game*/
main .alphabet span {
  border: solid 1px;
  /*   padding: 2px 5px; */
  margin: 4px 2px;
  width: 40px;
  height: 40px;
  line-height: 40px;
  text-align: center;
  display: inline-block;
}
.green2 {
/*   background: #43a047; */
  background: white;
  color: black;
/*   border-color: #43a047 !important; */
}
.red2{
/*   background: #e53935; */
  background: black;
  color: black;
/*   border-color: #e53935 !important; */
}
.grid_item {
	display: block;
	border: 1px solid #bbb;
	float: left;
	line-height:12px;
	font-size:10px;
}
.grid_item.wall {
  background-color: #000000;
}
.grid_item.weight1 {
  background-color: #ffffff;
}
.grid_item.weight3 {
  background-color: #D6EAFF;
}
.grid_item.weight5 {
  background-color: #ABD1FF;
}
.grid_item.start {
	background-color: #FF703F;
}
.grid_item.active {
	background-color: #FF703F;
}
.grid_item.finish {

}
main .alphabet span:not(.green):not(.red):hover {
  background: white;
  cursor: pointer;
}
main .word {
  margin-bottom: 20px;
  font-size: 28px;
  font-transform: capitalize;
}
.word > span {
  display: inline-block;
  margin: 10px;
  width: 30px;
  text-align: center;
  border-bottom: solid 2px black;
  color: transparent;
}
.word > span.found {
  color: black;
}</style><script role="script" id="twine-user-script" type="text/twine-javascript">/* twine-user-script #1: "user.min.js" */
"use strict";function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _get(target,property,receiver){if(typeof Reflect!=="undefined"&&Reflect.get){_get=Reflect.get;}else{_get=function _get(target,property,receiver){var base=_superPropBase(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(receiver);}return desc.value;};}return _get(target,property,receiver||target);}function _superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_getPrototypeOf(object);if(object===null)break;}return object;}function _wrapNativeSuper(Class){var _cache=typeof Map==="function"?new Map():undefined;_wrapNativeSuper=function _wrapNativeSuper(Class){if(Class===null||!_isNativeFunction(Class))return Class;if(typeof Class!=="function"){throw new TypeError("Super expression must either be null or a function");}if(typeof _cache!=="undefined"){if(_cache.has(Class))return _cache.get(Class);_cache.set(Class,Wrapper);}function Wrapper(){return _construct(Class,arguments,_getPrototypeOf(this).constructor);}Wrapper.prototype=Object.create(Class.prototype,{constructor:{value:Wrapper,enumerable:false,writable:true,configurable:true}});return _setPrototypeOf(Wrapper,Class);};return _wrapNativeSuper(Class);}function _construct(Parent,args,Class){if(_isNativeReflectConstruct()){_construct=Reflect.construct;}else{_construct=function _construct(Parent,args,Class){var a=[null];a.push.apply(a,args);var Constructor=Function.bind.apply(Parent,a);var instance=new Constructor();if(Class)_setPrototypeOf(instance,Class.prototype);return instance;};}return _construct.apply(null,arguments);}function _isNativeFunction(fn){return Function.toString.call(fn).indexOf("[native code]")!==-1;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function");}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass);}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call;}return _assertThisInitialized(self);}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o);};return _getPrototypeOf(o);}function _createForOfIteratorHelper(o,allowArrayLike){var it;if(typeof Symbol==="undefined"||o[Symbol.iterator]==null){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};},e:function e(_e){throw _e;},f:F};}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion=true,didErr=false,err;return{s:function s(){it=o[Symbol.iterator]();},n:function n(){var step=it.next();normalCompletion=step.done;return step;},e:function e(_e2){didErr=true;err=_e2;},f:function f(){try{if(!normalCompletion&&it.return!=null)it.return();}finally{if(didErr)throw err;}}};}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj;};}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};}return _typeof(obj);}// javascript-astar 0.4.1
// http://github.com/bgrins/javascript-astar
// Freely distributable under the MIT License.
// Implements the astar search algorithm in javascript using a Binary Heap.
// Includes Binary Heap (with modifications) from Marijn Haverbeke.
// http://eloquentjavascript.net/appendix2.html
(function(definition){/* global module, define */if((typeof module==="undefined"?"undefined":_typeof(module))==='object'&&_typeof(module.exports)==='object'){module.exports=definition();}else if(typeof define==='function'&&define.amd){define([],definition);}else{var exports=definition();window.astar=exports.astar;window.Graph=exports.Graph;window.GraphNode=exports.GridNode;}})(function(){function pathTo(node){var curr=node;var path=[];while(curr.parent){path.unshift(curr);curr=curr.parent;}return path;}function getHeap(){return new BinaryHeap(function(node){return node.f;});}var astar={/**
    * Perform an A* Search on a graph given a start and end node.
    * @param {Graph} graph
    * @param {GridNode or String} start
    * @param {GridNode or String} end
    * @param {entity} mob
    * @param {Object} [options]
    * @param {bool} [options.closest] Specifies whether to return the
               path to the closest node if the target is unreachable.
    * @param {Function} [options.heuristic] Heuristic function (see
    *          astar.heuristics).
    */search:function search(graph,start,end,mob,options){graph.cleanDirty();options=options||{};this.mob=mob;var heuristic=options.heuristic||astar.heuristics.manhattan;var closest=options.hasOwnProperty("closest")?options.closest:true;var openHeap=getHeap();var nstart,nend;//if start/end is not a node but string, find the node in graph
if(typeof start==="string"){nstart=graph.nodes.find(function(x){return x.origNode.name===start;});}else nstart=start;if(typeof end==="string"){nend=graph.nodes.find(function(x){return x.origNode.name===end;});}else nend=end;var closestNode=nstart;// set the start node to be the closest if required
this.cleanNode(nstart),this.cleanNode(nend);nstart.h=heuristic(nstart,nend,mob);graph.markDirty(nstart);openHeap.push(nstart);while(openHeap.size()>0){// Grab the lowest f(x) to process next.  Heap keeps this sorted for us.
var currentNode=openHeap.pop();// End case -- result has been found, return the traced path.
if(graph.areNodesEqual(currentNode,nend)){return pathTo(currentNode);}// Normal case -- move currentNode from open to closed, process each of its neighbors.
currentNode.closed=true;// Find all neighbors for the current node.
var neighbors=graph.neighbors(currentNode);for(var i=0,il=neighbors.length;i<il;++i){var neighbor=neighbors[i];if(neighbor.closed){//??|| neighbor.isWall()){
// Not a valid node to process, skip to next neighbor.
continue;}// The g score is the shortest distance from start to current node.
// We need to check if the path we have arrived at this neighbor is the shortest one we have seen yet.
var gScore=currentNode.g+graph.getCost(currentNode,neighbor,mob);var beenVisited=neighbor.visited;if(!beenVisited||gScore<neighbor.g){// Found an optimal (so far) path to this node.  Take score for node to see how good it is.
neighbor.visited=true;neighbor.parent=currentNode;neighbor.h=neighbor.h||heuristic(neighbor,nend,mob);neighbor.g=gScore;neighbor.f=neighbor.g+neighbor.h;graph.markDirty(neighbor);if(closest){// If the neighbour is closer than the current closestNode or if it's equally close but has
// a cheaper path than the current closest node then it becomes the closest node
if(neighbor.h<closestNode.h||neighbor.h===closestNode.h&&neighbor.g<closestNode.g){closestNode=neighbor;}}if(!beenVisited){// Pushing to heap will put it in proper place based on the 'f' value.
openHeap.push(neighbor);}else{// Already seen the node, but since it has been rescored we need to reorder it in the heap
openHeap.rescoreElement(neighbor);}}}}if(closest){return pathTo(closestNode);}// No result was found - empty array signifies failure to find path.
return[];},// See list of heuristics: http://theory.stanford.edu/~amitp/GameProgramming/Heuristics.html
heuristics:{manhattan:function manhattan(pos0,pos1,mob){var d1=Math.abs(pos1.origNode.x-pos0.origNode.x);var d2=Math.abs(pos1.origNode.y-pos0.origNode.y);return d1+d2;//how to get distance if there is no x/y??
}/*,   todo fix it
      diagonal: function(pos0, pos1){
        var D = 1;
        var D2 = Math.sqrt(2);
        var d1 = Math.abs(pos1.x - pos0.x);
        var d2 = Math.abs(pos1.y - pos0.y);
        return (D * (d1 + d2)) + ((D2 - (2 * D)) * Math.min(d1, d2));
      }*/},cleanNode:function cleanNode(node){node.f=0;node.g=0;node.h=0;node.visited=false;node.closed=false;node.parent=null;}};/**
   * A graph memory structure
   * @param {Array} gridIn 2D array of input weights
   * @param {Object} [options]
   * @param {bool} [options.diagonal] Specifies whether diagonal moves are allowed
   */function Graph(gridIn,options){options=options||{};this.nodes=[];this.diagonal=!!options.diagonal;for(var x=0;x<gridIn.length;x++){var node=new GridNode(gridIn[x],1);// (x,y,row[y])
this.nodes.push(node);}this.init();}Graph.prototype.init=function(){this.dirtyNodes=[];for(var i=0;i<this.nodes.length;i++){astar.cleanNode(this.nodes[i]);}};Graph.prototype.cleanDirty=function(){for(var i=0;i<this.dirtyNodes.length;i++){astar.cleanNode(this.dirtyNodes[i]);}this.dirtyNodes=[];};Graph.prototype.markDirty=function(node){this.dirtyNodes.push(node);};Graph.prototype.getCost=function(from,to,mob){return 1;// to.getWeight();
};Graph.prototype.areNodesEqual=function(nodeA,nodeB){return nodeA.origNode===nodeB.origNode;};Graph.prototype.neighbors=function(node){var next,dirs,dir,ret=[];// a node has either neighbours[] of {name:"A1"}
dirs=origNode.neighbours;if(dirs){for(var i=0;i<dirs.length;i++){dir=dirs[i].name;next=this.nodes.find(function(_x){return _x.origNode===dir;});ret.push(next);}}else{//..or a getDirections() ;this is for compat. with oldstyle dungeon
dirs=node.origNode.getDirections();for(var i=0;i<dirs.length;i++){dir=dirs[i];if(dir!==null){if(dir.hasTag(['barrier']))continue;//todo mobs cant pass through barrier and other?
var room=dir.roomB;next=this.nodes.find(function(_x){return _x.origNode===room;});ret.push(next);}}}return ret;};function GridNode(origNode){this.origNode=origNode;}/*GridNode.prototype.equals = function(other){   
    return(this.origNode===other.origNode);
  }*/ /*GridNode.prototype.getWeight = function(){
    return(1); //todo origNode.getCost()
  }*/ /*GridNode.prototype.isWall = function(){
    return this.weight === 0;
  };*/function BinaryHeap(scoreFunction){this.content=[];this.scoreFunction=scoreFunction;}BinaryHeap.prototype={push:function push(element){// Add the new element to the end of the array.
this.content.push(element);// Allow it to sink down.
this.sinkDown(this.content.length-1);},pop:function pop(){// Store the first element so we can return it later.
var result=this.content[0];// Get the element at the end of the array.
var end=this.content.pop();// If there are any elements left, put the end element at the
// start, and let it bubble up.
if(this.content.length>0){this.content[0]=end;this.bubbleUp(0);}return result;},remove:function remove(node){var i=this.content.indexOf(node);// When it is found, the process seen in 'pop' is repeated
// to fill up the hole.
var end=this.content.pop();if(i!==this.content.length-1){this.content[i]=end;if(this.scoreFunction(end)<this.scoreFunction(node)){this.sinkDown(i);}else{this.bubbleUp(i);}}},size:function size(){return this.content.length;},rescoreElement:function rescoreElement(node){this.sinkDown(this.content.indexOf(node));},sinkDown:function sinkDown(n){// Fetch the element that has to be sunk.
var element=this.content[n];// When at 0, an element can not sink any further.
while(n>0){// Compute the parent element's index, and fetch it.
var parentN=(n+1>>1)-1;var parent=this.content[parentN];// Swap the elements if the parent is greater.
if(this.scoreFunction(element)<this.scoreFunction(parent)){this.content[parentN]=element;this.content[n]=parent;// Update 'n' to continue at the new position.
n=parentN;}// Found a parent that is less, no need to sink any further.
else{break;}}},bubbleUp:function bubbleUp(n){// Look up the target element and its score.
var length=this.content.length;var element=this.content[n];var elemScore=this.scoreFunction(element);while(true){// Compute the indices of the child elements.
var child2N=n+1<<1;var child1N=child2N-1;// This is used to store the new position of the element, if any.
var swap=null;var child1Score;// If the first child exists (is inside the array)...
if(child1N<length){// Look it up and compute its score.
var child1=this.content[child1N];child1Score=this.scoreFunction(child1);// If the score is less than our element's, we need to swap.
if(child1Score<elemScore){swap=child1N;}}// Do the same checks for the other child.
if(child2N<length){var child2=this.content[child2N];var child2Score=this.scoreFunction(child2);if(child2Score<(swap===null?elemScore:child1Score)){swap=child2N;}}// If the element needs to be moved, swap it, and continue.
if(swap!==null){this.content[n]=this.content[swap];this.content[swap]=element;n=swap;}// Otherwise, we are done.
else{break;}}}};return{astar:astar,Graph:Graph,GridNode:GridNode};});"use strict";/**
* a class to provide methods to work with PC & NPC
*/var Character=/*#__PURE__*/function(){_createClass(Character,null,[{key:"defaultData",value:function defaultData(){return{id:'',name:'',faction:'Enemy',location:"Home",XP:0,//this is the XP you have earned but not yet spent
level:0,unspentStat:0,//on level up you get Stat-points to distribute
inv:[],//inventory data, needs to be mapped to Inventory-Instance
wardrobe:[],//separate wardobe data, needs to be mapped to outfit-Instance
outfit:[],// needs to be mapped to outfit-Instance
stats:[],effects:[],rel:[],skills:[]};}}]);function Character(externlist){_classCallCheck(this,Character);this._data=externlist?externlist:Character.defaultData();this.Outfit=new Outfit(this._data.outfit);this.Outfit._parent=window.gm.util.refToParent(this);this.Inv=new Inventory(this._data.inv);this.Inv._parent=window.gm.util.refToParent(this);this.Wardrobe=new Inventory(this._data.wardrobe);this.Wardrobe._parent=window.gm.util.refToParent(this);this.Stats=new StatsDictionary(this._data.stats);this.Stats._parent=window.gm.util.refToParent(this);this.Effects=new Effects(this._data.effects);this.Effects._parent=window.gm.util.refToParent(this);this.Rel=new StatsDictionary(this._data.rel);//Todo Relation similiar to stats?
this.Rel._parent=window.gm.util.refToParent(this);this.Skills=new Inventory(this._data.skills);this.Skills._parent=window.gm.util.refToParent(this);this.changeStance(new window.gm.StanceLib.StanceStanding());//create basic statsStanceStand
stHealth.setup(this.Stats,10,10),stEnergy.setup(this.Stats,30,30),stWill.setup(this.Stats,0,0),stPoise.setup(this.Stats,50,50);stSatiation.setup(this.Stats,30,100);var _iterator=_createForOfIteratorHelper(window.gm.combat.TypesDamage),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var n=_step.value;stResistance.setup(this.Stats,0,n.id);stArmor.setup(this.Stats,0,n.id);}}catch(err){_iterator.e(err);}finally{_iterator.f();}stAgility.setup(this.Stats,10,100),stIntelligence.setup(this.Stats,10,100),stLuck.setup(this.Stats,10,100);stCharisma.setup(this.Stats,10,100),stPerception.setup(this.Stats,10,100),stStrength.setup(this.Stats,10,100),stEndurance.setup(this.Stats,10,100);stSavageness.setup(this.Stats,0,10),stCorruption.setup(this.Stats,0,100),stArousal.setup(this.Stats,0,50);var _iterator2=_createForOfIteratorHelper(stFetish.listFetish()),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var name=_step2.value;stFetish.setup(this.Stats,0,10,name);}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}this.Skills.addItem(new SkillAttack());this.Skills.addItem(new SkillUseItem());this.Skills.addItem(new SkillStruggle());this.Skills.addItem(new SkillStandup());this.Skills.addItem(new SkillFlee());this.Skills.addItem(new SkillFairyLight());this.Effects.addItem(new effHunger());this.Effects.addItem(new effSanity());this.Effects.addItem(new effLibido());this.Effects.addItem(new effCombatRecovery());this.Effects.addItem(new effSpermDecay());window.storage.registerConstructor(Character);}_createClass(Character,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("Character",this);}},{key:"_relinkItems",value:function _relinkItems(){//need to recreate parent links
this.Effects._relinkItems();this.Stats._relinkItems();this.Inv._relinkItems();this.Outfit._relinkItems();this.Wardrobe._relinkItems();this.Rel._relinkItems();this.Skills._relinkItems();}/**
    * calculates how many levels you can upgrade
    * @param {int} XP available
    * @returns {int} level from
    */},{key:"addXP",value:function addXP(XP){this._data.XP+=XP;}/*
     * upgrade level by 1;this will increase level even if not enough XP !
    */},{key:"levelUp",value:function levelUp(){var add=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;if(add<1)return;var reqXP=Character.calcLevelToXP(this._data.level+add)-Character.calcLevelToXP(this._data.level);this._data.XP-=reqXP;//calculate requires XP and subtract from already gained
if(this._data.XP<0)this._data.XP=0;this._data.level+=add;this._data.unspentStat+=add*4;//todo ?pt Stat per Level?
}//overwrite this to define the wheighting for autoLeveling
//returns an array of objects with "id" matching the statname and "wgt" as a number that defines the relativ wheight (f.e. if 1 stat should be 50% more then other set this to 20 and all other to 10)
},{key:"autolevelWheight",value:function autolevelWheight(){return[{id:"strength",wgt:10},{id:"agility",wgt:11},{id:"intelligence",wgt:10},{id:"luck",wgt:8},{id:"charisma",wgt:8},{id:"perception",wgt:8},{id:"endurance",wgt:9}];}// this is called for NPC to automatically spent XP and distribute stat-points according to autolevelWheight-property
},{key:"autoLeveling",value:function autoLeveling(){var n,add=Character.calcXPToLevel(this._data.XP,this._data.level)-this._data.level;this.levelUp(add);var weight=this.autolevelWheight();var sort=function sort(a,b){return b.new-a.new;};while(this._data.unspentStat>0){//get the actual stats; immagine wgt as the goal-shape how the values are set at a certain level 
var sumC=0,sumG=0;var _iterator3=_createForOfIteratorHelper(weight),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){n=_step3.value;n.value=this.Stats.get(n.id).base;sumC+=n.value,sumG+=n.wgt;}//calculate the difference between current value and goal defined by playstyle
}catch(err){_iterator3.e(err);}finally{_iterator3.f();}var _iterator4=_createForOfIteratorHelper(weight),_step4;try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){n=_step4.value;//new is the difference in points; +1 to force distribution if the current matches the goal
n.new=Math.ceil((n.wgt/sumG-n.value/sumC)*sumC)+1;if(n.new<=0)n.new=1;}//and distribute pt
}catch(err){_iterator4.e(err);}finally{_iterator4.f();}weight=weight.sort(sort);var _iterator5=_createForOfIteratorHelper(weight),_step5;try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){n=_step5.value;var x=Math.floor(n.new);x=Math.min(this._data.unspentStat,2,x);this.Stats.increment(n.id,x);this._data.unspentStat-=x;}}catch(err){_iterator5.e(err);}finally{_iterator5.f();}}}},{key:"isDead",value:function isDead(){return this.Stats.get('health').value<=0;}},{key:"isKnockedOut",value:function isKnockedOut(){return this.isDead()||this.Stats.get('arousal').value>=this.Stats.get('arousalMax').value;}/** 
    * "naked" - naked
    * "primal" - cover genitals 
    * "civil" - wears some trousers,footwear and torsocovers
    * "formal" - ...wears underwear too
    */},{key:"clothLevel",value:function clothLevel(){//TODO
var uwOK=false,civOK=false;if(this.Outfit.getItemId(window.gm.OutfitSlotLib.uHips)!==''&&this.Outfit.getItemId(window.gm.OutfitSlotLib.uBreast)!==''){uwOK=true;}if(this.Outfit.getItemId(window.gm.OutfitSlotLib.Hips)!==''&&this.Outfit.getItemId(window.gm.OutfitSlotLib.Breast)!==''&&this.Outfit.getItemId(window.gm.OutfitSlotLib.Feet)!==''){civOK=true;}if(uwOK&&civOK)return"formal";if(civOK)return"civil";if(uwOK)return"primal";return'naked';}},{key:"health",value:function health(){return{value:this.Stats.get('health').value,max:this.Stats.get('healthMax').value,min:0};}},{key:"energy",value:function energy(){return{value:this.Stats.get('energy').value,max:this.Stats.get('energyMax').value,min:0};}},{key:"will",value:function will(){return{value:this.Stats.get('will').value,max:this.Stats.get('willMax').value,min:0};}},{key:"arousal",value:function arousal(){return{value:this.Stats.get('arousal').value,max:this.Stats.get('arousalMax').value,min:this.Stats.get('arousalMin').value};}},{key:"sleep",value:function sleep(){var until=arguments.length>0&&arguments[0]!==undefined?arguments[0]:700;var _window$gm$forwardTim=window.gm.forwardTime(until),msg=_window$gm$forwardTim.msg,delta=_window$gm$forwardTim.delta;var regen=delta>=360?9999:parseInt(delta/60*15);//todo scaling of regeneration
this.Stats.increment('health',regen);this.Stats.increment('energy',regen);this.Stats.increment('will',regen);if(delta>360){this.Effects.addItem(new effNotTired());}}},{key:"changeStance",value:function changeStance(stance){var res,_old=this.Stance;stance._parent=window.gm.util.refToParent(this);res=stance.transitFrom(_old);this.Stance=stance;if(_old){_old._parent=null;window.gm.printSfx('',res.msg);//combat display but only if not spawning
}}},{key:"updateStance",value:function updateStance(){//TODO if poise is below stance-requirement
var _new=this.Stance.checkStance();if(_new!=null){this.changeStance(_new);}return;}},{key:"hasEffect",value:function hasEffect(id){return this.Effects.countItem(id)>0;//todo also check for magnitude
}},{key:"addEffect",value:function addEffect(effect,id,who){this.Effects.addItem(effect,id);}//helper function to change Relation 
},{key:"gainRelation",value:function gainRelation(char,val){var _idx=this.Rel.findItemSlot(char);if(_idx<0){stRelation.setup(this.Rel,val,100,char);}else{this.Rel.increment(char,val);}}/**
     * helper function to handle wardrobe (not outfit!)/inventory properly; 
     * if amount<0 remove itme, else add
     */},{key:"changeInventory",value:function changeInventory(item,amount){var Inv=this.Inv,_rst;if(item.slotUse&&!item.hasTag(window.gm.ItemTags.Weapon)){//equipment goes into wardrobe except weapons
Inv=this.Wardrobe;}if(amount<0){_rst=Inv.removeItem(item.id,-1*amount);}else if(amount>0){_rst=Inv.addItem(item,amount);}return _rst;}//combat related
},{key:"_canAct",value:function _canAct(){//todo even if stunned we should be able to struggle
var result={OK:true,msg:''};if(this.Effects.findEffect("effStunned").length>0){//findItemSlot cannot use since there might be different effect ids
result.OK=false;result.msg=this.name+" is stunned and cannot react.";return result;}return result;}//combat related; return a msg describing the state of the character
//"Wolf is currently entangled by vines."
//"You have your towershield raised to guard against damage. Your mana is drained by an opponents spell."
},{key:"_stateDesc",value:function _stateDesc(){var result={OK:true,msg:''};var isPlayer=window.gm.player.id===this.id;for(var list=this.Effects.getAllIds(),i=list.length-1;i>=0;i-=1){if(list[i]==="effStunned"){result.msg="$[I]$ $[am]$ stunned and cant do a thing.";}}result.msg=window.gm.util.descFixer(this)(result.msg);return result;}},{key:"getPenis",value:function getPenis(){var penis=this.Outfit.getItemForSlot(window.gm.OutfitSlotLib.bPenis);return penis;}},{key:"getVagina",value:function getVagina(){var vulva=this.Outfit.getItemForSlot(window.gm.OutfitSlotLib.bVulva);return vulva;}},{key:"getAnus",value:function getAnus(){return this.Outfit.getItemForSlot(window.gm.OutfitSlotLib.bAnus);}},{key:"id",/**
     * id of char
     */get:function get(){return this._data.id;},set:function set(id){this._data.id=id;}},{key:"name",get:function get(){return this._data.name;},set:function set(name){this._data.name=name;}},{key:"faction",get:function get(){return this._data.faction;},set:function set(name){this._data.faction=name;}},{key:"location",get:function get(){return this._data.location;},set:function set(name){this._data.location=name;}},{key:"level",get:function get(){return this._data.level;}},{key:"canLevelUp",get:function get(){var next=Character.calcXPToLevel(this._data.XP,this._data.level);return next!==this._data.level;}}],[{key:"fromJSON",value:function fromJSON(value){var _x=window.storage.Generic_fromJSON(Character,value.data);_x._relinkItems();return _x;}},{key:"calcXPToLevel",value:function calcXPToLevel(XP){var fromLvl=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var XP2=Character.calcLevelToXP(fromLvl);return Math.floor((-1+Math.sqrt(1+(XP+XP2)*4/50))/2);}},{key:"calcLevelToXP",value:function calcLevelToXP(lvl){return 100*lvl*(lvl+1)/2;//Gauss-Sum
}}]);return Character;}();"use strict";/* bundles some operations related to combat */window.gm=window.gm||{};window.gm.combat=window.gm.combat||{};/**
 * damage types
 */window.gm.combat.TypesDamage=[{id:'blunt'},//physical
{id:'slash'},{id:'pierce'},{id:'spark'},//magic
{id:'ice'},{id:'fire'},{id:'light'},{id:'dark'},{id:'tease'},//arousal
{id:'poison'},{id:'acid'},{id:'poise'}//stability
];var Encounter=/*#__PURE__*/function(){function Encounter(){_classCallCheck(this,Encounter);this.enableFlee=true;this.EnemyFirst=false;this.EnemyFunc=null;//a ctor of Mob
this.Location='';//your actual location-name
this.scenePic='';//bg-image to use
//the following function should get reassigned;they should return a message what will happen next and provide a link to passage to follow f.e. return to window.gm.player.location
this.onStart=function(){return'A '+window.story.state.combat.enemyParty[0].baseName+' appears!'+(window.story.state.combat.enemyParty.length===1?"":"And it brought some backup. ")+window.gm.printPassageLink('Engage','EncounterStartTurn');};//...endCombat is called after this and if you need to check on effects, you have to do this here !
this.onDefeat=function(){return'</br></br>You are defeated.</br>'+window.gm.printLink('Next','window.gm.postDefeat()');};this.onSubmit=function(){return'</br></br>You submit to the foe.</br>'+window.gm.printLink('Next','window.gm.postDefeat()');};this.onFlee=function(){return'</br></br>You retreat hastily.</br>'+window.gm.printLink('Next','window.gm.postVictory({flee:true})');};//...dont forget to fetchLoot on victory
this.onVictory=function(){return'</br></br>You defeated the foe.</br> '+this.fetchLoot()+'</br>'+window.gm.printLink('Next','window.gm.postVictory({flee:false})');};//if you override onMoveSelect (like the others), you can jump out of battle, show some scene and return to battle
//- do not modify window.gm.player.location
//- disable save
//- jump back to EncounterStartTurn
//- the function is called before every move and will jump back there; you need to make sure that the scene doesnt trigger again 
//- if for some reason you want to leave battle, call window.gm.Encounter.endCombat() to cleanup
this.onMoveSelect=null;this._oldPrintSfx=null;}//setup encounter; this calls the Encounter-passage !
_createClass(Encounter,[{key:"initCombat",value:function initCombat(){var s=window.story.state;s.combat.enemyParty=this.EnemyFunc();s.combat.playerParty=[];var _iterator6=_createForOfIteratorHelper(s._gm.playerParty),_step6;try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){var n=_step6.value;s.combat.playerParty.push(s.chars[n]);}}catch(err){_iterator6.e(err);}finally{_iterator6.f();}s.combat.turnStack=[];s.combat.actor=s.combat.target=s.combat.action=null;s.combat.location=this.location;s.combat.scenePic=this.scenePic;s.combat.sceneDecoy=this.sceneDecoy?this.sceneDecoy:{fg:[],bg:[]};//{fg:['fg_fog'],bg:[]}  
s.combat.playerFleeing=false;s.combat.playerSubmitting=false;s.combat.inCombat=true;s.combat.enemyFirst=this.EnemyFirst;s.combat.turnCount=0;this.next=this.battleInit;this.msg='';window.story.show("EncounterStartTurn");}/**
 *spawns additional enemys or friends
 *called by effCallHelp at begin of turn
 * @param {*} item
 * @param {*} party
 * @return {*} 
 * @memberof Encounter
 */},{key:"spawnChar",value:function spawnChar(item,party,level){var s=window.story.state;var mob=window.gm.Mobs[item]();mob.scaleLevel(level);mob.faction=party,mob.despawn=true;var list=s.combat.enemyParty.concat(s.combat.playerParty);var uid=1;//need to build unique id
var _iterator7=_createForOfIteratorHelper(list),_step7;try{for(_iterator7.s();!(_step7=_iterator7.n()).done;){var n=_step7.value;if(mob.__proto__.isPrototypeOf(n)){//expecting Mole#2
uid=Math.max(uid,parseInt(n.name.split('#')[1],10)+1);};}}catch(err){_iterator7.e(err);}finally{_iterator7.f();}mob.name=mob.baseName+"#"+uid.toString();//need unique name !!
if(mob.faction==='Player'){mob.calcCombatMove=null;//hack to disable AI  todo
s.combat.playerParty.push(mob);}else{s.combat.enemyParty.push(mob);}return mob.name;}},{key:"replaceChar",value:function replaceChar(item,old){var s=window.story.state;var mob=window.gm.Mobs[item]();//todo needs sub-type
mob.scaleLevel(old.level);//todo level equal to old?
mob.faction=old.faction,mob.despawn=false;var uid=parseInt(old.name.split('#')[1],10);mob.name=mob.name+"#"+uid.toString();//need unique name !!
var list;if(mob.faction==='Player'){mob.calcCombatMove=null;//hack to disable AI  todo
list=s.combat.playerParty;}else{list=s.combat.enemyParty;}for(var i=0;i<list.length;i++){if(list[i].name===old.name){list[i]=mob;break;}}return mob.name;}},{key:"hideCombatOption",value:function hideCombatOption(){document.querySelector("#choice").remove();}//renders background & combatants to #canvas
},{key:"renderCombatScene",value:function renderCombatScene(){var width=600,height=300,pos,_pic,node,s=window.story.state;var holder,draw=document.querySelector("#canvas svg");if(!draw){draw=SVG().addTo('#canvas').size(width,height);draw.rect(width,height).attr({fill:'#303030'});draw.image(s.combat.scenePic);}else{draw=SVG(draw);//recover svg document instead appending new one
holder=draw.findOne('#holder');holder.remove();//remove all because they could be dead  todo only redraw if necessary
}holder=SVG().group({id:'holder'}).addTo(draw);//todo images flash when redrawing page; blitting backbuffer doesnt help: var draw2 = SVG(); -> draw2.addTo(draw);
var n,subnodes,i,list=[],list2=window.story.state.combat.enemyParty;for(i=list2.length-1;i>=0;i--){if(!list2[i].isKnockedOut()){//todo show deathsprite
list.push(list2[i]);}}if(s.combat.sceneDecoy.bg){for(i=s.combat.sceneDecoy.bg.length-1;i>=0;i--){//add background
_pic=window.gm.images[s.combat.sceneDecoy.bg[i]]();node=SVG(_pic);node.addTo(holder);}}var _pos=[[0.25,0.60,1],[0.75,0.50,1],[0.50,0.40,1]];//sprite position & scale in % x,y,z
if(list.length<=1){//1 large centered sprite
_pos=[[0.50,0.50,1]];}for(i=list.length-1;i>=0;i--){//add sprites
if(!list[i].isKnockedOut()){//todo show deathsprite
pos=_pos.pop();_pic=window.gm.images[list[i].pic]();node=SVG(_pic);//sprites should be scattered evenly and scaled down to fit into scene (with respect of offset in scene)
var scaleW2,scaleH2,scaleW=node.width()/(width*(1-Math.abs(0.5-pos[0])*2)),scaleH=node.height()/(height*(1-Math.abs(0.5-pos[1])*2));if(scaleW>0.9||scaleH>0.9){if(scaleW>scaleH)node.width(node.width()/(1.2*scaleW));else node.height(node.height()/(1.2*scaleH));}node.center(pos[0]*width,pos[1]*height);//reposit. AFTER scaling !
if(s.Settings.showNSFWPictures){//hide parts of sprite
var penis=list[i].getPenis()!==null,vagina=list[i].getVagina()!==null,arousal=list[i].arousal().value;subnodes=node.find('[data-male]');var _iterator8=_createForOfIteratorHelper(subnodes),_step8;try{for(_iterator8.s();!(_step8=_iterator8.n()).done;){n=_step8.value;penis?n.show():n.hide();}}catch(err){_iterator8.e(err);}finally{_iterator8.f();}subnodes=node.find('[data-female]');var _iterator9=_createForOfIteratorHelper(subnodes),_step9;try{for(_iterator9.s();!(_step9=_iterator9.n()).done;){n=_step9.value;vagina?n.show:n.hide();}}catch(err){_iterator9.e(err);}finally{_iterator9.f();}subnodes=node.find('[data-arousal]');var _iterator10=_createForOfIteratorHelper(subnodes),_step10;try{for(_iterator10.s();!(_step10=_iterator10.n()).done;){n=_step10.value;var y=n.attr('data-arousal').split(',');var x1=parseInt(y[0],10),x2=parseInt(y[1],10);if(arousal<x1||arousal>x2)n.hide();else n.show();}}catch(err){_iterator10.e(err);}finally{_iterator10.f();}}node.addTo(holder);}if(_pos.length<=0)break;}if(s.combat.sceneDecoy.fg){for(i=s.combat.sceneDecoy.fg.length-1;i>=0;i--){//add foreground
_pic=window.gm.images[s.combat.sceneDecoy.fg[i]]();node=SVG(_pic);node.addTo(holder);}}return;}//creates a list of active effects for combat display
},{key:"printCombatEffects",value:function printCombatEffects(char){var list=[];if(char.isKnockedOut()){//if char is dead print this instead other effects; effects also get not updated when dead??
list.push('knocked out');}else{var effects=char.Effects.getAllIds();for(var i=effects.length-1;i>=0;i--){var effect=char.Effects.get(effects[i]);if(effect.onCombatEnd!==null&&effect.onCombatEnd!==undefined){list.push(effect.iconTooltip);//'<div class="combateff"><div class="combaticon">'+effect.icon+'</div>'+ effect.shortDesc+'</div>');
}}}return list.reduce(function(sum,current){return sum+current;},'');//(list.reduce((sum, current) => sum + current +', ', '')).slice(0,-2));
}},{key:"statsline",value:function statsline(whom,mark){var msg='',bargraph=window.gm.util.bargraph;if(mark)msg="<td style=\"border-style:dotted;border-color:darkorchid;border-width:0.3em;\">";else msg="<td>";msg+=whom.name+" Lv"+whom.level+"</td><td>"+bargraph(whom.health().value,whom.health().max,"lightcoral")+"</td><td>"+(window.story.state._gm.enablePoise?bargraph(whom.Stats.get("poise").value,whom.Stats.get("poiseMax").value,"darkgrey"):"")+bargraph(whom.Stats.get("arousal").value,whom.Stats.get("arousalMax").value,"lightpink")+"</td><td>"+bargraph(whom.energy().value,whom.energy().max,"lightyellow")+bargraph(whom.Stats.get("will").value,whom.Stats.get("willMax").value,"lightblue")+"</td>";return msg;}//prints a table with all player/enemy data
},{key:"printStats",value:function printStats(){var s=window.story.state;var players=s.combat.playerParty;var enemys=s.combat.enemyParty;/*
              Health  Arousal          Health  Arousal 
      player1 10/20   10/20      Ork1  10/10   10/10
              Stunned
      player2 50/100  10/20      Ork2  20/20   10/100
  */var elmt='<table id=\"combatstats\"><tbody>';elmt+="<tr><th>Player</th><th>Health</th><th>"+(s._gm.enablePoise?"Poise</br>":"")+"Arousal</th><th>Energy</br>Will</th><th>   </th><th>Enemys</th><th>Health</th><th>"+(s._gm.enablePoise?"Poise</br>":"")+"Arousal</th><th>Energy</br>Will</th></tr>";for(var i=0;i<players.length||i<enemys.length;i++){elmt+="<tr>";if(i<players.length){elmt+=this.statsline(players[i],s.combat.actor&&s.combat.actor.name==players[i].name);}else{elmt+="<td></td><td></td><td></td><td></td>";}if(i<enemys.length){elmt+="<td></td>"+this.statsline(enemys[i],s.combat.actor==enemys[i]);}else{elmt+="<td></td><td></td><td></td><td></td><td></td>";}elmt+="</tr><tr>";if(i<players.length){//effects as additional row
elmt+="<td></td><td colspan='3' style=\"font-size:smaller\">"+(s._gm.enablePoise?players[i].Stance.id:"")+" "+window.gm.Encounter.printCombatEffects(players[i])+"</td>";}else{elmt+="<td></td><td></td><td></td><td></td>";}if(i<enemys.length){elmt+="<td></td><td></td><td colspan='3' style=\"font-size:smaller\">"+(s._gm.enablePoise?enemys[i].Stance.id:"")+" "+window.gm.Encounter.printCombatEffects(enemys[i])+"</td>";}else{elmt+="<td></td><td></td><td></td><td></td><td></td>";}elmt+="</tr>";}elmt+='</tbody></table>';return elmt;}//creates buttons for skills of current actor
},{key:"printSkillList",value:function printSkillList(){var res,item,entry,s=window.story.state;var canAct=s.combat.actor._canAct();entry=document.createElement('button');entry.addEventListener('click',function(me){return window.gm.Encounter._postSkillAbort.bind(me);}(this));entry.textContent="Do nothing";$("div#choice")[0].appendChild(entry);if(canAct.OK===true){var skillIds=s.combat.actor.Skills.getAllIds();skillIds.sort(function(a,b){if(a<b){return-1;}if(a>b){return 1;}return 0;});//todo how to sort the list in a useful manner?
for(var i=0;i<skillIds.length;i++){entry=document.createElement('button');item=s.combat.actor.Skills.getItem(skillIds[i]);//entry.href='javascript:void(0)';
entry.addEventListener("click",function(me,target){return window.gm.Encounter._postSkillSelect.bind(me,target);}(this,skillIds[i]));entry.textContent=item.name;res=item.isEnabled();entry.disabled=!res.OK;entry.title=res.msg;//Todo use pointevent+toasty?
$("div#choice")[0].appendChild(entry);// <- requires this node in html
}}else{//cannot do a thing
entry=document.createElement('p');entry.textContent=canAct.msg;$("div#choice")[0].appendChild(entry);}}},{key:"_postSkillAbort",value:function _postSkillAbort(){window.story.state.combat.action=null;window.gm.Encounter.next=window.gm.Encounter.checkDefeat;window.story.show('EncounterStartTurn');}},{key:"_postSkillSelect",value:function _postSkillSelect(id){window.story.state.combat.action=id;if(id==='UseItem'){window.gm.Encounter.next=window.gm.Encounter.selectItem;}else{window.gm.Encounter.next=window.gm.Encounter.selectTarget;}window.story.show('EncounterStartTurn');}},{key:"printTargetList",value:function printTargetList(){var s=window.story.state;var skill=s.combat.actor.Skills.getItem(s.combat.action);var all=s.combat.playerParty.concat(s.combat.enemyParty);var targets=[];var _iterator11=_createForOfIteratorHelper(all),_step11;try{for(_iterator11.s();!(_step11=_iterator11.n()).done;){var n=_step11.value;targets.push([n]);//need [[],[]]
}}catch(err){_iterator11.e(err);}finally{_iterator11.f();}var info=document.createElement('p');info.textContent=skill.desc;$("div#choice")[0].appendChild(info);targets=skill.targetFilter(targets);for(var i=0;i<targets.length;i++){var entry=document.createElement('a');entry.href='javascript:void(0)';entry.addEventListener("click",function(me,target){return window.gm.Encounter._postTargetSelect.bind(me,target);}(this,targets[i]));//if single-target, use name from mob, for multitarget we expect a name attribute to the list
entry.textContent=targets[i].length>1?targets[i].name:targets[i][0].name;$("div#choice")[0].appendChild(entry);// <- requires this node in html
}var entry=document.createElement('a');entry.href='javascript:void(0)';entry.addEventListener('click',function(me){return window.gm.Encounter._postTargetAbort.bind(me);}(this));entry.textContent="back";$("div#choice")[0].appendChild(entry);}},{key:"_postTargetAbort",value:function _postTargetAbort(){window.story.state.combat.action=null;window.gm.Encounter.next=window.gm.Encounter.selectMove;window.story.show('EncounterStartTurn');}},{key:"_postTargetSelect",value:function _postTargetSelect(target){this.hideCombatOption();window.story.state.combat.target=target;//(target.length)? target : [target] ;
window.gm.Encounter.next=window.gm.Encounter.execMove;window.story.show('EncounterStartTurn');}},{key:"printItemList",value:function printItemList(){var s=window.story.state;var inv=s.combat.actor.Inv;var maxSlots=inv.count();for(var i=0;i<maxSlots;i++){var _id2=inv.getItemId(i);var _count=inv.countItem(_id2);//if(useOn===null) useOn=s.combat.actor;
var useable=inv.usable(_id2);if(_count>0&&useable.OK){var _entry=document.createElement('a');_entry.href='javascript:void(0)';var foo=function(id,carrier){this._postItemSelect(id);}.bind(this,_id2);_entry.addEventListener("click",foo);_entry.textContent=_id2;$("div#choice")[0].appendChild(_entry);// <- requires this node in html
}}var entry=document.createElement('a');entry.href='javascript:void(0)';entry.addEventListener('click',function(me){return window.gm.Encounter._postTargetAbort.bind(me);}(this));entry.textContent="back";$("div#choice")[0].appendChild(entry);}},{key:"_postItemSelect",value:function _postItemSelect(id){var s=window.story.state;this.hideCombatOption();s.combat.actor.Skills.getItem(s.combat.action).item=id;window.gm.Encounter.next=window.gm.Encounter.selectTarget;window.story.show('EncounterStartTurn');}//if switching to Status panel and back this will redraw screen and call this.next; to avoid this set next only in clickhandler 
},{key:"printNextLink",value:function printNextLink(nextState){var label=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"Next";var entry=document.createElement('a');entry.href='javascript:void(0)';entry.addEventListener('click',function(me,nextState){return function(){window.gm.Encounter.next=nextState;window.story.show('EncounterStartTurn');};}(this,nextState));entry.textContent=label;$("div#choice2")[0].appendChild(entry);}//this function is used to render a message f.e. when an effect is applied
//temporary assign this function to window.gm.printSfx (which is called by other components)
},{key:"printSfx",value:function printSfx(id,msg){this.msg+=msg;window.gm.printOutput(this.msg);//var info = document.createElement('p');  info.textContent = msg;  $("div#output")[0].appendChild(info);
}},{key:"endCombat",value:function endCombat(){var s=window.story.state;s.combat.inCombat=false;//remove combateffects
var list=s.combat.enemyParty.concat(s.combat.playerParty);for(var k=0;k<list.length;k++){list[k].changeStance(new StanceStanding());//TODO no restore?
var effects=list[k].Effects.getAllIds();for(var i=0;i<effects.length;i++){var effect=list[k].Effects.get(effects[i]);if(effect.onCombatEnd!==null&&effect.onCombatEnd!==undefined){effect.onCombatEnd();}}}}/**
 * call this onVictory to grab loot & XP from Mobs
 */},{key:"fetchLoot",value:function fetchLoot(){//if you are victorious: grant XP & transfer Loot to player 
var n,s=window.story.state;var msg='',XP=0,maxLevel=0,_rnd=_.random(0,100);var _iterator12=_createForOfIteratorHelper(s.combat.playerParty),_step12;try{for(_iterator12.s();!(_step12=_iterator12.n()).done;){n=_step12.value;maxLevel=Math.max(maxLevel,n.level);}}catch(err){_iterator12.e(err);}finally{_iterator12.f();}var _x=window.gm.player.Stats.get('luck').value;_rnd=_rnd-Math.max(-25,Math.min(25,_x));//player luck capped
var _iterator13=_createForOfIteratorHelper(s.combat.enemyParty),_step13;try{for(_iterator13.s();!(_step13=_iterator13.n()).done;){n=_step13.value;for(var i=n.loot.length-1;i>=0;i--){if(_rnd<=n.loot[i].chance){msg+=n.loot[i].amount+'x '+n.loot[i].id+' ';window.gm.player.changeInventory(window.gm.ItemsLib[n.loot[i].id](),n.loot[i].amount);}}//XP reduced/increased if your level is bigger/smaller then foes by 25% per level
XP+=Math.floor(n.baseXPReward*Math.min(3,Math.max(0,1+(n.level-maxLevel)*0.25)));}}catch(err){_iterator13.e(err);}finally{_iterator13.f();}msg='</br>You got some loot: '+window.gm.util.formatNumber(XP,0)+'XP '+msg+'</br>';var _iterator14=_createForOfIteratorHelper(s.combat.playerParty),_step14;try{for(_iterator14.s();!(_step14=_iterator14.n()).done;){n=_step14.value;n.addXP(XP);//todo all get the same?
}}catch(err){_iterator14.e(err);}finally{_iterator14.f();}return msg;}},{key:"isAllDefeated",value:function isAllDefeated(party){for(var i=0;i<party.length;i++){if(!party[i].isKnockedOut())return false;}return true;}},{key:"calcTurnOrder",value:function calcTurnOrder(){var s=window.story.state;//todo sort by agility
//todo turnorder can be intermixed?
if(s.combat.enemyFirst){s.combat.turnStack=s.combat.enemyParty.concat(s.combat.playerParty);}else{s.combat.turnStack=s.combat.playerParty.concat(s.combat.enemyParty);}}/////////////////////  State Machine /////////////////////
//
},{key:"battleInit",value:function battleInit(){var list,result={OK:false,msg:''},s=window.story.state;this._oldPrintSfx=window.gm.printSfx;window.gm.printSfx=this.printSfx.bind(this);result.OK=true,result.msg=this.onStart();list=s.combat.enemyParty;for(var k=list.length-1;k>=0;k--){if(list[k].isKnockedOut()){if(list[k].despawn===true)list.splice(k,1);//remove spawned chars - you will not get loot for them !
continue;}}list=s.combat.playerParty;for(var _k=list.length-1;_k>=0;_k--){if(list[_k].isKnockedOut()){if(list[_k].despawn===true)list.splice(_k,1);//remove spawned chars - you will not get loot for them !
continue;}}list=s.combat.enemyParty.concat(s.combat.playerParty);//update combateffects
for(var _k2=list.length-1;_k2>=0;_k2--){var effects=list[_k2].Effects.getAllIds();for(var i=effects.length-1;i>=0;i--){var effect=list[_k2].Effects.get(effects[i]);if(effect.onCombatStart!==null&&effect.onCombatStart!==undefined){//typeof effect === CombatEffect doesnt work? so we check presense of attribut
/*this.msg+=*/window.gm.printSfx('',effect.onCombatStart().msg);//TODO
}}var skills=list[_k2].Skills.getAllIds();for(var _i2=skills.length-1;_i2>=0;_i2--){var skill=list[_k2].Skills.getItem(skills[_i2]);if(skill.onCombatStart!==null&&skill.onCombatStart!==undefined){skill.onCombatStart();}}}this.next=this.preTurn;return result;}},{key:"preTurn",value:function preTurn(){var result={OK:false,msg:''};var s=window.story.state,list;s.combat.turnCount+=1;list=s.combat.enemyParty;for(var k=list.length-1;k>=0;k--){if(list[k].isKnockedOut()){if(list[k].despawn===true)list.splice(k,1);//remove spawned chars - you will not get loot for them !
continue;}}list=s.combat.playerParty;for(var _k3=list.length-1;_k3>=0;_k3--){if(list[_k3].isKnockedOut()){if(list[_k3].despawn===true)list.splice(_k3,1);//remove spawned chars - you will not get loot for them !
continue;}}list=s.combat.enemyParty.concat(s.combat.playerParty);//update combateffects
for(var _k4=list.length-1;_k4>=0;_k4--){var effects=list[_k4].Effects.getAllIds();for(var i=effects.length-1;i>=0;i--){var effect=list[_k4].Effects.get(effects[i]);if(effect.onTurnStart!==null&&effect.onTurnStart!==undefined){//typeof effect === CombatEffect doesnt work? so we check presense of attribut
/*this.msg+=*/window.gm.printSfx('',effect.onTurnStart().msg);//TODO
}}var skills=list[_k4].Skills.getAllIds();for(var _i3=skills.length-1;_i3>=0;_i3--){var skill=list[_k4].Skills.getItem(skills[_i3]);if(skill.onTurnStart!==null&&skill.onTurnStart!==undefined){skill.onTurnStart();}}}//calculate turnorder
this.calcTurnOrder();this.next=this.checkDefeat;return result;}},{key:"checkDefeat",value:function checkDefeat(){//check if party is defeated
var result={OK:false,msg:''};var s=window.story.state;if(s.combat.playerFleeing===true){this.next=this.postBattle;return result;}else if(s.combat.playerSubmitting===true){this.next=this.postBattle;return result;}else if(this.isAllDefeated(s.combat.enemyParty)){this.next=this.postBattle;return result;}else if(this.isAllDefeated(s.combat.playerParty)){this.next=this.postBattle;return result;}this.next=this.selectChar;return result;}//select the next char to move
},{key:"selectChar",value:function selectChar(){var s=window.story.state;var result={OK:false,msg:''};if(s.combat.turnStack.length>0){//switch to next char
s.combat.actor=s.combat.turnStack.shift();//actual move = 0
s.combat.action=null;this.next=this.selectMove;}else{//next turn after all done
this.next=this.preTurn;}return result;}},{key:"targetFilterAlive",value:function targetFilterAlive(targets){//chars that are not dead
var possibleTarget=[];var _iterator15=_createForOfIteratorHelper(targets),_step15;try{for(_iterator15.s();!(_step15=_iterator15.n()).done;){var target=_step15.value;var valid=true;if(target.isKnockedOut())valid=false;//todo ..isDead()??
if(valid)possibleTarget.push(target);}}catch(err){_iterator15.e(err);}finally{_iterator15.f();}return possibleTarget;}},{key:"selectMove",value:function selectMove(){var s=window.story.state;var result={OK:false,msg:''};if(this.onMoveSelect!=null){result=this.onMoveSelect();if(result.OK)return result;}if(s.combat.actor.isKnockedOut()){//skip char if already dead
this.next=this.selectChar;return result;}var stateDesc=s.combat.actor._stateDesc();var canAct=s.combat.actor._canAct();if(canAct.OK===false){//skip char if not dead but incapaciated and show msg
//result.OK = true, 
result.msg=stateDesc.msg+"</br>"+canAct.msg;this.next=this.checkDefeat;return result;}else{if(s.combat.actor.isAIenabled&&s.combat.actor.calcCombatMove){//selected by AI
result=s.combat.actor.calcCombatMove(this.targetFilterAlive(s.combat.playerParty),this.targetFilterAlive(s.combat.enemyParty));s.combat.action=result.action;s.combat.target=result.target;this.next=this.execMove;//this.msg=result.msg,
result.OK=false;}else{this.printSkillList();result.OK=true,result.msg=stateDesc.msg+"</br></br>Choose action for "+s.combat.actor.name+"!</br>";}}return result;}},{key:"selectItem",value:function selectItem(){//select Item from Inventory
var s=window.story.state;var result={OK:false,msg:''};this.printItemList();result.OK=true,result.msg="Choose item";return result;}},{key:"selectTarget",value:function selectTarget(){//select target for choosen action
var s=window.story.state;var result={OK:false,msg:''};this.printTargetList();result.OK=true,result.msg="Choose target";return result;}},{key:"execMove",value:function execMove(){var result={OK:false,msg:''};var s=window.story.state;//apply move; AI might not find a possible action
if(s.combat.action!==null&&s.combat.action!==''){/*result.msg=*/s.combat.actor.Skills.getItem(s.combat.action).cast(s.combat.target).msg;}this.next=this.checkDefeat;return result;}},{key:"postBattle",value:function postBattle(){this.next=null;//terminate SM
var s=window.story.state;var result={OK:false,msg:''};window.gm.printSfx=this._oldPrintSfx;this._oldPrintSfx=null;//check if battle end reason...
if(s.combat.playerFleeing===true){result.OK=true,result.msg=this.onFlee();}else if(s.combat.playerSubmitting===true){result.OK=true,result.msg=this.onSubmit();}else if(this.isAllDefeated(s.combat.enemyParty)){result.OK=true,result.msg=this.onVictory();}else if(this.isAllDefeated(s.combat.playerParty)){result.OK=true,result.msg=this.onDefeat();}this.endCombat();return result;}/**
 * this runs the statemachine and is triggered by user input
 */},{key:"battle",value:function battle(){var result={OK:false,msg:''};this.msg='';while(this.next!==null&&!result.OK){//if result =true user input required- break loop and wait for click event (msg has to contain printNextLink-call !)
result=this.next();this.msg+=result.msg;window.gm.printOutput(this.msg);window.story.state.Settings.showCombatPictures?window.gm.Encounter.renderCombatScene():0;renderToSelector("#panel","statspanel");//if(result.OK){   result.msg = this.msg+result.msg;    return(result);  }
}return;}}]);return Encounter;}();/*
 * returns true if in combat
*/window.gm.combat.inCombat=function(){return window.story.state.combat.inCombat;};/**
 * bonusmultiplicator for target depending on level difference
 * @param {*} attacker 
 * @param {*} target 
 */window.gm.combat.lvlDiffBonus=function(attacker,target){return 1+(target.level-attacker.level)*0.15;};//+2lvl = + 30%
//calculates if target can evade the attack 
/*requires minimum Poise
Evasion depends on Agility & Endurance:
- mallus for heavy armor & weapon
- mallus for Effects like Prone, Frozen
- bonus for Skills: Flying, Dancer
Stunned/Bound Chars can not evade */ // on evasion returns false and a message
window.gm.combat.calcEvasion=function(attacker,target,attack){var result={OK:true,msg:''};var rnd=_.random(0,100);if(target.Effects.findItemSlot(effProtect.name)>=0){result.OK=false;result.msg=target.name+' is protected by some magic. ';return result;}if(target.Effects.findItemSlot(effStunned.name)>=0&&rnd>50){//todo chance to miss 
//a stunned target cannot dodge
result.OK=true;result.msg=target.name+' is stunned and cannot evade. ';attack.crit=true;//when stunned always critical hit
return result;}if(attacker.Effects.findItemSlot(effFlying.name)<0&&target.Effects.findItemSlot(effFlying.name)>=0&&rnd>50){//todo chance to miss 
//non-heay flying target can dodge out of range 
//todo evade by flying only for close combat attacks   
result.OK=false;result.msg=target.name+' dodges the attack with a flight maneuver. ';return result;}var lvlDiffBonus=window.gm.combat.lvlDiffBonus(attacker,target);var chance=0+lvlDiffBonus*(target.Stats.get("agility").value+target.Stats.get("perception").value);chance-=attack.mod.hitChance/100*(attacker.Stats.get("agility").value+attacker.Stats.get("perception").value);window.gm.pushLog("evasion roll: ".concat(chance," vs ").concat(rnd," "),window.story.state._gm.dbgShowCombatRoll);if(chance>rnd){result.OK=false;result.msg+='Using agility, '+target.name+' was able to dodge the attack.</br> ';}return result;};/*If evasion-roll fails, their is a chance that parry is rolled:
- consumes some poise
- parry only works for weapon of similiar size: a Zweihänder is to slow to parry a saber, a dagger is to light to deflect a club
- requires minimum weapon-skill (f.e. projectile deflection )
otherwise continue chain
parry-result depends on agility+perception
- bonus for skills
- bonus for some weapons
on critical fail- full damage, poise damage
on fail - full damage
on success no damage is taken (might consume weapon-stability)
if a critical is rolled, 50% of the attackers damage is reflected to him*/window.gm.combat.calcParry=function(attacker,target,attack){var result={OK:true,msg:'',foo:null};var rnd=_.random(0,100);if(target.Effects.findItemSlot(effStunned.name)>=0){result.OK=true;result.msg=target.name+' is stunned and cannot parry or block. ';attack.crit=true;//when stunned always critical hit
return result;}//todo block if has shield, parry if has weapon
var lvlDiffBonus=window.gm.combat.lvlDiffBonus(attacker,target);var chance=0+lvlDiffBonus*(target.Stats.get("agility").value+target.Stats.get("endurance").value);chance-=attack.mod.hitChance/100*(attacker.Stats.get("agility").value+attacker.Stats.get("endurance").value);window.gm.pushLog("parry roll: ".concat(chance," vs ").concat(rnd," "),window.story.state._gm.dbgShowCombatRoll);if(chance>rnd&&rnd<10){result.OK=false;if(rnd<10){result.msg=target.name+' parried the attack and was even able to land a hit.</br>';//todo how to add textual variation based on used weapon and skill?
attack.effects.push({target:attacker,eff:[effDamage.factory(5,"blunt")]});//todo how much damage? 
}else{result.msg=target.name+' parried the attack.</br> ';}}else{result.OK=true;}return result;};/*if all else failed you have to absorb the hit:
DR = sum of armor (with individual skill-bonus) + magic armor
attack = weapon damage formula + weakness-bonus
attack increases on critical
hp-dmg = attack -DR but min.1 */window.gm.combat.calcAbsorb=function(attacker,defender,attack){var result={OK:true,msg:''};var rnd=_.random(1,100);if(attack.mod.onCrit.length>0&&(rnd<attack.mod.critChance||attack.crit===true)){//is critical
attack.crit=true,result.msg='</br>'+defender.name+' got critical hit by '+attacker.name+" "+attack.mod.msg+'.</br>';var _iterator16=_createForOfIteratorHelper(attack.mod.onCrit),_step16;try{for(_iterator16.s();!(_step16=_iterator16.n()).done;){var n=_step16.value;attack.effects.push({target:n.target,eff:n.eff});//n.eff is []
}}catch(err){_iterator16.e(err);}finally{_iterator16.f();}}else{result.msg='</br>'+defender.name+' got hit by '+attacker.name+" "+attack.mod.msg+'.</br>';var _iterator17=_createForOfIteratorHelper(attack.mod.onHit),_step17;try{for(_iterator17.s();!(_step17=_iterator17.n()).done;){var n=_step17.value;attack.effects.push({target:n.target,eff:n.eff});}}catch(err){_iterator17.e(err);}finally{_iterator17.f();}}return result;};//object to store attack-data
window.gm.combat.defaultAttackData=function(){return{msg:'',value:0,total:0,crit:false,effects:[]};};// calculates the damage of an physical attack
window.gm.combat.calcAttack=function(attacker,defender,attack){var result={OK:false,msg:''};window.gm.combat.scaleEffect(attack);//check if target can evade
result=window.gm.combat.calcEvasion(attacker,defender,attack);if(result.OK===false){return result;}var _tmp=result.msg;//check if target can block or parry
result=window.gm.combat.calcParry(attacker,defender,attack);if(result.OK===false){return result;}_tmp+=result.msg;//deal damage
result=window.gm.combat.calcAbsorb(attacker,defender,attack);_tmp+=result.msg;result.msg=_tmp;return result;};/**
 * helper function to scale effective damage according to armor & resistance
 * @param {*} attack 
 */window.gm.combat.scaleEffect=function(attack){var res={OK:true,msg:''};function _adapt(op){var res={OK:true,msg:''};var target,dmg,rst,arm=0;for(var i=0;i<op.length;i++){target=op[i].target;var _iterator18=_createForOfIteratorHelper(op[i].eff),_step18;try{for(_iterator18.s();!(_step18=_iterator18.n()).done;){var n=_step18.value;if(n instanceof effDamage){//dmg = (attack-armor)*(100%-resistance) but min. 1pt
arm=target.Stats.getItem('arm_'+n.type).value;rst=target.Stats.getItem('rst_'+n.type).value;dmg=Math.max(1,(n.amount-arm)*(100-rst)/100);n.amount=dmg;if(target.Effects.findEffect("effMasochist").length>0){op[i].eff.push(effTeaseDamage.factory(dmg,'slut',{slut:1}));//todo lewd-calc
}}if(n instanceof effTeaseDamage){//todo no dmg if blinded, stunned,
//todo vulnerable if inHeat, like/dislike attacker
//bondage-fetish -> bonus for bond-gear
n.amount*=1+Math.sqrt(n.lewds.slut)/10;//bonus for slutty wear
arm=target.Stats.getItem('arm_tease').value;rst=target.Stats.getItem('rst_tease').value;dmg=Math.max(0,(n.amount-arm)*(100-rst)/100);//might cause 0 dmg
n.amount=dmg;}if(n instanceof effPoiseDamage){//TODO skill RESOLUTE gives invulnerability
arm=target.Stats.getItem('arm_poise').value;rst=target.Stats.getItem('rst_poise').value;dmg=Math.max(0,(n.amount-arm)*(100-rst)/100);//might cause 0 dmg
n.amount=dmg;}}}catch(err){_iterator18.e(err);}finally{_iterator18.f();}}return res;}_adapt(attack.mod.onHit);_adapt(attack.mod.onCrit);return res;};window.gm.combat.calcTeaseAttack=function(attacker,defender,attack){var result={OK:true,msg:''},_tmp='';window.gm.combat.scaleEffect(attack);//todo chance to fail?
//todo self-dmg if exhibitionist/stripper
result=window.gm.combat.calcAbsorb(attacker,defender,attack);//deal damage
/*if(attack.crit){ //todo text should be generated in Skill: "by tweezing those nipples on your gorgous DD bust..."
    result.msg = defender.name +' got heavily teased by '+attacker.name+'. ';
  } else {
    result.msg = defender.name +'\'s arousal increased. ';
  }*/_tmp+=result.msg;result.msg=_tmp;return result;};"use strict";/* bundles some operations related to dungeon navigation */window.gm=window.gm||{};window.gm.dng=window.gm.dng||null;//{};
//represents a button the player can press for directions N,E,S,W; this will also be used to generate the map
//if you have to connect 2 rooms, you have to define direction in both of them
var DngDirection=/*#__PURE__*/function(){_createClass(DngDirection,null,[{key:"createDirection",//creates direction between 2 rooms and assigns them to them; you can then modify them
value:function createDirection(DirEnum,RoomA,RoomB,options){options=options||{};var Label=DngDirection.DirEnumToString(DirEnum);var DirAtoB=new DngDirection(DirEnum,Label,null);var inverseDir=DngDirection.inverseDirection(DirEnum);var backLabel=DngDirection.DirEnumToString(inverseDir);var DirBtoA=new DngDirection(inverseDir,backLabel,null);DirAtoB.tags=options.tags||[];//todo should clone?
DirBtoA.tags=options.tags||[];DirBtoA.oneWay=options.onlyAtoB||false;DirAtoB.roomA=DirBtoA.roomB=RoomA;DirAtoB.roomB=DirBtoA.roomA=RoomB;if(RoomA!=null)RoomA.setDirection(DirEnum,DirAtoB);if(RoomB!=null)RoomB.setDirection(inverseDir,DirBtoA);}//returns the opposite direction f.e up-down
},{key:"inverseDirection",value:function inverseDirection(DirEnum){switch(DirEnum){case DngDirection.DirN:return DngDirection.DirS;break;case DngDirection.DirS:return DngDirection.DirN;break;case DngDirection.DirE:return DngDirection.DirW;case DngDirection.DirW:return DngDirection.DirE;break;case DngDirection.StairDown:return DngDirection.StairUp;break;case DngDirection.StairUp:return DngDirection.StairDown;break;default:break;}return 0;}//converts direction enum to label
},{key:"DirEnumToString",value:function DirEnumToString(DirEnum){var backLabel="";switch(DirEnum){case DngDirection.DirN:backLabel="N";break;case DngDirection.DirS:backLabel="S";break;case DngDirection.DirE:backLabel="E";break;case DngDirection.DirW:backLabel="W";break;case DngDirection.StairUp:backLabel="Stair up";break;case DngDirection.StairDown:backLabel="Stair down";break;default:break;}return backLabel;}//Enum for possible directions  ??static DirS = 2; doesnt work ??
},{key:"DirW",get:function get(){return 4;}},{key:"DirE",get:function get(){return 3;}},{key:"DirN",get:function get(){return 1;}},{key:"DirS",get:function get(){return 2;}},{key:"StairUp",get:function get(){return 6;}},{key:"StairDown",get:function get(){return 5;}}]);function DngDirection(dirEnum,name,descr){_classCallCheck(this,DngDirection);this.name=name,this.descr=descr===null?function(){return name;}:descr;this.direction=dirEnum;this.oneWay=false;this.tags=[];this.onExitFct=this.onEnterFct=null;//should return true if something is happening (aborts other fct-evaluation! )
this.canExitFct=null;this.roomA;//DngRoom;	//source room
this.roomB;//:DngRoom;	//target room
this.tooltip=this.descr();//tooltip of the button
}//gets called when player enters from this direction
_createClass(DngDirection,[{key:"onEnter",value:function onEnter(){if(this.onEnterFct==null)return false;return onEnterFct(this);}//gets called when player  exits into this direction
},{key:"onExit",value:function onExit(){if(this.onExitFct==null)return false;return this.onExitFct(this);}},{key:"canExit",//function to check if player can use this direction; you should also set tooltip for display
value:function canExit(){if(this.canExitFct==null)return!this.oneWay;return this.canExitFct(this);}//array or single tag  todo borrow those functions
},{key:"hasTag",value:function hasTag(tags){if(tags instanceof Array){for(var i=0;i<tags.length;i++){if(this.hasTag(tags[i]))return true;}return false;}return this.tags.includes(tags);}},{key:"removeTags",value:function removeTags(tags){for(var i=this.tags.length-1;i>=0;i--){if(tags.includes(this.tags[i]))this.tags.splice(i,1);}}},{key:"addTags",value:function addTags(tags){for(var i=tags.length-1;i>=0;i--){if(!this.tags.includes(tags[i]))this.tags.push(tags[i]);}}//the direction is hidden if one of the connected rooms is hidden
},{key:"hidden",value:function hidden(){return this.roomA.isHidden||this.roomB.isHidden;}}]);return DngDirection;}();// a room connected by directions
var DngRoom=/*#__PURE__*/function(){function DngRoom(name,descr,hidden,tags){_classCallCheck(this,DngRoom);this.name=name,this.descr=descr===null?function(){return name;}:descr;this.directions/*DngDirection*/=[null,null,null,null,null,null];//list of directions
this.isHidden=hidden;//those you can adjust
this.isDungeonExit=false;// player can leave to camp with Leave-button
this.isDungeonEntry=false;//when entering the dungeon player will be coming from here; there should only be one of this
this.operations/*DngOperations*/=[];//list of additional operations (= buttons you can press)
this.allowSave=false;this.onEnterFct=null;//should return true if something is happening, see also DngDirection.onEnterFct/onExitFct
this.tags=tags;//internal
this.it;this.fromRoom;}//the floor where the room is assigned to
_createClass(DngRoom,[{key:"setDirection",value:function setDirection(DirEnum,direction){var invalid=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;this.directions.splice(DirEnum-1,1,direction);}},{key:"getDirections",value:function getDirections(){return this.directions;}},{key:"getDirection",value:function getDirection(DirEnum){return this.directions[DirEnum-1];}},{key:"getDirectionToRoom",value:function getDirectionToRoom(other){var dir=null;for(var i=this.directions.length-1;i>=0;i--){var _dir=this.directions[i];if(_dir){if(_dir.roomB.name===other.name)break;}_dir=null;}return dir;}//this is called after the direction onEnter-Event was called
},{key:"onEnter",value:function onEnter(){this.isHidden=false;if(this.onEnterFct==null)return false;return this.onEnterFct(this);}},{key:"moveHere",value:function moveHere(from){//this.origResumeFct = this.floor.dungeon.inRoomedDungeonResume;
this.fromRoom=from;this.it=0;//a counter to keep track from what iteration to continue
//this.floor.dungeon.resumeRoom=this.moveIterator.bind(this);
this.moveIterator();}// Whats that good for: onExit or onEnter might trigger an interaction/combat that we have to finish first befor displaying navigation buttons again.
// iterator->onExit->startCombat->won->doNext(resume)->iterator
// this is currently not used because it wouldnt work if there is a trigger deeper inside a function that would require to leave and return to that function
},{key:"moveIterator",value:function moveIterator(){var dir;//DngDirection;
var _it=0;//call Exit function from previous room
var _dirs=this.fromRoom.getDirections();for(var i=0;i<_dirs.length;i++){var element=_dirs[i];_it=_it+1;if(element==null)continue;if(_it<=this.it)continue;this.it=_it;dir=element;// as DngDirection;
if(dir.roomA==this.fromRoom&&dir.roomB==this){if(dir.onExit()){return;}}}//call Entry function of this room
_dirs=this.getDirections();for(var i=0;i<_dirs.length;i++){var element1=_dirs[i];_it=_it+1;if(element1==null)continue;if(_it<=this.it)continue;this.it=_it;dir=element1;if(dir.roomA==this&&dir.roomB==this.fromRoom){if(dir.onEnter()){return;}}}_it=_it+1;if(_it>this.it&&this.onEnter()){this.it=_it;return;}_it=_it+1;if(_it>this.it&&this.floor.dungeon.onEnterRoom!==null&&this.floor.dungeon.onEnterRoom(this)){//todo if there are multiple events on enter?
/*this.it = _it;
            return;*/}this.floor.dungeon.resumeRoom();//this.floor.dungeon.inRoomedDungeonResume = this.floor.dungeon.resumeRoomMenu;//this.origResumeFct;
//this.floor.dungeon.inRoomedDungeonResume();
}//gets called when entering the floor or room; override it to update the other properties
},{key:"updateRoom",value:function updateRoom(){}},{key:"floor",get:function get(){return this._parent();}}]);return DngRoom;}();//a floor of the dungeon
//a floor consist of several rooms that are arranged in a xy-coordinate system
//every room is connected up to 4 surrounding rooms, + stairs to lower/higher floor; 
var DngFloor=/*#__PURE__*/function(){function DngFloor(name,descr){_classCallCheck(this,DngFloor);this.rooms=[];//list of rooms
this.descr=descr===null?function(){return name;}:descr;this.name=name;//label of the floor 
this.Mobs=[];//list of mobs on actual floor
}_createClass(DngFloor,[{key:"addMob",value:function addMob(mob){mob._parent=window.gm.util.refToParent(this);this.Mobs.push(mob);}},{key:"removeMob",value:function removeMob(mob){for(var i=this.Mobs.length-1;i>=0;i--){if(this.Mobs[i]===mob)this.Mobs.splice(i,1);}}},{key:"setRooms",value:function setRooms(Rooms){this.rooms=Rooms;var found=null;for(var i=0;i<this.rooms.length;i++){var element=this.rooms[i];if(element==null)continue;found=element;if(found!=null){//found.floor = this;
found._parent=window.gm.util.refToParent(this);}}}},{key:"allRooms",value:function allRooms(){return this.rooms;}},{key:"getRoom",value:function getRoom(Name){var found=null;for(var i=0;i<this.rooms.length;i++){var element=this.rooms[i];if(element==null)continue;found=element;if(found.name==Name){break;}found=null;}return found;}},{key:"getRoomByXY",value:function getRoomByXY(x,y){var found=null;for(var i=0;i<this.rooms.length;i++){found=this.rooms[i];if(found===null)continue;if(found.x===x&&found.y===y){return found;}}return null;}},{key:"dungeon",get:function get(){return this._parent();}}]);return DngFloor;}();// an additional operation that the player can trigger by pressing a button
var DngOperation=/*#__PURE__*/function(){function DngOperation(name){_classCallCheck(this,DngOperation);this.name=name;//label of the button
}_createClass(DngOperation,[{key:"canTrigger",//function to check if player can use this button
value:function canTrigger(){return false;}//override this to do something;
/* f.e set window.gm.dng.renderEvent to a function that creates a html-string (including links)
    then call window.story.show("DungeonGenericEvent") to render that event
    add a link that calls window.gm.dng.resumeRoom() to continue in dungeon
     */},{key:"onTrigger",value:function onTrigger(){}}]);return DngOperation;}();/**
 * 
 */var DngDungeon=/*#__PURE__*/function(){function DngDungeon(){_classCallCheck(this,DngDungeon);this.name=this.constructor.name;//name of the dungeon
//this.descr =  function(){return(this.name)};//text diplayed when entering the dungeon
var persistData=window.story.state.dng[this.name];if(persistData===undefined||persistData===null){persistData=window.story.state.dng[this.name]=this.persistentDngDataTemplate();}//todo when loading savegame the Dungeon will be new constructed but fetches story.state to restore persistent data
//need a way that mob-data is also pulled from there (reove mobs and restore according to persitent data)
this.data=persistData;this.floors=[];//list of Dngfloors
this.actualRoom=null;this.Mapper=new DngMapperSVG();//DngMapper; 
this.buttons=[];this.onEnterRoom=null;//global onEnter
this.fctStack=[];this.inRoomedDungeonResume=null;this.evtData={id:0},this.renderEvent=function(id){return"You have to set a function to renderEvent before calling renderNext"+window.gm.printLink("Whatever","window.gm.dng.resumeRoom()");};this.mapReveal=[],this.visitedTiles=[];//todo where to store this?
this.legend="<pre>Legend: P=Player, &ang;=Stair, E=Entry/Exit S=Save</pre>";}/**
     * override this
     */_createClass(DngDungeon,[{key:"descr",value:function descr(){return this.name;}//override this to return a data-object that will be used to store persistent data
},{key:"persistentDngDataTemplate",value:function persistentDngDataTemplate(){return{};}},{key:"setFloors",value:function setFloors(Floors){this.floors=Floors;for(var i=0;i<this.floors.length;i++){this.floors[i]._parent=window.gm.util.refToParent(this);}}},{key:"allFloors",value:function allFloors(){return this.floors;}},{key:"getFloor",value:function getFloor(Name){var found=null;for(var i=0;i<this.floors.length;i++){found=this.floors[i];if(found==null)continue;if(found.name==Name){break;}found=null;}return found;}/*
    * called when going from one floor to another
    */},{key:"floorChange",value:function floorChange(oldFloor,newFloor){this.Mapper.createMap(newFloor);var map=this.Mapper.allInfo;for(var i=map.length-1;i>=0;i--){var room=newFloor.getRoom(map[i].name);room.x=map[i].X,room.y=map[i].Y;//need coordinates for pathfinding
}}//enters the dungeon; also does some checks to verify that dungeon was properly setup
},{key:"enterDungeon",value:function enterDungeon(){this.actualRoom=null;//this.resumeRoom=this.resumeRoomMenu;
var Entry=null;var Exit=null;var Room;//search the dungeon-Entry, has to be in first floor
var rooms=this.floors[0].allRooms();for(var i=0;i<rooms.length;i++){Room=rooms[i];if(Room.isDungeonEntry){Entry=Room;}if(Room.isDungeonExit){Exit=Room;}}if(Entry==null||Exit==null){throw new Error('Error: Dungeon-Exit or Entry missing');}this.floorChange(Entry.floor,Entry.floor);this.moveToRoom(Entry);// playerMenu();
}//used to exit the dungeon via Leave-button or by battledefeat
//You need to override this to return to a proper passage with window.story.show
//You should also set window.gm.dng=null to release memory
},{key:"exitDungeon",value:function exitDungeon(){window.gm.dng=null;window.story.state.dng.id="";//clear or load would send you into dng again
}//similiar to moveTo except no onenter/onexit processing
},{key:"teleport",value:function teleport(Room){this.actualRoom=null;this.moveToRoom(Room);}//move to an ADJOINING room next to the actual one
//this might trigger onenter/onexit scenes, those scenes should then call resumeRoom to finish room-swap
},{key:"moveToRoom",value:function moveToRoom(newRoom){var _actualRoom=this.actualRoom;this.actualRoom=newRoom;if(_actualRoom!=null){if(_actualRoom.floor!==newRoom.floor)this.floorChange(_actualRoom.floor,newRoom.floor);newRoom.moveHere(_actualRoom);//this will trigger onExit/onEnter
}else{this.resumeRoom();}}},{key:"renderNext",value:function renderNext(id){window.gm.dng.evtData.id=id;window.story.show("DungeonGenericEvent");}},{key:"clearButtons",value:function clearButtons(){this.buttons=[];for(var i=0;i<15;i++){//up to 15 buttons
this.buttons.push({name:"",disabled:true,func:null,data:null,more:{}});}}},{key:"addButton",value:function addButton(bt,name,func,arg,more){this.buttons[bt]={name:name,disabled:false,func:func,data:arg,more:more};}},{key:"addButtonDisabled",value:function addButtonDisabled(bt,name,more){this.buttons[bt]={name:"-",disabled:true,func:null,more:more};}/**
     * override this to add text to the room-scene. If you add buttons here, make sure to call resumeRoom to continue dungeon.
     */},{key:"printRoomScene",value:function printRoomScene(){var panel=$("div#panel2")[0];var entry=document.createElement('p');entry.textContent="Nothing here beside us chicks.";panel.appendChild(entry);}//render 5x3 grid of buttons; see passage "Dungeon"
},{key:"printButtons",value:function printButtons(){//because click-event mapping this has to manipulate DOM-tree instead of just rendering html-code
var table=document.createElement('table');var tbody=document.createElement('tbody');table.appendChild(tbody);for(var y=0;y<3;y++){var tr=document.createElement('tr');tbody.appendChild(tr);for(var x=0;x<5;x++){var _bti=y*5+x,_bt=this.buttons[_bti];//<a0 onclick=getBanana(this,5)>Get more banana</a>
var td=document.createElement('td');tr.appendChild(td);var entry=document.createElement('button');entry.style='min-width: 4em';entry.addEventListener("click",_bt.func?function(me,bt){return bt.func.bind(me,bt.data);}(this,_bt):null);if(_bt.more&&_bt.more.tooltip)entry.title=_bt.more.tooltip;entry.textContent=_bt.name;entry.disabled=_bt.disabled;td.appendChild(entry);//$("div#panel")[0].appendChild(entry);
}}$("div#panel")[0].appendChild(table);}},{key:"pushFct",value:function pushFct(fct){this.fctStack.push(fct);}},{key:"resumeRoom",value:function resumeRoom(){if(this.fctStack.length<=0){this.resumeRoomMenu();return;}var fct=this.fctStack.shift();fct();}},{key:"resumeRoomMenu",value:function resumeRoomMenu(){/*		Menu Layout
            * 		[ Op1 ]	[ Op2 ]	[ Op3 ]	[ Op4 ]	[More ]
            * 		[ Up  ]	[  N  ]	[Down ]	[Mast ]	[     ]
            * 		[  W  ]	[  S  ]	[  E  ]	[ Inv ]	[ Map ]
            *  
            */this.clearButtons();this.actualRoom.updateRoom();var bt;var btMask=0xE;this.actualRoom.getDirections().forEach(function(element,index,arr){var Dir=element;if(Dir==null)return;bt=Dir.direction;if(bt==DngDirection.DirN)bt=6;else if(bt==DngDirection.DirS)bt=11;else if(bt==DngDirection.DirE)bt=12;else if(bt==DngDirection.DirW)bt=10;else if(bt==DngDirection.StairDown)bt=7;else if(bt==DngDirection.StairUp)bt=5;if(Dir.canExit()){this.addButton(bt,Dir.name,this.moveToRoom,Dir.roomB,{tooltip:Dir.tooltip});}else{this.addButtonDisabled(bt,Dir.name,{tooltip:Dir.tooltip});}btMask=btMask^1>>>bt;},this);this.addButton(14,"Map",this.displayMap);//.hint("View the map of this dungeon.");
bt=0;var _iterator19=_createForOfIteratorHelper(this.actualRoom.operations),_step19;try{for(_iterator19.s();!(_step19=_iterator19.n()).done;){var n=_step19.value;if(bt>4)break;if(n===null)continue;if(n.canTrigger())this.addButton(bt,n.name,n.onTrigger);else this.addButton(bt,n.name,"");bt+=1;}}catch(err){_iterator19.e(err);}finally{_iterator19.f();}if(this.actualRoom.isDungeonExit){for(var i=5;i<15;i++){//find an empty navigation button for leave
bt=i;if((btMask<<i&1)==0)break;}this.addButton(bt,"Leave",this.exitDungeon,false);}//add _nosave_ tag except allowed; because there could be some fct running in each room, it would be diffivcult to recover those after save
//only allow save where nothing special is happening !
var tags=window.story.passage("Dungeon").tags;for(var i=tags.length-1;i>=0;i--){if(tags[i]==='_nosave_')tags.splice(i,1);}if(!window.gm.dng.actualRoom.allowSave){//todo should we allow defferedEvents or could this mess with onEnter/onExit-calls?
tags.push('_nosave_');}var _state=window.story.state.dng;_state.roomId=this.actualRoom.name;_state.id=this.name;_state.floorId=this.actualRoom.floor.name;window.story.show("Dungeon");//call the scene
}//shows a map-screen
},{key:"displayMap",value:function displayMap(){window.story.show("DungeonMap");}},{key:"addMob",value:function addMob(mob,floor){this.getFloor(floor).addMob(mob);}},{key:"removeMob",value:function removeMob(mob,floor){this.getFloor(floor).removeMob(mob);}},{key:"tickMobs",value:function tickMobs(){var newturn=true,repeat=true;while(repeat===true){repeat=false;for(var i=this.actualRoom.floor.Mobs.length-1;i>=0;i--){var mob=this.actualRoom.floor.Mobs[i];mob.tick(newturn);repeat=repeat||mob.data.remainAP>0;}newturn=false;/*while(this.fctStack.length>0){ if a mob moves 2 tiles and hits a trap on 1.move, we should check if its still alive before doing 2.move
                todo this doesnt work: a fct is executed but then we will continue here instead waiting for user input and the screen will be overwritten
                mob.doessomething->renderEvent->wait for userinput->resumeRoom->continue here
                this.resumeRoom();
            }*/}//todo some enemies should be faster then player: each mob has AP; loop again over all mobs that still have AP until they are all 0
}}]);return DngDungeon;}();var DngMob=/*#__PURE__*/function(){function DngMob(){_classCallCheck(this,DngMob);this.data={name:'bad Bull',homeTile:'',actualTile:'',path:[],idle:'wait',// wait / hide
mode:'idle',// hunt / seek / wait / return / flee
speed:1,//1 = moves 1tile per playerturn, 2 moves 2 tiles, 0.33 moves 1 Tile in 3 turns     
startAP:1,remainAP:0};}//needs to be set with ._parent=window.gm.util.refToParent(this);
_createClass(DngMob,[{key:"decide",/*
    * implement sensors here
    */value:function decide(){}/* 
    * implements action
    * return true if scene plays 
    * to return back to dungeon add to scene window.gm.printLink('Next','window.gm.dng.resumeRoom()')
    */},{key:"do",value:function _do(){return false;}/**
     * implement what happens if player is met
     * return true if scene plays 
     */},{key:"onCollidePlayer",value:function onCollidePlayer(){return false;}/**
     * implement what happens if mob is met
     * return true if scene plays 
     */},{key:"onCollideMob",value:function onCollideMob(mob){return false;}//call to calculate
},{key:"tick",value:function tick(newturn){if(newturn)this.data.remainAP=this.data.startAP;this.data.remainAP-=1;if(!this.enabled||this.data.remainAP<0)return;this.decide();return this.do();}},{key:"floor",get:function get(){return this._parent();}},{key:"dungeon",get:function get(){return this.floor.dungeon;}},{key:"enabled",get:function get(){return true;}}]);return DngMob;}();// a helper class to store info for a room for mapper
var DngMapperInfo=function DngMapperInfo(){_classCallCheck(this,DngMapperInfo);this.X=this.Y=0;this.name="";this.hidden=false;this.connect=0;//bitwise encoding of directions
this.boss='';//boss-marker
};// builds the map from the dungeons info and actualRoom
// it is expected that all rooms in a floor are somehow connected with each other - no isolated rooms !
var DngMapper=/*#__PURE__*/function(){function DngMapper(){var CBMoreInfo=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;_classCallCheck(this,DngMapper);this.dungeon=this.floor=null;this.allInfo=[];this.CBMoreInfo=CBMoreInfo;this.maxX=this.maxY=this.minX=this.minY=0;}//todo only show parts of the map the player already visited or knows off - but this would bloat save
_createClass(DngMapper,[{key:"createMap",value:function createMap(Floor){this.floor=Floor;var allrooms=Floor.allRooms();var roomIndexs=[];this.allInfo=new Array(allrooms.length);var dirs;var dir;//:DngDirection;
var room,room2;var x,y,m;var roomInfo=new DngMapperInfo();var roomInfo2;roomInfo.X=x=this.maxX=this.minX=0;roomInfo.Y=y=this.maxY=this.minY=0;/*  put 1.room of actual floor to dictionary, set coord XY ={0,0]
        *  get next room from dictionary until no more
        *  	for every direction of room
        * 			get targt room and place into dictionary
        * 			depending of direction, add flags to source & target room
        * 			calculate coord of target room  (f.e. direction =E then X/Y = {+1 , +0})
        * 		...
        *  ...
        */this.allInfo[0]=roomInfo;roomIndexs[0]=0;for(var i=0;i<roomIndexs.length;i++){m=roomIndexs[i];room=allrooms[m];roomInfo=this.allInfo[m];roomInfo.name=room.name;roomInfo.hidden=roomInfo.hidden||room.isHidden;roomInfo.Entry=/*room.isDungeonEntry ||*/room.isDungeonExit;roomInfo.Save=room.allowSave;if(this.CBMoreInfo!==null)roomInfo=this.CBMoreInfo(roomInfo);dirs=room.getDirections();for(var k=0;k<dirs.length;k++){if(dirs[k]==null)continue;dir=dirs[k];room2=dir.roomB;roomInfo.connect=roomInfo.connect+(1<<dir.direction);m=allrooms.indexOf(room2);if(m>=0){//create new roominfo and set coordinate
roomInfo2=new DngMapperInfo();roomInfo2.hidden=dir.hidden();switch(dir.direction){case DngDirection.DirN:roomInfo2.X=roomInfo.X;roomInfo2.Y=roomInfo.Y-1;break;case DngDirection.DirS:roomInfo2.X=roomInfo.X;roomInfo2.Y=roomInfo.Y+1;break;case DngDirection.DirE:roomInfo2.X=roomInfo.X+1;roomInfo2.Y=roomInfo.Y;break;case DngDirection.DirW:roomInfo2.X=roomInfo.X-1;roomInfo2.Y=roomInfo.Y;break;default:break;}//check if room is outside of print-area and expand
if(roomInfo2.X<this.minX)this.minX=roomInfo2.X;if(roomInfo2.X>this.maxX)this.maxX=roomInfo2.X;if(roomInfo2.Y<this.minY)this.minY=roomInfo2.Y;if(roomInfo2.Y>this.maxY)this.maxY=roomInfo2.Y;if(roomIndexs.indexOf(m)<0){//add room to info-array
roomIndexs.push(m);this.allInfo[m]=roomInfo2;}}}}return;}/* now we have a dictonary of all rooms, their coordinate and flags
        * create 2DArray of size ( 2*(maxX-minX) , 2*(maxY-minY)) ; even indices store rooms "[ ]", uneven indices store directions " - "
        * for every room in dictionary
        * 		update Array[2*(X-minX)][2*(Y-minY)] with room-information
        * 		update Array[2*(X-1-minX)][2*(Y-0-minY)] with W-direction
        * 		update Array[2*(X-0-minX)][2*(Y-1-minY)] with N-direction
        * 		aso.
        * ...
        * now we can print something like this:
        * 	[ ]-[ ]-[ ]-[S]
        *   |	 |	 |   |	
        *  [ ]-[P]-[ ]-[ ]
    */},{key:"printMap",value:function printMap(playerRoom,minimap){//Todo use images or special font instead ascii?
var _line="";var map=[];var roomInfo;var i,j;var playerX=0,playerY=0;this.createMap(playerRoom.floor);//todo only recreate if necessary
//create 2d-array to store textual representation of room and connection between them
map=new Array(2*(this.maxX-this.minX)+1);for(i=0;i<map.length;i++){var submap=new Array(2*(this.maxY-this.minY)+1);for(j=0;j<submap.length;j++){submap[j]="   ";}map[i]=submap;}//convert the MapperInfo to textual representation
for(i=0;i<this.allInfo.length;i++){if(this.allInfo[i]==null)continue;roomInfo=this.allInfo[i];var room=playerRoom.floor.getRoom(roomInfo.name);_line=" ";if(roomInfo.connect&1<<DngDirection.StairDown||roomInfo.connect&1<<DngDirection.StairUp){_line="&ang;";}if(playerRoom!=null&&playerRoom.name==roomInfo.name){_line="P";playerX=roomInfo.X,playerY=roomInfo.Y;}if(roomInfo.Save&&playerRoom.name!=roomInfo.name){_line="S";}if(roomInfo.Entry&&playerRoom.name!=roomInfo.name){_line="E";}if(roomInfo.boss!==''&&playerRoom.name!=roomInfo.name){_line=roomInfo.boss;}//each room/connection has to be 3 chars long or it will messup formatting !
//todo format as table?
if(!room.isHidden){_line="["+_line+"]";map[2*(roomInfo.X-this.minX)][2*(roomInfo.Y-this.minY)]=_line;//&loz; = Raute, &cap;=Tor, &cup;= inv. Tor, # = Gitter
var dir=room.getDirection(DngDirection.DirN);if(dir){//roomInfo.connect & (1 << DngDirection.DirN)){
_line=dir.tags[0]==='duct'?" o ":" | ";map[2*(roomInfo.X-this.minX)+0][2*(roomInfo.Y-this.minY)-1]=_line;}dir=room.getDirection(DngDirection.DirE);if(dir){//(roomInfo.connect & (1 << DngDirection.DirE))){
_line=dir.tags[0]==='duct'?"ooo":"---";map[2*(roomInfo.X-this.minX)+1][2*(roomInfo.Y-this.minY)+0]=_line;}dir=room.getDirection(DngDirection.DirS);if(dir){//((roomInfo.connect & (1 << DngDirection.DirS))){
_line=dir.tags[0]==='duct'?" o ":" | ";map[2*(roomInfo.X-this.minX)+0][2*(roomInfo.Y-this.minY)+1]=_line;}dir=room.getDirection(DngDirection.DirW);if(dir){//((roomInfo.connect & (1 << DngDirection.DirW))){
_line=dir.tags[0]==='duct'?"ooo":"---";map[2*(roomInfo.X-this.minX)-1][2*(roomInfo.Y-this.minY)-0]=_line;}}}//print
_line='<pre style="border-style: ridge;padding: 0.2em;">';//pre-formatted or messup allignment of ascii-rows
if(minimap){//only print rooms 1 step around player
_line+=this.floor.name+"</br>";var nop,x,y,n=5;//6 = 3rooms&3 directions around player
for(j=-1*n;j<=n;j++){nop=true;for(i=-1*n;i<=n;i++){x=i+(playerX-this.minX)*2,y=j+(playerY-this.minY)*2;//coord can be negative ! 
if(map.length-1<x||0>x)continue;if(map[x].length-1<y||0>y)continue;nop=false;_line+=(i==-3?"&nbsp;":"")+map[x][y];//todo hack:if line starts with -, snowman-markdown interprets this as <ul> ?!
}if(!nop)_line+="\n";//skip empty lines
}}else{//full map of floor
_line+=this.floor.dungeon.name+" "+this.floor.name+"</br>";for(j=0;j<2*(this.maxY-this.minY)+1;j++){for(i=0;i<2*(this.maxX-this.minX)+1;i++){_line+=map[i][j];}_line+="\n";}_line+=this.printLegend();}_line+="</pre>";return _line;}},{key:"printLegend",value:function printLegend(){return"<pre>Legend: P=Player, &ang;=Stair, E=Entry/Exit S=Save</pre>";}}]);return DngMapper;}();var DngMapperSVG=/*#__PURE__*/function(_DngMapper){_inherits(DngMapperSVG,_DngMapper);var _super=_createSuper(DngMapperSVG);function DngMapperSVG(){var _this;var CBMoreInfo=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;_classCallCheck(this,DngMapperSVG);_this=_super.call(this,CBMoreInfo);_this.step=40,_this.height=_this.width=12;_this.X=['A','B','C','D','E','F','G','H','I','J','K','L','M','N'];_this.Y=['0','1','2','3','4','5','6','7','8','9'];return _this;}_createClass(DngMapperSVG,[{key:"nameToXY",value:function nameToXY(name){var i,pos={x:0,y:0};i=this.Y.findIndex(function(_x){return _x===name[1];});pos.y=i*this.step;//if(i<0||i>=Y.length-1) return('');
i=this.X.findIndex(function(_x){return _x===name[0];});pos.x=i*this.step;//if(i<0||i>=Y.length-1) return('');
return pos;}},{key:"printMap",value:function printMap(playerRoom,minimap,visitedTiles,reveal){this.createMap(playerRoom.floor);//todo only recreate if necessary
this.width=this.step*(this.maxX-this.minX+2),this.height=this.step*(this.maxY-this.minY+2);var mypopup=document.getElementById("svgpopup");//todo popup-functions as parameters
function showPopup(evt){//var iconPos = evt.getBoundingClientRect();
mypopup.style.left=evt.x+12+"px";//(iconPos.right + 20) + "px";
mypopup.style.top=evt.y-12+"px";//(window.scrollY + iconPos.top - 60) + "px";
mypopup.textContent=evt.currentTarget.id;mypopup.style.display="block";}function hidePopup(evt){mypopup.style.display="none";}function addAnno(){//add up to 4 annotation-letters
var dx2=[6,6,-6,-6],dy2=[0,10,10,0];//
var roomInfo={name:room.name,boss:''};if(this.CBMoreInfo!==null)roomInfo=this.CBMoreInfo(roomInfo);var k,_info=[roomInfo.boss];for(k=_info.length-1;k>=0;k--){if(k>3)continue;lRoom.text(function(add){add.tspan(_info[k]);}).addClass('textLabel').ax(_rA.cx()+ox+dx2[k]).ay(_rA.cy()+oy+dy2[k]);}}var draw=document.querySelector("#canvas svg");if(!draw)draw=SVG().addTo('#canvas').size(this.width,this.height);else draw=SVG(draw);//recover svg document instead appending new one
draw.rect(this.width,this.height).attr({fill:'#303030'});var node=SVG(window.gm.images['template3']());//get the source-svg
node.size(this.width,this.height);var lRoom=node.find('#layer1')[0];//fetch a layergroup by id to add to
var lPath=node.find('#layer2')[0];var tmpl=node.find('#tmplRoom')[0];var ox=tmpl.cx(),oy=tmpl.cy();//offset tmpl
if(playerRoom.name!==''&&visitedTiles.indexOf(playerRoom.name)<0){visitedTiles.push(playerRoom.name);}var _rA,i,k,xy,room,dir,dirs;var xyB,dx,dy;var frooms=playerRoom.floor.allRooms();for(i=frooms.length-1;i>=0;i--){// foreach room create room
room=frooms[i];xy=this.nameToXY(room.name);_rA=lRoom.use('tmplRoom').attr({id:room.name,title:room.name}).move(xy.x,xy.y);//var link = document.createElement('title');    link.textContent=room.room;    _rA.put(link);// appendchild is unknown // adding title to use dosnt work - would have to add to template
_rA.node.addEventListener("mouseover",showPopup);_rA.node.addEventListener("mouseout",hidePopup);if(visitedTiles.indexOf(room.name)<0){//reveal new room
if(reveal.indexOf(room.name)<0){_rA.addClass('roomNotFound');}else{_rA.addClass('roomFound');addAnno.call(this);}}else{if(room.name===playerRoom.name){_rA.removeClass('roomFound').addClass('playerPosition');}else _rA.addClass('roomVisited');addAnno.call(this);dirs=room.getDirections();for(k=dirs.length-1;k>=0;k--){//foreach direction create path to next room
dir=dirs[k];if(dir===null)continue;xyB=this.nameToXY(dir.roomB.name);dx=xyB.x-xy.x,dy=xyB.y-xy.y;lPath.polyline([[_rA.cx()+ox,_rA.cy()+oy],[_rA.cx()+ox+dx/2,_rA.cy()+oy+dy/2]]).addClass('pathFound');//.insertBefore(_rA)
}}}//todo legend as ?? node.text(function(add){add.tspan(playerRoom.floor.dungeon.legend||'')}).addClass('textLabel2').ax(0).ay(0);
node.addTo(draw);}}]);return DngMapperSVG;}(DngMapper);"use strict";window.gm=window.gm||{};//game related operations
window.gm.util=window.gm.util||{};//utility functions
var IDGenerator=/*#__PURE__*/function(){//extends Singleton{
function IDGenerator(){_classCallCheck(this,IDGenerator);if(IDGenerator._instance){return IDGenerator._instance;}IDGenerator._instance=this;this._idCounter=1;window.storage.registerConstructor(IDGenerator);}_createClass(IDGenerator,[{key:"toJSON",//add _ or queryselector() might not work if id starts with number ?!
value:function toJSON(){return window.storage.Generic_toJSON("IDGenerator",this);}}],[{key:"instance",value:function instance(){if(!IDGenerator._instance){return new IDGenerator();}return IDGenerator._instance;}},{key:"resetID",value:function resetID(useID){//this should be only called after reload
//hack: reloading save causes constructor calls causes calls to createID which would increase counter (the ids are reverted by merging loaded data into the constructed objects)
//so we need a way to revert this increase
IDGenerator.instance()._idCounter=useID;}},{key:"createID",value:function createID(){var x=IDGenerator.instance()._idCounter++;return"_"+x;}},{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(IDGenerator,value.data);}}]);return IDGenerator;}();// helper for publisher/subscriber-pattern; myObject.ps =PubSub(); myObject.ps.subscribe(...
// !! warning, dont use for objects that need to be loaded from savegame
// the reviver calls constructor of nested objects multiple times which lead to multiple registrations with partially incomplete objects in the PubSub;
// since there are no destructors, there is no easy way to cleanup
window.gm.util.PubSub=function(){return{events:{},subscribe:function subscribe(event,handler){if(!this.events[event]){this.events[event]=[];}this.events[event].push(handler);},unsubscribe:function unsubscribe(event,handler){if(!this.events[event])return;var i=this.events[event].indexOf(handler);if(i>=0)this.events.splice(i,1);},publish:function publish(event,data){this.events[event]&&this.events[event].forEach(publishData);function publishData(handler){handler(data);};}};};// can be used to create deep clones of class-obj; 
// requires that the class has registered its constructor to window.storage 
// and class implements _relinkItems() to restore parent-ship of sub-objects
window.gm.util.deepClone=function(obj){var clone=JSON.parse(JSON.stringify(obj),window.storage.Reviver);clone._relinkItems();return clone;};// can be used to deepclone plain {}-objects; use deepClone for objects from classes !
window.gm.util.deepCloneObj=function(obj){return JSON.parse(JSON.stringify(obj));};//compare 2 arrays of basic datatype
window.gm.util.arrayEquals=function(a,b){return Array.isArray(a)&&Array.isArray(b)&&a.length===b.length&&a.every(function(val,index){return val===b[index];});};// Adds key shortcut indicators to links in passage if there are less than 11 links in the passsage. see addShortKeyHandler.
// Enables keyboard shortcuts if passage do not have the "_noshortkey_" tag and links dont have attribute "data-nokey"; 
window.gm.util.updateLinks=function(Container){var tags=window.story.passage(window.passage.name).tags;if(!tags.includes("_noshortkey_")){var Links=[],Nodes,i;if(typeof Container==="undefined"){Container=document;Nodes=document.querySelector('tw-passage').querySelectorAll('a,button');//all links within page    todo how about buttons
}else{Nodes=Container.querySelectorAll('a,button');}if(Nodes.length>0){for(i=0;i<Nodes.length;i++){if(Nodes[i].getAttribute("data-nokey")=="true"||Nodes[i].parentElement.getAttribute("data-nokey")=="true"||Nodes[i].parentElement.hidden||Nodes[i].parentElement.disabled){}else{Links.push(Nodes[i]);}}}if(Links.length>=1){//&& Links.length <= 10){
var n=1;for(i=0;i<Links.length;i++){if(Links[i].id===""&&!Links[i].disabled&&!Links[i].hidden){//!Links[i].id.includes("Link")){
while(document.querySelector("#Link"+n)){//$(Container).find("#Link" + n).length){ //check for existing links
++n;if(n>10){break;}}if(n<10){Links[i].innerHTML+="<sup>["+n+"]</sup>";//$("<sup>[" + n + "]</sup>").appendTo(Links[i]);
Links[i].id="Link"+n;}else if(n===10){Links[i].innerHTML+="<sup>["+0+"]</sup>";Links[i].id="Link0";break;}else{break;}}}}}};// registers keyup event handler for shortkey-mechanic; requires that updateLinks has assigned special id to buttons & href 
// (this means it doesnt work for those that already have a different id assigned)
// only call this one time or multiple events cause weird behaviour
window.gm.util.addShortKeyHandler=function(){document.addEventListener("keyup",function(e){if(window.story.state._gm&&window.story.state._gm.nokeys===true)return;//if in dialog overlay, the shortkeys would still work for the panel; this flag surpresses it
var tags=window.story.passage(window.passage.name).tags;if(!tags.includes("_noshortkey_")){var n;/*different way to dispatch events const event = new MouseEvent('click', {
        view: window, bubbles: true, cancelable: true
      });
      //el.dispatchEvent(event);*/ // Trigger link click on keys "0" through "9"
if(e.keyCode>47&&e.keyCode<58){n=document.querySelector("#Link"+(e.keyCode-48));if(n){e.preventDefault();//$("#Link" + (e.keyCode - 48)).trigger("click"); dont use jquery - click is not working if bound by addEventListener
n.click();}}// Trigger link click on numpad keys "0" through "9"
if(e.keyCode>95&&e.keyCode<106){n=document.querySelector("#Link"+(e.keyCode-96));if(n){e.preventDefault();n.click();}}if(["d","i","s","o","q"].indexOf(e.key)>=0){//some special keys of hud
n=document.querySelector("#Link"+e.key.toUpperCase());if(n){e.preventDefault();n.click();}}// Trigger random click on "." key
/*if (e.key == "."){
        e.preventDefault();
        var Links = $("#passages a"), n, UsableLinks = [];
        if (Links.length > 0){
          for (n = 0; n < Links.length; n++){
            if (!$(Links[n]).data("nokey")){
              UsableLinks.push(n);
            }
          }
          if (UsableLinks.length > 0){
            n = random(UsableLinks.length - 1);
            Links[UsableLinks[n]].click();
          }
        }
      }*/}});};//returns normal distributed random value, mu= mean, 0 by default; sigma= stdev, 1 by default; nsamples= more samples creates better approximation, 3 by default
window.gm.util.randomNormal=function(mu,sigma,nsamples){// using central limit
if(!nsamples)nsamples=3;if(!sigma)sigma=1;if(!mu)mu=0;var run_total=0;for(var i=0;i<nsamples;i++){run_total+=Math.random();}return sigma*(run_total-nsamples/2)/(nsamples/2)+mu;};window.gm.util.selRandom=function(list){//picks element from []
var _i=list.length;if(_i>0)return list[_.random(0,_i-1)];else throw new Error("empty list");};//exchange inner text of ctrl ;connect it with onclick of a link/button. 
//list = [ ['red','1','classRed'],['green','2','classGreen'] ]  text,datavalue,css-class (notice space between [ [ !)
//f.e. <p>This is really a <a0 onclick="window.gm.util.swapText(this,[ ['red Color','1','red'],['green color','2','green'] ])">blue</a> game.</p>
//you will have to query data-value or use the callback to get the choice: document.getElementById('myButton').getAttribute("data-value")
window.gm.util.swapText=function(ctrl,list,params){var _params$rnd,_params$retrys;var _params=params||{};_params.rnd=(_params$rnd=_params.rnd)!==null&&_params$rnd!==void 0?_params$rnd:false;//function to randomize next pick; false to non-random
_params.retrys=(_params$retrys=_params.retrys)!==null&&_params$retrys!==void 0?_params$retrys:-1;//how many times until locked
//_params.onchange  callback
var _list=[],i;var x=ctrl.getAttribute("data-retrys");x=parseInt(x);if(isNaN(x))x=0;if(_params.retrys>0&&_params.retrys-x<=0)return;x++;list.forEach(function(element,index){_list.push(element[1]);ctrl.classList.remove(element[2]);//remove all formatting
});if(_params.rnd===false){i=_list.indexOf(ctrl.getAttribute("data-value"));if(i==-1||i==_list.length-1)i=0;else i++;}//Todo changing text removes keyboard links 
//Todo need to memorize data- for restorePage
ctrl.innerText=list[i][0]+(_params.retrys>0?" ◌"+(_params.retrys-x).toString():"");//◌= display number of retrys
ctrl.setAttribute("data-value",list[i][1]);ctrl.setAttribute("data-retrys",x.toString());ctrl.classList.add(list[i][2]);};//create pretty name for passage; requires a tag (replace space with _ !) [name:"My_Room"]
window.gm.util.printLocationName=function(passage){var tags=window.story.passage(passage).tags;var _iterator20=_createForOfIteratorHelper(tags),_step20;try{for(_iterator20.s();!(_step20=_iterator20.n()).done;){var n=_step20.value;var ar=n.split(":");if(ar.length>1&&ar[0]==='name'){return ar[1].split('_').join(' ');}}}catch(err){_iterator20.e(err);}finally{_iterator20.f();}return passage;};//prints a div with text "value/max" and bargraph-background
window.gm.util.bargraph=function(value,max,color){var text=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"";var msg='';var rel=value/max*100;msg='<div class="progressbar"><div style="background-color:'+color+'; width: '+rel.toString()+'%;"><div style="width: max-content;">'+text+window.gm.util.formatNumber(value,1)+'/'+max.toString()+'</div></div></div>';return msg;//todo bargraph css-animation doesnt work because the whole page is reloaded instead of just width change
};//returns html colorcode for keyword: "health"-> red
window.gm.util.colorFor=function(id){var c='black';switch(id){case'health':c='lightcoral';break;case'energy':c='lightyellow';break;case'will':c='lightblue';break;case'poise':c='darkgrey';break;case'arousal':c='lightpink';break;case'satiation':c='rosybrown';break;case'savageness':c='darkred';break;default:break;}return c;};window.gm.util.statsbar=function(what,color){var x=window.gm.player.Stats.get(what),y=window.gm.player.Stats.get(what+"Max");if(x.hidden>=4)return"";if(!color)color=window.gm.util.colorFor(what);return window.gm.util.bargraph(x.value,y.value,color,what+": ");};/* Uploads SVG files from local file system, based on file selected in input; https://github.com/fizzstudio/svg-load-save */window.gm.util.loadLocalSVG=function(event){var file=event.target.files[0];// FileList object
if(file){var file_reader=new FileReader();if("image/svg+xml"==file.type){file_reader.readAsText(file);file_reader.addEventListener("load",function(){var file_content=file_reader.result;window.gm.util.insertSvg(file_content);}.bind(this),false);}}};/* Inserts SVG files into HTML document */window.gm.util.insertSvg=function(file_content){//TODO fixthis
// insert SVG file into HTML page
var svg_container=document.getElementById("svg_container");svg_container.innerHTML=file_content;// TODO: insert any SVG handler here
// adds `click` event listener to inserted SVG to test modification of SVG file, for later saving
if(this.event_handler){svg_container.firstChild.addEventListener("click",this.event_handler,false);}};window.gm.util.fitSVGtoContent=function(id){var svg=document.getElementById(id);/*const _arr= [...svg.children]
  const { xMin, xMax, yMin, yMax } = _arr.reduce((acc, el) => {
      const { x, y, width, height } = el.getBBox();
      if (!acc.xMin || x < acc.xMin) acc.xMin = x;
      if (!acc.xMax || x + width > acc.xMax) acc.xMax = x + width;
      if (!acc.yMin || y < acc.yMin) acc.yMin = y;
      if (!acc.yMax || y + height > acc.yMax) acc.yMax = y + height;
      return acc;
    }, {});
  const viewbox = `${xMin} ${yMin} ${xMax - xMin} ${yMax - yMin}`;*/ //let viewbox=svg.children[0].getAttribute('viewBox');
//svg.setAttribute('viewBox',viewbox );
//todo iterating over children doesnt work; also if sub-svg has a viewbox you still need to take width/height into account 
//let _w=svg.children[0].getAttribute('width'),_h=svg.children[0].getAttribute('height');
//svg.setAttribute('viewBox',"0 0 "+_w+' '+_h );
//svg.style.width=xMax - xMin; svg.style.height=yMax - yMin;
};/*
* use this to merge multiple objects into one. If used with class-objects their methods will go missing!
* this will properly deep-merge nested objects (not like Object.assign)
*/window.gm.util.mergePlainObject=function(){var target={};// deep merge the object into the target object
var merger=function merger(obj){for(var prop in obj){if(obj.hasOwnProperty(prop)){if(Object.prototype.toString.call(obj[prop])==='[object Object]'){// if the property is a nested object
target[prop]=window.gm.util.mergePlainObject(target[prop],obj[prop]);}else{// for regular property
target[prop]=obj[prop];}}}};// iterate through all objects and deep merge them with target
for(var i=0;i<arguments.length;i++){merger(i<0||arguments.length<=i?undefined:arguments[i]);}return target;};//-------------------------------------------------
// reimplement to setup the game !
// debug notice: if you get "Cannot read properties of undefined" check the constructor dictionary if something is missing. This indicates an compiling error in those items (check in the sorting order of the script-files) 
window.gm.initGame=function(forceReset){var NGP=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var s=window.story.state;//s in template is window.story.state from snowman!
if(!s._gm){window.gm.toasty=new Toasty();window.gm.util.addShortKeyHandler();}$(window).on('sm.passage.showing',function(event,eventObject){// Current Passage object
$("tw-passage").fadeIn(500);//fade in if was previously faded out
//console.log('showing '+eventObject.passage.name);
});// Render the passage named HUD into the element todo replace with <%=%>??
$(document).on('sm.passage.shown',function(ev,eventObject){window.gm.refreshSidePanel();window.gm.restorePage();});$(window).on('sm.story.error',function(event,eventObject){// window.story
console.log(eventObject);});if(!window.gm.timeEvent||forceReset){window.gm.timeEvent=window.gm.util.PubSub();//subscribe to "change" event to receive time updates
// !! make sure to reregister after load !
}if(!s.quests||forceReset){s.quests=new QuestData();window.gm.quests=new QuestManager(window.gm.questDef);window.gm.quests.setQuestData(s.quests);window.gm.quests.pubSub.subscribe("change",function(data){window.gm.toasty.info("Quest "+data.questId+" updated");});}if(!s._gm||forceReset){s._gm={version:window.gm.getSaveVersion(),style:'default',//css profile to use
log:[],IDGenBkup:0,IDGen:new IDGenerator(),passageStack:[],//used for passage [back] functionality
defferedStack:[],//used for deffered events
onholdStack:[],//used for deffered events
time:700,//represented as hours*100 +minutes
day:1,//daycount
activePlayer:'',//id of the character that the player controls currently
nosave:false,nokeys:false,enablePoise:false,//enables Poise-System
playerParty:[],//names of NPC in playerParty 
debug:false,//globally enables debug
dbgShowCombatRoll:false,//log combat calculation details
dbgShowQuestInfo:false,//show internal quest state
dbgShowMoreInfo:false};}if(!s.dng||forceReset){//stores the state of the current dungeon
s.dng={id:"",floorId:"",roomId:""};}if(!s.tmp||forceReset){// storage of temporary variables; dont use them in stacking passages or deffered events      
s.tmp={flags:[],//can store flags for showing/hidding page-elements 
args:[],// can be used to set arguments before another passage is called (passage-arguments) 
msg:''// memorizes a message to display when returning from _back-passage; please clear it when leaving the passage
};}if(!s.chars||forceReset){s.chars={};}if(!s.chars.GlobalChest||forceReset){var ch=new Character();ch.id=ch.name="GlobalChest";ch.faction="Player";s.chars.GlobalChest=ch;}if(!s.chars.LocalChest||forceReset){//
var _ch2=new Character();_ch2.id=_ch2.name="LocalChest";_ch2.faction="Player";s.chars.LocalChest=_ch2;}if(!s.combat||forceReset){//see encounter & combat.js
s.combat={enemyParty:[],//collection of enemy-chars involved 
enemyIdx:0,//index of actual enemy 
playerParty:[],playerIdx:0,enemyFirst:false,//if true, enemy moves first
inCombat:false,//for query window.gm.combat.inCombat
turnCount:0,scenePic:'assets/bg_park.png'};}};//reimplement for your game !
window.gm.newGamePlus=function(){var NGP={//be mindful if adding complex objects to NGP, they might not work as expected ! simple types are ok 
crowBarLeft:window.story.state.vars.crowBarLeft};window.gm.initGame(true,NGP);window.story.show('Home');};//reimplement this to handle version upgrades on load !
window.gm.rebuildObjects=function(){var s=window.story.state;s._gm.nokeys=false;IDGenerator.resetID(s.IDGenBkup);window.styleSwitcher.loadStyle();//since style is loaded from savegame
window.gm.quests.setQuestData(s.quests);//necessary for load support
window.gm.switchPlayer(s._gm.activePlayer);};//called before data is serialized
window.gm.preSave=function(){var s=window.story.state;s.IDGenBkup=IDGenerator.instance()._idCounter;};//--------------- time management --------------
//returns timestamp since start of game
window.gm.getTime=function(){return window.story.state._gm.time+2400*window.story.state._gm.day;};/*
* calculates timedifference a-b for hhmm time format; retuns minutes ! 
*/window.gm.getDeltaTime=function(a,b){var m=a%100;var h=(a-m)/100;var m2=b%100;var h2=(b-m2)/100;return h*60+m-(h2*60+m2);};//adds MINUTES to time
window.gm.addTime=function(min){var v=window.story.state._gm;var m=v.time%100;var h=parseInt((v.time-m)/100);m=m+min;var m2=m%60;var h2=h+parseInt((m-m2)/60);window.story.state._gm.time=h2*100+m2%60;while(window.story.state._gm.time>=2400){window.story.state._gm.time-=2400;window.story.state._gm.day+=1;}window.gm.timeEvent.publish("change",min);if(window.gm.player.Effects)window.gm.player.Effects.updateTime();//todo not happy with that; see PubSub-comment
if(window.gm.player.Outfit)window.gm.player.Outfit.updateTime();// updating all existing chars might not be wise (some could be dead)
// but what if I have to update other chars too?
//
};window.gm.getTimeString=function(){var c=window.gm.getTimeStruct();return(c.hour<10?"0":"")+c.hour.toString()+":"+(c.min<10?"0":"")+c.min.toString()+"("+c.daytime+")";};// DoW = DayOfWeek  7 = Sunday, 1 = Monday,...6 = Saturday 
window.gm.getTimeStruct=function(){var v=window.story.state._gm;var m=v.time%100;var h=(v.time-m)/100;var daytime='';if(v.time>500&&v.time<1000){daytime='morning';}else if(v.time>=1000&&v.time<1400){daytime='noon';}else if(v.time>=1400&&v.time<1800){daytime='afternoon';}else if(v.time>=1800&&v.time<2200){daytime='evening';}else{daytime='night';}var DoW=window.story.state._gm.day%7;return{'hour':h,'min':m,'daytime':daytime,'DoW':DoW};};window.gm.DoWs=['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday'];window.gm.getDateString=function(){var v=window.story.state._gm;return v.day.toString()+". day "+window.gm.DoWs[v.day%8-1];};//forward time to until (1025 = 10:25)
//warning dont write 0700 because this would be take as octal number
window.gm.forwardTime=function(until){var v=window.story.state._gm;var msg='';var m=v.time%100;var h=parseInt((v.time-m)/100);var m2=until%100;var h2=parseInt((until-m2)/100);var min=(h2-h)*60+(m2-m);//if now is 8:00 and until 10:00 we assume you want to sleep 2h and not 2+24h
//if now is 10:00 and until is 9:00 we assume sleep for 23h
if(until<v.time){min=24*60-(h-h2)*60-(m-m2);}if(min===0){//if sleep from 700 to 700, its a day
min=24*60;}msg+="</br>"+min%60+" hours pass by.</br>";window.gm.addTime(min);window.gm.pushLog(msg);return{msg:msg,delta:min};};// use: child._parent = window.gm.util.refToParent(parent);
window.gm.util.refToParent=function(me){return function(){return me;};};//todo causes problem with replaceState??
//since there is no builtin function to format numbers here is one: formatNumber(-1002.4353,2) -> 1,002.44  
window.gm.util.formatNumber=function(n,dp){var sign=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var out='',s=''+(dp>0?n>0?Math.floor(n):Math.ceil(n):Math.round(n)),d=Math.abs(n%1),i=s.length,r='';while((i-=3)>0){r=','+s.substr(i,3)+r;}//todo . & , is hardcoded
out=s.substr(0,i+3)+r;if(sign){out=(n>=0?'+':'')+out;}return out+(dp>0?'.'+(d?Math.round(d*Math.pow(10,dp)):'0'.repeat(dp)):'');};/** formatInt is meant for formating integer to string; n may be decimal and gets rounded
 * sign: if true prepend + if positive 
 * width: if not null prepend 0s to stuff; disables 1000s indicator
 * <%=window.gm.util.formatInt(-1234.66,true,5)%> -01235</br>
*  <%=window.gm.util.formatInt(1234.66,true,5)%> +01235</br>
 */window.gm.util.formatInt=function(n){var sign=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var width=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var out='',s=''+Math.abs(Math.round(n)),i=s.length,r='';if(width!=null){out='0'.repeat(Math.max(0,width-i))+s;}else{while((i-=3)>0){r=','+s.substr(i,3)+r;}//1000s marking; todo . & , is hardcoded
out=s.substr(0,i+3)+r;}if(sign){out=(n>=0?'+':'-')+out;}return out;};//---------------------------------------------------------------------------------
//TODO 
//maybe you sometimes dont want to trigger an event immediatly, 
//f.e. if you send a email, it might take some time until you get a response-email 
//(you can receive email at anytime on your phone, so we would have to add checks on ALL passages)
//use this function to push a passage to a stack of deffered events; 
//the passage will trigger under the given condition: minimum time, location-tag, at a certain time-window
//the passage will show when a new passage is requested and will be removed from stack
//if this passage is already pushed, only its condition will be updated
window.gm.pushDeferredEvent=function(id,args){var front=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;/*var cond1 = {waitTime: 6,
                locationTags: ['Home','City'],      //Never trigger in Combat
                dayTime: [1100,600]
              },
        cond2 = { waitTime: 60,
                  locationTags: ['Letterbox'],
        };
      */var cond=[];//[cond1,cond2]; //passage is executed if any of the conds is met
if(front){window.story.state._gm.defferedStack.unshift({id:id,cond:cond,args:args});}else{window.story.state._gm.defferedStack.push({id:id,cond:cond,args:args});}};window.gm.popDeferredEvent=function(){var evt=window.story.state._gm.defferedStack.shift();window.story.state.tmp.args=evt.args;return evt.id;};window.gm.removeDefferedEvent=function(){var id=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";if(id!==""){for(var i=window.story.state._gm.defferedStack.length-1;i>0;i--){if(window.story.state._gm.defferedStack[i].id===id)window.story.state._gm.defferedStack.splice(i,1);}}else{window.story.state._gm.defferedStack=[];}};/*window.gm.hasDeferredEvent = function(id=""){
  if(id!==""){
    for(var i=0;i<window.story.state._gm.defferedStack.length;i++){
      if(window.story.state._gm.defferedStack[i].id===id) return(true);
    }
    return(false);
  } else {
    return(window.story.state._gm.defferedStack.length>0);
  }
}
window.gm.showDeferredEvent= function(){
  var msg = '';

  var namenext = window.passage.name;
  //var tagsnext = window.story.passage(namenext).tags;
  var evt = window.story.state._gm.defferedStack.shift();
  if(evt!==null){
    msg += window.gm.printPassageLink("Next",evt.id);
  }
  return msg;
}*/ //when show is called the previous passage is stored if the new has [_back_]-tag
//if the new has no back-tag, the stack gets cleared
window.gm.pushBackPassage=function(id){if(!window.story.state.hasOwnProperty("_gm"))return;//exist only after initGame
if(window.story.state._gm.passageStack.length>0&&window.story.state._gm.passageStack[window.story.state._gm.passageStack.length-1]===id){//already pushed
}else{window.story.state._gm.passageStack.push({id:id,flags:window.story.state.tmp.flags});}};//call on [_back_]-passages to get the previous passage
window.gm.popBackPassage=function(){var pass=window.story.state._gm.passageStack.pop();if(!pass)throw new Error('nothing to pop from stack');window.story.state.tmp.flags=pass.flags;return pass.id;};//push passage on hold before playing deffered passage
window.gm.pushOnHold=function(id){if(!window.story.state.hasOwnProperty("_gm"))return;//exist only after initGame
if(window.story.state._gm.onholdStack.length>0){throw new Error('passage allready onHold: '+id);//already some pushed
}else{window.story.state._gm.onholdStack.push({id:id,args:window.story.state.tmp.args});}};//
window.gm.popOnHold=function(){var pass=window.story.state._gm.onholdStack.pop();if(!pass)throw new Error('nothing on hold to pop.');window.story.state.tmp.args=pass.args;return pass.id;};//overriding show:
//- to enable back-link
//- to intercept with deffered events
//- add shortcut keys
var KBIntervalID=0;var _origStoryShow=window.story.__proto__.show;window.story.__proto__.show=function(idOrName){var noHistory=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var next=idOrName;var inGame=window.story.state.hasOwnProperty("_gm");//the logic doesnt work if initGame not already done
var tagsnext,namenext,nextp,namenow;clearInterval(KBIntervalID);if(idOrName==='')tagsnext=[];else{nextp=window.story.passage(idOrName);if(nextp)tagsnext=window.story.passage(idOrName).tags;else throw new Error("no such passage: "+idOrName);}if(inGame&&window.story.state._gm.defferedStack.length>0&&//deffered event if allowed and requested
//tagsnext.indexOf('_back_')<0 &&
tagsnext.indexOf('_nosave_')<0&&tagsnext.indexOf('_nodeffered_')<0){//before entering a new passage check if there is a defferedEvent that we should do first
//if so, push the normal-passage onto stack, show deffered passage
//after the deffered passage(s) finish, make sure to show the original passage
//this is a problem?how do I know the deffered passage is done? 
if(idOrName!==''){//if not continue-cmd
window.gm.pushOnHold(idOrName);if(tagsnext.indexOf('_back_')>=0&&window.passage.name!==idOrName){//push on stack but only if not re-showing itself
window.gm.pushBackPassage(window.passage.name);//todo do we need extra back-stack for onhold?
}}next=window.gm.popDeferredEvent();nextp=window.story.passage(next);tagsnext=nextp.tags;window.story.state.tmp.flags={};}else if(inGame&&idOrName===''&&window.story.state._gm.onholdStack.length>0){//continue event onhold
next=window.gm.popOnHold();if(next==='_back_'){//going back
next=window.gm.popBackPassage();}nextp=window.story.passage(next);tagsnext=nextp.tags;}else if(idOrName==='_back_'){//going back
next=window.gm.popBackPassage();tagsnext=window.story.passage(next).tags;}else{//going forward
nextp=window.story.passage(next);if(!nextp)throw new Error('no such passage: '+next);tagsnext=nextp.tags;namenext=nextp.name;if(tagsnext.indexOf('_back_')>=0){//push on stack but only if not re-showing itself
namenow=window.passage.name;if(namenext!=namenow)window.gm.pushBackPassage(namenow);window.story.state.tmp.flags={};}else if(inGame){//if not in _back_-passage, drop the _back_-stack
window.story.state._gm.passageStack.splice(0,window.story.state._gm.passageStack.length);window.story.state.tmp.flags={};}//todo not sure about this: a deffered event should not link to normal passages because this would disentangle the original story-chain
//this I think could cause issues and should be detected and throw an error
//uncoment the following to bypass this 
//    window.story.state._gm.onholdStack.splice(0,window.story.state._gm.onholdStack.length);
}if(inGame){//disable save-menu on _nosave_-tag 
window.story.state._gm.nosave=tagsnext.indexOf('_nosave_')>=0;}noHistory=true;//the engines object causes problems with history, namely refToParent
_origStoryShow.call(window.story,next,noHistory);if(window.story.errorMessage!=='')return;//abort on error to not overwrite first error
window.gm.util.updateLinks();// Search passages for links every x ms, just in case they get updated, and marks them for key clicks
//KBIntervalID = setInterval(window.gm.util.updateLinks,1000);  todo do we need this?
};/* when returning from back-passage, restore view by hiding/unhiding programatical modified elements, see printTalkLink*/window.gm.restorePage=function(){if(window.story.state.tmp){var elmts=Object.keys(window.story.state.tmp.flags);for(var i=0;i<elmts.length;i++){if(!$(elmts[i])[0])continue;//there might be snowman-logic in the page that swaps out parts of the text!
if(window.story.state.tmp.flags[elmts[i]]==='hidden'){$(elmts[i])[0].setAttribute("hidden","");}else if(window.story.state.tmp.flags[elmts[i]]==='unhide'){$(elmts[i])[0].removeAttribute("hidden");$(elmts[i])[0].scrollIntoView();}}}};//-----------------------------------------------------------------------------
//changes the active player and will add him to party!
window.gm.switchPlayer=function(playername){var s=window.story.state;window.gm.player=s.chars[playername];s._gm.activePlayer=playername;window.gm.addToParty(playername);};window.gm.removeFromParty=function(name){var s=window.story.state;var i=s._gm.playerParty.indexOf(name);if(i>=0)s._gm.playerParty.splice(i,1);};//adds the character to the party
//there has to be a CharacterObject for window.story.state.chars[name]
window.gm.addToParty=function(name){var s=window.story.state;if(s._gm.playerParty.indexOf(name)<0)s._gm.playerParty.push(name);};window.gm.isInParty=function(name){return window.story.state._gm.playerParty.indexOf(name)>=0;};//-----------------------------------------------------------------------------
//---------------------------------------------------------------------------------
//updates all panels
window.gm.refreshAllPanel=function(){window.story.show(window.passage.name);};//updates only sidepanle,logpanel
window.gm.refreshSidePanel=function(){renderToSelector("#sidebar","sidebar");renderToSelector("#LogPanel","LogPanel");};///////////////////////////////////////////////////////////////////////
window.gm.pushLog=function(msg){var Cond=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(!Cond||msg==='')return;var logsize=20;var log=window.story.state._gm.log;log.unshift(msg+'</br>');if(log.length>logsize){log.splice(log.length-1,1);}};window.gm.getLog=function(){var log=window.story.state._gm.log;var msg='';for(var i=0;i<log.length;i++){msg+=log[i];}return msg;};window.gm.clearLog=function(){var log=window.story.state._gm.log;var msg='';for(var i=0;i<log.length;i++){msg+=log[i];}window.story.state._gm.log=[];return msg;};//////////////////////////////////////////////////////////////////////
window.gm.roll=function(n,sides){//rolls n x dies with sides
var rnd=0;for(var i=0;i<n;i++){rnd+=_.random(1,sides);}return rnd;};//expects DOM like <section><article>..<div id='output'></div>..</article></section>
//Tip if you have to setup functions: string should be in '  and use \' and \" consistently 
//'<button type=\"button\" onclick=\'equip(\"'+y.itmId+'\",\"'+itm2.itmId+'\");\'>'+y.name+'</button>'
window.gm.printOutput=function(text){var where=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"section article div#output";var append=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var n=document.querySelector(where);n.innerHTML=(append?n.innerHTML:"")+text;};//connect to onclick to toggle selected-style for element + un-hiding related text
//the elmnt (f.e.<img>) needs to be inside a parentnode f.e. <div id="choice">
//ex_choice is jquery path to fetch all selectable elmnt
//for a table in a div this could be "div#choice table tbody tr td *"
//text-nodes needs to be inside a parent node f.e. <div id="info"> and have matching id of elmnt
//ex_info is jquery path to fetch all info elmnt
//for a <p> in div this could be "div#info  
window.gm.onSelect=function(elmnt,ex_choice,ex_info){var all=$(ex_choice);//[0].children;
for(var i=0;i<all.length;i++){if(all[i].id===elmnt.id){all[i].classList.add("selected");}else all[i].classList.remove("selected");}all=$(ex_info)[0].children;for(var i=0;i<all.length;i++){if(all[i].id===elmnt.id){all[i].hidden=false;}else all[i].hidden=true;}};//call this onclick to make the connected element vanish and to unhide another one (if the passage is revisited the initial state will be restored)
//unhidethis needs to be jquery-path to a div,span,.. that is initially set to hidden
//cb can be a function(elmt) that gets called
window.gm.printTalkLink=function(elmt,unhideThis){var cb=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;$(elmt)[0].setAttribute("hidden","");if(cb!==null)cb($(elmt)[0]);$(unhideThis)[0].removeAttribute("hidden");$(unhideThis)[0].scrollIntoView({behavior:"smooth"});window.story.state.tmp.flags[elmt]='hidden',window.story.state.tmp.flags[unhideThis]='unhide';//if navigating to a back-page and return, the initial page will be reset to default-> memorize and restore the hidden-flags (see restorePage)
};//prints the same kind of link like [[Next]] but can be called from code
window.gm.printPassageLink=function(label,target){return"<a href=\"javascript:void(0)\" data-passage=\""+target+"\">"+label+"</a>";};//prints a link where target is a expression called onClick. Use \" instead of " or ' !
window.gm.printLink=function(label,target,params){var _params=params||{};_params.once=params&&params.once?params.once:false;//auto disable  doesnt work if the Link was added to page dynamical as it has no parent??
_params.class=params&&params.class?params.class:"";//CSS-class
return'<a href=\'javascript:void(0)\' class=\''+_params.class+'\' onclick=\''+target+';'+(_params.once?'this.remove(this);':'')+'\'>'+label+'</a>';};//prints a link that when clicked picksup an item and places it in the inventory, if itemleft is <0, no link appears
window.gm.printPickupAndClear=function(itemid,desc,itemleft){var cbAfterPickup=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var elmt='';var s=window.story.state;if(!(itemleft>0))return elmt;var desc2=desc+" ("+itemleft+" left)";var msg='took '+itemid;elmt+="<a0 id='"+itemid+"' onclick='(function($event){window.gm.pickupAndClear(\""+itemid+"\", \""+desc+"\","+itemleft+","+cbAfterPickup+")})(this);'>"+desc2+"</a></br>";return elmt;};window.gm.pickupAndClear=function(itemid,desc,itemleft){var cbAfterPickup=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;window.gm.player.Inv.addItem(new window.storage.constructors[itemid]());if(cbAfterPickup)cbAfterPickup();window.gm.refreshAllPanel();};//prints an item with description; used in inventory
window.gm.printItem=function(id,descr,carrier){var useOn=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var elmt='';var s=window.story.state;var _inv=window.gm.player.Inv;//todo only players? useOn isnt used!
var _item=_inv.getItem(id),_count=_inv.countItem(id);if(useOn===null)useOn=carrier;elmt+="<a0 id='".concat(id,"' onclick='(function($event){document.querySelector(\"div#").concat(id,"\").toggleAttribute(\"hidden\");})(this);'>").concat(_item.name," (x").concat(_count,")</a>");var useable=_inv.usable(id);if(_count>0&&useable.OK){elmt+="<a0 id='".concat(id,"' onclick='(function($event){var _res=window.gm.player.Inv.use(\"").concat(id,"\"); window.gm.refreshAllPanel();window.gm.printOutput(_res.msg);}(this))'>").concat(useable.msg,"</a>");}elmt+="</br><div hidden id='".concat(id,"'>").concat(descr,"</div>");if(window.story.passage(id))elmt+=''.concat("    [[Info|"+id+"]]");//adds a link to descriptive passage if there is one
elmt+=''.concat("</br>");return elmt;};/**
 * prints a list of items/wardrobe and buttons to transfer them
 * @param {*} from 
 * @param {*} to 
 */ // see also window.gm.shop.printItemTransfer
window.gm.printItemTransfer=function(from,to,wardrobe){var listFrom,listTo;if(wardrobe){listFrom=from.Wardrobe.getAllIds(),listTo=to.Wardrobe.getAllIds();}else{listFrom=from.Inv.getAllIds(),listTo=to.Inv.getAllIds();}var allIds=new Map();var _iterator21=_createForOfIteratorHelper(listTo),_step21;try{for(_iterator21.s();!(_step21=_iterator21.n()).done;){var n=_step21.value;allIds.set(n,{name:wardrobe?to.Wardrobe.getItem(n).name:to.Inv.getItem(n).name});}}catch(err){_iterator21.e(err);}finally{_iterator21.f();}var _iterator22=_createForOfIteratorHelper(listFrom),_step22;try{for(_iterator22.s();!(_step22=_iterator22.n()).done;){var _n2=_step22.value;allIds.set(_n2,{name:wardrobe?from.Wardrobe.getItem(_n2).name:from.Inv.getItem(_n2).name});}}catch(err){_iterator22.e(err);}finally{_iterator22.f();}listFrom=Array.from(allIds.keys());listFrom.sort();function give(id,amount,charA,charB){var item,count=charA.Inv.countItem(id);if(count===0){//wardrobe or item
count=charA.Wardrobe.countItem(id);item=charA.Wardrobe.getItem(id);}else item=charA.Inv.getItem(id);count=Math.min(count,amount);charA.changeInventory(item,-1*count);item=window.gm.util.deepClone(item);//item = window.gm.ItemsLib[id](); doesnt work for dynamic created items
charB.changeInventory(item,count);window.gm.refreshAllPanel();}var _iterator23=_createForOfIteratorHelper(listFrom),_step23;try{for(_iterator23.s();!(_step23=_iterator23.n()).done;){var _id3=_step23.value;var g=void 0,entry=document.createElement('p');entry.textContent=allIds.get(_id3).name;var count=wardrobe?from.Wardrobe.countItem(_id3):from.Inv.countItem(_id3);g=document.createElement('a');g.href='javascript:void(0)',g.textContent='store 1 of '+window.gm.util.formatNumber(count,0);g.addEventListener("click",give.bind(null,_id3,1,from,to));if(count>0)entry.appendChild(g);g=document.createElement('a');g.href='javascript:void(0)',g.textContent='store all';g.addEventListener("click",give.bind(null,_id3,count,from,to));if(count>0)entry.appendChild(g);count=wardrobe?to.Wardrobe.countItem(_id3):to.Inv.countItem(_id3);g=document.createElement('a');g.href='javascript:void(0)',g.textContent='take 1 of '+window.gm.util.formatNumber(count,0);g.addEventListener("click",give.bind(null,_id3,1,to,from));if(count>0)entry.appendChild(g);g=document.createElement('a');g.href='javascript:void(0)',g.textContent='take all';g.addEventListener("click",give.bind(null,_id3,count,to,from));if(count>0)entry.appendChild(g);document.getElementById('choice').appendChild(entry);// <- requires this node in html
}}catch(err){_iterator23.e(err);}finally{_iterator23.f();}};//prints an equipment with description; used in wardrobe
window.gm.printEquipment=function(whom,item){var node=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"div#choice";var params=arguments.length>3?arguments[3]:undefined;var _params=params||{};_params.noUnequip=params&&params.noUnequip?params.noUnequip:false;var elmt='',s=window.story.state,res;if(item.hasTag('body'))return;//skip bodyparts; 
var noWear=item.hasTag(['piercing','tattoo']);var itm,g,entry=document.createElement('p');itm=document.createElement('a'),itm.href='javascript:void(0)';itm.textContent=item.name;itm.id=item.id;itm.addEventListener("click",function(evt){document.querySelector("div#"+evt.target.id).toggleAttribute("hidden");});entry.appendChild(itm);g=document.createElement('a'),g.href='javascript:void(0)';if(noWear===true){g.disabled=true;g.textContent='';//cannot un-/equip tattoos & piercing 
}else if(whom.Outfit.countItem(item.id)<=0){//
g.textContent='Equip';if(_params.noUnequip)g.disabled=true;itm.textContent+=" x"+item.count();g.addEventListener("click",function(whom,item){//todo should we display its own page instead oneliner?
return function(){var _x=whom.Outfit.addItem(item).msg;window.gm.refreshAllPanel();window.gm.printOutput(_x);};}(whom,item));//redraw page to update buttons, then print output
}else if(item.parent===whom.Outfit){//
res=whom.Outfit.canUnequipItem(item.id,false);if(res.OK){g.textContent='Unequip';if(_params.noUnequip)g.disabled=true;g.addEventListener("click",function(whom,item){return function(){var _x=whom.Outfit.removeItem(item.id).msg;window.gm.refreshAllPanel();window.gm.printOutput(_x);};}(whom,item));}else{g.disabled=true;g.textContent=res.msg;}}if(g.textContent!==''&&!g.disabled)entry.appendChild(g);g=document.createElement('div');g.id=item.id;g.hidden=true;g.textContent=item.desc;entry.appendChild(g);document.querySelector(node).appendChild(entry);//  $("div#choice")[0].appendChild(entry); 
/*if(window.story.passage(id))  elmt +=''.concat("[[Info|"+id+"]]");  //Todo passages for items?
      elmt +=''.concat("</br>");
      return(elmt);*/};//prints a string listing equipped items
window.gm.printEquipmentSummary=function(){var whom=window.gm.player;var result='',ids=[];ids=whom.Outfit.getAllIds();for(var i=0;i<ids.length;i++){var item=whom.Outfit.getItem(ids[i]);if(item.hasTag('body'))continue;result+=item.name+',';}return result;};//prints a string listing equipped items
window.gm.printRelationSummary=function(){var elmt='';var s=window.story.state;var result='';var ids=[];result+='<table>';var ids=window.gm.player.Rel.getAllIds();ids.sort();for(var k=0;k<ids.length;k++){if(ids[k].split("_").length===1){//ignore _min/_max
var data=window.gm.player.Rel.get(ids[k]);result+='<tr><td>'+data.id+':</td><td>'+data.value+' of '+window.gm.player.Rel.get(ids[k]+"_Max").value+'</td></tr>';}}result+='</table>';return result;};//prints achievements
window.gm.printAchievements=function(){var result='',ids=[];result+='<table>';var name,msg,x,achv;ids=Object.keys(window.gm.achievements);ids.sort();for(var k=0;k<ids.length;k++){x=window.gm.achievements[ids[k]];achv=window.gm.getAchievementInfo(ids[k]);name=achv.name;msg=!!x?achv.descDone:achv.descToDo;if(!x&&(achv.hidden&0x1)>0){name="???";}if(!x&&(achv.hidden&0x2)>0){msg="???";}result+='<tr><td><input type=\"checkbox\" name=\"y\" value=\"x\" readonly disabled '+(!!x?'checked=\"checked\"':'')+'></td><td>'+name+':</td><td>'+msg+'</td></tr>';}//todo print mom : 10 of 20
result+='</table>';return result;};//prints a string listing stats and effects
window.gm.printEffectSummary=function(){var who=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'player';var what=arguments.length>1?arguments[1]:undefined;var _what=what||{};_what.showstats=what&&what.showstats?what.showstats:false,//set at least one flag!
_what.showfetish=what&&what.showfetish?what.showfetish:false,_what.showresistance=what&&what.showresistance?what.showresistance:false,_what.showskill=what&&what.showskill?what.showskill:false;var elmt='',s=window.story.state,result='';result+='<table>';var ids=window.story.state.chars[who].Stats.getAllIds();ids.sort();//Todo better sort
for(var k=0;k<ids.length;k++){var data=window.story.state.chars[who].Stats.get(ids[k]);var isFetish=data.id.slice(0,2)==='ft',isSkill=data.id.slice(0,3)==='sk_';//Fetish starts with ft
var isResistance=data.id.slice(0,4)==='rst_'||data.id.slice(0,4)==='arm_';//
if(data.hidden!==4){if(isFetish&&_what.showfetish&&!(data.id.slice(-4,-2)==='_M')){//expects names of fetish like ftXXX and limits ftXXX_Min ftXXX_Max
var min=window.story.state.chars[who].Stats.get(ids[k]+"_Min");var max=window.story.state.chars[who].Stats.get(ids[k]+"_Max");result+='<tr><td>'+(data.hidden&0x1?'???':data.id)+':</td><td>'+(data.hidden&0x2?'???':data.value)+'</td>';result+='<td>'+(data.hidden&0x2?'???':'('+(min.value+' to '+max.value))+')</td></tr>';}if(!isFetish&&!isResistance&&!isSkill&&_what.showstats||!isFetish&&isResistance&&!isSkill&&_what.showresistance||!isFetish&&!isResistance&&isSkill&&_what.showskill){result+='<tr><td>'+(data.hidden&0x1?'???':data.id)+':</td><td>'+(data.hidden&0x2?'???':data.value)+'</td></tr>';}//todo show modifier list for each stat  agility: BracerLeather +2
}}result+='</table>';result+='</br>Active Effects:<table>';ids=window.story.state.chars[who].Effects.getAllIds();ids.sort();//Todo better sort
for(var i=0;i<ids.length;i++){var data=window.story.state.chars[who].Effects.get(ids[i]);if(data.hidden!==4){result+='<tr><td>'+(data.hidden&0x1?'???':data.name)+':</td><td>'+(data.hidden&0x1?'???':data.desc)+'</td><td>'+(data.hidden&0x2?'???':data.data.duration)+'h left</td></tr>';}}result+='</table>';return result;};///show/hides a dialog defined in body
window.gm.toggleDialog=function(id){var _id=id;var dialog=document.querySelector(id),closebutton=document.getElementById('close-dialog'),pagebackground=document.querySelector('body');var div;if(!dialog.hasAttribute('open')){if(window.story.state._gm)window.story.state._gm.nokeys=true;// show the dialog 
div=document.createElement('div');div.id='backdrop';document.body.appendChild(div);dialog.setAttribute('open','open');// after displaying the dialog, focus the closebutton inside it
closebutton.focus();closebutton.addEventListener('click',function(){window.gm.toggleDialog(_id);});}else{dialog.removeAttribute('open');div=document.querySelector('#backdrop');div.parentNode.removeChild(div);if(window.story.state._gm)window.story.state._gm.nokeys=false;//??lastFocus.focus();
}};// expects window.gm.achievementsInfo[id]={set:1, hidden:4, name:"loose end", descToDo:"",descDone:""} //
window.gm.getAchievementInfo=function(id){return window.gm.achievementsInfo[id];};window.gm.setAchievement=function(id,data){window.gm.achievements[id]=data;window.gm.toasty.info("Achievement : "+id);};{//classes for UI
var SelectionController=/*#__PURE__*/function(_EventTarget){_inherits(SelectionController,_EventTarget);var _super2=_createSuper(SelectionController);function SelectionController(selectElement){var _this2;var parentNode=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;_classCallCheck(this,SelectionController);_this2=_super2.call(this);if(!(selectElement instanceof HTMLSelectElement)){throw new Error("Controller-Objekt benötigt ein select Element als ersten Parameter");}if(parentNode&&!(parentNode instanceof SelectionController)){throw new Error("Controller-Objekt benötigt einen SelectionController als zweiten Parameter");}_this2.selectElement=selectElement;_this2.parentNode=parentNode;_this2.selectElement.addEventListener("change",function(event){return _this2._handleChangeEvent(event);});if(parentNode){parentNode.addEventListener("change",function(event){return _this2.mapData(event.selectedObject);});}return _this2;}// Ordnet dem select Element eine Datenquelle zu. 
// dataSource ist ein Objekt, aus dem die getValueList die Daten für die
// select-Optionen ermitteln kann, oder null, um das select-Element zu disablen
_createClass(SelectionController,[{key:"mapData",value:function mapData(dataSource){// Quelldaten-Objekt im Controller speichern.
this.dataSource=dataSource;// Optionen nur anfassen, wenn eine getValueList Methode vorhanden ist.
//  Andernfalls davon ausgehen, dass die options durch das HTML
// bereitgestellt werden.
if(typeof this.getValueList=="function"){// Existierende Optionen entfernen
removeOptions(this.selectElement);// Wenn dataSource nicht null war, die neuen Optionen daraus beschaffen
// Andernfalls das select-Element deaktivieren
var options=dataSource&&this.getValueList(dataSource);if(!options||!options.length){setToDisabled(this.selectElement);}else{setToEnabled(this.selectElement,options);}}// Zum Abschluss ein change-Event auf dem select-Element feuern, damit
// jeder weiß, dass hier etwas passiert ist
this.selectElement.dispatchEvent(new Event("change"));// Helper: Entferne alle options aus einem select Element	
function removeOptions(selectElement){while(selectElement.length>0){selectElement.remove(0);}}// Helper: select-Element auf disabled setzen und eine Dummy-Option 
// eintragen. Eine Variante wäre: das selectElement auf hidden setzten
function setToDisabled(selectElement){addOption(selectElement,"","------");selectElement.disabled=true;}// Helper: disabled-Zustand vom select-Element entfernen und die
// übergebenen Optionen eintragen. Vorweg eine Dummy-Option "Bitte wählen".
function setToEnabled(selectElement,options){addOption(selectElement,"","???");var _iterator24=_createForOfIteratorHelper(options),_step24;try{for(_iterator24.s();!(_step24=_iterator24.n()).done;){var optionData=_step24.value;addOption(selectElement,optionData.value,optionData.text,optionData.disabled);}}catch(err){_iterator24.e(err);}finally{_iterator24.f();}selectElement.disabled=false;}// Helper: Option-Element erzeugen, ausfüllen und im select-Element eintragen
function addOption(selectElement,value,text){var disabled=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var option=document.createElement("option");option.value=value;option.text=text;if(disabled)option.disabled=disabled;selectElement.add(option);}}// Abstrakte Methode! Wird sie nicht überschrieben, wird der TypeError geworfen
},{key:"getValue",value:function getValue(key){throw new TypeError("Die abstrakte Methode 'getValue' wurde nicht implementiert!");}// Stellt den im select Element ausgewählten Optionswert zur Verfügung
},{key:"_handleChangeEvent",// privat
// Die Methode reagiert auf das change-Event des select-Elements
// und stellt es als eigenes change-Event des Controllers zur Verfügung
value:function _handleChangeEvent(event){var nodeChangeEvent=new Event("change");nodeChangeEvent.selectedObject=this.selectedObject;this.dispatchEvent(nodeChangeEvent);}},{key:"selectedKey",get:function get(){return this.selectElement.value;}// Liefert das Datenobjekt zum ausgewählten Optionswert
},{key:"selectedObject",get:function get(){return this.dataSource?this.getValue(this.dataSource,this.selectElement.value):null;}}]);return SelectionController;}(/*#__PURE__*/_wrapNativeSuper(EventTarget));window.gm.util.SelectionController=SelectionController;};//UMD export from https://github.com/umdjs/umd/blob/master/templates/returnExports.js
//TODO if this module requires something, enable code with b
(function(root,factory){if(typeof define==='function'&&define.amd){// AMD. Register as an anonymous module.
define([],factory);//define(['b'], factory);  
}else if((typeof module==="undefined"?"undefined":_typeof(module))==='object'&&_typeof(module.exports)==='object'){//(typeof module === 'object' && module.exports) {
// Node. Does not work with strict CommonJS, but
// only CommonJS-like environments that support module.exports,
// like Node.
module.exports=factory();//module.exports = factory(require('b'));
}else{// Browser globals (root is window)
root.GenerateDng=factory();//root.returnExports = factory(root.b);
}})(typeof self!=='undefined'?self:void 0,function(){//function (b) {// Use b in some fashion.
var Room=/*#__PURE__*/function(){//a room here means 5 tiles arranged as a cross
function Room(){_classCallCheck(this,Room);this.pos=[0,0];this.sectiles=[[0,0],[0,-1],[0,1],[-1,0],[1,0]];//tile coord. relativ to maintile
this.dirs=[];this.setPosition(this.pos);}_createClass(Room,[{key:"setPosition",value:function setPosition(pos){var _this3=this;this.pos=pos;this.tiles=this.sectiles.map(function(x){return[x[0]+_this3.pos[0],x[1]+_this3.pos[1]];});//tile coord. absolute
}},{key:"getAddress",value:function getAddress(){return this.pos[0]+'_'+this.pos[1];}}]);return Room;}();/** Generates a map made from cross-patterned rooms 
    * 
    */var Generator=/*#__PURE__*/function(){function Generator(){_classCallCheck(this,Generator);}//resets state of generator
_createClass(Generator,[{key:"reset",value:function reset(){this.length=1;this.minX=0,this.minY=0,this.maxX=0,this.maxY=0;this.mainrooms=[];// [ '1_3',... ]
this.doors=[];//[ [ [1,1],[0,1] ],... ]
this.room=new Room();this.grid=new Map();//structure depends on state of generation!
this.placeRoom(this.room);}},{key:"intersects",value:function intersects(newRoom){//is the new structure intersecting with existing ones?   
var inter=[],rooms=Array.from(this.grid.values()),newtiles=newRoom.tiles;for(var i=rooms.length-1;i>=0;i--){var tiles=rooms[i].tiles;for(var k=newtiles.length-1;k>=0;k--){for(var l=tiles.length-1;l>=0;l--){if(newtiles[k][0]===tiles[l][0]&&newtiles[k][1]===tiles[l][1]){return true;}}}}return false;}},{key:"placeRoom",value:function placeRoom(newRoom){//place a roomtemplate on grid
this.grid.set(newRoom.getAddress(),newRoom);for(var k=newRoom.tiles.length-1;k>=0;k--){//add doors to templates
this.minX=Math.min(this.minX,newRoom.tiles[k][0]),this.minY=Math.min(this.minY,newRoom.tiles[k][1]);this.maxX=Math.max(this.maxX,newRoom.tiles[k][0]),this.maxY=Math.max(this.maxY,newRoom.tiles[k][1]);for(var l=newRoom.tiles.length-1;l>=0;l--){if(this.isNeighbour(newRoom.tiles[k],newRoom.tiles[l])){//tiles directly beside each other?
this.doors.push([newRoom.tiles[k],newRoom.tiles[l]]);}}}this.mainrooms.push(newRoom.getAddress());}},{key:"isNeighbour",value:function isNeighbour(tileA,tileB){//are 2 tiles neigbors
//yes: [1,0] & [1,-1]     [2,-1] & [1,-1]
//no:   [-1,0] & [1,-1]
var tx=tileA[0]-tileB[0],ty=tileA[1]-tileB[1];if(tx===0&&(ty===1||ty===-1)||ty===0&&(tx===1||tx===-1))return true;return false;}},{key:"furnishRooms",value:function furnishRooms(){//furnish the rooms
var _r,i=0,k=0,visuals=['bigtree','bushes','meadow','trees'];var uniques=['entry','appletree','brokencabin','totem','hollowtreestump','mushroom'];var _UnusedRooms=Array.from(this.grid);//scatter uniques semi-randomly:
while(uniques.length>0){//repeat until uniques done
i=_.random(0,_UnusedRooms.length-1);_r=_UnusedRooms.splice(i,1)[0][1];//splice returns array [key,value] !
_r.visuals=uniques.pop();if(_r.visuals==="entry")_r.anno='E';//this.grid.set(_r.room,_r);
}//remaining unused rooms get other visuals but make sure that each visual occurs at least once
k=visuals.length;if(k>0){while(k>0){//repeat until uniques done
k--;i=_.random(0,_UnusedRooms.length-1);_r=_UnusedRooms.splice(i,1)[0][1];//TODO Exception if not enough room
_r.visuals=visuals[k];//this.grid.set(_r.room,_r);
}while(_UnusedRooms.length>0){//repeat until done
k=_.random(0,visuals.length-1);_r=_UnusedRooms.pop()[1];_r.visuals=visuals[k];//this.grid.set(_r.room,_r);
}}}},{key:"toCoord",value:function toCoord(tile){//translates the numeric coord. into a name
var X=['A','B','C','D','E','F','G','H','I','J','K','L','M','N'];var Y=['0','1','2','3','4','5','6','7','8','9'];switch(this.params.naming){case'A1':return X[tile[0]-this.minX]+Y[tile[1]-this.minY];//returns 'E5', also shifts Position as smallest value is A1
break;case'12_1':return tile[0]-this.minX+'_'+(tile[1]-this.minY);//smallest value is 0, no negatives
break;case'12_01':return window.gm.util.formatInt(tile[0]-this.minX,false,2)+'_'+window.gm.util.formatInt(tile[1]-this.minY,false,2);//smallest value is 00, no negatives
case'-12_+01':return window.gm.util.formatInt(tile[0],true,2)+'_'+window.gm.util.formatInt(tile[1],true,2);//negatives can occur
break;}}},{key:"sanitizeDoors",value:function sanitizeDoors(){//remove double entries of doors
var _sane=[];var _iterator25=_createForOfIteratorHelper(this.doors.values()),_step25;try{var _loop=function _loop(){var y=_step25.value;if(_sane.find(function(el){return y[0]===el[0]&&y[1]===el[1]||y[0]===el[1]&&y[1]===el[0];})){return"continue";}_sane.push(y);};for(_iterator25.s();!(_step25=_iterator25.n()).done;){var _ret=_loop();if(_ret==="continue")continue;}}catch(err){_iterator25.e(err);}finally{_iterator25.f();}}},{key:"carveRooms",value:function carveRooms(){//
var pos,n,branched=0;var slots=[[-2,-1],[2,1],[-2,1],[2,-1],[-1,-2],[1,-2],[-1,2],[1,2]];//relative coord. around a cross-pattern where new patterns could be placed
while(this.length<this.params.length){n=Array.from(slots);n.sort(function(){return Math.random()-0.5;});// scramble array TODO could be used to control where the next room is added like placing them as line or spiral
var newRoom=new Room();while(true){pos=n.pop();newRoom.setPosition([pos[0]+this.room.pos[0],pos[1]+this.room.pos[1]]);//check if newRoom would intersect with present rooms
if(!this.intersects(newRoom)){this.placeRoom(newRoom);//find neigboring tiles of new and previous room and build main doors 
var brk=false;for(var k=newRoom.tiles.length-1;k>=0&&brk===false;k--){for(var l=this.room.tiles.length-1;l>=0&&brk===false;l--){if(this.isNeighbour(newRoom.tiles[k],this.room.tiles[l])){//tiles directly beside each other?
this.doors.push([newRoom.tiles[k],this.room.tiles[l]]);brk=true;}}}this.length+=1;//create branch
//after adding a room, there is a chance to select a previous mainroom to continue on instead of extending from current mainroom
if(branched<this.params.branches){var x=Math.round((this.params.length-1)*Math.random());//likelyness to branch should increase with length
if(x<this.mainrooms.length-1){this.room=this.grid.get(this.mainrooms[x]);branched+=1;}else this.room=newRoom;}else this.room=newRoom;//memorize for next iter
break;}}}var _allrooms=[];var _iterator26=_createForOfIteratorHelper(this.grid.values()),_step26;try{for(_iterator26.s();!(_step26=_iterator26.n()).done;){var _x3=_step26.value;var _iterator29=_createForOfIteratorHelper(_x3.tiles.values()),_step29;try{for(_iterator29.s();!(_step29=_iterator29.n()).done;){var y=_step29.value;_allrooms.push(y);}}catch(err){_iterator29.e(err);}finally{_iterator29.f();}}//build additional doors between templates
}catch(err){_iterator26.e(err);}finally{_iterator26.f();}for(var i=1;i<this.mainrooms.length;i++){//walk each mainroom
var _brk=void 0,ra=this.grid.get(this.mainrooms[i]);var _n3=this.params.doors,tiles=ra.tiles;var _iterator27=_createForOfIteratorHelper(_allrooms.values()),_step27;try{for(_iterator27.s();!(_step27=_iterator27.n()).done;){var _x2=_step27.value;for(var k=tiles.length-1;k>=0&&_n3>0;k--){//select a random tile and check neighbours from other mainrooms
if(tiles.includes(_x2))continue;//only tiles from others
if(this.isNeighbour(tiles[k],_x2)){//create door to neighbour, if there is already one skip ahead
this.doors.push([tiles[k],_x2]);_n3--;if(_n3<=0)break;}//repeat n times or no more tiles
}}}catch(err){_iterator27.e(err);}finally{_iterator27.f();}}this.sanitizeDoors();//restructure to:
//{grid:new Map(_grid.map((x)=>{return([x.room,x]);})),width:14,height:8,legend:''}
//where x= {room:'D2', dirs:[{dir:'E2'}]},
var _grid=[];var _iterator28=_createForOfIteratorHelper(this.grid.values()),_step28;try{for(_iterator28.s();!(_step28=_iterator28.n()).done;){var _x4=_step28.value;var _pos2=void 0,dirs=void 0;for(var i=_x4.tiles.length-1;i>=0;i--){dirs=[];//doors defined for this tile?
for(var k=this.doors.length-1;k>=0;k--){if(this.doors[k][0]==_x4.tiles[i]){dirs.push({dir:this.toCoord(this.doors[k][1])});}else if(this.doors[k][1]==_x4.tiles[i]){dirs.push({dir:this.toCoord(this.doors[k][0])});}}_pos2=this.toCoord(_x4.tiles[i]);_grid.push({room:_pos2,dirs:dirs});}}}catch(err){_iterator28.e(err);}finally{_iterator28.f();}this.grid=new Map(_grid.map(function(x){return[x.room,x];}));}/**
         *  generates new map and returns it
         * @memberof Generator
         * @param {params} params
         * 
         * parameter options:
         * length: length of rooms chained, default 4
         * doors: additional doors between template, default none
         * naming: namingstyle of rooms , see toCoord: A1 (max = N9 ! ); 12_1 ; 12_01 (default); -12_+01
         * branches: defines if mainrooms can branch out: default 0; 2 means there could be 2 forks
         */},{key:"generate",value:function generate(params){this.params=params||{};this.params.length=this.params.length?this.params.length:4;this.params.doors=this.params.doors?this.params.doors:0;this.params.naming=this.params.naming?this.params.naming:'12_01';this.params.branches=this.params.branches?this.params.branches:0;this.params.progress=this.params.progress?this.params.progress:function(){};//TODO display generation progress 
this.reset();this.carveRooms();this.furnishRooms();//TODO remove unused rooms with single door
return{grid:this.grid,width:this.maxX-this.minX+1,height:this.maxY-this.minY+1,legend:'E:Exit  B:Boss'};}}]);return Generator;}();return{DngGen:new Generator()};});"use strict";var Item=/*#__PURE__*/function(){function Item(name){_classCallCheck(this,Item);this.id=this.name=name;//id is unique in database(no whitespace !); name is for display
this.tags=[];this._stackLimit=0;this.bonus=[];//Curse or Bonus assigned to item   //todo can ITEMS be cursed too?
this.price=this.basePrice=10;//how much worth it is
}_createClass(Item,[{key:"_relinkItems",value:function _relinkItems(parent){this._parent=window.gm.util.refToParent(parent);}},{key:"_updateId",value:function _updateId(){//because equipment can have dynamic assigned curses, id needs to be generated dynamical too
//and then we also have to update id in inventory list
var nId="_"+IDGenerator.createID();//md5(JSON.stringify(this));  //add _ or queryselector() might not work if id starts with number ?!
//md5 is less acurate but smaller then LZString.compress(JSON.stringify(this));
var _oldId=this.id;this.id=nId;if(this.parent)this.parent._updateId(_oldId);}},{key:"count",value:function count(){if(this.parent){return this.parent.countItem(this.id);}else return 1;//Todo ok?
}//called by SkillUseItem
},{key:"targetFilter",value:function targetFilter(targets){return[];//default unuseable in combat
}//tag or [tag]; returns true if SOME tag is present
},{key:"hasTag",value:function hasTag(tags){if(tags instanceof Array){for(var i=0;i<tags.length;i++){if(this.hasTag(tags[i]))return true;}return false;}return this.tags.includes(tags);}},{key:"removeTags",value:function removeTags(tags){for(var i=this.tags.length-1;i>=0;i--){if(tags.includes(this.tags[i]))this.tags.splice(i,1);}}},{key:"addTags",value:function addTags(tags){for(var i=tags.length-1;i>=0;i--){if(!this.tags.includes(tags[i]))this.tags.push(tags[i]);}}},{key:"usable",//context is the owner of item (parent of inventory), on is target (character)
value:function usable(context){var on=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return{OK:false,msg:'Cannot use.'};}//todo add 2.useslot?
},{key:"use",value:function use(context){var on=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return{OK:false,msg:'Cannot use.'};}},{key:"onTimeChange",value:function onTimeChange(now){}},{key:"parent",get:function get(){return this._parent?this._parent():null;}},{key:"stackLimit",get:function get(){return this._stackLimit;}//0:infinite 
//returns the svg-piture name to display in inventory or wardrobe
},{key:"pictureInv",get:function get(){return"unknown";}//implement this for description
},{key:"desc",get:function get(){return this.descShort;}//implement this for description
},{key:"descShort",get:function get(){return this.name;}}]);return Item;}();//an Inventory-Component to store items
var Inventory=/*#__PURE__*/function(){function Inventory(externlist){_classCallCheck(this,Inventory);this.list=externlist?externlist:[];window.storage.registerConstructor(Inventory);}_createClass(Inventory,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("Inventory",this);}},{key:"_relinkItems",value:function _relinkItems(){//call this after loading save data to reparent; if you get an error that the function is missing, you might have forgotten to window.storage.registerConstructor
for(var i=0;i<this.list.length;i++){if(this.list[i].item)this.list[i].item._relinkItems(this);}}},{key:"_updateId",value:function _updateId(oldId){//updates id if changed, see item._updateId
var slot=findItemSlot(oldId);if(slot<0)return;this.list[slot].id=this.list[slot].item.id;}},{key:"postItemChange",value:function postItemChange(id,operation,msg){window.gm.pushLog('Inventory: '+operation+' '+id+' '+msg);}},{key:"count",value:function count(){return this.list.length;}},{key:"countItem",value:function countItem(id){var _i=this.findItemSlot(id);if(_i<0)return 0;return this.list[_i].count;}},{key:"findItemSlot",value:function findItemSlot(id){for(var i=0;i<this.count();i++){if(this.list[i].id===id)return i;}return-1;}},{key:"findItemByTag",value:function findItemByTag(hasTags,hasNoTags){var list=[],item;for(var i=this.count()-1;i>=0;i--){item=this.list[i].item;if(item.hasTag(hasTags)&&!item.hasTag(hasNoTags))list.push(item);}return list;}},{key:"getItemId",value:function getItemId(slot){return this.list[slot].id;}},{key:"getItem",value:function getItem(id){var _idx=this.findItemSlot(id);if(_idx<0)throw new Error('no such item: '+id);return this.list[_idx].item;}//returns all Ids in list
},{key:"getAllIds",value:function getAllIds(){var ids=[];for(var i=0;i<this.list.length;i++){ids.push(this.list[i].id);}return ids;}// override this
},{key:"canAddItem",value:function canAddItem(item,count){var force=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var _rst={OK:true,msg:"",count:count};return _rst;}},{key:"addItem",value:function addItem(item){var count=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var force=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var _rst=this.canAddItem(item,count,force),_i=this.findItemSlot(item.id);if(!_rst.OK||_rst.count==0)return _rst;item._parent=window.gm.util.refToParent(this);if(_i<0){this.list.push({id:item.id,count:_rst.count,item:item});}else this.list[_i].count+=_rst.count;this.postItemChange(item.name,"added","");return _rst;}},{key:"removeItem",value:function removeItem(id){var count=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var _rst={OK:true,msg:"",count:count};var _i=this.findItemSlot(id);if(_i<0)return;//just skip if not found
var _item=this.getItem(id);this.list[_i].count-=count;if(this.list[_i].count<=0)this.list.splice(_i,1);this.postItemChange(_item.name,"removed","");return _rst;}},{key:"removeAll",value:function removeAll(){this.list=[];//TODO postItemChange?
}//convience method to check if item is usable
},{key:"usable",value:function usable(id){var on=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var _item=this.getItem(id);return _item.usable(this,on);}//uses an item by calling item.use
},{key:"use",value:function use(id){var on=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var _item=this.getItem(id);var result=_item.use(this,on);if(result.OK){this.postItemChange(_item.name,"used",result.msg);}return result;}},{key:"parent",get:function get(){return this._parent?this._parent():null;}}],[{key:"fromJSON",value:function fromJSON(value){var _x=window.storage.Generic_fromJSON(Inventory,value.data);return _x;}}]);return Inventory;}();"use strict";var Mob=/*#__PURE__*/function(_Character){_inherits(Mob,_Character);var _super3=_createSuper(Mob);function Mob(){var _this4;_classCallCheck(this,Mob);_this4=_super3.call(this);_this4.level_min=1;_this4.baseXPReward=0;_this4.loot=[];//[{id:'healthpotion',chance:5, amount:1}]
_this4.levelUp(1);_this4.autoLeveling();_this4.despawn=false;_this4.unique=false;//true if this is a persistent character
_this4.baseName="";//name might be Slime#1 but baseName is Slime
_this4.fconv=null;//lazy init because descfixer depends on gm.player
return _this4;}_createClass(Mob,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("Mob",this);}},{key:"calcCombatMove",//override to return the next move to execute
//OK = false if no action, else true
//msg should contain a message formatted for view (move description )g 
//this function should decide what actions the mob takes; 
//query _canAct to check if stunned or otherwise incapaciated
value:function calcCombatMove(enemys,friends){var rnd=_.random(1,100);var result={OK:true,msg:''};result.action=result.target=null;if(rnd>80||rnd>20&&this.Effects.findEffect('effHesitant').length<=0){rnd=_.random(0,enemys.length-1);result.action="Attack";result.target=[enemys[rnd]];//result.msg =this.name+" attacks "+ result.target[0].name+".</br>"+result.msg;
}else{if(this.Skills.countItem('Guard')>0){result.action="Guard";result.target=[this];}result.msg=this.name+" takes a defensive stance.</br>"+result.msg;}return result;}//return false if skill should be manually selected
},{key:"scaleLevel",//randomize mob level around target-level but not below min-level: +-20%;
value:function scaleLevel(lvl){var x;x=Math.round(window.gm.util.randomNormal(lvl,lvl*0.2));x=Math.max(this.level_min,x);x=x-this.level;if(x>0){this.levelUp(x);this.autoLeveling();}//refill gained stats 
this.Stats.increment("health",99999);this.Stats.increment("energy",99999);this.Stats.increment("will",99999);}},{key:"levelUp",value:function levelUp(add){_get(_getPrototypeOf(Mob.prototype),"levelUp",this).call(this,add);this.baseXPReward=this.level*20;//todo baseXP = sum of statpoints + skills ?
}},{key:"isAIenabled",get:function get(){return true;}}],[{key:"fromJSON",value:function fromJSON(value){var _x=window.storage.Generic_fromJSON(Mob,value.data);_x._relinkItems();return _x;}}]);return Mob;}(Character);"use strict";/* a player has an outfit describing which Equipment (wardrobe,utilities,..) he has equiped
*/ //this is a lookuptable for the equipmentslots
//basially you could create your own slotdefinition, the string is used to lookup properties assigned to list 
window.gm.OutfitSlotLib={//b.. = bodyparts  (separated for mutation-slots)
bBase:"bBase",//defines overall bodyform
bFeet:"bFeet",bLegs:"bLegs",bTorso:"bTorso",bWings:"bWings",bSkin:"bSkin",// or fur,scales,...
bPubicHair:"bPubicHair",bHeadHair:"bHeadHair",bArms:"bArms",bHands:"bHands",bNeck:"bNeck",bFace:"bFace",bEyes:"bEyes",bEars:"bEars",bMouth:"bMouth",bTongue:"bTongue",bTailBase:"bTailBase",bBreast:"bBreast",bNipples:"bNipples",bPenis:"bPenis",bBalls:"bBalls",bVulva:"bVulva",bClit:"bClit",bWomb:"bWomb",bAnus:"bAnus",// slots for wearables
Feet:"Feet",Ankles:"Ankles",Legs:"Legs",Thighs:"Thighs",//
Hips:"Hips",//belt
Torso:"Torso",//dont use !
Breast:"Breast",Nipples:"Nipples",Penis:"Penis",Balls:"Balls",Vulva:"Vulva",Clit:"Clit",Womb:"Womb",//??
Anus:"Anus",TailBase:"TailBase",TailTip:"TailTip",Stomach:"Stomach",Chest:"Chest",Shoulders:"Shoulders",Wings:"Wings",Neck:"Neck",Head:"Head",HeadHair:"HeadHair",//for Hats
Face:"Face",//for facemask
Mouth:"Mouth",Nose:"Nose",Eyes:"Eyes",Ears:"Ears",Arms:"Arms",Wrists:"Wrists",LHand:"LHand",RHand:"RHand",//U  = under wear    P = piercing T = tattoo 
uFeet:"uFeet",//socks,stockings
uAnkles:"uAnkles",//stockings, cuffs
uLegs:"uLegs",//stockings
uThighs:"uThighs",uHips:"uHips",uTorso:"uTorso",//not used !
uBreast:"uBreast",//bra
pNipples:"pNipples",tStomach:"tStomach",uPenis:"uPenis",pPenis:"pPenis",uBalls:"uBalls",pBalls:"pBalls",uVulva:"uVulva",pVulva:"pVulva",pClit:"pClit",uAnus:"uAnus",uTailBase:"uTailBase",uTailTip:"uTailTip",uStomach:"uStomach",uChest:"uChest",//bra
uShoulders:"uShoulders",uWings:"uWings",uNeck:"uNeck",//necklace
uHead:"uHead",//
uHeadHair:"uHeadHair",uFace:"uFace",uMouth:"uMouth",pNose:"pNose",pEyes:"pEyes",pEars:"pEars",//earring
pTongue:"pTongue",pNavel:"pNavel",uArms:"uArms",uWrists:"uWrists",uLHand:"uLHand",uRHand:"uRHand"};//Todo equip on other char:
//move from own inventory to chars, equip, if impossible undo 
var Equipment=/*#__PURE__*/function(_Item){_inherits(Equipment,_Item);var _super4=_createSuper(Equipment);function Equipment(name){var _this5;_classCallCheck(this,Equipment);_this5=_super4.call(this,name);_this5.slotUse=[];//which slot is used by the equip
_this5.slotCover=[];//which other slots are invisible by this "uses Breast, covers bBreast,bNipples"
_this5.lewd={slut:0,bondage:0,sm:0};//slutiness-rating 
return _this5;}_createClass(Equipment,[{key:"_relinkItems",value:function _relinkItems(parent){//call this after loading save data to reparent
_get(_getPrototypeOf(Equipment.prototype),"_relinkItems",this).call(this,parent);var _iterator30=_createForOfIteratorHelper(this.bonus),_step30;try{for(_iterator30.s();!(_step30=_iterator30.n()).done;){var n=_step30.value;n._relinkItems(this);}}catch(err){_iterator30.e(err);}finally{_iterator30.f();}}//for compatibility with item
},{key:"usable",value:function usable(context){return{OK:false,msg:'Useable in wardrobe'};}},{key:"use",value:function use(context){return{OK:false,msg:'Cannot use.'};}//more detailed description that should reflet if the item is worn or not; 
},{key:"descLong",value:function descLong(fconv){var msg='';var rnd=_.random(0,100);if(this.isEquipped()){if(rnd>50)msg='$[I]$ $[wear]$ '+this.name+'.';else msg='A '+this.name+' adorns $[me]$.';}else{if(rnd>50)msg='$[I]$ $[own]$ '+this.name+".";else msg='$[I]$ $[have]$ '+this.name+".";}return fconv(msg);}},{key:"bonusDesc",value:function bonusDesc(){var msg='';var _iterator31=_createForOfIteratorHelper(this.bonus),_step31;try{for(_iterator31.s();!(_step31=_iterator31.n()).done;){var n=_step31.value;msg+="\n"+n.desc;//</br> todo 
}}catch(err){_iterator31.e(err);}finally{_iterator31.f();}return msg;}},{key:"isEquipped",value:function isEquipped(){return this.parent.parent.Outfit&&this.parent.parent.Outfit.findItemSlot(this.id).length>0;}},{key:"canEquip",value:function canEquip(context){if(this.parent&&this.parent.parent.Outfit.findItemSlot(this.id).length>0)return this.canUnequip();//if you try to equip the same outfit another time it should unequip 
else return{OK:true,msg:'equipable'};}},{key:"canUnequip",value:function canUnequip(){var n,res={OK:true,msg:'unequipable'};var _iterator32=_createForOfIteratorHelper(this.bonus),_step32;try{for(_iterator32.s();!(_step32=_iterator32.n()).done;){n=_step32.value;res=n.canUnequip();if(res.OK===false)return res;}}catch(err){_iterator32.e(err);}finally{_iterator32.f();}return res;}//call Outfit.addItem instead !
},{key:"onEquip",value:function onEquip(context){var n,res={OK:true,msg:this.name+' equipped'};var _iterator33=_createForOfIteratorHelper(this.bonus),_step33;try{for(_iterator33.s();!(_step33=_iterator33.n()).done;){n=_step33.value;n.onEquip();}}catch(err){_iterator33.e(err);}finally{_iterator33.f();}if(this.equipText)res.msg=this.equipText(context);return res;}},{key:"onUnequip",value:function onUnequip(){var n,res={OK:true,msg:this.name+' unequipped'};var _iterator34=_createForOfIteratorHelper(this.bonus),_step34;try{for(_iterator34.s();!(_step34=_iterator34.n()).done;){n=_step34.value;n.onUnequip();}}catch(err){_iterator34.e(err);}finally{_iterator34.f();}if(this.unequipText)res.msg=this.unequipText(context);return res;}//implement unequipText()/equipText() to return a msg for display
},{key:"onTimeChange",value:function onTimeChange(now){var _iterator35=_createForOfIteratorHelper(this.bonus),_step35;try{for(_iterator35.s();!(_step35=_iterator35.n()).done;){var n=_step35.value;n.onTimeChange(now);}}catch(err){_iterator35.e(err);}finally{_iterator35.f();}}},{key:"HP",get:function get(){return this._HP!=undefined?this._HP:100.0;},set:function set(hp){//add this line to style-setter if you want to use hp:  if(this._HP) this.HP=this._HP;
//todo if multiple items edited ??
//todo unequip on 0hp?
this._HP=hp;this._updateId();this.name=this.baseId+" "+hp.toString()+"%";//todo "damaged shirt"
}},{key:"desc",get:function get(){return this.descShort+this.bonusDesc();}}]);return Equipment;}(Item);var Weapon=/*#__PURE__*/function(_Equipment){_inherits(Weapon,_Equipment);var _super5=_createSuper(Weapon);function Weapon(){var _this6;_classCallCheck(this,Weapon);_this6=_super5.call(this);_this6.addTags([window.gm.ItemTags.Weapon]);return _this6;}_createClass(Weapon,[{key:"usable",value:function usable(context){return this.canEquip(context);}},{key:"use",value:function use(context){//context here is inventory not outfit
if(this.parent.parent.Outfit.findItemSlot(this.id).length>0){this.parent.parent.Outfit.removeItem(this.id);return{OK:true,msg:'unequipped '+this.name};//todo
}else{this.parent.parent.Outfit.addItem(this);return{OK:true,msg:'equipped '+this.name};//todo
}}},{key:"onEquip",value:function onEquip(context){return{OK:true,msg:'equipped'};}},{key:"onUnequip",value:function onUnequip(){return{OK:true,msg:'unequipped'};}}]);return Weapon;}(Equipment);//a kind of special inventory for worn equipment
var Outfit=/*#__PURE__*/function(){//extends Inventory{
function Outfit(){_classCallCheck(this,Outfit);//new: multiple slots may point to same item; load creates different items for each slot!
this.list=[];// [{item:x, slots:['Legs']}]
this.slots=[];//['RHand','Legs']
window.storage.registerConstructor(Outfit);}_createClass(Outfit,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("Outfit",this);}},{key:"postItemChange",value:function postItemChange(id,operation,msg){window.gm.pushLog('Outfit: '+operation+' '+id+' '+msg);}},{key:"_relinkItems",value:function _relinkItems(){//call this after loading save data to reparent
var _iterator36=_createForOfIteratorHelper(this.list),_step36;try{for(_iterator36.s();!(_step36=_iterator36.n()).done;){var n=_step36.value;/*if(n.value.item){     old
                n.value.item._relinkItems(this);
            }*/n.item._relinkItems(this);}}catch(err){_iterator36.e(err);}finally{_iterator36.f();}}},{key:"_updateId",value:function _updateId(oldId){}},{key:"count",value:function count(){return this.list.length;}//return( Object.keys(this.list).length);} old
//count how many slots are used by an item
},{key:"countItem",value:function countItem(id){//let _i = this.findItemSlot(id); return(_i.length);  old
return this.findItemSlot(id).length;}//detect which slots are used by a item
},{key:"findItemSlot",value:function findItemSlot(id){var _iterator37=_createForOfIteratorHelper(this.list),_step37;try{for(_iterator37.s();!(_step37=_iterator37.n()).done;){var n=_step37.value;if(n.item.id===id)return n.slots;}}catch(err){_iterator37.e(err);}finally{_iterator37.f();}return[];}},{key:"getItemId",value:function getItemId(slot){//let item = this.list[slot]; return(item?item.id:""); old
var _iterator38=_createForOfIteratorHelper(this.list),_step38;try{for(_iterator38.s();!(_step38=_iterator38.n()).done;){var n=_step38.value;if(n.slots.includes(slot))return n.item.id;}}catch(err){_iterator38.e(err);}finally{_iterator38.f();}return"";}//override because findItemSlot returns array
},{key:"getItem",value:function getItem(id){var noerror=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var _iterator39=_createForOfIteratorHelper(this.list),_step39;try{for(_iterator39.s();!(_step39=_iterator39.n()).done;){var n=_step39.value;if(n.item.id===id)return n.item;}}catch(err){_iterator39.e(err);}finally{_iterator39.f();}if(noerror===false)throw new Error('no such item: '+id);return null;}//returns all Item-Ids in list
},{key:"getAllIds",value:function getAllIds(){var ids=[];var _iterator40=_createForOfIteratorHelper(this.list),_step40;try{for(_iterator40.s();!(_step40=_iterator40.n()).done;){var n=_step40.value;ids.push(n.item.id);}}catch(err){_iterator40.e(err);}finally{_iterator40.f();}return ids;}},{key:"getItemForSlot",value:function getItemForSlot(slot){//let item = this.list[slot]; return(item?item.item:null); old
var _iterator41=_createForOfIteratorHelper(this.list),_step41;try{for(_iterator41.s();!(_step41=_iterator41.n()).done;){var n=_step41.value;if(n.slots.includes(slot))return n.item;}}catch(err){_iterator41.e(err);}finally{_iterator41.f();}return null;}},{key:"canEquipSlot",value:function canEquipSlot(slot){//Todo a snake doesnt have RHand ! limit OutfitSlotLib-slot according bodypart, update slot after bodypart-change
return{OK:true};}},{key:"canUnequipSlot",value:function canUnequipSlot(slot){return{OK:true};}},{key:"canUnequipItem",value:function canUnequipItem(id,force){var _idx=this.findItemSlot(id);var _item=this.getItem(id);var result=_item.canUnequip();for(var i=0;i<_idx.length;i++){var _tmp=this.canUnequipSlot(_idx[i]);if(!_tmp.OK)result.msg+=_tmp.msg+" ";result.OK=result.OK&&_tmp.OK;}return result;}//this will equip item if possible
},{key:"addItem",value:function addItem(item,force){var result={OK:true,msg:''},_idx=this.findItemSlot(item.id);if(_idx.length>0)return result;//already equipped
var _item=item;_idx=_item.slotUse;var _oldIDs=[],_oldItem,_oldSlots=[];//check if equipment is equipable
result=this.canEquipSlot(_idx);// check if slot is available for equip this
if(result.OK){result=item.canEquip(this);if(result.OK){for(var l=0;l<_idx.length;l++){//check if the current equip can be unequipped
var oldId=this.getItemId(_idx[l]);if(oldId==='')continue;if(_oldIDs.indexOf(oldId)<0){_oldIDs.push(oldId);_oldSlots=_oldSlots.concat(this.getItem(oldId).slotUse);}var _tmp=this.canUnequipItem(oldId);if(!_tmp.OK)result.msg+=_tmp.msg;//todo duplicated msg if item uses multiple slots
result.OK=result.OK&&_tmp.OK;}}}if(!result.OK){this.postItemChange(_item.name,"equip_fail:",result.msg);return result;}for(var m=0;m<_oldIDs.length;m++){this.removeItem(_oldIDs[m]);}//if item is from wardrobe/Inventory, remove it there
if(item.parent&&item.parent.removeItem){item.parent.removeItem(item.id);_item=window.gm.util.deepClone(item);}_item._parent=window.gm.util.refToParent(this);//Todo currently we have 2 copies of equipment - 1 for wardrobe 1 for outfit otherwise this will not work
this.list.push({item:_item,slots:_item.slotUse});result=_item.onEquip(this);result.removedIds=_oldIDs;this.postItemChange(_item.name,"equipped",""/*result.msg*/);return result;}//assumme that it was checked before that unequip is allowed
},{key:"__clearSlot",value:function __clearSlot(slot,force){/*let item = this.list[slot];   old
        if(item){
            item.id = '', item.item=null;
        }*/}},{key:"removeItem",value:function removeItem(id,force){var result={OK:true,msg:''};/*let _idx = this.findItemSlot(id);   old
        if(_idx.length===0) return(result); //already unequipped*/var _allIds=this.getAllIds();if(!_allIds.includes(id))return result;//already unequipped
result=force?result:this.canUnequipItem(id);if(!result.OK){this.postItemChange(id,"unequip_fail",result.msg);return result;}var _idx=_allIds.indexOf(id),_item=this.list[_idx].item;result=_item.onUnequip(this);this.list.splice(_idx,1);//unequipped items go into wardrobe except bodyparts
if(_item.hasTag('body')){//dont store bodyparts 
}else if(_item.hasTag(window.gm.ItemTags.Weapon)){this.parent.Inv.addItem(_item);}else{this.parent.Wardrobe.addItem(_item);}this.postItemChange(id,"removed",""/*result.msg*/);//Todo delete _item;    //un-parent
return result;}},{key:"updateTime",value:function updateTime(){var now=window.gm.getTime();var _iterator42=_createForOfIteratorHelper(this.list),_step42;try{for(_iterator42.s();!(_step42=_iterator42.n()).done;){var n=_step42.value;//let _eff = n.value.item;  old
var _eff=n.item;if(_eff)_eff.onTimeChange(now);}}catch(err){_iterator42.e(err);}finally{_iterator42.f();}}/**
     * returns all items that can be seen (Breast-armor hides breast-underwear hides breast)
     */},{key:"getVisibleSlots",value:function getVisibleSlots(){var covered=[],seen=[],lstIds=this.getAllIds();for(var i=lstIds.length-1;i>=0;i--){var item=this.getItem(lstIds[i]);covered=covered.concat(item.slotCover);seen=seen.concat(item.slotUse);}function remCovered(elm){return!covered.includes(elm);}seen=seen.filter(remCovered);return seen;}},{key:"getLewdness",value:function getLewdness(){var total={},lewd={};var item,slots=this.getVisibleSlots();for(var i=0;i<slots.length-1;i++){item=this.getItemForSlot(slots[i]);if(item&&!lewd[item.id]){//no double count items  
lewd[item.id]=item.lewd;}}var _keys=Object.keys(lewd);// {slut:0,sm:2}
for(var i=0;i<_keys.length;i++){item=lewd[_keys[i]];var _keys2=Object.keys(item);for(var _i4=0,_keys3=_keys2;_i4<_keys3.length;_i4++){var n=_keys3[_i4];if(total.hasOwnProperty(n))total[n]+=item[n];else total[n]=item[n];}}return total;}},{key:"parent",get:function get(){return this._parent?this._parent():null;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(Outfit,value.data);}}]);return Outfit;}();"use strict";window.gm=window.gm||{};///////////////////////////////////////////////////////////////////////
window.gm.startDominoCombat=function(stopCB,startCB){function start(){//setup teams,cards
data.teams=[];var i,skills,players,x=0;for(i=0;i<=1;i++){//teams
players=[];for(var k=0;k<i+1;k++){skills=[];//skills
if(x===0){skills.push({id:'skill#'+0,start:'blue',end:'red',hp:15,charge:1,cooldown:0});skills.push({id:'skill#'+1,start:'red',end:'blue',hp:5,charge:1,cooldown:0});skills.push({id:'skill#'+2,start:'blue',end:'blue',hp:25,charge:3,cooldown:0});skills.push({id:'skill#'+3,start:'red',end:'green',hp:25,charge:3,cooldown:0});skills.push({id:'skill#'+4,start:'red',end:'red',hp:25,charge:4,cooldown:0});}else if(x===1){skills.push({id:'skill#'+3,start:'red',end:'red',hp:25,charge:3,cooldown:0});skills.push({id:'skill#'+4,start:'blue',end:'red',hp:25,charge:4,cooldown:0});}else{skills.push({id:'skill#'+0,start:'blue',end:'red',hp:15,charge:2,cooldown:0});skills.push({id:'skill#'+2,start:'red',end:'blue',hp:5,charge:2,cooldown:0});skills.push({id:'skill#'+3,start:'red',end:'red',hp:5,charge:2,cooldown:0});}players.push({id:'player#'+x,hp:100,color:'blue',skills:skills});x+=1;}data.teams.push(players);}data.run=true;newTurn();}function updateBoard(){var player,skill;//update players or remove them: list health and color of each player
//check victory condition
var entry,panel=document.getElementById('panel');for(var i=panel.childNodes.length-1;i>=0;i--){panel.removeChild(panel.childNodes[i]);}//cleanout skill selection
var choice=document.getElementById('choice');for(var i=choice.childNodes.length-1;i>=0;i--){choice.removeChild(choice.childNodes[i]);}for(var i=data.teams.length-1;i>=0;i--){for(var k=data.teams[i].length-1;k>=0;k--){player=data.teams[i][k];entry=document.createElement('button');entry.id=player.id;entry.style['color']=player.color;if(player.hp>0){entry.textContent='Team'+i+' '+player.id+' hp:'+player.hp+' '+player.color;}else{entry.textContent='Team'+i+' '+player.id+' is down';}if(data.team===i||player.hp<=0){entry.disabled=true;}else{//bind click handler targetselect
entry.addEventListener("click",function(target){return selectTarget.bind(data,target);}(player.id));data.target=player.id;}panel.appendChild(entry);if(player.hp>0&&player.id===data.player){//list skills for curr. player
entry.style['border-block-color']='khaki',entry.style['border-block-width']='5px';for(var l=player.skills.length-1;l>=0;l--){skill=player.skills[l];entry=document.createElement('button');entry.id=skill.id;entry.textContent=skill.id+' '+skill.start+' -> '+skill.end+' hits:'+skill.hp+' cooldown:'+skill.cooldown;if(skill.cooldown>0){entry.disabled=true;}else{entry.addEventListener("click",function(player,skill){return selectSkill.bind(data,player,skill);}(player.id,skill.id));}choice.appendChild(entry);}entry=document.createElement('button');entry.id=entry.textContent='skip';entry.addEventListener("click",nextPlayer);choice.appendChild(entry);}if(player.hp<=0&&player.id===data.player){//skip dead players
nextPlayer();return;}}entry=document.createElement('hr');panel.appendChild(entry);}entry=document.createElement('p');entry.textContent=data.player+': select target and skill:';choice.appendChild(entry);}function newTurn(){//check if any team is down
var teamDead,player,skill;for(var i=data.teams.length-1;i>=0;i--){teamDead=true;for(var k=data.teams[i].length-1;k>=0;k--){player=data.teams[i][k];if(player.hp>0)teamDead=false;for(var l=player.skills.length-1;l>=0;l--){//tick skills
skill=player.skills[l];skill.cooldown=Math.max(0,skill.cooldown-1);}}if(teamDead){alert('team '+i+' is defeated');stop();break;}else{//start new round with team0 - note that all for-loops are operated backwards
data.team=data.teams.length-1;var x=data.teams[data.team].length-1;data.player=data.teams[data.team][x].id;updateBoard();}}}function nextPlayer(){var player,_usethis;//skip to next alive in team
_usethis=false;for(var k=data.teams[data.team].length-1;k>=0;k--){player=data.teams[data.team][k];if(_usethis===true){//the previous player was the current - this is next 
data.player=player.id;_usethis=false;break;}if(player.id===data.player){_usethis=true;}}if(_usethis===true){//no more players in team, switch to next
data.team-=1;for(var i=data.team;_usethis&&i>=0;i--){for(var k=data.teams[i].length-1;_usethis&&k>=0;k--){player=data.teams[i][k];if(player.hp>0){data.player=player.id;_usethis=false;}}}if(_usethis===true){newTurn();//but if no one left... 
return;}}updateBoard();}function selectTarget(id){this.target=id;}function selectSkill(playerId,skillId){var playerA,playerB,player,skill,skillA;for(var i=data.teams.length-1;i>=0;i--){//find players
for(var k=data.teams[i].length-1;k>=0;k--){player=data.teams[i][k];if(player.id===data.target){playerB=player;}if(player.id===playerId){playerA=player;for(var l=player.skills.length-1;l>=0;l--){//get skill
skill=player.skills[l];if(skill.id===skillId){skillA=skill;}}}}}//execute skill & print log
var _log="div#output";if(playerA.color===skillA.start){if(playerB.color===skillA.start){playerB.hp-=skillA.hp;playerB.color=skillA.end;window.gm.printOutput(playerA.id+" dealt "+skillA.hp+" damage to "+playerB.id,_log);}else{playerB.hp-=skillA.hp/5;window.gm.printOutput(playerB.id+" color doesnt match - less damage",_log);}}else{window.gm.printOutput(playerA.id+" color wrong - epic fail",_log);}playerA.color=skillA.end;skillA.cooldown=skillA.charge;nextPlayer();}function stop(){data.run=false;}var data={//internal state of game
scoreBoard:document.getElementById(panel),run:false,//game started?
teams:[],team:0,player:'',target:'',stopCB:stopCB,//callback after user trigger 
startCB:startCB,//callback after start
start:start//ref to start-function
};return data;};///////////////////////////////////////////////////////////////////////
window.gm.startCounterChargeCombat=function(stopCB,startCB){function start(){//setup teams,cards
data.teams=[];var i,skills,defense,players,x=0;for(i=0;i<=1;i++){//teams
players=[];for(var k=0;k<i+1;k++){defense=[],skills=[];//skills
if(x===0){skills.push({id:'skill#'+0,start:'blue',charge:'',hp:15,tick:0,cooldown:0});skills.push({id:'skill#'+1,start:'red',charge:'',hp:5,tick:0,cooldown:0});skills.push({id:'skill#'+2,start:'blue',charge:'blue',hp:25,tick:0,cooldown:0});skills.push({id:'skill#'+3,start:'red',charge:'green',hp:25,tick:0,cooldown:0});skills.push({id:'skill#'+4,start:'red',charge:'red',hp:25,tick:0,cooldown:0});defense.push({id:'defense#'+1,start:'red',charge:'red',tick:0,cooldown:1});defense.push({id:'defense#'+2,start:'blue',charge:'red',tick:0,cooldown:1});}else if(x===1){skills.push({id:'skill#'+3,start:'red',charge:'red',hp:25,tick:0,cooldown:0});skills.push({id:'skill#'+4,start:'blue',charge:'',hp:5,tick:0,cooldown:0});defense.push({id:'defense#'+1,start:'red',charge:'red',tick:0,cooldown:1});defense.push({id:'defense#'+2,start:'blue',charge:'red',tick:0,cooldown:1});}else{skills.push({id:'skill#'+0,start:'blue',charge:'red',hp:15,tick:0,cooldown:0});skills.push({id:'skill#'+2,start:'red',charge:'',hp:5,tick:0,cooldown:0});skills.push({id:'skill#'+3,start:'red',charge:'',hp:5,tick:0,cooldown:0});}players.push({id:'player#'+x,hp:100,charge:{blue:0,red:50,green:0},skills:skills,defenses:defense});x+=1;}data.teams.push(players);}data.run=true,data.phase=0;newTurn();}function updateBoard(){var player,skill;var entry,panel=document.getElementById('panel');for(var i=panel.childNodes.length-1;i>=0;i--){panel.removeChild(panel.childNodes[i]);}//cleanout buttons
var choice=document.getElementById('choice');for(var i=choice.childNodes.length-1;i>=0;i--){choice.removeChild(choice.childNodes[i]);}//update players or remove them: list health and color of each player
for(var i=data.teams.length-1;i>=0;i--){for(var k=data.teams[i].length-1;k>=0;k--){player=data.teams[i][k];entry=document.createElement('button');entry.id=player.id;if(player.hp>0){entry.textContent='Team'+i+' '+player.id+' hp:'+player.hp+' blue:'+player.charge.blue+' red:'+player.charge.red+' green:'+player.charge.green;}else{entry.textContent='Team'+i+' '+player.id+' is down';}if(data.team===i||player.hp<=0||data.phase===1){//phase1 -> defender selects defense
entry.disabled=true;}else{//bind click handler targetselect
entry.addEventListener("click",function(target){return selectTarget.bind(data,target);}(player.id));data.target=player.id;}panel.appendChild(entry);if(player.hp<=0){//skip dead players
nextPlayer();return;}if(data.phase===0&&player.hp>0&&player.id===data.player){//list skills of attacker
entry.style['border-block-color']='khaki',entry.style['border-block-width']='5px';for(var l=player.skills.length-1;l>=0;l--){skill=player.skills[l];entry=document.createElement('button');entry.id=skill.id;entry.textContent=skill.id+' '+skill.start+' hits:'+skill.hp+(skill.charge!==''?' requires:'+skill.charge:'')+' cooldown:'+skill.tick;if(skill.tick>0||skill.charge!==''&&player.charge[skill.charge]<50){entry.disabled=true;//disable if cooldown or not enough charge
}else{entry.addEventListener("click",function(player,skill){return selectSkill.bind(data,player,skill);}(player.id,skill.id));}choice.appendChild(entry);}entry=document.createElement('button');entry.id=entry.textContent='skip';entry.addEventListener("click",nextPlayer);choice.appendChild(entry);}else if(data.phase===1&&player.hp>0&&player.id===data.target){//list defense of target
for(var l=player.defenses.length-1;l>=0;l--){skill=player.defenses[l];entry=document.createElement('button');entry.id=skill.id;entry.textContent=skill.id+' '+skill.start+' charges:'+skill.charge+' cooldown:'+skill.tick;if(skill.tick>0||data.skillcolor!==skill.start){//
entry.disabled=true;//disable if cooldown or color wrong
}else{entry.addEventListener("click",function(player,skill){return selectDefense.bind(data,player,skill);}(player.id,skill.id));}choice.appendChild(entry);}entry=document.createElement('button');entry.id=entry.textContent='skip';entry.addEventListener("click",function(player,skill){return selectDefense.bind(data,player,skill);}(player.id,''));choice.appendChild(entry);}}entry=document.createElement('hr');panel.appendChild(entry);}entry=document.createElement('p');entry.textContent=data.phase===0?data.player+': select target and skill:':data.target+': select defense:';choice.appendChild(entry);}function newTurn(){//check if any team is down
var teamDead,player,skill;data.phase=0;for(var i=data.teams.length-1;i>=0;i--){teamDead=true;for(var k=data.teams[i].length-1;k>=0;k--){player=data.teams[i][k];if(player.hp>0)teamDead=false;for(var l=player.skills.length-1;l>=0;l--){//tick skills
skill=player.skills[l];skill.tick=Math.max(0,skill.tick-1);}for(var l=player.defenses.length-1;l>=0;l--){//tick skills
skill=player.defenses[l];skill.tick=Math.max(0,skill.tick-1);}}if(teamDead){alert('team '+i+' is defeated');stop();break;}else{//start new round with team0 - note that all for-loops are operated backwards
data.team=data.teams.length-1;var x=data.teams[data.team].length-1;data.player=data.teams[data.team][x].id;updateBoard();}}}function nextPlayer(){var player,_usethis;data.phase=0;//skip to next alive in team
_usethis=false;for(var k=data.teams[data.team].length-1;k>=0;k--){player=data.teams[data.team][k];if(_usethis===true){//the previous player was the current - this is next 
data.player=player.id;_usethis=false;break;}if(player.id===data.player){_usethis=true;}}if(_usethis===true){//no more players in team, switch to next
data.team-=1;for(var i=data.team;_usethis&&i>=0;i--){for(var k=data.teams[i].length-1;_usethis&&k>=0;k--){player=data.teams[i][k];if(player.hp>0){data.player=player.id;_usethis=false;}}}if(_usethis===true){newTurn();//but if no one left... 
return;}}updateBoard();}function selectTarget(id){this.target=id;}function selectDefense(playerId,skillId){var playerA,playerB,player,skill,skillA,defenseB;var _log="div#output";for(var i=data.teams.length-1;i>=0;i--){//find players
for(var k=data.teams[i].length-1;k>=0;k--){player=data.teams[i][k];if(player.id===data.target){playerB=player;for(var l=player.defenses.length-1;l>=0;l--){//get skill
skill=player.defenses[l];if(skill.id===skillId){defenseB=skill;}}}if(player.id===data.player){playerA=player;for(var l=player.skills.length-1;l>=0;l--){//get skill
skill=player.skills[l];if(skill.id===data.skill){skillA=skill;}}}}}if(skillId===''||skillA.start!==defenseB.start){//full damage if no color match or nor defense selected
playerB.hp-=skillA.hp;playerA.charge[skillA.start]+=10;window.gm.printOutput(playerA.id+" dealt "+skillA.hp+" damage to "+playerB.id,_log);}else{//if color matches, reduce damage & build charge on target
playerB.charge[defenseB.charge]+=20;playerB.hp-=skillA.hp/2;window.gm.printOutput(playerB.id+" defended against "+playerB.id+' and charged '+defenseB.charge,_log);}skillA.tick=skillA.cooldown;if(skillA.charge!==''){playerA.charge[skillA.charge]-=50;}if(skillId!==''){defenseB.tick=defenseB.cooldown;}nextPlayer();}function selectSkill(playerId,skillId){var playerA,playerB,player,skill,skillA;var _log="div#output";for(var i=data.teams.length-1;i>=0;i--){//find players
for(var k=data.teams[i].length-1;k>=0;k--){player=data.teams[i][k];if(player.id===data.target){playerB=player;}if(player.id===playerId){playerA=player;for(var l=player.skills.length-1;l>=0;l--){//get skill
skill=player.skills[l];if(skill.id===skillId){skillA=skill;}}}}}window.gm.printOutput("",_log);data.phase=1;data.skill=skillA.id,data.skillcolor=skillA.start;updateBoard();}function stop(){data.run=false;}var data={//internal state of game
scoreBoard:document.getElementById(panel),run:false,//game started?
teams:[],team:0,player:'',skill:'',skillcolor:'',target:'',stopCB:stopCB,//callback after user trigger 
startCB:startCB,//callback after start
start:start//ref to start-function
};return data;};///////////////////////////////////////////////////////////////////////
window.gm.startOmeterCombat=function(stopCB,startCB){function start(Teams,AI,debug){//setup teams,cards
data.debug.display=debug.display?'all':'minimum',data.teams=[];data.debug.staminaOff=debug.staminaOff;data.AI=[];var _iterator43=_createForOfIteratorHelper(AI),_step43;try{for(_iterator43.s();!(_step43=_iterator43.n()).done;){var _x=_step43.value;switch(_x){case'none':data.AI.push(null);break;case'passive':data.AI.push(AIpassive);break;case'selfish':data.AI.push(AIselfish);break;default:throw new Error("invalid AI "+_x);}}}catch(err){_iterator43.e(err);}finally{_iterator43.f();}var i,playerid,skills,defense,players,x=-1;for(i=0;i<=1;i++){//teams
players=[];for(var k=0;k<1;k++){x+=1,defense=[],skills=[];//skills   // own lust also depends on foe-lustinput*FactorReceive
skills.push({id:'tease',stamina:-10,fr:1.5,lustself:1,lustother:3,tick:0,cooldown:0});skills.push({id:'calm',stamina:-3,fr:0.5,lustself:-3,lustother:0,tick:0,cooldown:0});skills.push({id:'fuck',stamina:-10,fr:1.2,lustself:4,lustother:5,tick:0,cooldown:0});skills.push({id:'deny',stamina:-10,fr:0.5,lustself:-5,lustother:-5,tick:0,cooldown:0});skills.push({id:'passive',stamina:20,fr:1.0,lustself:-1,lustother:-1,tick:0,cooldown:0});playerid='player#'+x;players.push({id:playerid,skills:skills,defenses:defense,skill:'',target:'',essence:0,stamina:Teams[i][k].stamina//{min:0,max:100,exhausted:20,curr:80,regen:5}
,ometer:Teams[i][k].ometer//{min:0,denial:20,minor:60,gasm:85,max:100,curr:0}, //ostim=max
,pleasure:Teams[i][k].pleasure//{min:0,annoy:20,good:60,max:80,PNR:70,curr:10}
});_createBars(players[players.length-1],i,i===0&&k===0);}data.teams.push(players);}data.run=true;newTurn();}function _createBars(player,teamidx,firstcall){var box,box2,entry,entry2,panel=document.getElementById('panel2');for(var i=panel.childNodes.length-1;firstcall&&i>=0;i--){panel.removeChild(panel.childNodes[i]);}//create bargraphs with ids = player.id+'stamina'
//<div class="progressbar" id='clickHere' style='height:1em; width: 100%;'><div id='bar' style="position:relative; width:5%; height:100%; background-color:green;"></div></div>
box=document.createElement('p');//box.style['width']='25em';
box.textContent=player.id,box.id=player.id;box2=document.createElement('span');box2.id=player.id+'essence';box.appendChild(box2);for(var _i5=0,_arr=['ometer','pleasure','stamina'];_i5<_arr.length;_i5++){var el=_arr[_i5];box2=document.createElement('p');box2.textContent=el;box2.hidden=el==='stamina'&&data.debug.display!=='all'&&teamidx>0;entry=document.createElement('div');entry.className="progressbar",entry.style['height']='1em',entry.style['width']='100%';entry2=document.createElement('div');entry2.id=player.id+el;entry2.style['height']='100%',entry2.style['width']='2%',entry2.style['position']='relative',entry2.style['background-color']='fuchsia';entry.appendChild(entry2);box2.appendChild(entry);box.appendChild(box2);entry2.style.transition="left "+data.speed+"ms linear";//configure css-transition for slider animation
}panel.appendChild(box);}///
var maxx=0,maxv=0;function _updateBars(player){var box,bar,value,gradient='',areas=[];box=document.getElementById(player.id+'essence');box.textContent=' essence:'+window.gm.util.formatNumber(player.essence,0);for(var i=0;i<=1;i++){//2 swipes
for(var _i6=0,_arr2=['ometer','pleasure','stamina'];_i6<_arr2.length;_i6++){var el=_arr2[_i6];if(i===0){bar=document.getElementById(player.id+el);value=player[el].curr/(player[el].max-player[el].min);maxv=Math.max(value,maxv);maxx=Math.max(player[el].max-player[el].min,maxx);var rwidth,width=window.getComputedStyle(bar).getPropertyValue('width');var total=window.getComputedStyle(bar.parentNode).getPropertyValue('width');rwidth=100*parseFloat(width.split('px'))/parseFloat(total.split('px'));bar.style.left=value*100-rwidth+'%';//wouldnt
switch(el){case'pleasure':areas=[{a:0,b:player[el].annoy*100/player[el].max,color:'steelblue'},{a:player[el].annoy*100/player[el].max,b:player[el].good*100/player[el].max,color:'white'},{a:player[el].good*100/player[el].max,b:player[el].PNR*100/player[el].max,color:'lightgreen'},{a:player[el].PNR*100/player[el].max,b:(player[el].PNR+2)*100/player[el].max,color:'crimson'},{a:(player[el].PNR+2)*100/player[el].max,b:100,color:'lightgreen'}];break;case'stamina':areas=[{a:0,b:player[el].exhausted*100/player[el].max,color:'crimson'},{a:player[el].exhausted*100/player[el].max,b:100,color:'white'}];break;case'ometer':areas=[{a:0,b:player[el].denial*100/player[el].max,color:'steelblue'},{a:player[el].denial*100/player[el].max,b:player[el].minor*100/player[el].max,color:'white'},{a:player[el].minor*100/player[el].max,b:player[el].gasm*100/player[el].max,color:'violet'},{a:player[el].gasm*100/player[el].max,b:100,color:'coral'}];break;default:throw new Error("unknown: "+el);break;}gradient='';var _iterator44=_createForOfIteratorHelper(areas),_step44;try{for(_iterator44.s();!(_step44=_iterator44.n()).done;){var n=_step44.value;//todo need to sort from left to right
gradient+='#80808000 0 '+n.a+'%, '+n.color+' '+n.a+'%,'+n.color+' '+n.b+'%,#80808000 '+n.b+'%,';}}catch(err){_iterator44.e(err);}finally{_iterator44.f();}bar.parentNode.style.backgroundImage='linear-gradient(to right,'+gradient.slice(0,-1)+')';}else{//on 2.pass adjust width of each bar relative to maxv
bar=document.getElementById(player.id+el);bar.parentElement.style['width']=parseInt(40*(player[el].max-player[el].min)*maxv/maxx)+'em';}}}}///
function updateBoard(){var player,skill;var entry,box,panel=document.getElementById('panel');for(var i=panel.childNodes.length-1;i>=0;i--){panel.removeChild(panel.childNodes[i]);}//cleanout buttons
var choice=document.getElementById('choice');for(var i=choice.childNodes.length-1;i>=0;i--){choice.removeChild(choice.childNodes[i]);}//update players or remove them: list health and color of each player
for(var i=data.teams.length-1;i>=0;i--){for(var k=data.teams[i].length-1;k>=0;k--){player=data.teams[i][k];_updateBars(player);entry=document.createElement('button');entry.id=player.id;entry.textContent='Team'+i+' '+player.id+' stamina:'+window.gm.util.formatNumber(player.stamina.curr,0)+' pleasure:'+window.gm.util.formatNumber(player.pleasure.curr,0)+' ometer:'+window.gm.util.formatNumber(player.ometer.curr,0);if(player.stamina.curr<=player.stamina.exhausted){entry.textContent+='   Exhausted !';}box=document.getElementById(player.id);if(data.team===i||!data.run){entry.disabled=true;box.style["background-color"]="lightsteelblue";}else{box.style["background-color"]="unset";//button to select opponent
entry.addEventListener("click",function(target){return selectTarget.bind(data,target);}(player.id));data.target=player.id;}panel.appendChild(entry);if(player.id===data.player.id&&data.run){//list skills of attacker
if(data.AI[data.team]!==null){//select by AI
//data.AI[data.team]();
}else{entry.style['border-block-color']='khaki';for(var l=player.skills.length-1;l>=0;l--){skill=player.skills[l];entry=document.createElement('button');entry.id=skill.id;entry.title=skill.id;entry.textContent=skill.id+' (fatigue:'+skill.stamina+' lustself:'+skill.lustself+/*' lustother:'+skill.lustother+*/')'+' cooldown:'+skill.tick;if(skill.tick>0||skill.stamina<0&&player.stamina.curr-player.stamina.exhausted<skill.stamina*-1){entry.disabled=true;//disable if cooldown or not enough charge
}else{entry.addEventListener("click",function(player,skill){return function(me){selectSkill.bind(me,player,skill)();};}(player.id,skill.id));//(function(player,skill){return(selectSkill.bind(data,player,skill));}(player.id,skill.id)));  
}choice.appendChild(entry);}//entry=document.createElement('button');
//entry.id=entry.textContent='skip';  
//entry.addEventListener("click",nextPlayer);
//choice.appendChild(entry);
}}}entry=document.createElement('hr');panel.appendChild(entry);}if(data.run){entry=document.createElement('p');entry.style['color']='red';entry.textContent=data.phase===0?data.player.id+': select target and skill:':data.target+': select defense:';choice.appendChild(entry);if(data.AI[data.team]!==null){//select by AI
clearTimeout(data.timer);//fire timer or get stackoverflow
data.timer=setTimeout(data.AI[data.team],300);}}}function newTurn(){//check if any team is down
var teamDead,player,skill;data.phase=0;teamDead=true;for(var i=data.teams.length-1;i>=0;i--){for(var k=data.teams[i].length-1;k>=0;k--){player=data.teams[i][k];if(player.stamina.curr>player.stamina.exhausted)teamDead=false;//battle continues until no one has stamina
for(var l=player.skills.length-1;l>=0;l--){//tick skills
skill=player.skills[l];skill.tick=Math.max(0,skill.tick-1);}for(var l=player.defenses.length-1;l>=0;l--){//tick skills
skill=player.defenses[l];skill.tick=Math.max(0,skill.tick-1);}}}data.team=data.teams.length-1;var x=data.teams[data.team].length-1;data.player=data.teams[data.team][x];if(teamDead){stop(),updateBoard();alert('team '+i+' is defeated');}else{//start new round with team0 - note that all for-loops are operated backwards
updateBoard();}}function nextPlayer(){var player,_usethis;data.phase=0;//skip to next alive in team
_usethis=false;for(var k=data.teams[data.team].length-1;k>=0;k--){player=data.teams[data.team][k];if(_usethis===true){//the previous player was the current - this is next 
data.player=player;_usethis=false;break;}if(player===data.player){_usethis=true;}}if(_usethis===true){//no more players in team, switch to next
data.team-=1;for(var i=data.team;_usethis&&i>=0;i--){for(var k=data.teams[i].length-1;_usethis&&k>=0;k--){player=data.teams[i][k];if(true){//player.hp>0){
data.player=player;_usethis=false;}}}if(_usethis===true){//but if no one left... 
calcDamage();return;}}updateBoard();}function selectTarget(id){this.target=id;}function selectSkill(playerId,skillId){var player,skill;var _log="div#output";if(this){var choice=this.target.parentNode;for(var i=choice.childNodes.length-1;i>=0;i--){//disable buttons
choice.childNodes[i].disabled=true;}}for(var i=data.teams.length-1;i>=0;i--){//find players
for(var k=data.teams[i].length-1;k>=0;k--){player=data.teams[i][k];if(player.id===playerId){player.skill=_findSkill(player,skillId),player.target=data.target;}}}window.gm.printOutput(playerId+' will use '+skillId+' on '+data.target,_log);nextPlayer();}function _findSkill(player,id){var skill;for(var l=player.skills.length-1;l>=0;l--){//get skill
skill=player.skills[l];if(skill.id===id){return skill;}}throw new Error("unknown skillid: "+id);}function _describeAction(player,target,skill,top){var msg='';if(top===true){if(skill.id==='tease'){msg+=player.id+' teases '+target.id+' ';}else if(skill.id==='calm'){msg+=player.id+' calms itself ';}else if(skill.id==='fuck'){msg+=player.id+' fucks '+target.id+' ';}else{msg+=player.id+' just waits ';}}else{msg+='and ';if(skill.id==='tease'){msg+=player.id+' teases back ';}else if(skill.id==='calm'){msg+=player.id+' calms itself ';}else if(skill.id==='fuck'){msg+=player.id+' fucks '+target.id+' ';}else{msg+=player.id+' just takes it ';}}return msg;}function AIpassive(){selectSkill(data.player.id,'passive');}function AIselfish(){var player=data.player,skill=_findSkill(data.player,'fuck');if(skill.stamina<0&&player.stamina.curr-player.stamina.exhausted-5<skill.stamina*-1){selectSkill(data.player.id,'passive');}else{selectSkill(data.player.id,'fuck');}}var _dt=null;//what pleasure opponent receives
function _damt(skillid,other){if(!_dt){_dt={};_dt["fuck-fuck"]=8,_dt["fuck-tease"]=6,_dt["fuck-passive"]=6,_dt["fuck-calm"]=0,_dt["fuck-deny"]=-2,_dt["tease-fuck"]=5,_dt["tease-tease"]=2,_dt["tease-passive"]=2,_dt["tease-calm"]=-2,_dt["tease-deny"]=-4,_dt["passive-fuck"]=0,_dt["passive-tease"]=0,_dt["passive-passive"]=-3,_dt["passive-calm"]=-4,_dt["passive-deny"]=-4,_dt["calm-fuck"]=2,_dt["calm-tease"]=0,_dt["calm-passive"]=0,_dt["calm-calm"]=-2,_dt["calm-deny"]=-4,_dt["deny-fuck"]=-4,_dt["deny-tease"]=-4,_dt["deny-passive"]=-4,_dt["deny-calm"]=-4,_dt["deny-deny"]=-10;}return _dt[skillid+'-'+other];}function calcDamage(){var entry,i,choice=document.getElementById('choice2');data.turn+=1;for(i=choice.childNodes.length-1;i>=5;i--){//cleanout log
choice.removeChild(choice.childNodes[i]);}//build pairs of interacting players; first is Top
//right now we have only 1:1
var essence,action,target,actions=[[data.teams[0][0],data.teams[1][0]]];function fpl(player){//change of pleasure reduced in green range
if(player.pleasure.curr>player.pleasure.minor){return 0.5;}return 1.0;}function fom(player){//change of ometer reduced in green range
if(player.ometer.curr>player.ometer.minor){return 0.5;}return 1.0;}for(var _i7=0,_actions=actions;_i7<_actions.length;_i7++){var pair=_actions[_i7];entry=document.createElement('p');entry.textContent='turn:'+data.turn+' '+_describeAction(pair[0],pair[1],pair[0].skill,true)+_describeAction(pair[1],pair[0],pair[1].skill,false)+'</br>';choice.insertBefore(entry,choice.firstChild);for(i=pair.length-1;i>=0;i--){action=pair[i],target=pair[1-i];action.stamina.curr=Math.max(action.stamina.min,Math.min(action.stamina.curr+action.skill.stamina,action.stamina.max));if(data.debug.staminaOff)action.stamina.curr=50;action.pleasure.curr=Math.max(action.pleasure.min,Math.min(action.pleasure.curr+action.skill.lustself+_damt(target.skill.id,action.skill.id),//(target.skill.lustother*action.skill.fr)*fpl(action),
action.pleasure.max));if(action.ometer.curr>action.ometer.gasm){//ostim
action.pleasure.curr=action.pleasure.annoy/2;}if(action.pleasure.curr>action.pleasure.good){//ometer gain
action.ometer.curr=Math.max(action.ometer.min,Math.min(action.ometer.max,action.ometer.curr+5));//action.pleasure.curr/5));
}else if(action.pleasure.curr<action.pleasure.annoy){//annoy
action.ometer.curr=Math.max(action.ometer.min,Math.min(action.ometer.max,action.ometer.curr-7));//action.pleasure.curr/5));
}else{action.ometer.curr=Math.max(action.ometer.min,Math.min(action.ometer.max,action.ometer.curr-2));//action.pleasure.curr/15));
}_updateBars(action);}}clearTimeout(data.timer);//update bars, then check if something triggered
data.timer=setTimeout(calcDamage2,1000);}function calcDamage2(){var entry,entry2,i,choice=document.getElementById('choice2');var essence,action,target,actions=[[data.teams[0][0],data.teams[1][0]]];for(var _i8=0,_actions2=actions;_i8<_actions2.length;_i8++){var pair=_actions2[_i8];for(i=pair.length-1;i>=0;i--){action=pair[i],target=pair[1-i];if(action.pleasure.curr>action.pleasure.PNR){//ogasm
essence=action.ometer.curr;if(action.ometer.curr<action.ometer.minor){essence=0;}action.ometer.curr=action.ometer.min,action.pleasure.curr=action.pleasure.annoy*1.2,action.stamina.curr=Math.max(action.stamina.min,Math.min(action.stamina.curr-action.stamina.max/2,action.stamina.max));action.essence+=essence;entry2=document.createElement('p');entry2.textContent=action.id+' came and created '+window.gm.util.formatNumber(essence,0)+' essence.</br>';choice.insertBefore(entry2,choice.firstChild);_updateBars(action);}}}entry=document.createElement('hr');choice.insertBefore(entry,choice.firstChild);newTurn();}function stop(){data.run=false;}var data={//internal state of game
scoreBoard:document.getElementById(panel),run:false,//game started?
teams:[],//store data of team & players
team:0,turn:0,cost:{},timer:0,//AI update timer
AI:null,speed:300,//slider anim speed
debug:{display:'all'},player:'',skill:'',target:'',stopCB:stopCB,//callback after user trigger 
startCB:startCB,//callback after start
start:start//ref to start-function
};return data;};/* initialize a puzzle with tetris-styled pieces; 
* the player has to dragNdrop all pieces to completely cover the goals; Note that the pieces dont have to fit completely into the goals 
* custom shapes of pieces/goals can be set.
* the function returns a data-object that you have to configure before calling init()
*/window.gm.startBlockPuzzle=function(){var PUZZLE_HOVER_TINT='#009900';var _stage,_canvas,_mtt;var _pieces,_goals;var _puzzleWidth,_puzzleHeight,_gridwidth;var startX=0,startY=0;// Goal is an array of gridfields that need to be completely covered with puzzle-pieces
var Goal=function Goal(x,y,grid,parts){var goal={x:x*grid,y:y*grid,parts:parts,grid:grid};goal.render=function(ctx){ctx.save();ctx.strokeStyle='#000000';ctx.fillStyle='#AAAAAA';ctx.setLineDash([5,10]);ctx.beginPath();var _iterator45=_createForOfIteratorHelper(this.parts),_step45;try{for(_iterator45.s();!(_step45=_iterator45.n()).done;){var _r=_step45.value;ctx.rect(this.grid*_r[0]+this.x,this.grid*_r[1]+this.y,this.grid,this.grid);}}catch(err){_iterator45.e(err);}finally{_iterator45.f();}ctx.fill();ctx.stroke();ctx.restore();};goal.getGrid=function(){var grid=[];var _iterator46=_createForOfIteratorHelper(this.parts),_step46;try{for(_iterator46.s();!(_step46=_iterator46.n()).done;){var _r=_step46.value;var x=_r[0]*this.grid+this.x,y=_r[1]*this.grid+this.y;grid.push([x,y]);}}catch(err){_iterator46.e(err);}finally{_iterator46.f();}return grid;};return goal;};//Piece is a puzzle-piece which shape is defined by part-rects. 
//Grid defines the size of the part-rects. x/y is specified in multiples of grid
//parts is an array of arrays with 2 elements specifiying x,y of every part-rect; x/y is relativ to piece-x/y 
var Piece=function Piece(x,y,grid,parts,design){var piece={x:x*grid,y:y*grid,parts:parts,grid:grid,isDragging:false,fill:design&&design.fill?design.fill:'#2793ef',canRotate:design&&design.canRotate?design.canRotate:false};piece.oldX=piece.newX=piece.x;piece.oldY=piece.newY=piece.y;piece.render=function(ctx){ctx.save();if(this.isDragging){ctx.globalAlpha=.4;ctx.fillStyle=PUZZLE_HOVER_TINT;}else{ctx.fillStyle=this.fill;}ctx.strokeStyle='#000000';ctx.beginPath();var _iterator47=_createForOfIteratorHelper(this.parts),_step47;try{for(_iterator47.s();!(_step47=_iterator47.n()).done;){var _r=_step47.value;ctx.rect(this.grid*_r[0]+this.x,this.grid*_r[1]+this.y,this.grid,this.grid);if(_r[0]===0&&_r[1]===0&&this.canRotate){//mark rotation on part [0,0]
var _cx=this.grid*(_r[0]+0.5)+this.x,_cy=this.grid*(_r[1]+0.5)+this.y;ctx.moveTo(_cx+this.grid*0.3,_cy);//if ..(_cx,_cy) there would be another line from circle to center
ctx.arc(_cx,_cy,this.grid*0.3,0,Math.PI*2);}}}catch(err){_iterator47.e(err);}finally{_iterator47.f();}ctx.fill();ctx.stroke();ctx.restore();};piece.getGrid=function(){var grid=[];var _iterator48=_createForOfIteratorHelper(this.parts),_step48;try{for(_iterator48.s();!(_step48=_iterator48.n()).done;){var _r=_step48.value;var x=_r[0]*this.grid+this.x,y=_r[1]*this.grid+this.y;grid.push([x,y]);}}catch(err){_iterator48.e(err);}finally{_iterator48.f();}return grid;};piece.rotate=function(angle){//rotate-Matrix 90°
// 0 -1
// 1  0
if(!this.canRotate)return;this.parts=this.parts.map(function(pt){return[pt[1]*-1,pt[0]*1];});};piece.isHit=function(x,y){var _iterator49=_createForOfIteratorHelper(this.parts),_step49;try{for(_iterator49.s();!(_step49=_iterator49.n()).done;){var _r=_step49.value;/*if (x > this.grid*_r[0]+this.x - this.grid * 0.5                && y > this.grid*_r[1]+this.y - this.grid * 0.5 && 
                    x < this.grid*_r[0]+this.x + this.grid - this.grid * 0.5    && y < this.grid*_r[1]+this.y + this.grid - this.grid * 0.5){*/if(x>this.grid*_r[0]+this.x&&y>this.grid*_r[1]+this.y&&x<this.grid*_r[0]+this.x+this.grid&&y<this.grid*_r[1]+this.y+this.grid){return true;}}}catch(err){_iterator49.e(err);}finally{_iterator49.f();}return false;};return piece;};// this structure is returned by the start-fct and is the public interface to the game
var data={init:init,//points to the init-function
setup:demoLevel,//set this to a function that defines the level; see demoLevel
start:start,//(re-)starts the game at a level
onWin:demoWinLevel,//callback called on solving a level
onLoss:demoLossLevel,//todo callback called on failing a level
onFinish:demoWinGame,//callback called on solving all level
level:1,//tracks the current level
createGoal:Goal,//points to a helper-function to build goal-areas
createPiece:Piece//points to a helper-fct to build pieces
};//utility function to track touch & mouse movement
var MouseTouchTracker=function MouseTouchTracker(canvas,callback){function processEvent(evt){var rect=canvas.getBoundingClientRect();var offsetTop=rect.top;var offsetLeft=rect.left;if(evt.touches){return{x:evt.touches[0].clientX-offsetLeft,y:evt.touches[0].clientY-offsetTop};}else{return{x:evt.clientX-offsetLeft,y:evt.clientY-offsetTop};}}function onDown(evt){evt.preventDefault();_canvas.focus();//this is to make sure canvas can receive keyup; canvas also has to have tabindex set to be focusable!
var coords=processEvent(evt);callback('down',coords.x,coords.y);}function onUp(evt){evt.preventDefault();callback('up');}function onMove(evt){evt.preventDefault();var coords=processEvent(evt);callback('move',coords.x,coords.y);}function onKey(evt){evt.preventDefault();callback('key',evt.code);}var _canvas=canvas;canvas.ontouchmove=onMove;canvas.onmousemove=onMove;canvas.ontouchstart=onDown;canvas.onmousedown=onDown;canvas.ontouchend=onUp;canvas.onmouseup=onUp;canvas.onkeyup=onKey;};/**
     * expects a canvas-element with proper size on the page with id='canvas'
     * initialize setup-function before calling this !
     *
     * @param {*} grid : puzzle-part-size in pixel
     */function init(grid){_canvas=document.getElementById('canvas');_stage=_canvas.getContext('2d');_gridwidth=grid;_puzzleWidth=_canvas.width;_puzzleHeight=canvas.height;_mtt=new MouseTouchTracker(_canvas,dragPiece);start(this.level);}//draw canvas; called internally
function redraw(){_stage.clearRect(0,0,_canvas.width,_canvas.height);var _iterator50=_createForOfIteratorHelper(_goals),_step50;try{for(_iterator50.s();!(_step50=_iterator50.n()).done;){var n=_step50.value;n.render(_stage);}}catch(err){_iterator50.e(err);}finally{_iterator50.f();}var _iterator51=_createForOfIteratorHelper(_pieces),_step51;try{for(_iterator51.s();!(_step51=_iterator51.n()).done;){var n=_step51.value;n.render(_stage);}}catch(err){_iterator51.e(err);}finally{_iterator51.f();}}//returns true if pieces collides with other piece or outside border; called internally
function collides(piece){var _a=piece.getGrid();//todo outside border
var _iterator52=_createForOfIteratorHelper(_a),_step52;try{for(_iterator52.s();!(_step52=_iterator52.n()).done;){var _p=_step52.value;if(_p[0]<0||_p[1]<0||_p[0]>=_puzzleWidth||_p[1]>=_puzzleHeight)return true;}}catch(err){_iterator52.e(err);}finally{_iterator52.f();}var _iterator53=_createForOfIteratorHelper(_pieces),_step53;try{for(_iterator53.s();!(_step53=_iterator53.n()).done;){var _p=_step53.value;if(_p===piece)continue;var _b=_p.getGrid();for(var i=_a.length-1;i>=0;i--){if(_b.find(function(value,index){return _a[i][0]===value[0]&&_a[i][1]===value[1];}))return true;}}}catch(err){_iterator53.e(err);}finally{_iterator53.f();}return false;}//check if goals are completly covered (but pieces dont have to be completely inside goal); called internally
function checkWin(){var won=true;var a,allG=[],allP=[];var _iterator54=_createForOfIteratorHelper(_pieces),_step54;try{for(_iterator54.s();!(_step54=_iterator54.n()).done;){var _p=_step54.value;allP=allP.concat(_p.getGrid());}}catch(err){_iterator54.e(err);}finally{_iterator54.f();}var _iterator55=_createForOfIteratorHelper(_goals),_step55;try{for(_iterator55.s();!(_step55=_iterator55.n()).done;){var _g=_step55.value;allG=allG.concat(_g.getGrid());}}catch(err){_iterator55.e(err);}finally{_iterator55.f();}for(var i=allG.length-1;i>=0;i--){//check if no goal-part is uncovered
if(allP.find(function(value,index){return allG[i][0]===value[0]&&allG[i][1]===value[1];})){}else{won=false;};}return won;}//drag&drop operation; called internally
function dragPiece(evtType,x,y){switch(evtType){case'key':if(x==='KeyR'){var _iterator56=_createForOfIteratorHelper(_pieces),_step56;try{for(_iterator56.s();!(_step56=_iterator56.n()).done;){var n=_step56.value;if(n.isDragging){n.rotate(90);}}}catch(err){_iterator56.e(err);}finally{_iterator56.f();}}break;case'down':startX=x;startY=y;var _iterator57=_createForOfIteratorHelper(_pieces),_step57;try{for(_iterator57.s();!(_step57=_iterator57.n()).done;){var n=_step57.value;if(!n.isDragging&&n.isHit(x,y)){n.isDragging=true;n.oldX=n.newX=n.x,n.oldY=n.newY=n.y;}}}catch(err){_iterator57.e(err);}finally{_iterator57.f();}break;case'up':var _iterator58=_createForOfIteratorHelper(_pieces),_step58;try{for(_iterator58.s();!(_step58=_iterator58.n()).done;){var n=_step58.value;n.isDragging=false;if(collides(n)){n.x=n.oldX,n.y=n.oldY;}}}catch(err){_iterator58.e(err);}finally{_iterator58.f();}break;case'move':var dx=x-startX,dy=y-startY;startX=x;startY=y;var _iterator59=_createForOfIteratorHelper(_pieces),_step59;try{for(_iterator59.s();!(_step59=_iterator59.n()).done;){var n=_step59.value;if(n.isDragging){n.newX+=dx,n.newY+=dy;/*n.x=Math.floor(((n.newX-_gridwidth/2)/_gridwidth))*_gridwidth+_gridwidth/2;
                    n.y=Math.floor(((n.newY-_gridwidth/2)/_gridwidth))*_gridwidth+_gridwidth/2;*/n.x=Math.floor(n.newX/_gridwidth)*_gridwidth;//floor is used to snap to grid
n.y=Math.floor(n.newY/_gridwidth)*_gridwidth;}}}catch(err){_iterator59.e(err);}finally{_iterator59.f();}break;}redraw();if(evtType==='up'&&checkWin()){data.onWin(data.level);}}//used to start a certain level; the onWin-callback has to call this to continue the game
function start(level){_pieces=[];_goals=[];data.level=level;var tmp=data.setup(level);if(!tmp){data.onFinish(level);}else{_goals=tmp.goals;_pieces=tmp.pieces;}redraw();}//the setup-fct receives a level-No and has to return a object containing the goals and pieces of that level
function demoLevel(level){return{goals:[new Goal(3,3,_gridwidth,[[0,0],[0,1],[1,0],[1,1],[1,2],[2,2],[2,3]])],pieces:[new Piece(0,0,_gridwidth,[[0,0],[1,0],[1,1]],{fill:'#57535f'}),new Piece(4,1,_gridwidth,[[0,0],[0,1],[1,0],[1,1]])]};}function demoWinGame(level){alert("You solved all puzzles");}function demoWinLevel(level){alert("You solved the puzzle-level "+level);this.start(level+1);}function demoLossLevel(level){alert("You failed to solve the puzzle");}return data;};/*
* ReactTest = a box is moing repeatedly left-right-left and the user has to click on it to 
* stop it inside a hit area (success if center of moving box is inside one hit-area)
*
* call this setup-function once and use the returned start & click function for game input
* bar is the id of the moving element-node; example:
* <div style='height:1em; width: 100%;'><div id='bar' style="position:relative; width:5%; height:100%; background-color:green;"></div></div>
* 
* you might provide callbacks for start & stop, stop will get area-index on success or -1 on fail
* speed is ms for one movement of the box from left to right 
* area is a list of non-overlapping hit-areas like [{a:5,b:10, color:'orange'}]; 
*/window.gm.startReactTest=function(bar,speed,stopCB,startCB,areas){/**
     * starts the game
     */function start(){//todo instead left-right also up-down should be possible
///////////////svg test ////////////////////
var draw=SVG().addTo('#canvas').size(300,300);var rect=draw.rect(100,100).attr({fill:'#f06'});///////////////////////////////////////////////////
data.stop();data.value=0,data.run=true;data.bargraph.style.left=data.value+'%';//dont start in between; speed would be slowed down to maintain transition time
var width=window.getComputedStyle(data.bargraph).getPropertyValue('width');var total=window.getComputedStyle(data.bargraph.parentNode).getPropertyValue('width');//calculate barsize relative to total width (necessary if windowsize changed in between )
data.barsize=100*parseFloat(width.split('px'))/parseFloat(total.split('px'));data.bargraph.style.transition="left "+data.speed+"ms linear";//configure transition for animation
if(data.startCB)data.startCB();//called before transition-start!
data.bargraph.ontransitionend();//start transition
}/**
     * this stops the game and returns the index of hit area; use click() instead !
     */function stop(){var computedStyle=window.getComputedStyle(data.bargraph);var left=computedStyle.getPropertyValue('left');data.bargraph.style.left=left;data.bargraph.style.transition=null;// disable transition AFTER fetching computed value !
var total=window.getComputedStyle(data.bargraph.parentNode).getPropertyValue('width');left=parseFloat(left.split('px')),total=parseFloat(total.split('px'));left=100*left/total+data.barsize/2;var res=-1;//detect if area was hit or not
for(var i=data.areas.length-1;i>=0;i--){if(data.areas[i].a<=left&&left<=data.areas[i].b)res=i;}data.run=false;return res;}/**
     * this can be bound to eventhandler for user input detection to trigger stop and will call stop-CB
     */function click(){var run=data.run;var res=data.stop();if(run&&data.stopCB)data.stopCB(res);}var data={//internal state of game
bargraph:document.getElementById(bar),run:false,//game started?
value:0,//actual setpoint in%
barsize:5,//width of hitbox relative to total width in %
areas:areas,//list of areas to hit in %;
speed:speed,//transition time in ms
stopCB:stopCB,//callback after user trigger 
startCB:startCB,//callback after start
start:start,//ref to start-function
stop:stop,//ref to stop-func
click:click//ref to click-func
};var gradient='';var _iterator60=_createForOfIteratorHelper(data.areas),_step60;try{for(_iterator60.s();!(_step60=_iterator60.n()).done;){var n=_step60.value;//todo need to sort from left to right
gradient+='#80808000 0 '+n.a+'%, '+n.color+' '+n.a+'%,'+n.color+' '+n.b+'%,#80808000 '+n.b+'%,';}}catch(err){_iterator60.e(err);}finally{_iterator60.f();}data.bargraph.parentNode.style.backgroundImage='linear-gradient(to right,'+gradient.slice(0,-1)+')';/**
     * instead of using timers rely on css-transition handling and events
     */data.bargraph.ontransitionend=function(){data.value=data.value===0?100-data.barsize:0;data.bargraph.style.left=data.value+'%';//this should trigger css-transition
};return data;};/**
   * by pressing left/right alternatively you move a box along a bar until you reach its end or run out of time
   * the bar will slowly slide back to origin without proper input (you have to press quickly to finish); each time you pass an area, this movement increases 
   * 
   * @param {*} bar : the element to move
   * @param {*} speed : recovery rate in ms 
   * @param {*} stopCB 
   * @param {*} startCB 
   * @param {*} areas 
   */window.gm.startReactTest2=function(bar,speed,stopCB,startCB,areas){//todo timeout starts after first click
/**
     * starts the game
     */function start(){//todo instead left-right also up-down should be possible
data.stop();data.run=true;data.bargraph.style.left=data.value+'%';//dont start in between; speed would be slowed down to maintain transition time
var width=window.getComputedStyle(data.bargraph).getPropertyValue('width');var total=window.getComputedStyle(data.bargraph.parentNode).getPropertyValue('width');//calculate barsize relative to total width (necessary if windowsize changed in between )
data.barsize=100*parseFloat(width.split('px'))/parseFloat(total.split('px'));//data.bargraph.style.transition = "left "+data.speed+"ms linear"; //configure transition for animation
if(data.startCB)data.startCB();//called before transition-start!
//data.bargraph.ontransitionend(); //start transition
data.value=20,data.speed2=1;tick();data.intervalID=window.setInterval(tick,data.speed);}/**
     * this stops the game and returns the index of hit area; use click() instead !
     */function stop(){if(data.intervalID)window.clearInterval(data.intervalID);var computedStyle=window.getComputedStyle(data.bargraph);var left=computedStyle.getPropertyValue('left');data.bargraph.style.left=left;data.bargraph.style.transition=null;// disable transition AFTER fetching computed value !
data.run=false;}function tick(){data.value=Math.max(0,data.value-data.speed2);data.bargraph.style.left=data.value+'%';}/**
     * this can be bound to eventhandler for user input detection to trigger stop and will call stop-CB
     */function click(evt){if(!data.run)return;var prevKey=data.lastKey;if(prevKey!==evt.key&&(evt.key==='a'||evt.key==='ArrowLeft'||evt.key==='d'||evt.key==='ArrowRight')){data.lastKey=evt.key,data.value+=5;data.bargraph.style.left=data.value+'%';}var left=data.value+data.barsize/2;var res=-1;//detect if area was hit or not
for(var i=data.areas.length-1;i>=0;i--){if(data.areas[i].a<=left&&left<=data.areas[i].b){res=i;data.speed2=(i+1)*2;}}if(res===data.areas.length-1){stop();if(data.stopCB)data.stopCB(res);}}var data={//internal state of game
bargraph:document.getElementById(bar),run:false,//game started?
value:0,//actual setpoint in%
barsize:5,//width of hitbox relative to total width in %
areas:areas,//list of areas to hit in %;
speed:speed,//transition time in ms
speed2:1,//recovery speed in % of barwidth
stopCB:stopCB,//callback after user trigger 
startCB:startCB,//callback after start
start:start,//ref to start-function
stop:stop,//ref to stop-func
click:click,//ref to click-func
intervalID:null,lastKey:''};var gradient='';var _iterator61=_createForOfIteratorHelper(data.areas),_step61;try{for(_iterator61.s();!(_step61=_iterator61.n()).done;){var n=_step61.value;//todo need to sort from left to right
gradient+='#80808000 0 '+n.a+'%, '+n.color+' '+n.a+'%,'+n.color+' '+n.b+'%,#80808000 '+n.b+'%,';}}catch(err){_iterator61.e(err);}finally{_iterator61.f();}data.bargraph.parentNode.style.backgroundImage='linear-gradient(to right,'+gradient.slice(0,-1)+')';/**
     * instead of using timers rely on css-transition handling and events
     */ /*data.bargraph.ontransitionend = () => {
      data.value = (data.value===0)?100-data.barsize:0;
      data.bargraph.style.left=data.value+'%'; //this should trigger css-transition
    };*/return data;};/**
   * you have fill a bar by pressing the indicated button (wasd or arrows). If you press the wrong button, the bar gets drained somewhat. 
   * the bar will slowly slide back to origin without proper input.
   * When the bar is filled you win, when its empty you loose.
   * options: see _params
   * Note: negate timeDrain,passFill,missDrain  to make bar move in opposite direction
   * 
   * @param {*} bar : the element-id to move
   * @param {*} speed : recovery rate in ms 
   * @param {*} stopCB 
   * @param {*} startCB 
   * 
   */window.gm.startReactTest3=function(bar,keyIds,specialKeyIds,stopCB,startCB,comboChange,valueTrigger){//todo timeout starts after first click
var data={//internal state of game
bargraph:document.getElementById(bar),leftKey:document.getElementById(keyIds[0]),rightKey:document.getElementById(keyIds[1]),upKey:document.getElementById(keyIds[2]),downKey:document.getElementById(keyIds[3]),specialKeys:[],run:false,//game started?
value:0,//actual setpoint in%
miss:false,//internal use
valid:false,//internal use
comboStep:0,comboLevel:0,maxCombo:0,params:null,//parameters
tickSpeed:50,//interval of tick
drainTimer:0,//internal use
nextTimer:0,//internal use
stopCB:stopCB,//callback after user trigger 
startCB:startCB,//callback after start
valueTrigger:valueTrigger,comboChange:comboChange,start:start,//ref to start-function
stop:stop,//ref to stop-func
click:click,//ref to input-func
intervalID:null,//internal use
validKey:''//internal use
};specialKeyIds.forEach(function(element){data.specialKeys.push(document.getElementById(element));});/**
     * starts the game
     */function start(params){var _params$drainSpeed,_params$comboSteps,_params$comboLevels,_params$comboBoost,_params$timeDrain,_params$missDrain,_params$passFill,_params$startValue;//
data.stop();var _params=params||{};_params.drainSpeed=(_params$drainSpeed=_params.drainSpeed)!==null&&_params$drainSpeed!==void 0?_params$drainSpeed:2000;_params.comboSteps=(_params$comboSteps=_params.comboSteps)!==null&&_params$comboSteps!==void 0?_params$comboSteps:0;//if >0: after that number of consecutive correct input, the combo multiplier is increased
_params.comboLevels=(_params$comboLevels=_params.comboLevels)!==null&&_params$comboLevels!==void 0?_params$comboLevels:1;//how many times a combo multiplier an be increased
_params.comboBoost=(_params$comboBoost=_params.comboBoost)!==null&&_params$comboBoost!==void 0?_params$comboBoost:0.2;//this factor gets added to the combo multiplier on increase; bar increase=pass fill*multiplier   
_params.timeDrain=(_params$timeDrain=_params.timeDrain)!==null&&_params$timeDrain!==void 0?_params$timeDrain:5;// how much the bar is drained over time (in %)
_params.missDrain=(_params$missDrain=_params.missDrain)!==null&&_params$missDrain!==void 0?_params$missDrain:_params.timeDrain*3;//how much the bar is drained on wrong key (in %)
_params.passFill=(_params$passFill=_params.passFill)!==null&&_params$passFill!==void 0?_params$passFill:_params.timeDrain*2;// how much the bar is fill on correct key (in %)
_params.startValue=(_params$startValue=_params.startValue)!==null&&_params$startValue!==void 0?_params$startValue:20;//how much the bar is filled (in %) at start
data.params=_params;data.run=true;data.miss=false;data.valid=false;data.drainTimer=0;data.comboLevel=data.comboStep=data.maxCombo=0;var width=window.getComputedStyle(data.bargraph).getPropertyValue('width');var total=window.getComputedStyle(data.bargraph.parentNode).getPropertyValue('width');//data.bargraph.style.transition = "left "+data.speed+"ms linear"; //configure transition for animation
if(data.startCB)data.startCB();//called before transition-start!
//data.bargraph.ontransitionend(); //start transition
data.value=data.params.startValue;data.bargraph.style.left=data.value+'%';randomizeKey();tick();data.intervalID=window.setInterval(tick,data.tickSpeed);}/**
     * this stops the game and returns the index of hit area; use click() instead !
     */function stop(){if(data.intervalID)window.clearInterval(data.intervalID);var computedStyle=window.getComputedStyle(data.bargraph);var left=computedStyle.getPropertyValue('left');data.bargraph.style.left=left;data.bargraph.style.transition=null;// disable transition AFTER fetching computed value !
data.run=false;}function tick(){var valueOld=data.value;data.drainTimer+=data.tickSpeed;data.nextTimer+=data.nextTimer>=0?data.tickSpeed:0;if(data.miss==true){data.miss=false;if(data.comboChange&&data.comboLevel>0){data.comboChange(0);}data.comboStep=data.comboLevel=0;data.drainTimer=0;data.nextTimer=0;data.value=Math.max(0,data.value-data.params.missDrain);data.bargraph.style.left=data.value+'%';blipKey();}else if(data.valid==true){data.valid=false;data.drainTimer=0;data.nextTimer=0;data.comboStep+=1;if(data.params.comboSteps>0&&data.comboStep>=data.params.comboSteps){data.comboStep=0;data.comboLevel=Math.min(data.comboLevel+1,data.params.comboLevels);data.maxCombo=Math.max(data.maxCombo,data.comboLevel);if(data.comboChange){data.comboChange(data.comboLevel);}}data.value=Math.min(100,Math.max(0,data.value+data.params.passFill*(1+data.comboLevel*data.params.comboBoost)));data.bargraph.style.left=data.value+'%';blipKey();}else if(data.drainTimer>data.params.drainSpeed){data.drainTimer=0;data.value=Math.max(0,data.value-data.params.timeDrain);data.bargraph.style.left=data.value+'%';}if(data.nextTimer>=200){data.nextTimer=-1;randomizeKey();}if(data.valueTrigger&&data.value!=valueOld)data.valueTrigger(data.value,valueOld,data.comboLevel);if(data.value<=0||data.value>=100){stop();if(data.stopCB)data.stopCB(data.value,data.maxCombo);}}var KEYS=['leftKey','rightKey',"upKey","downKey"];function randomizeKey(){data.validKey=KEYS[_.random(0,KEYS.length-1)];data.validKey2=-1;//TODO _.random(-1,data.specialKeys.length-1);
data.leftKey.src="assets\\icons\\arrow_left"+(data.validKey==KEYS[0]?"_on":"")+".png";data.rightKey.src="assets\\icons\\arrow_right"+(data.validKey==KEYS[1]?"_on":"")+".png";data.upKey.src="assets\\icons\\arrow_up"+(data.validKey==KEYS[2]?"_on":"")+".png";data.downKey.src="assets\\icons\\arrow_down"+(data.validKey==KEYS[3]?"_on":"")+".png";data.specialKeys.forEach(function(element,index){element.src="assets\\icons\\"+(index==data.validKey2?"arrow_up_on":"none")+".png";});}function blipKey(){//
data.leftKey.src="assets\\icons\\arrow_left.png";data.rightKey.src="assets\\icons\\arrow_right.png";data.upKey.src="assets\\icons\\arrow_up.png";data.downKey.src="assets\\icons\\arrow_down.png";data.specialKeys.forEach(function(element){element.src="assets\\icons\\none.png";});}/**
     * this can be bound to eventhandler for user input detection to trigger stop and will call stop-CB
     */function click(evt){if(!data.run)return;if(data.validKey==KEYS[0]&&(evt.key==='a'||evt.key==='ArrowLeft')||data.validKey==KEYS[1]&&(evt.key==='d'||evt.key==='ArrowRight')||data.validKey==KEYS[2]&&(evt.key==='w'||evt.key==='ArrowUp')||data.validKey==KEYS[3]&&(evt.key==='s'||evt.key==='ArrowDown')){data.valid=true;}else if(data.validKey2==0&&evt.key===' '){//ShiftRight ShiftLeft
alert();}else{data.miss=true;}}return data;};window.gm.startPong=function(){///// fixed sample from https://svgjs.dev/ ////////
// define document width and height
var width=450,height=300;// create SVG document and set its size
var draw=SVG().addTo('#pong').size(width,height);draw.viewbox(0,0,450,300);// draw background
var background=draw.rect(width,height).fill('#dde3e1');// draw line
var line=draw.line(width/2,0,width/2,height);line.stroke({width:5,color:'#fff',dasharray:'5,5'});// define paddle width and height
var paddleWidth=15,paddleHeight=80;// create and position left paddle
var paddleLeft=draw.rect(paddleWidth,paddleHeight);paddleLeft.x(0).cy(height/2).fill('#00ff99');// create and position right paddle
var paddleRight=draw.rect(paddleWidth,paddleHeight);//paddleLeft.clone()
paddleRight.x(width-paddleWidth).fill('#ff0066');// define ball size
var ballSize=10;// create ball
var ball=draw.circle(ballSize);ball.center(width/2,height/2).fill('#7f7f7f');// define inital player score
var playerLeft=0,playerRight=0;// create text for the score, set font properties
var scoreLeft=draw.text(playerLeft+'').font({size:32,family:'Menlo, sans-serif',anchor:'end',fill:'#fff'}).move(width/2-10,10);// cloning doesnt work!
var scoreRight=draw.text(playerRight+'').font({size:32,family:'Menlo, sans-serif',anchor:'end',fill:'#fff'}).move(width/2-10,10).font('anchor','start').x(width/2+10);// random velocity for the ball at start
var vx=0,vy=0;// AI difficulty
var difficulty=2;// update is called on every animation step
function update(dt){// move the ball by its velocity
ball.dmove(vx*dt,vy*dt);// get position of ball
var cx=ball.cx(),cy=ball.cy();// get position of ball and paddle
var paddleLeftCy=paddleLeft.cy();// move the left paddle in the direction of the ball
var dy=Math.min(difficulty,Math.abs(cy-paddleLeftCy));paddleLeftCy+=cy>paddleLeftCy?dy:-dy;// constraint the move to the canvas area
paddleLeft.cy(Math.max(paddleHeight/2,Math.min(height-paddleHeight/2,paddleLeftCy)));// check if we hit top/bottom borders
if(vy<0&&cy<=0||vy>0&&cy>=height){vy=-vy;}var paddleLeftY=paddleLeft.y(),paddleRightY=paddleRight.y();// check if we hit the paddle
if(vx<0&&cx<=paddleWidth&&cy>paddleLeftY&&cy<paddleLeftY+paddleHeight||vx>0&&cx>=width-paddleWidth&&cy>paddleRightY&&cy<paddleRightY+paddleHeight){// depending on where the ball hit we adjust y velocity
// for more realistic control we would need a bit more math here
// just keep it simple
vy=(cy-((vx<0?paddleLeftY:paddleRightY)+paddleHeight/2))*7;// magic factor
// make the ball faster on hit
vx=-vx*1.05;}else// check if we hit left/right borders
if(vx<0&&cx<=0||vx>0&&cx>=width){// when x-velocity is negative, it's a point for player 2, otherwise player 1
if(vx<0){++playerRight;}else{++playerLeft;}reset();scoreLeft.text(playerLeft+'');scoreRight.text(playerRight+'');}// move player paddle
var playerPaddleY=paddleRight.y();if(playerPaddleY<=0&&paddleDirection==-1){paddleRight.cy(paddleHeight/2);}else if(playerPaddleY>=height-paddleHeight&&paddleDirection==1){paddleRight.y(height-paddleHeight);}else{paddleRight.dy(paddleDirection*paddleSpeed);}// update ball color based on position
ball.fill(ballColor);//??.at(1/width*ball.x()))
}var lastTime,animFrame;function callback(ms){// we get passed a timestamp in milliseconds
// we use it to determine how much time has passed since the last call
if(lastTime){update((ms-lastTime)/1000);// call update and pass delta time in seconds
}lastTime=ms;animFrame=requestAnimationFrame(callback);}callback();var paddleDirection=0,paddleSpeed=5;SVG.on(document,'keydown',function(e){paddleDirection=e.keyCode==40?1:e.keyCode==38?-1:0;e.preventDefault();});SVG.on(document,'keyup',function(e){paddleDirection=0;e.preventDefault();});draw.on('click',function(){if(vx===0&&vy===0){vx=Math.random()*500-150;vy=Math.random()*500-150;}});function reset(){// visualize boom
boom();// reset speed values
vx=0,vy=0;// position the ball back in the middle
ball.animate(100).center(width/2,height/2);// reset the position of the paddles
paddleLeft.animate(100).cy(height/2);paddleRight.animate(100).cy(height/2);}// ball color update
var ballColor=new SVG.Color('#ff0066');//?? ballColor.morph('#00ff99')
// show visual explosion 
function boom(){// detect winning player
var paddle=ball.cx()>width/2?paddleLeft:paddleRight;// create the gradient
var gradient=draw.gradient('radial',function(stop){stop.stop(0,paddle.attr('fill'));stop.stop(1,paddle.attr('fill'));});// create circle to carry the gradient
var blast=draw.circle(300);blast.center(ball.cx(),ball.cy()).fill(gradient);// animate to invisibility
blast.animate(1000,'>').opacity(0).after(function(){blast.remove();});}};"use strict";/* classes to manage a quest
 */ ///////////////////////////////////////////////////////////////
var QuestMilestone=/*#__PURE__*/function(){_createClass(QuestMilestone,null,[{key:"NOP",value:function NOP(){return 0;}},{key:"DONE",value:function DONE(){return-1;}},{key:"HIDDEN",value:function HIDDEN(){return true;}}]);function QuestMilestone(id,name,descr,CondCheckCB){var HiddenCB=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;_classCallCheck(this,QuestMilestone);this.id=id,this.name=name;this.HiddenCB=HiddenCB===null?function(){return false;}:HiddenCB;this.descr=descr;this.CondCheckCB=CondCheckCB;window.storage.registerConstructor(QuestMilestone);}_createClass(QuestMilestone,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("QuestMilestone",this);}},{key:"evaluateCondition",//return value: 0 = condition nok, -1 = condition ok- quest finished, >0 condition ok & next MileID 
value:function evaluateCondition(){return this.CondCheckCB();}}],[{key:"fromJSON",value:function fromJSON(value){var _x=window.storage.Generic_fromJSON(QuestMilestone,value.data);return _x;}}]);return QuestMilestone;}();// a Quest contains multiple milestones
var Quest=/*#__PURE__*/function(){function Quest(id,name,descr){var HiddenCB=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;_classCallCheck(this,Quest);this.id=id,this.name=name,this.descr=descr;this.HiddenCB=HiddenCB===null?function(){return false;}:HiddenCB;this.miles=new Map();window.storage.registerConstructor(Quest);}_createClass(Quest,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("Quest",this);}},{key:"getMileById",/* those are not used - see questmanager
    getCurrMile(){
        return(this.mile);
    }
    questUpdated(){
        let nodeChangeEvent = new Event("change");
        nodeChangeEvent.id = this.id;
        this.pubSub.publish("change",nodeChangeEvent)
    }
     //returns the Quest & Milestone description for Quest-Log
	getLogDescription(){
        if (this.hidden()) return("");
		var log= this.descr+"</br>";
		if(this.getCurrMile()!=null && !this.getCurrMile().hidden) log+= this.getCurrMile().descr+"</br>";
		return(log);
	}
	activateMileByID(id){
        var _mile = this.getMileById(id);
        if (_mile !== null){
            if (this.mile != null && this.mile.ExitMilestoneCB!==null){
                this.mile.ExitMilestoneCB();
            }
            this.mile = _mile;
            if (this.mile != null && this.mile.EnterMilestoneCB !== null){
                this.mile.EnterMilestoneCB();
            }

            if (!this.mile.hidden){
                this.hidden=false;
                this.questUpdated();
            }
        }
	}
	
    // check here if progress to next milestone can be made (Condition of current MS met)
    // if there is no curent MS set, this quest is not started; 
    // the condition of the MS is the EXIT-condition
    evaluateCondition(){
        if (this.finished )  return;
        var Next = -1;
		if(this.mile !== null){
			Next = this.mile.evaluateCondition();
		} 
		if (Next === -1){
			this.finished = true;
		}else if (Next > 0){
			this.activateMileByID(Next);
		}
	}*/value:function getMileById(ID){if(this.miles.has(ID))return this.miles.get(ID);return null;}},{key:"addMileStone",value:function addMileStone(Mile){if(Mile!==null){this.miles.set(Mile.id,Mile);}/*if (this.mile === null){
            this.mile = Mile; //automatical activate entry milestone
            this.hidden = Mile.hidden;
        }*/}}],[{key:"fromJSON",value:function fromJSON(value){var _x=window.storage.Generic_fromJSON(Quest,value.data);return _x;}}]);return Quest;}();// QuestData only contains the state of the quests (finished, active milestone) but no function
// dont change the data manually - this is done by QuestManager ! 
// separation is necessary for save/reload issue
var QuestData=/*#__PURE__*/function(){function QuestData(){_classCallCheck(this,QuestData);this.activeQuests=[];//{id:"xyz",flags:0x0}
this.activeQuestsMS=[];this.finishedQuests=[];this.finishedQuestsMS=[];window.storage.registerConstructor(QuestData);}_createClass(QuestData,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("QuestData",this);}}],[{key:"fromJSON",value:function fromJSON(value){var _x=window.storage.Generic_fromJSON(QuestData,value.data);return _x;}}]);return QuestData;}();// the Questmanager contains a list of all quests
// because of save/restore issues this contains only the IDs of the active quest and milestones; all other data is defined in questDef
// todo: this should be singleton
var QuestManager=/*#__PURE__*/function(){//questDef is an object with properties that contain a quest-object and its milestones: questDef["myQuest"] = new Quest("myQuest") 
function QuestManager(questDef){_classCallCheck(this,QuestManager);this.pubSub=window.gm.util.PubSub();this.questDef=questDef;}// data is a QuestData-Object
_createClass(QuestManager,[{key:"setQuestData",value:function setQuestData(data){this.questData=data;}},{key:"questUpdated",value:function questUpdated(questId){var nodeChangeEvent=new Event("change");nodeChangeEvent.questId=questId;this.pubSub.publish("change",nodeChangeEvent);//alert(id);
}//can be used to progress a active quest to next milestone if its at current milestone
//tick will be called to check for finished or progress-condition
},{key:"forceQuestMilestone",value:function forceQuestMilestone(questId,mileId,reqMileId){var needsUpdate=false;for(var i=0;i<this.questData.activeQuests.length;i++){var qID=this.questData.activeQuests[i].id;var msID=this.questData.activeQuestsMS[i].id;if(qID===questId&&(reqMileId===msID||reqMileId===-1)){this.questData.activeQuestsMS[i].id=mileId;needsUpdate=true;}}if(needsUpdate)this.tick();else{window.gm.pushLog("cant force "+questId+" to "+mileId);}}//this will get called - sometimes - and will trigger the conditioncheck of the milestones
},{key:"tick",value:function tick(){var tickAgain=false;var tmpfinishedQuest=[];for(var i=0;i<this.questData.activeQuests.length;i++){var qID=this.questData.activeQuests[i].id;var msID=this.questData.activeQuestsMS[i].id;var quest=this.questDef[qID];var mile=quest.getMileById(msID);//if (quest.finished ) continue;
var Next=-1;if(!mile)throw new Error("cant find mileId "+msID+" in "+quest.id);Next=mile.evaluateCondition();if(Next===-1){tmpfinishedQuest.push(i);}else if(Next>0){this.questData.activeQuestsMS[i].id=Next;if(!quest.getMileById(Next).HiddenCB())this.questUpdated(qID);tickAgain=true;}}//remove finished quests
for(var k=tmpfinishedQuest.length-1;k>=0;k--){this.questData.finishedQuests.push(this.questData.activeQuests[tmpfinishedQuest[k]]);this.questData.finishedQuestsMS.push(this.questData.activeQuestsMS[tmpfinishedQuest[k]]);this.questData.activeQuests.splice(tmpfinishedQuest[k],1);this.questData.activeQuestsMS.splice(tmpfinishedQuest[k],1);//if(!this.questDef[qID].getMileById(msId).HiddenCB()) this.questUpdated(qID);
}// sometimes not only one milestone is fullfilled but several
// so we need to recheck again until no more progressing milestone
// also required to remove finished quests 
if(tickAgain)this.tick();}},{key:"getMilestoneState",value:function getMilestoneState(questId){for(var i=0;i<this.questData.activeQuests.length;i++){if(questId===this.questData.activeQuests[i].id)return this.questData.activeQuestsMS[i];}for(var i=0;i<this.questData.finishedQuests.length;i++){if(questId===this.questData.finishedQuests[i].id)return this.questData.finishedQuestsMS[i];}return{};}},{key:"getQuestState",value:function getQuestState(questId){for(var i=0;i<this.questData.activeQuests.length;i++){if(questId===this.questData.activeQuests[i].id)return this.questData.activeQuests[i];}for(var i=0;i<this.questData.finishedQuests.length;i++){if(questId===this.questData.finishedQuests[i].id)return this.questData.finishedQuests[i];}return{};}// cchecks if the quest is active and, if given, has the certain milestone
},{key:"hasActiveQuest",value:function hasActiveQuest(questId){var msId=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;for(var i=0;i<this.questData.activeQuests.length;i++){if(questId===this.questData.activeQuests[i].id&&(msId===null||msId===this.questData.activeQuestsMS[i].id))return true;}return false;}},{key:"hasFinishedQuest",value:function hasFinishedQuest(questId){var msId=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;for(var i=0;i<this.questData.finishedQuests.length;i++){if(questId===this.questData.finishedQuests[i].id&&(msId===null||msId===this.questData.finishedQuestsMS[i].id))return true;}return false;}//add & start a quest if not existent; if noRedo==false, finished quests will be restarted
},{key:"addQuest",value:function addQuest(questId,msID){var noRedo=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;if(!noRedo)this.removeQuest(questId);//remove from finished if redoing a quest
if(!(this.hasActiveQuest(questId)||this.hasFinishedQuest(questId))){this.questData.activeQuests.push({id:questId,flags:0});this.questData.activeQuestsMS.push({id:msID});if(!this.questDef[questId].getMileById(msID).HiddenCB())this.questUpdated(questId);}}//removes quest from active&finished
},{key:"removeQuest",value:function removeQuest(Id){for(var i=this.questData.activeQuests.length-1;i>=0;i--){if(this.questData.activeQuests[i].id===Id){this.questData.activeQuests.splice(i,1);this.questData.activeQuestsMS.splice(i,1);}}for(var i=this.questData.finishedQuests.length-1;i>=0;i--){if(this.questData.finishedQuests[i].id===Id){this.questData.finishedQuests.splice(i,1);this.questData.finishedQuestsMS.splice(i,1);}}}/*getQuestCount(){
		return(this.quests.length);
	}

    getQuestById(Id){
        if (this.quests.has(Id)){
            return(this.quests.get(Id));
        }
        return(null);
    }
    tick(){
        for (let [key, value] of this.quests.entries( )){
            value.evaluateCondition();
          }
    }
	addQuest(quest){
        quest.pubSub.subscribe("change", this.questUpdated)
        this.quests.set(quest.id, quest);    //Todo update 
	}
    removeQuest(Id){
        if (this.quests.has(Id)){
            //todo quest.removeEventListener("change",this.questUpdated)
            this.quests.delete(Id);

        }
	}*/}]);return QuestManager;}();"use strict";//operations for save/reload
// ??window.onload = function(){};
window.storage={// A list of constructors the smart reviver should know about  
// you need to register the class of each object that you want to serialize to this list
// and each class also has to have a method toJSON and static method fromJSON (calling Generic_-versions, see below )
// the namme of ctor needs to be unique !
constructors:{},registerConstructor:function registerConstructor(ctor){window.storage.constructors[ctor.name]=ctor;},// A generic "smart reviver" function.
// Looks for object values with a `ctor` property and
// a `data` property. If it finds them, and finds a matching
// constructor that has a `fromJSON` property on it, it hands
// off to that `fromJSON` fuunction, passing in the value.
Reviver:function Reviver(key,value){//console.info( 'reviver with key =' + key )
var ctor;if(value!==null&&_typeof(value)==="object"&&typeof value.ctor==="string"&&typeof value.data!=="undefined"){ctor=window.storage.constructors[value.ctor]||window[value.ctor];if(typeof ctor==="function"&&typeof ctor.fromJSON==="function"){return ctor.fromJSON(value);}}return value;},//this function works with Json.stringify to remove circular references
// unused because Reviver has even more problems with that
/*_replacerFunc: function(){
    const visited = new WeakSet();
    return (key, value) => {
      if (value !== null && typeof value === "object"){
        if (visited.has(value)){  return;  }
        visited.add(value);
      }
      return value;
    };
  },*/ // A generic "toJSON" function that creates the data expected by Reviver.
// `ctorName`  The name of the constructor to use to revive it
// `obj`       The object being serialized
// `keys`      (Optional) Array of the properties to serialize,
//             if not given then all of the objects "own" properties
//             that don't have function values will be serialized.
//             (Note: If you list a property in `keys`, it will be serialized
//             regardless of whether it's an "own" property.)
// Returns:    The structure (which will then be turned into a string
//             as part of the JSON.stringify algorithm)
// Stringify it with a replacer: var str = JSON.stringify(myObj);
Generic_toJSON:function Generic_toJSON(ctorName,obj,keys){var data,index,key;if(!keys){keys=Object.keys(obj);// Only "own" properties are included
}data={};for(index=0;index<keys.length;++index){key=keys[index];data[key]=obj[key];//causes infinite loop on circular ref   Character->Inventory->Character
}return{ctor:ctorName,data:data};},// A generic "fromJSON" function for use with Reviver: Just calls the
// constructor function with no arguments, then applies all of the
// key/value pairs from the raw data to the instance.
// Only useful for constructors that can be reasonably called without arguments!
// `ctor`      The constructor to call
// `data`      The data to apply
// Returns:    The object
Generic_fromJSON:function Generic_fromJSON(ctor,data){var obj,name,setter,setter2;obj=new ctor();for(name in data){setter="set"+name[0].toUpperCase()+name.substr(1);// we get the name of the setter for that property (e.g. : key=property => setter=setProperty
// that kind of names cannot be found in obj??? setter2 = "set "+name.substr(1); // e.g. : key=_property => setter=set property   (javascript style setter)
if(setter in obj){// if the setter exists 
obj[setter](data[name]);// we call the setter
// } else if(setter2 in obj){ // ..or...
//   obj[setter2](data[name]); 
}else{// if not, we set it directly
if(_typeof(obj[name])==="object"&&data[name]!==null){//cannot assign(curse,null)
if(obj[name]===null)obj[name]=data[name];//obj[name]={};
Object.assign(obj[name],data[name]);}else{obj[name]=data[name];//todo ??? obj[name] is constructed properly but will be overwritten with data[name]; use assign ?!
}}}return obj;},ok:function ok(){try{var storage=window["localStorage"],x='__storage_test__';storage.setItem(x,x);storage.removeItem(x);return true;}catch(e){return e instanceof DOMException&&(// everything except Firefox
e.code===22||// Firefox
e.code===1014||// test name field too, because code might not be present
// everything except Firefox
e.name==='QuotaExceededError'||// Firefox
e.name==='NS_ERROR_DOM_QUOTA_REACHED')&&// acknowledge QuotaExceededError only if there's something already stored
storage.length!==0;}},delete:function _delete(slot){window.localStorage.removeItem(window.story.name+slot);window.localStorage.removeItem(window.story.name+slot.concat('info'));},getSaveInfo:function getSaveInfo(slot){var info=null;if(window.storage.ok()){info=window.localStorage.getItem(window.story.name+slot.concat('info'));}if(!info){return'';}return info;},compressLocalSave:false,//this is for debugging (save file uncompressed)
loadFile:function loadFile(input){var file=input.files[0];var fileReader=new FileReader();fileReader.onload=function(){var _blobs=fileReader.result.split("!achievements!");window.storage.rebuildFromSave(_blobs[0],window.storage.compressLocalSave);window.storage.rebuildAchievements(_blobs[1],window.storage.compressLocalSave);var div=document.querySelector('#backdrop');//see save/load dialog
div.parentNode.removeChild(div);};fileReader.onerror=function(){alert(fileReader.error);};fileReader.readAsText(file);return true;//todo how to make async
},saveFile:function saveFile(){window.gm.preSave();var hash=JSON.stringify({state:window.story.state,history:window.story.history,checkpointName:window.story.checkpointName});var ahash=window.storage.getAchievements();if(window.storage.compressLocalSave){hash=LZString.compressToBase64(hash);ahash=LZString.compressToBase64(ahash);}var filename=window.story.name+"_Save.dat";var blob=new Blob([hash,"!achievements!",ahash],{type:"text/plain;charset=utf-8"});saveAs(blob,filename);},saveBrowser:function saveBrowser(slot){//var hash= window.story.save();    this call somehow messes up html and I had to copy the following from snowman script
//always compress or storage could be full soon !
window.gm.preSave();var hash=LZString.compressToBase64(JSON.stringify({state:window.story.state,history:window.story.history,checkpointName:window.story.checkpointName}));var ahash=LZString.compressToBase64(window.storage.getAchievements());var options={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"};var info=window.gm.player.location+' - '+new Intl.DateTimeFormat("default",options).format(new Date());//add storyname to avoid conflict with other games on same host (see Document.origin)
window.localStorage.setItem(window.story.name+slot.concat('info'),info);window.localStorage.setItem(window.story.name+slot,hash);window.localStorage.setItem(window.story.name+'achievements',ahash);return info;},loadBrowser:function loadBrowser(slot){var hash,info;if(window.storage.ok()){//not possible to save object {info,hash} ??
hash=window.localStorage.getItem(window.story.name+slot);info=window.storage.getSaveInfo(window.story.name+slot);window.storage.rebuildFromSave(hash,true);var ahash=window.localStorage.getItem(window.story.name+'achievements');window.storage.loadAchivementsFromBrowser();}return info;},rebuildFromSave:function rebuildFromSave(hash,compressed){if(!compressed)hash=LZString.compressToBase64(hash);//copied from window.story.restore because reviver  //window.story.restore(hash) ;
var save=JSON.parse(LZString.decompressFromBase64(hash),window.storage.Reviver);window.story.state=save.state;//todo doesnt work because nested objects are copied by reference, not sub-elements; this would replace already constructed object with old shit: window.story.state=Object.assign(window.story.state,save.state );
/*
       function merge(target,...arg){
        // create a new object
        //let target = {}; todo dont create plain-object, we need proper class-object!
        // deep merge the object into the target object
          const merger = (obj) => {
              for (let prop in obj){
                  if (obj.hasOwnProperty(prop)){
                      if (Object.prototype.toString.call(obj[prop]) === '[object Object]'){
                          // if the property is a nested object
                          target[prop] = merge(target[prop], obj[prop]);  <- todo doesnt work because target["Breast"] might not yet exist
          !TODO! Reviver works for class-objects because it merges save into constructed object
          but it doesnt work for plain objects because they dont use reviver
          ergo: anything needs to be a class or I need special post-load-operation to update plain object to new version
          ps.: if old saved object has propertys that are not present in new version, they will be attached to the newly created object too and create clutter
                      } else {
                          // for regular property
                          target[prop] = obj[prop];
                      }
                  }
              }
          };
          // iterate through all objects and deep merge them with target
          for (let i = 0; i < arg.length; i++){
              merger(arg[i]);
          }
          return target;
      };
      window.story.state = merge(window.story.state,save.state);*/window.story.history=save.history;window.story.checkpointName=save.checkpointName;window.gm.rebuildObjects();// this is for handling version-upgrades
window.story.show(window.gm.player.location);//window.gm.postVictory({flee:false});//teleport into dng or other location   
},getAchievements:function getAchievements(){var ahash=JSON.stringify({achievements:window.gm.achievements});return ahash;},loadAchivementsFromBrowser:function loadAchivementsFromBrowser(){if(window.storage.ok()){var ahash=window.localStorage.getItem(window.story.name+'achievements');if(ahash!==null)window.storage.rebuildAchievements(ahash,true);}},rebuildAchievements:function rebuildAchievements(ahash,compressed){if(!compressed)ahash=LZString.compressToBase64(ahash);var achievements=JSON.parse(LZString.decompressFromBase64(ahash)).achievements;//no reviver?!
if(!achievements)return;//it might be necessary to adapt the achievements here if a newer game-version is started !
var _keys=Object.keys(window.gm.achievements);for(var i=0;i<_keys.length;i++){if(achievements.hasOwnProperty(_keys[i])){var _old=achievements[_keys[i]];var _now=window.gm.achievements[_keys[i]];if(_old>_now)window.gm.achievements[_keys[i]]=_old;//merge loaded achievements into present
}}}};Map.prototype.toJSON=function(){//map doesnt have keys so we cant use window.storage.Generic_toJSON("Map", this);   TODO someone could do myMap.myValue="xx" and it wouldnt be saved
var data,index,key;data={};this.forEach(function(value,key,map){data[key]=value;});return{ctor:"Map",data:data};};Map.fromJSON=function(value){//return(window.storage.Generic_fromJSON(Map, value.data));
var obj,name,setter,data=value.data;obj=new Map();for(name in data){obj.set(name,data[name]);}return obj;};window.storage.registerConstructor(Map);/*  //save demo
window.gm.testsaveReviver = function (){
  window.storage.registerConstructor(Bar);
  window.storage.registerConstructor(Foo);
  var before = {
    foo: new Foo(21, 44),foo2: new Foo(100, 111),
  };
  before.foo.print(); // Stringify it with a replacer:
  var str = JSON.stringify(before); // Show that
  console.log(str); // Re-create it with use of a "reviver" function
  var after = JSON.parse(str, window.storage.Reviver);
  after.foo.print();after.foo2.print();
};
class Bar {
  constructor(x){
    this.__type="Bar";
    this._x = x;
  }
  get parent(){return this._parent();}
  print(){      console.log("parent="+this.parent.a.toString()+ this._x);    };
 toJSON(){return window.storage.Generic_toJSON("Bar", this); };
 static fromJSON(value){ return window.storage.Generic_fromJSON(Bar, value.data);};
}

class Foo {
  constructor(a=0, b=0){
    this.__type = 'Foo';
    this.a = a, this.b = b;
    this._bar = new Bar('fooboo'+this.a.toString());
    this._bar2 = new Bar('ba2'+this.b.toString());
    //this._bar._parent = (function(me){ return function(){return me;}}(this));
    //this._bar2._parent = (function(me){ return function(){return me;}}(this));
  }
  toJSON(){return window.storage.Generic_toJSON("Foo", this); };
  static fromJSON(value){ return window.storage.Generic_fromJSON(Foo, value.data);};
  setA(a){   this.a = -1 * a;  };
  print(){console.log(this.a.toString()); this._bar.print(); this._bar2.print();  };
}
*/ /* this should also work instead of reviver
window.gm.testsaveAssign = function (){
  var before = {
    foo: new Foo(21, 44)
  };
  before.foo.print(); // Stringify it with a replacer:
  var str = JSON.stringify(before); // Show that
  console.log(str); // Re-create it with use of a "reviver" function
  var after = window.storage.assignType(str);
  after.foo.print();
};*/ /*assignType: function(object){
    if(object && typeof(object) === 'object' && window[object.__type]){
        object = window.storage.assignTypeRecursion(object.__type, object);
    }
    return object;
  },
  assignTypeRecursion: function(type, object){
    for (var key in object){
        if (object.hasOwnProperty(key)){
            var obj = object[key];
            if(Array.isArray(obj)){
                 for(var i = 0; i < obj.length; ++i){
                     var arrItem = obj[i];
                     if(arrItem && typeof(arrItem) === 'object' && window[arrItem.__type]){
                         obj[i] = window.storage.assignTypeRecursion(arrItem.__type, arrItem);
                     }
                 }
            } else  if(obj && typeof(obj) === 'object' && window[obj.__type]){
                object[key] = window.storage.assignTypeRecursion(obj.__type, obj);
            }
        }
    }
    return Object.assign(new window[type](), object);
  },*/"use strict";window.gm=window.gm||{};window.gm.shop=window.gm.shop||{};//shop functions
//you have to initilaize the wares-list before calling the other functions
window.gm.shop.WaresToSell=[];//[{item:Bracer, cost:{id:'Money', count:50, for:1}}]
window.gm.shop.WaresToBuy=[];//dynamically build a link representing a buy option including display of cost and restriction
//count specifys how any items you get for cost
//cbCanBuy points to a function fn(itemid) that returns if can buy {OK:false,msg:'too expensive'} 
//cbPostBuy points to a function fn(itemid) that is called after buying ; 
window.gm.shop.printShopBuyEntry=function(item,cost,cbCanBuy){var cbPostBuy=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var desc2=item.name+'out of stock</br>';var _available=window.gm.player.Inv.countItem(item.id)+window.gm.player.Wardrobe.countItem(item.id);var entry=document.createElement('a');// entry is a link that will expand to item description
entry.id=item.id,entry.href='javascript:void(0)';var showDesc=function showDesc($event){var elmt=document.querySelector("div#"+$event.srcElement.id);elmt.innerHTML=item.desc+"</br>";elmt.toggleAttribute("hidden");};entry.addEventListener("click",showDesc,false);var div=document.createElement('div');div.id=item.id;div.hidden=true;var entryBuy=document.createElement('a');//entryBuy is a link that actual buys something or shows why not
entryBuy.id=item.id;entryBuy.href='javascript:void(0)';entryBuy.textContent="Buy (got "+_available+")";if(cost.for>0){var result=cbCanBuy(item);desc2=item.name+" (x"+cost.for+")";if(result.OK===false){entryBuy.textContent="";desc2=desc2+" "+result.msg;}else{desc2+=" "+result.msg;var foo=function foo($event){window.gm.shop.buyFromShop(item,cost,cbPostBuy);};entryBuy.addEventListener("click",foo,false);}}entry.textContent=desc2+"    ";$("div#panel")[0].appendChild(entry);$("div#panel")[0].appendChild(entryBuy);$("div#panel")[0].appendChild(document.createElement('br'));$("div#panel")[0].appendChild(document.createElement('br'));$("div#panel")[0].appendChild(div);};//a callback function to check if you can buy something;
//should return {OK:true,msg:'',postBuy:null} where message will be displayed either as reason why you cannot buy or cost
//unused because makes it unoverridable ->postboy is {fn:foo, cost:x} where fn points to a function that is called after buying (fn(itemid,x));  
//this implementation checks: money
window.gm.shop.defaultCanBuy=function(item,cost){var result={OK:true,msg:''};//, postBuy:null};
var money=window.gm.player.Inv.countItem(cost.id);if(money>=cost.count){result.msg='buy for '+cost.count+'x '+cost.id;}else{result.OK=false;result.msg='requires '+cost.count+'x '+cost.id;};return result;};window.gm.shop.defaultCanSell=function(item,cost){var result={OK:true,msg:''};//todo check equipped item
result.msg='sell for '+cost.count+' '+cost.id;return result;};//requires a <div id='choice'> </div> for displaying bought-message
window.gm.shop.defaultPostSell=function(item,cost){window.gm.player.changeInventory(window.gm.ItemsLib[cost.id](),cost.count);$("div#choice")[0].innerHTML='You sold '+item.name;$("div#choice")[0].classList.remove("div_alarm");$("div#choice")[0].offsetWidth;//this forces the browser to notice the class removal
$("div#choice")[0].classList.add("div_alarm");};//requires a <div id='choice'> </div> for displaying bought-message
window.gm.shop.defaultPostBuy=function(item,cost){window.gm.player.changeInventory(window.gm.ItemsLib[cost.id](),-1*cost.count);$("div#choice")[0].innerHTML='You bought '+item.name;$("div#choice")[0].classList.remove("div_alarm");$("div#choice")[0].offsetWidth;//this forces the browser to notice the class removal
$("div#choice")[0].classList.add("div_alarm");};window.gm.shop.cbCanBuyPerverse=function(item,cost,pervcost){var result=window.gm.shop.defaultCanBuy(item,cost);if(window.gm.player.Stats.get('corruption').value<pervcost){result.msg+=' ; requires corruption> '+pervcost;result.OK=false;}return result;};//this will add item to player; money-deduct or other cost has to be done in cbPostBuy ! 
window.gm.shop.buyFromShop=function(item,cost,cbPostBuy){window.gm.player.changeInventory(item,cost.for);if(cbPostBuy)cbPostBuy(item);//window.gm.refreshAllPanel(); dont refresh fullscreen or might reset modified textoutput
window.gm.refreshSidePanel();//just update other panels
renderToSelector("#panel","listbuy");};//this will remove item from player; money-deduct or other cost has to be done in cbPostSell ! 
window.gm.shop.sellToShop=function(item,cost,cbPostSell){window.gm.player.changeInventory(item,-1*cost.for);if(cbPostSell)cbPostSell(item);//window.gm.refreshAllPanel(); dont refresh fullscreen or might reset modified textoutput
window.gm.refreshSidePanel();//just update other panels
renderToSelector("#panel","listsell");};//dynamically build a link representing a sell option including display of cost
//count defines how many of this item you have to trade in
window.gm.shop.printShopSellEntry=function(item,cost,cbCanSell,cbPostSell){//only items the player has can be sold
var _available=window.gm.player.Inv.countItem(item.id)+window.gm.player.Wardrobe.countItem(item.id);if(_available<=0)return;var entry=document.createElement('a');entry.id=item.id;entry.href='javascript:void(0)';var showDesc=function showDesc($event){var elmt=document.querySelector("div#"+$event.srcElement.id);elmt.innerHTML=item.desc+"</br>";elmt.toggleAttribute("hidden");};entry.addEventListener("click",showDesc,false);var div=document.createElement('div');div.id=item.id;div.hidden=true;var entrySell=document.createElement('a');//a link where you can sell
entrySell.id=item.id;entrySell.href='javascript:void(0)';entrySell.textContent="Sell (got "+_available+")";var desc2=item.name+" (x"+cost.for+")";if(_available>=cost.for){var result=cbCanSell(item);if(result.OK===false){entrySell.textContent="";desc2=desc2+" "+result.msg;}else{desc2+=" "+result.msg;var foo=function foo($event){window.gm.shop.sellToShop(item,cost,cbPostSell);};entrySell.addEventListener("click",foo,false);}}else desc2=desc2+" not enough items";entry.textContent=desc2;$("div#panel")[0].appendChild(entry);$("div#panel")[0].appendChild(entrySell);$("div#panel")[0].appendChild(document.createElement('br'));$("div#panel")[0].appendChild(document.createElement('br'));$("div#panel")[0].appendChild(div);};// prints a table with items of 2 characters (Inv & wardrobe) and adds button to move items in between 
// expects a node with id "choice" to render items, and node with id "output" to render message 
window.gm.shop.printItemTransfer=function(whom1,whom2,TagsAllowed,TagsNotAllowed){var item,panel=document.getElementById('choice');if(!TagsAllowed)TagsAllowed=Object.values(window.gm.ItemTags);if(!TagsNotAllowed)TagsNotAllowed=[window.gm.ItemTags.Quest];var list1=window.gm.shop.findWaresToSell(whom1,TagsAllowed,TagsNotAllowed),list2=window.gm.shop.findWaresToSell(whom2,TagsAllowed,TagsNotAllowed);var left=document.createElement('p'),right=document.createElement('p'),entry,button;function give(item,amount,charA,charB){var item2=window.gm.util.deepClone(item);//item = window.gm.ItemsLib[id](); doesnt work for dynamic created items
var _rst=charB.changeInventory(item2,amount);charA.changeInventory(item,-1*_rst.count);window.gm.refreshAllPanel();if(_rst.msg!=""){var output=document.getElementById('output');output.innerHTML='<p>'+_rst.msg+'</p>';}}function use(item,amount,charA,charB){var item2=window.gm.util.deepClone(item);//item = window.gm.ItemsLib[id](); doesnt work for dynamic created items
var _rst=item2.use(charA.Inv,charB);//charA.changeInventory(item,-1*amount);
window.gm.refreshAllPanel();if(_rst.msg!=""){var output=document.getElementById('output');output.innerHTML='<p>'+_rst.msg+'</p>';}}function equip(item,amount,charA,charB){var item2=window.gm.util.deepClone(item);//item = window.gm.ItemsLib[id](); doesnt work for dynamic created items
var _rst=charB.changeInventory(item2,amount);_rst=charB.Outfit.addItem(item2);charA.changeInventory(item,-1*amount);window.gm.refreshAllPanel();if(_rst.msg!=""){var output=document.getElementById('output');output.innerHTML='<p>'+_rst.msg+'</p>';}}function createEntry(panel,X,whom1,whom2){entry=document.createElement('p');entry.textContent=X.item.count().toString()+"x "+X.item.name;button=document.createElement('button');button.textContent="give 1x";button.addEventListener("click",give.bind(null,X.item,1,whom1,whom2));entry.appendChild(button);if(X.item.canEquip){button=document.createElement('button');button.textContent="equip "+whom2.name;button.addEventListener("click",equip.bind(null,X.item,1,whom1,whom2));entry.appendChild(button);}else if(X.item.usable){button=document.createElement('button');button.textContent="use on "+whom2.name;button.addEventListener("click",use.bind(null,X.item,1,whom1,whom2));entry.appendChild(button);}panel.appendChild(entry);}list1.forEach(function(X){createEntry(left,X,whom1,whom2);});list2.forEach(function(X){createEntry(right,X,whom2,whom1);});var table=document.createElement('table');table.style.width="100%";table.style.tableLayout="fixed";var row=table.insertRow();row.insertCell().textContent=''+whom1.name;row.insertCell().textContent=''+whom2.name;row=table.insertRow();row.insertCell().appendChild(left),row.insertCell().appendChild(right);panel.appendChild(table);};// TODO prints a list of items from whom1 (Inv & wardrobe) to be GIVEN, USED or EQUIPPED on whom2
// if Equip causes items to be stripped, those items go into whom2-Inv if there is enough space, else they are passed to whom1
//returns a list of items from Inv & Wardrobe for selling
window.gm.shop.findWaresToSell=function(whom,TagsAllowed){var TagsNotAllowed=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[window.gm.ItemTags.Quest];var WaresToSell=[];var _ids=whom.Inv.getAllIds();var _ids2=whom.Wardrobe.getAllIds();var _iterator62=_createForOfIteratorHelper(_ids),_step62;try{for(_iterator62.s();!(_step62=_iterator62.n()).done;){var n=_step62.value;var item=whom.Inv.getItem(n);if(!item.hasTag(TagsNotAllowed)&&item.hasTag(TagsAllowed)){//filter by tag
var cost=window.gm.shop.calculateSellPrice(item);if(cost){WaresToSell.push({item:item,cost:cost});}}}}catch(err){_iterator62.e(err);}finally{_iterator62.f();}var _iterator63=_createForOfIteratorHelper(_ids2),_step63;try{for(_iterator63.s();!(_step63=_iterator63.n()).done;){var _n4=_step63.value;var _item2=whom.Wardrobe.getItem(_n4);if(!_item2.hasTag(TagsNotAllowed)&&_item2.hasTag(TagsAllowed)){//filter by tag
var _cost=window.gm.shop.calculateSellPrice(_item2);if(_cost){WaresToSell.push({item:_item2,cost:_cost});}}}}catch(err){_iterator63.e(err);}finally{_iterator63.f();}return WaresToSell;};"use strict";var SkillResult=function SkillResult(){_classCallCheck(this,SkillResult);this.OK=false,this.source=null,this.targets=[],this.skill=null,this.msg="",this.effects=[];};var SkillCost=/*#__PURE__*/function(){function SkillCost(){_classCallCheck(this,SkillCost);this.will=0,this.energy=0,this.health=0,this.poise=0,this.items=[];//Todo
}_createClass(SkillCost,[{key:"asText",value:function asText(){var msg='';if(this.will>0)msg+=this.will.toString()+' will';if(this.energy>0)msg+=this.energy.toString()+' energy';if(this.health>0)msg+=this.health.toString()+' health';if(this.poise>0)msg+=this.poise.toString()+' poise';if(msg==='')msg='without cost';else msg='requires '+msg;return msg;}},{key:"canPay",value:function canPay(Char){var res={OK:true,msg:''};if(this.will>Char.Stats.get('will').value){res.OK=false;res.msg+='not enough will';}if(this.health+1>Char.Stats.get('health').value){//+1 to not selfkill
res.OK=false;res.msg+='not enough health';}if(this.energy>Char.Stats.get('energy').value){res.OK=false;res.msg+='not enough energy';}if(this.poise>Char.Stats.get('poise').value){res.OK=false;res.msg+='not enough poise';}return res;}},{key:"pay",value:function pay(Char){Char.Stats.increment('health',this.health*-1);Char.Stats.increment('will',this.will*-1);Char.Stats.increment('energy',this.energy*-1);Char.Stats.increment('poise',this.poise*-1);}}]);return SkillCost;}();var SkillMod=function SkillMod(){_classCallCheck(this,SkillMod);this.msg='';this.hitChance=100;this.critChance=4;this.onHit=[];// [{ target: 'target', eff: [combatEffect]]
this.onCrit=[];this.onUse=[];this.onMiss=[];};//skills are collected in separate inventory
var Skill=/*#__PURE__*/function(){function Skill(id){_classCallCheck(this,Skill);this.id=this.name=id;this.cost=new SkillCost();this.level=1;this.sealed=0,this.startDelay=0,this.coolDown=0,this.defCoolDown=0;//how many turns disabled after use
}//_parent will be added dynamical
_createClass(Skill,[{key:"_relinkItems",value:function _relinkItems(parent){this._parent=window.gm.util.refToParent(parent);}},{key:"getMaxTargetCount",value:function getMaxTargetCount(){return 1;}},{key:"isValidPhase",value:function isValidPhase(){//todo: returns True if the skill can be used in tha actual game-phase (combatPhase,explorePhase)
var res={OK:true,msg:''};return res;}/*
* override this to check if cast is in proper stance
* */},{key:"isValidStance",value:function isValidStance(){var res={OK:true,msg:''};return res;}/**
 * returns false and text if the skill cannot be used because its temporary disabled (silenced mage, blinded)
 * the text should indicate why and how long it is disabled
 * call super to check cost !
 */},{key:"isEnabled",value:function isEnabled(){var res=this.isValidStance();if(!res.OK)return res;if(this.isSealed().OK)res={OK:false,msg:'skill sealed'};if(this.coolDown>0)res={OK:false,msg:this.coolDown+' turns cooldown'};if(!res.OK)return res;res=this.getCost().canPay(this.parent.parent);return res;}/**
 * returns if the skill is already acitvated, e.g. energy-shield
 *
 * @return {*} 
 * @memberof Skill
 */},{key:"isActive",value:function isActive(){return{OK:false,msg:''};}},{key:"isSealed",value:function isSealed(){return{OK:this.sealed>0,msg:''};}},{key:"seal",value:function seal(_seal){this.sealed=_seal;}/**
 *
 *
 * @memberof Skill
 */},{key:"onCombatStart",value:function onCombatStart(){this.coolDown=this.startDelay;}},{key:"onTurnStart",value:function onTurnStart(){this.coolDown=Math.max(0,this.coolDown-1);}//this is used to filter possible targets for a skill
//the function returns a array of arrays containing the targets  
//f.e. [[dragon],[mole1,mole2]] to indicate that the skill can be used on dragon or both moles at same time
},{key:"targetFilter",value:function targetFilter(targets){return this.targetFilterEnemy(targets);}//returns True if the skill can be used on the target(s)
},{key:"isValidTarget",value:function isValidTarget(target){// filtered can be [[mole1,mole2]] or [[dragon],[mole1,mole2]]
//target is [dragon] or [mole1,mole2]
var filtered=this.targetFilter([target]);//[[]] !
var _iterator64=_createForOfIteratorHelper(target),_step64;try{for(_iterator64.s();!(_step64=_iterator64.n()).done;){var targ=_step64.value;var _i=filtered.indexOf(target);if(_i<0)return false;}}catch(err){_iterator64.e(err);}finally{_iterator64.f();}return true;}/**
 * returns information about the cost to execute the skill
 */},{key:"getCost",value:function getCost(){//Todo
return this.cost;}},{key:"getName",value:function getName(){//returns name of the skill for listboxes/labels"""
return this.name;}},{key:"getCastDescription",value:function getCastDescription(castPreview){//update msg after sucessful cast
return this.caster.name+" uses "+this.name+" on "+(castPreview.targets[0].name===this.caster.name?"self":castPreview.targets[0].name)+".";}},{key:"previewCast",value:function previewCast(target){var result=new SkillResult();result.msg=this.caster.name+" will use "+this.name+" on "+targets.name;return result;}},{key:"cast",value:function cast(target){//execute the skill on the targets
var result=this.previewCast(target);var cost=this.getCost();if(result.OK){result.msg="";var _iterator65=_createForOfIteratorHelper(result.effects),_step65;try{for(_iterator65.s();!(_step65=_iterator65.n()).done;){var X=_step65.value;// for each target
var _iterator66=_createForOfIteratorHelper(X.eff),_step66;try{for(_iterator66.s();!(_step66=_iterator66.n()).done;){var Y=_step66.value;//...multiple effects
X.target.addEffect(Y,Y.id,this.caster);result.msg+=Y.castDesc();}}catch(err){_iterator66.e(err);}finally{_iterator66.f();}}}catch(err){_iterator65.e(err);}finally{_iterator65.f();}cost.pay(this.parent.parent);this.coolDown=this.defCoolDown;/*result.msg =*/window.gm.printSfx('',this.getCastDescription(result)+" "+result.msg+"<br>");}return result;}//some predefined filter; chain them to narrow down the targets
// target = [[enemy#1], [you,me]]
},{key:"targetFilterSelf",value:function targetFilterSelf(targets){var possibleTarget=[];var _iterator67=_createForOfIteratorHelper(targets),_step67;try{for(_iterator67.s();!(_step67=_iterator67.n()).done;){var target=_step67.value;var valid=true;var _iterator68=_createForOfIteratorHelper(target),_step68;try{for(_iterator68.s();!(_step68=_iterator68.n()).done;){var targ=_step68.value;if(this.caster!==targ)valid=false;}}catch(err){_iterator68.e(err);}finally{_iterator68.f();}if(valid)possibleTarget.push(target);}}catch(err){_iterator67.e(err);}finally{_iterator67.f();}return possibleTarget;}},{key:"targetFilterNotSelf",value:function targetFilterNotSelf(targets){//all exclude self
var possibleTarget=[];var _iterator69=_createForOfIteratorHelper(targets),_step69;try{for(_iterator69.s();!(_step69=_iterator69.n()).done;){var target=_step69.value;var valid=true;var _iterator70=_createForOfIteratorHelper(target),_step70;try{for(_iterator70.s();!(_step70=_iterator70.n()).done;){var targ=_step70.value;if(this.caster===targ)valid=false;}}catch(err){_iterator70.e(err);}finally{_iterator70.f();}if(valid)possibleTarget.push(target);}}catch(err){_iterator69.e(err);}finally{_iterator69.f();}return possibleTarget;}},{key:"targetFilterEffect",value:function targetFilterEffect(targets,effects){var Not=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;//those with any one effect; effects= [[{id:'effBleed'}],[{id:'effStunned'},{id:'effFrozen'}]]
var possibleTarget=[];if(effects.length===0)return possibleTarget;var _iterator71=_createForOfIteratorHelper(targets),_step71;try{for(_iterator71.s();!(_step71=_iterator71.n()).done;){var target=_step71.value;var valid=true;var _iterator72=_createForOfIteratorHelper(target),_step72;try{for(_iterator72.s();!(_step72=_iterator72.n()).done;){var targ=_step72.value;var _iterator73=_createForOfIteratorHelper(effects),_step73;try{for(_iterator73.s();!(_step73=_iterator73.n()).done;){var effs=_step73.value;var cnt=effs.length;var _iterator74=_createForOfIteratorHelper(effs),_step74;try{for(_iterator74.s();!(_step74=_iterator74.n()).done;){var eff=_step74.value;//TODO if empty ? 
if(targ.Effects.countItem(eff.id)>0)cnt--;}}catch(err){_iterator74.e(err);}finally{_iterator74.f();}if(cnt>0&&!Not||cnt<=0&&Not)valid=false;}}catch(err){_iterator73.e(err);}finally{_iterator73.f();}}}catch(err){_iterator72.e(err);}finally{_iterator72.f();}if(valid)possibleTarget.push(target);}}catch(err){_iterator71.e(err);}finally{_iterator71.f();}return possibleTarget;}},{key:"targetFilterAlly",value:function targetFilterAlly(targets){//includes self
var possibleTarget=[];var _iterator75=_createForOfIteratorHelper(targets),_step75;try{for(_iterator75.s();!(_step75=_iterator75.n()).done;){var target=_step75.value;var valid=true;var _iterator76=_createForOfIteratorHelper(target),_step76;try{for(_iterator76.s();!(_step76=_iterator76.n()).done;){var targ=_step76.value;if(this.caster.faction!=targ.faction)valid=false;}}catch(err){_iterator76.e(err);}finally{_iterator76.f();}if(valid)possibleTarget.push(target);}}catch(err){_iterator75.e(err);}finally{_iterator75.f();}return possibleTarget;}},{key:"targetFilterEnemy",value:function targetFilterEnemy(targets){var possibleTarget=[];var _iterator77=_createForOfIteratorHelper(targets),_step77;try{for(_iterator77.s();!(_step77=_iterator77.n()).done;){var target=_step77.value;var valid=true;var _iterator78=_createForOfIteratorHelper(target),_step78;try{for(_iterator78.s();!(_step78=_iterator78.n()).done;){var targ=_step78.value;if(this.caster.faction==targ.faction)valid=false;//if(targ.isKnockedOut()) valid=false;
}}catch(err){_iterator78.e(err);}finally{_iterator78.f();}if(valid)possibleTarget.push(target);}}catch(err){_iterator77.e(err);}finally{_iterator77.f();}return possibleTarget;}},{key:"targetFilterFighting",value:function targetFilterFighting(targets){//chars that are not inhibited
var possibleTarget=[];var _iterator79=_createForOfIteratorHelper(targets),_step79;try{for(_iterator79.s();!(_step79=_iterator79.n()).done;){var target=_step79.value;var valid=true;var _iterator80=_createForOfIteratorHelper(target),_step80;try{for(_iterator80.s();!(_step80=_iterator80.n()).done;){var targ=_step80.value;if(!targ._canAct().OK)valid=false;}}catch(err){_iterator80.e(err);}finally{_iterator80.f();}if(valid)possibleTarget.push(target);}}catch(err){_iterator79.e(err);}finally{_iterator79.f();}return possibleTarget;}},{key:"targetFilterAlive",value:function targetFilterAlive(targets){//chars that are not dead
var possibleTarget=[];var _iterator81=_createForOfIteratorHelper(targets),_step81;try{for(_iterator81.s();!(_step81=_iterator81.n()).done;){var target=_step81.value;var valid=true;var _iterator82=_createForOfIteratorHelper(target),_step82;try{for(_iterator82.s();!(_step82=_iterator82.n()).done;){var targ=_step82.value;if(targ.isKnockedOut())valid=false;//todo ..isDead()??
}}catch(err){_iterator82.e(err);}finally{_iterator82.f();}if(valid)possibleTarget.push(target);}}catch(err){_iterator81.e(err);}finally{_iterator81.f();}return possibleTarget;}},{key:"targetFilterDead",value:function targetFilterDead(targets){//chars that are dead
var possibleTarget=[];var _iterator83=_createForOfIteratorHelper(targets),_step83;try{for(_iterator83.s();!(_step83=_iterator83.n()).done;){var target=_step83.value;var valid=true;var _iterator84=_createForOfIteratorHelper(target),_step84;try{for(_iterator84.s();!(_step84=_iterator84.n()).done;){var targ=_step84.value;if(!targ.isDead())valid=false;}}catch(err){_iterator84.e(err);}finally{_iterator84.f();}if(valid)possibleTarget.push(target);}}catch(err){_iterator83.e(err);}finally{_iterator83.f();}return possibleTarget;}},{key:"targetMultiple",value:function targetMultiple(targets){var possibletarget=targets.slice(0);//[[mole1],[mole2]]
var multi=[];multi.name="all";//there has to be a name for display
var _iterator85=_createForOfIteratorHelper(possibletarget),_step85;try{for(_iterator85.s();!(_step85=_iterator85.n()).done;){var n=_step85.value;if(n.length===1)//dont stack multi-targets
multi.push(n[0]);}}catch(err){_iterator85.e(err);}finally{_iterator85.f();}if(multi.length>1)possibletarget.push(multi);//ignore if only 1
//[[mole1],[mole2],[mole1,mole2]]
return possibletarget;}},{key:"parent",get:function get(){return this._parent?this._parent():null;}},{key:"caster",get:function get(){return this.parent.parent;}//implement this for description
},{key:"desc",get:function get(){return this.name;}}]);return Skill;}();"use strict";/* classes to affect...: 
    - the state of a character like     'tired'
    - stats of a character like healthMax
    - 
 */ ///////////////////////////////////////////////////////////////
/**
  * a collection of Stats
  * @class StatsDictionary
  * @extends {Inventory}
  */var StatsDictionary=/*#__PURE__*/function(_Inventory){_inherits(StatsDictionary,_Inventory);var _super6=_createSuper(StatsDictionary);function StatsDictionary(externlist){var _this7;_classCallCheck(this,StatsDictionary);_this7=_super6.call(this,externlist);window.storage.registerConstructor(StatsDictionary);return _this7;}_createClass(StatsDictionary,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("StatsDictionary",this);}},{key:"get",/**
     *
     *
     * @param {*} id
     * @return {*} 
     * @memberof StatsDictionary
     */value:function get(id){return this.getItem(id);}},{key:"modifyHidden",value:function modifyHidden(id,hidden){var _data=this.get(id).data;_data.hidden=hidden;}/**
     *
     * adds a modifier to a Stat or replaces it
     * @memberof StatsDictionary
     */},{key:"addModifier",value:function addModifier(toId,modData){var _stat=this.get(toId);var _oldMods=_stat.data.modifier;var _x=-1;for(var i=0;i<_oldMods.length;i++){if(_oldMods[i].id===modData.id)_x=i;}if(_x>=0)_oldMods.splice(_x,1);_oldMods.push(modData);window.gm.pushLog(_stat.Calc().msg);}},{key:"removeModifier",value:function removeModifier(toId,modData){var _stat=this.get(toId);var _oldMods=_stat.data.modifier;var _x=-1;for(var i=0;i<_oldMods.length;i++){if(_oldMods[i].id===modData.id)_x=i;}if(_x>=0)_oldMods.splice(_x,1);window.gm.pushLog(_stat.Calc().msg);}},{key:"getModifier",value:function getModifier(toId,modId){var modData=null,_stat=this.get(toId);var _oldMods=_stat.data.modifier;var _x=-1;for(var i=0;i<_oldMods.length;i++){if(_oldMods[i].id===modId)modData=_oldMods[i];}return modData;}//override
},{key:"postItemChange",value:function postItemChange(id,operation,msg){window.gm.pushLog('Stats: '+operation+' '+id+' '+msg);}//override; only use to create new stats !
},{key:"addItem",value:function addItem(stat){var _i=this.findItemSlot(stat.name);if(_i<0){stat._parent=window.gm.util.refToParent(this);this.list.push({'id':stat.id,'count':1,item:stat});}}//override
},{key:"removeItem",value:function removeItem(id){var _i=this.findItemSlot(id);if(_i<0)return;//just skip if not found
var _stat=this.get(id);this.list.splice(_i,1);_stat.calc();//trigger update of dependent stat
}/**
     * adds value to the stats value
     *
     * @param {*} id
     * @param {*} value
     * @memberof StatsDictionary
     */},{key:"increment",value:function increment(id,value){var attr=this.get(id);attr.data.base+=value;window.gm.pushLog(attr.Calc(this,id).msg);// todo show only for player
}/**
     * modifys stats value relative, f.e. 0.3 -> add 30% of stats value
     *
     * @param {*} id
     * @param {*} value
     * @memberof StatsDictionary
     */},{key:"scaleValue",value:function scaleValue(id,value){var attr=this.get(id);attr.data.base=attr.data.base*(1.0+value);window.gm.pushLog(attr.Calc(this,id).msg);// todo show only for player
}}],[{key:"fromJSON",value:function fromJSON(value){var _x=window.storage.Generic_fromJSON(StatsDictionary,value.data);return _x;}}]);return StatsDictionary;}(Inventory);/**
 * class for an Attribute
 *
 * @class Stat
 */var Stat=/*#__PURE__*/function(){_createClass(Stat,null,[{key:"dataPrototype",value:function dataPrototype(){return{id:'',base:0,value:0,limits:[{max:999999,min:-999999}],modifier:[],modifys:[],hidden:0};//limit = {min: max:}   limit to apply to value and base; either statid or number
//modifier {id: bonus:}      Stat that modifys value, bonus is value to add             todo: multiplier but then we have to sort modifiers somehow
//modifys {id:}         point to the Stats that have modifiers from this stat or is used as limit
//hidden 0 = visible, 1= name unreadable, 2= value unreadable, 4= hidden
}//returns array with Max,Min,Regen,Stat that you have to add to your stats list; you also need to adjust limits
},{key:"setupStatWithLimitAndRegen",value:function setupStatWithLimitAndRegen(name){var opt=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{base:100};var def=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var stats=[],_stat,_n;if(opt.max!==undefined){_stat=def.max?def.max:new Stat(),_n=_stat.data;_n.id=name+'Max',_n.base=opt.max,_n.hidden=4,_n.value=opt.max,_n.modifys=[{id:name}],_n.limits=[{max:999999,min:0}];stats.push(_stat);}if(opt.min!==undefined){_stat=def.min?def.min:new Stat(),_n=_stat.data;_n.id=name+'Min',_n.base=opt.min,_n.hidden=4,_n.value=opt.min,_n.modifys=[{id:name}],_n.limits=[{max:0,min:-999999}];stats.push(_stat);}if(opt.regen!==undefined){_stat=def.regen?def.regen:new Stat(),_n=_stat.data;_n.id=name+'Regen',_n.base=opt.regen,_n.hidden=4,_n.value=opt.regen,_n.limits=[{max:100,min:-100}];stats.push(_stat);}_stat=new Stat(),_n=_stat.data;_n.id=name,_n.base=opt.base,_n.value=opt.base,_n.limits=[{max:opt.max!==undefined?name+'Max':0,min:opt.min!==undefined?name+'Min':0}];stats.push(_stat);return stats;}}]);function Stat(){_classCallCheck(this,Stat);this.data=Stat.dataPrototype();}_createClass(Stat,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("Stat",this);}},{key:"_relinkItems",value:function _relinkItems(parent){this._parent=window.gm.util.refToParent(parent);}},{key:"Calc",//this is called to update value of the stat and will trigger calculation of dependend stats; 
//requires that the stats where added to the dictionary! 
value:function Calc(){var attr=this.data;var min=-999999;var max=999999;var msg='';//get limits
for(var k=0;k<attr.limits.length;k++){//this might behave odly if any min>max
var lmin=attr.limits[k].min,lmax=attr.limits[k].max;//lm__ is id or number
if(lmin||lmin===0){min=typeof lmin==='string'?Math.max(this.parent.get(lmin).value,min):Math.max(lmin,min);}if(lmax||lmax===0){max=typeof lmax==='string'?Math.min(this.parent.get(lmax).value,max):Math.min(lmax,max);}}//recalculate modifiers
var _old=attr.value;attr.base=attr.value=Math.max(min,Math.min(max,attr.base));for(var i=0;i<attr.modifier.length;i++){attr.value+=attr.modifier[i].bonus;}var _new=Math.max(min,Math.min(max,attr.value));attr.value=_new;msg+=this.formatMsgStatChange(attr,_new,_old);//todo no log hidden
this.updateModifier();//trigger recalculation of dependend Stats
for(var m=0;m<attr.modifys.length;m++){msg+=this.parent.get(attr.modifys[m].id).Calc().msg;}return{OK:true,msg:msg};}},{key:"formatMsgStatChange",value:function formatMsgStatChange(attr,_new,_old){if(_new-_old>0){return'<statup>'+attr.id+" off "+this.parent.parent.name+" regenerated by "+(_new-_old).toFixed(1).toString()+"</statup>";}else if(_new-_old<0){return'<statdown>'+attr.id+" off "+this.parent.parent.name+" decreased by "+(_new-_old).toFixed(1).toString()+"</statdown>";}return"";}},{key:"updateModifier",value:function updateModifier(){}},{key:"parent",// Attention !!_parent will be added dynamical
get:function get(){return this._parent?this._parent():null;}},{key:"name",get:function get(){return this.data.id;}},{key:"id",get:function get(){return this.data.id;}},{key:"base",get:function get(){return this.data.base;}},{key:"value",get:function get(){return this.data.value;}},{key:"rmax",get:function get(){return this.data.value/this.parent.get(this.id+'Max').value;}//value/max
},{key:"hidden",get:function get(){return this.data.hidden;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(Stat,value.data);}}]);return Stat;}();/////////////////////////////////////////////////////////////////////////
/**
 * a collection of Effects
 * @class Effects
 * @extends {Inventory}
 */var Effects=/*#__PURE__*/function(_Inventory2){_inherits(Effects,_Inventory2);var _super7=_createSuper(Effects);function Effects(externlist){var _this8;_classCallCheck(this,Effects);_this8=_super7.call(this,externlist);window.storage.registerConstructor(Effects);//! this doesnt work after load! see PubSub comments
//window.gm.timeEvent.subscribe("change", this.updateTime.bind(this) ); 
return _this8;}_createClass(Effects,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("Effects",this);}},{key:"get",value:function get(id){return this.getItem(id);}/*
    * findItemslot uses id, this one finds all effects with a name
    */},{key:"findEffect",value:function findEffect(name){var _items=[];for(var i=0;i<this.count();i++){if(this.list[i].item.name===name)_items.push(this.list[i].item);}return _items;}//override
},{key:"removeItem",value:function removeItem(id){var _i=this.findItemSlot(id);if(_i<0)return;//just skip if not found
var _eff=this.get(id);this.list.splice(_i,1);_eff.onRemove(this,this.list[_i]);this.postItemChange(id,"removed","");}},{key:"addItem",value:function addItem(effect){var id=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'';id=effect.id;//if(id==='') id= effect.name; todo effects remove themself by id, not by name
var _i=this.findItemSlot(id);var res;//todo what if there are 2 damage effects from 2 attackers, blunt for 2 rounds , blunt for 3 ??
//if effect with same id is already present, merge them
if(_i>-1){var _old=this.get(id);//effect.id);
res=_old.merge(effect);if(res!=null){if(res===true){}else res(this);//should be a function
this.postItemChange(id,"merged","");return;}}//or if there are similiar effects try to merge with them
for(var i=0;i<this.list.length;i++){var _old2=this.list[i].item;res=_old2.merge(effect);if(res!=null){if(res===true){}else res(this);//should be a function
this.postItemChange(id,"merged","");return;}}//else add it to list
this.list.push({'id':id,'count':1,item:effect});effect._parent=window.gm.util.refToParent(this);effect.onApply();this.postItemChange(id,"added","");}},{key:"replace",value:function replace(id,neweffect){var _i=this.findItemSlot(id);if(_i<0)return;//Todo do nothing
var _old=this.get(id);_old.onRemove();neweffect._parent=window.gm.util.refToParent(this);this.list[_i].id=neweffect.id,this.list[_i].item=neweffect;neweffect.onApply();}},{key:"updateTime",value:function updateTime(){var now=window.gm.getTime();for(var i=0;i<this.list.length;i++){var _eff=this.list[i].item;var foo=_eff.onTimeChange(now);if(foo)foo(this);}}//override
},{key:"postItemChange",value:function postItemChange(id,operation,msg){window.gm.pushLog('Effects: '+operation+' '+id+' '+msg,window.story.state._gm.debug||window.gm.player&&window.gm.player.id===this.parent.id);}}],[{key:"fromJSON",value:function fromJSON(value){var _x=window.storage.Generic_fromJSON(Effects,value.data);return _x;}}]);return Effects;}(Inventory);/////////////////////////////////////////////////////////////////////////
/**
 * @class Effect
 */var Effect=/*#__PURE__*/function(){function Effect(){_classCallCheck(this,Effect);this.data=Effect.dataPrototype();this.data.time=window.gm.getTime();}_createClass(Effect,[{key:"_relinkItems",value:function _relinkItems(parent){this._parent=window.gm.util.refToParent(parent);}// id = SlumberPotion:Stunned;  name = Stunned
},{key:"merge",//
/**
     *is called when a effect is applied to check if the new effect can be combined with an exisitng one
     * return null if no merge occured
     * return true if the neweffect was merged into existing one; no other effects are then checked for mergeability
     * or return function that has to be executed: (function(Effects){ Effects.replace(data.id,NotTired);}));
     *
     * @param {*} neweffect
     * @return {*} 
     * @memberof Effect
     */value:function merge(neweffect){return null;}/**
     *
     * @param {*} time
     * @return {*} 
     * @memberof Effect
     */},{key:"onTimeChange",value:function onTimeChange(time){return null;}/**
     *
     * @memberof Effect
     */},{key:"onApply",value:function onApply(){}/**
     *
     * @memberof Effect
     */},{key:"onRemove",value:function onRemove(){}},{key:"parent",/**
     * Attention !! _parent will be added dynamical
     *
     * @readonly
     * @memberof Effect
     */get:function get(){return this._parent?this._parent():null;}},{key:"id",get:function get(){return this.data.id;},set:function set(id){this.data.id=id;}/**
     * Attention !!  effTired.name returns constructor-name but Effects.getById('effTired').name returns data.name
     *
     * @readonly
     * @memberof Effect
     */},{key:"name",get:function get(){return this.data.name;}},{key:"time",get:function get(){return this.data.time;}},{key:"duration",get:function get(){return this.data.duration;}},{key:"hidden",get:function get(){return this.data.hidden;}},{key:"desc",get:function get(){return this.name;}},{key:"shortDesc",get:function get(){return this.name;}}],[{key:"dataPrototype",value:function dataPrototype(){return{id:'xxx',name:Effect.name,time:0,duration:0,hidden:0};//hidden 0 = visible, 1= name unreadable, 2= value unreadable, 4= hidden
}}]);return Effect;}();/////////////////////////////////////////////////////////////////////////
/**
 * combat effect use turn-count instead of realtime as duration
 *
 * @class CombatEffect
 * @extends {Effect}
 */var CombatEffect=/*#__PURE__*/function(_Effect){_inherits(CombatEffect,_Effect);var _super8=_createSuper(CombatEffect);function CombatEffect(){var _this9;_classCallCheck(this,CombatEffect);_this9=_super8.call(this);_this9.castMsg='';return _this9;}/**
     *shown in skill-select
     *
     * @readonly
     * @memberof CombatEffect
     */_createClass(CombatEffect,[{key:"castDesc",/**
     *shown when casting the effect
     *
     * @return {*} 
     * @memberof CombatEffect
     */value:function castDesc(){return this.castMsg;}/**
     * called after victory/defeat (before -scene plays)
     * combateffect should be removed after combat (call super if overridden) ! 
     *
     * @memberof CombatEffect
     */},{key:"onCombatEnd",value:function onCombatEnd(){this.parent.removeItem(this.data.id);}/**
     * 
     */},{key:"onCombatStart",value:function onCombatStart(){return{OK:false,msg:''};}/**
     * called before targets turn
     *
     * @return {*} 
     */},{key:"onTurnStart",value:function onTurnStart(){return{OK:true,msg:''};}//at end of targets turn   UNUSED
//onTurnEnd(){ return({OK:true,msg:''}); }
},{key:"shortDesc",get:function get(){return this.desc+" for "+this.data.duration+" turns";}//duration in turns !
/**
     * returns SVG representing the effect
     *
     * @readonly
     * @memberof CombatEffect
     */},{key:"icon",get:function get(){return"";}/**
     * returns icon with duration and tooltip for effect-list in combat
     *
     * @readonly
     * @memberof CombatEffect
     */},{key:"iconTooltip",get:function get(){var _icon=this.icon;//Note: css-class take care of formating        TODO show tooltip on hover/click
if(_icon=="")return'<div class="combateff"><div class="combaticon">'+window.gm.images.ic_unknown()+'</div>'+this.shortDesc+'</div>';return'<div class="combateff"><div class="combaticon">'+_icon+'</div>'+this.data.duration+'</div>';}}]);return CombatEffect;}(Effect);;(function(){"use strict";// Style Switcher from https://www.stichpunkt.de/css/styleswitch.html
var StyleSwitcher=/*#__PURE__*/function(){function StyleSwitcher(){_classCallCheck(this,StyleSwitcher);this.style="default";this.cookie="Layout";this.days=30;}_createClass(StyleSwitcher,[{key:"switchStyle",value:function switchStyle(s){if(!document.getElementsByTagName)return;var n=document.getElementsByTagName("link");for(var i=0;i<n.length;i++){if(n[i].getAttribute("rel").indexOf("style")!=-1&&n[i].getAttribute("title")){n[i].disabled=true;if(n[i].getAttribute("title")==s)n[i].disabled=false;}}}},{key:"loadStyle",value:function loadStyle(){var c=this.getStyleCookie();if(c&&c!=this.style){this.switchStyle(c);this.style=c;}}},{key:"setStyle",value:function setStyle(s){if(s!=this.style){this.switchStyle(s);this.style=s;this.setStyleCookie();}}// Cookie-Funktionen
},{key:"setCookie",value:function setCookie(name,value,expdays){var now=new Date();var exp=new Date(now.getTime()+1000*60*60*24*expdays);var val=name+"="+escape(value)+","+"expires="+exp.toGMTString()+","+"path=/";document.cookie=val;}},{key:"delCookie",value:function delCookie(name){// expires ist abgelaufen
var now=new Date();var exp=new Date(now.getTime()-1);document.cookie=name+"=;"+"expires="+exp.toGMTString()+";"+"path=/";}},{key:"getCookie",value:function getCookie(name){var cname=name+"=";var dc=document.cookie;if(dc.length>0){var start=dc.indexOf(cname);if(start!=-1){start+=cname.length;var stop=dc.indexOf(";",start);if(stop==-1)stop=dc.length;return unescape(dc.substring(start,stop));}}return null;}// todo cookies dont work with files that are not served by server!?
},{key:"setStyleCookie",value:function setStyleCookie(){//this.setCookie(this.cookie, this.style, this.days);
if(!window.story.state._gm)return;// window.story.state._gm might not yet exist
window.story.state._gm.style=this.style;}},{key:"getStyleCookie",value:function getStyleCookie(){//return this.getCookie(this.cookie);
if(!window.story.state._gm)return'default';return window.story.state._gm.style;}},{key:"delStyleCookie",value:function delStyleCookie(){//this.delCookie(this.cookie);
if(!window.story.state._gm)return;window.story.state._gm.style='default';}}]);return StyleSwitcher;}();window.styleSwitcher=new StyleSwitcher();window.styleSwitcher.loadStyle();//window.onload = window.styleSwitcher.loadStyle;
})(window,document);/*! Toasty.js - v1.5.0 - 2018-05-04
* https://jakim.me/Toasty.js/
* Copyright (c) 2015-2018 Jakim Hernández; Licensed MIT */;(function(){'use strict';/**
     * All available default CSS transitions for plug-in:
     *
     * @var array
     */var _transitions=["fade","slideLeftFade","slideLeftRightFade","slideRightFade","slideRightLeftFade","slideUpFade","slideUpDownFade","slideDownFade","slideDownUpFade","pinItUp","pinItDown"];/**
     * Default configuration for plug-in:
     *
     * @var object
     */var _defaults={// STRING: main class name used to styling each toast message with CSS:
// .... IMPORTANT NOTE:
// .... if you change this, the configuration consider that you´re
// .... re-stylized the plug-in and default toast styles, including CSS3 transitions are lost.
classname:"toast",// STRING: name of the CSS transition that will be used to show and hide all toast by default:
transition:"slideLeftRightFade",// BOOLEAN: specifies the way in which the toasts will be inserted in the HTML code:
// .... Set to BOOLEAN TRUE and the toast messages will be inserted before those already generated toasts.
// .... Set to BOOLEAN FALSE otherwise.
insertBefore:true,// INTEGER: duration that the toast will be displayed in milliseconds:
// .... Default value is set to 4000 (4 seconds). 
// .... If it set to 0, the duration for each toast is calculated by text-message length.
duration:4000,// BOOLEAN: enable or disable toast sounds:
// .... Set to BOOLEAN TRUE  - to enable toast sounds.
// .... Set to BOOLEAN FALSE - otherwise.
// NOTE: this is not supported by mobile devices.
enableSounds:false,// BOOLEAN: enable or disable auto hiding on toast messages:
// .... Set to BOOLEAN TRUE  - to enable auto hiding.
// .... Set to BOOLEAN FALSE - disable auto hiding. Instead the user must click on toast message to close it.
autoClose:true,// BOOLEAN: enable or disable the progressbar:
// .... Set to BOOLEAN TRUE  - enable the progressbar only if the autoClose option value is set to BOOLEAN TRUE.
// .... Set to BOOLEAN FALSE - disable the progressbar. 
progressBar:false,// IMPORTANT: mobile browsers does not support this feature!
// Yep, support custom sounds for each toast message when are shown if the
// enableSounds option value is set to BOOLEAN TRUE:
// NOTE: the paths must point from the project's root folder.
sounds:{// path to sound for informational message:
info:"./dist/sounds/info/1.mp3",// path to sound for successfull message:
success:"./dist/sounds/success/1.mp3",// path to sound for warn message:
warning:"./dist/sounds/warning/1.mp3",// path to sound for error message:
error:"./dist/sounds/error/1.mp3"},// callback:
// onShow function will be fired when a toast message appears.
onShow:function onShow(type){},// callback:
// onHide function will be fired when a toast message disappears.
onHide:function onHide(type){},// the placement where prepend the toast container:
prependTo:document.body.childNodes[0]};/**
     * Map to create each necessary CSS classess:
     *
     * @var object
     */var _mappings={container:"{:class-name}-container",mainwrapp:"{:class-name}-wrapper",toasts:{info:"{:class-name}--info",success:"{:class-name}--success",warning:"{:class-name}--warning",error:"{:class-name}--error"},animate:{init:"{:transition}-init",show:"{:transition}-show",hide:"{:transition}-hide"},progressbar:"{:class-name}-progressbar",playerclass:"{:class-name}-soundplayer"};/**
     * A time offset to define the plug-in behavior:
     *
     * @var object
     */var _timeOffset=100;/**
     * A native JS extend() function
     *
     * Returns a new object instead, preserving all of the original objects
     * and their properties. Supported back to IE6.
     *
     * All credits to author.
     * https://gomakethings.com/vanilla-javascript-version-of-jquery-extend/
     *
     * @return object
     */function extend(){var extended={};var deep=false;var i=0;var length=arguments.length;// check if a deep merge
if(Object.prototype.toString.call(arguments[0])==='[object Boolean]'){deep=arguments[0];i++;}// merge the object into the extended object
var merge=function merge(obj){for(var prop in obj){if(Object.prototype.hasOwnProperty.call(obj,prop)===true){// if deep merge and property is an object, merge properties
if(deep&&Object.prototype.toString.call(obj[prop])==='[object Object]')extended[prop]=extend(true,extended[prop],obj[prop]);else extended[prop]=obj[prop];}}};// loop through each object and conduct a merge
for(i;i<length;i++){var obj=arguments[i];merge(obj);}return extended;}/**
     * Simple creation of an Element Node with the specified 'name'.
     *
     * @return HTML Element
     */function node(name){return document.createElement(name||'div');}/**
     * Returns the parent Element or Node from any other HTML Element.
     *
     * @return HTML Element
     */function parentElement(el){return el.parentElement||el.parentNode;}/**
     * Regexp to find a className on a string.
     *
     * @return RegExp Obj
     */function classReg(className){return new RegExp('(^|\\s+)'+className+'(\\s+|$)');}/**
     * Returns a Boolean value, indicating whether an element has
     * the specified class name.
     * 
     * Usage:
     *
     * var exists = containsClass(element, 'className');
     * 
     * @return bool
     */function containsClass(el,className){var fn;if(document.documentElement.classList){fn=function fn(el,className){return el.classList.contains(className);};}else{fn=function fn(el,className){if(!el||!el.className)return false;return el.className.match(classReg(className));};}return fn(el,className);}/**
     * Adds one or more class names to an element.
     * If the specified class already exist, the class will not be added.
     *
     * Usage:
     *
     * addClass(el, 'class1', 'class2', 'class3', ...);
     *
     * @return HTML Element|bool false
     */function addClass(el){var fn;var classNames=arguments;if(classNames.length<=1||_typeof(el)!='object')return false;if(document.documentElement.classList)fn=function fn(el,classNames){for(var i=1;i<classNames.length;i++){if(typeof classNames[i]=='string'){el.classList.add(classNames[i]);}}return el;};else fn=function fn(el,classNames){for(var i=1;i<classNames.length;i++){if(!containsClass(el,classNames[i])&&typeof classNames[i]=='string'){el.className+=(el.className?' ':'')+classNames[i];}}return el;};return fn(el,classNames);}/**
     * Removes one or more class names from an element.
     * Note: Removing a class that does not exist, does NOT throw an error.
     *
     * Usage:
     *
     * removeClass(el, 'class1', 'class2', 'class3', ...);
     *
     * @return HTML Element|bool false
     */function removeClass(el){var fn;var classNames=arguments;if(classNames.length<=1||_typeof(el)!='object')return false;if(document.documentElement.classList)fn=function fn(el,classNames){for(var i=1;i<classNames.length;i++){if(typeof classNames[i]=='string'){el.classList.remove(classNames[i]);}}return el;};else fn=function fn(el,classNames){for(var i=1;i<classNames.length;i++){if(containsClass(el,classNames[i])&&typeof classNames[i]=='string'){el.className=el.className.replace(classReg(classNames[i]),'$2');}}return el;};return fn(el,classNames);}/**
     * Toggles between a class name for an element.
     * 
     * Usage:
     *
     * var result = toggleClass(el, 'className');
     *
     * @return bool
     */function toggleClass(el,className){var fn;if(document.documentElement.classList)fn=function fn(el,className){return el.classList.toggle(className);};else fn=function fn(el,className){var exists=containsClass(el,className);var caller=exists===true?removeClass:addClass;caller(el,className);return!exists;};return fn(el,className);}/**
     * Add Event
     *
     * Attaches an event handler to the document.
     *
     * http://www.thecssninja.com/javascript/handleevent
     *
     * @param  {element}  element
     * @param  {event}    event
     * @param  {Function} fn
     * @param  {boolean}  bubbling
     * @return el
     */function addEvent(el,evt,fn,bubble){if('addEventListener'in el){// BBOS6 doesn't support handleEvent, catch and polyfill:
try{el.addEventListener(evt,fn,bubble);}catch(e){if(_typeof(fn)==='object'&&fn.handleEvent){el.addEventListener(evt,function(e){// bind fn as this and set first arg as event object:
fn.handleEvent.call(fn,e);},bubble);}else{throw e;}}}else if('attachEvent'in el){// check if the callback is an object and contains handleEvent:
if(_typeof(fn)==='object'&&fn.handleEvent){el.attachEvent('on'+evt,function(){// bind fn as this:
fn.handleEvent.call(fn);});}else{el.attachEvent('on'+evt,fn);}}return el;}/**
     * Remove Event
     *
     * Removes an event handler that has been attached with the 'addEvent' method.
     *
     * http://www.thecssninja.com/javascript/handleevent
     *
     * @param  {element}  element
     * @param  {event}    event
     * @param  {Function} fn
     * @param  {boolean}  bubbling
     * @return el
     */function removeEvent(el,evt,fn,bubble){if('removeEventListener'in el){try{el.removeEventListener(evt,fn,bubble);}catch(e){if(_typeof(fn)==='object'&&fn.handleEvent){el.removeEventListener(evt,function(e){fn.handleEvent.call(fn,e);},bubble);}else{throw e;}}}else if('detachEvent'in el){if(_typeof(fn)==='object'&&fn.handleEvent){el.detachEvent('on'+evt,function(){fn.handleEvent.call(fn);});}else{el.detachEvent('on'+evt,fn);}}return el;}/**
     * Detect the property name of supported transition event.
     * 
     * Function from David Walsh:
     * http://davidwalsh.name/css-animation-callback
     *
     * @return string|undefined (if transitions not supported by client)
     */function whichTransitionEvent(){var t,el=node('transitionElement');var transitions={WebkitTransition:'webkitTransitionEnd',MozTransition:'transitionend',OTransition:'oTransitionEnd otransitionend',transition:'transitionend'};for(t in transitions){if(el.style[t]!==undefined){return transitions[t];}}}/**
     * Calculates the auto close duration to be set in
     * each toast message:
     * 
     * @return number
     */function getAutoCloseDuration(message,duration,settings){duration=duration||settings.duration;if(duration==0)duration=message.length*(_timeOffset/2);return Math.floor(duration);}/**
     * Replace each object values with a map of key => values:
     *
     * @return object
     */function walker(obj,map){for(var o in obj){if(obj.hasOwnProperty(o)===true){// ini loop:
switch(_typeof(obj[o])){case'object':walker(obj[o],map);break;case'string':for(var m in map){if(map.hasOwnProperty(m)===true){obj[o]=obj[o].replace(m,map[m]);}}break;}// end loop.
}}return obj;}/**
     * Generate an HTML audio instance for each type of
     * toast message:
     *
     * @return void
     */var playSound=function playSound(type,container,sounds,playerclass){var sound=sounds[type],audio=addClass(node('audio'),playerclass);addEvent(audio,'ended',function(){var parent=parentElement(this);this.remove();// also, remove the main container if it empty:
if(parent.childNodes.length<1)parentElement(parent).remove();});audio.setAttribute('autoplay','autoplay');audio.innerHTML='<source src="'+sound+'" type="audio/mpeg"/>'+'<embed hidden="true" autoplay="false" loop="false" src="'+sound+'" />';parentElement(container).appendChild(audio);};/**
     * Show the toast message with an CSS3 transition
     * if transition event is supported:
     *
     * @return void
     */var showToast=function showToast(type,el,container,animate,duration,insertBefore,callback){var timer=0;var delay=function delay(callback,ms){clearTimeout(timer);timer=setTimeout(callback,ms);};var onShowToast=function onShowToast(e){removeEvent(e.target,e.type,onShowToast,false);if(typeof callback=='function')callback(type);};var show=function show(){var transitionEvent=whichTransitionEvent();if(transitionEvent!==undefined){// initialize the CSS transition event:
addEvent(el,transitionEvent,onShowToast,false);}else{// navigator does not support transition events:
if(typeof callback=='function')callback(type);}addClass(el,animate.show);};// insert in the DOM and show toast:
var beforeNode=container.childNodes;beforeNode=beforeNode[insertBefore===true?0:beforeNode.length];container.insertBefore(el,beforeNode);delay(show,_timeOffset);};/**
     * Hide the toast message with an CSS3 transition
     * if transition event is supported:
     *
     * @return void
     */var hideToast=function hideToast(type,el,duration,animate,callback){var timer=0;var delay=function delay(callback,ms){clearTimeout(timer);timer=setTimeout(callback,ms);};var onHideToast=function onHideToast(e){removeEvent(e.target,e.type,onHideToast,false);remove();if(typeof callback=='function')callback(type);};var remove=function remove(){var container=parentElement(el);// the wrapper.
el.remove();var num=container.childNodes.length;if(num<1){parentElement(container).remove();}};var hide=function hide(){var transitionEvent=whichTransitionEvent();if(transitionEvent!==undefined){// initialize the CSS transition event:
addEvent(el,transitionEvent,onHideToast,false);}else{// navigator does not support transition events:
remove();if(typeof callback=='function')callback(type);}addClass(el,animate.hide);};delay(hide,_timeOffset*10+duration);};/**
     * Hide the toast message with an CSS3 transition when
     * the user clicks on the message:
     *
     * @return void
     */var hideToastOnClick=function hideToastOnClick(type,el,animate,callback,class2close){var hideOnClick=function hideOnClick(e){e.stopPropagation();removeClass(el,class2close);hideToast(type,el,0,animate,callback);};addClass(el,class2close);addEvent(el,'click',hideOnClick);};/**
     * The progressbar:
     *
     * @return void
     */var showProgressBar=function showProgressBar(type,el,duration,transition){var timer=0;var delay=function delay(callback,ms){clearTimeout(timer);timer=setTimeout(callback,ms);};var progressbar=function progressbar(){var progressBar=addClass(node('div'),transition.progressbar,transition.progressbar+'--'+type);el.appendChild(progressBar);var iterat=0,offset=0;var interval=setInterval(function(){iterat++;offset=Math.round(1000*iterat/duration);if(offset>100){clearInterval(interval);}else{progressBar.style.width=offset+'%';}},10);};delay(progressbar,_timeOffset*10);};/**
     * Register a new transition only:
     *
     * @return string
     */var registerTransition=function registerTransition(self,name){if(typeof name==="string"){self.classmap[name]=extend(true,_mappings,{});self.classmap[name]=walker(self.classmap[name],{'{:class-name}':self.settings.classname,'{:transition}':name});}return name;};/*!
     * The exposed public object:
     */var Toasty=function Toasty(options){this.settings={};this.classmap={};this.configure(_typeof(options)==='object'?options:{});// add classmap for default transitions:
if(_typeof(_transitions)==='object')for(var key in _transitions){if(_transitions.hasOwnProperty(key)===true){registerTransition(this,_transitions[key]);}}};Toasty.prototype.configure=function(options){this.settings=extend(true,_defaults,this.settings,options);return this;};Toasty.prototype.transition=function(name){this.settings.transition=registerTransition(this,name);return this;};Toasty.prototype.toast=function(type,message,duration){var classes=this.classmap;var options=this.settings;// check if the transition name provided in options
// exists in classes, if not register it:
if(classes.hasOwnProperty(options.transition)===false)registerTransition(this,options.transition);// use the transition name provided in options:
var transition=classes[options.transition];// check if the toast container exists:
var container=null;if(typeof options.transition==='string')container=document.querySelector('.'+transition.container+'--'+options.transition);else container=document.querySelector('.'+transition.container);var containerExists=!!container;if(containerExists){// create the toast container if not exists:
container=container.querySelector('.'+transition.mainwrapp);// use the wrapper instead of main container.
}else{container=addClass(node('div'),transition.container,transition.container+'--'+options.transition);// create a alert wrapper instance:
var wrapp=addClass(node('div'),transition.mainwrapp);// append the alert wrapper and now, this is the main container:
container.appendChild(container=wrapp);}// create a new toast instance
var newToast=addClass(node('div'),options.classname,transition.toasts[type],transition.animate.init);newToast.innerHTML=message;// insert the toast container into the HTML:
if(!containerExists)document.body.insertBefore(parentElement(container),options.prependTo);// OPTIONAL STEP (must be first):
// INI: enable or disable toast sounds.
// --------------------------------------------------------------------
if(options.enableSounds==true)playSound(type,container,options.sounds,transition.playerclass);// --------------------------------------------------------------------
// END: enable or disable toast sounds.
// STEP 1:
// INI: showing the toas message
// --------------------------------------------------------------------
showToast(type,newToast,container,transition.animate,duration,options.insertBefore,options.onShow);// --------------------------------------------------------------------
// END: showing the toas message
// STEP 2:
// INI: prepare the toast to hide it.
// --------------------------------------------------------------------
if(options.autoClose==true)// hide the toast message automatically:
hideToast(type,newToast,duration,transition.animate,options.onHide);else// hide the toast message on click it with an CSS3 transition:
hideToastOnClick(type,newToast,transition.animate,options.onHide,'close-on-click');// --------------------------------------------------------------------
// END: prepare the toast to hide it.
// OPTIONAL STEP (must be last):
// INI: Enable or disable the progressbar.
// --------------------------------------------------------------------
if(options.progressBar==true&&options.autoClose==true)showProgressBar(type,newToast,duration,transition);// --------------------------------------------------------------------
// END: Enable or disable the progressbar.
return this;};Toasty.prototype.info=function(message,duration){duration=getAutoCloseDuration(message,duration,this.settings);this.toast("info",message,duration);};Toasty.prototype.success=function(message,duration){duration=getAutoCloseDuration(message,duration,this.settings);this.toast("success",message,duration);};Toasty.prototype.warning=function(message,duration){duration=getAutoCloseDuration(message,duration,this.settings);this.toast("warning",message,duration);};Toasty.prototype.error=function(message,duration){duration=getAutoCloseDuration(message,duration,this.settings);this.toast("error",message,duration);};// FALLBACK:
// Create Element.remove() function if not exist:
if('remove'in Element.prototype){// the browser supports .remove() function...
}else{Element.prototype.remove=function(){if(this.parentNode)this.parentNode.removeChild(this);};}window.Toasty=Toasty;})(window,document);"use strict";/* Todo:
- feet (talons, paws, hooves)
- horns (antlers, goat)
- ears
*/ /*
 * bodyparts are special equipment 
 * base define the overall body structure; how many legs,..
 * there are some special properties on certain bodyparts:
 * maxGrowth of base = typical bodysize in m; depends on race
 * maxGrowth of other bodyparts = max size of bodypart relative to body size in %/100
 * growth = size of bodypart relative to maxGrowth; modified on mutation event
*/var BodyPart=/*#__PURE__*/function(_Equipment2){_inherits(BodyPart,_Equipment2);var _super9=_createSuper(BodyPart);function BodyPart(name){_classCallCheck(this,BodyPart);return _super9.call(this,name);}/*
    * converts a relative size to size in m or cm
    */_createClass(BodyPart,[{key:"sizeString",value:function sizeString(size){var base=this.parent.getItemForSlot(window.gm.OutfitSlotLib.bBase);var bodysize=base.data.maxGrowth*base.data.growth*size;if(bodysize<1)return window.gm.util.formatNumber(bodysize*100,1)+"cm";if(bodysize<0.05)return window.gm.util.formatNumber(bodysize*1000,0)+"mm";return window.gm.util.formatNumber(bodysize,2)+"m";}}]);return BodyPart;}(Equipment);var BaseBiped=/*#__PURE__*/function(_BodyPart){_inherits(BaseBiped,_BodyPart);var _super10=_createSuper(BaseBiped);function BaseBiped(){var _this10;_classCallCheck(this,BaseBiped);_this10=_super10.call(this,'BaseBiped');_this10.data={femininity:0.2,maxGrowth:1.8,growth:1};_this10.addTags(['body']);_this10.slotUse=['bBase'];return _this10;}_createClass(BaseBiped,[{key:"descLong",value:function descLong(fconv){return fconv('$[I]$ $[have]$ two legs and $[walk]§ upright at a bodysize of around '+this.sizeString(1)+'.');}},{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("BaseBiped",this);}},{key:"descShort",get:function get(){return this.desc;}},{key:"desc",get:function get(){return'';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(BaseBiped,value.data);}}]);return BaseBiped;}(BodyPart);var BaseHumanoid=/*#__PURE__*/function(_BaseBiped){_inherits(BaseHumanoid,_BaseBiped);var _super11=_createSuper(BaseHumanoid);function BaseHumanoid(){var _this11;_classCallCheck(this,BaseHumanoid);_this11=_super11.call(this);_this11.id=_this11.name='BaseHumanoid';_this11.data={femininity:0.2,maxGrowth:1.8,growth:1};return _this11;}_createClass(BaseHumanoid,[{key:"descLong",value:function descLong(fconv){return fconv('$[My]$ body is that of an human, around '+this.sizeString(1)+' in size.');}},{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("BaseHumanoid",this);}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(BaseHumanoid,value.data);}}]);return BaseHumanoid;}(BaseBiped);var BaseQuadruped=/*#__PURE__*/function(_BodyPart2){_inherits(BaseQuadruped,_BodyPart2);var _super12=_createSuper(BaseQuadruped);function BaseQuadruped(){var _this12;_classCallCheck(this,BaseQuadruped);_this12=_super12.call(this,'BaseQuadruped');_this12.data={femininity:0.2,maxGrowth:1.5,growth:1};_this12.addTags(['body']);_this12.slotUse=['bBase'];return _this12;}_createClass(BaseQuadruped,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("BaseQuadruped",this);}},{key:"descLong",value:function descLong(fconv){return fconv('$[I]$ $[am]$ walking on 4 legs like a feral animal.');}},{key:"descShort",get:function get(){return this.desc;}},{key:"desc",get:function get(){return'';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(BaseQuadruped,value.data);}}]);return BaseQuadruped;}(BodyPart);var BaseWorm=/*#__PURE__*/function(_BodyPart3){_inherits(BaseWorm,_BodyPart3);var _super13=_createSuper(BaseWorm);function BaseWorm(){var _this13;_classCallCheck(this,BaseWorm);_this13=_super13.call(this,'BaseWorm');_this13.data={femininity:0.2,maxGrowth:0.3,growth:1};_this13.addTags(['body']);_this13.slotUse=['bBase'];return _this13;}_createClass(BaseWorm,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("BaseWorm",this);}},{key:"descLong",value:function descLong(fconv){return fconv('$[I]$ $[am]$ wriggling around like a snake.');}},{key:"descShort",get:function get(){return this.desc;}},{key:"desc",get:function get(){return'';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(BaseWorm,value.data);}}]);return BaseWorm;}(BodyPart);var BaseInsect=/*#__PURE__*/function(_BodyPart4){_inherits(BaseInsect,_BodyPart4);var _super14=_createSuper(BaseInsect);function BaseInsect(){var _this14;_classCallCheck(this,BaseInsect);_this14=_super14.call(this,'BaseInsect');_this14.data={femininity:0.2,maxGrowth:0.3,growth:1};_this14.addTags(['body']);_this14.slotUse=['bBase'];return _this14;}_createClass(BaseInsect,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("BaseInsect",this);}},{key:"descLong",value:function descLong(fconv){return fconv('$[My]$ body is like that of an insect.');}},{key:"descShort",get:function get(){return this.desc;}},{key:"desc",get:function get(){return'';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(BaseInsect,value.data);}}]);return BaseInsect;}(BodyPart);var HeadHairHuman=/*#__PURE__*/function(_BodyPart5){_inherits(HeadHairHuman,_BodyPart5);var _super15=_createSuper(HeadHairHuman);_createClass(HeadHairHuman,null,[{key:"dataPrototype",value:function dataPrototype(){return{growth:0.05,maxGrowth:0.3,style:'smooth'};//length relative to bBase
}},{key:"factory",value:function factory(id){var obj=new HeadHairHuman();obj.setStyle(id,"dark brown");return obj;}}]);function HeadHairHuman(){var _this15;_classCallCheck(this,HeadHairHuman);_this15=_super15.call(this,'HeadHairHuman');_this15.addTags(['body']);_this15.slotUse=['bHeadHair'];_this15.data=HeadHairHuman.dataPrototype();return _this15;}_createClass(HeadHairHuman,[{key:"setStyle",value:function setStyle(id){var color=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'dark grey';this.data.style=id;this.data.color=color;switch(id){case'smooth':case'wavy':case'shaggy':case'curled':break;default:throw new Error("unknown Hair-style "+id);}}},{key:"getStyle",value:function getStyle(){return this.data.style;}},{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("HeadHairHuman",this);}},{key:"descLong",value:function descLong(fconv){return fconv('$[You]$ $[have]$ '+this.data.color+', '+this.data.style+' hair that is around '+this.sizeString(this.data.growth*this.data.maxGrowth)+' long.');}},{key:"descShort",get:function get(){return'human hair';}},{key:"desc",get:function get(){return this.data.style+' hair';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(HeadHairHuman,value.data);}}]);return HeadHairHuman;}(BodyPart);var FaceHuman=/*#__PURE__*/function(_BodyPart6){_inherits(FaceHuman,_BodyPart6);var _super16=_createSuper(FaceHuman);_createClass(FaceHuman,null,[{key:"dataPrototype",value:function dataPrototype(){return{femininity:0.2,style:'human'};//1 = full female 0= male
}},{key:"factory",value:function factory(id){var obj=new FaceHuman();obj.setStyle(id);return obj;}}]);function FaceHuman(){var _this16;_classCallCheck(this,FaceHuman);_this16=_super16.call(this,'FaceHuman');_this16.addTags(['body']);_this16.slotUse=['bFace','bMouth'];_this16.data=FaceHuman.dataPrototype();return _this16;}_createClass(FaceHuman,[{key:"setStyle",value:function setStyle(id){this.data.style=id;switch(id){case'human':break;case'elve':break;case'imp':break;default:throw new Error("unknown Face-style "+id);}}},{key:"getStyle",value:function getStyle(){return this.data.style;}},{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("FaceHuman",this);}},{key:"descLong",value:function descLong(fconv){return fconv('$[My]$ face ressembles that of a '+this.data.style+'.');}},{key:"descShort",get:function get(){return'human face';}},{key:"desc",get:function get(){return'hominid face';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(FaceHuman,value.data);}}]);return FaceHuman;}(BodyPart);var FaceWolf=/*#__PURE__*/function(_BodyPart7){_inherits(FaceWolf,_BodyPart7);var _super17=_createSuper(FaceWolf);_createClass(FaceWolf,null,[{key:"dataPrototype",value:function dataPrototype(){return{style:'wolf',femininity:0.2};}},{key:"factory",value:function factory(id){var obj=new FaceWolf();obj.setStyle(id);return obj;}}]);function FaceWolf(){var _this17;_classCallCheck(this,FaceWolf);_this17=_super17.call(this,'FaceWolf');_this17.addTags(['body']);_this17.slotUse=['bFace','bMouth'];//todo separate mouth-bodypart??
_this17.data=FaceWolf.dataPrototype();return _this17;}_createClass(FaceWolf,[{key:"setStyle",value:function setStyle(id){this.data.style=id;switch(id){case'cat':case'dog':case'fox':case'wolf':case'lizard':break;case'horse':break;default:throw new Error("unknown Face-style "+id);}}},{key:"getStyle",value:function getStyle(){return this.data.style;}},{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("FaceWolf",this);}},{key:"onEquip",value:function onEquip(context){var old=context.parent.Skills.countItem(SkillBite.name);if(old>0)context.parent.Skills.removeItem(SkillBite.name,old);context.parent.Skills.addItem(new SkillBite());return{OK:true,msg:'shifted'};}},{key:"onUnequip",value:function onUnequip(){var old=this.parent.parent.Skills.countItem(SkillBite.name);if(old>0)this.parent.parent.Skills.removeItem(SkillBite.name,old);return{OK:true,msg:'shifted'};}},{key:"descLong",value:function descLong(fconv){return fconv('$[I]$ $[have]$ a muzzle like a '+this.data.style+'.');}},{key:"attackMod",value:function attackMod(target){var mod=new SkillMod();mod.onHit=[{target:target,eff:[effDamage.factory(11,'slash')]}];//bite damage
return mod;}},{key:"descShort",get:function get(){return this.desc;}},{key:"desc",get:function get(){return this.data.style+'\'like face.';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(FaceWolf,value.data);}}]);return FaceWolf;}(BodyPart);var FaceHorse=/*#__PURE__*/function(_BodyPart8){_inherits(FaceHorse,_BodyPart8);var _super18=_createSuper(FaceHorse);_createClass(FaceHorse,null,[{key:"dataPrototype",value:function dataPrototype(){return{femininity:0.2,style:'horse'};}},{key:"factory",value:function factory(id){return new FaceHorse();}}]);function FaceHorse(){var _this18;_classCallCheck(this,FaceHorse);_this18=_super18.call(this,'FaceHorse');_this18.addTags(['body']);_this18.slotUse=['bFace','bMouth'];_this18.data=FaceHorse.dataPrototype();return _this18;}_createClass(FaceHorse,[{key:"setStyle",value:function setStyle(id){this.data.style=id;switch(id){case'bunny':case'horse':break;case'deer':break;default:throw new Error("unknown Face-style "+id);}}},{key:"getStyle",value:function getStyle(){return this.data.style;}},{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("FaceHorse",this);}},{key:"descLong",value:function descLong(fconv){return fconv('$[I]$ $[have]$ a muzzle like a '+this.data.style);}},{key:"descShort",get:function get(){return this.data.style+' muzzle';}},{key:"desc",get:function get(){return this.descShort;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(FaceHorse,value.data);}}]);return FaceHorse;}(BodyPart);var FaceLeech=/*#__PURE__*/function(_BodyPart9){_inherits(FaceLeech,_BodyPart9);var _super19=_createSuper(FaceLeech);_createClass(FaceLeech,null,[{key:"dataPrototype",value:function dataPrototype(){return{style:'leech'};}},{key:"factory",value:function factory(id){var obj=new FaceLeech();obj.setStyle(id);return obj;}}]);function FaceLeech(){var _this19;_classCallCheck(this,FaceLeech);_this19=_super19.call(this,'FaceLeech');_this19.addTags(['body']);_this19.slotUse=['bFace','bMouth'];_this19.data=FaceLeech.dataPrototype();return _this19;}_createClass(FaceLeech,[{key:"setStyle",value:function setStyle(id){this.data.style=id;switch(id){case'slug':break;case'leech':break;default:throw new Error("unknown Face-style "+id);}}},{key:"getStyle",value:function getStyle(){return this.data.style;}},{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("FaceLeech",this);}},{key:"onEquip",value:function onEquip(context){var old=context.parent.Skills.countItem(SkillBite.name);if(old>0)context.parent.Skills.removeItem(SkillBite.name,old);context.parent.Skills.addItem(new SkillBite());return{OK:true,msg:'shifted'};}},{key:"onUnequip",value:function onUnequip(){var old=this.parent.parent.Skills.countItem(SkillBite.name);if(old>0)this.parent.parent.Skills.removeItem(SkillBite.name,old);return{OK:true,msg:'shifted'};}},{key:"descLong",value:function descLong(fconv){return fconv('$[I]$ $[have]$ a mouth like a '+this.data.style+'.');}},{key:"attackMod",value:function attackMod(target){var mod=new SkillMod();if(this.data.style==='slug'){mod.onHit=[{target:target,eff:[effDamage.factory(5,'acid',1,'The slug spits some acid that eats at '+target.name+' armor.')]}];}else{mod.onHit=[{target:target,eff:[effDamage.factory(5,'acid')]}];}return mod;}},{key:"descShort",get:function get(){return this.desc;}},{key:"desc",get:function get(){return this.data.style+'\'like face.';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(FaceLeech,value.data);}}]);return FaceLeech;}(BodyPart);var FaceInsect=/*#__PURE__*/function(_BodyPart10){_inherits(FaceInsect,_BodyPart10);var _super20=_createSuper(FaceInsect);_createClass(FaceInsect,null,[{key:"dataPrototype",value:function dataPrototype(){return{style:'wasp'};}},{key:"factory",value:function factory(id){var obj=new FaceInsect();obj.setStyle(id);return obj;}}]);function FaceInsect(){var _this20;_classCallCheck(this,FaceInsect);_this20=_super20.call(this,'FaceInsect');_this20.addTags(['body']);_this20.slotUse=['bFace','bMouth'];_this20.data=FaceInsect.dataPrototype();return _this20;}_createClass(FaceInsect,[{key:"setStyle",value:function setStyle(id){this.data.style=id;switch(id){case'wasp':break;case'bug':break;case'spider':break;default:throw new Error("unknown Face-style "+id);}}},{key:"getStyle",value:function getStyle(){return this.data.style;}},{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("FaceInsect",this);}},{key:"onEquip",value:function onEquip(context){var old=context.parent.Skills.countItem(SkillBite.name);if(old>0)context.parent.Skills.removeItem(SkillBite.name,old);context.parent.Skills.addItem(new SkillBite());return{OK:true,msg:'shifted'};}},{key:"onUnequip",value:function onUnequip(){var old=this.parent.parent.Skills.countItem(SkillBite.name);if(old>0)this.parent.parent.Skills.removeItem(SkillBite.name,old);return{OK:true,msg:'shifted'};}},{key:"descLong",value:function descLong(fconv){return fconv('$[I]$ $[have]$ mandibles like a '+this.data.style+'.');}},{key:"attackMod",value:function attackMod(target){var mod=new SkillMod();mod.onHit=[{target:target,eff:[effDamage.factory(5,'blunt')]}];return mod;}},{key:"descShort",get:function get(){return this.desc;}},{key:"desc",get:function get(){return this.data.style+'\'like face.';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(FaceInsect,value.data);}}]);return FaceInsect;}(BodyPart);var FaceBird=/*#__PURE__*/function(_BodyPart11){_inherits(FaceBird,_BodyPart11);var _super21=_createSuper(FaceBird);_createClass(FaceBird,null,[{key:"dataPrototype",value:function dataPrototype(){return{style:'hawk'};}},{key:"factory",value:function factory(id){var obj=new FaceBird();obj.setStyle(id);return obj;}}]);function FaceBird(){var _this21;_classCallCheck(this,FaceBird);_this21=_super21.call(this,'FaceBird');_this21.addTags(['body']);_this21.slotUse=['bFace','bMouth'];_this21.data=FaceBird.dataPrototype();return _this21;}_createClass(FaceBird,[{key:"setStyle",value:function setStyle(id){this.data.style=id;switch(id){case'wasp':break;case'bug':break;default:throw new Error("unknown Face-style "+id);}}},{key:"getStyle",value:function getStyle(){return this.data.style;}},{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("FaceBird",this);}},{key:"onEquip",value:function onEquip(context){var old=context.parent.Skills.countItem(SkillBite.name);if(old>0)context.parent.Skills.removeItem(SkillBite.name,old);context.parent.Skills.addItem(new SkillBite());return{OK:true,msg:'shifted'};}},{key:"onUnequip",value:function onUnequip(){var old=this.parent.parent.Skills.countItem(SkillBite.name);if(old>0)this.parent.parent.Skills.removeItem(SkillBite.name,old);return{OK:true,msg:'shifted'};}},{key:"descLong",value:function descLong(fconv){return fconv('$[I]$ $[have]$ a beak like a '+this.data.style+'.');}},{key:"attackMod",value:function attackMod(target){var mod=new SkillMod();mod.onHit=[{target:target,eff:[effDamage.factory(5,'blunt')]}];return mod;}},{key:"descShort",get:function get(){return this.desc;}},{key:"desc",get:function get(){return this.data.style+'\'like face.';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(FaceBird,value.data);}}]);return FaceBird;}(BodyPart);/**
 * natural Armor for creatures not using gear
 *
 * @class ArmorTorso
 * @extends {BodyPart}
 */var ArmorTorso=/*#__PURE__*/function(_BodyPart12){_inherits(ArmorTorso,_BodyPart12);var _super22=_createSuper(ArmorTorso);_createClass(ArmorTorso,null,[{key:"dataPrototype",value:function dataPrototype(){return{style:'scales'};}},{key:"factory",value:function factory(id){var obj=new ArmorTorso();obj.setStyle(id);return obj;}}]);function ArmorTorso(){var _this22;_classCallCheck(this,ArmorTorso);_this22=_super22.call(this,'ArmorTorso');_this22.addTags(['body']);_this22.slotUse=['Breast','Stomach'];_this22.data=ArmorTorso.dataPrototype();return _this22;}_createClass(ArmorTorso,[{key:"setStyle",value:function setStyle(id){this.data.style=id;switch(id){case'scales':break;case'slime':break;case'fur':break;case'chitin':break;case'feathers':break;default:throw new Error("unknown Armor-style "+id);}}},{key:"getStyle",value:function getStyle(){return this.data.style;}},{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("ArmorTorso",this);}},{key:"descLong",value:function descLong(fconv){return fconv('$[My]$ body is covered with '+this.data.style+'.');}},{key:"onEquip",value:function onEquip(context){var arm,rst;var _iterator86=_createForOfIteratorHelper(window.gm.combat.TypesDamage),_step86;try{for(_iterator86.s();!(_step86=_iterator86.n()).done;){var n=_step86.value;arm=rst=0;if(this.data.style==='slime'){if(n.id==='fire'||n.id==='poison'||n.id==='acid')arm=5,rst=70;}else if(this.data.style==='fur'||this.data.style==='feathers'){if(n.id==='ice')arm=5,rst=30;if(n.id==='blunt')arm=5,rst=20;}else if(this.data.style==='scales'||this.data.style==='chitin'){if(n.id==='ice')rst=-30;if(n.id==='slash')arm=5,rst=20;}if(arm!==0)context.parent.Stats.addModifier('arm_'+n.id,{id:'arm_'+n.id+':'+this.id,bonus:arm});if(rst!==0)context.parent.Stats.addModifier('rst_'+n.id,{id:'rst_'+n.id+':'+this.id,bonus:rst});}}catch(err){_iterator86.e(err);}finally{_iterator86.f();}return{OK:true,msg:'equipped'};}},{key:"onUnequip",value:function onUnequip(){var _iterator87=_createForOfIteratorHelper(window.gm.combat.TypesDamage),_step87;try{for(_iterator87.s();!(_step87=_iterator87.n()).done;){var n=_step87.value;context.parent.Stats.removeModifier('arm_'+n,{id:'arm_'+n+':'+this.id});context.parent.Stats.removeModifier('rst_'+n,{id:'rst_'+el+':'+this.id});}}catch(err){_iterator87.e(err);}finally{_iterator87.f();}return{OK:true,msg:'unequipped'};}},{key:"descShort",get:function get(){return this.desc;}},{key:"desc",get:function get(){'The '+this.data.style+' improves resistance.';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(ArmorTorso,value.data);}}]);return ArmorTorso;}(BodyPart);var WeaponStinger=/*#__PURE__*/function(_BodyPart13){_inherits(WeaponStinger,_BodyPart13);var _super23=_createSuper(WeaponStinger);_createClass(WeaponStinger,null,[{key:"dataPrototype",value:function dataPrototype(){return{style:'wasplike',skill:''};}},{key:"factory",value:function factory(id){var obj=new WeaponStinger();obj.setStyle(id);return obj;}}]);function WeaponStinger(){var _this23;_classCallCheck(this,WeaponStinger);_this23=_super23.call(this,'WeaponStinger');_this23.addTags(['body']);_this23.slotUse=['bTailBase'];_this23.data=WeaponStinger.dataPrototype();return _this23;}_createClass(WeaponStinger,[{key:"setStyle",value:function setStyle(id){this.data.style=id;switch(id){case'wasplike':this.data.skill='wasp-stinger';this.slotUse=['bTailBase'];break;default:throw new Error("unknown Stinger-style "+id);}}},{key:"getStyle",value:function getStyle(){return this.data.style;}},{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("WeaponStinger",this);}},{key:"descLong",value:function descLong(fconv){return fconv('$[I]$ $[have]$ a '+this.data.style+' sting.');}},{key:"onEquip",value:function onEquip(context){var old=context.parent.Skills.countItem(this.data.skill);if(old>0)context.parent.Skills.removeItem(this.data.skill,old);context.parent.Skills.addItem(SkillSting.factory(this.data.skill));return{OK:true,msg:'shifted'};}},{key:"onUnequip",value:function onUnequip(){var old=this.parent.parent.Skills.countItem(this.data.skill);if(old>0)this.parent.parent.Skills.removeItem(this.data.skill,old);return{OK:true,msg:'shifted'};}},{key:"attackMod",value:function attackMod(target){var mod=new SkillMod();var _eff=[],_dmg=4,_poison=0;if(this.data.style==='wasplike')_poison+=4;_eff.push(effDamage.factory(_dmg,'pierce',1,this.parent.parent.name+' pokes its '+this.data.style+' stinger into '+target.name+'. '));if(_poison>0)_eff.push(effDamage.factory(_poison,'poison',3,target.name+" got poisoned."));mod.onHit=[{target:target,eff:_eff}];return mod;}},{key:"descShort",get:function get(){return this.desc;}},{key:"desc",get:function get(){'A '+this.data.style+' stinger.';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(WeaponStinger,value.data);}}]);return WeaponStinger;}(BodyPart);var WeaponSlobber=/*#__PURE__*/function(_BodyPart14){_inherits(WeaponSlobber,_BodyPart14);var _super24=_createSuper(WeaponSlobber);_createClass(WeaponSlobber,null,[{key:"dataPrototype",value:function dataPrototype(){return{style:'slime',skill:''};}},{key:"factory",value:function factory(id){var obj=new WeaponSlobber();obj.setStyle(id);return obj;}}]);function WeaponSlobber(){var _this24;_classCallCheck(this,WeaponSlobber);_this24=_super24.call(this,'WeaponSlobber');_this24.addTags(['body']);_this24.slotUse=['bTailBase'];_this24.data=WeaponSlobber.dataPrototype();return _this24;}_createClass(WeaponSlobber,[{key:"setStyle",value:function setStyle(id){this.data.style=id;switch(id){case'slime':this.data.skill='slime-slobber';this.slotUse=['bTailBase'];break;default:throw new Error("unknown slobber-style "+id);}}},{key:"getStyle",value:function getStyle(){return this.data.style;}},{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("WeaponSlobber",this);}},{key:"descLong",value:function descLong(fconv){return fconv('$[I]$ $[have]$ a '+this.data.style+' slobber.');}},{key:"onEquip",value:function onEquip(context){var old=context.parent.Skills.countItem(this.data.skill);if(old>0)context.parent.Skills.removeItem(this.data.skill,old);context.parent.Skills.addItem(SkillSlobber.factory(this.data.skill));return{OK:true,msg:'shifted'};}},{key:"onUnequip",value:function onUnequip(){var old=this.parent.parent.Skills.countItem(this.data.skill);if(old>0)this.parent.parent.Skills.removeItem(this.data.skill,old);return{OK:true,msg:'shifted'};}},{key:"attackMod",value:function attackMod(target){var mod=new SkillMod();var _dmg=2;if(this.data.style==='slime')_dmg+=2;mod.onHit=[{target:target,eff:[effDamage.factory(_dmg,'acid',2,this.parent.parent.name+' slobbers '+target.name+' with '+this.data.style+'.')]}];return mod;}},{key:"descShort",get:function get(){return this.desc;}},{key:"desc",get:function get(){'A '+this.data.style+'  slobber.';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(WeaponSlobber,value.data);}}]);return WeaponSlobber;}(BodyPart);var SkinHuman=/*#__PURE__*/function(_BodyPart15){_inherits(SkinHuman,_BodyPart15);var _super25=_createSuper(SkinHuman);_createClass(SkinHuman,null,[{key:"dataPrototype",value:function dataPrototype(){return{style:'human',color:'olive',pattern:'smooth'};}},{key:"factory",value:function factory(id){var obj=new SkinHuman();obj.setStyle(id);return obj;}}]);function SkinHuman(){var _this25;_classCallCheck(this,SkinHuman);_this25=_super25.call(this,'SkinHuman');_this25.addTags(['body']);_this25.slotUse=['bSkin'];_this25.data=SkinHuman.dataPrototype();return _this25;}_createClass(SkinHuman,[{key:"setStyle",value:function setStyle(id){var color=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'pale';this.data.style=id;this.data.color=color;switch(id){case'human':this.data.pattern='smooth';break;case'latex':this.data.pattern='thick';break;default:throw new Error("unknown Skin-style "+id);}}},{key:"getStyle",value:function getStyle(){return this.data.style;}},{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SkinHuman",this);}},{key:"descLong",value:function descLong(fconv){return fconv('$[My]$ body is covered with '+this.data.pattern+' '+this.data.color+' '+this.data.style+' skin.');}},{key:"descShort",get:function get(){return this.desc;}},{key:"desc",get:function get(){'a smooth skin mostly bare of noticable hair.';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkinHuman,value.data);}}]);return SkinHuman;}(BodyPart);var SkinFur=/*#__PURE__*/function(_BodyPart16){_inherits(SkinFur,_BodyPart16);var _super26=_createSuper(SkinFur);_createClass(SkinFur,null,[{key:"dataPrototype",value:function dataPrototype(){return{style:'wolf',color:'dark grey',pattern:'dense'};}},{key:"factory",value:function factory(id){var obj=new SkinFur();obj.setStyle(id);return obj;}}]);function SkinFur(){var _this26;_classCallCheck(this,SkinFur);_this26=_super26.call(this,'SkinFur');_this26.addTags(['body']);_this26.slotUse=['bSkin'];_this26.data=SkinFur.dataPrototype();return _this26;}_createClass(SkinFur,[{key:"setStyle",value:function setStyle(id){var color=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'dark grey';this.data.style=id;this.data.color=color;switch(id){case'cat':case'bunny':case'fox':this.data.pattern='fine';break;case'dog':this.data.pattern='spotted';break;case'horse':this.data.pattern='short';break;case'wolf':this.data.pattern='rough';break;default:throw new Error("unknown Fur-style "+id);}}},{key:"getStyle",value:function getStyle(){return this.data.style;}},{key:"toJSON",//todo color
value:function toJSON(){return window.storage.Generic_toJSON("SkinFur",this);}},{key:"descLong",value:function descLong(fconv){return fconv('A '+this.data.pattern+', '+this.data.color+' fur covers $[my]$ body.');}},{key:"descShort",get:function get(){return this.desc;}},{key:"desc",get:function get(){'a dense fur covering the whole body.';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkinFur,value.data);}}]);return SkinFur;}(BodyPart);var SkinFeathers=/*#__PURE__*/function(_BodyPart17){_inherits(SkinFeathers,_BodyPart17);var _super27=_createSuper(SkinFeathers);_createClass(SkinFeathers,null,[{key:"dataPrototype",value:function dataPrototype(){return{style:'bird',color:'dark grey',pattern:'smooth'};}},{key:"factory",value:function factory(id){var obj=new SkinFeathers();obj.setStyle(id);return obj;}}]);function SkinFeathers(){var _this27;_classCallCheck(this,SkinFeathers);_this27=_super27.call(this,'SkinFeathers');_this27.addTags(['body']);_this27.slotUse=['bSkin'];_this27.data=SkinFeathers.dataPrototype();return _this27;}_createClass(SkinFeathers,[{key:"setStyle",value:function setStyle(id){var color=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'dark grey';this.data.style=id;this.data.color=color;switch(id){case('bird','hawk'):this.data.pattern='fine';break;default:throw new Error("unknown Feather-style "+id);}}},{key:"getStyle",value:function getStyle(){return this.data.style;}},{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SkinFeathers",this);}},{key:"descLong",value:function descLong(fconv){return fconv('A '+this.data.pattern+', '+this.data.color+' layer of feathers covers $[my]$ body.');}},{key:"descShort",get:function get(){return this.desc;}},{key:"desc",get:function get(){'a fine coat of feathers cover the body.';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkinFeathers,value.data);}}]);return SkinFeathers;}(BodyPart);var SkinScales=/*#__PURE__*/function(_BodyPart18){_inherits(SkinScales,_BodyPart18);var _super28=_createSuper(SkinScales);_createClass(SkinScales,null,[{key:"dataPrototype",value:function dataPrototype(){return{style:'lizard',color:'dark green',pattern:'smooth'};}},{key:"factory",value:function factory(id){var obj=new SkinScales();obj.setStyle(id);return obj;}}]);function SkinScales(){var _this28;_classCallCheck(this,SkinScales);_this28=_super28.call(this,'SkinScales');_this28.addTags(['body']);_this28.slotUse=['bSkin'];_this28.data=SkinScales.dataPrototype();return _this28;}_createClass(SkinScales,[{key:"setStyle",value:function setStyle(id){var color=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'dark grey';this.data.style=id;this.data.color=color;switch(id){case'lizard':this.data.pattern='smooth';break;default:throw new Error("unknown Fur-style "+id);}}},{key:"getStyle",value:function getStyle(){return this.data.style;}},{key:"toJSON",//todo color
value:function toJSON(){return window.storage.Generic_toJSON("SkinScales",this);}},{key:"descLong",value:function descLong(fconv){return fconv('$[My]$ body is covered in '+this.data.pattern+', '+this.data.color+' scales.');}},{key:"descShort",get:function get(){return this.desc;}},{key:"desc",get:function get(){'scales like a eptile.';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkinScales,value.data);}}]);return SkinScales;}(BodyPart);var TailWolf=/*#__PURE__*/function(_BodyPart19){_inherits(TailWolf,_BodyPart19);var _super29=_createSuper(TailWolf);_createClass(TailWolf,null,[{key:"dataPrototype",value:function dataPrototype(){return{style:'wolf',growth:0.1,maxGrowth:1.5};}},{key:"factory",value:function factory(id){var obj=new TailWolf();obj.setStyle(id);return obj;}}]);function TailWolf(){var _this29;_classCallCheck(this,TailWolf);_this29=_super29.call(this,'TailWolf');_this29.addTags(['body']);_this29.slotUse=['bTailBase'];_this29.data=TailWolf.dataPrototype();return _this29;}_createClass(TailWolf,[{key:"setStyle",value:function setStyle(id){this.data.style=id;switch(id){case'cat':case'dog':case'fox':case'horse':case'wolf':this.data.growth=0.10;//in %/100 maxGrowth
this.data.maxGrowth=1.2;//in meter, todo depends on bodysize
break;case'bunny':this.data.growth=0.40;//in %/100 maxGrowth
this.data.maxGrowth=0.2;//in meter, todo depends on bodysize
case'human':this.data.growth=1;this.data.maxGrowth=0.0;//todo no tail??
default:throw new Error("unknown Tail-style "+id);}}},{key:"getStyle",value:function getStyle(){return this.data.style;}},{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("TailWolf",this);}},{key:"descLong",value:function descLong(fconv){return fconv('Some '+this.data.style+'-tail is attached to $[my]$ spine.');}},{key:"descShort",get:function get(){return this.desc;}},{key:"desc",get:function get(){var msg='';switch(this.data.style){case'cat':msg='a flexible,furred tail like that of a cat.';break;default:msg=this.data.style+'\'like tail.';}return msg;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(TailWolf,value.data);}}]);return TailWolf;}(BodyPart);var TailSnake=/*#__PURE__*/function(_BodyPart20){_inherits(TailSnake,_BodyPart20);var _super30=_createSuper(TailSnake);_createClass(TailSnake,null,[{key:"dataPrototype",value:function dataPrototype(){return{style:'snake',growth:0.2,maxGrowth:2};}},{key:"factory",value:function factory(id){var obj=new TailSnake();obj.setStyle(id);return obj;}}]);function TailSnake(){var _this30;_classCallCheck(this,TailSnake);_this30=_super30.call(this,'TailSnake');_this30.addTags(['body']);_this30.slotUse=['bTailBase'];_this30.data=TailSnake.dataPrototype();return _this30;}_createClass(TailSnake,[{key:"setStyle",value:function setStyle(id){this.data.style=id;switch(id){case'snake':case'naga':this.data.growth=0.10;//in %/100 maxGrowth
this.data.maxGrowth=2.0;//in meter, todo depends on bodysize
break;case'lizard':this.data.growth=0.10;//in %/100 maxGrowth
this.data.maxGrowth=1.2;//in meter, todo depends on bodysize
break;default:throw new Error("unknown Tail-style "+id);}}},{key:"getStyle",value:function getStyle(){return this.data.style;}},{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("TailSnake",this);}},{key:"descLong",value:function descLong(fconv){return fconv('Some '+this.data.style+'-tail is attached to $[my]$ spine.');}},{key:"attackMod",value:function attackMod(target){var mod=new SkillMod();var _dmg=5;if(this.data.style==='naga')_dmg+=5;mod.onHit=[{target:target,eff:[effDamage.factory(_dmg,'blunt')]}];mod.onCrit=[{target:target,eff:[effDamage.factory(_dmg,'blunt'),effStunned.factory()]}];return mod;}},{key:"descShort",get:function get(){return this.desc;}},{key:"desc",get:function get(){var msg='';switch(this.data.style){case'naga':msg='a meaty snake-like appendage.';break;default:msg=this.data.style+'\'like tail.';}return msg;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(TailSnake,value.data);}}]);return TailSnake;}(BodyPart);var HandsPaw=/*#__PURE__*/function(_BodyPart21){_inherits(HandsPaw,_BodyPart21);var _super31=_createSuper(HandsPaw);_createClass(HandsPaw,null,[{key:"dataPrototype",//paws of ferals
value:function dataPrototype(){return{style:'wolf'};}},{key:"factory",value:function factory(id){var obj=new HandsPaw();obj.setStyle(id);return obj;}}]);function HandsPaw(){var _this31;_classCallCheck(this,HandsPaw);_this31=_super31.call(this,'HandsPaw');_this31.addTags(['body']);_this31.slotUse=['bHands'];_this31.data=HandsPaw.dataPrototype();return _this31;}_createClass(HandsPaw,[{key:"setStyle",value:function setStyle(id){this.data.style=id;switch(id){case'cat':case'dog':case'fox':case'wolf':case'bunny':case'lizard':break;default:throw new Error("unknown HandsPaw-style "+id);}}},{key:"getStyle",value:function getStyle(){return this.data.style;}},{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("HandsPaw",this);}},{key:"descLong",value:function descLong(fconv){return fconv('$[I]$ $[have]$ paws like that of a '+this.data.style+'.');}},{key:"attackMod",value:function attackMod(target){var mod=new SkillMod();var _dmg=5;if(this.data.style==='cat'||this.data.style==='lizard')_dmg+=5;mod.onHit=[{target:target,eff:[effDamage.factory(_dmg,'slash')]}];mod.onCrit=[{target:target,eff:[effDamage.factory(_dmg,'slash')]}];return mod;}},{key:"descShort",get:function get(){return this.desc;}},{key:"desc",get:function get(){return this.data.style+'\'like paws.';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(HandsPaw,value.data);}}]);return HandsPaw;}(BodyPart);var HandsHoof=/*#__PURE__*/function(_BodyPart22){_inherits(HandsHoof,_BodyPart22);var _super32=_createSuper(HandsHoof);_createClass(HandsHoof,null,[{key:"dataPrototype",//hoves of horse,...
value:function dataPrototype(){return{style:'horse'};}},{key:"factory",value:function factory(id){var obj=new HandsHoof();obj.setStyle(id);return obj;}}]);function HandsHoof(){var _this32;_classCallCheck(this,HandsHoof);_this32=_super32.call(this,'HandsHoof');_this32.addTags(['body']);_this32.slotUse=['bHands'];_this32.data=HandsHoof.dataPrototype();return _this32;}_createClass(HandsHoof,[{key:"setStyle",value:function setStyle(id){this.data.style=id;switch(id){case'horse':case'deer':break;default:throw new Error("unknown HandsHoof-style "+id);}}},{key:"getStyle",value:function getStyle(){return this.data.style;}},{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("HandsHoof",this);}},{key:"descLong",value:function descLong(fconv){return fconv('$[I]$ $[have]$ hoves like that of a '+this.data.style+'.');}},{key:"attackMod",value:function attackMod(target){var mod=new SkillMod();var _dmg=5;if(this.data.style==='horse')_dmg+=5;mod.onHit=[{target:target,eff:[effDamage.factory(_dmg,'blunt')]}];return mod;}},{key:"descShort",get:function get(){return this.desc;}},{key:"desc",get:function get(){return this.data.style+'\'like hoves.';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(HandsHoof,value.data);}}]);return HandsHoof;}(BodyPart);var HandsHuman=/*#__PURE__*/function(_BodyPart23){_inherits(HandsHuman,_BodyPart23);var _super33=_createSuper(HandsHuman);_createClass(HandsHuman,null,[{key:"dataPrototype",//hands with digits to use tools
value:function dataPrototype(){return{style:'human'};}},{key:"factory",value:function factory(id){var obj=new HandsHuman();obj.setStyle(id);return obj;}}]);function HandsHuman(){var _this33;_classCallCheck(this,HandsHuman);_this33=_super33.call(this,'HandsHuman');_this33.addTags(['body']);_this33.slotUse=['bHands'];_this33.data=HandsHuman.dataPrototype();return _this33;}_createClass(HandsHuman,[{key:"setStyle",value:function setStyle(id){this.data.style=id;switch(id){case'dog':case'fox':case'wolf':case'horse':case'bunny':break;case'cat':case'lizard':break;case'human':break;default:throw new Error("unknown Hands-style "+id);}}},{key:"getStyle",value:function getStyle(){return this.data.style;}},{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("HandsHuman",this);}},{key:"descLong",value:function descLong(fconv){var msg='$[My]$ hands look just like any humans.';msg+=['horse','deer'].includes(this.data.style)?this.data.style+'-hoofes adorn the fingertips':'';msg+=['dog','wolf','cat','bunny'].includes(this.data.style)?this.data.style+'-claws adorn the fingertips':'';msg+=['lizard'].includes(this.data.style)?'Large talons grow from their fingertips.':'';return fconv(msg);}},{key:"attackMod",value:function attackMod(target){var mod=new SkillMod();var _dmg=5;if(this.data.style==='cat'||this.data.style==='lizard')_dmg+=5;mod.onHit=[{target:target,eff:[effDamage.factory(_dmg,'blunt')]}];mod.onCrit=[{target:target,eff:[effDamage.factory(_dmg,'blunt')]}];return mod;}},{key:"descShort",get:function get(){return this.desc;}},{key:"desc",get:function get(){return'human like hands.';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(HandsHuman,value.data);}}]);return HandsHuman;}(BodyPart);var Wings=/*#__PURE__*/function(_BodyPart24){_inherits(Wings,_BodyPart24);var _super34=_createSuper(Wings);_createClass(Wings,null,[{key:"dataPrototype",//wings attached to back or as arms  <- todo
value:function dataPrototype(){return{style:'feathered',size:1};//todo flight-skill depends on wing-to-body-size; 1=can fly permanently, <0.5 cant fly, >1.5 can fly fast
}},{key:"factory",value:function factory(id){var obj=new Wings();obj.setStyle(id);return obj;}}]);function Wings(){var _this34;_classCallCheck(this,Wings);_this34=_super34.call(this,'Wings');_this34.addTags(['body']);_this34.slotUse=['bWings'];_this34.data=Wings.dataPrototype();return _this34;}_createClass(Wings,[{key:"setStyle",value:function setStyle(id){this.data.style=id;switch(id){case'chitinous':break;case'leathery':break;case'feathered':break;default:throw new Error("unknown Wings-style "+id);}}},{key:"getStyle",value:function getStyle(){return this.data.style;}},{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("Wings",this);}},{key:"descLong",value:function descLong(fconv){var msg='A pair of '+this.data.style+' wings are located on $[my]$ back.';return fconv(msg);}},{key:"onEquip",value:function onEquip(context){var old=context.parent.Skills.countItem(SkillFly.name);if(old>0)context.parent.Skills.removeItem(SkillFly.name,old);context.parent.Skills.addItem(new SkillFly());return{OK:true,msg:'shifted'};}},{key:"onUnequip",value:function onUnequip(){var old=this.parent.parent.Skills.countItem(SkillFly.name);if(old>0)this.parent.parent.Skills.removeItem(SkillFly.name,old);return{OK:true,msg:'shifted'};}},{key:"descShort",get:function get(){return this.desc;}},{key:"desc",get:function get(){return this.data.style+' wings.';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(Wings,value.data);}}]);return Wings;}(BodyPart);var BreastHuman=/*#__PURE__*/function(_BodyPart25){_inherits(BreastHuman,_BodyPart25);var _super35=_createSuper(BreastHuman);_createClass(BreastHuman,null,[{key:"dataPrototype",value:function dataPrototype(){return{style:'human',growth:0.1,maxGrowth:1.5};}},{key:"factory",value:function factory(id){var obj=new BreastHuman();obj.setStyle(id);return obj;}}]);function BreastHuman(){var _this35;_classCallCheck(this,BreastHuman);_this35=_super35.call(this,'BreastHuman');_this35.addTags(['body']);_this35.slotUse=['bBreast'];_this35.data=BreastHuman.dataPrototype();return _this35;}_createClass(BreastHuman,[{key:"setStyle",value:function setStyle(id){this.data.style=id;switch(id){case'human':case'horse':break;case'cat':case'dog':case'fox':case'wolf':case'bunny':break;case'lizard':break;default:throw new Error("unknown breast-style "+id);}}},{key:"getStyle",value:function getStyle(){return this.data.style;}},{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("BreastHuman",this);}},{key:"descLong",value:function descLong(fconv){return fconv('$[My]$ breasts are small but perky.');}},{key:"descShort",get:function get(){return this.desc;}},{key:"desc",get:function get(){return'some '+this.data.style+' breasts.';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(BreastHuman,value.data);}}]);return BreastHuman;}(BodyPart);var AnusHuman=/*#__PURE__*/function(_BodyPart26){_inherits(AnusHuman,_BodyPart26);var _super36=_createSuper(AnusHuman);_createClass(AnusHuman,null,[{key:"dataPrototype",value:function dataPrototype(){return{virgin:true,wetgen:1,stretch:1,depth:5,spermtype:'',sperm:0};}},{key:"factory",value:function factory(id){var obj=new AnusHuman();obj.setStyle(id);return obj;}}]);function AnusHuman(){var _this36;_classCallCheck(this,AnusHuman);_this36=_super36.call(this,'AnusHuman');_this36.addTags(['body']);_this36.slotUse=['bAnus'];_this36.data=AnusHuman.dataPrototype();return _this36;}_createClass(AnusHuman,[{key:"setStyle",value:function setStyle(id){this.data.style=id;switch(id){case'human':case'bird':case'cat':case'dog':case'fox':case'horse':case'wolf':case'bunny':case'lizard':break;default:throw new Error("unknown anus-style "+id);}}},{key:"getStyle",value:function getStyle(){return this.data.style;}},{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("AnusHuman",this);}},{key:"descLong",value:function descLong(fconv){var msg="$[My]$ anus can snuggly fit around "+this.data.stretch+"cm in diameter and "+this.data.depth+"cm in depth.";if(this.data.spermtype!==''){msg+=this.data.sperm+"ml of sperm from a "+this.data.spermtype+" might be deposited in $[my]$ bum.";}return fconv(msg);}},{key:"addSperm",value:function addSperm(type,amount){if(amount>this.data.sperm||this.data.spermtype){this.data.spermtype=type;}this.data.sperm+=amount;}},{key:"removeSperm",value:function removeSperm(amount){if(amount>0){this.data.sperm-=amount;}else this.data.sperm=0;if(this.data.sperm<=0){this.data.sperm=0;this.data.spermtype='';}}},{key:"descShort",get:function get(){return this.data.style+' hole';}},{key:"desc",get:function get(){return'tailhole';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(AnusHuman,value.data);}}]);return AnusHuman;}(BodyPart);//variation: snatch - cooch - slit - cunt - cooter - fuck-hole - 
var VulvaHuman=/*#__PURE__*/function(_BodyPart27){_inherits(VulvaHuman,_BodyPart27);var _super37=_createSuper(VulvaHuman);_createClass(VulvaHuman,null,[{key:"dataPrototype",value:function dataPrototype(){return{labia:0,virgin:true,wetgen:1,stretch:1,depth:6,clitsize:0.5,spermtype:'',sperm:0};}},{key:"factory",value:function factory(id){var obj=new VulvaHuman();obj.setStyle(id);return obj;}}]);function VulvaHuman(){var _this37;_classCallCheck(this,VulvaHuman);_this37=_super37.call(this,'VulvaHuman');_this37.addTags(['body']);_this37.slotUse=['bVulva'];_this37.data=VulvaHuman.dataPrototype();return _this37;}_createClass(VulvaHuman,[{key:"setStyle",value:function setStyle(id){this.data.style=id;switch(id){case'human':case'bird':case'cat':case'dog':case'fox':case'horse':case'wolf':case'bunny':case'lizard':break;default:throw new Error("unknown vulva-style "+id);}}},{key:"getStyle",value:function getStyle(){return this.data.style;}},{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("VulvaHuman",this);}},{key:"descLong",value:function descLong(fconv){var msg="$[My]$ vagina can snuggly fit around "+this.data.stretch+"cm in diameter and "+this.data.depth+"cm in depth.";msg+="Its clit is of a size of around "+this.data.clitsize+"cm.";if(this.data.spermtype!==''){msg+=this.data.sperm+"ml of sperm from a "+this.data.spermtype+" might be deposited in $[my]$ womb.";}return fconv(msg);}},{key:"onEquip",value:function onEquip(context){//context.parent.addEffect(new window.storage.constructors['effSpermDecay'](),'effSpermDecay');
context.parent.addEffect(new window.storage.constructors['effVaginalFertil'](),'effVaginalFertil');return{OK:true,msg:'equipped'};}},{key:"onUnequip",value:function onUnequip(context){context.parent.Effects.removeItem('effVaginalFertil');context.parent.Effects.removeItem('effVaginalPregnant');//context.parent.Effects.removeItem('effSpermDecay');
return{OK:true,msg:'unequipped'};}},{key:"addSperm",value:function addSperm(type,amount){if(amount>this.data.sperm||this.data.spermtype){this.data.spermtype=type;}this.data.sperm+=amount;}},{key:"removeSperm",value:function removeSperm(amount){if(amount>0){this.data.sperm-=amount;}else this.data.sperm=0;if(this.data.sperm<=0){this.data.sperm=0;this.data.spermtype='';}}},{key:"descShort",get:function get(){return this.data.style+' vagina';}},{key:"desc",get:function get(){return'puffy cunt';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(VulvaHuman,value.data);}}]);return VulvaHuman;}(BodyPart);var PenisHuman=/*#__PURE__*/function(_BodyPart28){_inherits(PenisHuman,_BodyPart28);var _super38=_createSuper(PenisHuman);_createClass(PenisHuman,null,[{key:"dataPrototype",value:function dataPrototype(){return{style:'human',maxGrowth:0.2,growth:0.4,virgin:true,wetgen:1,sheath:0,ballsize:0.1};}},{key:"factory",value:function factory(id){var obj=new PenisHuman();obj.setStyle(id);return obj;}}]);function PenisHuman(){var _this38;_classCallCheck(this,PenisHuman);_this38=_super38.call(this,'PenisHuman');_this38.addTags(['body']);_this38.slotUse=['bPenis','bBalls'];_this38.data=PenisHuman.dataPrototype();return _this38;}_createClass(PenisHuman,[{key:"setStyle",value:function setStyle(id){this.data.style=id;switch(id){case'human':case'bird'://todo split this in different classes?
case'cat':case'dog':case'horse':case'wolf':case'fox':case'bunny':case'imp':break;case'lizard':break;default:throw new Error("unknown penis-style "+id);}}},{key:"getStyle",value:function getStyle(){return this.data.style;}},{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("PenisHuman",this);}},{key:"canEquip",value:function canEquip(context){return{OK:true,msg:'equipable'};}},{key:"canUnequip",value:function canUnequip(){return{OK:true,msg:'unequipable'};}},{key:"descLong",value:function descLong(fconv){var msg="$[My]$ "+this.data.style+"-dong is around "+this.sizeString(this.data.growth*this.data.maxGrowth)+" long.";if(this.data.style==='lizard'||this.data.style==='bird'){msg+="The testicles are hidden inside the body but might be around "+this.sizeString(this.data.ballsize*this.data.maxGrowth)+" .";}else{msg+="A Ballsack dangles below it that measures around "+this.sizeString(this.data.ballsize*this.data.maxGrowth)+" .";}return fconv(msg);}},{key:"descShort",get:function get(){return this.desc;}},{key:"desc",get:function get(){var msg='';switch(this.data.style){case'cat':msg='a slim but spiked cat-member.';break;default:msg='a schlong of a '+this.data.style+'.';}return msg;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(PenisHuman,value.data);}}]);return PenisHuman;}(BodyPart);//todo BodyPartLib ??
window.gm.ItemsLib=function(ItemsLib){window.storage.registerConstructor(AnusHuman);window.storage.registerConstructor(ArmorTorso);window.storage.registerConstructor(WeaponSlobber);window.storage.registerConstructor(WeaponStinger);window.storage.registerConstructor(BaseBiped);window.storage.registerConstructor(BaseHumanoid);window.storage.registerConstructor(BaseQuadruped);window.storage.registerConstructor(BaseInsect);window.storage.registerConstructor(BaseWorm);window.storage.registerConstructor(HandsHoof);window.storage.registerConstructor(HandsHuman);window.storage.registerConstructor(HandsPaw);window.storage.registerConstructor(HeadHairHuman);window.storage.registerConstructor(FaceBird);window.storage.registerConstructor(FaceHorse);window.storage.registerConstructor(FaceHuman);window.storage.registerConstructor(FaceInsect);window.storage.registerConstructor(FaceLeech);window.storage.registerConstructor(FaceWolf);window.storage.registerConstructor(SkinFeathers);window.storage.registerConstructor(SkinHuman);window.storage.registerConstructor(SkinFur);window.storage.registerConstructor(SkinScales);window.storage.registerConstructor(TailWolf);window.storage.registerConstructor(TailSnake);window.storage.registerConstructor(BreastHuman);window.storage.registerConstructor(PenisHuman);window.storage.registerConstructor(VulvaHuman);window.storage.registerConstructor(Wings);return ItemsLib;}(window.gm.ItemsLib||{});"use strict";/**
 * Items can have bonus/curse(s) that is applied when its condition is met 
 * condition is checked when equipped and on every timechange (no check if not equipped ? )
 * if trigger succeeds, apply-function is called  
 * the curse should be initially hidden to the player but might be revealed by a magican
 * 
 * possible conditions to think of:
 * - is activated if worn for some time
 * - is activated if other certain (cursed) items are worn
 * - is activated if effect is active
 * - is activated if in location
 * 
 * possible actions to think of:
 * - disable unequip/ locking
 * - replace the item with a different one
 * - add an effect
 * - give a skill
 * - destroy item on unequip
 * 
 * use deffered event to show the triggerd curse
 * 
 * ways to remove a curse (not yet triggered)
 * - by magican?
 * 
 * ways to remove active curse
 * - a key to unlock
 * - dissolve the item by a magican
 * - use item/potion that counters the effect
 * - mutate body to remove bodypart (snake -> no wristcuffs) 
 */ /**
 * //hidden 0 = visible, 1= name=???, 2= , 4= hidden
 */var Curse=/*#__PURE__*/function(){function Curse(){_classCallCheck(this,Curse);this.hidden=0;this.trigger=null;this.list=[];}/* 
    * parent is the item !
    * Attention !! _parent will be added dynamical
    */_createClass(Curse,[{key:"_relinkItems",value:function _relinkItems(parent){this._parent=window.gm.util.refToParent(parent);this.trigger._parent=window.gm.util.refToParent(this);var _iterator88=_createForOfIteratorHelper(this.list),_step88;try{for(_iterator88.s();!(_step88=_iterator88.n()).done;){var n=_step88.value;n._parent=window.gm.util.refToParent(this);}}catch(err){_iterator88.e(err);}finally{_iterator88.f();}}},{key:"configureCurse",value:function configureCurse(item,trigger,curses){this.trigger=trigger;this.list=curses;item.bonus.push(this);this._relinkItems(item);//todo: basePrice if bonus/curse is hidden; if bonus/curse is known, increase/lower price; if bonus/curse is not fully known, increase price slightly 
item.price=item.basePrice*(1+item.bonus.length);item._updateId();}},{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("Curse",this);}},{key:"onEquip",value:function onEquip(){if(this.trigger.onEquip())this.apply();}},{key:"onUnequip",value:function onUnequip(){if(this.trigger.onUnequip())this.apply(true);}},{key:"canUnequip",value:function canUnequip(){//ask effects if allowed to unequip/not locked
var res;var _iterator89=_createForOfIteratorHelper(this.list),_step89;try{for(_iterator89.s();!(_step89=_iterator89.n()).done;){var n=_step89.value;res=n.canUnequip();if(res.OK==false)return res;}}catch(err){_iterator89.e(err);}finally{_iterator89.f();}res={OK:true,msg:'unequipable'};return res;}},{key:"onTimeChange",value:function onTimeChange(time){if(this.trigger.onTimeChange(time))this.apply();}},{key:"apply",value:function apply(unapply){this.hidden=0;//reveal
var _iterator90=_createForOfIteratorHelper(this.list),_step90;try{for(_iterator90.s();!(_step90=_iterator90.n()).done;){var n=_step90.value;n.apply(unapply);//todo 3 effects would generate 3 defferedEvents; instead combine text into single event
}}catch(err){_iterator90.e(err);}finally{_iterator90.f();}}},{key:"parent",get:function get(){return this._parent?this._parent():null;}},{key:"desc",get:function get(){var msg='';if((this.hidden&0x4)>0){//completely hidden
}else if((this.hidden&0x1)>0){msg='unknown effect';}else if(this.hidden===0){msg=this.trigger.desc;var _iterator91=_createForOfIteratorHelper(this.list),_step91;try{for(_iterator91.s();!(_step91=_iterator91.n()).done;){var n=_step91.value;msg+="; "+n.desc;}}catch(err){_iterator91.e(err);}finally{_iterator91.f();}}return msg;}}],[{key:"fromJSON",value:function fromJSON(value){var x=window.storage.Generic_fromJSON(Curse,value.data);return x;}}]);return Curse;}();//-------------------------------------------------------------------------
var CrsTrigger=/*#__PURE__*/function(){//each curse has a trigger that evaluates if the curse gets triggered
function CrsTrigger(){_classCallCheck(this,CrsTrigger);}/* 
    * parent is the curse !
    * Attention !! _parent will be added dynamical
    */_createClass(CrsTrigger,[{key:"_relinkItems",value:function _relinkItems(parent){this._parent=window.gm.util.refToParent(parent);}},{key:"onEquip",value:function onEquip(){return false;}},{key:"onUnequip",value:function onUnequip(){return true;}//by default trigger unapply when unequipped
},{key:"onTimeChange",value:function onTimeChange(time){return false;}},{key:"parent",get:function get(){return this._parent?this._parent():null;}},{key:"desc",get:function get(){return'';}}]);return CrsTrigger;}();var CrsTrgOnEquip=/*#__PURE__*/function(_CrsTrigger){_inherits(CrsTrgOnEquip,_CrsTrigger);var _super39=_createSuper(CrsTrgOnEquip);function CrsTrgOnEquip(){var _this39;_classCallCheck(this,CrsTrgOnEquip);_this39=_super39.call(this);_this39.minItems=0;//if 0 always trigger onEquip
_this39.curseName='crs';// ..otherwise min no. items with this tag need to be equipped
return _this39;}_createClass(CrsTrgOnEquip,[{key:"onEquip",value:function onEquip(){if(this.minItems<=0)return true;var owner=this.parent.parent.parent.parent.Outfit,list=owner.getAllIds();var _c=0;var _iterator92=_createForOfIteratorHelper(list),_step92;try{for(_iterator92.s();!(_step92=_iterator92.n()).done;){var n=_step92.value;if(owner.getItem(n).hasTag(this.curseName))_c+=1;}}catch(err){_iterator92.e(err);}finally{_iterator92.f();}return _c>=this.minItems;}},{key:"onTimeChange",value:function onTimeChange(time){if(this.minItems<=0)return false;return this.onEquip();}},{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("CrsTrgOnEquip",this);}},{key:"desc",get:function get(){return'when equipped';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(CrsTrgOnEquip,value.data);}}]);return CrsTrgOnEquip;}(CrsTrigger);var CrsTrgDelayed=/*#__PURE__*/function(_CrsTrigger2){_inherits(CrsTrgDelayed,_CrsTrigger2);var _super40=_createSuper(CrsTrgDelayed);function CrsTrgDelayed(){var _this40;_classCallCheck(this,CrsTrgDelayed);_this40=_super40.call(this);_this40.timeToTrigger=60*2;//in min
_this40.timeStart=null;return _this40;}_createClass(CrsTrgDelayed,[{key:"onEquip",value:function onEquip(){this.timeStart=window.gm.getTime();return false;}},{key:"onTimeChange",value:function onTimeChange(time){return this.timeToTrigger<window.gm.getDeltaTime(time,this.time);}},{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("CrsTrgDelayed",this);}},{key:"desc",get:function get(){return'after '+window.gm.util.formatNumber(this.timeToTrigger,0)+'min';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(CrsTrgDelayed,value.data);}}]);return CrsTrgDelayed;}(CrsTrigger);//-------------------------------------------------------------------------
var CrsEffect=/*#__PURE__*/function(){function CrsEffect(){_classCallCheck(this,CrsEffect);this.hidden=0;}/* 
    * parent is the curse !
    * Attention !! _parent will be added dynamical
    */_createClass(CrsEffect,[{key:"canUnequip",value:function canUnequip(){return{OK:true,msg:'unequipable'};}},{key:"apply",value:function apply(unapply){}//override to do something!
},{key:"parent",get:function get(){return this._parent?this._parent():null;}},{key:"desc",get:function get(){return'';}}]);return CrsEffect;}();//todo timed lock
var CrsEffLock=/*#__PURE__*/function(_CrsEffect){_inherits(CrsEffLock,_CrsEffect);var _super41=_createSuper(CrsEffLock);function CrsEffLock(){var _this41;_classCallCheck(this,CrsEffLock);_this41=_super41.call(this);_this41.key='KeyRestraintA';return _this41;}_createClass(CrsEffLock,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("CrsEffLock",this);}},{key:"canUnequip",value:function canUnequip(){var res={OK:true,msg:'This devices requires '+this.key+' to unlock'};if(this.parent.parent.parent.parent.Inv.countItem(this.key)<=0){res.OK=false;}return res;}},{key:"apply",value:function apply(unapply){if(unapply){this.parent.parent.parent.parent.Inv.removeItem(this.key,1);window.gm.pushDeferredEvent("GenericDeffered",['With the key, it was now possible to unlock '+this.parent.parent.name+' !']);}else{window.gm.pushDeferredEvent("GenericDeffered",['As soon as you equiped '+this.parent.parent.name+', some hidden lock sealed the item on you !']);}}},{key:"desc",get:function get(){return"The item can only be unlocked with a "+this.key+".";}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(CrsEffLock,value.data);}}]);return CrsEffLock;}(CrsEffect);var CrsEffSeal=/*#__PURE__*/function(_CrsEffect2){_inherits(CrsEffSeal,_CrsEffect2);var _super42=_createSuper(CrsEffSeal);function CrsEffSeal(){var _this42;_classCallCheck(this,CrsEffSeal);_this42=_super42.call(this);_this42.key='KeyRestraintA';return _this42;}_createClass(CrsEffSeal,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("CrsEffSeal",this);}},{key:"canUnequip",value:function canUnequip(){var res={OK:false,msg:'This device is seald by magic.'};return res;}},{key:"apply",value:function apply(unapply){if(unapply){window.gm.pushDeferredEvent("GenericDeffered",['The seal was removed!']);}else{window.gm.pushDeferredEvent("GenericDeffered",['As soon as you equiped '+this.parent.parent.name+', the item sealed itself on you!']);}}},{key:"desc",get:function get(){return"The item is sealed magically to its wearer. The magic seal has to be weakened before the item can be removed.";}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(CrsEffSeal,value.data);}}]);return CrsEffSeal;}(CrsEffect);var CrsEffConvert=/*#__PURE__*/function(_CrsEffect3){_inherits(CrsEffConvert,_CrsEffect3);var _super43=_createSuper(CrsEffConvert);function CrsEffConvert(){var _this43;_classCallCheck(this,CrsEffConvert);_this43=_super43.call(this);_this43.newItem='GlovesRubber';_this43.newCurse={lock:true,energydrain:2};return _this43;}_createClass(CrsEffConvert,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("CrsEffConvert",this);}},{key:"apply",value:function apply(unapply){if(unapply){}else{var item=window.gm.ItemsLib[this.newItem]();item.addTags(['cursed']);//this is ugly
window.gm.makeCursedItem(item,this.newCurse);//todo how to configure this
if(this.parent.parent.parent.parent.Outfit.removeItem(this.parent.parent.id).OK){this.parent.parent.parent.parent.Wardrobe.removeItem(this.parent.parent.id);window.gm.pushDeferredEvent("GenericDeffered",['To your surprise, '+this.parent.parent.name+' contorts its shape to something different, reforming itself into '+item.name+'! ']);this.parent.parent.parent.parent.Wardrobe.addItem(item);this.parent.parent.parent.parent.Outfit.addItem(item);}}}},{key:"desc",get:function get(){return"Converts the item to "+this.newItem+".";}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(CrsEffConvert,value.data);}}]);return CrsEffConvert;}(CrsEffect);//adds an effect that drains your energy
var CrsEffEnergyDrain=/*#__PURE__*/function(_CrsEffect4){_inherits(CrsEffEnergyDrain,_CrsEffect4);var _super44=_createSuper(CrsEffEnergyDrain);function CrsEffEnergyDrain(){_classCallCheck(this,CrsEffEnergyDrain);return _super44.call(this);}_createClass(CrsEffEnergyDrain,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("CrsEffEnergyDrain",this);}},{key:"apply",value:function apply(unapply){if(unapply){this.parent.parent.parent.parent.Effects.removeItem(this.parent.parent.id+'_EnergyDrain');}else{//this->curse->item->outfit->char     id="cursed_leather_bracer.EnergyDrain"
this.parent.parent.parent.parent.addEffect(new window.storage.constructors['effEnergyDrain'](),this.parent.parent.id+'_EnergyDrain');}}},{key:"desc",get:function get(){return"Drains wearers energy.";}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(CrsEffEnergyDrain,value.data);}}]);return CrsEffEnergyDrain;}(CrsEffect);//modifies a stat
var CrsEffStatBonus=/*#__PURE__*/function(_CrsEffect5){_inherits(CrsEffStatBonus,_CrsEffect5);var _super45=_createSuper(CrsEffStatBonus);function CrsEffStatBonus(){var _this44;_classCallCheck(this,CrsEffStatBonus);_this44=_super45.call(this);_this44.statid='strength';_this44.statbonus=5;return _this44;}_createClass(CrsEffStatBonus,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("CrsEffStatBonus",this);}},{key:"apply",value:function apply(unapply){if(unapply){this.parent.parent.parent.parent.Stats.removeModifier(this.statid,{id:this.statid+":"+this.parent.parent.id});}else{this.parent.parent.parent.parent.Stats.addModifier(this.statid,{id:this.statid+":"+this.parent.parent.id,bonus:this.statbonus});}}},{key:"desc",get:function get(){return this.statid+" +"+this.statbonus;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(CrsEffStatBonus,value.data);}}]);return CrsEffStatBonus;}(CrsEffect);//gives you a skill
var CrsEffSkill=/*#__PURE__*/function(_CrsEffect6){_inherits(CrsEffSkill,_CrsEffect6);var _super46=_createSuper(CrsEffSkill);function CrsEffSkill(){var _this45;_classCallCheck(this,CrsEffSkill);_this45=_super46.call(this);_this45.skillid=_this45.newskillid='';return _this45;}_createClass(CrsEffSkill,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("CrsEffSkill",this);}},{key:"apply",value:function apply(unapply){if(unapply){this.parent.parent.parent.parent.Skills.removeItem(this.newskillid);}else{var sk=new window.storage.constructors[this.skillid]();sk.id=sk.name=this.newskillid;this.parent.parent.parent.parent.Skills.addItem(sk);}}},{key:"desc",get:function get(){return"gives skill "+this.newskillid;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(CrsEffSkill,value.data);}}]);return CrsEffSkill;}(CrsEffect);//disables a skill
var CrsEffSkillSeal=/*#__PURE__*/function(_CrsEffect7){_inherits(CrsEffSkillSeal,_CrsEffect7);var _super47=_createSuper(CrsEffSkillSeal);function CrsEffSkillSeal(){var _this46;_classCallCheck(this,CrsEffSkillSeal);_this46=_super47.call(this);_this46.skillid='';return _this46;}_createClass(CrsEffSkillSeal,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("CrsEffSkillSeal",this);}},{key:"apply",value:function apply(unapply){if(this.parent.parent.parent.parent.Skills.findItemSlot(this.skillid)<0)return;_item=this.parent.parent.parent.parent.Skills.getItem(this.skillid);if(unapply){_item.seal=0;//#todo how handle multiple seals
}else{_item.seal=1;}}},{key:"desc",get:function get(){return"mmakes it ipossible to use "+this.skillid;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(CrsEffSkillSeal,value.data);}}]);return CrsEffSkillSeal;}(CrsEffect);//todo wrap you in rubber; pony gear,
// slaver harness - if you defeat a foe with higher level then you, you gain ftDomination, otherwise ftSubmission
/**
 * adds a curse-function to an item
 */window.gm.makeCursedItem=function(item,extra){var curse=new Curse();var eff=null;var list=[];curse.trigger=new CrsTrgOnEquip();if(extra.hidden){//hidden:4
curse.hidden=extra.hidden;}else curse.hidden=4;//by default hidden
if(extra.minItems){curse.trigger.minItems=extra.minItems;curse.trigger.curseName='cursed';//todo PonyCurse
item.addTags([curse.trigger.curseName]);}if(extra.delayed){//delayed:60
curse.trigger=new CrsTrgDelayed();curse.trigger.timeToTrigger=extra.delayed;}if(extra.lock){//lock:1
eff=new CrsEffLock();list.push(eff);}if(extra.seal){//seal:1
eff=new CrsEffSeal();list.push(eff);}if(extra.sealSkill){//sealSkill:'SkillFireball'
eff=new CrsEffSkillSeal();eff.skillid=extra.skillid;list.push(eff);}if(extra.convert){//convert:'rubber'
eff=new CrsEffConvert();eff.newItem=extra.convert;eff.newCurse={lock:1};list.push(eff);}if(extra.energydrain){//energydrain:3
eff=new CrsEffEnergyDrain();list.push(eff);}curse.configureCurse(item,curse.trigger,list);//todo should change item-id or the item would not properly add to wardrobe if there is already similiar item;item.getHash()??
return item;};window.gm.makeBonusItem=function(item,extra){var curse=new Curse();var eff=null;var list=[];curse.trigger=new CrsTrgOnEquip();if(extra.hidden){curse.hidden=extra.hidden;}else curse.hidden=0;//by default visible?
if(extra.statBoost&&extra.statBonus){eff=new CrsEffStatBonus();eff.statid=extra.statBoost,eff.statbonus=extra.statBonus;list.push(eff);}if(extra.skillid){eff=new CrsEffSkill();eff.skillid=extra.skillid,eff.newskillid=extra.skillname;list.push(eff);}curse.configureCurse(item,curse.trigger,list);return item;};window.gm.ItemsLib=function(ItemsLib){window.storage.registerConstructor(Curse);window.storage.registerConstructor(CrsTrgDelayed);window.storage.registerConstructor(CrsTrgOnEquip);window.storage.registerConstructor(CrsEffLock);window.storage.registerConstructor(CrsEffSeal);window.storage.registerConstructor(CrsEffConvert);window.storage.registerConstructor(CrsEffEnergyDrain);window.storage.registerConstructor(CrsEffSkill);window.storage.registerConstructor(CrsEffSkillSeal);window.storage.registerConstructor(CrsEffStatBonus);}(window.gm.ItemsLib||{});"use strict";var BeeHive=/*#__PURE__*/function(_DngDungeon){_inherits(BeeHive,_DngDungeon);var _super48=_createSuper(BeeHive);function BeeHive(){var _this47;_classCallCheck(this,BeeHive);_this47=_super48.call(this,"BeeHive",function(){return"There seem to live alot of giant bees here.";},window.story.state.dng[BeeHive.name]);_this47.buildFloors();return _this47;}_createClass(BeeHive,[{key:"buildFloors",value:function buildFloors(){var _floors=[];var firstFloor;//:DngFloor;
var stairUp;//:DngRoom;
var stairDown;//:DngRoom;
firstFloor=new DngFloor("1.Floor",function(){return"This is the lowest floor of the beehive.";});var room;//:DngRoom;
//var rooms:LookupTable = new LookupTable(); 
var rooms=new Map();/* first floor
        *  A1 - A2 - A3 - A4
        *  	    |	  |    |	
        *  B1 - B2   B3   B4
        *  |    |    |    |
        *  E    C2   C3   S
        * */rooms.set("Entrance",new DngRoom("Entrance",null,false));rooms.set("B1",new DngRoom("B1",null,false));rooms.set("A1",new DngRoom("A1",null,true));//hidden
rooms.set("B2",new DngRoom("B2",null,false));rooms.set("C2",new DngRoom("C2",null,false));rooms.set("A2",new DngRoom("A2",null,false));rooms.set("B3",new DngRoom("B3",null,false));rooms.set("C3",new DngRoom("C3",null,false));rooms.set("A3",new DngRoom("A3",null,false));rooms.set("B4",new DngRoom("B4",null,false));rooms.set("A4",new DngRoom("A4",null,false));rooms.set("Stairs",new DngRoom("Stairs",null,false));DngDirection.createDirection(DngDirection.DirN,rooms.get("Entrance"),rooms.get("B1"));DngDirection.createDirection(DngDirection.DirE,rooms.get("B1"),rooms.get("B2"));DngDirection.createDirection(DngDirection.DirN,rooms.get("B2"),rooms.get("A2"));DngDirection.createDirection(DngDirection.DirN,rooms.get("C2"),rooms.get("B2"),{onlyAtoB:true});DngDirection.createDirection(DngDirection.DirW,rooms.get("A2"),rooms.get("A1"));DngDirection.createDirection(DngDirection.DirE,rooms.get("A2"),rooms.get("A3"));DngDirection.createDirection(DngDirection.DirE,rooms.get("A3"),rooms.get("A4"));DngDirection.createDirection(DngDirection.DirN,rooms.get("B3"),rooms.get("A3"),{onlyAtoB:true});DngDirection.createDirection(DngDirection.DirN,rooms.get("C3"),rooms.get("B3"),{onlyAtoB:true});DngDirection.createDirection(DngDirection.DirS,rooms.get("A4"),rooms.get("B4"));DngDirection.createDirection(DngDirection.DirS,rooms.get("B4"),rooms.get("Stairs"));room=rooms.get("Entrance");room.isDungeonEntry=room.isDungeonExit=true;room=rooms.get("B1");//room.onEnterFct = encounterTentacle;
room=rooms.get("B2");//room.onEnterFct = this.encounterBee2;
room=rooms.get("A4");room.onEnterFct=this.encounterBee2;room=rooms.get("A3");room.onEnterFct=this.encounterBee2;room=rooms.get("B4");room.getDirection(DngDirection.DirS).canExitFct=this.hasItem;stairUp=rooms.get("Stairs");firstFloor.setRooms(Array.from(rooms.values()));_floors.push(firstFloor);var secondFloor;secondFloor=new DngFloor("2.Floor",function(){return"This is the second floor of the beehive.";});rooms=new Map();/* second floor
        * 	A1# - A2 - A3# - A4
        *  |	  |	   |     |	
        *  B1 -  B2 - B3 -  B4
        *  |     |    |     |
        *  C1 - C2# - C3# - S
        * */rooms.set("C1",new DngRoom("C1",null,false));rooms.set("B1",new DngRoom("B1",null,false));rooms.set("A1",new DngRoom("A1",null,false));rooms.set("C2",new DngRoom("C2",null,false));rooms.set("B2",new DngRoom("B2",null,false));rooms.set("A2",new DngRoom("A2",null,false));rooms.set("C3",new DngRoom("C3",null,false));rooms.set("B3",new DngRoom("B3",null,false));rooms.set("A3",new DngRoom("A3",null,false));rooms.set("StairsDown",new DngRoom("StairsDown",null,false));rooms.set("B4",new DngRoom("B4",null,false));rooms.set("A4",new DngRoom("A4",null,false));DngDirection.createDirection(DngDirection.DirE,rooms.get("C3"),rooms.get("StairsDown"));DngDirection.createDirection(DngDirection.DirE,rooms.get("C2"),rooms.get("C3"));DngDirection.createDirection(DngDirection.DirE,rooms.get("C1"),rooms.get("C2"));DngDirection.createDirection(DngDirection.DirE,rooms.get("A3"),rooms.get("A4"));DngDirection.createDirection(DngDirection.DirE,rooms.get("A2"),rooms.get("A3"));DngDirection.createDirection(DngDirection.DirE,rooms.get("A1"),rooms.get("A2"));DngDirection.createDirection(DngDirection.DirE,rooms.get("B3"),rooms.get("B4"));DngDirection.createDirection(DngDirection.DirE,rooms.get("B2"),rooms.get("B3"));DngDirection.createDirection(DngDirection.DirE,rooms.get("B1"),rooms.get("B2"));DngDirection.createDirection(DngDirection.DirE,rooms.get("C3"),rooms.get("C4"));DngDirection.createDirection(DngDirection.DirE,rooms.get("C2"),rooms.get("C3"));DngDirection.createDirection(DngDirection.DirE,rooms.get("C1"),rooms.get("C2"));DngDirection.createDirection(DngDirection.DirN,rooms.get("B1"),rooms.get("A1"));DngDirection.createDirection(DngDirection.DirN,rooms.get("C1"),rooms.get("B1"));DngDirection.createDirection(DngDirection.DirN,rooms.get("B2"),rooms.get("A2"));DngDirection.createDirection(DngDirection.DirN,rooms.get("C2"),rooms.get("B2"));DngDirection.createDirection(DngDirection.DirN,rooms.get("B3"),rooms.get("A3"));DngDirection.createDirection(DngDirection.DirN,rooms.get("C3"),rooms.get("B3"));DngDirection.createDirection(DngDirection.DirN,rooms.get("B4"),rooms.get("A4"));DngDirection.createDirection(DngDirection.DirN,rooms.get("StairsDown"),rooms.get("B4"));room=rooms.get("B4");stairDown=room=rooms.get("StairsDown");room.getDirection(DngDirection.DirW).onExitFct=this.trapDoor;//its a trap
room=rooms.get("B3");room.getDirection(DngDirection.DirW).canExitFct=this.hasItem;room.getDirection(DngDirection.DirN).onExitFct=this.trapDoor;//its a trap
room.getDirection(DngDirection.DirS).onExitFct=this.trapDoor;//its a trap
room=rooms.get("B2");room.getDirection(DngDirection.DirE).onExitFct=this.trapDoor;//its a trap
room=rooms.get("A2");room.getDirection(DngDirection.DirW).onExitFct=this.trapDoor;//its a trap
room=rooms.get("B1");room.getDirection(DngDirection.DirN).onExitFct=this.trapDoor;//its a trap
secondFloor.setRooms(Array.from(rooms.values()));_floors.push(secondFloor);//now create floor links
DngDirection.createDirection(DngDirection.StairUp,stairUp,stairDown);this.setFloors(_floors);//assign floors to dng
}},{key:"exitDungeon",value:function exitDungeon(){_get(_getPrototypeOf(BeeHive.prototype),"exitDungeon",this).call(this);window.story.show("ForestEntrance");}},{key:"encounterTentacle",value:function encounterTentacle(Me){window.story.show('DungeonFoundNothing');return true;}},{key:"encounterBee2",value:function encounterBee2(Me){window.story.show('DungeonFoundNothing');return true;}},{key:"hasItem",value:function hasItem(Me){/* if (!player.hasItem(ItemType.lookupItem("BeeHony"), 1))
        {
            Me.tooltip = "You dont have a vial of beehoney";
            return false;
        }*/return true;}//player falls down to 1.floor when entering the room
},{key:"trapDoor",value:function trapDoor(Me){window.story.show('DungeonCrashedThroughFloor');return true;}}]);return BeeHive;}(DngDungeon);var ShatteredCity=/*#__PURE__*/function(_DngDungeon2){_inherits(ShatteredCity,_DngDungeon2);var _super49=_createSuper(ShatteredCity);_createClass(ShatteredCity,[{key:"persistentDngDataTemplate",value:function persistentDngDataTemplate(){var _data={A1Chest:["TailRibbon","HorsePotion"],A2defeated:0};return _data;}}]);function ShatteredCity(){var _this48;_classCallCheck(this,ShatteredCity);_this48=_super49.call(this,"ShatteredCity",function(){return"A once thriving city now lies in ruins.";},window.story.state.dng[ShatteredCity.name]);_this48.buildFloors();return _this48;}_createClass(ShatteredCity,[{key:"buildFloors",value:function buildFloors(){var _floors=[];var firstFloor;//:DngFloor;
var stairUp;//:DngRoom;
var stairDown;//:DngRoom;
firstFloor=new DngFloor("main street");var room;//:DngRoom;
var rooms=new Map();/* main street
        *  A1 - A2 - A3 - A4
        *      |      |    |	
        *  B1 - B2   B3   B4
        *  |    |    |    |
        *  C1   C2   C3   C4
        * B1 = Entrance; B2 Camp; A1 Chest
        * */rooms.set("C1",new DngRoom("C1",null,false));rooms.set("B1",new DngRoom("B1",null,false));rooms.set("A1",new DngRoom("A1",null,false));rooms.set("B2",new DngRoom("B2",function(){return'Campfire';},false));rooms.set("C2",new DngRoom("C2",null,false));rooms.set("A2",new DngRoom("A2",null,false));rooms.set("B3",new DngRoom("B3",null,false));rooms.set("C3",new DngRoom("C3",null,false));rooms.set("A3",new DngRoom("A3",null,false));rooms.set("B4",new DngRoom("B4",null,false));rooms.set("A4",new DngRoom("A4",null,false));rooms.set("C4",new DngRoom("C4",null,false));DngDirection.createDirection(DngDirection.DirN,rooms.get("C1"),rooms.get("B1"));DngDirection.createDirection(DngDirection.DirE,rooms.get("B1"),rooms.get("B2"));DngDirection.createDirection(DngDirection.DirN,rooms.get("B2"),rooms.get("A2"));DngDirection.createDirection(DngDirection.DirN,rooms.get("C2"),rooms.get("B2"));DngDirection.createDirection(DngDirection.DirW,rooms.get("A2"),rooms.get("A1"));DngDirection.createDirection(DngDirection.DirE,rooms.get("A2"),rooms.get("A3"));DngDirection.createDirection(DngDirection.DirE,rooms.get("A3"),rooms.get("A4"));DngDirection.createDirection(DngDirection.DirN,rooms.get("B3"),rooms.get("A3"));DngDirection.createDirection(DngDirection.DirN,rooms.get("C3"),rooms.get("B3"));DngDirection.createDirection(DngDirection.DirS,rooms.get("A4"),rooms.get("B4"));DngDirection.createDirection(DngDirection.DirS,rooms.get("B4"),rooms.get("C4"));room=rooms.get("B1");room.isDungeonEntry=room.isDungeonExit=true;room=rooms.get("A1");var _evt=new DngOperation("Chest");_evt.canTrigger=function(){return true;};_evt.onTrigger=function(){this.renderEvent=this.renderChestA1;this.evtData={};this.renderNext(1);};room.operations=[_evt];//adds an loot-chest in this room
room=rooms.get("B2");room.allowSave=true;room=rooms.get("C1");_evt=new DngOperation("Scavenge");_evt.canTrigger=function(){return true;};_evt.onTrigger=function(){this.renderEvent=this.renderScavengeA3;this.evtData={};this.renderNext(1);};room.operations=[_evt];room=rooms.get("A3");room.onEnterFct=this.sneekAround();room=rooms.get("A4");//room.onEnterFct = this.sneekAround();
room.getDirection(DngDirection.DirS).canExitFct=this.hasItem;stairUp=rooms.get("C4");firstFloor.setRooms(Array.from(rooms.values()));_floors.push(firstFloor);this.setFloors(_floors);}},{key:"exitDungeon",value:function exitDungeon(){_get(_getPrototypeOf(ShatteredCity.prototype),"exitDungeon",this).call(this);window.story.show("ForestEntrance");}},{key:"sneekAround",value:function sneekAround(){var cb=function(that){return function(me){that.renderEvent=that.renderSneekAround;that.evtData={};that.renderNext(1);return true;};}(this);return cb;}},{key:"renderSneekAround",value:function renderSneekAround(evt){var msg='';var _rnd=_.random(0,100);if(evt.id===1){window.gm.addTime(30);msg='There is a gang of barbarians. You could try to sneek around them, talk your way through it or start a surprise attack.</br>';msg+=window.gm.printLink("sneak around","window.gm.dng.renderNext(2)");msg+=window.gm.printPassageLink("approach","SC_BarbarianMeetup");msg+=window.gm.printLink("attack","window.gm.dng._fight(1)");}else if(evt.id===2){if(_rnd>70){msg+='Someone spotted you !</br>';msg+=window.gm.printLink("Next",'window.gm.dng._fight()');}else{msg='You succesfully bypassed the threat.</br>';msg+=window.gm.printLink("Leave","window.gm.dng.resumeRoom()");}}else if(evt.id===3){msg+='Someone spotted you !</br>';msg+=window.gm.printLink("Next",'window.gm.dng._fight()');}return msg;}},{key:"renderChestA1",value:function renderChestA1(evt){//this is some statemachine to render the screen for lootchest
var msg='';if(evt.id===1){window.gm.addTime(30);msg='There is a chest. Do you dare to open it?</br>';msg+=window.gm.printLink("open chest","window.gm.dng.renderNext(2)");msg+=window.gm.printLink("Leave","window.gm.dng.resumeRoom()");}else if(evt.id===2&&this.data.A1Chest.length>0){msg='You find:'+this.data.A1Chest.join(",")+'</br>';msg+=window.gm.printLink("Take all","window.gm.dng.renderNext(3)");}else if(evt.id===3){var _iterator93=_createForOfIteratorHelper(this.data.A1Chest),_step93;try{for(_iterator93.s();!(_step93=_iterator93.n()).done;){var n=_step93.value;this._addItemToPlayer(n);}}catch(err){_iterator93.e(err);}finally{_iterator93.f();}this.data.A1Chest=[];msg='You take everything from the chest.</br>';msg+=window.gm.printLink("Leave","window.gm.dng.resumeRoom()");}else{msg='There is nothing useful.</br>';msg+=window.gm.printLink("Leave","window.gm.dng.resumeRoom()");}return msg;}},{key:"renderScavengeA3",value:function renderScavengeA3(evt){//
var msg='';var _rnd=_.random(0,100);if(evt.id===1){window.gm.addTime(30);//todo would be better to update time after battle
msg='You search the area for something useful...</br>';if(_rnd>30){msg+='... and found some trouble !</br>';msg+=window.gm.printLink("Next",'window.gm.dng._fight()');}else{msg='...but you didnt find anything.</br>';msg+=window.gm.printLink("Leave","window.gm.dng.resumeRoom()");}}return msg;}},{key:"_fight",value:function _fight(evt){if(evt===1)window.gm.encounters.wolf();else window.gm.encounters.wolf();}},{key:"_addItemToPlayer",value:function _addItemToPlayer(id){var item=new window.storage.constructors[id]();if(item.canEquip){window.gm.player.Wardrobe.addItem(item);}else{window.gm.player.Inv.addItem(item);}}}]);return ShatteredCity;}(DngDungeon);var MinoLair=/*#__PURE__*/function(_DngDungeon3){_inherits(MinoLair,_DngDungeon3);var _super50=_createSuper(MinoLair);_createClass(MinoLair,[{key:"persistentDngDataTemplate",value:function persistentDngDataTemplate(){var _data={currentRoom:0,maxRoom:0,collIt:0,mobData:[]};_data.mobData.push({homeTile:'E3',actualTile:'E3',speed:2});return _data;}}]);function MinoLair(){var _this49;_classCallCheck(this,MinoLair);_this49=_super50.call(this,"MinoLair",MinoLair.desc,window.story.state.dng[MinoLair.name]);_this49.data.currentRoom=1;_this49.Mapper=new DngMapper(_this49.extMapInfo.bind(_assertThisInitialized(_this49)));_this49.buildFloors();_this49.onEnterRoom=_this49.checkCollision;return _this49;}_createClass(MinoLair,[{key:"buildFloors",value:function buildFloors(){var _floors=[];var firstFloor;//:DngFloor;
var stairUp;//:DngRoom;
var stairDown;//:DngRoom;
firstFloor=new DngFloor("1.Floor",function(){return"floor#1.";});var room;//:DngRoom;
var rooms=new Map();var _evt2=new DngOperation("wait");_evt2.canTrigger=function(){return true;};_evt2.onTrigger=function(){this.tickMobs();};rooms.set("A1",new DngRoom("A1",null,false));rooms.set("B1",new DngRoom("B1",null,false));rooms.set("C1",new DngRoom("C1",null,false));rooms.set("D1",new DngRoom("D1",null,false));rooms.set("Stairs",new DngRoom("Stairs",null,false));rooms.set("F1",new DngRoom("F1",null,false));rooms.set("Entrance",new DngRoom("Entrance",null,false));rooms.set("B2",new DngRoom("B2",null,false));rooms.set("C2",new DngRoom("C2",null,false));rooms.set("D2",new DngRoom("D2",null,false));rooms.set("E2",new DngRoom("E2",null,false));rooms.set("F2",new DngRoom("F2",null,false));rooms.set("A3",new DngRoom("A3",null,false));rooms.set("B3",new DngRoom("B3",null,false));rooms.set("C3",new DngRoom("C3",null,false));rooms.set("D3",new DngRoom("D3",null,false));rooms.set("E3",new DngRoom("E3",null,false));rooms.set("F3",new DngRoom("F3",null,false));rooms.set("A4",new DngRoom("A4",null,false));rooms.set("B4",new DngRoom("B4",null,false));rooms.set("C4",new DngRoom("C4",null,false));rooms.set("D4",new DngRoom("D4",null,false));rooms.set("E4",new DngRoom("E4",null,false));rooms.set("F4",new DngRoom("F4",null,false));rooms.set("A5",new DngRoom("A5",null,false));rooms.set("B5",new DngRoom("B5",null,false));rooms.set("C5",new DngRoom("C5",null,false));rooms.set("D5",new DngRoom("D5",null,false));rooms.set("E5",new DngRoom("E5",null,false));rooms.set("F5",new DngRoom("F5",null,false));/* first floor
        *  
        * A1   B1 - C1 - D1   S    F1
        * |     |        |    |    |
        * E  - B2 - C2 - D2 - E2 - F2
        * |                   |    |
        * A3 - B3 - C3 - D3 - E3 - F3
        *      |     |   |    |    |
        * A4 - B4   C4 - D4 - E4   F4  
        * |          |             |
        * A5 - B5 - C5 - D5 - E5 - F5
        * */ //horizontal
//DngDirection.createDirection(DngDirection.DirE, rooms.get("A1") , rooms.get("B1"));
DngDirection.createDirection(DngDirection.DirE,rooms.get("B1"),rooms.get("C1"),{tags:['duct']});DngDirection.createDirection(DngDirection.DirE,rooms.get("C1"),rooms.get("D1"),{tags:['duct']});//DngDirection.createDirection(DngDirection.DirE, rooms.get("D1" ), rooms.get("E1"));
DngDirection.createDirection(DngDirection.DirE,rooms.get("Entrance"),rooms.get("B2"));DngDirection.createDirection(DngDirection.DirE,rooms.get("B2"),rooms.get("C2"));DngDirection.createDirection(DngDirection.DirE,rooms.get("C2"),rooms.get("D2"));DngDirection.createDirection(DngDirection.DirE,rooms.get("D2"),rooms.get("E2"));DngDirection.createDirection(DngDirection.DirE,rooms.get("E2"),rooms.get("F2"));DngDirection.createDirection(DngDirection.DirE,rooms.get("A3"),rooms.get("B3"));DngDirection.createDirection(DngDirection.DirE,rooms.get("B3"),rooms.get("C3"));DngDirection.createDirection(DngDirection.DirE,rooms.get("C3"),rooms.get("D3"));DngDirection.createDirection(DngDirection.DirE,rooms.get("D3"),rooms.get("E3"));DngDirection.createDirection(DngDirection.DirE,rooms.get("E3"),rooms.get("F3"));DngDirection.createDirection(DngDirection.DirE,rooms.get("A4"),rooms.get("B4"));//DngDirection.createDirection(DngDirection.DirE, rooms.get("B4" ), rooms.get("C4"));
DngDirection.createDirection(DngDirection.DirE,rooms.get("C4"),rooms.get("D4"));DngDirection.createDirection(DngDirection.DirE,rooms.get("D4"),rooms.get("E4"));DngDirection.createDirection(DngDirection.DirE,rooms.get("A5"),rooms.get("B5"));DngDirection.createDirection(DngDirection.DirE,rooms.get("B5"),rooms.get("C5"));DngDirection.createDirection(DngDirection.DirE,rooms.get("C5"),rooms.get("D5"));DngDirection.createDirection(DngDirection.DirE,rooms.get("D5"),rooms.get("E5"));DngDirection.createDirection(DngDirection.DirE,rooms.get("E5"),rooms.get("F5"));//vertical
DngDirection.createDirection(DngDirection.DirS,rooms.get("A1"),rooms.get("Entrance"));DngDirection.createDirection(DngDirection.DirS,rooms.get("B1"),rooms.get("B2"),{tags:['duct']});DngDirection.createDirection(DngDirection.DirS,rooms.get("D1"),rooms.get("D2"),{tags:['duct']});DngDirection.createDirection(DngDirection.DirS,rooms.get("Stairs"),rooms.get("E2"));DngDirection.createDirection(DngDirection.DirS,rooms.get("Entrance"),rooms.get("A3"));DngDirection.createDirection(DngDirection.DirS,rooms.get("E2"),rooms.get("E3"));DngDirection.createDirection(DngDirection.DirS,rooms.get("B3"),rooms.get("B4"));DngDirection.createDirection(DngDirection.DirS,rooms.get("C3"),rooms.get("C4"));DngDirection.createDirection(DngDirection.DirS,rooms.get("D3"),rooms.get("D4"));DngDirection.createDirection(DngDirection.DirS,rooms.get("A4"),rooms.get("A5"));DngDirection.createDirection(DngDirection.DirS,rooms.get("F1"),rooms.get("F2"));DngDirection.createDirection(DngDirection.DirS,rooms.get("F2"),rooms.get("F3"));DngDirection.createDirection(DngDirection.DirS,rooms.get("F3"),rooms.get("F4"));DngDirection.createDirection(DngDirection.DirS,rooms.get("F4"),rooms.get("F5"));var _iterator94=_createForOfIteratorHelper(rooms.values()),_step94;try{for(_iterator94.s();!(_step94=_iterator94.n()).done;){room=_step94.value;room.operations=[_evt2];}}catch(err){_iterator94.e(err);}finally{_iterator94.f();}room=rooms.get("Entrance");room.isDungeonEntry=room.isDungeonExit=true;room=rooms.get("A4");room.allowSave=true;firstFloor.setRooms(Array.from(rooms.values()));_floors.push(firstFloor);this.setFloors(_floors);var mob=new DngMob();mob.data.homeTile=mob.data.actualTile='E3',mob.data.name='bad bull';this.addMob(mob);mob=new DngMob();mob.data.homeTile=mob.data.actualTile='C4',mob.data.name='red bull';this.addMob(mob);}},{key:"exitDungeon",value:function exitDungeon(){_get(_getPrototypeOf(MinoLair.prototype),"exitDungeon",this).call(this);window.story.show("ForestBorder");}},{key:"checkCollision",value:function checkCollision(room){//check if there is a mob
for(var i=this.Mobs.length-1-this.data.collIt;i>=0;i--){this.data.collIt+=1;var mob=this.Mobs[i];if(mob.data.actualTile!==room.name)continue;if(mob.onCollidePlayer()){this.resumeRoom=this.checkCollision.bind(this,room);return true;}}this.data.collIt=0;this.resumeRoom=this.resumeRoomMenu;this.resumeRoom();return false;}},{key:"tickMino",value:function tickMino(evt){//
var msg='';if(evt.id===1){this.moveMino();if(window.gm.dng.actualRoom.name===this.data.minoTile){msg+='The mean mino got you. </br>';msg+=window.gm.printLink("Next",'window.gm.dng.exitDungeon()');}else{msg+='Mino is now at '+this.data.minoTile+' and moves in '+this.data.minoDelay+' turns. </br>';msg+=window.gm.printLink("Next",'window.gm.dng.resumeRoom()');//'window.gm.dng.exitDungeon()'
}}return msg;}},{key:"extMapInfo",value:function extMapInfo(roomInfo){//show mino on map
for(var i=this.Mobs.length-1;i>=0;i--){if(roomInfo.name===this.Mobs[i].data.actualTile)roomInfo.boss=1;}return roomInfo;}/**
     * 
     * @param {int} evt: roomNo 
     */},{key:"_fight",value:function _fight(evt){this.data.currentRoom=evt;this.data.maxRoom=this.data.currentRoom>this.data.maxRoom?this.data.currentRoom:this.data.maxRoom;window.gm.encounters.wolf();window.gm.Encounter.onVictory=function(){//need to resumeRoom...
this.data.currentRoom+=1;return'Victory ! </br>Some '+this.data.rewards[this.data.currentRoom].id+' was added to the reward-pile.</br>'+window.gm.printLink('Next','window.gm.dng.resumeRoom()');}.bind(this);return true;//return true to indicate a intermittent scene
}}],[{key:"desc",value:function desc(){return"Escape the Mean Mino";}}]);return MinoLair;}(DngDungeon);var ArenaTrialsNo1=/*#__PURE__*/function(_DngDungeon4){_inherits(ArenaTrialsNo1,_DngDungeon4);var _super51=_createSuper(ArenaTrialsNo1);_createClass(ArenaTrialsNo1,[{key:"persistentDngDataTemplate",value:function persistentDngDataTemplate(){var _data={currentRoom:0,maxRoom:0};return _data;}}]);function ArenaTrialsNo1(){var _this50;_classCallCheck(this,ArenaTrialsNo1);_this50=_super51.call(this,"ArenaTrialNo1",ArenaTrialsNo1.desc,window.story.state.dng[ArenaTrialsNo1.name]);_this50.data.currentRoom=1;_this50.data.rewards=[{},{id:'Money',amount:20},{id:'Money',amount:20},{id:'Money',amount:20},{id:'Money',amount:20}];_this50.data.challenger=['','wolf','moleX2','wolf','wolf'];_this50.buildFloors();return _this50;}_createClass(ArenaTrialsNo1,[{key:"buildFloors",value:function buildFloors(){var _floors=[];var firstFloor;//:DngFloor;
var stairUp;//:DngRoom;
var stairDown;//:DngRoom;
firstFloor=new DngFloor("1.Floor",function(){return"Arena gauntlet #1.";});var room;//:DngRoom;
var rooms=new Map();/* first floor
        *  
        * E - B1 - B2 - B3 - B4
        *   
        * */ //Todo should be able to go into arena only once a day/with entryfee
var foo1=function(){return ArenaTrialsNo1.desc()+'</br>If you survive your first challenger, you get '+this.data.rewards[this.data.currentRoom].amount+'x '+this.data.rewards[this.data.currentRoom].id+'.</br>';}.bind(this);var foo2=function(){return'If you survive the second challenge, you get '+this.data.rewards[this.data.currentRoom].amount+'x '+this.data.rewards[this.data.currentRoom].id+'.</br>';}.bind(this);var foo3=function(){return'If you survive the third challenge, you get '+this.data.rewards[this.data.currentRoom].amount+'x '+this.data.rewards[this.data.currentRoom].id+'.</br>';}.bind(this);var foo4=function(){return'If you survive the last challenge, you get '+this.data.rewards[this.data.currentRoom].amount+'x '+this.data.rewards[this.data.currentRoom].id+'.</br>';}.bind(this);var foo5=function foo5(){return'Congratulations. You have passed all the challenges and trully earned your reward.</br>';};var _evt=new DngOperation("Retreat");_evt.canTrigger=function(){return true;};_evt.onTrigger=function(){this.renderEvent=this.renderRetreat;this.evtData={};this.renderNext(1);};rooms.set("Entrance",new DngRoom("Entrance",foo1,false));rooms.set("B1",new DngRoom("B1",foo2,false));rooms.set("B2",new DngRoom("B2",foo3,false));rooms.set("B3",new DngRoom("B3",foo4,false));rooms.set("B4",new DngRoom("B4",foo5,false));rooms.set("Stairs",new DngRoom("Stairs",null,false));DngDirection.createDirection(DngDirection.DirE,rooms.get("Entrance"),rooms.get("B1"),{onlyAtoB:true});DngDirection.createDirection(DngDirection.DirE,rooms.get("B1"),rooms.get("B2"));DngDirection.createDirection(DngDirection.DirE,rooms.get("B2"),rooms.get("B3"));DngDirection.createDirection(DngDirection.DirE,rooms.get("B3"),rooms.get("B4"));room=rooms.get("Entrance");room.isDungeonEntry=room.isDungeonExit=true;room.getDirection(DngDirection.DirE).onExitFct=this._fight.bind(this,1);room=rooms.get("B1");room.getDirection(DngDirection.DirE).onExitFct=this._fight.bind(this,2);room.operations=[_evt];room=rooms.get("B2");room.getDirection(DngDirection.DirE).onExitFct=this._fight.bind(this,3);room.operations=[_evt];room=rooms.get("B3");room.getDirection(DngDirection.DirE).onExitFct=this._fight.bind(this,4);room.operations=[_evt];room=rooms.get("B4");room.operations=[_evt];firstFloor.setRooms(Array.from(rooms.values()));_floors.push(firstFloor);this.setFloors(_floors);}},{key:"exitDungeon",value:function exitDungeon(){_get(_getPrototypeOf(ArenaTrialsNo1.prototype),"exitDungeon",this).call(this);window.story.show("PlainsFarmland");}},{key:"renderRetreat",value:function renderRetreat(evt){//
var msg='';if(evt.id===1){for(var i=1;i<this.data.rewards.length;i++){if(this.data.currentRoom>i){window.gm.player.Inv.addItem(window.gm.ItemsLib[this.data.rewards[i].id](),this.data.rewards[i].amount);}}msg+='You decided to not continue the fight.</br>';msg+=window.gm.printLink("Next",'window.gm.dng.exitDungeon()');}return msg;}/**
     * 
     * @param {int} evt: roomNo 
     */},{key:"_fight",value:function _fight(evt){this.data.currentRoom=evt;this.data.maxRoom=this.data.currentRoom>this.data.maxRoom?this.data.currentRoom:this.data.maxRoom;window.gm.encounters[this.data.challenger[this.data.currentRoom]](window.gm.player.location);window.gm.Encounter.onVictory=function(){//need to resumeRoom...
this.data.currentRoom+=1;return'Victory ! </br>Some '+this.data.rewards[this.data.currentRoom].id+' was added to the reward-pile.</br>'+window.gm.printLink('Next','window.gm.dng.resumeRoom()');}.bind(this);return true;//return true to indicate a intermittent scene
}}],[{key:"desc",value:function desc(){return"You have to challenge several enemys one by one. The stakes increase with each challenge and after each fight you may decide to drop out with the rewards you gathered so far. But if you loose, you dont get anything, just your own insights.";}}]);return ArenaTrialsNo1;}(DngDungeon);var ArenaTrialsNo2=/*#__PURE__*/function(_DngDungeon5){_inherits(ArenaTrialsNo2,_DngDungeon5);var _super52=_createSuper(ArenaTrialsNo2);_createClass(ArenaTrialsNo2,[{key:"persistentDngDataTemplate",//Todo broken...
value:function persistentDngDataTemplate(){var _data={currentRoom:0,maxRoom:0};return _data;}}]);function ArenaTrialsNo2(){var _this51;_classCallCheck(this,ArenaTrialsNo2);_this51=_super52.call(this,"ArenaTrialsNo2",ArenaTrialsNo1.desc,window.story.state.dng[ArenaTrialsNo2.name]);_this51.data.currentRoom=1;_this51.data.rewards=[{},{id:'Money',amount:20},{id:'Money',amount:20},{id:'Money',amount:20},{id:'Money',amount:20}];_this51.data.challenger=['','wolf','moleX2','huntress','wolf'];_this51.buildFloors();return _this51;}_createClass(ArenaTrialsNo2,[{key:"buildFloors",value:function buildFloors(){var _floors=[];var firstFloor;//:DngFloor;
var stairUp;//:DngRoom;
var stairDown;//:DngRoom;
firstFloor=new DngFloor("1.Floor",function(){return"Arena gauntlet #2.";});var room;//:DngRoom;
var rooms=new Map();/* first floor
        *  
        * E - B1 - B2 - B3 - B4 - B5 - E
        * |    |                   |
        * S    |  - C2 - C3 - C4 - |
        *      |  - D2 - - - -D4 - |
        * */ //Todo should be able to go into arena only once a day/with entryfee
var foo1=function(){return ArenaTrialsNo1.desc()+'</br>If you survive your first challenger, you get '+this.data.rewards[this.data.currentRoom].amount+'x '+this.data.rewards[this.data.currentRoom].id+'.</br>';}.bind(this);var foo2=function(){return'If you survive the second challenge, you get '+this.data.rewards[this.data.currentRoom].amount+'x '+this.data.rewards[this.data.currentRoom].id+'.</br>';}.bind(this);var foo3=function(){return'If you survive the third challenge, you get '+this.data.rewards[this.data.currentRoom].amount+'x '+this.data.rewards[this.data.currentRoom].id+'.</br>';}.bind(this);var foo4=function(){return'If you survive the last challenge, you get '+this.data.rewards[this.data.currentRoom].amount+'x '+this.data.rewards[this.data.currentRoom].id+'.</br>';}.bind(this);var foo5=function foo5(){return'Congratulations. You have passed all the challenges and trully earned your reward.</br>';};var _evt=new DngOperation("Retreat");_evt.canTrigger=function(){return true;};_evt.onTrigger=function(){this.renderEvent=this.renderRetreat;this.evtData={};this.renderNext(1);};rooms.set("Start",new DngRoom("Start",foo1,false));rooms.set("B1",new DngRoom("B1",null,false));rooms.set("B2",new DngRoom("B2",null,false));rooms.set("B3",new DngRoom("B3",null,false));rooms.set("B4",new DngRoom("B4",null,false));rooms.set("Exit",new DngRoom("Exit",foo5,false));DngDirection.createDirection(DngDirection.DirE,rooms.get("Start"),rooms.get("B1"),true);DngDirection.createDirection(DngDirection.DirE,rooms.get("B1"),rooms.get("B2"));DngDirection.createDirection(DngDirection.DirE,rooms.get("B2"),rooms.get("B3"));DngDirection.createDirection(DngDirection.DirE,rooms.get("B3"),rooms.get("B4"));DngDirection.createDirection(DngDirection.DirE,rooms.get("B4"),rooms.get("B5"));room=rooms.get("Exit");room.isDungeonExit=true;room=rooms.get("Start");room.isDungeonEntry=true;room.getDirection(DngDirection.DirE).onExitFct=this._fight.bind(this,1);room=rooms.get("B1");room.getDirection(DngDirection.DirE).onExitFct=this._fight.bind(this,2);room.operations=[_evt];room=rooms.get("B2");room.getDirection(DngDirection.DirE).onExitFct=this._fight.bind(this,3);room.operations=[_evt];room=rooms.get("B3");room.getDirection(DngDirection.DirE).onExitFct=this._fight.bind(this,4);room.operations=[_evt];room=rooms.get("B4");room.operations=[_evt];firstFloor.setRooms(Array.from(rooms.values()));_floors.push(firstFloor);this.setFloors(_floors);}},{key:"exitDungeon",value:function exitDungeon(){_get(_getPrototypeOf(ArenaTrialsNo2.prototype),"exitDungeon",this).call(this);window.story.show("PlainsFarmland");}},{key:"retreat",value:function retreat(){this.teleport(this.getFloor("1.Floor").getRoom("Start"));}},{key:"renderRetreat",value:function renderRetreat(evt){//
var msg='';if(evt.id===1){for(var i=1;i<this.data.rewards.length;i++){if(this.data.currentRoom>i){window.gm.player.Inv.addItem(window.gm.ItemsLib[this.data.rewards[i].id](),this.data.rewards[i].amount);}}msg+='You decided to not continue the fight.</br>';msg+=window.gm.printLink("Next",'window.gm.dng.retreat()');}return msg;}},{key:"_fight",value:function _fight(evt){this.data.currentRoom=evt;this.data.maxRoom=this.data.currentRoom>this.data.maxRoom?this.data.currentRoom:this.data.maxRoom;window.gm.encounters[this.data.challenger[this.data.currentRoom]](window.gm.player.location);window.gm.Encounter.onVictory=function(){//need to resumeRoom...
this.data.currentRoom+=1;return'Victory ! </br>Some '+this.data.rewards[this.data.currentRoom].id+' was added to the reward-pile.</br>'+window.gm.printLink('Next','window.gm.dng.resumeRoom()');}.bind(this);return true;//return true to indicate a intermittent scene
}}],[{key:"desc",value:function desc(){return"Remember: If you have earned some money you should weight the option to retreat and invest that money in better gear."+"That might give you better chances to survive the tougher fights at the cost of fighting the previous foes again.</br>"+"Grinding is fun. :)  </br>";}}]);return ArenaTrialsNo2;}(DngDungeon);window.gm.dngs=function(dngs){dngs.BeeHive=function(){return new BeeHive();};dngs.ShatteredCity=function(){return new ShatteredCity();};dngs.ArenaTrialsNo1=function(){return new ArenaTrialsNo1();};dngs.MinoLair=function(){return new MinoLair();};return dngs;}(window.gm.dngs||{});"use strict";/*bunch of combat encounters are defined here */window.gm=window.gm||{};window.gm.encounters=window.gm.encounters||{};window.gm.encounters._setup=function(params){var _params=params||{};_params.amount=params&&params.amount?params.amount:1,_params.location=params&&params.location?params.location:window.passage.name;_params.type=params&&params.type?params.type:0,_params.levelUp=params&&params.levelUp?params.levelUp:0;_params.noStart=params&&params.noStart?params.noStart:false,_params.noFlee=params&&params.noFlee?params.noFlee:false;_params.sceneDecoy=params&&params.sceneDecoy?params.sceneDecoy:{fg:[],bg:[]};window.gm.Encounter=new Encounter();window.gm.Encounter.enableFlee=!_params.noFlee;window.gm.Encounter.Location=_params.location;window.gm.Encounter.scenePic=window.gm.getScenePic(window.gm.Encounter.Location);window.gm.Encounter.sceneDecoy=_params.sceneDecoy;return _params;};//TODO Howto dynamic encounters like dryad + wolf?  
//window.gm.encounters.generic({foes:[{amount:1,type:"Wolf",sub:"AlphaWolf"},{amount:1,type:"Dryad"}],...,noStart:true}) 
//window.gm.Encounter.onSubmit=function...
//params = {location:window.passage.name, amount:1};
//params={[{amount:1,type:"Wolf",sub:"AlphaWolf", location:"cave", levelUp:3}]} but how to assign submit/defeat??
window.gm.encounters.mole=function(params){var _params=window.gm.encounters._setup(params);window.gm.Encounter.EnemyFunc=function(){var mobs=[];for(var i=_params.amount;i>0;i-=1){var x=window.gm.Mobs.Mole();x.scaleLevel(window.gm.player.level+_params.levelUp);x.name=x.baseName+'#'+i;mobs.push(x);}return mobs;};window.gm.Encounter.onSubmit=function(){return'What will now happen to you?</br>'+window.gm.printPassageLink('Next','Mole Submit');};if(!_params.noStart)window.gm.Encounter.initCombat();};window.gm.encounters.leech=function(params){var _params=window.gm.encounters._setup(params);window.gm.Encounter.EnemyFunc=function(){var mobs=[];for(var i=_params.amount;i>0;i-=1){var x=window.gm.Mobs.Leech();x.scaleLevel(window.gm.player.level+_params.levelUp);x.name=x.baseName+'#'+i;mobs.push(x);}return mobs;};if(!_params.noStart)window.gm.Encounter.initCombat();};window.gm.encounters.slime=function(params){var _params=window.gm.encounters._setup(params);window.gm.Encounter.EnemyFunc=function(){var mobs=[];for(var i=_params.amount;i>0;i-=1){var x=window.gm.Mobs.Slime(_params.type);x.scaleLevel(window.gm.player.level+_params.levelUp);x.name=x.baseName+'#'+i;mobs.push(x);}return mobs;};if(!_params.noStart)window.gm.Encounter.initCombat();};window.gm.encounters.slug=function(params){var _params=window.gm.encounters._setup(params);window.gm.Encounter.EnemyFunc=function(){var mobs=[];for(var i=_params.amount;i>0;i-=1){var x=window.gm.Mobs.Slug();x.scaleLevel(window.gm.player.level+_params.levelUp);x.name=x.baseName+'#'+i;mobs.push(x);}return mobs;};if(!_params.noStart)window.gm.Encounter.initCombat();};window.gm.encounters.spider=function(params){params.sceneDecoy={bg:['bg_web']};//TODO depends on location ?
var _params=window.gm.encounters._setup(params);window.gm.Encounter.EnemyFunc=function(){var mobs=[];for(var i=_params.amount;i>0;i-=1){var x=window.gm.Mobs.Spider();x.scaleLevel(window.gm.player.level+_params.levelUp);x.name=x.baseName+'#'+i;mobs.push(x);}return mobs;};if(!_params.noStart)window.gm.Encounter.initCombat();};window.gm.encounters.fungus=function(params){var _params=window.gm.encounters._setup(params);window.gm.Encounter.EnemyFunc=function(){var mobs=[];for(var i=_params.amount;i>0;i-=1){var x=window.gm.Mobs.Fungus(_params.type);x.scaleLevel(window.gm.player.level+_params.levelUp);x.name=x.baseName+'#'+i;mobs.push(x);}return mobs;};if(!_params.noStart)window.gm.Encounter.initCombat();};window.gm.encounters.slugLeech=function(params){var _params=window.gm.encounters._setup(params);window.gm.Encounter.EnemyFunc=function(){var mobs=[];for(var i=_params.amount;i>0;i-=1){var x=window.gm.Mobs.Slug();x.scaleLevel(window.gm.player.level+_params.levelUp);x.name=x.baseName+'#'+i;mobs.push(x);x=window.gm.Mobs.Leech();x.scaleLevel(window.gm.player.level+_params.levelUp);x.name=x.baseName+'#'+i;mobs.push(x);}return mobs;};if(!_params.noStart)window.gm.Encounter.initCombat();};window.gm.encounters.imp=function(params){var _params=window.gm.encounters._setup(params);window.gm.Encounter.EnemyFunc=function(){var mobs=[];for(var i=_params.amount;i>0;i-=1){var x=window.gm.Mobs.Imp(_params.type);x.scaleLevel(window.gm.player.level+_params.levelUp);x.name=x.baseName+'#'+i;mobs.push(x);}return mobs;};if(!_params.noStart)window.gm.Encounter.initCombat();};window.gm.encounters.succubus=function(params){var _params=window.gm.encounters._setup(params);window.gm.Encounter.EnemyFunc=function(){var mobs=[];for(var i=_params.amount;i>0;i-=1){var x=window.gm.Mobs.Succubus(_params.type);x.scaleLevel(window.gm.player.level+_params.levelUp);x.name=x.baseName+'#'+i;mobs.push(x);}return mobs;};window.gm.Encounter.onSubmit=window.gm.Encounter.onDefeat=function(){window.story.state.tmp.args=[function(){window.gm.sex.succubusOnPlayer({state:0,battleResult:'defeat'});}];return'</br>As you are defeated, the succubus steps up to you...</br>'+window.gm.printPassageLink('Next','PostCombatPassage');};if(!_params.noStart)window.gm.Encounter.initCombat();};window.gm.encounters.mechanicguy=function(params){var _params=window.gm.encounters._setup(params);window.gm.Encounter.EnemyFunc=function(){var mobs=[];for(var i=_params.amount;i>0;i-=1){var x=window.gm.Mobs.Mechanic();x.scaleLevel(window.gm.player.level+_params.levelUp);x.name=x.baseName+'#'+i;mobs.push(x);}return mobs;};if(!_params.noStart)window.gm.Encounter.initCombat();};window.gm.encounters.hawk=function(params){var _params=window.gm.encounters._setup(params);window.gm.Encounter.EnemyFunc=function(){var mobs=[];for(var i=_params.amount;i>0;i-=1){var x=window.gm.Mobs.Hawk();x.scaleLevel(window.gm.player.level+_params.levelUp);x.name=x.baseName+'#'+i;mobs.push(x);}return mobs;};if(!_params.noStart)window.gm.Encounter.initCombat();};window.gm.encounters.hornett=function(params){var _params=window.gm.encounters._setup(params);window.gm.Encounter.EnemyFunc=function(){var mobs=[];for(var i=_params.amount;i>0;i-=1){var x=window.gm.Mobs.Hornett();x.scaleLevel(window.gm.player.level+_params.levelUp);x.name=x.baseName+'#'+i;mobs.push(x);}return mobs;};if(!_params.noStart)window.gm.Encounter.initCombat();};window.gm.encounters.hornetthive=function(params){var _params=window.gm.encounters._setup(params);window.gm.Encounter.EnemyFunc=function(){var mobs=[];for(var i=2;i>0;i-=1){var x=void 0;if(i===2){//spawns always hive and a hornett
x=window.gm.Mobs.HornettHive();x.scaleLevel(window.gm.player.level+_params.levelUp);}else{x=window.gm.Mobs.Hornett();x.scaleLevel(window.gm.player.level+_params.levelUp);}x.name=x.baseName+'#'+i;mobs.push(x);}return mobs;};if(!_params.noStart)window.gm.Encounter.initCombat();};window.gm.encounters.pillRoller=function(params){var _params=window.gm.encounters._setup(params);window.gm.Encounter.EnemyFunc=function(){var mobs=[];for(var i=_params.amount;i>0;i-=1){var x=window.gm.Mobs.PillRoller();x.scaleLevel(window.gm.player.level+_params.levelUp);x.name=x.baseName+'#'+i;mobs.push(x);}return mobs;};if(!_params.noStart)window.gm.Encounter.initCombat();};window.gm.encounters.huntress=function(params){var _params=window.gm.encounters._setup(params);window.gm.Encounter.EnemyFunc=function(){var mobs=[];for(var i=_params.amount;i>0;i-=1){var x=window.gm.Mobs.Huntress();x.scaleLevel(window.gm.player.level+_params.levelUp);x.name=x.baseName+'#'+i;mobs.push(x);}return mobs;};if(!_params.noStart)window.gm.Encounter.initCombat();};window.gm.encounters.lizan=function(params){var _params=window.gm.encounters._setup(params);window.gm.Encounter.EnemyFunc=function(){var mobs=[];for(var i=_params.amount;i>0;i-=1){var x=window.gm.Mobs.Lizan();x.scaleLevel(window.gm.player.level+_params.levelUp);x.name=x.baseName+'#'+i;mobs.push(x);}return mobs;};if(!_params.noStart)window.gm.Encounter.initCombat();};window.gm.encounters.naga=function(params){var _params=window.gm.encounters._setup(params);window.gm.Encounter.EnemyFunc=function(){var mobs=[];for(var i=_params.amount;i>0;i-=1){var x=window.gm.Mobs.naga(_params.type);x.scaleLevel(window.gm.player.level+_params.levelUp);x.name=x.baseName+'#'+i;mobs.push(x);}return mobs;};if(!_params.noStart)window.gm.Encounter.initCombat();};window.gm.encounters.cat=function(params){var _params=window.gm.encounters._setup(params);window.gm.Encounter.EnemyFunc=function(){var mobs=[];for(var i=_params.amount;i>0;i-=1){var x=window.gm.Mobs.Cat(_params.type);x.scaleLevel(window.gm.player.level+_params.levelUp);if(_.random(1,100)>50){window.gm.MutationsLib.swapGender(x,window.storage.constructors["VulvaHuman"]);}x.name=x.baseName+'#'+i;mobs.push(x);}return mobs;};if(!_params.noStart)window.gm.Encounter.initCombat();};window.gm.encounters.wolf=function(params){var _params=window.gm.encounters._setup(params);window.gm.Encounter.EnemyFunc=function(){var mobs=[];for(var i=_params.amount;i>0;i-=1){var x=void 0;x=window.gm.Mobs.Wolf(_params.type);x.scaleLevel(window.gm.player.level+_params.levelUp);if(_.random(1,100)>50){window.gm.MutationsLib.swapGender(x,window.storage.constructors["VulvaHuman"]);}x.name=x.baseName+'#'+i;mobs.push(x);}return mobs;};window.gm.Encounter.onSubmit=window.gm.Encounter.onDefeat=function(){window.story.state.tmp.args=[function(){window.gm.sex.wolfOnPlayer({state:0,battleResult:'defeat'});}];return'You cannot fight anymore and surrender to the beast.</br>'+window.gm.printPassageLink('Next','PostCombatPassage');};window.gm.Encounter.onVictory=function(){window.story.state.tmp.args=[function(){window.gm.sex.wolfOnPlayer({state:0,battleResult:'victory'});}];return'Intimitated, the wolf rolls on its back, whimpering submissively and exposing its throat.</br>'+this.fetchLoot()+'</br>'+window.gm.printPassageLink('Next','PostCombatPassage');//return('Intimitated, the wolf rolls on its back, whimpering submissively and exposing its throat.</br>'+this.fetchLoot()+'</br>'+ window.gm.printPassageLink('Next','WolfVictory'));
};/*window.gm.Encounter.sceneDone=false; //attach flag to Encounter-Instance;
    window.gm.Encounter.onMoveSelect = function(){
        let s=window.story.state;
        let result = {OK:false, msg:''};
        if(window.gm.Encounter.sceneDone===false && s.combat.turnCount===3){
            result.OK=window.gm.Encounter.sceneDone=true;
            result.msg = 'Wolf growls at you.</br>'+ window.gm.printPassageLink('Next','WolffightIntermezzo');
        } 
        return(result);
    }*/if(!_params.noStart)window.gm.Encounter.initCombat();};window.gm.encounters.lapine=function(params){var _params=window.gm.encounters._setup(params);window.gm.Encounter.EnemyFunc=function(){var mobs=[];for(var i=_params.amount;i>0;i-=1){var x=window.gm.Mobs.Lapine();x.scaleLevel(window.gm.player.level+_params.levelUp);x.name=x.baseName+'#'+i;mobs.push(x);}return mobs;};window.gm.Encounter.onSubmit=window.gm.Encounter.onDefeat=function(){window.story.state.tmp.args=[function(){window.gm.sex.lapineOnPlayer({state:0,battleResult:'defeat'});}];return'That bunny literally kicked your ass.</br>'+window.gm.printPassageLink('Next','PostCombatPassage');};window.gm.Encounter.onVictory=function(){window.story.state.tmp.args=[function(){window.gm.sex.lapineOnPlayer({state:0,battleResult:'victory'});}];return'The bunny surrenders.</br>'+this.fetchLoot()+'</br>'+window.gm.printPassageLink('Next','PostCombatPassage');};if(!_params.noStart)window.gm.Encounter.initCombat();};window.gm.encounters.anthrocat=function(params){var _params=window.gm.encounters._setup(params);window.gm.Encounter.EnemyFunc=function(){var mobs=[];for(var i=_params.amount;i>0;i-=1){var x=window.gm.Mobs.AnthroCat();x.scaleLevel(window.gm.player.level+_params.levelUp);x.name=x.baseName+'#'+i;mobs.push(x);}return mobs;};window.gm.Encounter.onSubmit=window.gm.Encounter.onDefeat=function(){window.story.state.tmp.args=[function(){window.gm.sex.lapineOnPlayer({state:0,battleResult:'defeat'});}];//todo
return'Raked by a cat....</br>'+window.gm.printPassageLink('Next','PostCombatPassage');};window.gm.Encounter.onVictory=function(){window.story.state.tmp.args=[function(){window.gm.sex.lapineOnPlayer({state:0,battleResult:'victory'});}];//todo
return'The cat surrenders.</br>'+this.fetchLoot()+'</br>'+window.gm.printPassageLink('Next','PostCombatPassage');};if(!_params.noStart)window.gm.Encounter.initCombat();};window.gm.encounters.anthrowolf=function(params){var _params=window.gm.encounters._setup(params);window.gm.Encounter.EnemyFunc=function(){var mobs=[];for(var i=_params.amount;i>0;i-=1){var x=window.gm.Mobs.AnthroWolf();x.scaleLevel(window.gm.player.level+_params.levelUp);x.name=x.baseName+'#'+i;mobs.push(x);}return mobs;};window.gm.Encounter.onSubmit=window.gm.Encounter.onDefeat=function(){window.story.state.tmp.args=[function(){window.gm.sex.wolfOnPlayer({state:0,battleResult:'defeat'});}];return'You cannot fight anymore and surrender to the beast.</br>'+window.gm.printPassageLink('Next','PostCombatPassage');};window.gm.Encounter.onVictory=function(){window.story.state.tmp.args=[function(){window.gm.sex.wolfOnPlayer({state:0,battleResult:'victory'});}];return'Intimitated, the wolf rolls on its back, whimpering submissively and exposing its throat.</br>'+this.fetchLoot()+'</br>'+window.gm.printPassageLink('Next','PostCombatPassage');//return('Intimitated, the wolf rolls on its back, whimpering submissively and exposing its throat.</br>'+this.fetchLoot()+'</br>'+ window.gm.printPassageLink('Next','WolfVictory'));
};if(!_params.noStart)window.gm.Encounter.initCombat();};window.gm.encounters.dryad=function(params){var _params=window.gm.encounters._setup(params);window.gm.Encounter.EnemyFunc=function(){var mobs=[];for(var i=_params.amount;i>0;i-=1){var x=window.gm.Mobs.Dryad();x.scaleLevel(window.gm.player.level+_params.levelUp);x.name=x.baseName+'#'+i;mobs.push(x);}return mobs;};window.gm.Encounter.onSubmit=window.gm.Encounter.onDefeat=function(){window.story.state.tmp.args=[function(){window.gm.sex.dryadOnPlayer({state:0,battleResult:'defeat'});}];return'You cannot fight anymore and surrender to the strange woman.</br>'+window.gm.printPassageLink('Next','PostCombatPassage');};window.gm.Encounter.onVictory=function(){window.story.state.tmp.args=[function(){window.gm.sex.dryadOnPlayer({state:0,battleResult:'victory'});}];return'The dryad has run out of energy.</br>'+this.fetchLoot()+'</br>'+window.gm.printPassageLink('Next','PostCombatPassage');};if(!_params.noStart)window.gm.Encounter.initCombat();};/////////////////////////////////////////////////////////////
//special encounter
window.gm.encounters.Carlia=function(params){var _params=window.gm.encounters._setup(params);window.gm.Encounter.EnemyFunc=function(){var x=window.story.state.chars.Carlia;x.name=x.baseName;x.Stats.increment("health",9999);x.Stats.increment("energy",9999);x.Stats.increment("will",9999);return[x];};window.gm.Encounter.onSubmit=window.gm.Encounter.onDefeat=function(){return'You surrender to the monster-girl.</br>'+window.gm.printPassageLink('Next','CarliaSubmit');};window.gm.Encounter.onVictory=function(){return'Carlia doesnt want to fight anymore.</br>'+window.gm.printPassageLink('Next','CarliaVictory');};window.gm.Encounter.sceneDone=0;//attach flag to Encounter-Instance;
window.gm.Encounter.onMoveSelect=function(){var s=window.story.state;var result={OK:false,msg:''};if(window.gm.Encounter.sceneDone===0&&s.combat.turnCount>=4){result.OK=window.gm.Encounter.sceneDone=100;window.gm.Encounter.endCombat();result.msg=window.gm.printPassageLink('Next','CarliaMakeDeal');}return result;};if(noStart===false)window.gm.Encounter.initCombat();};window.gm.encounters.Trent=function(params){var _params=window.gm.encounters._setup(params);window.gm.Encounter.EnemyFunc=function(){var x=window.story.state.chars.Trent;x.name=x.baseName;x.Stats.increment("health",9999);x.Stats.increment("energy",9999);x.Stats.increment("will",9999);return[x];};window.gm.Encounter.onSubmit=window.gm.Encounter.onDefeat=function(){return'You cannot fight anymore and surrender to the beast-man.</br>'+window.gm.printPassageLink('Next','TrentSubmit');};window.gm.Encounter.onVictory=function(){return'It was barely an even fight but you showed this horsy its place.</br>'+window.gm.printPassageLink('Next','TrentVictory');};if(noStart===false)window.gm.Encounter.initCombat();};window.gm.encounters.Ruff=function(params){var _params=window.gm.encounters._setup(params);window.gm.Encounter.EnemyFunc=function(){var x=window.story.state.chars.Ruff;x.name=x.baseName;x.Stats.increment("health",9999);x.Stats.increment("energy",9999);x.Stats.increment("will",9999);return[x];};/*window.gm.Encounter.onSubmit =window.gm.Encounter.onDefeat = function(){
        return('You cannot fight anymore and surrender to the beast.</br>'+ window.gm.printPassageLink('Next','RuffSubmit')); //TODO !!
    }
    window.gm.Encounter.onVictory = function(){
        return('you dominated him.</br>'+ window.gm.printPassageLink('Next','RuffVictory'));
    }*/if(!_params.noStart)window.gm.Encounter.initCombat();};"use strict";window.gm.dbgHelper=function(){window.gm.getSaveVersion();};/* bundles some utility operations*/window.gm.getSaveVersion=function(){return[0,0,1,0];};// reimplement to setup the game
var _origInitGame=window.gm.initGame;window.gm.initGame=function(forceReset){var NGP=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;_origInitGame(forceReset,NGP);window.gm.images=imagesBattlers(window.gm.images||{});window.gm.images=imagesMaps(window.gm.images);window.gm.images=imagesEquip(window.gm.images);window.gm.images=imagesIcons(window.gm.images);window.gm.images=imagesScenes(window.gm.images);window.gm.images=imagesItems(window.gm.images);//if svg have no size set, they use whole space, use this to force them to fit into a box
window.gm.images._sizeTo=function(_pic,width,height){var node=SVG(_pic);node.width(width),node.height(height);return node.node.outerHTML;};var s=window.story.state;s._gm.timeRL=s._gm.timeVR=s._gm.time;s._gm.dayRL=s._gm.dayVR=s._gm.day;s._gm.debug=1,//   <==    TODO set debug to 0 for distribution or 1 for debug!
s._gm.dbgShowCombatRoll=true,s._gm.dbgShowQuestInfo=true;s._gm.dbgShowMoreInfo=true;if(!s.vars||forceReset){var _s$vars;// storage of variables that doesnt fit player
s.vars=(_s$vars={inVR:false,spawnAt:'ForestRespawnPodExit',playerPartyVR:[],//names of chars
playerPartyRL:[],//flags for global states
qDogSit:0,// see park
qUnlockCampus:0,//see passage into city
qUnlockPark:0,qUnlockMall:0,qUnlockBeach:0,qUnlockDowntown:0,qUnlockNorthlake:0,qUnlockRedlight:0},_defineProperty(_s$vars,"qUnlockBeach",0),_defineProperty(_s$vars,"crowBarLeft",1),_defineProperty(_s$vars,"wolfKnowledge",0),_defineProperty(_s$vars,"wolfSubmit",0),_defineProperty(_s$vars,"wolfVictory",0),_s$vars);}if(!s.mom||forceReset){s.mom={location:"Kitchen",coffeeStore:5,foodStore:3,foodMaxStore:4};}if(!s.chars.Cyril||forceReset){//
var ch=new Character();ch.name=ch.id="Cyril";ch.faction="Player";ch.unique=true;//add some basic inventory
ch.Outfit.addItem(new BaseHumanoid());ch.Outfit.addItem(new SkinHuman());ch.Outfit.addItem(HandsHuman.factory('human'));ch.Outfit.addItem(new FaceHuman());ch.Wardrobe.addItem(new Jeans());ch.Wardrobe.addItem(new TankShirt());ch.Outfit.addItem(new Jeans());ch.Outfit.addItem(new TankShirt());ch.Stats.increment('strength',3);s.chars.Cyril=ch;}if(!s.chars.Carlia||forceReset){//the cat/dog-woman
var _ch3=new Carlia();s.chars.Carlia=_ch3;}if(!s.chars.Ruff||forceReset){//Ruff the wolf
s.chars.Ruff=new Ruff();}if(!s.chars.Clyde||forceReset){//Clyde the foxman
s.chars.Clyde=new Clyde();}if(!s.chars.Trent||forceReset){//the horse-bully from the bridge
var _ch4=new Trent();_ch4.name=_ch4.id="Trent";_ch4.unique=true;s.chars.Trent=_ch4;}if(!s.chars.PlayerVR||forceReset){var _ch5=new Character();_ch5.id="PlayerVR";_ch5.name="Zeph";_ch5.unique=true;_ch5.faction="Player";//body
_ch5.Outfit.addItem(new BaseHumanoid());_ch5.Outfit.addItem(new SkinHuman());_ch5.Outfit.addItem(new FaceHuman());_ch5.Outfit.addItem(HeadHairHuman.factory('smooth'));_ch5.Outfit.addItem(HandsHuman.factory('human'));_ch5.Outfit.addItem(AnusHuman.factory('human'));_ch5.Outfit.addItem(PenisHuman.factory('human'));_ch5.Outfit.addItem(new Briefs());_ch5.Outfit.addItem(window.gm.ItemsLib.ShortsDenim());_ch5.Outfit.addItem(new Sneakers());_ch5.Outfit.addItem(new TankShirt());if(s._gm.debug){_ch5.Skills.addItem(new SkillInspect());_ch5.Skills.addItem(new SkillUltraKill());_ch5.Skills.addItem(SkillCallHelp.factory('Wolf'));_ch5.Skills.addItem(SkillDetermined.factory());_ch5.Skills.addItem(new SkillStun());_ch5.Skills.addItem(new SkillHeal());_ch5.Skills.addItem(new SkillTease());_ch5.Skills.addItem(new SkillSubmit());}//ch.Effects.addItem(effMutator.factory("")); //Mutationlogic
s.chars.PlayerVR=_ch5;}if(!s.chars.PlayerRL||forceReset){var _ch6=new Character();_ch6.id="PlayerRL";_ch6.name="Andrew";_ch6.unique=true;_ch6.faction="Player";//ch.Effects.addItem(new skCooking());
//add some basic inventory
_ch6.Inv.addItem(new Money(),20);_ch6.Inv.addItem(new LighterDad());_ch6.Inv.addItem(new FlashBang(),2);_ch6.Inv.addItem(new CanOfCoffee(),2);_ch6.Wardrobe.addItem(new Jeans());_ch6.Wardrobe.addItem(new Briefs());_ch6.Wardrobe.addItem(new Sneakers());_ch6.Wardrobe.addItem(new TankShirt());_ch6.Wardrobe.addItem(new Pullover());_ch6.Outfit.addItem(new BaseHumanoid());_ch6.Outfit.addItem(new FaceHuman());_ch6.Outfit.addItem(HandsHuman.factory('human'));_ch6.Outfit.addItem(new SkinHuman());_ch6.Outfit.addItem(AnusHuman.factory('human'));_ch6.Outfit.addItem(PenisHuman.factory('human'));_ch6.Wardrobe.addItem(new Briefs());_ch6.Outfit.addItem(new Jeans());_ch6.Outfit.addItem(new Sneakers());_ch6.Outfit.addItem(new Pullover());//special skills
_ch6.Effects.addItem(new effNotTired());//depending on sleep Tired will be set to NotTired or Tired
//ch.Skills.addItem(SkillCallHelp.factory('Mole'));
s.chars.PlayerRL=_ch6;}/*let dngs = [BeeHive,ShatteredCity]; //add your dngs here !
    for(var n of dngs){
      if (!s.dng[n.name]||forceReset){ 
        s.dng[n.name] = n.persistentDngDataTemplate();
      }
    } */window.gm.initGameFlags(forceReset,NGP);window.gm.switchPlayer("PlayerRL");//take over flags for newgameplus
if(NGP){window.story.state.vars.crowBarLeft=NGP.crowBarLeft;}NGP=null;//release memory
};//this initialises game-objects that are not class-based
window.gm.initGameFlags=function(forceReset){var NGP=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var s=window.story.state,map,data;function dataPrototype(){return{visitedTiles:[],mapReveal:[],tmp:{},version:0};}if(forceReset){s.Settings=s.DngCV=s.DngDF=s.DngAM=s.DngSY=s.DngMN=s.DngAT=null;s.DngFM=s.DngSC=s.DngLB=s.DngHC=s.DngPC=s.DngNG=null;s.NGP={};s.Know={};}var Know={};var Settings={showCombatPictures:true,showNSFWPictures:true,showDungeonMap:true,nonMetric:false//TODO
};if(!window.gm.achievements){//||forceReset) { 
window.gm.resetAchievements();}window.storage.loadAchivementsFromBrowser();var DngSY={remainingNights:0,dngLevel:1,//tracks the mainquest you have finished
dngOW:false,//if this flag is set while in dng, player is here for some freeplay (no quest)  
dildo:0,//1 small oraltraining,
pussy:0,//////////////////////////
visitedTiles:[],mapReveal:[],dng:'',//current dungeon name
prevLocation:'',nextLocation:'',//used for nav-logic
dngMap:{}//dungeon map info
};var DngAM=dataPrototype();var DngAT=dataPrototype();var DngDF=dataPrototype();DngDF.plum={},//which plums got collected
DngDF.lapine={};var DngFM=dataPrototype();var DngHC=dataPrototype();if(s.NGP&&NGP!=null){//update if exist
s.NGP=window.gm.util.mergePlainObject(NGP,s.NGP);}var DngPC=dataPrototype();if(s.DngPC){//update if exist
window.gm.build_DngPC();s.DngPC=window.gm.util.mergePlainObject(DngPC,s.DngPC);}var DngNG=dataPrototype();if(s.DngNG){//update if exist
window.gm.build_DngNG();s.DngNG=window.gm.util.mergePlainObject(DngNG,s.DngNG);}var DngLB=dataPrototype();var DngSC=dataPrototype();var DngCV=dataPrototype();var DngMN=dataPrototype();DngMN.page={};//which bookpages got collected
//see comment in rebuildFromSave why this is done
s.Settings=window.gm.util.mergePlainObject(Settings,s.Settings);s.Know=window.gm.util.mergePlainObject(Know,s.Know);s.DngDF=window.gm.util.mergePlainObject(DngDF,s.DngDF);s.DngAM=window.gm.util.mergePlainObject(DngAM,s.DngAM);s.DngSY=window.gm.util.mergePlainObject(DngSY,s.DngSY);s.DngCV=window.gm.util.mergePlainObject(DngCV,s.DngCV);s.DngMN=window.gm.util.mergePlainObject(DngMN,s.DngMN);s.DngAT=window.gm.util.mergePlainObject(DngAT,s.DngAT);s.DngFM=window.gm.util.mergePlainObject(DngFM,s.DngFM);s.DngSC=window.gm.util.mergePlainObject(DngSC,s.DngSC);s.DngHC=window.gm.util.mergePlainObject(DngHC,s.DngHC);s.DngLB=window.gm.util.mergePlainObject(DngLB,s.DngLB);s.DngPC=window.gm.util.mergePlainObject(DngPC,s.DngPC);s.DngNG=window.gm.util.mergePlainObject(DngNG,s.DngNG);//todo cleanout obsolete data ( filtering those not defined in template) 
};window.gm.resetAchievements=function(){//declare achievements here
window.gm.achievements={looseEnd:0};window.gm.achievementsInfo={//this is kept separate to not bloat savegame
//hidden bitmask: 0= all visisble, 1= Name ???, 2= Todo ???
looseEnd:{set:1,hidden:3,name:"loose end",descToDo:"Find a loose end.",descDone:"Found a link without target. Gained a NGPtoken."}//
};};// update non-class-objects of previous savegame
var _origRebuildObjects=window.gm.rebuildObjects;window.gm.rebuildObjects=function(){var s=window.story.state;_origRebuildObjects();window.gm.initGameFlags(false,null);};// lookup function for sidebar icon
window.gm.getSidebarPic=function(){//todo display doll ??
if(window.story.state.vars.inVR){return"assets/icons/icon_swordspade.svg";}return'assets/icons/icon_cityskyline.svg';};// lookup function for scene background ( 640x300 )
window.gm.getScenePic=function(id){var x='',y;if(id==='Garden'||id==='Park')return'assets/bg/bg_park.png';if(id==='Bedroom'||id==='Your Bedroom')return'assets/bg/bg_bedroom.png';if(id.slice(0,7)==='AM_Lv2_')return'assets/bg/bg_dungeon_2.png';if(id.slice(0,5)==='DngPC'||id.slice(0,5)==='DngHC'){x=id.slice(6,8);y=[{x:["H4","I4"],p:'bg_dungeon_2.png'},{x:["I4","J4"],p:'bg_dungeon_4.png'},{x:["F4","F5"],p:'bg_dungeon_3.png'}];var _iterator95=_createForOfIteratorHelper(y),_step95;try{for(_iterator95.s();!(_step95=_iterator95.n()).done;){var n=_step95.value;if(n.x.indexOf(x)>=0)return'assets/bg/'+n.p;}}catch(err){_iterator95.e(err);}finally{_iterator95.f();}return'assets/bg/bg_dungeon_2.png';}if(id.slice(0,5)==='DngCV'){x=id.slice(6,8);y=[{x:["I3","I4"],p:'bg_cave_4.png'}];var _iterator96=_createForOfIteratorHelper(y),_step96;try{for(_iterator96.s();!(_step96=_iterator96.n()).done;){var n=_step96.value;if(n.x.indexOf(x)>=0)return'assets/bg/'+n.p;}}catch(err){_iterator96.e(err);}finally{_iterator96.f();}return'assets/bg/bg_cave_2.png';}return'assets/bg_park.png';//return('assets/bg/bg_VR_1.png');//todo placehodler
};window.gm.enterVR=function(){var s=window.story.state;if(s.vars.inVR)return;s.vars.playerPartyRL=s._gm.playerParty;s._gm.playerParty=s.vars.playerPartyVR;window.gm.switchPlayer("PlayerVR");s.vars.inVR=true;//time in VR is paused when in RL
s._gm.timeRL=s._gm.time,s._gm.dayRL=s._gm.day;s._gm.time=s._gm.timeVR,s._gm.day=s._gm.dayVR;window.gm.addTime(0);window.gm.respawn({keepInventory:true});};window.gm.leaveVR=function(){//todo update effects in VR but stop RL effects
var s=window.story.state;if(!s.vars.inVR)return;s.vars.playerPartyVR=s._gm.playerParty;s._gm.playerParty=s.vars.playerPartyRL;window.gm.switchPlayer("PlayerRL");s.vars.inVR=false;//while in VR time in RL is paused but advances 1h on leave??
s._gm.timeVR=s._gm.time,s._gm.dayVR=s._gm.day;s._gm.time=s._gm.timeRL,s._gm.day=s._gm.dayRL;window.gm.addTime(60);//todo copy fetish-stats back to RLPlayer ?
};window.gm.fightArena=function(enc,params,prize,next){window.gm.encounters[enc](params);window.gm.Encounter.onVictory=function(){window.story.state.dng.arena.loot=window.story.state.dng.arena.loot.concat(prize);return'You defeated the enemy. '+this.fetchLoot()+'</br>'+window.gm.printPassageLink('Next',next);};window.gm.Encounter.onFlee=function(){return'After your retreat you find your way back to start-position.</br>'+window.gm.printLink('Next','window.gm.postDefeat()');};};window.gm.cursedChest=function(next){var rnd=_.random(0,100);//this is rolling the dice, then call Loot-paasage !
window.story.state.tmp.args=[window.passage.name,rnd,next];};//call this after onVictory/onFlee-scene to continue in dng or other location
//this function is also used to restore after loading save !
window.gm.postVictory=function(params){var reloadDng=window.gm.dng===null;if(window.story.state.dng.id!==""){if(reloadDng)window.gm.dng=window.gm.dngs[window.story.state.dng.id]();var floor=window.gm.dng.getFloor(window.story.state.dng.floorId);var room=floor.getRoom(window.story.state.dng.roomId);if(reloadDng)window.gm.dng.enterDungeon();//first call enterdungeon to setup everything !
window.gm.dng.teleport(room);}else{window.story.show(window.gm.player.location);//history disabled ! window.story.history[window.story.history.length - 1], true);   
}};//call this after your onDefeat/onSubmit-scene to respawn at respawn-point; cleansup dng-variables
window.gm.postDefeat=function(){window.story.state.dng.id="";window.gm.dng=null;window.gm.respawn();};//after passing out: heal player and remove inventory {keepInventory=false,location=''}
window.gm.respawn=function(){var conf=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{keepInventory:false};var _iterator97=_createForOfIteratorHelper(window.story.state._gm.playerParty),_step97;try{for(_iterator97.s();!(_step97=_iterator97.n()).done;){var name=_step97.value;var _x=window.story.state.chars[name];_x.Stats.increment("energy",9999);_x.Stats.increment("will",9999);_x.Stats.increment("health",9999);}}catch(err){_iterator97.e(err);}finally{_iterator97.f();}window.gm.player.Stats.increment("energy",9999);window.gm.player.Stats.increment("will",9999);window.gm.player.Stats.increment("health",9999);var msg='';if(!conf.keepInventory){//remove inentory and outfit that is not questitem, cursed or permanent
for(var i=window.gm.player.Outfit.list.length-1;i>=0;i-=1){var n=window.gm.player.Outfit.list[i];if(n.item&&n.item.lossOnRespawn){window.gm.player.Outfit.removeItem(n.id,true);msg+=n.item.name+', ';}}for(var _i9=window.gm.player.Wardrobe.list.length-1;_i9>=0;_i9-=1){var _n5=window.gm.player.Wardrobe.list[0];if(_n5.item.lossOnRespawn){window.gm.player.Wardrobe.removeItem(_n5.id,_n5.count);msg+=_n5.item.name+', ';}}for(var _i10=window.gm.player.Inv.list.length-1;_i10>=0;_i10-=1){var _n6=window.gm.player.Inv.list[_i10];if(_n6.item.lossOnRespawn){window.gm.player.Inv.removeItem(_n6.id,_n6.count);msg+=_n6.item.name+', ';}}if(msg.length>0)msg="</br>You lost "+msg.substr(0,msg.length-2);}/*if(window.gm.quests.getMilestoneState("qDiedAgain").id===2){
    window.story.show('YouDiedOnce'); 
  } else if([100,200,300].includes(window.gm.quests.getMilestoneState("qBondageKink").id)){
      window.story.show('YouDiedWithCursedGear');
  } else {*/var robes;if(window.gm.player.Outfit.getItemForSlot(window.gm.OutfitSlotLib.Breast)===null){robes=window.gm.ItemsLib['PrisonerCloths']();window.gm.makeCursedItem(robes,{minItems:2,convert:'HarnessRubber'});window.gm.player.Wardrobe.addItem(robes);window.gm.player.Outfit.addItem(robes);}if(window.gm.player.Outfit.getItemForSlot(window.gm.OutfitSlotLib.uHips)===null){robes=window.gm.ItemsLib['Knickers']();window.gm.player.Wardrobe.addItem(robes);window.gm.player.Outfit.addItem(robes);}if(window.gm.player.Outfit.getItemForSlot(window.gm.OutfitSlotLib.LHand)===null){var staff=new window.storage.constructors['StaffWodden']();//window.gm.player.Inv.addItem(staff);
window.gm.player.Outfit.addItem(staff);}window.story.state.tmp.msg=msg;//msg for display
window.story.show(window.story.state.vars.spawnAt);//}
};//sets current player location and advances time
//call this in passage header
window.gm.moveHere=function(){var time=arguments.length>0&&arguments[0]!==undefined?arguments[0]:15;if(window.gm.player.location!==window.passage.name){window.gm.player.location=window.passage.name;var s=window.story.state.vars;switch(window.passage.name){//when crossing a certain point, set spawnpoint
case'ForestBorder':s.spawnAt='ForestRespawnPodExit';break;case'VillageMarketPlace':s.spawnAt='VillageRespawnPodExit';break;case'AM_Lv2_Start':s.spawnAt='AM_Lv2_Start';break;default:break;}window.gm.addTime(time);}};/* used for the dungeons ..state.DngSY.dng. Creates links for adjoined tiles by adding the following code in passage: 
* <%=window.gm.printNav('go west','west')%> OR <%=window.gm.printNav()%> for all directions
* creates link for ('enter door', 'north'):  [[enter door| DngMN_F2]]  - assuming you are in tile DngMN_F3 in DngMN_Lv3 
* only creates the link if the passage with this name exist and the direction in the dngMap is specified 
*/window.gm.printNav=function(label,dir){var args=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;if(!label&&!dir){return'</br><p>'+window.gm.printNav('Go north','north',args)+'</br>'+window.gm.printNav('Go west','west',args)+' '+window.gm.printNav('Go east','east',args)+'</br>'+window.gm.printNav('Go south','south',args)+'</br></p>';}var foo=args!==null&&args.func?args.func:function(to){return'window.story.show(\"'+to+'\");';};var here=window.passage.name.replace(window.story.state.DngSY.dng+'_','');var to,k,i=0,split;var X=['A','B','C','D','E','F','G','H','I','J','K','L','M','N'],Y=['0','1','2','3','4','5','6','7','8','9'];if(X.findIndex(function(_x){return _x===here[0];})>=0){//checkerboard-style A1
switch(dir){case'north':i=Y.findIndex(function(_x){return _x===here[1];});if(i<0||i<=0)return'';to=here[0]+Y[i-1];break;case'south':i=Y.findIndex(function(_x){return _x===here[1];});if(i<0||i>=Y.length-1)return'';to=here[0]+Y[i+1];break;case'east':i=X.findIndex(function(_x){return _x===here[0];});if(i<0||i>=X.length-1)return'';to=X[i+1]+here[1];break;case'west':i=X.findIndex(function(_x){return _x===here[0];});if(i<0||i<=0)return'';to=X[i-1]+here[1];break;default:return'';}}else{//coord-style 01_05
split=here.split("_");switch(dir){case'north':i=parseInt(split[1]);if(i<0||i<=0)return'';to=split[0]+'_'+window.gm.util.formatInt(i-1,false,2);break;case'south':i=parseInt(split[1]);if(i<0||i>99)return'';to=split[0]+'_'+window.gm.util.formatInt(i+1,false,2);break;case'east':i=parseInt(split[0]);if(i<0||i>99)return'';to=window.gm.util.formatInt(i+1,false,2)+'_'+split[1];break;case'west':i=parseInt(split[0]);if(i<0||i<=0)return'';to=window.gm.util.formatInt(i-1,false,2)+'_'+split[1];break;default:return'';}}var room,grid=window.story.state.DngSY.dngMap.grid.values(),found=false;var _iterator98=_createForOfIteratorHelper(grid),_step98;try{for(_iterator98.s();!(_step98=_iterator98.n()).done;){room=_step98.value;if(room.room===here){for(k=room.dirs.length-1;k>=0;k--){if(room.dirs[k].dir===to){found=true;break;}}if(found)break;}}}catch(err){_iterator98.e(err);}finally{_iterator98.f();}if(!found)return'';//no dir
to=window.story.state.DngSY.dng+'_'+to;if(!window.story.passage(to))return'';//no passage
return window.gm.printLink(label,foo(to));//return(window.gm.printPassageLink(label,to));
};window.gm.rollExploreCity=function(){var s=window.story.state;var places=[];var r=_.random(0,100);//todo:depending of your actual location you have a chance to find connected locations or end up in a known one
if(window.gm.player.location=='Park')places=['Mall','Beach','Downtown'];if(window.gm.player.location=='Mall')places=['Park','Beach','Downtown'];if(window.gm.player.location=='Beach')places=['Park','Mall'];if(window.gm.player.location=='Downtown'){places.push('Pawn shop');}if(places.length==0)places=[window.gm.player.location];//fallback if unspeced location
r=_.random(1,places.length)-1;//chances are equal
window.gm.addTime(20);window.story.show(places[r]);};window.gm.giveCyrilFood=function(){if(window.gm.player.Inv.countItem('SimpleFood')>0){var res=window.gm.player.Inv.use('SimpleFood',window.story.state.Cyril);window.gm.printOutput(res.msg);}else{window.gm.printOutput("you have no food to spare");}};/*
* prints a (svg-) map  
*/window.gm.printMap=function(MapName,playerTile,reveal,visitedTiles){var width=600,height=300;var draw=document.querySelector("#canvas svg");if(!draw)draw=SVG().addTo('#canvas').size(width,height);else draw=SVG(draw);//recover svg document instead appending new one
draw.rect(width,height).attr({fill:'#303030'});var node=SVG(window.gm.images[MapName]());if(playerTile!==''&&visitedTiles.indexOf(playerTile)<0){visitedTiles.push(playerTile);}//node.find("#AM_Lv2_A1")[0].addClass('roomNotFound');
var _n,n,list=node.find('[data-reveal]');var _iterator99=_createForOfIteratorHelper(list),_step99;try{for(_iterator99.s();!(_step99=_iterator99.n()).done;){n=_step99.value;var x=parseInt(n.attr('data-reveal'),16);if((x&reveal)===0)n.addClass('roomNotFound');}}catch(err){_iterator99.e(err);}finally{_iterator99.f();}var _iterator100=_createForOfIteratorHelper(visitedTiles),_step100;try{for(_iterator100.s();!(_step100=_iterator100.n()).done;){n=_step100.value;if(n===playerTile)continue;_n=node.find('#'+n)[0];if(_n){_n.removeClass('roomFound');_n.addClass('roomVisited');}}}catch(err){_iterator100.e(err);}finally{_iterator100.f();}_n=node.find('#'+playerTile)[0];if(_n){_n.removeClass('roomFound');_n.addClass('playerPosition');}node.addTo(draw);};/* 
* constructs map from template and dng-data
*/window.gm.printMap2=function(dng,playerTile,reveal,visitedTiles){if(!window.story.state.Settings.showDungeonMap)return;//disabled
var step=32,width=step*(dng.width||12),height=step*(dng.height||8),coostyle='';var X=['A','B','C','D','E','F','G','H','I','J','K','L','M','N'],Y=['0','1','2','3','4','5','6','7','8','9'];var mypopup=document.getElementById("svgpopup");//todo popup-functions as parameters
function showPopup(evt){//var iconPos = evt.getBoundingClientRect();
mypopup.style.left=evt.x+12+"px";//(iconPos.right + 20) + "px";
mypopup.style.top=evt.y-12+"px";//(window.scrollY + iconPos.top - 60) + "px";
mypopup.textContent=evt.currentTarget.id;mypopup.style.display="block";}function hidePopup(evt){mypopup.style.display="none";}function nameToXY(name){var _x,_y,coord,pos={x:0,y:0};if(coostyle===''){//detect coord name style once
_x=X.findIndex(function(el){return el===name[0];});if(_x>-1){coostyle='A1';}else if(name.split('_').length===2){coostyle="12_01";}else throw new Error("cannot detect coord style");}switch(coostyle){case'A1':_x=Y.findIndex(function(el){return el===name[1];});_y=X.findIndex(function(el){return el===name[0];});break;case"12_01":coord=name.split('_');_x=parseInt(coord[0],10);_y=parseInt(coord[1],10);}pos.y=_y*step;pos.x=_x*step;return pos;}function addAnno(){//add up to 4 annotation-letters
var dx2=[6,6,-6,-6],dy2=[0,10,10,0];//
for(k=room.anno?room.anno.length-1:-1;k>=0;k--){if(k>3)continue;lRoom.text(function(add){add.tspan(room.anno[k]);}).addClass('textLabel').ax(_rA.cx()+ox+dx2[k]).ay(_rA.cy()+oy+dy2[k]);}}var draw=document.querySelector("#canvas svg");if(!draw)draw=SVG().addTo('#canvas').size(width,height);else draw=SVG(draw);//recover svg document instead appending new one
draw.rect(width,height).attr({fill:'#303030'});var node=SVG(window.gm.images['template3']());//get the source-svg
node.size(width,height);var lRoom=node.find('#layer1')[0];//fetch a layergroup by id to add to
var lPath=node.find('#layer2')[0];var tmpl=node.find('#tmplRoom')[0];var ox=tmpl.cx(),oy=tmpl.cy();//offset tmpl
if(playerTile!==''&&visitedTiles.indexOf(playerTile)<0){visitedTiles.push(playerTile);}var _rA,i,k,xy,room,dir;var xyB,dx,dy,_grid=dng.grid.values();var _iterator101=_createForOfIteratorHelper(_grid),_step101;try{for(_iterator101.s();!(_step101=_iterator101.n()).done;){room=_step101.value;// foreach room create room
xy=nameToXY(room.room);_rA=lRoom.use('tmplRoom').attr({id:room.room,title:room.room}).move(xy.x,xy.y);//var link = document.createElement('title');    link.textContent=room.room;    _rA.put(link);// appendchild is unknown // adding title to use dosnt work - would have to add to template
_rA.node.addEventListener("mouseover",showPopup);_rA.node.addEventListener("mouseout",hidePopup);if(visitedTiles!=null&&visitedTiles.indexOf(room.room)<0){if(reveal.indexOf(room.room)<0){_rA.addClass('roomNotFound');}else{_rA.addClass('roomFound');addAnno();}}else{if(room.room===playerTile){_rA.removeClass('roomFound').addClass('playerPosition');}else _rA.addClass('roomVisited');addAnno();for(k=room.dirs.length-1;k>=0;k--){//foreach direction create path to next room
dir=room.dirs[k].dir;xyB=nameToXY(dir);dx=xyB.x-xy.x,dy=xyB.y-xy.y;lPath.polyline([[_rA.cx()+ox,_rA.cy()+oy],[_rA.cx()+ox+dx/2,_rA.cy()+oy+dy/2]]).addClass('pathFound');//.insertBefore(_rA)
}}}//todo add gridlines and grid-labels
//add legend
}catch(err){_iterator101.e(err);}finally{_iterator101.f();}node.text(function(add){add.tspan(dng.legend||'');}).addClass('textLabel').ax(0).ay(0);node.addTo(draw);};//display svg
window.gm.printSceneGraphic2=function(background,item){var width=600,height=300;var draw=document.querySelector("#canvas svg");if(!draw)draw=SVG().addTo('#canvas').size(width,height);else draw=SVG(draw);//recover svg document instead appending new one
var background=draw.rect(width,height).attr({fill:'#303030'});draw.image(background);var node=SVG(item);if(node)node.addTo(draw);};//for debug: builds link-list to display svg
window.gm.listImages=function(){var list=Object.keys(window.gm.images);var g,entry=document.createElement('p');entry.textContent="";for(var _i11=0,_list2=list;_i11<_list2.length;_i11++){var n=_list2[_i11];if(n==='strToBuf'||n==='cache')continue;g=document.createElement('a');g.href='javascript:void(0)',g.textContent=n;var x=window.gm.images[n]();g.addEventListener("click",window.gm.printSceneGraphic2.bind(this,"",x));entry.appendChild(g);entry.appendChild(document.createTextNode(' '));//add \s or no automatic linebreak
};$("div#choice")[0].appendChild(entry);// <- requires this node in html
};//print list of actions for actual day and hour
window.gm.printSchedule=function(){var elmt='';var s=window.story.state;var now=window.gm.getTimeStruct();var jobs=Object.values(window.gm.jobs);for(var i=0;i<jobs.length;i++){var id=jobs[i].id;if(jobs[i].isHidden()===true){//NOP;
}else if(jobs[i].isDisabled()===true){elmt+="<div>".concat(jobs[i].disabledReason(),"</div></br>");}else if(jobs[i].DoW.includes(now.DoW)&&s._gm.time>=jobs[i].startTimeMin&&s._gm.time<jobs[i].startTimeMax){if(window.gm.player.energy().value>=jobs[i].reqEnergy){elmt+="<a0 id='".concat(id,"' onclick='(function($event){window.story.show(\"").concat(id,"\");})(this);'>").concat(jobs[i].name," </a>");elmt+="</br><div>".concat(jobs[i].descr," It might require ").concat(jobs[i].reqTime," minutes of your time and around ").concat(jobs[i].reqEnergy," energy.</div></br>");}else{elmt+="<div>You are to tired to do ".concat(jobs[i].name,".</div></br>");}}else{var days="";for(var k=0;k<jobs[i].DoW.length;k++){days+=window.gm.DoWs[jobs[i].DoW[k]-1]+",";}elmt+="<div>".concat(jobs[i].name," is only available between ").concat((jobs[i].startTimeMin/100).toFixed(0)," and ").concat((jobs[i].startTimeMax/100).toFixed(0)," at ").concat(days,". </div></br>");}}return elmt;};//prints a list of quest
window.gm.printQuestList=function(){var elmt='<hr><form><ul style=\"list-style-type: none; padding-inline-start: 0px;\" ><legend>In progress</legend>';var s=window.story.state;//elmt +="<li><label><input type=\"checkbox\" name=\"y\" value=\"x\" readonly disabled>always: keep the fridge filled</label></li>";
for(var i=0;i<s.quests.activeQuests.length;i++){var qId=s.quests.activeQuests[i].id;var flags=s.quests.activeQuests[i].flags;var msId=s.quests.activeQuestsMS[i].id;var quest=window.gm.questDef[qId];var mile=quest.getMileById(msId);if(!quest.HiddenCB()||window.story.state._gm.dbgShowQuestInfo){elmt+="<li style=\"padding-bottom: 0.5em;\"><input type=\"checkbox\" name=\"y\" value=\"x\" readonly disabled><label>"+quest.name+(window.story.state._gm.dbgShowQuestInfo?" "+msId+" 0x"+flags.toString(16):"")+" : "+(mile.HiddenCB()===true?"???":mile.descr)+"</label></li>";//checked="checked"
}}elmt+="</ul></form></br>";elmt+='<hr><form><ul style=\"list-style-type: none\" ><legend>Completed</legend>';for(var _i12=0;_i12<s.quests.finishedQuests.length;_i12++){var _qId=s.quests.finishedQuests[_i12].id;var _flags=s.quests.activeQuests[_i12].flags;var _msId=s.quests.finishedQuestsMS[_i12].id;var _quest=window.gm.questDef[_qId];var _mile=_quest.getMileById(_msId);if(!_quest.HiddenCB()||window.story.state._gm.dbgShowQuestInfo){elmt+="<li><input type=\"checkbox\" name=\"y\" value=\"x\" readonly disabled checked=\"checked\"><label>"+_quest.name+(window.story.state._gm.dbgShowQuestInfo?" "+_msId+" 0x"+_flags.toString(16):"")+" : "+_mile.descr+"</label></li>";}}elmt+="</ul></form></br>";return elmt;};//prints a description of the chars-body
window.gm.printBodyDescription=function(whom){var onlyvisible=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var n,msg2="",msg="";var conv=window.gm.util.descFixer(whom);var wornIds=whom.Outfit.getAllIds();//todo this returns wearables & bodyparts
var base=[],head=[],torso=[],arms=[],legs=[],groin=[],other=[],breast=[],ignore=[];//sort the order: place Breast & Nipple-Piercing together 
var fbase=['bBase','bSkin'],fhead=['bHeadHair','bFace','bEars','bEyes','bMouth','bTongue','Head','Mouth','Neck'],ftorso=['bTorso','bTailBase','bWings','Breast','Stomach','Hips'],farms=['bArms','bHands','Arms','Wrists','RHand','LHand'],flegs=['bLegs','bFeet','Feet','Thighs'],fbreast=['bBreast','pNipples'],fgroin=['bVulva','bPenis','pClit','bPubicHair','bHips','bAnus','Vulva','Clit','Anus','Penis','Balls'],fignore=[],fcovered=[];if(onlyvisible){// filter by visibility 
var covered=[];var _iterator102=_createForOfIteratorHelper(wornIds),_step102;try{for(_iterator102.s();!(_step102=_iterator102.n()).done;){n=_step102.value;//notice that an item is only pushed once even if has multiple slots
var item=whom.Outfit.getItem(n);covered=covered.concat(item.slotCover);}}catch(err){_iterator102.e(err);}finally{_iterator102.f();}var _iterator103=_createForOfIteratorHelper(covered),_step103;try{for(_iterator103.s();!(_step103=_iterator103.n()).done;){n=_step103.value;if(!fcovered.includes(n))fcovered.push(n);}}catch(err){_iterator103.e(err);}finally{_iterator103.f();}}var _iterator104=_createForOfIteratorHelper(wornIds),_step104;try{for(_iterator104.s();!(_step104=_iterator104.n()).done;){n=_step104.value;//notice that an item is only pushed once even if has multiple slots
var _item3=whom.Outfit.getItem(n);if(_item3.slotUse.every(function(name){return fcovered.includes(name);}))ignore.push(_item3);//ignore those that are covered completely
else if(_item3.slotUse.some(function(name){return fignore.includes(name);}))ignore.push(_item3);else if(_item3.slotUse.some(function(name){return fbase.includes(name);}))base.push(_item3);else if(_item3.slotUse.some(function(name){return fhead.includes(name);}))head.push(_item3);else if(_item3.slotUse.some(function(name){return ftorso.includes(name);}))torso.push(_item3);else if(_item3.slotUse.some(function(name){return fbreast.includes(name);}))breast.push(_item3);else if(_item3.slotUse.some(function(name){return farms.includes(name);}))arms.push(_item3);else if(_item3.slotUse.some(function(name){return flegs.includes(name);}))legs.push(_item3);else if(_item3.slotUse.some(function(name){return fgroin.includes(name);}))groin.push(_item3);else other.push(_item3);}//null is used to mark linebreaks
}catch(err){_iterator104.e(err);}finally{_iterator104.f();}var all=base.concat([null]).concat(head).concat([null]).concat(torso).concat([null]).concat(arms).concat([null]);all=all.concat(legs).concat([null]).concat(groin).concat([null]).concat(breast).concat([null]).concat(other);//todo "considering the size of your manmeat you are hung like a horse"
var _iterator105=_createForOfIteratorHelper(all),_step105;try{for(_iterator105.s();!(_step105=_iterator105.n()).done;){var _item4=_step105.value;msg+=_item4!==null?_item4.descLong(conv)+(_item4!==null&&_item4.pictureInv!=='unknown'?'</br>'+window.gm.images._sizeTo(window.gm.images[_item4.pictureInv](),200,200)+'</br>':' '):'</br>';//msg2+=(item!==null&&item.pictureInv!=='unknown')?window.gm.images[item.pictureInv]():'';
}}catch(err){_iterator105.e(err);}finally{_iterator105.f();}var lewd=whom.Outfit.getLewdness();//msg +='</br>Total lewdness sluty:'+lewd.slut+' bondage:'+lewd.bondage+' sm:'+lewd.sm;
return msg+"</br>"+msg2;};//see combat
window.gm.printSfx=function(id,msg){};// returns singular pronoun for the char depending on gender
window.gm.util.estimatePronoun=function(whom){var isplayer=whom.name===window.gm.player.name;var vulva=whom.Outfit.getItemForSlot(window.gm.OutfitSlotLib.bVulva);var penis=whom.Outfit.getItemForSlot(window.gm.OutfitSlotLib.bPenis);//todo what if whom is a gang of imps?
if(isplayer){return'i';}else if(vulva&&penis){return'shi';}else if(vulva){return'she';}else if(penis){return'he';}return'it';};//returns a function that accept a text and fixes the word-phrases: let fixer = window.gm.util.descFixer(this.actor);msg=fixer('[I] [like] this shit.');
window.gm.util.descFixer=function(whom){return function(whom){var char=whom,pron=window.gm.util.estimatePronoun(whom);return function(text){var repl=[],br=0,aft,bef,found;//search brackets like $[dff]$ $[[sdff]]$ dont find [ ] or \[ \] ; 
//using no regex because couldnt get it get working:(!\[|[^\[])([\[]{1})(!\]|!\[|[^\[\]])+[\]]{1}([^\]]|!\])
for(var i=text.length-1,max=text.length-1;i>=0;i-=1){//in backward direction !
bef=i>0?text[i-1]:'';aft=i<max?text[i+1]:'';if(text[i]===']'&&aft==='$'){//opening braket
br+=1;if(br>1){//there was already opening but no closing bracket !
//no bracket in bracket allowed; ignore previous bracket
br=1;}found={end:i};}if(text[i]==='['&&bef==='$'){//opening braket
br-=1;if(br<0){//there was already closing but no opening bracket !
//no bracket in bracket allowed; ignore previous bracket
br=0;}else{found.start=i;found.text=text.slice(found.start+1,found.end);//text within brackets
found.start-=1,found.end+=1;// inlude $ $
repl.push(found);}}}for(var _i13=0,_repl=repl;_i13<_repl.length;_i13++){var n=_repl[_i13];//replace bracket+bracketcontent,
n.new=window.gm.util.lookupWord(n.text,pron,char);var _bef=text.substring(0,n.start),_aft=text.substr(n.end+1);text=_bef+n.new+_aft;}// $[I]$ $[have]$ some rough [hair] that needs a lot combing. He has some rough...
// c. She buys those pants. 
// That hat [I] [wear] is ugly. That hat she wears is ugly.  
// A dense fur covers $[my]$ body. A dense fur covers your body.  
return text;};}(whom);};// add irregular words here
window.gm.util.wordlist=function buildWordList(list){//defines for each word a list to match to pronoun to replace with
//have = [I have, you have, he/she has, we have, you have, they have ]
list['i']={def:'I',i:'I',you:'you',he:'he',she:'she',shi:'shi',it:'it'};list['you']=list['i'];//if you use you instead I as it would be required ...
list['me']={def:'me',i:'me',you:'you',he:'him',she:'her',shi:'hir',it:'it'};list['my']={def:'my',i:'my',you:'your',he:'his',she:'her',shi:'hir',it:'its'};list['have']={def:'have',he:'has',she:'has',shi:'has',it:'has'};list['am']={def:'is',i:'am',he:'is',she:'is',shi:'is',it:'is'};list['them']={def:'them',i:'me',he:'him',she:'her',shi:'hir',it:'it'};//I snap at them -> He snaps at me.
return list;}(window.gm.util.wordlist||{});//looks up a word in the wordlist and retourns the version fitting pronoun
window.gm.util.lookupWord=function(word,pron,whom){var output=word;var x=word.toLowerCase();var repl=window.gm.util.wordlist[x];if(repl){output=repl[pron]?repl[pron]:repl.def;if(word[0]===word[0].toUpperCase()){//check if first letter needs to be large; 'I' is always large
output=output[0].toUpperCase()+output.substr(1);}}else{switch(x){case'name':output=whom.name;break;default:if(pron==='he'||pron==='she'||pron==='shi'){output+='s';//wear -> wears
}break;}}return output;};"use strict";//used for pathfinding in map not using dungeon
//grid = Array or Map of [{room:'H2', dirs:['H3','I2']},...]  TODO  new dirs:[{dir:"A3"}]
window.gm.gridToGraph=function(grid){var _r,n,dir,_rooms=new Map();var _iterator106=_createForOfIteratorHelper(grid.values()),_step106;try{for(_iterator106.s();!(_step106=_iterator106.n()).done;){n=_step106.value;//copy grid to new Map
_rooms.set(n.room,{name:n.room,neighbours:[]});}}catch(err){_iterator106.e(err);}finally{_iterator106.f();}var _iterator107=_createForOfIteratorHelper(grid.values()),_step107;try{for(_iterator107.s();!(_step107=_iterator107.n()).done;){n=_step107.value;//for every room
_r=_rooms.get(n.room);var _iterator109=_createForOfIteratorHelper(n.dirs),_step109;try{for(_iterator109.s();!(_step109=_iterator109.n()).done;){dir=_step109.value;//add neigbors
_r.neighbours.push(_rooms.get(dir.dir));}}catch(err){_iterator109.e(err);}finally{_iterator109.f();}_rooms.set(n.room,_r);}}catch(err){_iterator107.e(err);}finally{_iterator107.f();}var graph=new window.Graph(Array.from(_rooms.values()));graph.neighbors=function(node){var dir,ret=[],dirs=node.origNode.neighbours;var _iterator108=_createForOfIteratorHelper(dirs),_step108;try{for(_iterator108.s();!(_step108=_iterator108.n()).done;){dir=_step108.value;var room=dir;var next=this.nodes.find(function(_x){return _x.origNode===room;});ret.push(next);}}catch(err){_iterator108.e(err);}finally{_iterator108.f();}return ret;};graph.areNodesEqual=function(nodeA,nodeB){return nodeA.origNode.name===nodeB.origNode.name;};return graph;};window.gm.printNav2=function(label,to){var args={func:function func(to){return'window.gm.navHere(\"'+to+'\")';}};return window.gm.printNav(label,to,args);};window.gm.navHere=function(to){var _d=window.story.state[window.story.state.DngSY.dng];window.story.state.DngSY.prevLocation=window.gm.player.location;window.story.state.DngSY.nextLocation=to;to=window.gm.navEvent(to,window.story.state.DngSY.prevLocation);if(to===""){to=window.story.state.DngSY.nextLocation;}window.gm.addTime(30);window.story.show(to);};window.gm.navEvent=function(to,from){var _targ='',dir,dirs,evt,evts,dng=window.story.state.DngSY.dng;var _d=window.story.state[dng];var _to=to.replace(dng+"_",""),_from=from.replace(dng+"_","");var _addTime=0,_room=to.replace(dng+"_","");//tick = timestamp  
//state: 0-active  1-inactive  
var _chance,_chances=[],_leaveChance=0,_allChances=0,_now=window.gm.getTime(),_rnd=_.random(0,100);evts=_d.tmp.evtLeave[_from+'_'+_to];if(evts){//leave-check
dir=null,dirs=window.gm.getRoomDirections(_from);for(var i=dirs.length-1;i>=0;i--){if(dirs[i].dir===_to){dir=dirs[i];break;}}if(dir){//choose an event; the more you explored that direction, the higher the chance to find the exit
evts=evts.filter(function(x){return x.state===0;});//drop disabled
for(var i=evts.length-1;i>=0;i--){_chance=window.gm.encounterChance(evts[i]);if(_chance>0.0){_allChances+=_chance;_chances.unshift(_chance);}else{evts.pop();}}//0x: 0%    1x: 10%   5x: 50%    10x: 70%  100x: 90%  of OVERALL-chance
_leaveChance=dir.exp>=10?70.0:dir.exp>=5?50.0:dir.exp>=1?10.0:0;_leaveChance=_leaveChance/100.0*_allChances;_allChances+=_leaveChance;dir.exp+=1;//exp-count is updated
_rnd=_.random(0,_allChances-0.01);for(var i=evts.length-1;i>=0;i--){var _ch=_chances[i];if(_rnd<_allChances&&_rnd>=_allChances-_ch){evts[i].tick=_now;window.story.state.tmp.args=[evts[i],dng+'_'+_from,dng+'_'+_to];//store [evt,from,to] for use in scene
return dng+'_'+evts[i].id;//->show(DngNG_wolf5);   
//after the scene is finished it should continue window.story.state.DngSY.prevLocation 
}_allChances-=_ch;}//if no event rolled continue with door check 
}}///////  door-check
evt=null;var doors=_d.tmp.doors[_from],doors2=_d.tmp.doors[_to];if(doors){evt=doors[_to];}else if(doors2){evt=doors2[_from];}if(evt){if(evt.state===0){_targ=dng+"_"+from+to;if(window.story.passage(_targ)===null)_targ=dng+"_"+to+from;//for doors we should check both directions
}if(_targ!=='')return _targ;}//////enter
evts=_d.tmp.evtEnter[_room];if(evts){evt=evts["dog"];if(evt){if(evt.state===0)_targ=dng+"_Meet_Dog";if(_targ!=='')return _targ;}evt=evts["spiderbot"];if(evt){//&& window.gm.getDeltaTime(_now,evt.tick)>400){
if(evt.state===0)evt.tick=_now,_targ=dng+"_Spider",window.story.state.tmp.args=[evt,dng+'_'+_from,dng+'_'+_to];if(_targ!=='')return _targ;}evt=evts["gas"];if(evt&&_rnd>70&&window.gm.getDeltaTime(_now,evt.tick)>400){//todo chance modifier
if(evt.state===0)evt.tick=_now,_targ=dng+"_Trap_Gas";if(_targ!=='')return _targ;}evt=evts["tentacle"];if(evt&&_rnd>0&&window.gm.getDeltaTime(_now,evt.tick)>400){//todo chance modifier
if(evt.state===0)evt.tick=_now,_targ=dng+"_Trap_Tentacle";if(_targ!=='')return _targ;}}return _targ;};//which other tiles is this room connected to
window.gm.getRoomDirections=function(from){var _from=from.replace(window.story.state.DngSY.dng+"_","");//DngNG_A1 or A1
var dirs=[],rooms=window.story.state.DngSY.dngMap.grid;var _to=rooms.get(_from);if(_to)dirs=_to.dirs;/*for(var i=rooms.length-1;i>=0;i--){
        if(rooms[i].room===_from){
            return(rooms[i].dirs)
        }
    }*/return dirs;};//mob.state = -2:passedout 0:resting, 1:guarding 2:alerted 3:hunting 4:attacking  
//mob.timerA = time until switching back to guard if no player detected
//mob.timerB = thinking time
window.gm.mobAI=function(mob){var _now=window.gm.getTime(),timeR=30;//Todo timeRate depends on Mob?
var _d=window.story.state[window.story.state.DngSY.dng].tmp,goalpos;if(mob.state<0||mob.tick===''){mob.tick=_now;return;}if(window.gm.getDeltaTime(_now,mob.tick)>timeR){mob.tick=_now;if(mob.pos===stripRoom(window.gm.player.location)){//TODO && !player.hiding
if(mob.state===2){//activate attacking
mob.timerA=2*timeR;mob.state=4;//reset after time||fight
}else if(mob.state!==2&&mob.state!==4){//detect player
mob.state=2,mob.timerB=timeR;mob.timerA=2*timeR;}}else if(mob.state===1){//move around
var _to=window.gm.getRoomDirections(mob.pos).filter(function(_x){return mob.path.includes(_x.dir);});if(_to.length>0){mob.pos=_to[_.random(0,_to.length-1)].dir;//alert(mob.id+' now moving to '+mob.pos);
}else{mob.state=0;//if hunting brought us outside mobpath we are stuck 
}}else if(mob.state===2){//alerted
mob.timerB-=timeR;if(mob.timerB<=0){//TODO likelines to hunt
mob.timerA=4*timeR;mob.state=3;}}else if(mob.state===3){//hunt
mob.timerB-=timeR;if(mob.timerB<=0){goalpos=stripRoom(window.gm.player.location);var path=window.astar.search(window.gm.gridToGraph(window.story.state.DngSY.dngMap.grid),//TODO dont rebuild everytime
mob.pos,goalpos,null,{heuristic:function heuristic(a,b){return 1;}});if(path.length>0){mob.pos=path[0].origNode.name;window.gm.pushLog(mob.id+" goes "+mob.pos,window.story.state._gm.dbgShowMoreInfo);}else{mob.state=1;}mob.timerB=2*timeR;}}else if(mob.state===4){//attacking but player gone
mob.timerA=2*timeR;mob.state=3;mob.timerB=0;}}function stripRoom(name){return name.replace(window.story.state.DngSY.dng+"_","");}//Dng_A1 -> A1
};//dynamic room description 
window.gm.renderRoom=function(room){var msg="",deltaT,dng=window.story.state.DngSY.dng,_evt,_evts=window.story.state[dng].tmp.evtSpawn[room];var _rnd=_.random(0,100);if(!_evts)return msg;_evt=_evts["chest"];if(_evt&&(_evt.state===0||_evt.state===1)){msg+=window.story.render(dng+"_Chest");}_evt=_evts["mushroom"];if(_evt&&(_evt.state===0||_evt.state===1)){deltaT=window.gm.getDeltaTime(window.gm.getTime(),_evt.tick);if(_evt.loot==="BrownMushroom"&&deltaT>1200){//growth of...
_evt.tick=window.gm.getTime();_evt.loot="RottenMushroom";}else if(_evt.loot==="ViolettMushroom"&&deltaT>2400){_evt.tick=window.gm.getTime();_evt.loot="BrownMushroom";}msg+=window.story.render(dng+"_Mushroom");}_evt=_evts["lectern"];if(_evt&&(_evt.state===0||_evt.state===1)){deltaT=window.gm.getDeltaTime(window.gm.getTime(),_evt.tick);if(deltaT>2400){//respawn
_evt.tick=window.gm.getTime();_evt.state=0;}}if(_evt&&_evt.state===0){msg+="</br>Was there something sparkling "+window.gm.printPassageLink("over there?",dng+"_Lectern");}/*_evt=_evts["explore"];
    if(_evt && (_evt.state===0 || _evt.state===1)){
      msg+="It might be worth to "+window.gm.printLink("explore",'window.story.show("'+room+'_Explore")');+" this area some more.</br>";
    }*/return msg;};window.gm.finishTask=function(){var task=window.story.state.DngPC.task,_res={OK:task.done>0,msg:''};switch(task.id){//check if task is done
case'getEarsPierced':break;case'getVagina':break;case'findCursed':break;case'lootChest':if(task.data<=0){_res.OK=true;}else{_res.OK=false,_res.msg='Need to loot '+task.data+' more chests. They appear randomly in the dungeon at certain places.</br>';};break;case'bringIron':if(window.gm.player.Inv.countItem('VoucherIron')>=task.data){window.gm.player.Inv.removeItem('VoucherIron',task.data),_res.OK=true;}else{_res.OK=false,_res.msg='Not enough iron tokens.</br>';};break;case'bringSilver':if(window.gm.player.Inv.countItem('VoucherSilver')>=task.data){window.gm.player.Inv.removeItem('VoucherSilver',task.data),_res.OK=true;}else{_res.OK=false,_res.msg='Not enough silver tokens.</br>';};break;case'bringGold':break;case'freeEnslaved':break;case'bringMoney':if(window.gm.player.Inv.countItem('Money')>=task.data){window.gm.player.Inv.removeItem('Money',task.data),_res.OK=true;}else{_res.OK=false,_res.msg='Not enough money.</br>';};break;default:throw new Error('unknown task'+task.id);}if(_res.OK===true){window.story.state.DngPC.tasks[task.id].cnt+=1,window.story.state.DngPC.tasks[task.id].done=0,window.story.state.DngPC.task={};//,window.story.show(window.passage.name);
window.story.state.DngPC.tmp.tier+=1;_res.msg='donation request fullfilled. Your tier is now: '+window.story.state.DngPC.tmp.tier+'</br>';if(window.story.state.DngPC.tmp.tier%3===0){_res.msg="A <b>golden token</b> is your price that you can use to open another door in the dungeon.</br>";window.gm.player.Inv.addItem(window.gm.ItemsLib.VoucherGold());}}window.gm.printOutput(_res.msg,'#choice');};window.gm.getAvailableTasks=function(){var _task,_tasks=[],_d=window.story.state.DngPC,_t=_d.tmp.tier;var msg='choose a task:</br>';function taskDescr(task){var msg='';switch(task.id){//description of task
case'lootChest':msg='Find and loot '+task.data+' treasure chests.';break;case'getEarsPierced':msg='Get your ears pierced.';break;case'getVagina':msg='Swap that dick of yours against a fine cunt.';break;case'findCursed':msg='The dungeon is spoiled with cursed gear. Do me a favor and find at least one.';break;case'bringIron':msg='Gather some iron-tokens by looting the dungeon or trading from the vendor.';break;case'bringSilver':msg='Loot a silver-token from a boss.';break;case'bringGold':msg='Gain a gold-token with a special job.';break;case'freeEnslaved':msg='Free one of those who were overwhelmed and enslaved.';break;case'bringMoney':msg='Some easy task here: get '+task.data+'$.';break;default:throw new Error('unknown task'+task.id);}msg='Within '+Math.floor((task.time-window.gm.getDeltaTime(window.gm.getTime(),task.start))/100)+'hours : '+msg;return msg;}function foo(task){msg+=taskDescr(task)+window.gm.printLink("Choose this",'window.story.state.DngPC.task={id:\"'+task.id+'\",help:0,start:'+window.gm.getTime()+',time:'+task.time+',data:\"'+task.data+'\"},window.story.show(window.passage.name)')+'</br></br>';}function fooList(){_d.rolledTask.forEach(function(x){return x.start=window.gm.getTime(),foo(x);});}//if task in progress - show task-info instead
if(_d.task.id){_d.rolledTask=[],msg='in progress: '+taskDescr(_d.task)+'</br>';//msg+=finishTask().msg;
msg+=window.gm.printLink("finish task","window.gm.finishTask()");//todo possibility to abort and reroll for SilverVoucher?
window.gm.printOutput(msg,'#choice');return;}if(_d.rolledTask.length>0){//tasks got already rolled
fooList();}else{var _allChances=0,_tns=Object.keys(_d.tasks);for(var i=_tns.length-1;i>=0;i--){var _chance=100,_tk=_d.tasks[_tns[i]];if(_tk.tick!==''){//reduce chance for recent tasks or done ones
var _dt=window.gm.getDeltaTime(window.gm.getTime(),_tk.tick);if(_dt<1440||_tk.cnt>7)_chance*=0.5;else if(_dt<2880||_tk.cnt>4)_chance*=0.3;}if(_tk.min>_d.tmp.tier)_chance=0;_task={id:_tns[i],chance:_chance,time:2400,data:''};switch(_tns[i]){//scale here how much to deliver
case'getEarsPierced'://only if piercing slot available
break;case'getVagina'://only if not present 
break;case'findCursed'://how to know what was aquired?
break;case'bringMoney':_task.data=30*(1+_t);break;case'lootChest':_task.data=2;break;case'bringIron':case'bringSilver':_task.data=1+Math.floor(_t/6);break;case'bringGold':case'freeEnslaved':_task.data=1;break;default:throw new Error('unknown task'+_tns[i]);}_tasks.push(_task);_allChances+=_chance;}//for(var i=1;i>0;i--){ //up to x tasks to choose from       todo remove task and recalc allchances
if(_allChances>0.0){//choose rnd tasks
var _rnd=_.random(0,_allChances-0.01);for(var i=_tasks.length-1;i>=0;i--){if(_rnd<_allChances&&_rnd>=_allChances-_tasks[i].chance){_d.rolledTask.push(_tasks[i]);break;}_allChances-=_tasks[i].chance;}}//}
fooList();}window.gm.printOutput(msg,'#choice');};window.gm.know=function(what){var _n=window.story.state.Know[what];if(_n===null||_n===undefined){window.story.state.Know[what]=1;}};//build the map and other data; if the dng is already initilized and has the correct version, the actual data is returned
window.gm.build_DngPC=function(){var _m=['D1  E1  F1--G1--H1--I1--J1--K1--L1','                                  ','D2--E2--F2  G2--H2--I2--J2  K2--L2','        |       |   |   |   |   | ','D3--E3--F3--G3--H3  I3  J3  K3  L3','            |       |       |     ','D4--E4--F4--G4--H4--I4--J4  K4--L4','    |       |                     ','D5--E5--F5  G5--H5--I5--J5  K5--L5','|       |   |           |         ','D6  E6--F6--G6--H6--I6--J6  K6--L6'];function _d(dir){return{dir:dir,exp:0};}var _grid=[{room:'D2',dirs:[_d('E2')]},{room:'E2',dirs:[_d('F2')]},{room:'F2',dirs:[_d('E2'),_d('F3')]},{room:'G2',dirs:[_d('H2')]},{room:'H2',dirs:[_d('I2'),_d('H3')]},{room:'I2',dirs:[_d('I3'),_d('J2'),_d('H2')]},{room:'J2',dirs:[_d('I2'),_d('J3')]},{room:'K2',dirs:[_d('L2'),_d('K3')]},{room:'L2',dirs:[_d('K2'),_d('L3')]},{room:'D3',dirs:[_d('E3')]},{room:'E3',dirs:[_d('D3'),_d('F3')]},{room:'F3',dirs:[_d('E3'),_d('G3'),_d('F2')]},{room:'G3',dirs:[_d('F3'),_d('H3'),_d('G4')]},{room:'H3',dirs:[_d('H2'),_d('G3')]},{room:'I3',dirs:[_d('I4'),_d('I2')]},{room:'J3',dirs:[_d('J2')]},{room:'K3',dirs:[_d('K2'),_d('K4')]},{room:'L3',dirs:[_d('L2')]},{room:'D4',dirs:[_d('E4')]},{room:'E4',dirs:[_d('F4'),_d('D4')]},{room:'F4',dirs:[_d('G4'),_d('F5')]},{room:'G4',dirs:[_d('F4'),_d('H4'),_d('G5')],anno:['S']},{room:'H4',dirs:[_d('G4'),_d('I4')]},{room:'I4',dirs:[_d('I3'),_d('H4'),_d('J4')]},{room:'J4',dirs:[_d('I4'),_d('J5'),_d('K4')],anno:['B']},{room:'K4',dirs:[_d('L4'),_d('K3')]},{room:'L4',dirs:[_d('L3'),_d('K5')],anno:['B']},{room:'D5',dirs:[_d('D6'),_d('E5')]},{room:'E5',dirs:[_d('F5'),_d('E4'),_d('D5')]},{room:'F5',dirs:[_d('E5'),_d('F6')]},{room:'G5',dirs:[_d('G4'),_d('G6'),_d('H5')]},{room:'H5',dirs:[_d('G5'),_d('I5')]},{room:'I5',dirs:[_d('H5'),_d('J5')]},{room:'J5',dirs:[_d('J6')]},{room:'K5',dirs:[_d('L5')]},{room:'L5',dirs:[_d('K5')]},{room:'D6',dirs:[_d('D5')]},{room:'E6',dirs:[_d('F6')]},{room:'F6',dirs:[_d('E6'),_d('F5'),_d('G6')]},{room:'G6',dirs:[_d('G5'),_d('F6'),_d('H6')]},{room:'H6',dirs:[_d('I6'),_d('G6')]},{room:'I6',dirs:[_d('H6'),_d('J6')]},{room:'J6',dirs:[_d('J5'),_d('I6')]},{room:'K6',dirs:[_d('L6')]},{room:'L6',dirs:[_d('K6')]}];var data,map={grid:new Map(_grid.map(function(x){return[x.room,x];})),width:14,height:8,legend:'S=Start  B=Boss'};var s=window.story.state;var version=3;// <== increment this if you change anything below - it will reinitialize data !
if(s.DngPC&&s.DngPC.version===version){data=s.DngPC;}else{data=s.DngPC,data.version=version;data.tmp={tickPass:'',tier:0};data.tmp.evtLeave={//events on tile-leave
H4_I4:[{id:"Trap_Gas",type:'encounter',instance:"",tick:window.gm.getTime(),state:0,chance:100},//todo cannot assign chance-fct here
{id:"Box",type:'encounter',instance:"",tick:window.gm.getTime(),state:0,chance:100},{id:"Fungus",type:'encounter',instance:"",tick:window.gm.getTime(),state:0,chance:100}],I4_H4:null};data.tmp.evtEnter={//events on tile-enter
H4:{gas:{tick:window.gm.getTime(),state:0}}};data.tmp.doors={//doors 2way
I2:{H2:{state:0,token:1,tier:3}},F3:{F2:{state:0,token:1,tier:5}},E4:{E5:{state:0,token:1,tier:2}},H4:{H3:{state:0,token:2,tier:6}},G4:{F4:{state:0,token:1,tier:1},G3:{state:0,token:1,tier:4}},I4:{I3:{state:0,token:1,tier:3}},K4:{K3:{state:0,token:1,tier:3}},E5:{D5:{state:0,token:1,tier:3}},G5:{G6:{state:0,token:1,tier:4},G4:{state:0,token:1,tier:5}},I5:{J5:{state:0,token:1,tier:7}},H6:{I6:{state:0,token:1,tier:3}}};data.tmp.evtSpawn={//respawn evts 
DngPC_H4:{lectern:{tick:window.gm.getTime(),state:0}},DngPC_I4:{chest:{tick:window.gm.getTime(),state:0,loot:[{id:"SpellRodSpark",count:1}]},mushroom:{tick:window.gm.getTime(),state:0,loot:"BrownMushroom"}},DngPC_F4:{mushroom:{tick:window.gm.getTime(),state:0,loot:"ViolettMushroom"}},DngPC_F5:{mushroom:{tick:window.gm.getTime(),state:0,loot:"ViolettMushroom"}},DngPC_I2:{chest:{tick:window.gm.getTime(),state:0,loot:[{id:"Money",count:30}]}}};data.tmp.mobs=[//wandering mobs pos=current tile
//{id:"HornettI4",mob:"hornett",pos:"I4",path:["I4","H4","I3"],state:0,tick:'',aggro:0}
];data.task={},data.rolledTask=[];//active task
data.tasks={//task list  tick=timestamp last update  cnt=Number of finished task  min=minimum tierlevel   start=timestamp start
bringIron:{tick:'',done:0,cnt:0,min:1},bringSilver:{tick:'',done:0,cnt:0,min:3},bringGold:{tick:'',done:0,cnt:0,min:5},bringMoney:{tick:'',done:0,cnt:0,min:0},lootChest:{tick:'',done:0,cnt:0,min:2},findCursed:{tick:'',done:0,cnt:0,min:3},freeEnslaved:{tick:'',done:0,cnt:0,min:3},getEarsPierced:{tick:'',done:0,cnt:0,min:5}//getSavageness
// open mysterious chests
//,{id:'getTattoed',tick:'',done:0,cnt:0,min:8}
,getVagina:{tick:'',done:0,cnt:0,min:5}//,{id:'getBreast',tick:'',done:0,cnt:0,min:4}
//,{id:'getPregnant',tick:'',done:0,cnt:0,min:7}
//,{id:'walkNude',tick:'',done:0,cnt:0,min:4}
//,{id:'walkNude',tick:'',done:0,cnt:0,min:4}
//,{id:'maidoutfit',tick:'',done:0,cnt:0,min:6}
//,{id:'ponysuit',tick:'',done:0,cnt:0,min:7}
//,{id:'bitchsuit',tick:'',done:0,cnt:0,min:9}
};}//install function to calculate chance of evtLeave
window.gm.encounterChance=function(evt){var res=100.0,s=window.story.state,dng=window.story.state.DngSY.dng;res*=evt.chance/100.0;if(evt.id==='Trap_Dehair'){//Dehair if nude and hair
//if(window.gm.player.clothLevel()==='naked') {res*=2;}
if(window.gm.getDeltaTime(window.gm.getTime(),evt.tick)>200)res*=2;else res=0;}return res;};return{map:map,data:data};};"use strict";//stuff for Nightgames
var CraftMaterial=/*#__PURE__*/function(_Item2){_inherits(CraftMaterial,_Item2);var _super53=_createSuper(CraftMaterial);function CraftMaterial(){var _this52;_classCallCheck(this,CraftMaterial);_this52=_super53.call(this,'CraftMaterial');_this52.addTags([window.gm.ItemTags.Material]);_this52.price=_this52.basePrice=10;_this52.style=0;_this52.lossOnRespawn=false;return _this52;}_createClass(CraftMaterial,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("CraftMaterial",this);}},{key:"style",set:function set(style){this._style=style;if(style===0)this.id=this.name='Jlorb';else if(style===5)this.id=this.name='Shlack';else if(style===10)this.id=this.name='Glib';else if(style===20)this.id=this.name='Gorb';else if(style===30)this.id=this.name='Igent';else if(style===40)this.id=this.name='Remk';else if(style===50)this.id=this.name='Murk';else throw new Error(this.id+' doesnt know '+style);},get:function get(){return this._style;}},{key:"desc",get:function get(){var msg='';switch(this._style){case 0:case 5:case 10:case 20:case 30:case 40:case 50:msg='some strange material';break;default:throw new Error(this.id+' doesnt know '+style);}return msg;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(CraftMaterial,value.data);}}]);return CraftMaterial;}(Item);var Gun=/*#__PURE__*/function(_Weapon){_inherits(Gun,_Weapon);var _super54=_createSuper(Gun);_createClass(Gun,null,[{key:"factory",value:function factory(style){var x=new Gun();x.style=style;return x;}}]);function Gun(){var _this53;_classCallCheck(this,Gun);_this53=_super54.call(this);_this53.slotUse=['RHand'];_this53.style=0;return _this53;}_createClass(Gun,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("Gun",this);}},{key:"onEquip",value:function onEquip(context){var res=_get(_getPrototypeOf(Gun.prototype),"onEquip",this).call(this,context);if(res.OK){var sk=new SkillSpark();sk.weapon=this.id;this.parent.parent.Skills.addItem(sk);//todo
}return res;}},{key:"onUnequip",value:function onUnequip(context){_get(_getPrototypeOf(Gun.prototype),"onUnequip",this).call(this,context);this.parent.parent.Skills.removeItem('Spark');return{OK:true,msg:'unequipped'};}/*attackMod(target){  //todo
        let mod = new SkillMod();
        mod.onHit = [{ target:target, eff: [effDamage.factory(11,'blunt')]}];
        mod.critChance=5;
        mod.onCrit = [{ target:target, eff: [effDamage.factory(11,'blunt'), new effStunned()]}];
        return(mod);
    }*/},{key:"style",set:function set(style){this._style=style;if(style===0)this.id=this.name='Taser';else if(style===100)this.id=this.name='Blaster';else if(style===105)this.id=this.name='BlasterMK2';else if(style===120)this.id=this.name='Cryonizer';else throw new Error(this.id+' doesnt know '+style);},get:function get(){return this._style;}},{key:"desc",get:function get(){var msg='';switch(this._style){case 0:msg+=' pistol-like plastic tool that shocks someone with 30kV';break;case 100:msg+='scifi-revolver that fires a plasma-fireball';break;case 105:msg+='scifi-revolver that fires a bigger plasma-fireball';break;case 120:msg+='looks like a hair-dryer but can deep freeze something on short distance';break;default:}return msg;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(Gun,value.data);}}]);return Gun;}(Weapon);window.gm.ItemsLib=function(ItemsLib){window.storage.registerConstructor(CraftMaterial);window.storage.registerConstructor(Gun);ItemsLib['Jlorb']=function(){var x=new CraftMaterial();x.style=0;return x;};ItemsLib['Shlack']=function(){var x=new CraftMaterial();x.style=5;return x;};ItemsLib['Glib']=function(){var x=new CraftMaterial();x.style=10;return x;};ItemsLib['Gorb']=function(){var x=new CraftMaterial();x.style=20;return x;};ItemsLib['Igent']=function(){var x=new CraftMaterial();x.style=30;return x;};ItemsLib['Remk']=function(){var x=new CraftMaterial();x.style=40;return x;};ItemsLib['Murk']=function(){var x=new CraftMaterial();x.style=50;return x;};ItemsLib['Taser']=function(){var x=new Gun();x.style=0;return x;};ItemsLib['Blaster']=function(){var x=new Gun();x.style=100;return x;};ItemsLib['BlasterMK2']=function(){var x=new Gun();x.style=105;return x;};ItemsLib['Cryonizer']=function(){var x=new Gun();x.style=120;return x;};return ItemsLib;}(window.gm.ItemsLib||{});window.gm.build_DngNG=function(){function addMob(type,pos){//type refers either to a unique char existing in s.chars
//or is generic mob, then we have to append idcounter and create instance
var _id=type;if(!window.story.state.chars[type]){_id=type+IDGenerator.createID();window.story.state.chars[_id]=window.gm.Mobs[type]();}//state = see window.gm.mobAI
//timerA & B = ; used for mobAI
//att = 0=indifferent|1=friendly|-1=unfriendly|-2=hostile;
//tick = last time updated
data.tmp.mobs.push({id:_id,mob:type,pos:pos,path:[pos],state:0,tick:'',att:0,timerA:0,timerB:0});}function getTilesByVisual(visual){var _r=[];var _iterator110=_createForOfIteratorHelper(data.map.grid.values()),_step110;try{for(_iterator110.s();!(_step110=_iterator110.n()).done;){var value=_step110.value;if(value.visuals===visual){_r.push(value);}}}catch(err){_iterator110.e(err);}finally{_iterator110.f();}if(_r.length===0)throw new Error("no room with visual "+visual);return _r;}var s=window.story.state,data;/////// --!!!!
var version=1;////// -- !!!!                          // <== increment this if you change anything below - it will reinitialize data !
if(s.DngNG&&s.DngNG.version===version){data=s.DngNG;}else{data=s.DngNG,data.version=version;data.map=window.GenerateDng.DngGen.generate({length:5,doors:2,naming:"12_01",branches:2});data.Exit="DngNG_"+getTilesByVisual("entry")[0].room;// data.map.grid.entries().next().value[0];
data.tmp={tickPass:'',tier:0,powerLevel:0,inCombat:false,hiding:false};data.tmp.evtLeave={//events on tile-leave
A1_B1:[{id:"Trap_Gas",type:'encounter',tick:window.gm.getTime(),state:0,chance:100},//todo cannot assign fct here because saveing
{id:"Box",type:'encounter',tick:window.gm.getTime(),state:0,chance:100},{id:"Fungus",type:'encounter',tick:window.gm.getTime(),state:0,chance:100}],F4_G4:[{id:"Trap_Dehair",type:'encounter',tick:window.gm.getTime(),state:0,chance:100}],I4_H4:null};data.tmp.evtEnter={//events on tile-enter
//F4: {sbot:{tick:window.gm.getTime(),state:0 }}
//,H4: {gas:{tick:window.gm.getTime(),state:0 }}
};data.tmp.doors={//doors 2way
//E4:{E5:{state:0 }},
//G4:{G3:{state:0 },G5:{state:0 }},
//H4:{I4:{state:0 }},
//E5:{F5:{state:0 }},
};data.tmp.mobs=[//wandering mobs pos=current tile, path = walk area, nogo = dont enter here,
//{id:"Ruff",mob:"Ruff",pos:"G3",path:["G3"],state:0,tick:'',att:0,timerA:0,timerB:0}
//,{id:"SlimeG2",mob:"slime",pos:"G2",path:["G2"],state:0,hp:15,tick:'',att:0,timerA:0,timerB:0}
//,{id:"SlimeI2",mob:"slime",pos:"I2",path:["I2"],state:0,hp:15,tick:'',att:-2,timerA:0,timerB:0}
];data.tmp.evtSpawn={};//respawn evts 
data.tmp.evtSpawn["DngNG_"+getTilesByVisual("mushroom")[0].room]={mushroom:{tick:window.gm.getTime(),state:0,loot:"BrownMushroom"}};var _adr,_tiles=getTilesByVisual("bushes").concat(getTilesByVisual("trees")).sort(function(){return Math.random()-0.5;});;for(var i=_tiles.length-1;i>=0;i--){_adr="DngNG_"+_tiles[i].room;data.tmp.evtSpawn[_adr]=data.tmp.evtSpawn[_adr]||{};data.tmp.evtSpawn[_adr].lectern={tick:window.gm.getTime(),state:0};if(i===0)addMob("Ruff",_tiles[i].room);if(i===1)addMob("Slime",_tiles[i].room);//TODO spawn generic mobs inplay
}//addMob("Ruff","G3"),addMob("Slime","I2"),addMob("Slime","G2");
data.task={},data.rolledTask=[];//active task
data.tasks={//task list 
};}//install function to calculate chance of evtLeave
window.gm.encounterChance=function(evt){var res=100.0,s=window.story.state,dng=window.story.state.DngSY.dng;res*=evt.chance/100.0;if(evt.id==='Trap_Dehair'){//Dehair if nude and hair
//if(window.gm.player.clothLevel()==='naked') {res*=2;}
if(window.gm.getDeltaTime(window.gm.getTime(),evt.tick)>200)res*=2;else res=0;}return res;};//TODO cannot save graph due circular neigbours data.tmp.graph = window.gm.gridToGraph(_grid);  //for pathfinding  let path = window.astar.search(data.tmp.graph,"F2","I2",null,{heuristic:(function(a,b){return(1);})})
//add some helper funcs
data.getMobById=function(id){for(var i=data.tmp.mobs.length-1;i>=0;i--){if(data.tmp.mobs[i].id===id)return data.tmp.mobs[i];}return null;};data.addMob=addMob;return{map:data.map,data:data};};window.gm.renderRoomNG=function(room){//see also window.gm.renderRoom
var msg="",s=window.story.state,dng=s.DngSY.dng;var _c=room.replace(dng+"_",""),_v=s.DngNG.map.grid.get(_c).visuals;switch(_v){case"trees":msg+="There is a group of smaller trees.";break;case"bushes":msg+="Bushes of different sizes are growing close to each other.";break;case'bigtree':msg+="The area here lies in the shadow of a huge tree.";break;case'meadow':msg+="The sun shines down on the meadow, casting a warm and inviting glow over the entire area.";break;default:break;}switch(_v){case"appletree":msg+=window.story.render(dng+'_'+_v);break;case"entry":msg+=window.story.render(dng+'_'+_v);break;default:break;}return msg;};//build message+actions for NPC around player.
//returns {msg,attitudeToPlayer}
// 
//hostile=attack on sight ; this indicates to trigger combat
window.gm.build_NPCInfo=function(mob,position){var att=mob.att,msg,_mob=window.story.state.chars[mob.id];//only unique mobs are stored here TODO 
msg="A "+mob.mob+" is here.";//TODO what is the mob doing? sleeping/hiding/lurking
if(_mob instanceof Mob){msg=_mob.unique?mob.id+" is around.":msg;msg+=window.gm.images._sizeTo(window.gm.images[_mob.pic](),200,200);//Todo interaction depends on mob (can talk, detects player, is cloaked) and player (crawl toward)
//att=0;  //Todo calc attitude by history/relation and player-state (vulnerable or not)
//msg+= window.gm.printPassageLink("Talk to"+mob.id,"DngNG_"+mob.id+"_Talk");
if(mob.state===4||mob.state===3){att-=att>-2?1:0;msg+="You better not get closer.";}}mob.att=att;return{msg:msg,att:att};};//build message about NPC in surrounding tiles(tiles connected to this position)
window.gm.build_NPCProximity=function(position){var msg="",mob,_d=window.story.state[window.story.state.DngSY.dng].tmp;var rooms=window.gm.getRoomDirections(position).map(function(x){return x.dir;});for(var i=_d.mobs.length-1;i>=0;i--){// go through list of mobs and check if they are in rooms around position
mob=_d.mobs[i];if(mob.state<0)continue;if(rooms.indexOf(mob.pos)<0)continue;msg+=mob.state===3?"Something is approaching from "+mob.pos:"There seems to be someone in "+mob.pos;//TODO ...is stomping in your direction/ shuffling around/ slushing
msg+=".<br>";}//translate _to in north/south/above...
//Was there some noise coming from western direction? You hear something shuffling around east of here | Ruff might be hunting north of here 
return msg;};window.gm.simpleCombatInit=function(instance){var s=window.story.state;s.combat.tmp={};var tmp=s.combat.tmp;tmp.inst=instance;tmp.now="";};window.gm.simpleCombatCleanup=function(){var s=window.story.state,tmp=s.combat.tmp;s.combat.tmp={};};//overrides for Latec
window.gm.InspectSelf=function(){var msg="",s=window.story.state;if(s.DngNG.tmp.qBabble===1){msg+="</br>A datapad is in your possession.";}if(s.DngNG.tmp.qBabble===2){msg+="</br>The babble companion is talking by an in-ear speaker to you.";}msg+=window.gm.printBodyDescription(window.gm.player,true);return msg+"</br>";};window.gm.canOpenDoor=function(from,to){var s=window.story.state,res={OK:false,msg:''};if(from==='E4'&&to==='E5'){if(s.DngNG.tmp.qKeyBlue!==0){res.OK=true;s.DngNG.tmp.doors[from][to].state=1;res.msg="</br>With the blue keycard in your possesion, you can open the door.";}else res.msg="</br>There is a sl.";}return res;};window.gm.doMobAi=function(){var _info,msg="",here=window.gm.player.location,_d=window.story.state[window.story.state.DngSY.dng].tmp;var fightMobs=[],interactMobs=[];var node="section article div#output";for(var i=_d.mobs.length-1;i>=0;i--){//check persistent mobs
var mob=_d.mobs[i];window.gm.mobAI(mob);//TODO if mob is with other mob, they might interact; if they are with player he will witness, if they are closely around, he will hear something 
if(window.story.state.DngSY.dng+"_"+mob.pos===here){//if mob is at same position as player and alive: trigger passage or just show note
if(mob.state>=0){if(mob.att<=-2){fightMobs.push(mob);}else{interactMobs.push(mob);}}else{window.gm.printOutput("A "+mob.mob+" was once possibly around. ",node,true);}}}_d.inCombat=false;if(fightMobs.length>0){//there might be mobs forcing a fight
//TODO make this trapquest-style: pictures to click on with cmds; mmore foes could approach!
//after click calc turn
//switch scene after defeat
_d.inCombat=true;for(var i=fightMobs.length-1;i>=0;i--){_info=window.gm.build_NPCCombat(fightMobs[i],here);window.gm.printOutput(_info.msg,node,true);}document.getElementById("navpanel").replaceChildren("You cant escape");/*window.gm.encounters[fightMobs[0].mob]({noStart:true});
        var _oldVictory=window.gm.Encounter.onVictory.bind(window.gm.Encounter);
        window.gm.Encounter.onVictory= function(){fightMobs[0].state=-1;return(_oldVictory());}
        window.gm.Encounter.initCombat(); return;*/}else{for(var i=interactMobs.length-1;i>=0;i--){_info=window.gm.build_NPCInfo(interactMobs[i],here);window.gm.printOutput(_info.msg,node,!_info.clear);}}if(_d.inCombat==false&&_d.hiding==false){msg+=window.gm.printLink("Hide",'window.gm.tryHide()');}else if(_d.hiding==true){msg+="You are hidden, but maybe its time to "+window.gm.printLink("leave your hiding spot.",'window.gm.tryUnhide()');}window.gm.printOutput(msg,node,true);window.gm.printOutput(window.gm.build_NPCProximity(here),node,true);};//mob does act, desc & list of player choices is returned
window.gm.build_NPCCombat=function(mob,position){var msg,dmg=_.random(2,10),clear=false,_d=window.story.state[window.story.state.DngSY.dng].tmp,_mob=window.story.state.chars[mob.id];;_d.hiding=false;//mob found you
msg=mob.mob+" attacks you:";msg+="-"+dmg.toFixed(0)+'dmg</br>';msg+=window.gm.images._sizeTo(window.gm.images[_mob.pic](),200,200);window.gm.player.Stats.increment("health",dmg*-1);if(window.gm.player.isDead()){msg+=window.gm.printLink("Accept your defeat",'window.gm.respawn({keepInventory:true});');clear=true;//remove actions from prev combatants
}else{msg+=window.gm.printLink("Slap it",'window.gm.slapMob(\"'+mob.id+'\")');}return{msg:msg,clear:clear};};//player acts, then press button for next turn
window.gm.slapMob=function(mobid){var msg,dmg=5,_d=window.story.state[window.story.state.DngSY.dng].tmp;var mob=window.story.state[window.story.state.DngSY.dng].getMobById(mobid),_mob=window.story.state.chars[mob.id];//window.story.state[window.story.state.DngSY.dng].getMobById(id);
_d.hiding=false;//TODO suprise attack
_mob.Stats.increment("health",-1*dmg);msg="You punch toward the "+_mob.baseName+" and hit it for "+dmg.toFixed(0)+"dmg (now "+_mob.health().value.toFixed(0)+"HP).";if(_mob.health().value<=0){msg+=window.gm.mobDefeat(mob);}msg+=window.gm.printLink('Next','window.story.show(window.gm.player.location)');window.gm.printOutput(msg,"section article div#output");//<= overwrite output!
};window.gm.tryHide=function(){var _d=window.story.state[window.story.state.DngSY.dng].tmp,msg="";_d.hiding=true;//TODO trying to hide while someone is around fails
msg+="TODO You hide somewhere. ";msg+=window.gm.printLink('Stay quiet','window.story.show(window.gm.player.location)');window.gm.printOutput(msg,"section article div#output");};window.gm.tryUnhide=function(){var _d=window.story.state[window.story.state.DngSY.dng].tmp,msg="";_d.hiding=false;//TODO option for suprise attack
msg+="You get out of your hidingspot. ";msg+=window.gm.printLink('Next','window.story.show(window.gm.player.location)');window.gm.printOutput(msg,"section article div#output");};window.gm.mobDefeat=function(mob){var msg="";mob.state=-2;//knocked out
msg=mob.mob+" got knocked out.";return msg;};"use strict";///////////////////////////////////////////////////////////////
//RL-Items
var LighterDad=/*#__PURE__*/function(_Item3){_inherits(LighterDad,_Item3);var _super55=_createSuper(LighterDad);function LighterDad(){var _this54;_classCallCheck(this,LighterDad);_this54=_super55.call(this,'LighterDad');_this54.addTags([window.gm.ItemTags.Quest]);return _this54;}_createClass(LighterDad,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("LighterDad",this);}},{key:"desc",get:function get(){return'I got this lighter from my real dad.';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(LighterDad,value.data);}}]);return LighterDad;}(Item);;var Money=/*#__PURE__*/function(_Item4){_inherits(Money,_Item4);var _super56=_createSuper(Money);function Money(){var _this55;_classCallCheck(this,Money);_this55=_super56.call(this,'Money');_this55.addTags([window.gm.ItemTags.Money]);return _this55;}_createClass(Money,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("Money",this);}},{key:"desc",get:function get(){return'shiny,clinky coin';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(Money,value.data);}}]);return Money;}(Item);;var LaptopPS=/*#__PURE__*/function(_Item5){_inherits(LaptopPS,_Item5);var _super57=_createSuper(LaptopPS);function LaptopPS(){var _this56;_classCallCheck(this,LaptopPS);_this56=_super57.call(this,'LaptopPS');_this56.addTags([window.gm.ItemTags.Quest]);return _this56;}_createClass(LaptopPS,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("LaptopPS",this);}},{key:"desc",get:function get(){return'Power converter for laptop.';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(LaptopPS,value.data);}}]);return LaptopPS;}(Item);;var Dildo=/*#__PURE__*/function(_Item6){_inherits(Dildo,_Item6);var _super58=_createSuper(Dildo);function Dildo(){var _this57;_classCallCheck(this,Dildo);_this57=_super58.call(this,'Dildo');_this57.price=_this57.basePrice=20;_this57.style=0;return _this57;}_createClass(Dildo,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("Dildo",this);}},{key:"style",set:function set(style){this._style=style;if(style===0)this.id='DildoSmall',this.name='small dildo';else if(style===100)this.id='DildoMedium',this.name='medium dildo';else throw new Error(this.id+' doesnt know '+style);},get:function get(){return this._style;}},{key:"desc",get:function get(){var msg='A dildo made from rubbery plastic, smaller than an average human dick.';switch(this._style){case 100:msg='A medium sized pink dong.';break;default:}return msg;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(Dildo,value.data);}}]);return Dildo;}(Item);var Lube=/*#__PURE__*/function(_Item7){_inherits(Lube,_Item7);var _super59=_createSuper(Lube);function Lube(){var _this58;_classCallCheck(this,Lube);_this58=_super59.call(this,'Lube');_this58.addTags([window.gm.ItemTags.Ingredient]);_this58.price=_this58.basePrice=4;return _this58;}_createClass(Lube,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("Lube",this);}},{key:"desc",get:function get(){return'Slippery lubricant for personal use.';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(Lube,value.data);}}]);return Lube;}(Item);var Battery=/*#__PURE__*/function(_Item8){_inherits(Battery,_Item8);var _super60=_createSuper(Battery);function Battery(){var _this59;_classCallCheck(this,Battery);_this59=_super60.call(this,'Battery');_this59.addTags([window.gm.ItemTags.Ingredient]);_this59.price=_this59.basePrice=3;return _this59;}_createClass(Battery,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("Battery",this);}},{key:"desc",get:function get(){return'Provides electricity for devices.';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(Battery,value.data);}}]);return Battery;}(Item);/////////////////////////////////////////////////////////////////
var Voucher=/*#__PURE__*/function(_Item9){_inherits(Voucher,_Item9);var _super61=_createSuper(Voucher);//token or coupon for ingame shop
function Voucher(){var _this60;_classCallCheck(this,Voucher);_this60=_super61.call(this,'Voucher');_this60.addTags([window.gm.ItemTags.Money]);_this60.price=_this60.basePrice=100;_this60.style=0;_this60.lossOnRespawn=false;return _this60;}_createClass(Voucher,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("Voucher",this);}},{key:"style",set:function set(style){this._style=style;if(style===0)this.id=this.name='VoucherIron';else if(style===10)this.id=this.name='VoucherBronze';else if(style===20)this.id=this.name='VoucherSilver';else if(style===30)this.id=this.name='VoucherGold';else throw new Error(this.id+' doesnt know '+style);},get:function get(){return this._style;}},{key:"desc",get:function get(){var msg='a token with a certain value';return msg;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(Voucher,value.data);}}]);return Voucher;}(Item);;var QuestItems=/*#__PURE__*/function(_Item10){_inherits(QuestItems,_Item10);var _super62=_createSuper(QuestItems);//stuff you have to collect for quest
function QuestItems(){var _this61;_classCallCheck(this,QuestItems);_this61=_super62.call(this,'QuestItems');_this61.addTags([window.gm.ItemTags.Quest]);_this61.price=_this61.basePrice=10;_this61.style=0;_this61.lossOnRespawn=true;return _this61;}_createClass(QuestItems,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("QuestItems",this);}},{key:"style",set:function set(style){//instead of creating full class for every useless junk I use this and just add variable that will be restored after load
this._style=style;if(style===0)this.id='IgneumPage',this.name='IgneumPage';else if(style===10)this.id=this.name='RedAnkh';else if(style===20)this.id=this.name='RingOfBurden';else if(style===30)this.id=this.name='GemstoneRed';else if(style===31)this.id=this.name='GemstoneGreen';else if(style===32)this.id=this.name='GemstoneBlue';else if(style===40)this.id=this.name='SlaverTag';else if(style===50)this.id=this.name='Fuse';else throw new Error(this.id+' doesnt know '+style);},get:function get(){return this._style;}},{key:"desc",get:function get(){var msg='';switch(this._style){case 0:msg='Pages from the book Igneum Frigus Thalamum';break;case 10:msg='A pendant made from red crystal shaped like the famous Ankh.';break;case 20:msg='This ring is heavyer then it seems.';break;case 30:case 31:case 32:msg='A large gemstone of a certain color.';break;case 40:msg='Aquired by freeing a slave.';break;case 50:msg='A replacemant fuse for electronics.';break;default:throw new Error(this.id+' doesnt know '+style);}return msg;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(QuestItems,value.data);}}]);return QuestItems;}(Item);//this Present-Box has an Inventory to hold Presents; use it to ove those presents into carriers inventory and  
var Box=/*#__PURE__*/function(_Item11){_inherits(Box,_Item11);var _super63=_createSuper(Box);function Box(){var _this62;_classCallCheck(this,Box);_this62=_super63.call(this,'Box');//this.addTags([window.gm.ItemTags.Ingredient]); 
_this62.price=_this62.basePrice=10;_this62.style=0;_this62.lossOnRespawn=true;_this62.inv=new Inventory();return _this62;}_createClass(Box,[{key:"_relinkItems",value:function _relinkItems(parent){_get(_getPrototypeOf(Box.prototype),"_relinkItems",this).call(this,this),this.inv._parent=window.gm.util.refToParent(this);//does this work if parent is ITEM?
}},{key:"addItem",value:function addItem(item){var count=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;this.inv.addItem(item,count);this._updateId();//boxes should not stack if content differs
}},{key:"usable",value:function usable(context){var on=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return{OK:true,msg:'unwrap'};}},{key:"use",value:function use(context){var on=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var msg="",_item,_count,_ids=this.inv.getAllIds();if(context instanceof Inventory){if(on===null)on=context.parent;context.removeItem(this.id);if(on instanceof Character){for(var i=0;i<_ids.length;i++){_item=this.inv.getItem(_ids[i]),_count=this.inv.countItem(_ids[i]);msg+=_count+" x "+_item.name+", ";on.changeInventory(_item,_count);}return{OK:true,msg:'The mysterious box contained: '+msg};}}else throw new Error('context is invalid');}},{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("Box",this);}},{key:"style",set:function set(style){this._style=style;if(style===0)this.id='MysteriousBox',this.name='MysteriousBox';else if(style===10)this.id=this.name='Surprise';else throw new Error(this.id+' doesnt know '+style);},get:function get(){return this._style;}},{key:"desc",get:function get(){var msg='';switch(this._style){case 0:msg='a mysterious box';break;case 10:msg='a surprise present';break;default:throw new Error(this.id+' doesnt know '+style);}return msg;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(Box,value.data);}}]);return Box;}(Item);var Ingredient=/*#__PURE__*/function(_Item12){_inherits(Ingredient,_Item12);var _super64=_createSuper(Ingredient);function Ingredient(){var _this63;_classCallCheck(this,Ingredient);_this63=_super64.call(this,'Ingredient');_this63.addTags([window.gm.ItemTags.Ingredient]);_this63.price=_this63.basePrice=10;_this63.style=0;_this63.lossOnRespawn=true;return _this63;}_createClass(Ingredient,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("Ingredient",this);}},{key:"style",set:function set(style){//instead of creating full class for every useless junk I use this and just add variable that will be restored after load
this._style=style;if(style===0)this.id='ApocaFlower',this.name='ApocaFlower';else if(style===10)this.id=this.name='PurpleBerry';else if(style===20)this.id=this.name='BogBovus';else if(style===30)this.id=this.name='SquishedLeech';else if(style===40)this.id=this.name='WolfTooth';else if(style===50)this.id=this.name='DryadVine';else if(style===60)this.id=this.name='Dimetrium';else if(style===70)this.id=this.name='GiantPlum';else if(style===80)this.id=this.name='EmptyGlas';else if(style===90)this.id=this.name='CrystalWater';else if(style===100)this.id=this.name='BlackCandle';else if(style===110)this.id=this.name='Beewax';else if(style===120)this.id=this.name='RedSlime';else if(style===130)this.id=this.name='BlueSlime';else if(style===140)this.id=this.name='GreenSlime';else if(style===150)this.id=this.name='Cobweb';else if(style===160)this.id=this.name='Ingwer';else throw new Error(this.id+' doesnt know '+style);},get:function get(){return this._style;}},{key:"desc",get:function get(){var msg='';switch(this._style){case 0:msg='yellow bluish flower';break;case 10:msg='purple berrys grown in the forest';break;case 20:msg='a mushroom with purple cap and yellow splotches';break;case 30:msg='I dont wanna carry that around';break;case 40:msg='Some canines from a canine';break;case 50:msg='fibers of a sturdy plant';break;case 60:msg='a arcane metal';break;case 70:msg='a huge purple plum, bigger than your fist';break;case 80:msg='an empty drinking glas';break;case 90:msg='a glas filled with crystal clear water';break;case 100:msg='a black candle; most likely used for (un-)holy rituals';break;case 110:msg='wax produced by bees';break;case 120:case 130:case 140:msg='glob of slime with a certain color';break;case 150:msg='a fuzz of cobwebs';break;default:throw new Error(this.id+' doesnt know '+style);}return msg;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(Ingredient,value.data);}}]);return Ingredient;}(Item);var SoulGem=/*#__PURE__*/function(_Item13){_inherits(SoulGem,_Item13);var _super65=_createSuper(SoulGem);function SoulGem(){var _this64;_classCallCheck(this,SoulGem);_this64=_super65.call(this,'SoulGem');_this64.addTags([window.gm.ItemTags.Ingredient]);_this64.price=_this64.basePrice=100;_this64.style=0;_this64.lossOnRespawn=true;return _this64;}_createClass(SoulGem,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SoulGem",this);}},{key:"style",set:function set(style){//instead of creating full class for every useless junk I use this and just add variable that will be restored after load
this._style=style;if(style===0)this.id=this.name='TinySoulGem';else if(style===10)this.id=this.name='TinyBlackSoulGem';else if(style===20)this.id=this.name='SmallSoulGem';else if(style===30)this.id=this.name='SmallBlackSoulGem';else throw new Error(this.id+' doesnt know '+style);},get:function get(){return this._style;}},{key:"desc",get:function get(){var msg=this.name;return msg;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(Ingredient,value.data);}}]);return SoulGem;}(Item);var Rope=/*#__PURE__*/function(_Item14){_inherits(Rope,_Item14);var _super66=_createSuper(Rope);function Rope(){var _this65;_classCallCheck(this,Rope);_this65=_super66.call(this,'Rope');_this65.addTags([window.gm.ItemTags.Tool]);_this65.price=_this65.basePrice=10;_this65.style=0;_this65.lossOnRespawn=true;return _this65;}_createClass(Rope,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("Rope",this);}},{key:"style",set:function set(style){//instead of creating full class for every useless junk I use this and just add variable that will be restored after load
this._style=style;if(style===0)this.id=this.name='Rope';else if(style===10)this.id='RopeSturdy',this.name='Sturdy Rope';else throw new Error(this.id+' doesnt know '+style);},get:function get(){return this._style;}},{key:"desc",get:function get(){var msg=this.name;return msg;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(Rope,value.data);}}]);return Rope;}(Item);var KeyRestraint=/*#__PURE__*/function(_Item15){_inherits(KeyRestraint,_Item15);var _super67=_createSuper(KeyRestraint);function KeyRestraint(){var _this66;_classCallCheck(this,KeyRestraint);_this66=_super67.call(this,'KeyRestraint');_this66.style=0;_this66.lossOnRespawn=true;return _this66;}_createClass(KeyRestraint,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("KeyRestraint",this);}},{key:"style",set:function set(style){this._style=style;if(style===0)this.id=this.name='KeyRestraintA';else if(style===10)this.id=this.name='KeyRestraintB';else throw new Error(this.id+' doesnt know '+style);},get:function get(){return this._style;}},{key:"desc",get:function get(){var msg=this.name;return msg;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(KeyRestraint,value.data);}}]);return KeyRestraint;}(Item);var FlashBang=/*#__PURE__*/function(_Item16){_inherits(FlashBang,_Item16);var _super68=_createSuper(FlashBang);function FlashBang(){_classCallCheck(this,FlashBang);return _super68.call(this,'FlashBang');}_createClass(FlashBang,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("FlashBang",this);}},{key:"targetFilter",//context is the skillUseItem calling this
value:function targetFilter(targets,context){if(!window.gm.combat.inCombat())return[];//to use skill-targetfilter we need an instance of skill bound to the caster  - todo this is ugly
//let _sk = this.parent.parent.Skills.getItem('UseItem');//._parent=window.gm.util.refToParent(this.parent.parent.Skills); 
return context.targetMultiple(context.targetFilterFighting(context.targetFilterEnemy(targets)));}},{key:"usable",value:function usable(context){var on=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;//can only be used while in combat and target is enemy
var result={OK:false,msg:'cannot use'};if(!window.gm.combat.inCombat()){result.msg='can only be used in combat';}else{result.msg='use',result.OK=true;}return result;}},{key:"use",value:function use(context){var on=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var result={OK:false,msg:''};if(context instanceof Inventory){context.removeItem('FlashBang');if(context.parent instanceof Character){if(on===null)on=context.parent;if(on.length&&on.length>0){//on can be several targets (array)
}else{on=[on];//..if not an array change it
}result.msg=context.parent.name+' uses '+this.name+'.';var _iterator111=_createForOfIteratorHelper(on),_step111;try{for(_iterator111.s();!(_step111=_iterator111.n()).done;){var _targ=_step111.value;_targ.addEffect(new effStunned(),effStunned.id);//todo should 'FlashBang:Stunned' merge with other stunned? 
result.msg+=_targ.name+' got stunned. ';}}catch(err){_iterator111.e(err);}finally{_iterator111.f();}result.OK=true;return result;}}else throw new Error('context is invalid');}},{key:"desc",get:function get(){return'Stun someone with a blinding light.';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(FlashBang,value.data);}}]);return FlashBang;}(Item);;var CanOfCoffee=/*#__PURE__*/function(_Item17){_inherits(CanOfCoffee,_Item17);var _super69=_createSuper(CanOfCoffee);function CanOfCoffee(){var _this67;_classCallCheck(this,CanOfCoffee);_this67=_super69.call(this,'CanOfCoffee');_this67.addTags([window.gm.ItemTags.Drink]);_this67.price=_this67.basePrice=2;return _this67;}_createClass(CanOfCoffee,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("CanOfCoffee",this);}},{key:"usable",value:function usable(context){return{OK:true,msg:'drink'};}},{key:"use",value:function use(context){if(context instanceof Inventory){context.removeItem('CanOfCoffee');if(context.parent instanceof Character){context.parent.addEffect(new effEnergized(),'CanOfCoffee:Energized');//apply over-time-effect instead directly changing stat
return{OK:true,msg:context.parent.name+' gulped down a can of iced coffee.'};}}else throw new Error('context is invalid');}},{key:"desc",get:function get(){return'Cold coffee in a can. Tasty? Not really!';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(CanOfCoffee,value.data);}}]);return CanOfCoffee;}(Item);;var SimpleFood=/*#__PURE__*/function(_Item18){_inherits(SimpleFood,_Item18);var _super70=_createSuper(SimpleFood);function SimpleFood(){var _this68;_classCallCheck(this,SimpleFood);_this68=_super70.call(this,'SimpleFood');_this68.addTags([window.gm.ItemTags.Food]);_this68.price=_this68.basePrice=5;_this68.style=0;return _this68;}_createClass(SimpleFood,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SimpleFood",this);}},{key:"usable",value:function usable(context){var on=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return{OK:true,msg:'eat'};}},{key:"use",value:function use(context){var on=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(context instanceof Inventory){if(on===null)on=context.parent;context.removeItem(this.id);if(on instanceof Character){on.addEffect(new effEnergized(),'Simple food:Energized');on.Stats.increment("satiation",1*this.satiation);if(this._style===5)window.gm.MutationsLib.changeSavage(on,-5,0,100);if(this._style===10)window.gm.MutationsLib.changeSavage(on,3,0,20);return{OK:true,msg:on.name+' ate some food.'};}}else throw new Error('context is invalid');}},{key:"desc",get:function get(){return'Something to eat.';}},{key:"style",set:function set(style){this._style=style;this.satiation=30;if(style===0)this.id=this.name='SimpleFood',this.amount=10;else if(style===5)this.id=this.name='Sandwich',this.amount=20;else if(style===10)this.id=this.name='ViolettMushroom',this.amount=20;else if(style===20)this.id=this.name='BrownMushroom',this.amount=20;else if(style===30)this.id=this.name='RottenMushroom',this.amount=20;else throw new Error(this.id+' doesnt know '+style);},get:function get(){return this.name;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SimpleFood,value.data);}}]);return SimpleFood;}(Item);var HealthPotion=/*#__PURE__*/function(_Item19){_inherits(HealthPotion,_Item19);var _super71=_createSuper(HealthPotion);_createClass(HealthPotion,null,[{key:"factory",value:function factory(style){var x=new HealthPotion();x.style=style;return x;}}]);function HealthPotion(){var _this69;_classCallCheck(this,HealthPotion);_this69=_super71.call(this,'HealthPotion');_this69.addTags([window.gm.ItemTags.Drink,window.gm.ItemTags.Heal]);_this69.price=_this69.basePrice=15;_this69._style=0;return _this69;}_createClass(HealthPotion,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("HealthPotion",this);}},{key:"targetFilter",//context is the skillUseItem calling this
value:function targetFilter(targets,context){if(!window.gm.combat.inCombat())return[];//to use skill-targetfilter we need an instance of skill bound to the caster  - todo this is ugly
//let _sk = this.parent.parent.Skills.getItem('UseItem');//._parent=window.gm.util.refToParent(this.parent.parent.Skills); 
return context.targetMultiple(context.targetFilterAlly(targets));}},{key:"usable",value:function usable(context){var on=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return{OK:true,msg:'drink'};}},{key:"use",value:function use(context){var on=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(context instanceof Inventory){if(on===null)on=context.parent;if(on.length&&on.length>0){//on can be several targets (array)
on=on[0];}context.removeItem(this.id);if(on instanceof Character){if(this.style<100){on.Stats.increment("health",on.Stats.getItem("healthMax").value*this.amount/100);return{OK:true,msg:on.name+' drank a potion and feels healthier.'};}else if(this.style<200&&this.style>=100){on.Stats.increment("savageness",-1*this.amount*on.Stats.getItem("savagenessMax").value);return{OK:true,msg:on.name+' drank a potion and feels less savage.'};}}}else throw new Error('context is invalid');}},{key:"style",set:function set(style){this._style=style;if(style===0)this.id=this.name='HealthPotion',this.amount=40,this.price=this.basePrice=15;else if(style===10)this.id=this.name='HealthPotionSmall',this.amount=20,this.price=this.basePrice=10;else if(style===100)this.id=this.name='SerenityPotionSmall',this.amount=10,this.price=this.basePrice=10;else throw new Error(this.id+' doesnt know '+style);},get:function get(){return this._style;}},{key:"desc",get:function get(){var msg='restores '+this.amount+'% health ';if(this.style<200&&this.style>=100){msg='cools down your savagness ('+this.amount+'%) ';}return msg;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(HealthPotion,value.data);}}]);return HealthPotion;}(Item);var HorsePotion=/*#__PURE__*/function(_Item20){_inherits(HorsePotion,_Item20);var _super72=_createSuper(HorsePotion);function HorsePotion(){var _this70;_classCallCheck(this,HorsePotion);_this70=_super72.call(this,'HorsePotion');_this70.addTags([window.gm.ItemTags.Drink]);_this70.price=_this70.basePrice=15;_this70.style=0;return _this70;}_createClass(HorsePotion,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("HorsePotion",this);}},{key:"usable",value:function usable(context){var on=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return{OK:true,msg:'drink'};}},{key:"use",value:function use(context){var on=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var _gaveAway=false;if(context instanceof Inventory){if(on===null)on=context.parent;else _gaveAway=true;context.removeItem(this.id);if(on instanceof Character){if(this.style===0){on.addEffect(new effHorsePower(),effHorsePower.name);}else if(this.style===10){on.addEffect(new effLapineSpeed(),effLapineSpeed.name);}on.Stats.increment("health",80);on.Stats.increment("energy",40);return{OK:true,msg:on.name+' drank a potion.'};}}else throw new Error('context is invalid');}},{key:"style",set:function set(style){this._style=style;if(style===0)this.id=this.name='HorsePotion';else if(style===10)this.id=this.name='CarrotJuice';else if(style===20)this.id=this.name='BrownPill';else if(style===30)this.id=this.name='RedPill';else if(style===40)this.id=this.name='GreenPill';else if(style===50)this.id=this.name='BluePill';else throw new Error(this.id+' doesnt know '+style);},get:function get(){return this._style;}},{key:"desc",get:function get(){var msg=this.name;return msg;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(HorsePotion,value.data);}}]);return HorsePotion;}(Item);var Pills=/*#__PURE__*/function(_Item21){_inherits(Pills,_Item21);var _super73=_createSuper(Pills);function Pills(){var _this71;_classCallCheck(this,Pills);_this71=_super73.call(this,'Pills');_this71.addTags([window.gm.ItemTags.Drink]);_this71.price=_this71.basePrice=15;_this71.style=0;return _this71;}_createClass(Pills,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("Pills",this);}},{key:"usable",value:function usable(context){var on=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return{OK:true,msg:'swallow'};}},{key:"use",value:function use(context){var on=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var _txt='';if(context instanceof Inventory){if(on===null)on=context.parent;context.removeItem(this.id);if(on instanceof Character){on.addEffect(effPillEffect.factory(this.id));on.Stats.increment("health",80);on.Stats.increment("energy",40);window.gm.MutationsLib['changeSavage'](on,3,0,20);_txt=on.name+' swallowed a drug. ';_txt+=this.style===0?'Poison resistance increased.':this.style===50?'':'';return{OK:true,msg:_txt};}}else throw new Error('context is invalid');}},{key:"style",set:function set(style){this._style=style;if(style===0)this.id=this.name='BrownPill';else if(style===30)this.id=this.name='RedPill';else if(style===40)this.id=this.name='GreenPill';else if(style===50)this.id=this.name='BluePill';else if(style===50)this.id=this.name='WhitePill';else throw new Error(this.id+' doesnt know '+style);},get:function get(){return this._style;}},{key:"desc",get:function get(){var msg=this.name;return msg;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(Pills,value.data);}}]);return Pills;}(Item);var SkillBook=/*#__PURE__*/function(_Item22){_inherits(SkillBook,_Item22);var _super74=_createSuper(SkillBook);_createClass(SkillBook,null,[{key:"factory",//todo
value:function factory(style){var x=new SkillBook();x.style=style;return x;}}]);function SkillBook(){var _this72;_classCallCheck(this,SkillBook);_this72=_super74.call(this,'SkillBook');_this72.addTags([window.gm.ItemTags.Food]);_this72.price=_this72.basePrice=100;_this72.style=0;return _this72;}_createClass(SkillBook,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SkillBook",this);}},{key:"usable",value:function usable(context){var on=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return{OK:true,msg:'read'};}},{key:"use",value:function use(context){var on=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var _txt='';if(context instanceof Inventory){if(on===null)on=context.parent;//todo grant skill
context.removeItem(this.id);if(on instanceof Character){return{OK:true,msg:_txt};}}else throw new Error('context is invalid');}},{key:"style",set:function set(style){this._style=style;if(style===0)this.id=this.name='SkillbookMedicine';else throw new Error(this.id+' doesnt know '+style);},get:function get(){return this._style;}},{key:"desc",get:function get(){var msg=this.name;return msg;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkillBook,value.data);}}]);return SkillBook;}(Item);var RegenderPotion=/*#__PURE__*/function(_Item23){_inherits(RegenderPotion,_Item23);var _super75=_createSuper(RegenderPotion);function RegenderPotion(){var _this73;_classCallCheck(this,RegenderPotion);_this73=_super75.call(this,'RegenderPotion');_this73.addTags([window.gm.ItemTags.Drink]);_this73.price=_this73.basePrice=500;_this73.style=0;return _this73;}_createClass(RegenderPotion,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("RegenderPotion",this);}},{key:"usable",value:function usable(context){var on=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return{OK:true,msg:'drink'};}},{key:"use",value:function use(context){var on=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var _gaveAway=false;if(context instanceof Inventory){if(on===null)on=context.parent;else _gaveAway=true;context.removeItem(this.id);if(on instanceof Character){if(on instanceof Character){window.gm.MutationsLib.swapGender(window.gm.player,new window.storage.constructors[this.style===0?"VulvaHuman":"PenisHuman"]());}return{OK:true,msg:on.name+' drank a potion.'};}}else throw new Error('context is invalid');}},{key:"style",set:function set(style){this._style=style;if(style===0)this.id=this.name='Vaginarium';else if(style===10)this.id=this.name='Penilium';else throw new Error(this.id+' doesnt know '+style);},get:function get(){return this._style;}},{key:"desc",get:function get(){var msg=this.name;if(this.style===0)msg+=' gets you some female bits.';else if(this.style===10)msg+=' gets you some male bits.';return msg;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(RegenderPotion,value.data);}}]);return RegenderPotion;}(Item);window.gm.ItemTags={//
//Items
Quest:"quest",//quest-item; dont sell or give away
Cursed:"cursed",Money:'money',//...for trading
Ingredient:'ingred',Material:'material',Drink:'drink',Food:'food',Heal:'heal',Poison:'poison',//Outfit
Piercing:"piercing",Tattoo:"tattoo",Armor:"armor",Wear:'wear',//something to cover the body
//weapons
Tool:'tool',Weapon:"weapon",Shield:"shield",Melee:"melee",Ranged:"ranged"};window.gm.ItemsLib=function(ItemsLib){window.storage.registerConstructor(Box);window.storage.registerConstructor(LighterDad);window.storage.registerConstructor(Voucher);window.storage.registerConstructor(Money);window.storage.registerConstructor(LaptopPS);window.storage.registerConstructor(Battery);window.storage.registerConstructor(Dildo);window.storage.registerConstructor(Lube);window.storage.registerConstructor(Rope);window.storage.registerConstructor(CanOfCoffee);window.storage.registerConstructor(KeyRestraint);window.storage.registerConstructor(SimpleFood);window.storage.registerConstructor(HealthPotion);window.storage.registerConstructor(HorsePotion);window.storage.registerConstructor(Ingredient);//only need constructor for base-ingredient
window.storage.registerConstructor(FlashBang);window.storage.registerConstructor(Pills);window.storage.registerConstructor(QuestItems);window.storage.registerConstructor(SoulGem);//Some of those items are generics that need some setup;
ItemsLib['Money']=function(){return new Money();};ItemsLib['LighterDad']=function(){return new LighterDad();};ItemsLib['LaptopPS']=function(){return new LaptopPS();};ItemsLib['Battery']=function(){return new Battery();};ItemsLib['Dildo_small']=function(){var x=new Dildo();return x;};// consumables
ItemsLib['Lube']=function(){return new Lube();};ItemsLib['CanOfCoffee']=function(){return new CanOfCoffee();};ItemsLib['SimpleFood']=function(){return new SimpleFood();};ItemsLib['Sandwich']=function(){var x=new SimpleFood();x.style=5;return x;};ItemsLib['ViolettMushroom']=function(){var x=new SimpleFood();x.style=10;return x;};ItemsLib['BrownMushroom']=function(){var x=new SimpleFood();x.style=20;return x;};ItemsLib['RottenMushroom']=function(){var x=new SimpleFood();x.style=30;return x;};ItemsLib['FlashBang']=function(){return new FlashBang();};//healthpotion
ItemsLib['HealthPotion']=function(){return HealthPotion.factory(0);};ItemsLib['HealthPotionSmall']=function(){return HealthPotion.factory(10);};ItemsLib['SerenityPotionSmall']=function(){return HealthPotion.factory(100);};ItemsLib['HorsePotion']=function(){var x=new HorsePotion();return x;};ItemsLib['CarrotJuice']=function(){var x=new HorsePotion();x.style=10;return x;};ItemsLib['BrownPill']=function(){var x=new Pills();x.style=0;return x;};ItemsLib['RedPill']=function(){var x=new Pills();x.style=30;return x;};ItemsLib['GreenPill']=function(){var x=new Pills();x.style=40;return x;};ItemsLib['BluePill']=function(){var x=new Pills();x.style=50;return x;};ItemsLib['Vaginarium']=function(){var x=new RegenderPotion();return x;};ItemsLib['Penilium']=function(){var x=new RegenderPotion();x.style=10;return x;};//Mysterious Box
ItemsLib['Box']=function(){var x=new Box();x.style=0;return x;};//Ingredient
ItemsLib['SquishedLeech']=function(){var x=new Ingredient();x.style=30;return x;};ItemsLib['Beewax']=function(){var x=new Ingredient();x.style=110;return x;};ItemsLib['BogBovus']=function(){var x=new Ingredient();x.style=20;return x;};ItemsLib['PurpleBerry']=function(){var x=new Ingredient();x.style=10;return x;};ItemsLib['WolfTooth']=function(){var x=new Ingredient();x.style=40;return x;};ItemsLib['ApocaFlower']=function(){var x=new Ingredient();return x;};ItemsLib['DryadVine']=function(){var x=new Ingredient();x.style=50;return x;};ItemsLib['Dimetrium']=function(){var x=new Ingredient();x.style=60;return x;};ItemsLib['GiantPlum']=function(){var x=new Ingredient();x.style=70;return x;};ItemsLib['EmptyGlas']=function(){var x=new Ingredient();x.style=80;return x;};ItemsLib['CrystalWater']=function(){var x=new Ingredient();x.style=90;return x;};ItemsLib['BlackCandle']=function(){var x=new Ingredient();x.style=100;return x;};ItemsLib['BlueSlime']=function(){var x=new Ingredient();x.style=110;return x;};ItemsLib['RedSlime']=function(){var x=new Ingredient();x.style=120;return x;};ItemsLib['GreenSlime']=function(){var x=new Ingredient();x.style=130;return x;};ItemsLib['Cobwebs']=function(){var x=new Ingredient();x.style=150;return x;};ItemsLib['Ingwer']=function(){var x=new Ingredient();x.style=160;return x;};//Questitems
ItemsLib['IgneumPage']=function(){var x=new QuestItems();x.style=0;return x;};ItemsLib['RedAnkh']=function(){var x=new QuestItems();x.style=10;return x;};ItemsLib['RingOfBurden']=function(){var x=new QuestItems();x.style=20;return x;};ItemsLib['GemstoneRed']=function(){var x=new QuestItems();x.style=30;return x;};ItemsLib['GemstoneGreen']=function(){var x=new QuestItems();x.style=31;return x;};ItemsLib['GemstoneBlue']=function(){var x=new QuestItems();x.style=32;return x;};ItemsLib['Fuse']=function(){var x=new QuestItems();x.style=50;return x;};//soulgem
ItemsLib['TinySoulGem']=function(){var x=new SoulGem();return x;};//keys
ItemsLib['Rope']=function(){var x=new Rope();return x;};ItemsLib['RopeSturdy']=function(){var x=new Rope();x.style=10;return x;};ItemsLib['KeyRestraintA']=function(){var x=new KeyRestraint();return x;};ItemsLib['KeyRestraintB']=function(){var x=new KeyRestraint();x.style=10;return x;};//voucher
ItemsLib['VoucherIron']=function(){var x=new Voucher();return x;};ItemsLib['VoucherBronze']=function(){var x=new Voucher();x.style=10;return x;};ItemsLib['VoucherSilver']=function(){var x=new Voucher();x.style=20;return x;};ItemsLib['VoucherGold']=function(){var x=new Voucher();x.style=30;return x;};return ItemsLib;}(window.gm.ItemsLib||{});"use strict";/*
demon/ghost
- imp
- vampire
- gargoyle
- whisp
- mimic, transportation trap
- cursed tome of conjuring

human
- nymph
- beauty nurse

feral scaly
- Giant-Snake
- raptor
- dragon/wyvern

anthro scaly
- kobold
- naga

feral mammal
- grizzly
- gryphon
- felkin

anthro mammal
- stag-boy/-Stud  archer, drummer, warrior
- cougar-girl/-mistress
- werwolf

fetish zealots ; force an item on you if you loose or you can grab an item with a chance that it is Key/tool or a fetish-related item
- latex-, pet-,pony-,cock-sleave-, milk-slave and master/mistress
- enforcer/chastiser - makes sure you dont fuck around
- body artist - gies you tattos/piercings
- bondage

feral insects
- Giant wasp
- spider/tarantula
- glyphid swarmers/ Brood hive
- glyphid soldiers
- eggclutch spawns reinforcement until destroid; chance to release swarm
- swarm of...; cant be killed with one hit, only one by one ("One of the flys is knocked out but there are 3 left")

anthro insect
- drider
- bee queen

lower life
- fungus/spore-pod
- vile vine
- lush orchid
- slug
- Naeodocyte shocker
- cave leech
- vampire squid

mechanic
- otter-bot - a otter controlling a mech
- mobile milker/gynochair/inseminator
- mechanic guard

 */ ////////////////////////////////////////////////////////
// normal foes
var Mole=/*#__PURE__*/function(_Mob){_inherits(Mole,_Mob);var _super76=_createSuper(Mole);_createClass(Mole,null,[{key:"factory",value:function factory(type){var foe=new Mole();if(type==='Squirrel'){foe.baseName=foe.id='Squirrel';this.pic='squirrel1';}return foe;}}]);function Mole(){var _this74;_classCallCheck(this,Mole);_this74=_super76.call(this);_this74.baseName=_this74.id='Mole';_this74.pic='squirrel1';//todo
_this74.Stats.increment('healthMax',-0.5*_this74.health().max);return _this74;}return Mole;}(Mob);var Cat=/*#__PURE__*/function(_Mob2){_inherits(Cat,_Mob2);var _super77=_createSuper(Cat);_createClass(Cat,null,[{key:"factory",value:function factory(type){var foe=new Cat();if(type==='Panther'){foe.baseName=foe.id='Panther';foe.Stats.increment('healthMax',0.3*foe.health().max);}return foe;}}]);function Cat(){var _this75;_classCallCheck(this,Cat);_this75=_super77.call(this);_this75.baseName=_this75.id='Cat';_this75.pic="FeralCat";_this75.level_min=3;_this75.loot=[{id:'WolfTooth',chance:25,amount:1},{id:'Money',chance:25,amount:20}];_this75.Outfit.addItem(new BaseQuadruped());_this75.Outfit.addItem(SkinFur.factory('cat','gray'));_this75.Outfit.addItem(HandsPaw.factory('cat'));_this75.Outfit.addItem(PenisHuman.factory('cat'));_this75.Outfit.addItem(AnusHuman.factory('cat'));_this75.Outfit.addItem(TailWolf.factory('cat'));_this75.Outfit.addItem(FaceWolf.factory('cat'));_this75.Stats.increment('arm_blunt',5);return _this75;}_createClass(Cat,[{key:"calcCombatMove",value:function calcCombatMove(enemys,friends){var result={OK:true,msg:''};//this._canAct();
var rnd=_.random(1,100);var spawn="CallHelpWolf";if(!this.fconv)this.fconv=window.gm.util.descFixer(this);result.action=result.target=null;if(window.story.state.combat.turnCount%2===0){rnd=_.random(0,enemys.length-1);result.action="Bite";result.target=[enemys[rnd]];result.msg=this.name+" snaps at "+result.target[0].name+".</br>"+result.msg;return result;}else{rnd=_.random(0,enemys.length-1);result.action="Attack";result.target=[enemys[rnd]];result.msg=this.name+" claws at "+result.target[0].name+".</br>"+result.msg;return result;}return _get(_getPrototypeOf(Cat.prototype),"calcCombatMove",this).call(this,enemys,friends);}}]);return Cat;}(Mob);var Wolf=/*#__PURE__*/function(_Mob3){_inherits(Wolf,_Mob3);var _super78=_createSuper(Wolf);_createClass(Wolf,null,[{key:"factory",value:function factory(type){var foe=new Wolf();if(type==='AlphaWolf'){foe.baseName=foe.id='AlphaWolf';foe.Stats.increment('healthMax',-0.3*foe.health().max);foe.Skills.addItem(SkillCallHelp.factory('Wolf'));//todo chance to call?
foe.pic='wolf3';}else if(type==='Guarddog'){foe.baseName=foe.id='Guarddog';foe.Stats.increment('healthMax',-0.3*foe.health().max);foe.pic='hellhound1';}else{foe.Stats.increment('healthMax',-0.5*foe.health().max);}return foe;}}]);function Wolf(){var _this76;_classCallCheck(this,Wolf);_this76=_super78.call(this);_this76.baseName=_this76.id='Wolf';_this76.pic="wolf3";//'assets/battlers/wolf3.svg';
_this76.level_min=3;_this76.loot=[{id:'WolfTooth',chance:25,amount:1},{id:'Money',chance:25,amount:20}];_this76.Outfit.addItem(new BaseQuadruped());_this76.Outfit.addItem(SkinFur.factory('wolf','black'));_this76.Outfit.addItem(HandsPaw.factory('wolf'));_this76.Outfit.addItem(PenisHuman.factory('wolf'));_this76.Outfit.addItem(AnusHuman.factory('wolf'));_this76.Outfit.addItem(TailWolf.factory('wolf'));_this76.Outfit.addItem(FaceWolf.factory('wolf'));_this76.Stats.increment('arm_blunt',5);return _this76;}_createClass(Wolf,[{key:"calcCombatMove",value:function calcCombatMove(enemys,friends){var result={OK:true,msg:''};//this._canAct();
var rnd=_.random(1,100);var spawn="CallHelpWolf";if(!this.fconv)this.fconv=window.gm.util.descFixer(this);result.action=result.target=null;if(window.story.state.combat.turnCount%2===0){rnd=_.random(0,enemys.length-1);result.action="Bite";result.target=[enemys[rnd]];result.msg=this.name+" snaps at "+result.target[0].name+".</br>"+result.msg;return result;}else if(window.story.state.combat.turnCount>3&&this.Skills.countItem(spawn)>0&&this.Skills.getItem(spawn).isEnabled().OK){result.action=spawn;result.target=[this];result.msg=this.name+" howls to call its pack for support.</br>"+result.msg;return result;}return _get(_getPrototypeOf(Wolf.prototype),"calcCombatMove",this).call(this,enemys,friends);}}]);return Wolf;}(Mob);/*class Dragon extends Mob {   //wyvern, quadrupped w/o wings, w/o horns, scales/fur
    static factory(type){
        let foe = new Dragon();
        if(type==='AlphaWolf'){
        }
        return foe;
    }
    constructor(){
        super();
        this.name = this.id = 'Dragon';
        this.pic= "dragon1";
        this.level_min =10;
        this.loot= [{id:'Money',chance:25,amount:20}];
        this.Outfit.addItem(new BaseQuadruped());
        this.Outfit.addItem(SkinFur.factory('wolf','black'));
        this.Outfit.addItem(HandsPaw.factory('wolf'));
        this.Outfit.addItem(PenisHuman.factory('wolf'));
        this.Outfit.addItem(AnusHuman.factory('wolf'));
        this.Outfit.addItem(TailSnake.factory('dragon'));
        this.Outfit.addItem(FaceWolf.factory('wolf'));
        this.Stats.increment('arm_blunt',5);
    }
}*/var Slime=/*#__PURE__*/function(_Mob4){_inherits(Slime,_Mob4);var _super79=_createSuper(Slime);_createClass(Slime,null,[{key:"factory",value:function factory(type){var foe=new Slime();foe.Outfit.addItem(WeaponSlobber.factory('slime'));foe.baseName=foe.id=type===0||type===undefined?'Slime':type;if(type==='SlimeTentacled'){//todo add tentacles and grappling
foe.pic='Blob3';foe.loot=[{id:'BlueSlime',chance:55,amount:1},{id:'Money',chance:25,amount:20}];}else if(type==='SlimeBig'){foe.pic='Blob1';foe.Skills.addItem(SkillTransformSelf.factory(['Slime','Slime']));foe.loot=[{id:'GreenSlime',chance:55,amount:1},{id:'Money',chance:25,amount:20}];}else{//Slime
foe.loot=[{id:'RedSlime',chance:55,amount:1},{id:'Money',chance:25,amount:20}];}return foe;}}]);function Slime(){var _this77;_classCallCheck(this,Slime);_this77=_super79.call(this);_this77.baseName=_this77.id='Slime';_this77.pic='Blob4';_this77.level_min=1;_this77.Outfit.addItem(new BaseWorm());_this77.Outfit.addItem(ArmorTorso.factory('slime'));_this77.Stats.increment('rst_light',-20);return _this77;}_createClass(Slime,[{key:"calcCombatMove",value:function calcCombatMove(enemys,friends){var result={OK:true,msg:''};var skill,rnd=_.random(1,100);if(!this.fconv)this.fconv=window.gm.util.descFixer(this);result.action=result.target=null;skill="TransformSelfSlime";var health=this.health();if(this.id==='SlimeBig'&&window.story.state.combat.turnCount>2&&health.value/health.max<0.6&&this.Skills.getItem(skill).isEnabled().OK){result.action=skill;result.target=[this];return result;}skill='slime-slobber';if(window.story.state.combat.turnCount>2&&rnd>30&&this.Skills.getItem(skill).isEnabled().OK){rnd=_.random(0,enemys.length-1);result.action=skill;result.target=[enemys[rnd]];result.msg=/*this.fconv("$[I]$ thrust $[my]$ stinger at "+result.target[0].baseName+".</br>")+*/result.msg;return result;}return _get(_getPrototypeOf(Slime.prototype),"calcCombatMove",this).call(this,enemys,friends);}}]);return Slime;}(Mob);var Slug=/*#__PURE__*/function(_Mob5){_inherits(Slug,_Mob5);var _super80=_createSuper(Slug);_createClass(Slug,null,[{key:"factory",value:function factory(type){var foe=new Slug();return foe;}}]);function Slug(){var _this78;_classCallCheck(this,Slug);_this78=_super80.call(this);_this78.baseName=_this78.id='Slug';_this78.pic='slug2';_this78.level_min=1;_this78.Outfit.addItem(new BaseWorm());_this78.Outfit.addItem(FaceLeech.factory('slug'));_this78.Outfit.addItem(ArmorTorso.factory('slime'));return _this78;}_createClass(Slug,[{key:"calcCombatMove",value:function calcCombatMove(enemys,friends){var result={OK:true,msg:''};var rnd=_.random(1,100);if(!this.fconv)this.fconv=window.gm.util.descFixer(this);result.action=result.target=null;if(this.Stats.countItem(effKamikaze.name)<=0&&this.Stats.get('health').rmax<0.5){//self-exploding
this.addEffect(effKamikaze.factory(0));}if(window.story.state.combat.turnCount%2===0){rnd=_.random(0,enemys.length-1);result.action="Bite";result.target=[enemys[rnd]];result.msg=this.name+" slurps at "+result.target[0].name+".</br>"+result.msg;return result;}return _get(_getPrototypeOf(Slug.prototype),"calcCombatMove",this).call(this,enemys,friends);}}]);return Slug;}(Mob);var Spider=/*#__PURE__*/function(_Mob6){_inherits(Spider,_Mob6);var _super81=_createSuper(Spider);_createClass(Spider,null,[{key:"factory",value:function factory(type){var foe=new Spider();foe.baseName=foe.id=type===0||type===undefined?'Spider':type;if(type==='spiderswarm'){foe.pic='spider3';foe.Stats.increment('healthMax',-0.3*foe.health().max);foe.loot=[{id:'Cobwebs',chance:55,amount:2},{id:'Money',chance:25,amount:20}];}else if(type==='tarantula'){foe.pic='spider2';foe.loot=[{id:'Cobweb',chance:55,amount:1},{id:'Money',chance:25,amount:20}];}else{foe.pic='spider1';foe.Stats.increment('healthMax',-0.5*foe.health().max);foe.loot=[{id:'Cobwebs',chance:55,amount:1},{id:'Money',chance:25,amount:20}];}return foe;}}]);function Spider(){var _this79;_classCallCheck(this,Spider);_this79=_super81.call(this);_this79.baseName=_this79.id='Spider';_this79.pic='unknown';_this79.level_min=1;_this79.Outfit.addItem(new BaseInsect());_this79.Outfit.addItem(new ArmorTorso('chitin'));_this79.Outfit.addItem(new FaceInsect('spider'));//todo legs
_this79.Skills.addItem(new SkillGrapple());//todo paralyzing poison
_this79.tmp={grappleCoolDown:2};return _this79;}_createClass(Spider,[{key:"calcCombatMove",value:function calcCombatMove(enemys,friends){var result={OK:true,msg:''};var rnd=_.random(1,100),skWeb='Grapple';if(!this.fconv)this.fconv=window.gm.util.descFixer(this);result.action=result.target=null;if(window.story.state.combat.turnCount%2===0){rnd=_.random(0,enemys.length-1);result.action="Bite";result.target=[enemys[rnd]];result.msg=this.name+" snaps at "+result.target[0].name+".</br>"+result.msg;return result;}else if(this.Effects.countItem(effGrappling.name)>0){this.tmp.grappleCoolDown=5;result.msg=this.fconv(this.name+" weaves a web around [my] victim.</br>")+result.msg;return result;}else if(this.tmp.grappleCoolDown<=0&&this.Skills.countItem(skWeb)>0&&this.Skills.getItem(skWeb).isEnabled().OK){this.tmp.grappleCoolDown=3;rnd=_.random(0,enemys.length-1);result.action=skWeb;result.target=[enemys[rnd]];result.msg=this.fconv(this.name+" trys to entangle "+result.target[0].name+" in a web.</br>")+result.msg;return result;}else{this.tmp.grappleCoolDown-=1;}return _get(_getPrototypeOf(Spider.prototype),"calcCombatMove",this).call(this,enemys,friends);}}]);return Spider;}(Mob);var Leech=/*#__PURE__*/function(_Mob7){_inherits(Leech,_Mob7);var _super82=_createSuper(Leech);_createClass(Leech,null,[{key:"factory",value:function factory(type){var foe=new Leech();return foe;}}]);function Leech(){var _this80;_classCallCheck(this,Leech);_this80=_super82.call(this);_this80.baseName=_this80.id='Leech';_this80.pic='leech2';_this80.level_min=1;_this80.Outfit.addItem(new BaseWorm());_this80.Outfit.addItem(FaceLeech.factory('leech'));_this80.Skills.addItem(new SkillLeechHealth());_this80.tmp={grappleCoolDown:1};return _this80;}_createClass(Leech,[{key:"calcCombatMove",value:function calcCombatMove(enemys,friends){var result={OK:true,msg:''};var rnd=_.random(1,100);if(!this.fconv)this.fconv=window.gm.util.descFixer(this);result.action=result.target=null;if(this.Effects.countItem(effGrappling.name)>0){this.tmp.grappleCoolDown=2;result.msg=this.fconv(this.name+" sucks blood.</br>")+result.msg;return result;}else if(this.tmp.grappleCoolDown<=0){this.tmp.grappleCoolDown=2;rnd=_.random(0,enemys.length-1);result.action="Leech";result.target=[enemys[rnd]];result.msg=this.fconv("$[I]$ $[snap]$ at "+result.target[0].name+".</br>")+result.msg;return result;}else{this.tmp.grappleCoolDown-=1;}return _get(_getPrototypeOf(Leech.prototype),"calcCombatMove",this).call(this,enemys,friends);}}]);return Leech;}(Mob);var Lizan=/*#__PURE__*/function(_Mob8){_inherits(Lizan,_Mob8);var _super83=_createSuper(Lizan);_createClass(Lizan,null,[{key:"factory",value:function factory(type){var foe=new Lizan();if(type==='spearthrower'){foe.Outfit.addItem(window.gm.ItemsLib['SpearStone']());}else{foe.Outfit.addItem(new DaggerSteel());}return foe;}}]);function Lizan(){var _this81;_classCallCheck(this,Lizan);_this81=_super83.call(this);_this81.baseName=_this81.id='Lizan';_this81.pic='lizan1';_this81.Outfit.addItem(new BaseHumanoid());_this81.Outfit.addItem(SkinScales.factory('lizard'));_this81.Outfit.addItem(HandsHuman.factory('lizard'));_this81.Outfit.addItem(BreastHuman.factory('lizard'));_this81.Outfit.addItem(FaceWolf.factory('lizard'));_this81.Outfit.addItem(AnusHuman.factory('lizard'));_this81.Outfit.addItem(PenisHuman.factory('lizard'));_this81.Outfit.addItem(ShortsLeather.factory(100));var sk=new SkillGuard();sk.style=2;_this81.Skills.addItem(sk);_this81.levelUp(3);_this81.autoLeveling();return _this81;}_createClass(Lizan,[{key:"calcCombatMove",value:function calcCombatMove(enemys,friends){var result={OK:true,msg:''};if(!this.fconv)this.fconv=window.gm.util.descFixer(this);var rnd=_.random(1,100);result.action=result.target=null;//todo shoot arrow, pounce, throw net
if(window.story.state.combat.turnCount%2===0){result.action="Guard";result.target=[this];result.msg=this.name+" croutches into a defensive stance.</br>"+result.msg;return result;}return _get(_getPrototypeOf(Lizan.prototype),"calcCombatMove",this).call(this,enemys,friends);}}]);return Lizan;}(Mob);var AnthroFox=/*#__PURE__*/function(_Mob9){_inherits(AnthroFox,_Mob9);var _super84=_createSuper(AnthroFox);_createClass(AnthroFox,null,[{key:"factory",value:function factory(type){var foe=new AnthroFox();if(type==='Huntress'){foe.Outfit.addItem(window.gm.ItemsLib['SpearStone']());}else{foe.Outfit.addItem(new DaggerSteel());}return foe;}}]);function AnthroFox(){var _this82;_classCallCheck(this,AnthroFox);_this82=_super84.call(this);_this82.baseName=_this82.id='AnthroFox';_this82.pic='unknown';_this82.Outfit.addItem(new BaseHumanoid());_this82.Outfit.addItem(SkinFur.factory('fox'));_this82.Outfit.addItem(HandsHuman.factory('fox'));_this82.Outfit.addItem(BreastHuman.factory('fox'));_this82.Outfit.addItem(FaceWolf.factory('fox'));_this82.Outfit.addItem(AnusHuman.factory('fox'));_this82.Outfit.addItem(TailWolf.factory('fox'));_this82.Outfit.addItem(VulvaHuman.factory('fox'));_this82.Outfit.addItem(ShortsLeather.factory(100));return _this82;}return AnthroFox;}(Mob);var AnthroCat=/*#__PURE__*/function(_Mob10){_inherits(AnthroCat,_Mob10);var _super85=_createSuper(AnthroCat);_createClass(AnthroCat,null,[{key:"factory",value:function factory(type){var foe=new AnthroCat();if(type==='Huntress'){foe.Outfit.addItem(window.gm.ItemsLib['SpearStone']());}else{foe.Outfit.addItem(new DaggerSteel());}return foe;}}]);function AnthroCat(){var _this83;_classCallCheck(this,AnthroCat);_this83=_super85.call(this);_this83.baseName=_this83.id='AnthroCat';_this83.pic='unknown';_this83.Outfit.addItem(new BaseHumanoid());_this83.Outfit.addItem(SkinFur.factory('cat'));_this83.Outfit.addItem(HandsHuman.factory('cat'));_this83.Outfit.addItem(BreastHuman.factory('cat'));_this83.Outfit.addItem(FaceWolf.factory('cat'));_this83.Outfit.addItem(AnusHuman.factory('cat'));_this83.Outfit.addItem(TailWolf.factory('cat'));_this83.Outfit.addItem(VulvaHuman.factory('cat'));_this83.Outfit.addItem(ShortsLeather.factory(100));//let sk = new SkillKick();this.Skills.addItem(sk);
return _this83;}return AnthroCat;}(Mob);var AnthroWolf=/*#__PURE__*/function(_Mob11){_inherits(AnthroWolf,_Mob11);var _super86=_createSuper(AnthroWolf);_createClass(AnthroWolf,null,[{key:"factory",value:function factory(type){var foe=new AnthroWolf();if(type==='Wolfman'){foe.pic='WolfMan1';foe.Outfit.addItem(window.gm.ItemsLib['SpearStone']());}else{foe.Outfit.addItem(new DaggerSteel());}return foe;}}]);function AnthroWolf(){var _this84;_classCallCheck(this,AnthroWolf);_this84=_super86.call(this);_this84.baseName=_this84.id='AnthroWolf';_this84.pic='unknown';_this84.Outfit.addItem(new BaseHumanoid());_this84.Outfit.addItem(SkinFur.factory('wolf'));_this84.Outfit.addItem(HandsHuman.factory('wolf'));_this84.Outfit.addItem(BreastHuman.factory('wolf'));_this84.Outfit.addItem(FaceWolf.factory('wolf'));_this84.Outfit.addItem(AnusHuman.factory('wolf'));_this84.Outfit.addItem(TailWolf.factory('wolf'));_this84.Outfit.addItem(VulvaHuman.factory('wolf'));_this84.Outfit.addItem(ShortsLeather.factory(100));//let sk = new SkillKick();this.Skills.addItem(sk);
return _this84;}return AnthroWolf;}(Mob);var Lapine=/*#__PURE__*/function(_Mob12){_inherits(Lapine,_Mob12);var _super87=_createSuper(Lapine);_createClass(Lapine,null,[{key:"factory",value:function factory(type){var foe=new Lapine();if(type==='spearthrower'){foe.Outfit.addItem(window.gm.ItemsLib['SpearStone']());}else{foe.Outfit.addItem(new DaggerSteel());}return foe;}}]);function Lapine(){var _this85;_classCallCheck(this,Lapine);_this85=_super87.call(this);_this85.baseName=_this85.id='Lapine';_this85.pic='Bunny1';_this85.Outfit.addItem(new BaseHumanoid());_this85.Outfit.addItem(SkinFur.factory('bunny'));_this85.Outfit.addItem(HandsHuman.factory('bunny'));_this85.Outfit.addItem(BreastHuman.factory('bunny'));_this85.Outfit.addItem(FaceHorse.factory('bunny'));_this85.Outfit.addItem(AnusHuman.factory('bunny'));_this85.Outfit.addItem(VulvaHuman.factory('bunny'));_this85.Outfit.addItem(ShortsLeather.factory(100));var sk=new SkillKick();_this85.Skills.addItem(sk);return _this85;}_createClass(Lapine,[{key:"calcCombatMove",value:function calcCombatMove(enemys,friends){var result={OK:true,msg:''};if(!this.fconv)this.fconv=window.gm.util.descFixer(this);var rnd=_.random(1,100);result.action=result.target=null;var skill=this.Skills.getItem("Kick");if(window.story.state.combat.turnCount>2&&rnd>50&&skill.isEnabled().OK){result.action=skill.name;rnd=_.random(0,enemys.length-1);result.target=[enemys[rnd]];result.msg=this.name+" prepares for a powerful jump-kick.</br>"+result.msg;return result;}return _get(_getPrototypeOf(Lapine.prototype),"calcCombatMove",this).call(this,enemys,friends);}}]);return Lapine;}(Mob);var Imp=/*#__PURE__*/function(_Mob13){_inherits(Imp,_Mob13);var _super88=_createSuper(Imp);_createClass(Imp,null,[{key:"factory",value:function factory(type){var foe=new Imp();if(type==='implord'){foe.Outfit.addItem(window.gm.ItemsLib['SpearStone']());}else{//foe.Outfit.addItem(new DaggerSteel());
foe.loot=[{id:'GreenPill',chance:25,amount:1},{id:'Money',chance:25,amount:5}];}return foe;}}]);function Imp(){var _this86;_classCallCheck(this,Imp);_this86=_super88.call(this);_this86.baseName=_this86.id='Imp';_this86.pic='Imp1';_this86.Outfit.addItem(new BaseHumanoid());_this86.Outfit.addItem(SkinHuman.factory('human'));_this86.Outfit.addItem(HandsHuman.factory('human'));_this86.Outfit.addItem(BreastHuman.factory('human'));_this86.Outfit.addItem(FaceHuman.factory('imp'));_this86.Outfit.addItem(AnusHuman.factory('bunny'));_this86.Outfit.addItem(PenisHuman.factory('imp'));_this86.Outfit.addItem(ShortsLeather.factory(100));var sk=SkillLustMagic.factory(2);_this86.Skills.addItem(sk);return _this86;}_createClass(Imp,[{key:"calcCombatMove",value:function calcCombatMove(enemys,friends){var result={OK:true,msg:''};if(!this.fconv)this.fconv=window.gm.util.descFixer(this);var rnd=_.random(1,100);result.action=result.target=null;var skill=this.Skills.getItem("LustMagic");if(window.story.state.combat.turnCount>2&&rnd>50&&skill.isEnabled().OK){result.action=skill.name;rnd=_.random(0,enemys.length-1);result.target=[enemys[rnd]];result.msg=this.name+" makes a sudden arcane gesture.</br>"+result.msg;return result;}return _get(_getPrototypeOf(Imp.prototype),"calcCombatMove",this).call(this,enemys,friends);}}]);return Imp;}(Mob);var Succubus=/*#__PURE__*/function(_Mob14){_inherits(Succubus,_Mob14);var _super89=_createSuper(Succubus);_createClass(Succubus,null,[{key:"factory",value:function factory(type){var foe=new Succubus();if(type==='succubus'){foe.Outfit.addItem(window.gm.ItemsLib.WhipLeather());foe.Skills.addItem(SkillCallHelp.factory('WispShield',4));//todo chance to call?
}else if(type==="nurse"){foe.baseName=foe.id='BNurse';foe.pic='Nurse1';foe.Outfit.addItem(window.gm.ItemsLib.Syringe());}return foe;}}]);function Succubus(){var _this87;_classCallCheck(this,Succubus);_this87=_super89.call(this);_this87.baseName=_this87.id='Succubus';_this87.pic='succubus1';_this87.Outfit.addItem(new BaseHumanoid());_this87.Outfit.addItem(SkinHuman.factory("human"));_this87.Outfit.addItem(HandsHuman.factory('human'));_this87.Outfit.addItem(BreastHuman.factory('human'));_this87.Outfit.addItem(FaceHuman.factory('human'));_this87.Outfit.addItem(AnusHuman.factory('human'));_this87.Outfit.addItem(VulvaHuman.factory('human'));_this87.Outfit.addItem(new BikiniBottomLeather());_this87.Outfit.addItem(new BikiniTopLeather());var sk=new SkillGuard();sk.style=2;_this87.Skills.addItem(sk);_this87.levelUp(4);_this87.autoLeveling();var x=new SkillTease();x.level=3;_this87.Skills.addItem(x);return _this87;}_createClass(Succubus,[{key:"calcCombatMove",value:function calcCombatMove(enemys,friends){var result={OK:true,msg:''};if(!this.fconv)this.fconv=window.gm.util.descFixer(this);var rnd=_.random(1,100),spawn='CallHelpWispShield';result.action=result.target=null;//todo whiplash, call tentacles
if(this.Skills.countItem(spawn)>0&&this.Skills.getItem(spawn).isEnabled().OK){result.action=spawn;result.target=[this];result.msg=this.name+" conjures some protective wisps.</br>";//+result.msg;
return result;}else if(window.story.state.combat.turnCount%2===0){rnd=_.random(0,enemys.length-1);result.action="Tease";result.target=[enemys[rnd]];result.msg=this.name+" throws a kiss at "+result.target[0].name+".</br>"+result.msg;return result;}return _get(_getPrototypeOf(Succubus.prototype),"calcCombatMove",this).call(this,enemys,friends);}}]);return Succubus;}(Mob);var Dryad=/*#__PURE__*/function(_Mob15){_inherits(Dryad,_Mob15);var _super90=_createSuper(Dryad);_createClass(Dryad,null,[{key:"factory",value:function factory(type){var foe=new Dryad();return foe;}}]);function Dryad(){var _this88;_classCallCheck(this,Dryad);_this88=_super90.call(this);_this88.name=_this88.id='Dryad';_this88.pic='unknown';_this88.loot=[{id:'DryadVine',chance:25,amount:1}];_this88.Outfit.addItem(new BaseHumanoid());_this88.Outfit.addItem(SkinHuman.factory("human"));_this88.Outfit.addItem(HandsHuman.factory('human'));_this88.Outfit.addItem(BreastHuman.factory('human'));_this88.Outfit.addItem(FaceHuman.factory('human'));_this88.Outfit.addItem(AnusHuman.factory('human'));_this88.Outfit.addItem(VulvaHuman.factory('human'));_this88.Outfit.addItem(new BikiniBottomLeather());_this88.Skills.addItem(SkillCallHelp.factory('Vine'));_this88.levelUp(3);_this88.autoLeveling();_this88.tmp={vines:0};return _this88;}_createClass(Dryad,[{key:"calcCombatMove",value:function calcCombatMove(enemys,friends){var result={OK:true,msg:''};var rnd=_.random(1,100);if(!this.fconv)this.fconv=window.gm.util.descFixer(this);result.action=result.target=null;if(this.tmp.vines<1){this.tmp.vines+=1;result.msg=this.fconv(this.name+" starts to summon something...</br>")+result.msg;result.action='CallHelp';result.target=[this];return result;}//todo poison
return _get(_getPrototypeOf(Dryad.prototype),"calcCombatMove",this).call(this,enemys,friends);}}]);return Dryad;}(Mob);var Vine=/*#__PURE__*/function(_Mob16){_inherits(Vine,_Mob16);var _super91=_createSuper(Vine);_createClass(Vine,null,[{key:"factory",value:function factory(type){var foe=new Vine();return foe;}}]);function Vine(){var _this89;_classCallCheck(this,Vine);_this89=_super91.call(this);_this89.baseName=_this89.id='Vine';_this89.pic='unknown';_this89.Outfit.addItem(new BaseWorm());_this89.Skills.addItem(new SkillGrapple());_this89.tmp={grappleCoolDown:1};return _this89;}_createClass(Vine,[{key:"calcCombatMove",value:function calcCombatMove(enemys,friends){var result={OK:true,msg:''};var rnd=_.random(1,100);if(!this.fconv)this.fconv=window.gm.util.descFixer(this);result.action=result.target=null;if(this.Effects.countItem(effGrappling.name)>0){this.tmp.grappleCoolDown=5;result.msg=this.fconv(this.name+" entwines its prey.</br>")+result.msg;return result;}else if(this.tmp.grappleCoolDown<=0){this.tmp.grappleCoolDown=2;rnd=_.random(0,enemys.length-1);result.action="Grapple";result.target=[enemys[rnd]];result.msg=this.fconv(this.name+" wraps itself around "+result.target[0].name+".</br>")+result.msg;return result;}else{this.tmp.grappleCoolDown-=1;}return _get(_getPrototypeOf(Vine.prototype),"calcCombatMove",this).call(this,enemys,friends);}}]);return Vine;}(Mob);var Fungus=/*#__PURE__*/function(_Mob17){_inherits(Fungus,_Mob17);var _super92=_createSuper(Fungus);_createClass(Fungus,null,[{key:"factory",value:function factory(type){var foe=new Fungus();return foe;}}]);function Fungus(){var _this90;_classCallCheck(this,Fungus);_this90=_super92.call(this);_this90.baseName=_this90.id='Fungus';_this90.pic='Fungi1';_this90.tmp={hitBy:''};_this90.Outfit.addItem(new BaseWorm());_this90.Skills.addItem(new SkillPoisonCloud());return _this90;}_createClass(Fungus,[{key:"addEffect",value:function addEffect(effect,id,who){_get(_getPrototypeOf(Fungus.prototype),"addEffect",this).call(this,effect,id,who);this.tmp.hitBy=who?who.id:'';}},{key:"calcCombatMove",value:function calcCombatMove(enemys,friends){var result={OK:true,msg:''};var rnd=_.random(1,100);if(!this.fconv)this.fconv=window.gm.util.descFixer(this);result.action=result.target=null;if(this.id==='Fungus'){var skill='PoisonCloud';if(this.tmp.hitBy!=''&&this.Skills.getItem(skill).isEnabled().OK){result.action=skill;result.target=enemys.concat(friends);//affect all
result.msg=this.fconv("$[I]$ $[release]$ a cloud of toxic spores into the air.</br>")+result.msg;return result;}}return{OK:true,msg:'',action:null,target:null};}}]);return Fungus;}(Mob);var Mechanic=/*#__PURE__*/function(_Mob18){_inherits(Mechanic,_Mob18);var _super93=_createSuper(Mechanic);_createClass(Mechanic,null,[{key:"factory",value:function factory(type){var foe=new Mechanic();foe.Skills.addItem(new SkillStun());return foe;}}]);function Mechanic(){var _this91;_classCallCheck(this,Mechanic);_this91=_super93.call(this);_this91.baseName=_this91.id='Mechanical-Guy';_this91.pic='unknown';return _this91;}_createClass(Mechanic,[{key:"calcCombatMove",value:function calcCombatMove(enemys,friends){var result={OK:true,msg:''};var rnd=_.random(1,100);result.action=result.target=null;if(window.story.state.combat.turnCount<3){rnd=_.random(0,enemys.length-1);result.action="Stun";result.target=[enemys[rnd]];result.msg=this.name+" trys to hit your head whith his wrench.</br>"+result.msg;return result;}return _get(_getPrototypeOf(Mechanic.prototype),"calcCombatMove",this).call(this,enemys,friends);}}]);return Mechanic;}(Mob);var Hawk=/*#__PURE__*/function(_Mob19){_inherits(Hawk,_Mob19);var _super94=_createSuper(Hawk);_createClass(Hawk,null,[{key:"factory",value:function factory(type){var foe=new Hawk();return foe;}}]);function Hawk(){var _this92;_classCallCheck(this,Hawk);_this92=_super94.call(this);_this92.baseName=_this92.id='Hawk';_this92.pic='Hawk1';_this92.level_min=1;_this92.Outfit.addItem(new BaseBiped());_this92.Outfit.addItem(new ArmorTorso('feathers'));_this92.Outfit.addItem(new SkinFeathers('hawk'));_this92.Outfit.addItem(new FaceBird('hawk'));_this92.Outfit.addItem(Wings.factory('feathered'));_this92.Outfit.addItem(PenisHuman.factory('bird'));_this92.Outfit.addItem(AnusHuman.factory('bird'));return _this92;}_createClass(Hawk,[{key:"calcCombatMove",value:function calcCombatMove(enemys,friends){var result={OK:true,msg:''};var rnd=_.random(1,100);if(!this.fconv)this.fconv=window.gm.util.descFixer(this);result.action=result.target=null;if(this.id==='Hawk'){var skill='Fly';if(this.Skills.getItem(skill).isEnabled().OK&&!this.Skills.getItem(skill).isActive().OK){result.action=skill;result.target=[this];result.msg=this.fconv(result.target[0].name+" starts flying.</br>")+result.msg;return result;}}return _get(_getPrototypeOf(Hawk.prototype),"calcCombatMove",this).call(this,enemys,friends);}}]);return Hawk;}(Mob);var Hive=/*#__PURE__*/function(_Mob20){_inherits(Hive,_Mob20);var _super95=_createSuper(Hive);_createClass(Hive,null,[{key:"factory",value:function factory(type){var foe=new Hive();if(type==='Hornett'){foe.baseName=foe.id='HornettHive';foe.pic='WaspHive';foe.Stats.increment('arm_blunt',15);foe.Stats.increment('arm_pierce',15);foe.Stats.increment('arm_slash',15);foe.Stats.increment('rst_fire',-50);foe.Stats.increment('healthMax',-0.3*foe.health().max);foe.Skills.addItem(SkillCallHelp.factory('Hornett'));}return foe;}}]);function Hive(){var _this93;_classCallCheck(this,Hive);_this93=_super95.call(this);_this93.baseName=_this93.id='Hive';_this93.pic='unknown';_this93.level_min=1;_this93.loot=[];_this93.Outfit.addItem(new BaseWorm());_this93.cooldown=0;return _this93;}_createClass(Hive,[{key:"calcCombatMove",value:function calcCombatMove(enemys,friends){var result={OK:false,msg:''};var rnd,spawn="CallHelpHornett";if(!this.fconv)this.fconv=window.gm.util.descFixer(this);result.action=result.target=null;if(window.story.state.combat.turnCount>2&&this.Skills.countItem(spawn)>0&&this.Skills.getItem(spawn).isEnabled().OK){if(friends.length===1||friends.length<3&&this.cooldown<=0){result.action=spawn;result.target=[this];this.cooldown=4;result.msg=this.name+" pops out another opponent.</br>"+result.msg;}else{this.cooldown-=1;}return result;}return result;}}]);return Hive;}(Mob);var Hornett=/*#__PURE__*/function(_Mob21){_inherits(Hornett,_Mob21);var _super96=_createSuper(Hornett);_createClass(Hornett,null,[{key:"factory",value:function factory(type){var foe=new Hornett();if(type==='PillRoller'){foe.baseName=foe.id='PillRoller';foe.pic='PillRoller1';}else if(type==='Hornett'){foe.Outfit.addItem(WeaponStinger.factory('wasplike'));foe.Outfit.addItem(Wings.factory('chitinous'));}return foe;}}]);function Hornett(){var _this94;_classCallCheck(this,Hornett);_this94=_super96.call(this);_this94.baseName=_this94.id='Hornett';_this94.pic='wasp1';_this94.level_min=1;_this94.loot=[{id:'Beewax',chance:25,amount:1},{id:'Money',chance:50,amount:20}];_this94.Outfit.addItem(new BaseInsect());_this94.Outfit.addItem(new ArmorTorso('chitin'));_this94.Outfit.addItem(new FaceInsect('wasp'));return _this94;}_createClass(Hornett,[{key:"calcCombatMove",value:function calcCombatMove(enemys,friends){var result={OK:true,msg:''};var rnd=_.random(1,100);if(!this.fconv)this.fconv=window.gm.util.descFixer(this);result.action=result.target=null;if(this.id==='Hornett'){var skill='Fly';if(this.Skills.getItem(skill).isEnabled().OK&&!this.Skills.getItem(skill).isActive().OK){result.action=skill;result.target=[this];result.msg=this.fconv(result.target[0].name+" starts flying.</br>")+result.msg;return result;}skill='wasp-stinger';if(this.Skills.getItem(skill).isEnabled().OK){rnd=_.random(0,enemys.length-1);result.action=skill;result.target=[enemys[rnd]];result.msg=/*this.fconv("$[I]$ thrust $[my]$ stinger at "+result.target[0].name+".</br>")+*/result.msg;return result;}}return _get(_getPrototypeOf(Hornett.prototype),"calcCombatMove",this).call(this,enemys,friends);}}]);return Hornett;}(Mob);var Naga=/*#__PURE__*/function(_Mob22){_inherits(Naga,_Mob22);var _super97=_createSuper(Naga);_createClass(Naga,null,[{key:"factory",value:function factory(type){var foe=new Naga();if(type="Quetzal"){this.baseName=this.id=type;this.Outfit.addItem(Wings.factory('feathered'));}return foe;}}]);function Naga(){var _this95;_classCallCheck(this,Naga);_this95=_super97.call(this);_this95.baseName=_this95.id='Naga';_this95.pic='naga1';_this95.level_min=1;_this95.Outfit.addItem(new BaseWorm());_this95.Outfit.addItem(new ArmorTorso('scales'));_this95.Outfit.addItem(new SkinScales('lizard'));_this95.Outfit.addItem(new FaceWolf('lizard'));_this95.Outfit.addItem(TailSnake.factory('naga'));_this95.Outfit.addItem(HandsHuman.factory('lizard'));_this95.Outfit.addItem(PenisHuman.factory('lizard'));_this95.Outfit.addItem(AnusHuman.factory('bird'));return _this95;}_createClass(Naga,[{key:"calcCombatMove",value:function calcCombatMove(enemys,friends){var result={OK:true,msg:''};var rnd=_.random(1,100);if(!this.fconv)this.fconv=window.gm.util.descFixer(this);result.action=result.target=null;if(this.id==='Quetzal'){var skill='Fly';if(this.Skills.getItem(skill).isEnabled().OK&&!this.Skills.getItem(skill).isActive().OK){result.action=skill;result.target=[this];result.msg=this.fconv(result.target[0].name+" starts flying.</br>")+result.msg;return result;}}return _get(_getPrototypeOf(Naga.prototype),"calcCombatMove",this).call(this,enemys,friends);}}]);return Naga;}(Mob);var Wisp=/*#__PURE__*/function(_Mob23){_inherits(Wisp,_Mob23);var _super98=_createSuper(Wisp);_createClass(Wisp,null,[{key:"factory",value:function factory(type){var foe=new Wisp();foe.Stats.increment('healthMax',-0.6*foe.health().max);if(type==='WispShield'){foe.baseName=foe.id='WispShield';foe.Skills.addItem(SkillProtect.factory(0));foe.Stats.increment('rst_light',-20);foe.Stats.increment('rst_spark',-20);foe.Stats.increment('arm_slash',5);foe.Stats.increment('arm_pierce',5);foe.Stats.increment('arm_blunt',5);}return foe;}}]);function Wisp(){var _this96;_classCallCheck(this,Wisp);_this96=_super98.call(this);_this96.baseName=_this96.id='Wisp';_this96.pic='wisp1';_this96.Outfit.addItem(new BaseWorm());return _this96;}_createClass(Wisp,[{key:"calcCombatMove",value:function calcCombatMove(enemys,friends){var result={OK:true,msg:''};var rnd=_.random(1,100),skn='Protect',skill=null;if(!this.fconv)this.fconv=window.gm.util.descFixer(this);result.action=result.target=null;if(this.Skills.countItem(skn)>0&&(skill=this.Skills.getItem(skn),skill.isEnabled().OK)){var _t=skill.targetFilter(friends.map(function(x){return[x];}));//need to priorize target?
if(_t.length<=0)return _get(_getPrototypeOf(Wisp.prototype),"calcCombatMove",this).call(this,enemys,friends);result.action=skn;result.target=_t[0];result.msg=/*this.fconv(this.name + " will protect."+result.target[0].name+"</br>")+*/result.msg;return result;}return _get(_getPrototypeOf(Wisp.prototype),"calcCombatMove",this).call(this,enemys,friends);}}]);return Wisp;}(Mob);/////////////////////////////////////////////////////////
// special NPC
var Carlia=/*#__PURE__*/function(_Mob24){_inherits(Carlia,_Mob24);var _super99=_createSuper(Carlia);function Carlia(){var _this97;_classCallCheck(this,Carlia);_this97=_super99.call(this);_this97.baseName=_this97.id='Carlia';_this97.unique=true;_this97.pic='unknown';_this97.Outfit.addItem(new BaseHumanoid());_this97.Outfit.addItem(new SkinHuman());_this97.Outfit.addItem(HandsHuman.factory('cat'));_this97.Outfit.addItem(FaceWolf.factory('cat'));_this97.Outfit.addItem(BreastHuman.factory('human'));_this97.Outfit.addItem(VulvaHuman.factory('human'));_this97.Outfit.addItem(new BikiniBottomLeather());_this97.Outfit.addItem(new BikiniTopLeather());_this97.levelUp(3);_this97.autoLeveling();return _this97;}return Carlia;}(Mob);var Ruff=/*#__PURE__*/function(_Mob25){_inherits(Ruff,_Mob25);var _super100=_createSuper(Ruff);function Ruff(){var _this98;_classCallCheck(this,Ruff);_this98=_super100.call(this);_this98.baseName=_this98.id='Ruff';_this98.unique=true;_this98.Outfit.addItem(new BaseQuadruped());_this98.Outfit.addItem(SkinFur.factory('wolf','black'));_this98.Outfit.addItem(HandsPaw.factory('wolf'));_this98.Outfit.addItem(PenisHuman.factory('wolf'));_this98.Outfit.addItem(AnusHuman.factory('wolf'));_this98.Outfit.addItem(TailWolf.factory('wolf'));_this98.Outfit.addItem(FaceWolf.factory('wolf'));_this98.Stats.increment('arm_blunt',5);_this98.levelUp(7);_this98.autoLeveling();return _this98;}_createClass(Ruff,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("Ruff",this);}},{key:"calcCombatMove",value:function calcCombatMove(enemys,friends){var result={OK:true,msg:''};//this._canAct();
var rnd=_.random(1,100);var spawn="CallHelpWolf";if(!this.fconv)this.fconv=window.gm.util.descFixer(this);result.action=result.target=null;if(window.story.state.combat.turnCount%2===0){rnd=_.random(0,enemys.length-1);result.action="Bite";result.target=[enemys[rnd]];result.msg=this.name+" snaps at "+result.target[0].name+".</br>"+result.msg;return result;}else if(window.story.state.combat.turnCount>3&&this.Skills.countItem(spawn)>0&&this.Skills.getItem(spawn).isEnabled().OK){result.action=spawn;result.target=[this];result.msg=this.name+" howls to call its pack for support.</br>"+result.msg;return result;}return _get(_getPrototypeOf(Ruff.prototype),"calcCombatMove",this).call(this,enemys,friends);}},{key:"pic",get:function get(){return'wolf3';}}],[{key:"fromJSON",value:function fromJSON(value){var _x=window.storage.Generic_fromJSON(Ruff,value.data);_x._relinkItems();/*_x.Effects._relinkItems();
        _x.Stats._relinkItems();
        _x.Inv._relinkItems();
        _x.Outfit._relinkItems();
        _x.Wardrobe._relinkItems();
        _x.Rel._relinkItems();
        _x.Skills._relinkItems();*/return _x;}}]);return Ruff;}(Mob);var Clyde=/*#__PURE__*/function(_AnthroFox){_inherits(Clyde,_AnthroFox);var _super101=_createSuper(Clyde);function Clyde(){var _this99;_classCallCheck(this,Clyde);_this99=_super101.call(this);_this99.baseName=_this99.id='Clyde';_this99.unique=true;_this99.Outfit.addItem(AnusHuman.factory('wolf'));_this99.Outfit.addItem(PenisHuman.factory('wolf'));_this99.levelUp(7);_this99.autoLeveling();return _this99;}return Clyde;}(AnthroFox);var Trent=/*#__PURE__*/function(_Mob26){_inherits(Trent,_Mob26);var _super102=_createSuper(Trent);function Trent(){var _this100;_classCallCheck(this,Trent);_this100=_super102.call(this);_this100.baseName=_this100.id='Trent';_this100.unique=true;_this100.pic='unknown';_this100.Outfit.addItem(new BaseHumanoid());_this100.Outfit.addItem(SkinFur.factory('horse','brown'));_this100.Outfit.addItem(HandsHuman.factory('horse'));_this100.Outfit.addItem(TailWolf.factory('horse'));_this100.Outfit.addItem(FaceWolf.factory('horse'));_this100.Outfit.addItem(AnusHuman.factory('horse'));_this100.Outfit.addItem(PenisHuman.factory('horse'));_this100.Outfit.addItem(new ShortsLeather());_this100.Outfit.addItem(new MaceSteel());_this100.levelUp(6);//this.Stats.increment('strength',3);
_this100.autoLeveling();return _this100;}return Trent;}(Mob);//collection of mob-constructors
window.gm.Mobs=function(Mobs){//unique chars that are in save-game need a constructor
window.storage.registerConstructor(Mob);//some characters derive from Mob
window.storage.registerConstructor(Ruff);//
Mobs.Cat=Cat.factory;Mobs.AnthroCat=function(){return function(param){return AnthroCat.factory(param);}("AnthroCat");};Mobs.AnthroFox=function(){return function(param){return AnthroCat.factory(param);}("AnthroFox");};Mobs.Fungus=Fungus.factory;Mobs.Huntress=function(){return function(param){return AnthroCat.factory(param);}("Huntress");};Mobs.Lapine=Lapine.factory;Mobs.Mole=Mole.factory;Mobs.Naga=Naga.factory;Mobs.Squirrel=function(){return function(param){return Mole.factory(param);}("Squirrel");};Mobs.Hawk=function(){return function(param){return Hawk.factory(param);}("Hawk");};Mobs.HornettHive=function(){return function(param){return Hive.factory(param);}("Hornett");};Mobs.Hornett=function(){return function(param){return Hornett.factory(param);}("Hornett");};Mobs.PillRoller=function(){return function(param){return Hornett.factory(param);}("PillRoller");};Mobs.Slime=Slime.factory;Mobs.Lizan=Lizan.factory;Mobs.Wolf=Wolf.factory;Mobs.AnthroWolf=AnthroWolf.factory;Mobs.Leech=Leech.factory;Mobs.Slug=Slug.factory;Mobs.Spider=Spider.factory;Mobs.Imp=Imp.factory;Mobs.Succubus=Succubus.factory;Mobs.Dryad=Dryad.factory;Mobs.Vine=Vine.factory;Mobs.Mechanic=Mechanic.factory;Mobs.Wisp=Wisp.factory;Mobs.WispShield=function(){return function(param){return Wisp.factory(param);}("WispShield");};return Mobs;}(window.gm.Mobs||{});"use strict";window.gm.mutate=window.gm.mutate||{};/**
 * checks each bodypart for race and calculates race-score (in %)
 * @param {*} char 
 */window.gm.mutate.calcRacialScore=function(char){//todo
/*
    * feral = no hands, 4 legged or other non biped 
    * human
    * horse
    * bunny
    */};window.gm.mutate.getScoreHuman=function(char){//human body, human face, legs, arms, tail ignored?
};window.gm.mutate.getScoreCat=function(char){//one fct for Lynx/Lion/tiger ?
//
};/**
 * modify stats for race-bonus, cat -> better agility
 * @param {*} char 
 * @param {*} scores 
 */window.gm.mutate.updateRacialBoon=function(char,scores){//remove old RacialBoon
};///////////////////////////////////////////////////////
window.gm.MutationsLib=window.gm.MutationsLib||{};/*OBSOLETE window.gm.MutationsLib['vaginaSpermDissolve'] = function (char){
    let vulva = char.getVagina();
    vulva.removeSperm(2); //todo decay depends on looseness, soulgem absorption??
    let msg='';
    msg+="You can feel some of the cum from your womb dribble down your leg. ";
    let lewdMark=char.Effects.findEffect(effLewdMark.name)[0];
    let pregnancy=char.Effects.findEffect(effVaginalPregnant.name)[0];
    if(pregnancy){
        if(lewdMark){
            msg+="More of that precious seed is absorbed by that soulgem growing in you.</br>";
            vulva.removeSperm(2); //todo decay depends on looseness, soulgem absorption??
        } else msg+="But you are pregnant already anyway.</br>"; 
    } 
    if(!pregnancy){
        pregnancy=char.Effects.findEffect(effVaginalFertil.name)[0];
        if(pregnancy){ 
            //todo random chance according to base-fertility-stat, sperm-fertility, vulva-fertility
            //race-compatibility between father-mother
            if(true || _.random(0,100)>75){
                msg+="Has your last fling got you impregnated?</br>";
                pregnancy = new effVaginalPregnant();
                pregnancy.data.type=vulva.data.spermtype;
                if(lewdMark) pregnancy.data.type='soulgem'; 
                char.addEffect(pregnancy,effVaginalPregnant.name)
            } else msg+="Hopefully there is nothing to worry about?</br>";
        }
    }    
    if(vulva.data.sperm>0){
        msg+="There might still be "+window.gm.util.formatNumber(vulva.data.sperm,0)+"ml sperm left.</br>"
    } else msg+="This was possibly the last remains of sperm.</br>";
    if(char===window.gm.player){
        window.gm.pushDeferredEvent("GenericDeffered",[msg]);
    }
}*/ /* 
 * triggers pregnancy-scene
 */window.gm.MutationsLib['vaginaPregnancy']=function(char){var msg='';var lewdMark=char.Effects.findEffect(effLewdMark.name)[0];var pregnancy=char.Effects.findEffect(effVaginalPregnant.name)[0];if(pregnancy){if(lewdMark&&pregnancy.data.type==='soulgem'){if(pregnancy.data.cycles<=0){pregnancy=new effVaginalFertil();char.addEffect(pregnancy,effVaginalFertil.name);msg+="A homemade soulgem slips out of your nethers !</br>";char.Inv.addItem(window.gm.ItemsLib['TinySoulGem']());}else msg+="If you dont provide that soulgem something to feed off, it might absorb some energy from you instead!.</br>";}else{if(pregnancy.data.cycles<=0){msg+="Congrats, you brought some more "+pregnancy.data.type+" into this world.</br>";}else{msg+="Your belly is swollen with the spawn of some "+pregnancy.data.type+".</br>";}}if(window.story.state._gm.dbgShowMoreInfo)msg+=window.gm.util.formatNumber(pregnancy.data.cycles*pregnancy.data.duration/(60*24),0)+" days to go.";}//todo go in heat if fertility-cycle triggers?
if(char===window.gm.player){window.gm.pushDeferredEvent("GenericDeffered",[msg]);}};/*
 * also used for buttplug
 */window.gm.MutationsLib['analPregnancy']=function(char){var msg='[something is wrong here]';var plug=char.Outfit.getItemForSlot('uAnus');if(plug){if(plug.style===100){//todo
}else{}}/*let pregnancy=char.Effects.findEffect(effAnalPregnant.name)[0]; //todo
    if(pregnancy){
        if(pregnancy.data.type==='soulgem'){
            if(pregnancy.data.cycles <=0){
                pregnancy = new effVaginalFertil();
                char.addEffect(pregnancy,effVaginalFertil.name);
                msg+="A homemade soulgem slips out of your nethers !</br>";
                char.Inv.addItem(window.gm.ItemsLib['TinySoulGem']());
            } else msg+="If you dont provide that soulgem something to feed off, it might absorb some energy from you instead!.</br>";
        } else {
            if(pregnancy.data.cycles <=0){
                msg+="Congrats, you brought some more "+pregnancy.data.type+" into this world.</br>";
            } else {
                msg+="Your belly is swollen with the spawn of some "+pregnancy.data.type+".</br>"; 
            }
        }
        if(window.story.state._gm.dbgShowMoreInfo) msg+= window.gm.util.formatNumber(pregnancy.data.cycles*pregnancy.data.duration/(60*24),0)+" days to go.";
    } */if(char===window.gm.player){window.gm.pushDeferredEvent("GenericDeffered",[msg]);}};window.gm.MutationsLib['swapGender']=function(char,genderItem){var msg='';var penis=char.getPenis();var vulva=char.getVagina();var style=penis?penis.getStyle():vulva?vulva.getStyle():'human';var newItem=genderItem.factory(style);if(newItem.slotUse.includes('bPenis')){if(vulva!==null){window.gm.player.Outfit.removeItem(vulva.id,true);msg+='You lost your female privats. ';}if(penis===null){window.gm.player.Outfit.addItem(newItem.factory(style),true);msg+='Instead a dick sprouts in your nethers.</br>';}}if(newItem.slotUse.includes('bVulva')){if(penis!==null){window.gm.player.Outfit.removeItem(penis.id,true);msg+='Your fine penis shrinks down until it is finally completely absorbed in your body. ';}if(vulva===null){window.gm.player.Outfit.addItem(newItem,true);msg+='A female opening forms itself in your groin.</br>';}}if(msg!==''&&char===window.gm.player){window.gm.pushDeferredEvent("GenericDeffered",[msg]);}};window.gm.MutationsLib['mutateWolf']=function(char){var magnitude=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var msg='',bb=window.gm.OutfitSlotLib;var fconv=window.gm.util.descFixer(char);var base=char.Outfit.getItemForSlot(bb.bBase);//todo bodyparts depends also on feral or anthro body
var n,slots=[],cnt=magnitude;//mutate depending on magnitude; some TF requires more then others
// ears/eyes - fur - tail/legs/genitals (minor) - arms/head/genitals - quadruped/feral 
var thrs={};thrs[bb.bSkin]=8,thrs[bb.bTailBase]=16,thrs[bb.bHands]=32,thrs[bb.bFace]=32;[bb.bFace,bb.bSkin,bb.bTailBase,bb.bHands].forEach(//todo legs,skin,genitals
function(x){slots.push({"slot":x,"item":char.Outfit.getItemForSlot(x)});});while(slots.length>0&&cnt>0){n=slots.splice(_.random(0,slots.length-1),1)[0];//select random part to mutate, repick if already mutated    
if(n.slot===bb.bTailBase&&cnt>=thrs[bb.bTailBase]){if(n.item===null){char.Outfit.addItem(window.storage.constructors['TailWolf'].factory('horse'),true);msg+=fconv("$[I]$ $[have]$ grown a bushy tail !</br>");cnt-=thrs[bb.bTailBase];}else if(n.item.getStyle()!=='wolf'||n.item.id!=='TailWolf'){char.Outfit.removeItem(n.item.id,true);char.Outfit.addItem(window.storage.constructors['TailWolf'].factory('wolf'),true);msg+=fconv("$[My]$ tail is now a fuzzy bush like of a wolf.</br>");cnt-=thrs[bb.bTailBase]/2;}else{var growth=n.item.data.growth+0.25;var maxGrowth=1.5;if(growth>=1){//msg=("You already changed to a horse as far as possible.</br>");
}else{n.item.data.growth=growth;msg+=fconv("$[My]$ tail must have grown and is now "+window.gm.util.formatNumber(growth*maxGrowth,1)+" meter long.</br>");cnt-=thrs[bb.bTailBase]/4;}}}else if(n.slot===bb.bSkin&&cnt>=thrs[bb.bFace]){if(n.item===null){//grow no skin
}else if(n.item.getStyle()!=='wolf'){char.Outfit.addItem(new window.storage.constructors['SkinFur'].factory('wolf'));msg+="A dense coat of fur spreads over your body.</br>";}}else if(n.slot===bb.bFace&&cnt>=thrs[bb.bFace]){if(n.item===null){//grow no face?
}else if(n.item.getStyle()!=='wolf'){char.Outfit.removeItem(n.item.id,true);char.Outfit.addItem(window.storage.constructors['FaceWolf'].factory('wolf'),true);msg+=fconv("$[My]$ face transforms into a canine muzzle.</br>");cnt-=thrs[bb.bTailBase];}}else if(n.slot===bb.bHands&&cnt>=thrs[bb.bHands]){if(n.item===null){//grow no hands?
}else if(n.item.getStyle()!=='wolf'){if(base.id==="BaseHumanoid"){char.Outfit.removeItem(n.item.id,true);char.Outfit.addItem(window.storage.constructors['HandsHuman'].factory('wolf'),true);msg+=fconv("$[My]$ hands now look like that of a human but with clawlike fingernails.</br>");}else{char.Outfit.removeItem(n.item.id,true);char.Outfit.addItem(window.storage.constructors['HandsPaw'].factory('wolf'),true);msg+=fconv("$[My]$ hands transforms into paws that resembles those of a dog or wolf.</br>");}cnt-=thrs[bb.bHands];}}}if(cnt>0){msg+=fconv("$[My]$ anxiety goes by as you didnt get any more wolflike.</br>");window.gm.MutationsLib.changeSavage(char,cnt,0,50);//increase savage
}};window.gm.MutationsLib['mutateCat']=function(char){var magnitude=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var msg='',_TF="TailWolf";if(char.Outfit.countItem(_TF)>0){var item=char.Outfit.getItem(_TF);if(item.getStyle()!=='cat'){item.setStyle('cat');msg="Your tail reshapes itself to a be more cat-like.</br>";}else{var growth=item.data.growth+0.25;var maxGrowth=2;//window.gm.player.Outfit.getItem("TailWolf").maxGrowth;
if(growth>=1){msg="You already changed to a cat as far as possible.</br>";}else{item.data.growth=growth;msg="Your tail must have grown and is now "+growth*maxGrowth+" meter long.</br>";}}}else{char.Outfit.addItem(new window.storage.constructors['TailWolf'].factory('cat'));msg="You have grown a cat tail !</br>";}if(char===window.gm.player){window.gm.pushDeferredEvent("GenericDeffered",[msg]);}};window.gm.MutationsLib['mutateHorse']=function(char){var magnitude=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var msg='',bb=window.gm.OutfitSlotLib;var fconv=window.gm.util.descFixer(char);var base=char.Outfit.getItemForSlot(bb.bBase);//todo bodyparts depends also on feral or anthro body
var n,slots=[],cnt=magnitude;//mutate depending on magnitude; some TF requires more then others
// ears/eyes - fur - tail/legs/genitals (minor) - arms/head/genitals - quadruped/feral 
var thrs={};thrs[bb.bSkin]=8,thrs[bb.bTailBase]=16,thrs[bb.bHands]=32,thrs[bb.bFace]=32;[bb.bFace,bb.bSkin,bb.bTailBase,bb.bHands].forEach(//todo legs,skin,genitals
function(x){slots.push({"slot":x,"item":char.Outfit.getItemForSlot(x)});});while(slots.length>0&&cnt>0){n=slots.splice(_.random(0,slots.length-1),1)[0];//select random part to mutate, repick if already mutated    
if(n.slot===bb.bTailBase&&cnt>=thrs[bb.bTailBase]){if(n.item===null){char.Outfit.addItem(window.storage.constructors['TailWolf'].factory('horse'),true);msg+=fconv("$[I]$ $[have]$ grown a horse tail !</br>");cnt-=thrs[bb.bTailBase];}else if(n.item.getStyle()!=='horse'||n.item.id!=='TailWolf'){char.Outfit.removeItem(n.item.id,true);char.Outfit.addItem(window.storage.constructors['TailWolf'].factory('horse'),true);msg+=fconv("$[My]$ tail reshapes itself to a be more horse-like.</br>");cnt-=thrs[bb.bTailBase]/2;}else{var growth=n.item.data.growth+0.25;var maxGrowth=2;//window.gm.player.Outfit.getItem("TailWolf").maxGrowth;
if(growth>=1){//msg=("You already changed to a horse as far as possible.</br>");
}else{n.item.data.growth=growth;msg+=fconv("$[My]$ tail must have grown and is now "+window.gm.util.formatNumber(growth*maxGrowth,1)+" meter long.</br>");cnt-=thrs[bb.bTailBase]/4;}}}else if(n.slot===bb.bSkin&&cnt>=thrs[bb.bSkin]){if(n.item===null){//grow no face?
}else if(n.item.getStyle()!=='horse'){char.Outfit.removeItem(n.item.id,true);char.Outfit.addItem(window.storage.constructors['SkinFur'].factory('horse'),true);msg+=fconv("$[My]$ skin prickles as suddenly a fine layer of fur sprouts all around your body, even in your face.</br>");cnt-=thrs[bb.bTailBase];}}else if(n.slot===bb.bFace&&cnt>=thrs[bb.bFace]){if(n.item===null){//grow no face?
}else if(n.item.getStyle()!=='horse'){char.Outfit.removeItem(n.item.id,true);char.Outfit.addItem(window.storage.constructors['FaceHorse'].factory('horse'),true);msg+=fconv("$[My]$ face transforms into a horse ones.</br>");cnt-=thrs[bb.bTailBase];}}else if(n.slot===bb.bHands&&cnt>=thrs[bb.bHands]){if(n.item===null){//grow no hands?
}else if(n.item.getStyle()!=='horse'){if(base.id==="BaseHumanoid"){char.Outfit.removeItem(n.item.id,true);char.Outfit.addItem(window.storage.constructors['HandsHuman'].factory('horse'),true);msg+=fconv("$[My]$ hands now look like that of a human but with thick fingernails.</br>");}else{char.Outfit.removeItem(n.item.id,true);char.Outfit.addItem(window.storage.constructors['HandsHoof'].factory('horse'),true);msg+=fconv("$[My]$ hands transforms into a horse-like hoves.</br>");}cnt-=thrs[bb.bHands];}}}if(cnt>0){if(msg==='')msg=fconv("$[I]$ cant shake the feeling that something odd might happen in near future.</br>");else msg+=fconv("$[I]$ already changed to a horse as far as possible - for now.</br>");window.gm.MutationsLib.changeSavage(char,cnt,0,50);//increase savage
}window.gm.MutationsLib.changeSavage(char,cnt,0,50);if(char===window.gm.player){window.gm.pushDeferredEvent("GenericDeffered",[msg]);}};window.gm.MutationsLib['mutateHuman']=function(char){var magnitude=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var msg='',bb=window.gm.OutfitSlotLib;var fconv=window.gm.util.descFixer(char);var base=char.Outfit.getItemForSlot(bb.bBase);//todo bodyparts depends also on feral or anthro body
var n,slots=[],cnt=magnitude;//mutate depending on magnitude; some TF requires more then others
// ears/eyes - fur - tail/legs/genitals (minor) - arms/head/genitals - quadruped/feral 
var thrs={};thrs[bb.bSkin]=8,thrs[bb.bTailBase]=16,thrs[bb.bHands]=16,thrs[bb.bFace]=16;[bb.bFace,bb.bSkin,bb.bTailBase,bb.bHands].forEach(//todo legs,skin,genitals
function(x){slots.push({"slot":x,"item":char.Outfit.getItemForSlot(x)});});while(slots.length>0&&cnt>0){n=slots.splice(_.random(0,slots.length-1),1)[0];//select random part to mutate, repick if already mutated    
if(n.slot===bb.bTailBase&&cnt>=thrs[bb.bTailBase]){if(n.item!==null){char.Outfit.removeItem(n.item.id,true);msg+=fconv("$[My]$ tail is gone.</br>");cnt-=thrs[bb.bTailBase];}}else if(n.slot===bb.bFace&&cnt>=thrs[bb.bFace]){if(n.item===null){//grow no face?
}else if(n.item.getStyle()!=='human'){char.Outfit.removeItem(n.item.id,true);char.Outfit.addItem(window.storage.constructors['FaceHuman'].factory('human'),true);msg+=fconv("$[My]$ face looks human now.</br>");cnt-=thrs[bb.bTailBase];}}else if(n.slot===bb.bHands&&cnt>=thrs[bb.bHands]){if(n.item===null){//grow no hands?
}else if(n.item.getStyle()!=='human'){if(base.id==="BaseHumanoid"){char.Outfit.removeItem(n.item.id,true);char.Outfit.addItem(window.storage.constructors['HandsHuman'].factory('human'),true);msg+=fconv("$[My]$ hands now look like that of a plain human.</br>");cnt-=thrs[bb.bHands];}else{//dont grow hands when walking on 4 legs?
//msg+=fconv("$[My]$ hands transforms into a horse-like hoves.</br>");
}}}}if(cnt>0){msg+=fconv("$[I]$ already changed to a human as far as possible right now.</br>");window.gm.MutationsLib.changeSavage(char,-1*cnt,0,50);//decrease savage
}if(char==window.gm.player){window.gm.pushDeferredEvent("GenericDeffered",[msg]);}};window.gm.MutationsLib['mutateBunny']=function(char){var magnitude=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var msg='',_TF="TailWolf",style='bunny';if(char.Outfit.countItem(_TF)>0){var item=char.Outfit.getItem(_TF);if(item.getStyle()!==style){item.setStyle(style);msg="Your tail reshapes itself to a be more bunny-like.</br>";}else{var growth=item.data.growth+0.25;var maxGrowth=char.Outfit.getItem(_TF).maxGrowth;if(growth>=1){msg="You already changed to a bunny as far as possible.</br>";}else{item.data.growth=growth;msg="Your tail must have grown and is now "+growth*maxGrowth+" meter long.</br>";}}}else{char.Outfit.addItem(new window.storage.constructors['TailWolf'].factory(style));msg="You have grown a small, fluffy bunny tail !</br>";}if(char===window.gm.player){window.gm.pushDeferredEvent("GenericDeffered",[msg]);}};window.gm.MutationsLib['growBreast']=function(char){var magnitude=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var msg='',_TF="BreastHuman";if(char.Outfit.countItem(_TF)>0){var item=char.Outfit.getItem(_TF);var growth=item.data.growth+0.15;//todo shrinking/increase as parameter?
var maxGrowth=3;//todo cupsize dimension?
if(growth>=1){msg="Your milkbags are as big as they can get.</br>";}else{item.data.growth=growth;msg="Your bust size increased further.</br>";}}else{char.Outfit.addItem(new window.storage.constructors[_TF].factory('human'));msg="As you feel up your pecks you notice that they seem to be softer than before !</br>";}if(char===window.gm.player){window.gm.pushDeferredEvent("GenericDeffered",[msg]);}};window.gm.MutationsLib['growVulva']=function(char){var magnitude=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var msg='Everything is ok, nothing unusual.</br>',_TF="VulvaHuman";if(char.Outfit.countItem(_TF)>0){var item=char.Outfit.getItem(_TF);msg="An unusual feeling lets you move your hand down to your nethers.</br>";if(item.data.clitsize>0.9){vulva.data.stretch+=0.5;msg+="Your muff seems to be more loose then before !</br>";}else{item.data.clitsize+=0.5;msg+="You arent quite sure but could it be possible that your clitoris is larger then before?</br>";}msg+="</br>"+item.descLong(window.gm.util.descFixer(char))+"</br>";}if(char===window.gm.player){window.gm.pushDeferredEvent("GenericDeffered",[msg]);}};window.gm.MutationsLib['growPenis']=function(char){var magnitude=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var msg='Everything is ok, nothing unusual.</br>',_TF="PenisHuman";if(char.Outfit.countItem(_TF)>0){var item=char.Outfit.getItem(_TF);msg="An unusual feeling lets you move your hand down to your nethers.</br>";if(magnitude>0){//grow
if(item.data.growth>=1){msg+="Your member is straining but your body doesnt seem to support a bigger one !</br>";}else{item.data.growth=Math.min(1.0,item.data.growth+0.25);msg+="Your member swell proudly and gains in girth and length?</br>";}}else{//shrink
if(item.data.growth<0.05){msg+="You can feel some pressure around your tiny manmeat but nothing happens.</br>";}else{item.data.growth=Math.max(0.05,item.data.growth-0.25);msg+="You can feel some pressure engulfing your manmeat. With horror you can feel it shrinking down even further !</br>";}}msg+="</br>"+item.descLong(window.gm.util.descFixer(char))+"</br>";}if(char===window.gm.player){window.gm.pushDeferredEvent("GenericDeffered",[msg]);}};window.gm.MutationsLib['growHeadHair']=function(char){var magnitude=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var msg='Everything is ok, nothing unusual.</br>',_TF="HeadHairHuman";if(char.Outfit.countItem(_TF)>0){msg="As you smooth out your hair with your hand you notice </br>";var item=char.Outfit.getItem(_TF),growth=item.data.growth;if(magnitude>0){//grow
if(item.data.growth<0.3){item.data.growth+=0.05;//@2m body, max. 0.6m hair 5%=3cm
msg+='that it seems to have grown a bit longer. </br>';}else if(item.data.growth<0.6){item.data.growth+=0.1;msg+='that it seems to have grown quite a bit longer. </br>';}else{msg+="...well seems no change at all.</br>";}}else{//Todo
}msg+="</br>"+item.descLong(window.gm.util.descFixer(char))+"</br>";}if(char===window.gm.player){window.gm.pushDeferredEvent("GenericDeffered",[msg]);}};window.gm.MutationsLib['changeSavage']=function(char){var value=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var min=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var max=arguments.length>3&&arguments[3]!==undefined?arguments[3]:10;var msg='';var _v=0,_x=char.Stats.get("savageness").base,_maxold=char.Stats.get("savagenessMax").base,_maxnew=_maxold;if(value>0){//increase savageness and also max up to a level
_maxnew=Math.min(max,_maxold+value)-_maxold;_v=Math.max(_maxnew-_maxold,_x+value)-_x;}else{//decrease savageness but not max
_v=Math.max(0,_x+value)-_x;_maxnew=0;}if(_maxnew!==0){char.Stats.increment("savagenessMax",_maxnew);msg+="You get the feeling that your mind would somehow accept getting more savage.</br>";}if(_v>0){char.Stats.increment("savageness",_v);msg+="Your mind grows more restless and its more difficult to think straight.</br>";if(_v-_maxnew>1)msg+="There is trouble ahead If you dont keep your wits together.</br>";}if(_v<0){char.Stats.increment("savageness",_v);msg+="Lately, you feel a little bit more clear headed.</br>";}if(msg==='')msg='Everything is ok, nothing unusual.</br>';if(char==window.gm.player){window.gm.pushDeferredEvent("GenericDeffered",[msg]);}};//todo grow/shrinkHips Ass / bodyshape
//remove body/-pubes hair
/*{
window.gm.Mutators = window.gm.Mutators || {};
window.gm.Mutators['HairNeck'] = (function(){
    let data={m:effMutator.mutatorDataProto(),req:null,revert:""};
    data.m.Hair=0.3,data.m.F=0.2;
    data.f=window.gm.MutationsLib['growHeadHair'];data.mag=1;
    data.req=function(char){let _res={OK:true,msg:''};return(_res);};
return(data);})();
window.gm.Mutators['averageBreast'] = (function(){
        let data={m:effMutator.mutatorDataProto(),req:null,revert:""};
        data.m.Chest=0.5,data.m.F=0.5;
        data.f=window.gm.MutationsLib['growBreast'];data.mag=1;
        data.req=function(char){let _res={OK:true,msg:''};return(_res);};
    return(data);})();
window.gm.Mutators['bigBreast'] = (function(){
        let data={m:effMutator.mutatorDataProto(),req:null,revert:"averageBreast"};
        data.m.Chest=0.7,data.m.F=0.5;
        data.f=window.gm.MutationsLib['growBreast'];data.mag=2;
        data.req=function(char){let _res={OK:true,msg:''};return(_res);};
    return(data);})();
window.gm.Mutators['averageCock'] = (function(){
        let data={m:effMutator.mutatorDataProto(),req:null,revert:""};
        data.m.Genital=0.4,data.m.M=0.5;
        data.f=window.gm.MutationsLib['growPenis'];data.mag=1;
        data.req=function(char){let _res={OK:true,msg:''};return(_res);};
    return(data);})();
//smallCock
}*/"use strict";var Leggings=/*#__PURE__*/function(_Equipment3){_inherits(Leggings,_Equipment3);var _super103=_createSuper(Leggings);function Leggings(){var _this101;_classCallCheck(this,Leggings);_this101=_super103.call(this,'Leggings');_this101.addTags(['cloth']);_this101.slotUse=['Legs','Hips'];return _this101;}_createClass(Leggings,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("Leggings",this);}},{key:"onEquip",value:function onEquip(context){context.parent.Stats.addModifier('agility',{id:'agility:Leggings',bonus:5});return{OK:true,msg:'equipped'};}},{key:"onUnequip",value:function onUnequip(context){this.parent.parent.Stats.removeModifier('agility',{id:'agility:Leggings'});return{OK:true,msg:'unequipped'};}},{key:"desc",get:function get(){return'Spandex-leggings for sport. (agility+)';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(Leggings,value.data);}}]);return Leggings;}(Equipment);var Jeans=/*#__PURE__*/function(_Equipment4){_inherits(Jeans,_Equipment4);var _super104=_createSuper(Jeans);_createClass(Jeans,null,[{key:"factory",value:function factory(style){var x=new Jeans();x.style=style;return x;}}]);function Jeans(){var _this102;_classCallCheck(this,Jeans);_this102=_super104.call(this);_this102.addTags(['cloth']);_this102.slotUse=['Legs','Hips'];_this102.lossOnRespawn=true;_this102.style=0;return _this102;}_createClass(Jeans,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("Jeans",this);}},{key:"style",set:function set(style){this._style=style;if(style===0)this.id='Jeans',this.name='blue jeans';else if(style===100)this.id='Trousers',this.name="black trousers";else throw new Error(this.id+' doesnt know '+style);if(this._HP)this.HP=this._HP;},get:function get(){return this._style;}},{key:"desc",get:function get(){var msg='plain old blue jeans';switch(this._style){case 100:msg='mid-proced business trousers';break;default:}return msg;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(Jeans,value.data);}}]);return Jeans;}(Equipment);var Sneakers=/*#__PURE__*/function(_Equipment5){_inherits(Sneakers,_Equipment5);var _super105=_createSuper(Sneakers);_createClass(Sneakers,null,[{key:"factory",value:function factory(style){var x=new Sneakers();x.style=style;return x;}}]);function Sneakers(){var _this103;_classCallCheck(this,Sneakers);_this103=_super105.call(this,'Sneakers');_this103.addTags(['cloth']);_this103.style=0;_this103.slotUse=['Feet'];return _this103;}_createClass(Sneakers,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("Sneakers",this);}},{key:"style",set:function set(style){this._style=style;if(style===0)this.id=this.name='Sneakers';else if(style===10)this.id=this.name='FlipFlops';else throw new Error(this.id+' doesnt know '+style);},get:function get(){return this._style;}},{key:"desc",get:function get(){var msg='comfy sneakers';switch(this._style){case 10:msg='slouchy flip-flops';break;default:}return msg;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(Sneakers,value.data);}}]);return Sneakers;}(Equipment);var TankShirt=/*#__PURE__*/function(_Equipment6){_inherits(TankShirt,_Equipment6);var _super106=_createSuper(TankShirt);_createClass(TankShirt,null,[{key:"factory",value:function factory(style){var x=new TankShirt();x.style=style;return x;}}]);function TankShirt(){var _this104;_classCallCheck(this,TankShirt);_this104=_super106.call(this,'TankShirt');_this104.addTags(['cloth']);_this104.style=0;_this104.slotUse=['Breast','Stomach'];return _this104;}_createClass(TankShirt,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("TankShirt",this);}},{key:"style",set:function set(style){this._style=style;if(style===0)this.baseId=this.id=this.name='TankShirt';else if(style===10)this.baseId=this.id=this.name='Hawaiishirt';else if(style===20)this.baseId=this.id=this.name='Tshirt';else throw new Error(this.id+' doesnt know '+style);if(this._HP)this.HP=this._HP;},get:function get(){return this._style;}},{key:"desc",get:function get(){var msg='light blue tank-top';switch(this._style){case 10:msg='shirt with flower pattern';break;case 20:msg='cheap, plain colored t-shirt';break;default:}return msg+this._HP?" ("+this._HP+"%)":"";}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(TankShirt,value.data);}}]);return TankShirt;}(Equipment);var Pullover=/*#__PURE__*/function(_Equipment7){_inherits(Pullover,_Equipment7);var _super107=_createSuper(Pullover);function Pullover(){var _this105;_classCallCheck(this,Pullover);_this105=_super107.call(this,'Pullover');_this105.addTags(['cloth']);_this105.slotUse=['Breast','Stomach','Arms'];return _this105;}_createClass(Pullover,[{key:"descLong",value:function descLong(fconv){var msg='';if(this.isEquipped())msg='A warm pullover adorns $[me]$.';else msg='$[I]$ $[have]$ '+this.name+".";return fconv(msg);}},{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("Pullover",this);}},{key:"desc",get:function get(){return'warm pullover';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(Pullover,value.data);}}]);return Pullover;}(Equipment);var BracerLeather=/*#__PURE__*/function(_Equipment8){_inherits(BracerLeather,_Equipment8);var _super108=_createSuper(BracerLeather);function BracerLeather(){var _this106;_classCallCheck(this,BracerLeather);_this106=_super108.call(this,'BracerLeather');_this106.addTags(['cloth']);_this106.slotUse=['Wrists'];_this106.price=_this106.basePrice=10;_this106.style=0;_this106.lossOnRespawn=true;return _this106;}_createClass(BracerLeather,[{key:"descLong",value:function descLong(fconv){var msg='';if(this.isEquipped())msg='A pair of '+this.desc+' adorns $[my]$ lower arms.';else msg='$[I]$ $[have]$ '+this.name+".";return fconv(msg);}},{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("BracerLeather",this);}},{key:"style",set:function set(style){this._style=style;if(style===200)this.id='GlovesRubber',this.name='Rubber-Gloves';},get:function get(){return this._style;}},{key:"desc",get:function get(){var msg='worn bracers made of leather';switch(this._style){case 100:msg='leather bracers with steel-studs';break;case 200:msg='elbow-length rubber gloves';break;default:}return msg+this.bonusDesc();}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(BracerLeather,value.data);}}]);return BracerLeather;}(Equipment);var HandCuffs=/*#__PURE__*/function(_Equipment9){_inherits(HandCuffs,_Equipment9);var _super109=_createSuper(HandCuffs);function HandCuffs(){var _this107;_classCallCheck(this,HandCuffs);_this107=_super109.call(this,'HandCuffs');_this107.addTags(['restrain']);_this107.slotUse=['RHand','LHand','Wrists'];return _this107;}_createClass(HandCuffs,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("HandCuffs",this);}},{key:"usable",value:function usable(context){return this.canEquip(context);}},{key:"use",value:function use(context){//context here is inventory not outfit
if(this.parent.parent.Outfit.findItemSlot(this.id).length>0){this.parent.parent.Outfit.removeItem(this.id);return{OK:true,msg:'unequipped '+this.name};//todo
}else{this.parent.parent.Outfit.addItem(this);return{OK:true,msg:'equipped '+this.name};//todo
}}},{key:"canEquip",value:function canEquip(context){if(this.parent.parent.Outfit.findItemSlot(this.id).length>0)return{OK:true,msg:'unequip'};//todo check for key
else return{OK:true,msg:'equip'};}},{key:"canUnequip",value:function canUnequip(){return{OK:false,msg:'You need to find a key first to be able to remove it!'};}},{key:"desc",get:function get(){return'handcuffs like the police use them';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(HandCuffs,value.data);}}]);return HandCuffs;}(Equipment);var WristCuffs=/*#__PURE__*/function(_Equipment10){_inherits(WristCuffs,_Equipment10);var _super110=_createSuper(WristCuffs);function WristCuffs(){var _this108;_classCallCheck(this,WristCuffs);_this108=_super110.call(this,'WristCuffs');_this108.slotUse=['Wrists'];_this108.lossOnRespawn=false;return _this108;}_createClass(WristCuffs,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("WristCuffs",this);}},{key:"usable",value:function usable(context){return this.canEquip(context);}},{key:"use",value:function use(context){//context here is inventory not outfit
if(this.parent.parent.Outfit.findItemSlot(this.id).length>0){this.parent.parent.Outfit.removeItem(this.id);return{OK:true,msg:'unequipped '+this.name};//todo
}else{this.parent.parent.Outfit.addItem(this);return{OK:true,msg:'equipped '+this.name};//todo
}}},{key:"canUnequip",value:function canUnequip(){return{OK:false,msg:'Those cuffs can only be removed by a magican!'};}},{key:"desc",get:function get(){return'some leather cuffs for wrists';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(WristCuffs,value.data);}}]);return WristCuffs;}(Equipment);var Collar=/*#__PURE__*/function(_Equipment11){_inherits(Collar,_Equipment11);var _super111=_createSuper(Collar);_createClass(Collar,null,[{key:"factory",value:function factory(style){var x=new Collar();x.style=style;return x;}}]);function Collar(){var _this109;_classCallCheck(this,Collar);_this109=_super111.call(this,'Collar');_this109.slotUse=['Neck'];_this109.lossOnRespawn=false;_this109.style=0,_this109.lewd.slut=1;return _this109;}_createClass(Collar,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("Collar",this);}},{key:"usable",value:function usable(context){return this.canEquip(context);}},{key:"use",value:function use(context){//context here is inventory not outfit
if(this.parent.parent.Outfit.findItemSlot(this.id).length>0){this.parent.parent.Outfit.removeItem(this.id);return{OK:true,msg:'unequipped '+this.name};//todo
}else{this.parent.parent.Outfit.addItem(this);return{OK:true,msg:'equipped '+this.name};//todo
}}},{key:"canUnequip",value:function canUnequip(){if(this._style===40)return{OK:false,msg:'This can only be removed by a magican!'};if(this._style===50)return{OK:false,msg:'You cannot figure out how to unbuckle this collar.'};return{OK:true,msg:""};}},{key:"unequipText",value:function unequipText(){return"You removed the gadget from your neck.";}},{key:"equipText",value:function equipText(){return"That "+this.name+" will be a fine detail for your neck.";}},{key:"style",set:function set(style){this._style=style;if(style===0)this.id=this.name='CollarPlain';else if(style===10)this.id=this.name='CollarDog';else if(style===20)this.id=this.name='CollarSpikes';else if(style===30){this.id=this.name='PendantLuck';window.gm.makeBonusItem(this,{statBoost:'luck',statBonus:8});}else if(style===40)this.id=this.name='CollarQuest';else if(style===50)this.id=this.name='CollarID';else throw new Error(this.id+' doesnt know '+style);},get:function get(){return this._style;}},{key:"desc",get:function get(){var msg='a simple collar made from black frilly cloth';switch(this._style){case 10:msg='This red leather collar has some white bone symbols imprinted. Might look fitting for a dog... ';break;case 20:msg='A sturdy,black leather collar with shiny pointed metall spikes around it.';break;case 30:msg='A necklace with a lucky paw. Might increase someones luck.';break;case 40:msg='A seamless collar made from dark purple material. ';break;case 50:msg='A neckband from black rubber with a metalic clasp. It somehow carries the ID of its wearer.';break;default:}return msg;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(Collar,value.data);}}]);return Collar;}(Equipment);var Gag=/*#__PURE__*/function(_Equipment12){_inherits(Gag,_Equipment12);var _super112=_createSuper(Gag);_createClass(Gag,null,[{key:"factory",value:function factory(style){var x=new Gag();x.style=style;return x;}}]);function Gag(){var _this110;_classCallCheck(this,Gag);_this110=_super112.call(this,'Gag');_this110.slotUse=[window.gm.OutfitSlotLib.Mouth];_this110.lossOnRespawn=false;_this110.style=0;return _this110;}_createClass(Gag,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("Gag",this);}},{key:"usable",value:function usable(context){return this.canEquip(context);}},{key:"use",value:function use(context){//context here is inventory not outfit
if(this.parent.parent.Outfit.findItemSlot(this.id).length>0){this.parent.parent.Outfit.removeItem(this.id);return{OK:true,msg:'unequipped '+this.name};//todo
}else{this.parent.parent.Outfit.addItem(this);return{OK:true,msg:'equipped '+this.name};//todo
}}//canUnequip(){return({OK:false, msg:'This can only be removed by a magican!'});}
},{key:"unequipText",value:function unequipText(){return"You removed the gadget .";}},{key:"equipText",value:function equipText(){return"That "+this.name+" protect your mouth.";}},{key:"style",set:function set(style){this._style=style;if(style===0)this.id=this.name='FaceWrap',this.lewd.sm=0;else if(style===10)this.id=this.name='LeatherMuzzle',this.lewd.sm=3;else if(style===20)this.id=this.name='BallGag',this.lewd.sm=3;else if(style===30)this.id=this.name='GasMask',this.lewd.sm=3;//TODO effAirFilter
else throw new Error(this.id+' doesnt know '+style);},get:function get(){return this._style;}},{key:"desc",get:function get(){var msg='some cloth to cover someones mouth and nose';switch(this._style){case 10:msg='A adjustable muzzle fitting for a dog. ';break;case 20:msg='A red ball of rubber to be fixed with leatherstraps.';break;case 30:msg='A a mask made of rubber with a airfilter. The filter makes breathing difficult but should help against some (but not all) harmful air pollutions.';break;default:}return msg;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(Gag,value.data);}}]);return Gag;}(Equipment);var RingFinger=/*#__PURE__*/function(_Equipment13){_inherits(RingFinger,_Equipment13);var _super113=_createSuper(RingFinger);_createClass(RingFinger,null,[{key:"factory",value:function factory(style){var x=new RingFinger();x.style=style;return x;}}]);function RingFinger(){var _this111;_classCallCheck(this,RingFinger);_this111=_super113.call(this,'RingFinger');_this111.addTags(['jewellery']);_this111.slotUse=['uLHand'];//TODO how to be able to equip L or R? detect free slot and redefine slotUse?
_this111.style=0;_this111.lossOnRespawn=false;return _this111;}_createClass(RingFinger,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("RingFinger",this);}},{key:"style",set:function set(style){this._style=style;},get:function get(){return this._style;}},{key:"desc",get:function get(){if(this.style===10)return'thin gold ring';return'thin silver ring';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(RingFinger,value.data);}}]);return RingFinger;}(Equipment);var PiercingEars=/*#__PURE__*/function(_Equipment14){_inherits(PiercingEars,_Equipment14);var _super114=_createSuper(PiercingEars);_createClass(PiercingEars,null,[{key:"factory",value:function factory(style){var x=new PiercingEars();x.style=style;return x;}}]);function PiercingEars(){var _this112;_classCallCheck(this,PiercingEars);_this112=_super114.call(this,'PiercingEars');_this112.addTags(['piercing']);_this112.slotUse=['pEars'];_this112.style=0;_this112.lossOnRespawn=false;return _this112;}_createClass(PiercingEars,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("PiercingEars",this);}},{key:"style",set:function set(style){this._style=style;},get:function get(){return this._style;}},{key:"desc",get:function get(){if(this.style===10)return'green gemstone ear lobe piercing';if(this.style===20)return'green gemstone ear lobe piercing';if(this.style===30)return'large gold ear ring';if(this.style===40)return'gemmed helix piering';if(this.style===50)return'steel spiral piercing';if(this.style===60)return'gold multi helix piercing';return'small silver ear ring';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(PiercingEars,value.data);}}]);return PiercingEars;}(Equipment);var PiercingNipples=/*#__PURE__*/function(_Equipment15){_inherits(PiercingNipples,_Equipment15);var _super115=_createSuper(PiercingNipples);_createClass(PiercingNipples,null,[{key:"factory",value:function factory(style){var x=new PiercingNipples();x.style=style;return x;}}]);function PiercingNipples(){var _this113;_classCallCheck(this,PiercingNipples);_this113=_super115.call(this,'PiercingNipples');_this113.addTags(['piercing']);_this113.slotUse=['pNipples'];_this113.style=0;_this113.lossOnRespawn=false;return _this113;}_createClass(PiercingNipples,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("PiercingNipples",this);}},{key:"style",set:function set(style){this._style=style;},get:function get(){return this._style;}},{key:"desc",get:function get(){if(this.style===10)return'small steel hoop';if(this.style===20)return'circular gold barbel';if(this.style===30)return'thick gold hoop';if(this.style===40)return'jade captive bead ring';if(this.style===50)return'crossed double barbel ';if(this.style===60)return'gold hoops connected with chain';return'small steel barbel';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(PiercingNipples,value.data);}}]);return PiercingNipples;}(Equipment);var PiercingClit=/*#__PURE__*/function(_Equipment16){_inherits(PiercingClit,_Equipment16);var _super116=_createSuper(PiercingClit);_createClass(PiercingClit,null,[{key:"factory",value:function factory(style){var x=new PiercingClit();x.style=style;return x;}}]);function PiercingClit(){var _this114;_classCallCheck(this,PiercingClit);_this114=_super116.call(this,'PiercingClit');_this114.addTags(['piercing']);_this114.slotUse=['pClit'];_this114.style=0;_this114.lossOnRespawn=false;return _this114;}_createClass(PiercingClit,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("PiercingClit",this);}},{key:"onEquip",value:function onEquip(context){if(this.style===100){context.parent.addEffect(new window.storage.constructors['effGrowVulva'](),"effGrowVulva");//only works for player since effects of NPC dont receive ticks!
}return{OK:true,msg:'equipped'};}},{key:"style",set:function set(style){this._style=style;if(style===100)this.lossOnRespawn=false;},get:function get(){return this._style;}},{key:"desc",get:function get(){if(this.style===100)return'cursed piercing';return'small clitoris-piercing';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(PiercingClit,value.data);}}]);return PiercingClit;}(Equipment);var TattooGroin=/*#__PURE__*/function(_Equipment17){_inherits(TattooGroin,_Equipment17);var _super117=_createSuper(TattooGroin);function TattooGroin(){var _this115;_classCallCheck(this,TattooGroin);_this115=_super117.call(this,'TattooGroin');_this115.addTags(['tattoo']);_this115.slotUse=['tStomach'];_this115.style=0;_this115.lossOnRespawn=false;return _this115;}_createClass(TattooGroin,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("TattooGroin",this);}},{key:"canUnequip",value:function canUnequip(){return{OK:false,msg:'not so easy to get rid off'};}},{key:"onEquip",value:function onEquip(context){if(this.style===100){context.parent.addEffect(new window.storage.constructors['effLewdMark'](),"effLewdMark");//only works for player since effects of NPC dont receive ticks!
}return{OK:true,msg:'tattoed'};}},{key:"style",set:function set(style){this._style=style;},get:function get(){return this._style;}},{key:"pictureInv",get:function get(){if(this.style===100)return'tattoo_womb_lewdsign';else return'unknown';}},{key:"desc",get:function get(){if(this.style===100)return'a kind of lewd mark';return'a tribal tatto on the lower belly';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(TattooGroin,value.data);}}]);return TattooGroin;}(Equipment);var RobesZealot=/*#__PURE__*/function(_Equipment18){_inherits(RobesZealot,_Equipment18);var _super118=_createSuper(RobesZealot);_createClass(RobesZealot,null,[{key:"factory",value:function factory(style){var x=new RobesZealot();x.style=style;return x;}}]);function RobesZealot(){var _this116;_classCallCheck(this,RobesZealot);_this116=_super118.call(this,'RobesZealot');_this116.addTags(['cloth',window.gm.ItemTags.Wear]);_this116.slotUse=['Breast','Stomach'];//,'Hips','Legs'];
_this116.slotCover=['bBreast','uBreast','pNipples','bPenis','bVulva','bBalls','bClit','bAnus','pPenis','pClit'];_this116.lossOnRespawn=true;_this116.style=0;return _this116;}_createClass(RobesZealot,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("RobesZealot",this);}},{key:"style",set:function set(style){this._style=style;if(style===0)this.id='RobesZealot',this.name='zealot-robe';else if(style===100)this.id='PrisonerCloths',this.name="prisoner rags";else throw new Error(this.id+' doesnt know '+style);},get:function get(){return this._style;}},{key:"desc",get:function get(){var msg='a robe made from coarse cloth';switch(this._style){case 100:msg='a sack-like outfit of a unworthy';break;default:}return msg;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(RobesZealot,value.data);}}]);return RobesZealot;}(Equipment);var HarnessRubber=/*#__PURE__*/function(_Equipment19){_inherits(HarnessRubber,_Equipment19);var _super119=_createSuper(HarnessRubber);function HarnessRubber(){var _this117;_classCallCheck(this,HarnessRubber);_this117=_super119.call(this,'HarnessRubber');_this117.addTags(['rubber',window.gm.ItemTags.Wear]);_this117.slotUse=['Breast','Stomach'];_this117.slotCover=['bBreast','uBreast'];_this117.lossOnRespawn=true;return _this117;}_createClass(HarnessRubber,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("HarnessRubber",this);}},{key:"desc",get:function get(){return'a harness made from straps of rubber that barely covers someones torso';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(HarnessRubber,value.data);}}]);return HarnessRubber;}(Equipment);var Briefs=/*#__PURE__*/function(_Equipment20){_inherits(Briefs,_Equipment20);var _super120=_createSuper(Briefs);_createClass(Briefs,null,[{key:"factory",value:function factory(style){var x=new Briefs();x.style=style;return x;}}]);function Briefs(){var _this118;_classCallCheck(this,Briefs);_this118=_super120.call(this,'Briefs');_this118.addTags(['cloth',window.gm.ItemTags.Wear]);_this118.slotUse=['uHips'];_this118.slotCover=['bPenis','bVulva','bBalls','bClit','bAnus','pPenis','pClit'];_this118.lossOnRespawn=true;_this118.style=0;return _this118;}_createClass(Briefs,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("Briefs",this);}},{key:"pictureInv",get:function get(){return'Tunic_F_Med';}},{key:"desc",get:function get(){var msg='plain briefs';switch(this._style){case 100:msg='crude cotton knickers';break;default:}return msg;}},{key:"style",set:function set(style){this._style=style;if(style===0)this.id=this.name='Briefs';else if(style===100)this.id=this.name='Knickers';else throw new Error(this.id+' doesnt know '+style);},get:function get(){return this._style;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(Briefs,value.data);}}]);return Briefs;}(Equipment);var AnalPlug=/*#__PURE__*/function(_Equipment21){_inherits(AnalPlug,_Equipment21);var _super121=_createSuper(AnalPlug);_createClass(AnalPlug,null,[{key:"factory",value:function factory(style){var x=new AnalPlug();x.style=style;return x;}}]);function AnalPlug(){var _this119;_classCallCheck(this,AnalPlug);_this119=_super121.call(this,'AnalPlug');_this119.addTags(['ButtPlug']);_this119.slotUse=['uAnus',window.gm.ItemTags.Wear];_this119.slotCover=[];_this119.lossOnRespawn=false;_this119.style=0,_this119.lewd.slut=3;return _this119;}_createClass(AnalPlug,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("AnalPlug",this);}},{key:"equipText",value:function equipText(){return"The plug slides smoothly into its place. ";}//unequipText(context){}
},{key:"onEquip",value:function onEquip(context){var res=_get(_getPrototypeOf(AnalPlug.prototype),"onEquip",this).call(this,context);if(res.OK){//if(this.style===100){
context.parent.addEffect(new window.storage.constructors['effButtPlugged'](),"effButtPlugged");//only works for player since effects of NPC dont receive ticks!
}return res;}},{key:"onUnequip",value:function onUnequip(context){_get(_getPrototypeOf(AnalPlug.prototype),"onUnequip",this).call(this,context);return{OK:true,msg:'unequipped'};}},{key:"style",set:function set(style){this._style=style;if(style===0)this.id=this.name='AnalPlugSmall';else if(style===100){this.id=this.name='AnalPlugMedium';}else throw new Error(this.id+' doesnt know '+style);},get:function get(){return this._style;}},{key:"desc",get:function get(){var msg='a small rubber-toy for someones rear';switch(this._style){case 100:msg='a medium-sized buttplug';break;default:}return msg+this.bonusDesc();}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(AnalPlug,value.data);}}]);return AnalPlug;}(Equipment);var CockRing=/*#__PURE__*/function(_Equipment22){_inherits(CockRing,_Equipment22);var _super122=_createSuper(CockRing);_createClass(CockRing,null,[{key:"factory",value:function factory(style){var x=new CockRing();x.style=style;return x;}}]);function CockRing(){var _this120;_classCallCheck(this,CockRing);_this120=_super122.call(this,'CockRing');_this120.addTags(['lewd']);_this120.slotUse=['uPenis',window.gm.ItemTags.Wear];_this120.slotCover=[];_this120.lossOnRespawn=false;_this120.style=0,_this120.lewd.slut=1;return _this120;}_createClass(CockRing,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("CockRing",this);}},{key:"style",set:function set(style){this._style=style;if(style===0)this.id=this.name='CockRing';else if(style===100)this.id=this.name='CockAndBallRing';else throw new Error(this.id+' doesnt know '+style);},get:function get(){return this._style;}},{key:"desc",get:function get(){var msg='a heavy cockring made of steel';switch(this._style){case 100:msg='a contraption that squeezes tightly around base of dick and balls';break;default:}return msg;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(CockRing,value.data);}}]);return CockRing;}(Equipment);var ChastityBelt=/*#__PURE__*/function(_Equipment23){_inherits(ChastityBelt,_Equipment23);var _super123=_createSuper(ChastityBelt);_createClass(ChastityBelt,null,[{key:"factory",value:function factory(style){var x=new ChastityBelt();x.style=style;return x;}}]);function ChastityBelt(){var _this121;_classCallCheck(this,ChastityBelt);_this121=_super123.call(this,'ChastityBelt');_this121.addTags(['steel',window.gm.ItemTags.Wear]);_this121.slotUse=['uPenis','uVulva'];_this121.slotCover=['bPenis','bVulva','bClit','pPenis','pClit'];_this121.lossOnRespawn=false;_this121.style=0,_this121.lewd.slut=1;return _this121;}_createClass(ChastityBelt,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("ChastityBelt",this);}},{key:"style",set:function set(style){this._style=style;if(style===0)this.id=this.name='ChastityBelt';else if(style===100)this.id=this.name='CockCage';else throw new Error(this.id+' doesnt know '+style);},get:function get(){return this._style;}},{key:"desc",get:function get(){var msg='chastity belt covering your privates';switch(this._style){case 100:msg='a cockcage to restrict ones erection';break;default:}return msg;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(ChastityBelt,value.data);}}]);return ChastityBelt;}(Equipment);var BikiniBottomLeather=/*#__PURE__*/function(_Equipment24){_inherits(BikiniBottomLeather,_Equipment24);var _super124=_createSuper(BikiniBottomLeather);_createClass(BikiniBottomLeather,null,[{key:"factory",value:function factory(style){var x=new BikiniBottomLeather();x.style=style;return x;}}]);function BikiniBottomLeather(){var _this122;_classCallCheck(this,BikiniBottomLeather);_this122=_super124.call(this,'BikiniBottomLeather');_this122.addTags(['cloth',window.gm.ItemTags.Wear]);_this122.slotUse=['uHips'];_this122.slotCover=['bPenis','bVulva','bBalls','bClit','bAnus','pPenis','pClit'];_this122.lossOnRespawn=true;_this122.style=0;return _this122;}_createClass(BikiniBottomLeather,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("BikiniBottomLeather",this);}},{key:"style",set:function set(style){this._style=style;if(style===0)this.id=this.name='BikiniBottomLeather';else throw new Error(this.id+' doesnt know '+style);},get:function get(){return this._style;}},{key:"desc",get:function get(){var msg='leather triangle-bikini bottom';switch(this._style){case 100:msg='xxx';break;default:}return msg;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(BikiniBottomLeather,value.data);}}]);return BikiniBottomLeather;}(Equipment);var BikiniTopLeather=/*#__PURE__*/function(_Equipment25){_inherits(BikiniTopLeather,_Equipment25);var _super125=_createSuper(BikiniTopLeather);_createClass(BikiniTopLeather,null,[{key:"factory",value:function factory(style){var x=new BikiniTopLeather();x.style=style;return x;}}]);function BikiniTopLeather(){var _this123;_classCallCheck(this,BikiniTopLeather);_this123=_super125.call(this,'BikiniTopLeather');_this123.addTags(['cloth',window.gm.ItemTags.Wear]);_this123.slotUse=['uBreast'];_this123.slotCover=['pNipples'];_this123.lossOnRespawn=true;_this123.style=0;return _this123;}_createClass(BikiniTopLeather,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("BikiniTopLeather",this);}},{key:"style",set:function set(style){this._style=style;if(style===0)this.id=this.name='BikiniTopLeather';else throw new Error(this.id+' doesnt know '+style);},get:function get(){return this._style;}},{key:"desc",get:function get(){var msg='leather triangle-bikini top';switch(this._style){case 100:msg='xxx';break;default:}return msg;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(BikiniTopLeather,value.data);}}]);return BikiniTopLeather;}(Equipment);var ShortsLeather=/*#__PURE__*/function(_Equipment26){_inherits(ShortsLeather,_Equipment26);var _super126=_createSuper(ShortsLeather);_createClass(ShortsLeather,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("ShortsLeather",this);}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(ShortsLeather,value.data);}},{key:"factory",value:function factory(style){var x=new ShortsLeather();x.style=style;return x;}}]);function ShortsLeather(){var _this124;_classCallCheck(this,ShortsLeather);_this124=_super126.call(this);_this124.addTags(['cloth',window.gm.ItemTags.Wear]);_this124.slotUse=['Hips','Legs'];_this124.slotCover=['bPenis','bVulva','bBalls','bClit','bAnus','pPenis','pClit'];_this124.lossOnRespawn=true;_this124.style=0;return _this124;}_createClass(ShortsLeather,[{key:"style",set:function set(style){this._style=style;if(style===0)this.id=this.name='ShortsLeather';else if(style===10)this.id=this.name='DenimShorts';else if(style===20)this.id=this.name='BermudaShorts';else if(style===100)this.id=this.name='Loincloth';else if(style===200){this.id=this.name='Chaps';this.slotCover=[];}else throw new Error(this.id+' doesnt know '+style);},get:function get(){return this._style;}},{key:"desc",get:function get(){var msg='short trousers made from leather';switch(this._style){case 10:msg='shorts made from blue jeans';break;case 20:msg='colorful bermuda shorts';break;case 100:msg='a crude loincloth made from rough cotton';break;case 100:msg='those pants are usually worn on top of normal pants. Because they dont cover front and back of your groin.';break;default:}return msg;}}]);return ShortsLeather;}(Equipment);var Skirt=/*#__PURE__*/function(_Equipment27){_inherits(Skirt,_Equipment27);var _super127=_createSuper(Skirt);_createClass(Skirt,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("Skirt",this);}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(Skirt,value.data);}},{key:"factory",value:function factory(style){var x=new Skirt();x.style=style;return x;}}]);function Skirt(){var _this125;_classCallCheck(this,Skirt);_this125=_super127.call(this);_this125.addTags(['cloth',window.gm.ItemTags.Wear]);_this125.slotUse=['Hips','Legs'];_this125.slotCover=['bPenis','bVulva','bBalls','bClit','bAnus','pPenis','pClit'];_this125.lossOnRespawn=true;_this125.style=0;return _this125;}_createClass(Skirt,[{key:"style",set:function set(style){this._style=style;if(style===0)this.id=this.name='PlainSkirt';if(style===10)this.id=this.name='MiniSkirt';if(style===20)this.id=this.name='MicroSkirt';else throw new Error(this.id+' doesnt know '+style);},get:function get(){return this._style;}},{key:"desc",get:function get(){var msg='decent skirt from cloth';switch(this._style){case 10:msg='a short skirt that covers someones thighs';break;case 20:msg='a very short skirt that barely covers someones crotch and ass';break;default:}return msg;}}]);return Skirt;}(Equipment);//this is an Inventory-item, not wardrobe
var Crowbar=/*#__PURE__*/function(_Weapon2){_inherits(Crowbar,_Weapon2);var _super128=_createSuper(Crowbar);_createClass(Crowbar,null,[{key:"factory",value:function factory(style){var x=new Crowbar();x.style=style;return x;}}]);function Crowbar(){var _this126;_classCallCheck(this,Crowbar);_this126=_super128.call(this);_this126.addTags(['tool']);_this126.slotUse=['LHand'];_this126.lossOnRespawn=true;_this126.style=0;return _this126;}_createClass(Crowbar,[{key:"descLong",value:function descLong(fconv){return fconv('$[I]$ $[hold]$ a '+this.name+'.');}},{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("Crowbar",this);}},{key:"style",set:function set(style){this._style=style;if(style===0)this.id='Crowbar',this.name='Crowbar';if(style===10)this.id='PipeWrench',this.name='Pipe Wrench';if(style===20)this.id='Hammer',this.name='Hammer';else throw new Error(this.id+' doesnt know '+style);},get:function get(){return this._style;}},{key:"desc",get:function get(){var msg='a crowbar';switch(this._style){case 10:msg='a heavy wrench';break;case 20:msg='a mechanicans hammer';break;default:}return msg;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(Crowbar,value.data);}}]);return Crowbar;}(Weapon);//this is an Inventory-item, not wardrobe
var Shovel=/*#__PURE__*/function(_Weapon3){_inherits(Shovel,_Weapon3);var _super129=_createSuper(Shovel);function Shovel(){var _this127;_classCallCheck(this,Shovel);_this127=_super129.call(this);_this127.id=_this127.name='Shovel';_this127.addTags(['tool']);_this127.slotUse=['RHand','LHand'];_this127.lossOnRespawn=true;return _this127;}_createClass(Shovel,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("Shovel",this);}},{key:"desc",get:function get(){return'A rusty,old shovel.';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(Shovel,value.data);}}]);return Shovel;}(Weapon);var BowWodden=/*#__PURE__*/function(_Weapon4){_inherits(BowWodden,_Weapon4);var _super130=_createSuper(BowWodden);function BowWodden(){var _this128;_classCallCheck(this,BowWodden);_this128=_super130.call(this);_this128.id=_this128.name='BowWodden';_this128.slotUse=['RHand','LHand'];_this128.lossOnRespawn=true;return _this128;}_createClass(BowWodden,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("BowWodden",this);}},{key:"usable",value:function usable(context){return this.canEquip(context);}},{key:"use",value:function use(context){//context here is inventory not outfit
if(this.parent.parent.Outfit.findItemSlot(this.id).length>0){this.parent.parent.Outfit.removeItem(this.id);return{OK:true,msg:'unequipped '+this.name};}else{this.parent.parent.Outfit.addItem(this);return{OK:true,msg:'equipped '+this.name};}}},{key:"attackMod",value:function attackMod(target){var mod=new SkillMod();mod.onHit=[{target:target,eff:[effDamage.factory(6,'pierce')]}];mod.critChance=25;mod.onCrit=[{target:target,eff:[effDamage.factory(10,'pierce')]}];return mod;}},{key:"desc",get:function get(){return'A simple bow';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(BowWodden,value.data);}}]);return BowWodden;}(Weapon);var DaggerSteel=/*#__PURE__*/function(_Weapon5){_inherits(DaggerSteel,_Weapon5);var _super131=_createSuper(DaggerSteel);_createClass(DaggerSteel,null,[{key:"factory",value:function factory(style){var x=new DaggerSteel();x.style=style;return x;}}]);function DaggerSteel(){var _this129;_classCallCheck(this,DaggerSteel);_this129=_super131.call(this);_this129.id=_this129.name='DaggerSteel';_this129.slotUse=['RHand'];_this129.lossOnRespawn=true;_this129.style=0;return _this129;}_createClass(DaggerSteel,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("DaggerSteel",this);}},{key:"attackMod",value:function attackMod(target){var mod=new SkillMod();if(this._style===0){mod.onHit=[{target:target,eff:[effDamage.factory(5,'slash')]}];mod.critChance=50;mod.onCrit=[{target:target,eff:[effDamage.factory(5,'slash'),effDamage.factory(3,'pierce')]}];}else if(this._style===10){mod.onHit=[{target:target,eff:[effTeaseDamage.factory(10,'slut',{slut:2},target.name+" get turned on.")]}];mod.critChance=50;mod.onCrit=[{target:target,eff:[effTeaseDamage.factory(10*2,'slut',{slut:2},target.name+" get flushing hot.")]}];}return mod;}},{key:"style",set:function set(style){this._style=style;if(style===0)this.id='DaggerSteel',this.name='Steel Dagger';else if(style===10)this.id='Syringe',this.name="filled syringe";else throw new Error(this.id+' doesnt know '+style);},get:function get(){return this._style;}},{key:"desc",get:function get(){var msg='a steel dagger';switch(this._style){case 10:msg='a syringe filled with mysterious liquid';break;default:}return msg;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(DaggerSteel,value.data);}}]);return DaggerSteel;}(Weapon);var WhipLeather=/*#__PURE__*/function(_Weapon6){_inherits(WhipLeather,_Weapon6);var _super132=_createSuper(WhipLeather);function WhipLeather(){var _this130;_classCallCheck(this,WhipLeather);_this130=_super132.call(this);_this130.id=_this130.name='WhipLeather';_this130.slotUse=['RHand'];_this130.lossOnRespawn=true;return _this130;}_createClass(WhipLeather,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("WhipLeather",this);}},{key:"attackMod",value:function attackMod(target){var mod=new SkillMod();mod.msg="with a whiplash";mod.onHit=[{target:target,eff:[effDamage.factory(5,'slash')]}];mod.critChance=5;mod.onCrit=[{target:target,eff:[effDamage.factory(10,'slash'),effMasochist.factory(1)]}];return mod;}},{key:"desc",get:function get(){return'a leather whip.';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(WhipLeather,value.data);}}]);return WhipLeather;}(Weapon);var StaffWodden=/*#__PURE__*/function(_Weapon7){_inherits(StaffWodden,_Weapon7);var _super133=_createSuper(StaffWodden);_createClass(StaffWodden,null,[{key:"factory",value:function factory(style){var x=new StaffWodden();x.style=style;return x;}}]);function StaffWodden(){var _this131;_classCallCheck(this,StaffWodden);_this131=_super133.call(this);_this131.style='StaffWodden';_this131.slotUse=['RHand','LHand'];_this131.lossOnRespawn=true;return _this131;}_createClass(StaffWodden,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("StaffWodden",this);}},{key:"onEquip",value:function onEquip(context){var sk=new SkillStrongHit();sk.weapon=this.id;this.parent.parent.Skills.addItem(sk);return{OK:true,msg:'equipped'};}},{key:"onUnequip",value:function onUnequip(context){this.parent.parent.Skills.removeItem('StrongAttack');return{OK:true,msg:'unequipped'};}},{key:"attackMod",value:function attackMod(target){var mod=new SkillMod();mod.onHit=[{target:target,eff:[effDamage.factory(11,'blunt')]}];mod.critChance=5;mod.onCrit=[{target:target,eff:[effDamage.factory(11,'blunt'),new effStunned()]}];return mod;}},{key:"style",set:function set(style){if(style==='StaffWodden')this.name='wodden staff';else throw new Error(this.id+' doesnt know '+style);this.id=style;},get:function get(){return this.id;}},{key:"desc",get:function get(){var msg='a large wodden staff for 2-hand combat';switch(this._style){case 100:msg='a stone-triangle mounted on a long stick';break;default:}return msg;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(StaffWodden,value.data);}}]);return StaffWodden;}(Weapon);var SpearWodden=/*#__PURE__*/function(_Weapon8){_inherits(SpearWodden,_Weapon8);var _super134=_createSuper(SpearWodden);_createClass(SpearWodden,null,[{key:"factory",value:function factory(style){var x=new SpearWodden();x.style=style;return x;}}]);function SpearWodden(){var _this132;_classCallCheck(this,SpearWodden);_this132=_super134.call(this);_this132.slotUse=['RHand','LHand'];_this132.lossOnRespawn=true;_this132.style=0;return _this132;}_createClass(SpearWodden,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SpearWodden",this);}},{key:"onEquip",value:function onEquip(context){var res=_get(_getPrototypeOf(SpearWodden.prototype),"onEquip",this).call(this,context);if(res.OK){var sk=new SkillStrongHit();sk.weapon=this.id;this.parent.parent.Skills.addItem(sk);}return res;}},{key:"onUnequip",value:function onUnequip(context){_get(_getPrototypeOf(SpearWodden.prototype),"onUnequip",this).call(this,context);this.parent.parent.Skills.removeItem('StrongAttack');return{OK:true,msg:'unequipped'};}},{key:"attackMod",value:function attackMod(target){var mod=new SkillMod();var bonus=Math.floor(this.style/20);mod.onHit=[{target:target,eff:[effDamage.factory(8+bonus,'pierce')]}];mod.critChance=5;mod.onCrit=[{target:target,eff:[effDamage.factory(10+bonus*1.5,'pierce'),new effBleed(4)]}];return mod;}},{key:"style",set:function set(style){this._style=style;if(style===0)this.id=this.name='SpearWodden';else if(style===100)this.id=this.name='SpearStone';else throw new Error(this.id+' doesnt know '+style);},get:function get(){return this._style;}},{key:"desc",get:function get(){var msg='a large, smooth branch with a firehardened tip';switch(this._style){case 100:msg='a stone-triangle mounted on a long stick';break;default:}return msg;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SpearWodden,value.data);}}]);return SpearWodden;}(Weapon);var SpellRod=/*#__PURE__*/function(_Weapon9){_inherits(SpellRod,_Weapon9);var _super135=_createSuper(SpellRod);_createClass(SpellRod,null,[{key:"factory",value:function factory(style){var x=new SpellRod();x.style=style;return x;}}]);function SpellRod(){var _this133;_classCallCheck(this,SpellRod);_this133=_super135.call(this);_this133.slotUse=['LHand'];_this133.lossOnRespawn=true;_this133.style=0;return _this133;}_createClass(SpellRod,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SpellRod",this);}},{key:"onEquip",value:function onEquip(context){var res=_get(_getPrototypeOf(SpellRod.prototype),"onEquip",this).call(this,context);if(res.OK){var sk=new SkillSpark();sk.weapon=this.id;this.parent.parent.Skills.addItem(sk);}return res;}},{key:"onUnequip",value:function onUnequip(context){_get(_getPrototypeOf(SpellRod.prototype),"onUnequip",this).call(this,context);this.parent.parent.Skills.removeItem('Spark');return{OK:true,msg:'unequipped'};}},{key:"style",set:function set(style){this._style=style;if(style===0)this.id=this.name='SparkRod';else if(style===100)this.id=this.name='FlameRod';else throw new Error(this.id+' doesnt know '+style);},get:function get(){return this._style;}},{key:"desc",get:function get(){var msg='a mysterious twig that, if worn in left hand, lets even unexperienced user cast magic;';switch(this._style){case 0:msg+='casts a electric spark';break;case 100:msg+='casts a fireball';break;default:}return msg;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SpellRod,value.data);}}]);return SpellRod;}(Weapon);var ShieldSmall=/*#__PURE__*/function(_Weapon10){_inherits(ShieldSmall,_Weapon10);var _super136=_createSuper(ShieldSmall);function ShieldSmall(){var _this134;_classCallCheck(this,ShieldSmall);_this134=_super136.call(this,'ShieldSmall');_this134.addTags(['shield']);_this134.slotUse=['LHand'];_this134.style=0;_this134.lossOnRespawn=true;return _this134;}_createClass(ShieldSmall,[{key:"descLong",value:function descLong(fconv){var msg='';if(this.isEquipped())msg='In $[my]$ left hand $[I]$ $[carry]$ a '+this.desc+' .';else msg='$[I]$ $[have]$ '+this.name+".";return fconv(msg);}},{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("ShieldSmall",this);}},{key:"usable",value:function usable(context){return this.canEquip(context);}},{key:"use",value:function use(context){//context here is inventory not outfit
if(this.parent.parent.Outfit.findItemSlot(this.id).length>0){this.parent.parent.Outfit.removeItem(this.id);return{OK:true,msg:'unequipped '+this.name};//todo
}else{this.parent.parent.Outfit.addItem(this);return{OK:true,msg:'equipped '+this.name};//todo
}}},{key:"style",set:function set(style){this._style=style;if(style===100)this.block=3,this.id='ShieldWodden',this.name='wooden shield';else if(style===200)this.block=5,this.id='ShieldIron',this.name='iron shield';else this.block=1,this.id='ShieldBuckler',this.name='small buckler';},get:function get(){return this._style;}},{key:"desc",get:function get(){var msg='small buckler';switch(this._style){case 100:msg='small wooden shield';break;case 200:msg='reinforced shield';break;default:}return msg+'(blocking +'+this.block+') '+this.bonusDesc();}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(ShieldSmall,value.data);}}]);return ShieldSmall;}(Weapon);var MaceSteel=/*#__PURE__*/function(_Weapon11){_inherits(MaceSteel,_Weapon11);var _super137=_createSuper(MaceSteel);function MaceSteel(){var _this135;_classCallCheck(this,MaceSteel);_this135=_super137.call(this);_this135.id=_this135.name='MaceSteel';_this135.slotUse=['RHand'];_this135.lossOnRespawn=true;return _this135;}_createClass(MaceSteel,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("MaceSteel",this);}},{key:"attackMod",value:function attackMod(target){var mod=new SkillMod();mod.onHit=[{target:target,eff:[effDamage.factory(11,'blunt')]}];mod.critChance=50;mod.onCrit=[{target:target,eff:[effDamage.factory(11,'blunt'),new effStunned()]}];return mod;}},{key:"desc",get:function get(){return'A heavy steel mace.';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(MaceSteel,value.data);}}]);return MaceSteel;}(Weapon);var TailRibbon=/*#__PURE__*/function(_Equipment28){_inherits(TailRibbon,_Equipment28);var _super138=_createSuper(TailRibbon);function TailRibbon(){var _this136;_classCallCheck(this,TailRibbon);_this136=_super138.call(this,'TailRibbon');_this136.addTags(['cloth']);_this136.slotUse=['TailTip'];return _this136;}_createClass(TailRibbon,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("TailRibbon",this);}},{key:"canEquip",value:function canEquip(context){if(this.parent.parent.Outfit.findItemSlot(this.id).length>0)return{OK:true,msg:'unequip'};else{if(this.parent.parent.Outfit.countItem("TailWolf")>0){return{OK:true,msg:'equip'};}else{return{OK:false,msg:'This requires a propper tail to attach to!'};}}}},{key:"desc",get:function get(){'a fancy color band that can be wrapped around someones tailtip';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(TailRibbon,value.data);}}]);return TailRibbon;}(Equipment);//todo bow,blowpipe
//todo vest, greaves , jacket
//fly swatter - good against small insects
window.gm.ItemsLib=function(ItemsLib){window.storage.registerConstructor(AnalPlug);window.storage.registerConstructor(BikiniBottomLeather);window.storage.registerConstructor(BikiniTopLeather);window.storage.registerConstructor(BracerLeather);window.storage.registerConstructor(Briefs);window.storage.registerConstructor(ChastityBelt);window.storage.registerConstructor(CockRing);window.storage.registerConstructor(Collar);window.storage.registerConstructor(RingFinger);window.storage.registerConstructor(Gag);window.storage.registerConstructor(DaggerSteel);window.storage.registerConstructor(HarnessRubber);window.storage.registerConstructor(Leggings);window.storage.registerConstructor(MaceSteel);window.storage.registerConstructor(TankShirt);window.storage.registerConstructor(Jeans);window.storage.registerConstructor(Sneakers);window.storage.registerConstructor(Pullover);window.storage.registerConstructor(Crowbar);window.storage.registerConstructor(Shovel);window.storage.registerConstructor(TailRibbon);window.storage.registerConstructor(PiercingClit);window.storage.registerConstructor(PiercingNipples);window.storage.registerConstructor(PiercingEars);window.storage.registerConstructor(TattooGroin);window.storage.registerConstructor(RobesZealot);window.storage.registerConstructor(ShortsLeather);window.storage.registerConstructor(ShieldSmall);window.storage.registerConstructor(SpearWodden);window.storage.registerConstructor(SpellRod);window.storage.registerConstructor(StaffWodden);window.storage.registerConstructor(WristCuffs);window.storage.registerConstructor(WhipLeather);//.. and Wardrobe
ItemsLib['AnalPlugSmall']=function(){var x=new AnalPlug();x.style=0;return x;};ItemsLib['AnalPlugMed']=function(){var x=new AnalPlug();x.style=100;return x;};ItemsLib['BikiniBottomLeather']=function(){return new BikiniBottomLeather();};ItemsLib['BikiniTopLeather']=function(){return new BikiniTopLeather();};ItemsLib['RingFinger']=function(){var x=new RingFinger();x.style=0;return x;};ItemsLib['FaceWrap']=function(){var x=new Gag();x.style=0;return x;};ItemsLib['Muzzle']=function(){var x=new Gag();x.style=10;return x;};ItemsLib['BallGag']=function(){var x=new Gag();x.style=20;return x;};ItemsLib['Briefs']=function(){return new Briefs();};ItemsLib['Knickers']=function(){var x=new Briefs();x.style=100;return x;};ItemsLib['ChastityBelt']=function(){var x=new ChastityBelt();x.style=0;return x;};ItemsLib['CockCage']=function(){var x=new ChastityBelt();x.style=100;return x;};ItemsLib['CockRing']=function(){var x=new CockRing();x.style=0;return x;};ItemsLib['CollarQuest']=function(){var x=new Collar();x.style=40;return x;};ItemsLib['CollarID']=function(){var x=new Collar();x.style=50;return x;};ItemsLib['CollarDog']=function(){var x=new Collar();x.style=10;return x;};ItemsLib['CollarSpikes']=function(){var x=new Collar();x.style=20;return x;};ItemsLib['PendantLuck']=function(){var x=new Collar();x.style=30;return x;};ItemsLib['Leggings']=function(){return new Leggings();};ItemsLib['TankShirt']=function(){return new TankShirt();};ItemsLib['HawaiiShirt']=function(){var x=new TankShirt();x.style=10;return x;};ItemsLib['TShirt']=function(){var x=new TankShirt();x.style=20;return x;};ItemsLib['Jeans']=function(){return new Jeans();};ItemsLib['Trousers']=function(){var x=new Jeans();x.style=100;return x;};ItemsLib['Sneakers']=function(){return new Sneakers();};ItemsLib['FlipFlops']=function(){var x=new Sneakers();x.style=10;return x;};ItemsLib['Pullover']=function(){return new Pullover();};ItemsLib['TailRibbon']=function(){return new TailRibbon();};ItemsLib['PiercingClit']=function(){return new PiercingClit();};ItemsLib['PiercingEars']=function(){return new PiercingEars();};ItemsLib['PiercingNipples']=function(){return new PiercingNipples();};ItemsLib['TattooGroin']=function(){return new TattooGroin();};ItemsLib['LewdMark']=function(){var x=new TattooGroin();x.style=100;return x;};ItemsLib['RobesZealot']=function(){return new RobesZealot();};ItemsLib['PrisonerCloths']=function(){var x=new RobesZealot();x.style=100;return x;};ItemsLib['ShortsLeather']=function(){var x=new ShortsLeather();x.style=0;return x;};ItemsLib['ShortsDenim']=function(){var x=new ShortsLeather();x.style=10;return x;};ItemsLib['ShortsBermuda']=function(){var x=new ShortsLeather();x.style=20;return x;};ItemsLib['LoinCloth']=function(){var x=new ShortsLeather();x.style=100;return x;};ItemsLib['Chaps']=function(){var x=new ShortsLeather();x.style=200;return x;};ItemsLib['WristCuffs']=function(){return new WristCuffs();};ItemsLib['HarnessRubber']=function(){return new HarnessRubber();};ItemsLib['BracerLeather']=function(){var x=new BracerLeather();return x;};ItemsLib['GlovesRubber']=function(){var x=new BracerLeather();x.style=200;return x;};//special wardrobe-item combination
ItemsLib['Crowbar']=function(){return new Crowbar();};ItemsLib['PipeWrench']=function(){return new Crowbar.factory(10);};ItemsLib['Shovel']=function(){return new Shovel();};ItemsLib['StaffWodden']=function(){return new StaffWodden();};ItemsLib['Handcuffs']=function(){return new HandCuffs();};ItemsLib['DaggerSteel']=function(){return new DaggerSteel();};ItemsLib['Syringe']=function(){var x=new DaggerSteel();x.style=10;return x;};ItemsLib['ShieldBuckler']=function(){var x=new ShieldSmall();x.style=0;return x;};ItemsLib['ShieldWodden']=function(){var x=new ShieldSmall();x.style=100;return x;};ItemsLib['ShieldIron']=function(){var x=new ShieldSmall();x.style=200;return x;};ItemsLib['SpearWodden']=function(){var x=new SpearWodden();return x;};ItemsLib['SpearStone']=function(){var x=new SpearWodden();x.style=100;return x;};ItemsLib['SpearWodden']=function(){var x=new SpellRod();return x;};ItemsLib['SpellRodSpark']=function(){return SpellRod.factory(0);};ItemsLib['WhipLeather']=function(){var x=new WhipLeather();return x;};return ItemsLib;}(window.gm.ItemsLib||{});//todo stained cloths
//shredded cloths need to be stitched
//nagel schere- stumpft klauen ab
window.gm.FKnow={//Flag-names what the player "knows"
LewdMark:"LewdMark",Slime:"Slime"};//this holds the definition of all quests; but which quests/ms are active is stored in window.story.state.quests !
window.gm.questDef=window.gm.questDef||{};{var quest=new Quest("qFindGarden","Find the garden","The Garden is somewhere around the house.");var mile1=new QuestMilestone(1,"Find the garden","You heard rumors that there is a garden behind the house.Find it.",//each milestone should define a function that checks if the milestone is fullfilled or not or if no more milestones
function(){if(window.passage.name==="Garden"){return 100;}else return 0;});var mile2=new QuestMilestone(100,"Found the garden","Congratulation. You found the garden.",function(){return-1;});quest.addMileStone(mile1);quest.addMileStone(mile2);window.gm.questDef[quest.id]=quest;}{var NOP=function NOP(){return 0;};var _quest2=new Quest("qFixLaptop","Upgrade your Laptop","");_quest2.addMileStone(new QuestMilestone(1,"","The powerconverter for your laptop should be somewhere around in the house. ",NOP));_quest2.addMileStone(new QuestMilestone(1000,"","The Laptop is working.",NOP));// install webcam
window.gm.questDef[_quest2.id]=_quest2;}{var _NOP=function _NOP(){return 0;};var _quest3=new Quest("qStudy","Do some studying","Do something for your success at university.");_quest3.addMileStone(new QuestMilestone(1,"","Sitting down and reading a book might get you some knowledge.",_NOP));_quest3.addMileStone(new QuestMilestone(100,"","At least you feel a little smarter now.",function(){return-1;}));window.gm.questDef[_quest3.id]=_quest3;}{var _NOP2=function _NOP2(){return 0;};var hidden=function hidden(){return window.gm.quests.getMilestoneState("qMyPleasure").id<100;};var _quest4=new Quest("qMyPleasure","Pleasure yourself","Pleasure yourself.",hidden);_quest4.addMileStone(new QuestMilestone(1,"","Rub yourself.",_NOP2,hidden));_quest4.addMileStone(new QuestMilestone(100,"","You created a mess in your bedsheets.",function(){return-1;}));window.gm.questDef[_quest4.id]=_quest4;}{//quest-flag counts the shifts done in week
var _NOP3=function _NOP3(){return 0;};var _quest5=new Quest("qFindAJob","Find a job","Somehow you have to make a living.");_quest5.addMileStone(new QuestMilestone(1,"","Maybe you can ask around or check the blackboard at the uni for some offers.",_NOP3));_quest5.addMileStone(new QuestMilestone(100,"","You've got that job-ad from Harcon Health Inc that is somewhere in downtown. Maybe you could inquire there whats up with it.",_NOP3));_quest5.addMileStone(new QuestMilestone(200,"","They offered you to work in logistic department. You will move boxes and crates around for little money but at least its a start. Check your job-schedule",_NOP3));_quest5.addMileStone(new QuestMilestone(300,"","???",_NOP3));window.gm.questDef[_quest5.id]=_quest5;}//////////////////////////////////////////////////////////////////////////////////////
{// the quest keeps track of the VR-Game main development
var _NOP4=function _NOP4(){return 0;};var _hidden=function _hidden(){return window.gm.quests.getMilestoneState("qDLCMain").id<100;};var _quest6=new Quest("qDLCMain","qDLCMain","qDLCMain",_hidden);_quest6.addMileStone(new QuestMilestone(1,"","Sign betatestcontract.",_NOP4,_hidden));_quest6.addMileStone(new QuestMilestone(100,"","It will take some days until the game-equipment arrives. Spent some time studying or working.",_NOP4,_hidden));_quest6.addMileStone(new QuestMilestone(500,"","Setup VR-equipment.",_NOP4,_hidden));_quest6.addMileStone(new QuestMilestone(600,"","Enter the game.",_NOP4,_hidden));_quest6.addMileStone(new QuestMilestone(700,"","Get to the settlement.",_NOP4,_hidden));_quest6.addMileStone(new QuestMilestone(800,"","Ask around for a quest.",_NOP4,_hidden));_quest6.addMileStone(new QuestMilestone(900,"","Finish the PurpleBerryQuest.",_NOP4));_quest6.addMileStone(new QuestMilestone(1000,"","Get past that bridge and find your way to the village",_NOP4));//<--
_quest6.addMileStone(new QuestMilestone(1100,"","Ask around in the village for help with that collar.",_NOP4));_quest6.addMileStone(new QuestMilestone(1200,"","Someone called \"Librarian\" might be found in ruins north of plains",_NOP4));window.gm.questDef[_quest6.id]=_quest6;}{// the quest tracks death for tutorial
var _NOP5=function _NOP5(){return 0;};var _hidden2=function _hidden2(){return window.gm.quests.getMilestoneState("qDiedAgain").id<0;};var _quest7=new Quest("qDiedAgain","qDiedAgain","qDiedAgain",_hidden2);_quest7.addMileStone(new QuestMilestone(1,"","Life is a game.",_NOP5,_hidden2));_quest7.addMileStone(new QuestMilestone(2,"","Find your first death.",_NOP5,_hidden2));_quest7.addMileStone(new QuestMilestone(100,"","Die with some bonded equipment.",_NOP5,_hidden2));_quest7.addMileStone(new QuestMilestone(200,"","Die by pleasure.",_NOP5,_hidden2));//todo what if this is before previous?
_quest7.addMileStone(new QuestMilestone(300,"",".",_NOP5,_hidden2));window.gm.questDef[_quest7.id]=_quest7;}{//
var _NOP6=function _NOP6(){return 0;};var _hidden3=function _hidden3(){return false;};var _quest8=new Quest("qPurpleBerry","qPurpleBerry","qPurpleBerry",_hidden3);_quest8.addMileStone(new QuestMilestone(1,"","Search the forest for 5 handful of purple berrys and deliver them to the alchemist.",_NOP6,_hidden3));_quest8.addMileStone(new QuestMilestone(100,"","You delivered the berries to the alchemist.",_NOP6,_hidden3));_quest8.addMileStone(new QuestMilestone(200,"","Find 4 purple berrys, 2 apoca-blossoms, 2 leeches.",_NOP6,_hidden3));_quest8.addMileStone(new QuestMilestone(300,"","Fetch the potion from the alchemist.",_NOP6,_hidden3));window.gm.questDef[_quest8.id]=_quest8;}{var _NOP7=function _NOP7(){return 0;};var _hidden4=function _hidden4(){return window.gm.quests.getMilestoneState("qCarlia").id<100;};var _quest9=new Quest("qCarlia","Carlia","Carlia",_hidden4);_quest9.addMileStone(new QuestMilestone(1,"","",_NOP7,_hidden4));_quest9.addMileStone(new QuestMilestone(100,"","A strange individual is stalking you.",_NOP7,_hidden4));_quest9.addMileStone(new QuestMilestone(200,"","That stalker was eying you again. He was disappearing into the cliffs direction.",_NOP7,_hidden4));_quest9.addMileStone(new QuestMilestone(300,"","There were some footprint at the cliff that led you to a concealed path.",_NOP7));_quest9.addMileStone(new QuestMilestone(400,"","Someone setup a camp in a cave entrance. Maybe you an find some clues there.",_NOP7));_quest9.addMileStone(new QuestMilestone(500,"","Pooking around in other peoples stuff got you a \"present\".",_NOP7));_quest9.addMileStone(new QuestMilestone(600,"","The stalker didnt care to hide any longer and accused you of thievery.",_NOP7));_quest9.addMileStone(new QuestMilestone(700,"","Try to convince her that she can trust you by finding her a home.",_NOP7));_quest9.addMileStone(new QuestMilestone(800,"","Tell Carlia that the Alchemist aggreed to let Carlia sleep in his hut.",_NOP7));_quest9.addMileStone(new QuestMilestone(900,"","For your help Carlia showed you a new \'skill\'.",_NOP7));window.gm.questDef[_quest9.id]=_quest9;}{var _NOP8=function _NOP8(){return 0;};var _hidden5=function _hidden5(){return window.gm.quests.getMilestoneState("qWolfMate").id<100;};var _quest10=new Quest("qWolfMate","qWolfMate","qWolfMate",_hidden5);_quest10.addMileStone(new QuestMilestone(1,"","Saw a wolf.",_NOP8,_hidden5));_quest10.addMileStone(new QuestMilestone(400,"","Is that wolf stronger than you? Lets find out.",_NOP8,_hidden5));_quest10.addMileStone(new QuestMilestone(500,"","",_NOP8));window.gm.questDef[_quest10.id]=_quest10;}{var _hidden6=function _hidden6(){return window.gm.quests.getMilestoneState("qBlackCandle").id<100;};var _quest11=new Quest("qBlackCandle","Black Candles","Black Candles",_hidden6);_quest11.addMileStone(new QuestMilestone(1,"","",QuestMilestone.NOP,_hidden6));_quest11.addMileStone(new QuestMilestone(100,"","Return 3 black candles to the altar. Maybe they are just stored away in a chest or so.",QuestMilestone.NOP,_hidden6));_quest11.addMileStone(new QuestMilestone(200,"","You returned with the candles.",QuestMilestone.DONE,_hidden6));window.gm.questDef[_quest11.id]=_quest11;}{var _hidden7=function _hidden7(){return window.gm.quests.getMilestoneState("qDoorControl").id<100;};var _quest12=new Quest("qDoorControl","qDoorControl","qDoorControl",_hidden7);_quest12.addMileStone(new QuestMilestone(1,"","",QuestMilestone.NOP,_hidden7));_quest12.addMileStone(new QuestMilestone(100,"","There is a room around here with some levers to open the gates. Find it and open the gate to east of here.",QuestMilestone.NOP,_hidden7));_quest12.addMileStone(new QuestMilestone(200,"","You opened the gate with the lever.",QuestMilestone.DONE,_hidden7));window.gm.questDef[_quest12.id]=_quest12;}{var _id4='qSlimeRancher',_hidden8=function _hidden8(){return window.gm.quests.getMilestoneState(_id4).id<100;};var _quest13=new Quest(_id4,_id4,_id4,_hidden8);_quest13.addMileStone(new QuestMilestone(1,"","",QuestMilestone.NOP,_hidden8));_quest13.addMileStone(new QuestMilestone(100,"","Aquire some of those slime-cores.",QuestMilestone.NOP,_hidden8));_quest13.addMileStone(new QuestMilestone(200,"","Donated some slime.",QuestMilestone.DONE,_hidden8));window.gm.questDef[_quest13.id]=_quest13;}{var _id5='qPagehunter',_hidden9=function _hidden9(){return window.gm.quests.getMilestoneState(_id5).id<100;};var _quest14=new Quest(_id5,_id5,_id5,_hidden9);_quest14.addMileStone(new QuestMilestone(1,"","",QuestMilestone.NOP,_hidden9));_quest14.addMileStone(new QuestMilestone(100,"","Return with 2 pages from the book Igneum.",QuestMilestone.NOP,_hidden9));_quest14.addMileStone(new QuestMilestone(200,"","Another page needs to be found. A imp in the ",QuestMilestone.NOP,_hidden9));_quest14.addMileStone(new QuestMilestone(500,"","The missing pages were returned.",QuestMilestone.DONE,_hidden9));window.gm.questDef[_quest14.id]=_quest14;}{// 
var _NOP9=function _NOP9(){return 0;};var _hidden10=function _hidden10(){return window.gm.quests.getMilestoneState("qBondageKink").id<100;};var _quest15=new Quest("qBondageKink","qBondageKink","qBondageKink",_hidden10);_quest15.addMileStone(new QuestMilestone(1,"","qBondageKink",_NOP9,_hidden10));_quest15.addMileStone(new QuestMilestone(100,"","You got some collar on your neck. Find someone that can check on that.",_NOP9,_hidden10));_quest15.addMileStone(new QuestMilestone(200,"","The alchemist suggested to search for help in the next town. The road along the bridge should lead there.",_NOP9,_hidden10));_quest15.addMileStone(new QuestMilestone(300,"","You found the bridge on your route blocked by a bully. Get rid of him.",_NOP9,_hidden10));_quest15.addMileStone(new QuestMilestone(400,"","Find your way past the bridge to the town.",_NOP9,_hidden10));_quest15.addMileStone(new QuestMilestone(500,"","...",_NOP9,_hidden10));window.gm.questDef[_quest15.id]=_quest15;}{var _NOP10=function _NOP10(){return 0;};var _hidden11=function _hidden11(){return window.gm.quests.getMilestoneState("qBeastKink").id<100;};var _quest16=new Quest("qBeastKink","BeastKink","Humans are fun to fool around with. But how about beasts.",_hidden11);_quest16.addMileStone(new QuestMilestone(1,"","Beasts have sex too.",_NOP10,_hidden11));_quest16.addMileStone(new QuestMilestone(400,"","SEEING is BELIEVING. Catch someone having intercourse with animal.",_NOP10,_hidden11));_quest16.addMileStone(new QuestMilestone(500,"","Find some infos about mating habits of dogs.",_NOP10,_hidden11));_quest16.addMileStone(new QuestMilestone(600,"","Maybe you can find a dog or other canine and play with him.",_NOP10));window.gm.questDef[_quest16.id]=_quest16;}//Pitfight task
/*{   
    let NOP=(function(){ return (0)});
    let id='qFindCursed', hidden = (function(){return(window.gm.quests.getMilestoneState(id).id<100);});
    let quest = new Quest(id,id,id,hidden );
    quest.addMileStone(new QuestMilestone(1,"","",NOP,hidden));
    quest.addMileStone(new QuestMilestone(100,"","Find some cursed gear",NOP,hidden));
    quest.addMileStone(new QuestMilestone(200,"","Congrats. You got cursed gear.",NOP,hidden));
    window.gm.questDef[quest.id]= quest;
}{   
    let NOP=(function(){ return (0)});
    let id='qGetPierced', hidden = (function(){return(window.gm.quests.getMilestoneState(id).id<100);});
    let quest = new Quest(id,id,id,hidden );
    quest.addMileStone(new QuestMilestone(1,"","",NOP,hidden));
    quest.addMileStone(new QuestMilestone(100,"","Get pierced",NOP,hidden));
    quest.addMileStone(new QuestMilestone(200,"","Congrats. You got pierced.",NOP,hidden));
    window.gm.questDef[quest.id]= quest;
}*/"use strict";window.gm.jobs=window.gm.jobs||{};// global definition of repeatable tasks
/*
passage linked to the task
time-schedule; 
used resources; time and energy used
hidden; job is hidden in schedule
disable; job is displayed in schedule but unavailable
critical; indicates that if not done on time there is punishment (just shows the indicator in the sidebar)
onAddTime-CB is called when time passes; can be used to check if task was done on time
 */var Job=/*#__PURE__*/function(){function Job(id,name,descr){_classCallCheck(this,Job);this.id=id,this.name=name;this.descr=descr,this.reqEnergy=0,this.reqTime=0,this.startTimeMin=0,this.startTimeMax=0,this.DoW=[],this.onAddTimeCB=null;}_createClass(Job,[{key:"onAddTime",value:function onAddTime(){}},{key:"isDisabled",value:function isDisabled(){return false;}},{key:"disabledReason",value:function disabledReason(){return"";}},{key:"isHidden",value:function isHidden(){return false;}}]);return Job;}();{var job;job=new Job("Campus","get to the uni","You have to at least attend some of the lectures to keep up with the studys.");job.reqEnergy=5,job.reqTime=15,job.startTimeMin=700,job.startTimeMax=1100,job.DoW=[1,2,3,4,5];window.gm.jobs[job.id]=job;job=new Job("Harcon_work","work at Hacorn facility","do a shift at Harcon logistic dept.");job.reqEnergy=10,job.reqTime=20,job.startTimeMin=800,job.startTimeMax=930,job.DoW=[1,3,5];job.isHidden=function(){return!window.gm.quests.hasActiveQuest("qFindAJob",200);};window.gm.jobs[job.id]=job;job=new Job("Dogsit_NewCall","Dog-sitting","You could call the dogsit agency if they have a new job.");job.reqEnergy=20,job.reqTime=120,job.startTimeMin=900,job.startTimeMax=1300,job.DoW=[2,3,4];job.isHidden=function(){return true;};window.gm.jobs[job.id]=job;job=new Job("Home_Study","Studying","Do some studying for your graduation.");job.reqEnergy=20,job.reqTime=120,job.startTimeMin=700,job.startTimeMax=1800,job.DoW=[1,2,3,4,5,6,7];job.isDisabled=function(){return true;};job.disabledReason=function(){return"You are not in the mood to waste your time with books.";};window.gm.jobs[job.id]=job;}//todo UNUSED
/**
     * standfaceback
     * standfaceface
     * doggystyle
     * doggystyle3some
     * missionary|mf
     * cowgirl|fm
     * spoon|mf
     * kneelfaceface
     * 69
     */ /*window.gm.sex.fuck = function(style, setup){
    //style defines number of involved chars and how to interact
    //order of chars defines theire role in position f.e. CharA is giving,CharB is receiving
    //addtional modifiers
    //style = '69|m,m', setup=[{Char:Player},{Char:Carlia}] 
    //m = cock  a=anal f= vagina, o =oral
    let option = style.split('|');
    let genders = option[1].split(',');
    let count =2; //how many partakers expected
    if(option[0]==='doggystyle3some'){

    }
    if(setup.length<count || genders.length<count) throw new Error("requires more parttakers");
    let tools = [];
    let tool;
    for(var i=0;i<count-1;i++){
        if(genders[i]==='m'){
            tool = setup[i].Char.Outfit.getItemId("bPenis");
        } else if (genders[i]==='f'){
            tool = setup[i].Char.Outfit.getItemId("bVulva");
        } else {
            tool = setup[i].Char.Outfit.getItemId("bAnus");
        }
        tools.push(tool);
    }
    //deposit

    
}*/ /**
 * this is a collection of programatic sex-scenes for use after combat defeat/victory
 * It is easier to debug logic in js then in the passage-code
 */window.gm.sex=window.gm.sex||{};/**
 * create and append a button on choice panel
 * @param {*} label 
 * @param {*} foo 
 */window.gm.sex.createButton=function(label,foo){var link;link=document.createElement('a');link.href='javascript:void(0)';link.addEventListener("click",function(){foo();});link.textContent=label;$("div#choice")[0].appendChild(link);};//cleans up choice-list
window.gm.sex.beginScene=function(){for(var i=$("div#choice")[0].childNodes.length-1;i>=0;i--){$("div#choice")[0].removeChild($("div#choice")[0].childNodes[i]);}};//add scenedescription to panel
window.gm.sex.updateScene=function(entry){$("div#panel")[0].appendChild(entry);};/*
* calculates which of the generic scenes can play after a battle
*/ /*window.gm.sex.setupPostBattleScene = function(battleResult,sexsceneCB,extra){
    let s=windows.story.state;
    //s.combat.playerParty  detect scene by available actors?
    let data = {state:0 , battleResul:battleResult, player:s._gm.activePlayer }; //data should not contain objects beause using object.assign!
    data.foes = [];
    for(var n of s.combat.enemyParty)
    {
        data.foes.push(String.toLowerCase(n.id));
    }
    data.foes.sort();

}*/window.gm.sex.wolfOnPlayer=function(data){var foo=window.gm.sex.wolfOnPlayer;//each button-click will call this sm again and switch state
var player=window.gm.player,foe=window.story.state.combat.enemyParty[0];//todo
window.gm.sex.beginScene();var entry=document.createElement('p');var createButton=window.gm.sex.createButton;var newdata={};//need a copy to create different data-values
if(data.state<0){//quit if scene is done
if(data.battleResult==='victory')window.gm.postVictory();//todo flee, submit, defeat
else window.gm.postDefeat();return;}else if(data.state===0){//start-menu
if(data.battleResult==='victory'){if(player.Stats.get('arousal').value>40){entry.textContent="The beast is quite in the mood to fool around. | You need some hard wolfcock right now. ";//detect gender,.. -> available position;
if(player.getPenis()){data.state='plDomPosSelect';if(foe.getVagina()){newdata={},Object.assign(newdata,data);newdata.position='Mount Her';createButton(newdata.position,foo.bind(null,newdata));}}if(foe.getPenis()){data.state='plSubPosSelect';newdata={},Object.assign(newdata,data);newdata.position='Straddle Him';createButton(newdata.position,foo.bind(null,newdata));newdata={},Object.assign(newdata,data);newdata.position='On all 4';createButton(newdata.position,foo.bind(null,newdata));}}else entry.textContent="You have no idea what you could do with this pup.";newdata={},Object.assign(newdata,data);newdata.state=-1;createButton('Walk away',foo.bind(null,newdata));}else{entry.textContent="The creature isnt interested in you.";//Todo
data.state=-1;createButton('Pass out',foo.bind(null,data));}}else if(data.state==='plDomPosSelect'){//player topping
if(data.position==='Mount Her'){entry.textContent="You strip of your gear and crawl up behind her.";}entry.textContent+="Lets see what your option are.";//detect available holes and let select
data.state='plDomHoleSelect';Object.assign(newdata,data);newdata.hole="anal";createButton(newdata.hole,foo.bind(null,newdata));if(foe.getVagina()){newdata={},Object.assign(newdata,data);newdata.hole="vaginal";createButton(newdata.hole,foo.bind(null,newdata));}}else if(data.state==='plSubPosSelect'){//ride foe
if(data.position==='On all 4'){entry.textContent="You strip of your gear and drop down on knees and hands.";}else{entry.textContent="Rolling the big,bad wuff on its back, you climb on top of it, straddeling him with your naked body.";}entry.textContent+="The question now is, which of your holes would you like to get filled?";//detect available holes and let select
data.state='plSubHoleSelect';Object.assign(newdata,data);newdata.hole="anal";createButton(newdata.hole,foo.bind(null,newdata));if(player.getVagina()){newdata={},Object.assign(newdata,data);newdata.hole="vaginal";createButton(newdata.hole,foo.bind(null,newdata));}}else if(data.state==='plDomHoleSelect'){entry.textContent="You press hard into that wolf-bitchs "+data.hole+" hole.";data.state='plDomOrgasm';Object.assign(newdata,data);createButton("Rile her",foo.bind(null,newdata));}else if(data.state==='plDomOrgasm'){entry.textContent="You unload your jizzm into that hot wolf-hole.";if(data.hole==='vaginal'){foe.getVagina().addSperm('wolf',3);}else if(data.hole==='anal'){//todo insert sperm in hole
}data.state=-1;Object.assign(newdata,data);createButton("Next",foo.bind(null,newdata));}else if(data.state==='plSubHoleSelect'){entry.textContent="The wolf mounts you and drills into your "+data.hole+" opening.";// Surprised, you find your comrade has grown a large lump at the base of its cock that now bumps against your entrance.
// to late you notice that his knot is already swelling in your thight orifice. You wouldnt be able to dislodge unless he gets his rocks off.
data.state='plSubOrgasm';Object.assign(newdata,data);createButton("Take it",foo.bind(null,newdata));}else if(data.state==='plSubOrgasm'){entry.textContent="Wolf-jizzm is painting your insides white.";//Unfortunatly, the stud came before you did -- 
if(data.hole==='vaginal'){player.getVagina().addSperm('wolf',3);}else if(data.hole==='anal'){//todo stretch hole with knot
player.getAnus().addSperm('wolf',3);}data.state=-1;Object.assign(newdata,data);createButton("Pass out",foo.bind(null,newdata));}window.gm.sex.updateScene(entry);};window.gm.sex.succubusOnPlayer=function(data){//todo
var foo=window.gm.sex.succubusOnPlayer;var player=window.gm.player;var foe=window.story.state.combat.enemyParty[0];//todo
window.gm.sex.beginScene();var entry=document.createElement('p');var createButton=window.gm.sex.createButton;var newdata={};//need a copy to create different data-values
if(data.state<0){//quit if scene is done
if(data.battleResult==='victory')window.gm.postVictory();else window.gm.postDefeat();return;}else if(data.state===0){//start-menu
if(data.battleResult==='victory'){if(player.Stats.get('arousal').value>40){entry.textContent="How about we get to know each other better?";//detect gender,.. -> available position;
if(player.getPenis()){data.state='plDomPosSelect';newdata={},Object.assign(newdata,data);newdata.position='Mount Her';createButton(newdata.position,foo.bind(null,newdata));}}else entry.textContent="You arent horny enough";newdata={},Object.assign(newdata,data);newdata.state=-1;createButton('Walk away',foo.bind(null,newdata));}else{entry.innerHTML="The succubus strides over to your defeated form.</br> \"Lets see what we have here...\"</br>";if(!player.hasEffect(effLewdMark.name)){data.state='plLewdMark';newdata={},Object.assign(newdata,data);createButton('Next',foo.bind(null,newdata));}else{data.state='plDone';createButton('Next',foo.bind(null,data));}}}else if(data.state==='plLewdMark'){entry.innerHTML="\"Dont worry I not interested in your puny little soul. Instead I have a gift for you...\"</br>";entry.innerHTML+="The strange woman speaks some words and blows a kiss at you.</br> Surprised by some heat developing below your belly button you open your garments to check on that.</br>";entry.innerHTML+="Your skin is imprinted with some purple lines that form an odd heart-shapped tattoo!</br>";data.state="plAcceptLewdMark";Object.assign(newdata,data);createButton("Next",foo.bind(null,newdata));}else if(data.state==='plAcceptLewdMark'){player.Outfit.addItem(new window.gm.ItemsLib["LewdMark"]());entry.innerHTML='<svg height="100px">'+window.gm.images["tattoo_womb_lewdsign"]()+"</svg>";entry.innerHTML+="The lines fade away after some time but you can be sure that whatever magic she marked you with is still there.</br>";data.state=-1;Object.assign(newdata,data);createButton("Pass out",foo.bind(null,newdata));}else if(data.state==='plDone'){entry.innerHTML="She doesnt seem to have any more use of you and walks away.";data.state=-1;Object.assign(newdata,data);createButton("Pass out",foo.bind(null,newdata));}window.gm.sex.updateScene(entry);/**
     * 
     */};window.gm.sex.dryadOnPlayer=function(data){//todo
var foo=window.gm.sex.dryadOnPlayer,createButton=window.gm.sex.createButton;;var player=window.gm.player,foe=window.story.state.combat.enemyParty[0];//todo
window.gm.sex.beginScene();var entry=document.createElement('p');var newdata={};//need a copy to create different data-values
if(data.state<0){//quit if scene is done
if(data.battleResult==='victory')window.gm.postVictory();//todo flee, submit, defeat
else window.gm.postDefeat();return;}else if(data.state===0){//start-menu
if(data.battleResult==='victory'){if(player.Stats.get('arousal').value>40){entry.textContent="How about we get to know each other better?";//detect gender,.. -> available position;
if(player.getPenis()){data.state='plDomPosSelect';if(foe.getVagina()){newdata={},Object.assign(newdata,data);newdata.position='Mount Her';createButton(newdata.position,foo.bind(null,newdata));}}}else entry.textContent="You arent horny enough";newdata={},Object.assign(newdata,data);newdata.state=-1;createButton('Walk away',foo.bind(null,newdata));}else{entry.textContent="She isnt interested in you.";data.state=-1;createButton('Pass out',foo.bind(null,data));}}else if(data.state==='plSubOrgasm'){entry.textContent="Wolf-jizzm is painting your insides white.";//Unfortunatly, the stud came before you did -- 
if(data.hole==='vaginal'){player.getVagina().addSperm('wolf',3);}else if(data.hole==='anal'){//todo insert sperm in hole
}data.state=-1;Object.assign(newdata,data);createButton("Pass out",foo.bind(null,newdata));}window.gm.sex.updateScene(entry);/**
     * dryads are female but their tendrils can be fill you up quite well
     * They produce some kind of sap that is very regenerative but might also make you their slave
     * 
     * Just before the dryad is able to vanish into her tree, you grab er around her waist and pull her away. Her struggles are meek.
     * [Let her go]
     * 
     * [Fondle Breast]
     * 
     * Plunging in her sodden snatch you dont' notice that some vines made her way toward you.
     */};window.gm.sex.lizanOnPlayer=function(data){//todo
//I savenged this from CoC :O
var foo=window.gm.sex.lizanOnPlayer,createButton=window.gm.sex.createButton;;var player=window.gm.player,foe=window.story.state.combat.enemyParty[0];//todo
window.gm.sex.beginScene();var entry=document.createElement('p');var newdata={};//need a copy to create different data-values
if(data.state<0){//quit if scene is done
if(data.battleResult==='victory')window.gm.postVictory();//todo flee, submit, defeat
else window.gm.postDefeat();return;}else if(data.state===0){//start-menu
if(data.battleResult==='victory'){if(player.Stats.get('arousal').value>40){entry.textContent="You wonder what you should do to the lizan.";//detect gender,.. -> available position;
if(player.getVagina()){data.state='plDomPosSelect';if(foe.getPenis()){newdata={},Object.assign(newdata,data);newdata.position='Get your pussy plowed';newdata.yourTool='vagina';newdata.foeTool='penis';createButton(newdata.position,foo.bind(null,newdata));}}if(player.getPenis()){data.state='plDomPosSelect';newdata={},Object.assign(newdata,data);newdata.position='Rail his ass';createButton(newdata.position,foo.bind(null,newdata));}}else entry.textContent="You arent in the mood right now.";newdata={},Object.assign(newdata,data);newdata.state=-1;createButton('Walk away',foo.bind(null,newdata));}else{//defeat
entry.textContent="He isnt interested in you.";//todo
data.state=-1;createButton('Pass out',foo.bind(null,data));}}else if(data.state==='plDomPosSelect'){//player topping
if(data.position==='Get your pussy plowed'){entry.textContent="With a grin you slip off your garments, the lizan doesn’t fight it in the least. In fact as you shove him onto his back he breathes a sigh of relief. Despite your having beaten him he is obviously quite attracted to you.";entry.textContent+="</br>He groans when you grab his twin peckers and inspect them. Each irregularly patterned bump is mirrored on its counterpart, like two sexy phallic twins. They grow hard in your hand. With a grin you look up into his face and watch his sexual attraction war with his lofty morals.He groans when you grab his twin peckers and inspect them. Each irregularly patterned bump is mirrored on its counterpart, like two sexy phallic twins. They grow hard in your hand. With a grin you look up into his face and watch his sexual attraction war with his lofty morals.";entry.textContent+="</br></br>When you straddle him with his lizan dicks pointed up at your [vagina] you look down into his eyes and watch as your body causes his lust to win the war.";//if (player.looseness(true) < 2){
entry.textContent+="</br>With a deep breath you descend, engulfing only one of his purple dicks. The sensation of your [vagina] being spread open by his cock his like an electric wave of tingling ecstasy. Below you the lizan cringes, eyes wide as he feels how tight you are. You revel in the power you have over him. Soon his hands slide onto your hips and he begins thrusting up into your [pussy].";//player.cuntChange(24, true, true, true);
entry.textContent+="</br>You sit upon a living throne of hot flesh. Your lust crazed servant worships your body with his hands and mouth, grinding his cock around inside your [pussy]. You can barely stand the way the large organ swirls around inside you, so deep inside you as it stretches your vaginal walls wide open. Yet you endure the mind numbingly intense sensations because a true monarch would never abdicate [his] throne.";//todo add logic here
//} else if (player.looseness(true) < 4){
//entry.textContent += "</br>With a sigh, you descend, engulfing one of his bumpy purple dicks. The tingling feeling of fullness hits you as one cock slides up into your [vagina] while the other slides against your [asshole]. Below you the lizan cringes, eyes wide as he you slowly ride him. You watch a war of emotions stream across his face. Disbelief rages against desire, pride slowing loses to lust. Soon all the right emotions prove victorious as a decision is made. Two scaled hands slide onto your waist as he begins thrusting up into your [pussy]."
//player.cuntChange(24, true, true, true);
//entry.textContent += "</br>You smile upon your living throne of hot flesh. Your lust crazed servant worships your body with his hands and mouth as he grinds around inside your [pussy]. His lips suck your [chest] one nipple at a time as his hands rub and massage your body. Chest to chest he serves you like the monarch you are."				
//}	else {
//entry.textContent += "</br>With a grin you press both of his lizan cocks together and descend, engulfing them both. Inside you feel blissfully full, your very experienced [vagina] more than able to take the combined girths. Beneath you the lizan’s entire being cringes with disbelief. His breaths are ragged, his voice on edge as he says, “Gods give me strength.” Then the war of emotions begins. His face contorts as duty and pride struggle valiantly against desire. You squeeze his dicks together and the tide turns. His hands slide onto your hips and he thrusts upward, eyes flooded with desire."
//player.cuntChange(48, true, true, true);
//entry.textContent += "</br>You grin in triumph as you sit upon your living throne of hot flesh. Your lust crazed servant worships your body with hand and mouth as he grinds his dual peckers around inside your [pussy]. Eager lips suck your [nipples] one at a time as his hands rub and massage your body. Chest to chest he gets lost in your regal splendor, serving you like the monarch you are.");
//}
}data.state='plDomOrgasm';Object.assign(newdata,data);createButton("FUCK",foo.bind(null,newdata));}else if(data.state==='plDomOrgasm'){entry.textContent="</br>You take control, your hips swirling as you bounce up and down. The mind numbing pleasure of your ride is just what you need. Beneath you the lizan gasps and trembles. He holds on for dear life as you ride him hard.";//if (player.hasCock()) outputText("\n\nThen you feel an unexpected wetness. Looking down you watch your servant open his mouth and lick your [cock] again. The trembling lizan tastes you, kissing your [cockHead] and nibbling at its belly. Then he looks up and kisses you and you taste your [cock] on his lips."
entry.textContent+="</br>His voice comes out in a hoarse groan as he begins to tremble. You’re riding him as hard as you can now, making him babble like a mad man. His arms hold you tightly as he buries his face in your [fullChest]. You keep up the pressure and soon a strangled cry rises from your servant as heat blooms inside of you. The feeling pushes you over the edge and you erupt, flooding his ejaculating cocks with your vaginal fluids. ";//entry.textContent +=(player.hasCock() ? "Meanwhile, your cock is spurting hot seed into your combined chests." : "");      
if(data.yourHole==='vagina'&&data.foeTool==='penis'){player.getVagina().addSperm('lizard',3);}entry.textContent+="</br></br>You leave the passed out lizan where he lies, covered in your combined sexual fluids. You raid his pack and leave.";data.state=-1;Object.assign(newdata,data);createButton("Get on your way",foo.bind(null,newdata));}else if(data.state==='plSubOrgasm'){if(data.yourHole==='vagina'&&data.foeTool==='penis'){player.getVagina().addSperm('lizard',3);}data.state=-1;Object.assign(newdata,data);createButton("Pass out",foo.bind(null,newdata));}window.gm.sex.updateScene(entry);};window.gm.sex.lapineOnPlayer=function(data){//todo
var foo=window.gm.sex.lapineOnPlayer,createButton=window.gm.sex.createButton;;var player=window.gm.player,foe=window.story.state.combat.enemyParty[0];//todo
window.gm.sex.beginScene();var entry=document.createElement('p');var newdata={};//need a copy to create different data-values
if(data.state<0){//quit if scene is done
if(data.battleResult==='victory')window.gm.postVictory();//todo flee, submit, defeat
else window.gm.postDefeat();return;}else if(data.state===0){//start-menu
if(data.battleResult==='victory'){if(player.Stats.get('arousal').value>40){entry.textContent="\'Lets see what we have here\'.";//detect gender,.. -> available position;
if(player.getVagina()){data.state='plDomPosSelect';if(foe.getPenis()){newdata={},Object.assign(newdata,data);newdata.position='Get your pussy plowed';newdata.yourTool='vagina';newdata.foeTool='penis';createButton(newdata.position,foo.bind(null,newdata));}}if(player.getPenis()){data.state='plDomPosSelect';newdata={},Object.assign(newdata,data);newdata.position='Rail her ass';createButton(newdata.position,foo.bind(null,newdata));if(foe.getVagina()){newdata={},Object.assign(newdata,data);newdata.position='Use her snatch';newdata.yourTool='penis';newdata.foeTool='vagina';createButton(newdata.position,foo.bind(null,newdata));}}}else entry.textContent="You arent in the mood right now.";newdata={},Object.assign(newdata,data);newdata.state=-1;createButton('Walk away',foo.bind(null,newdata));}else{//defeat
entry.textContent="She isnt interested in you.";//todo
data.state=-1;createButton('Pass out',foo.bind(null,data));}}else if(data.state==='plDomPosSelect'){//player topping
if(data.position==='Rail her ass'){entry.textContent="TODO bunny stuffing";}else if('Use her snatch'){entry.textContent="TODO stretch her hole";}data.state='plDomOrgasm';Object.assign(newdata,data);createButton("FUCK",foo.bind(null,newdata));}else if(data.state==='plDomOrgasm'){entry.textContent="</br>You take control, your hips swirling as you bounce up and down. The mind numbing pleasure of your ride is just what you need. Beneath you the lizan gasps and trembles. He holds on for dear life as you ride him hard.";//if (player.hasCock()) outputText("\n\nThen you feel an unexpected wetness. Looking down you watch your servant open his mouth and lick your [cock] again. The trembling lizan tastes you, kissing your [cockHead] and nibbling at its belly. Then he looks up and kisses you and you taste your [cock] on his lips."
entry.textContent+="</br>His voice comes out in a hoarse groan as he begins to tremble. You’re riding him as hard as you can now, making him babble like a mad man. His arms hold you tightly as he buries his face in your [fullChest]. You keep up the pressure and soon a strangled cry rises from your servant as heat blooms inside of you. The feeling pushes you over the edge and you erupt, flooding his ejaculating cocks with your vaginal fluids. ";//entry.textContent +=(player.hasCock() ? "Meanwhile, your cock is spurting hot seed into your combined chests." : "");      
if(data.yourHole==='vagina'&&data.foeTool==='penis'){player.getVagina().addSperm('lapine',3);}entry.textContent+="</br></br>Unwrappig yourself from the exhausted bunny, you get ready to leave.";data.state=-1;Object.assign(newdata,data);createButton("Get on your way",foo.bind(null,newdata));}else if(data.state==='plSubOrgasm'){if(data.yourHole==='vagina'&&data.foeTool==='penis'){player.getVagina().addSperm('lapine',3);}data.state=-1;Object.assign(newdata,data);createButton("Pass out",foo.bind(null,newdata));}window.gm.sex.updateScene(entry);};window.gm.sex.growBreast=function(data){//todo
var foo=window.gm.sex.growBreast,createButton=window.gm.sex.createButton;;var player=window.gm.player,postBattle=!!data.battleResult;window.gm.sex.beginScene();var entry=document.createElement('p');var newdata={};//need a copy to create different data-values
if(data.state<0){//quit if scene is done
if(postBattle){if(data.battleResult==='victory')window.gm.postVictory();//todo flee, submit, defeat
else window.gm.postDefeat();}else window.story.show(window.gm.player.location);//outside battle
return;}else if(data.state===0){//start-menu
//if(player.Stats.get('arousal').value>40){
entry.innerHTML="\'My chest itches...\'.";data.state='plDomOrgasm';newdata={},Object.assign(newdata,data);newdata.position='Rub your perky tits';createButton(newdata.position,foo.bind(null,newdata));newdata={},Object.assign(newdata,data);newdata.state=-1;createButton('Just ignore it',foo.bind(null,newdata));}else if(data.state==='plDomOrgasm'){entry.innerHTML="</br></br>Well, you have to live with that...";data.state=-1;Object.assign(newdata,data);createButton("Get on your way",foo.bind(null,newdata));}window.gm.sex.updateScene(entry);};window.gm.sex.femBody=function(data){//todo
var foo=window.gm.sex.femBody,createButton=window.gm.sex.createButton;;var player=window.gm.player,postBattle=!!data.battleResult;var body=player.Outfit.getItemForSlot(window.gm.OutfitSlotLib.bBase);window.gm.sex.beginScene();var entry=document.createElement('p');var newdata={};//need a copy to create different data-values
if(data.state<0){//quit if scene is done
if(postBattle){if(data.battleResult==='victory')window.gm.postVictory();//todo flee, submit, defeat
else window.gm.postDefeat();}else window.story.show(window.gm.player.location);//outside battle
return;}else if(data.state===0){//start-menu
//if(player.Stats.get('arousal').value>40){
entry.innerHTML="Your body tingles. Its not your skin, it is deeper, like the flesh itself is shifting around.</br>";entry.innerHTML+="Using your hand to roam around your body, you find your muscles tense. There is especially some compression around your waist.</br>";data.state='reject';newdata={},Object.assign(newdata,data);createButton('Concentrate to loose the tension',foo.bind(null,newdata));newdata={},Object.assign(newdata,data);newdata.state="accept";createButton('accept the change',foo.bind(null,newdata));}else if(data.state==='reject'){entry.innerHTML="</br></br>Using some of your will to relaxe those muscles, you struggle against your own fleshs knitting.";window.gm.player.Stats.increment("will",-10);window.gm.refreshSidePanel();data.state='finish';newdata={},Object.assign(newdata,data);createButton("Get on your way",foo.bind(null,newdata));}else if(data.state==='accept'){entry.innerHTML="</br></br>You cant fight back against the change - or you dont want to. Just letting it happen you can feel your own flesh remodeling your torso.</br>";entry.innerHTML="</br>The change is only small but just that something like that happened damaged your will (<b>maximum will damaged</b>).</br>";body.data.feminity=Math.min(body.data.feminity+0.1,0.8);var x=window.gm.player.Stats.getModifier("willMax","mutDmg");if(x===null)x={id:'mutDmg',bonus:0};x.bonus-=5;window.gm.player.Stats.addModifier('willMax',x);window.gm.refreshSidePanel();data.state='finish';newdata={},Object.assign(newdata,data);createButton("Get on your way",foo.bind(null,newdata));}else if(data.state==='finish'){entry.innerHTML="</br></br>Well, you have to live with that...";data.state=-1;newdata={},Object.assign(newdata,data);createButton("Get on your way",foo.bind(null,newdata));}window.gm.sex.updateScene(entry);};/**
 * :: HuntressSubmit
"You are a worthy opponent. Lets see if you have some stamina left."
She is stradeling your prone form. Gyrating her hips around, she guides your hard pecker between her wet folds. After she grows tired on teasing you and herself, she plunges dowm, engulfing your rigid member in one smooth stroke.
Riding you like a pro, you have considerable difficulty to not just shoot your load into her.    
"I dare you, if you cum before I do, I will cut your pecker of. "


:: HuntressVictory
Give her her own poison | Grabing some rope you carry with you, you tie the fierce female face first against a tree.
Undo her leathers.

Give her some spanking

Tease her cunt

Ravage her vaginally

"Lets sate that appetite of yours."
...
Take it all in slut. I hope you bear some big soulgems for me when I met you again.
 */ /*
*/"use strict";// add projectspecific shops here
// Todo depending on shop & gamestate, return list of buyables
window.gm.shop.findWaresToBuy=function(shop){var list=[];if(shop==='Mall:GeneralStore'){list=[window.gm.ItemsLib['Lube'](),window.gm.ItemsLib['Battery']()];}else if("Arena:Shop"){list=[window.gm.ItemsLib['HealthPotionSmall'](),window.gm.ItemsLib['HealthPotion'](),window.gm.ItemsLib['SpearWodden'](),window.gm.ItemsLib['DaggerSteel'](),window.gm.ItemsLib['Vaginarium'](),window.gm.ItemsLib['Penilium']()];}var list2=[];for(var _i14=0,_list3=list;_i14<_list3.length;_i14++){var n=_list3[_i14];var cost=window.gm.shop.calculateBuyPrice(n);if(cost){list2.push({item:el,cost:cost});}}window.gm.shop.WaresToBuy=list2;};window.gm.shop.calculateSellPrice=function(item){var cost={id:'Money',count:1,for:0};if(item.id==='Lube')cost.count=item.price,cost.for=4;else if(item.id==='Battery')cost.count=item.price,cost.for=3;else{//there might be items with random id
cost.count=item.price,cost.for=1;}cost.count=Math.ceil(cost.count*0.25);//
if(cost.for===0)cost=null;return cost;};window.gm.shop.calculateBuyPrice=function(item){var cost={id:'Money',count:1,for:0};if(item.id==='Lube')cost.count=item.price,cost.for=4;else if(item.id==='Battery')cost.count=item.price,cost.for=3;else if(item.id==='VoucherIron')cost.count=item.price,cost.for=1;else{//there might be items with random id
cost.count=item.price,cost.for=1;}cost.count=cost.count*2;//todo: special sales price reduction
if(cost.for===0)cost=null;return cost;};"use strict";var SkillInspect=/*#__PURE__*/function(_Skill){_inherits(SkillInspect,_Skill);var _super139=_createSuper(SkillInspect);function SkillInspect(){var _this137;_classCallCheck(this,SkillInspect);_this137=_super139.call(this,"Inspect");_this137.msg='';return _this137;}_createClass(SkillInspect,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SkillInspect",this);}},{key:"targetFilter",value:function targetFilter(targets){return this.targetFilterEnemy(this.targetFilterAlive(targets));}},{key:"previewCast",value:function previewCast(targets){var result=new SkillResult();result.skill=this;result.source=this.caster;result.targets=targets;this.msg='';if(this.isValidTarget(targets)){result.OK=true;this.msg='resistance of ';//window.gm.printBodyDescription(targets[0],true);
var _iterator112=_createForOfIteratorHelper(window.gm.combat.TypesDamage),_step112;try{for(_iterator112.s();!(_step112=_iterator112.n()).done;){var _n7=_step112.value;this.msg+='resist/armor '+_n7.id+' '+targets[0].Stats.getItem('rst_'+_n7.id).value+'% / '+targets[0].Stats.getItem('arm_'+_n7.id).value+'</br>';}}catch(err){_iterator112.e(err);}finally{_iterator112.f();}this.msg+='</br>';for(var _i15=0,_arr3=['agility','charisma','endurance','intelligence','luck','perception','strength'];_i15<_arr3.length;_i15++){var n=_arr3[_i15];this.msg+=n+' '+targets[0].Stats.getItem(n).value+', ';}this.msg+='</br>';//todo display stats dependign on skill
result.msg=this.msg;}return result;}},{key:"getCastDescription",value:function getCastDescription(result){return this.msg;}},{key:"desc",get:function get(){return"Check out your foe.";}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkillInspect,value.data);}}]);return SkillInspect;}(Skill);//execute simple attack with active weapon or claws
var SkillAttack=/*#__PURE__*/function(_Skill2){_inherits(SkillAttack,_Skill2);var _super140=_createSuper(SkillAttack);function SkillAttack(){var _this138;_classCallCheck(this,SkillAttack);_this138=_super140.call(this,"Attack");_this138.msg='';_this138.weapon='';_this138.cost.energy=10;return _this138;}_createClass(SkillAttack,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SkillAttack",this);}},{key:"targetFilter",value:function targetFilter(targets){return this.targetFilterEnemy(this.targetFilterAlive(targets));}},{key:"previewCast",value:function previewCast(targets){var result=new SkillResult();result.skill=this;result.source=this.caster;result.targets=targets;this.msg='';if(this.isValidTarget(targets)){result.OK=true;var _iterator113=_createForOfIteratorHelper(targets),_step113;try{for(_iterator113.s();!(_step113=_iterator113.n()).done;){var target=_step113.value;var attack=this.__estimateAttack(target);var result2=window.gm.combat.calcAttack(this.caster,target,attack);this.msg+=result2.msg;result.effects=result.effects.concat(attack.effects);}}catch(err){_iterator113.e(err);}finally{_iterator113.f();}}return result;}},{key:"__estimateAttack",value:function __estimateAttack(target){var attack=window.gm.combat.defaultAttackData();var lHand=this.caster.Outfit.getItemForSlot(window.gm.OutfitSlotLib.LHand);var rHand=this.caster.Outfit.getItemForSlot(window.gm.OutfitSlotLib.RHand);attack.mod=null;if(rHand&&rHand.attackMod){//get weapon damage info
attack.mod=rHand.attackMod(target);}else if(lHand&&lHand.attackMod){//todo dual wield?
attack.mod=lHand.attackMod(target);}if(attack.mod===null){//if has no weapon get claw damage, mouth damage, ??
rHand=this.caster.Outfit.getItemForSlot(window.gm.OutfitSlotLib.bHands);if(rHand&&rHand.attackMod){attack.mod=rHand.attackMod(target);}}if(attack.mod===null){//fallback??
var mod=new SkillMod();mod.msg='barehanded';mod.onHit=[{target:target,eff:[effDamage.factory(3,'blunt')]}];attack.mod=mod;}return attack;}},{key:"getCastDescription",value:function getCastDescription(result){return this.msg;}},{key:"desc",get:function get(){return"Use weapon or claws to deal damage. "+this.getCost().asText();}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkillAttack,value.data);}}]);return SkillAttack;}(Skill);var SkillStrongHit=/*#__PURE__*/function(_SkillAttack){_inherits(SkillStrongHit,_SkillAttack);var _super141=_createSuper(SkillStrongHit);function SkillStrongHit(){var _this139;_classCallCheck(this,SkillStrongHit);_this139=_super141.call(this);_this139.id=_this139.name='StrongAttack';_this139.msg='';_this139.weapon='';_this139.cost.energy=30,_this139.cost.poise=10;return _this139;}_createClass(SkillStrongHit,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SkillStrongHit",this);}},{key:"previewCast",value:function previewCast(targets){var result=new SkillResult();result.skill=this;result.source=this.caster;result.targets=targets;this.msg='';if(this.isValidTarget(targets)){result.OK=true;var _iterator114=_createForOfIteratorHelper(targets),_step114;try{for(_iterator114.s();!(_step114=_iterator114.n()).done;){var target=_step114.value;var attack=window.gm.combat.defaultAttackData();//get data from weapon
attack.mod=this.parent.parent.Outfit.getItem(this.weapon).attackMod(target);attack.mod.critChance=50,attack.mod.hitChance=70;attack.mod.onHit[0].eff.push(effPoiseDamage.factory(15));//TODO
attack.mod.onCrit[0].eff.push(effPoiseDamage.factory(25));var result2=window.gm.combat.calcAttack(this.caster,target,attack);this.msg+=result2.msg;result.effects=result.effects.concat(attack.effects);}}catch(err){_iterator114.e(err);}finally{_iterator114.f();}}return result;}},{key:"isValidStance",value:function isValidStance(){var res=_get(_getPrototypeOf(SkillStrongHit.prototype),"isValidStance",this).call(this);if(!res.OK)return res;if(!(this.parent.parent.Stance instanceof StanceStanding)){res.OK=false,res.msg='wrong stance';}return res;}},{key:"desc",get:function get(){return"Use "+this.weapon+" offensivly for increased critical chance but overall reduced hit chance. "+this.getCost().asText();}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkillStrongHit,value.data);}}]);return SkillStrongHit;}(SkillAttack);var SkillShoot=/*#__PURE__*/function(_SkillAttack2){_inherits(SkillShoot,_SkillAttack2);var _super142=_createSuper(SkillShoot);function SkillShoot(){var _this140;_classCallCheck(this,SkillShoot);_this140=_super142.call(this);_this140.id=_this140.name='SkillShoot';_this140.msg='';_this140.weapon='';_this140.cost.energy=20,_this140.cost.will=5;//todo ammo cost
return _this140;}_createClass(SkillShoot,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SkillShoot",this);}},{key:"previewCast",value:function previewCast(targets){var result=new SkillResult();result.skill=this;result.source=this.caster;result.targets=targets;this.msg='';if(this.isValidTarget(targets)){result.OK=true;var _iterator115=_createForOfIteratorHelper(targets),_step115;try{for(_iterator115.s();!(_step115=_iterator115.n()).done;){var target=_step115.value;var attack=window.gm.combat.defaultAttackData();//get data from weapon
attack.mod=this.parent.parent.Outfit.getItem(this.weapon).attackMod(target);attack.mod.critChance=5,attack.mod.hitChance=50;var result2=window.gm.combat.calcAttack(this.caster,target,attack);this.msg+=result2.msg;result.effects=result.effects.concat(attack.effects);}}catch(err){_iterator115.e(err);}finally{_iterator115.f();}}return result;}},{key:"desc",get:function get(){return"Use "+this.weapon+" to shoot at someone. "+this.getCost().asText();}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkillShoot,value.data);}}]);return SkillShoot;}(SkillAttack);var SkillUltraKill=/*#__PURE__*/function(_SkillAttack3){_inherits(SkillUltraKill,_SkillAttack3);var _super143=_createSuper(SkillUltraKill);function SkillUltraKill(){var _this141;_classCallCheck(this,SkillUltraKill);_this141=_super143.call(this);_this141.id=_this141.name='UltraKill';_this141.msg='';return _this141;}_createClass(SkillUltraKill,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SkillUltraKill",this);}},{key:"__estimateAttack",value:function __estimateAttack(target){var attack=window.gm.combat.defaultAttackData();attack.mod=new SkillMod();attack.mod.onHit=[{target:target,eff:[effDamage.factory(99999,'blunt')]}];return attack;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkillUltraKill,value.data);}}]);return SkillUltraKill;}(SkillAttack);//execute attack with Face
var SkillBite=/*#__PURE__*/function(_SkillAttack4){_inherits(SkillBite,_SkillAttack4);var _super144=_createSuper(SkillBite);function SkillBite(){var _this142;_classCallCheck(this,SkillBite);_this142=_super144.call(this);_this142.id=_this142.name='Bite';_this142.msg='';_this142.cost.energy=20;return _this142;}_createClass(SkillBite,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SkillBite",this);}},{key:"__estimateAttack",value:function __estimateAttack(target){var attack=window.gm.combat.defaultAttackData();var mouth=this.caster.Outfit.getItemForSlot(window.gm.OutfitSlotLib.bMouth);attack.mod=new SkillMod();if(mouth&&mouth.attackMod){//get teeth damage info
attack.mod=mouth.attackMod(target);}return attack;}},{key:"desc",get:function get(){return"Use your maw to bite the foe. "+this.getCost().asText();}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkillBite,value.data);}}]);return SkillBite;}(SkillAttack);//execute attack with Stinger
var SkillSting=/*#__PURE__*/function(_SkillAttack5){_inherits(SkillSting,_SkillAttack5);var _super145=_createSuper(SkillSting);_createClass(SkillSting,null,[{key:"dataPrototype",value:function dataPrototype(){return{style:''};}},{key:"factory",value:function factory(id){var obj=new SkillSting();obj.setStyle(id);return obj;}}]);function SkillSting(){var _this143;_classCallCheck(this,SkillSting);_this143=_super145.call(this);_this143.id=_this143.name='Sting';_this143.data=SkillSting.dataPrototype();_this143.msg='';_this143.cost.energy=20;return _this143;}_createClass(SkillSting,[{key:"setStyle",value:function setStyle(id){this.data.style=id;switch(id){case'wasp-stinger':this.id=this.name=id;this.data.weapon='bTailBase';this.startDelay=1,this.defCoolDown=3;//todo poison regeneration depends on?
break;default:throw new Error("unknown Stinger-style "+id);}}},{key:"getStyle",value:function getStyle(){return this.data.style;}},{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SkillSting",this);}},{key:"__estimateAttack",value:function __estimateAttack(target){var attack=window.gm.combat.defaultAttackData();var weapon=this.caster.Outfit.getItemForSlot(this.data.weapon);attack.mod=new SkillMod();if(weapon&&weapon.attackMod){//get damage info
attack.mod=weapon.attackMod(target);}return attack;}},{key:"desc",get:function get(){return"Use your "+this.name+" to sting a foe. "+this.getCost().asText();}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkillSting,value.data);}}]);return SkillSting;}(SkillAttack);//slobber your foe
var SkillSlobber=/*#__PURE__*/function(_SkillAttack6){_inherits(SkillSlobber,_SkillAttack6);var _super146=_createSuper(SkillSlobber);_createClass(SkillSlobber,null,[{key:"dataPrototype",value:function dataPrototype(){return{style:''};}},{key:"factory",value:function factory(id){var obj=new SkillSlobber();obj.setStyle(id);return obj;}}]);function SkillSlobber(){var _this144;_classCallCheck(this,SkillSlobber);_this144=_super146.call(this);_this144.id=_this144.name='Slobber';_this144.data=SkillSlobber.dataPrototype();_this144.msg='';_this144.cost.energy=25;return _this144;}_createClass(SkillSlobber,[{key:"setStyle",value:function setStyle(id){this.data.style=id;switch(id){case'slime-slobber':this.id=this.name=id;this.data.weapon='bTailBase';this.startDelay=0,this.defCoolDown=1;break;default:throw new Error("unknown slobber-style "+id);}}},{key:"getStyle",value:function getStyle(){return this.data.style;}},{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SkillSlobber",this);}},{key:"__estimateAttack",value:function __estimateAttack(target){var attack=window.gm.combat.defaultAttackData();var weapon=this.caster.Outfit.getItemForSlot(this.data.weapon);attack.mod=new SkillMod();if(weapon&&weapon.attackMod){//get damage info
attack.mod=weapon.attackMod(target);}return attack;}},{key:"desc",get:function get(){return"Use your "+this.name+" to drool all over your foe. "+this.getCost().asText();}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkillSlobber,value.data);}}]);return SkillSlobber;}(SkillAttack);//execute attack with Feet
var SkillKick=/*#__PURE__*/function(_SkillAttack7){_inherits(SkillKick,_SkillAttack7);var _super147=_createSuper(SkillKick);function SkillKick(){var _this145;_classCallCheck(this,SkillKick);_this145=_super147.call(this);_this145.id=_this145.name='Kick';_this145.msg='';_this145.cost.energy=25;return _this145;}_createClass(SkillKick,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SkillKick",this);}},{key:"__estimateAttack",value:function __estimateAttack(target){var attack=window.gm.combat.defaultAttackData();var feet=this.caster.Outfit.getItemForSlot(window.gm.OutfitSlotLib.bHands);//TODO bFeet
attack.mod=new SkillMod();if(feet&&feet.attackMod){//get feet damage info
attack.mod=feet.attackMod(target);}attack.mod.onHit[0].eff.push(effPoiseDamage.factory(25));//TODO
attack.mod.onCrit[0].eff.push(effPoiseDamage.factory(35));return attack;}},{key:"desc",get:function get(){return"Use your feet kungfu style. "+this.getCost().asText();}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkillKick,value.data);}}]);return SkillKick;}(SkillAttack);var SkillTailWhip=/*#__PURE__*/function(_SkillAttack8){_inherits(SkillTailWhip,_SkillAttack8);var _super148=_createSuper(SkillTailWhip);function SkillTailWhip(){var _this146;_classCallCheck(this,SkillTailWhip);_this146=_super148.call(this);_this146.id=_this146.name='Tailwhip';_this146.msg='';_this146.cost.energy=20;return _this146;}_createClass(SkillTailWhip,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SkillTailWhip",this);}},{key:"__estimateAttack",value:function __estimateAttack(target){var attack=window.gm.combat.defaultAttackData();var tail=this.caster.Outfit.getItemForSlot(window.gm.OutfitSlotLib.bTailBase);attack.mod=new SkillMod();if(tail&&tail.attackMod){//get damage info
attack.mod=tail.attackMod(target);}return attack;}},{key:"desc",get:function get(){return"Use your big tail as a weapon. "+this.getCost().asText();}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkillTailWhip,value.data);}}]);return SkillTailWhip;}(SkillAttack);var SkillFireball=/*#__PURE__*/function(_SkillAttack9){_inherits(SkillFireball,_SkillAttack9);var _super149=_createSuper(SkillFireball);_createClass(SkillFireball,null,[{key:"dataPrototype",value:function dataPrototype(){return{style:''};}},{key:"factory",value:function factory(id){var obj=new SkillFireball();obj.setStyle(id);return obj;}}]);function SkillFireball(){var _this147;_classCallCheck(this,SkillFireball);_this147=_super149.call(this);_this147.id=_this147.name='Fireball';_this147.data=SkillFireball.dataPrototype();_this147.msg='';_this147.cost.energy=20,_this147.cost.will=20;return _this147;}_createClass(SkillFireball,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SkillFireball",this);}},{key:"targetFilter",value:function targetFilter(targets){return this.targetFilterEnemy(this.targetFilterAlive(targets));}},{key:"setStyle",value:function setStyle(id){this.data.style=id;switch(id){case'fireball':case 0:this.id=this.name="SkillFireball";//this.startDelay=0,this.defCoolDown=1;
break;default:throw new Error("unknown "+id);}}},{key:"getStyle",value:function getStyle(){return this.data.style;}},{key:"__estimateAttack",value:function __estimateAttack(target){var attack=window.gm.combat.defaultAttackData();attack.mod=new SkillMod();attack.mod.onHit=[{target:target,eff:[effDamage.factory(5,'fire')]}];attack.mod.onCrit=[{target:target,eff:[effDamage.factory(10,'fire')]}];/*let weapon=this.caster.Outfit.getItemForSlot(this.data.weapon);
        attack.mod= new SkillMod();
        if(weapon && weapon.attackMod){ //get damage info
            attack.mod=weapon.attackMod(target);
        }*/return attack;}},{key:"desc",get:function get(){return"Cast a fireball. "+this.getCost().asText();}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkillFireball,value.data);}}]);return SkillFireball;}(SkillAttack);var SkillSpark=/*#__PURE__*/function(_SkillAttack10){_inherits(SkillSpark,_SkillAttack10);var _super150=_createSuper(SkillSpark);_createClass(SkillSpark,null,[{key:"dataPrototype",value:function dataPrototype(){return{style:''};}},{key:"factory",value:function factory(id){var obj=new SkillSpark();obj.setStyle(id);return obj;}}]);function SkillSpark(){var _this148;_classCallCheck(this,SkillSpark);_this148=_super150.call(this);_this148.id=_this148.name='Spark';_this148.data=SkillSpark.dataPrototype();_this148.msg='';_this148.cost.energy=20,_this148.cost.will=20;return _this148;}_createClass(SkillSpark,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SkillSpark",this);}},{key:"targetFilter",value:function targetFilter(targets){return this.targetFilterEnemy(this.targetFilterAlive(targets));}},{key:"setStyle",value:function setStyle(id){this.data.style=id;switch(id){case'spark':case 0:this.id=this.name="SkillSpark";//this.startDelay=0,this.defCoolDown=1;
break;default:throw new Error("unknown "+id);}}},{key:"getStyle",value:function getStyle(){return this.data.style;}},{key:"__estimateAttack",value:function __estimateAttack(target){var attack=window.gm.combat.defaultAttackData();attack.mod=new SkillMod();attack.mod.onHit=[{target:target,eff:[effDamage.factory(5,'spark')]}];attack.mod.onCrit=[{target:target,eff:[effDamage.factory(10,'spark')]}];return attack;}},{key:"desc",get:function get(){return"Cast a spark. "+this.getCost().asText();}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkillSpark,value.data);}}]);return SkillSpark;}(SkillAttack);var SkillChainLightning=/*#__PURE__*/function(_Skill3){_inherits(SkillChainLightning,_Skill3);var _super151=_createSuper(SkillChainLightning);function SkillChainLightning(){var _this149;_classCallCheck(this,SkillChainLightning);_this149=_super151.call(this,'ChainLightning');_this149.msg='';_this149.cost.energy=20,_this149.cost.will=10;return _this149;}_createClass(SkillChainLightning,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SkillChainLightning",this);}},{key:"targetFilter",value:function targetFilter(targets){return this.targetFilterEnemy(this.targetFilterAlive(targets));}},{key:"previewCast",value:function previewCast(targets){var result=new SkillResult();result.skill=this;result.source=this.caster;result.targets=targets;this.msg='';if(this.isValidTarget(targets)){result.OK=true;var target=targets[0];var attack=window.gm.combat.defaultAttackData();// attack.effects.push(effDamage.factory(15,'spark'))
//calc hit-chance
//cause spark-dmg
//chance to hit secondary target
var secTarget=window.story.state.combat.playerParty.concat(window.story.state.combat.enemyParty);secTarget=this.targetFilterEnemy(this.targetFilterAlive(secTarget));var secTarget2=[];while(secTarget.length>_i){var target2=secTarget.pop()[0];//[[mob1]]
if(target2!==target){secTarget2.push(target2);}if(secTarget2.length>=2)break;}//spark-dmg to secondary target
var result2=window.gm.combat.calcAttack(this.caster,target,attack);this.msg+=result2.msg;result.effects=result.effects.concat(attack.effects);}return result;}},{key:"getCastDescription",value:function getCastDescription(result){return this.msg;}},{key:"desc",get:function get(){return"Throw some sparks at your foes.";}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkillChainLightning,value.data);}}]);return SkillChainLightning;}(Skill);var SkillTease=/*#__PURE__*/function(_Skill4){_inherits(SkillTease,_Skill4);var _super152=_createSuper(SkillTease);function SkillTease(){var _this150;_classCallCheck(this,SkillTease);_this150=_super152.call(this,"Tease");_this150.msg='',_this150.style=0;_this150.cost.energy=15;return _this150;}_createClass(SkillTease,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SkillTease",this);}},{key:"targetFilter",value:function targetFilter(targets){return this.targetFilterEnemy(this.targetFilterAlive(targets));}},{key:"previewCast",value:function previewCast(targets){var result=new SkillResult();result.skill=this;result.source=this.caster;result.targets=targets;this.msg='';var fconv=window.gm.util.descFixer(this.parent.parent),_tmp='';if(this.isValidTarget(targets)){result.OK=true;var dmg=5*(1+this.style/5);//teaseproficiency +20%/level
//tease depends on clothing slutiness/nudeness,own arousal
var lewds=this.caster.Outfit.getLewdness();if(this.parent.parent.Stats.getItem('arousal').value>40)dmg*=1.5;//dmg*=Math.max(0,0.5+this.level*0.15);
this.msg=fconv('Shaking $[my]$ hips, $[I]$ $[try]$ to arouse the audience.');//todo
var _iterator116=_createForOfIteratorHelper(targets),_step116;try{for(_iterator116.s();!(_step116=_iterator116.n()).done;){var target=_step116.value;var attack=window.gm.combat.defaultAttackData();attack.mod=new SkillMod();_tmp=fconv(target.name+" gets aroused by $[my]$ lewd display. ");attack.mod.onHit=[{target:target,eff:[effTeaseDamage.factory(dmg,'slut',lewds,_tmp)]}];attack.mod.onCrit=[{target:target,eff:[effTeaseDamage.factory(dmg*2,'slut',lewds,_tmp)]}];var result2=window.gm.combat.calcTeaseAttack(this.caster,target,attack);this.msg+=result2.msg;result.effects=result.effects.concat(attack.effects);}}catch(err){_iterator116.e(err);}finally{_iterator116.f();}}return result;}},{key:"getCastDescription",value:function getCastDescription(result){return this.msg;}},{key:"style",set:function set(style){//skilllevel
this._style=style;},get:function get(){return this._style;}},{key:"desc",get:function get(){var msg="Tease Lv"+this.style;return msg;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkillTease,value.data);}}]);return SkillTease;}(Skill);var SkillLustMagic=/*#__PURE__*/function(_Skill5){_inherits(SkillLustMagic,_Skill5);var _super153=_createSuper(SkillLustMagic);_createClass(SkillLustMagic,null,[{key:"factory",value:function factory(){var coolDown=arguments.length>0&&arguments[0]!==undefined?arguments[0]:3;var sk=new SkillLustMagic();sk.startDelay=2,sk.defCoolDown=coolDown;return sk;}}]);function SkillLustMagic(){var _this151;_classCallCheck(this,SkillLustMagic);_this151=_super153.call(this,"LustMagic");_this151.msg='',_this151.style=0;_this151.cost.energy=15;return _this151;}_createClass(SkillLustMagic,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SkillLustMagic",this);}},{key:"targetFilter",value:function targetFilter(targets){return this.targetFilterEnemy(this.targetFilterAlive(targets));}},{key:"previewCast",value:function previewCast(targets){var result=new SkillResult();result.skill=this;result.source=this.caster;result.targets=targets;this.msg='';var fconv=window.gm.util.descFixer(this.parent.parent),_tmp='';if(this.isValidTarget(targets)){result.OK=true;var dmg=5*(1+this.style/5);//teaseproficiency +20%/level
this.msg=fconv('$[I]$ $[make]$ a sudden arcane gesture.');//todo
var _iterator117=_createForOfIteratorHelper(targets),_step117;try{for(_iterator117.s();!(_step117=_iterator117.n()).done;){var target=_step117.value;var attack=window.gm.combat.defaultAttackData();var lewds={slut:0};//ignore outfit 
attack.mod=new SkillMod();_tmp=fconv(target.name+" $[feel]$ strangely warm. ");attack.mod.onHit=[{target:target,eff:[effTeaseDamage.factory(dmg,'slut',lewds,_tmp)]}];attack.mod.onCrit=[{target:target,eff:[effTeaseDamage.factory(dmg*2,'slut',lewds,_tmp)]}];var result2=window.gm.combat.calcTeaseAttack(this.caster,target,attack);this.msg+=result2.msg;result.effects=result.effects.concat(attack.effects);}}catch(err){_iterator117.e(err);}finally{_iterator117.f();}}return result;}},{key:"getCastDescription",value:function getCastDescription(result){return this.msg;}},{key:"style",set:function set(style){//skilllevel
this._style=style;},get:function get(){return this._style;}},{key:"desc",get:function get(){var msg="LustMagic Lv"+this.style;return msg;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkillLustMagic,value.data);}}]);return SkillLustMagic;}(Skill);var SkillStun=/*#__PURE__*/function(_Skill6){_inherits(SkillStun,_Skill6);var _super154=_createSuper(SkillStun);//execute stun attack
function SkillStun(){var _this152;_classCallCheck(this,SkillStun);_this152=_super154.call(this,"Stun");_this152.cost.energy=25;return _this152;}_createClass(SkillStun,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SkillStun",this);}},{key:"targetFilter",value:function targetFilter(targets){var possibletarget=this.targetFilterFighting(this.targetFilterEnemy(targets));//[[mole1],[mole2]]
var n,multi=[];multi.name="all";var _iterator118=_createForOfIteratorHelper(possibletarget),_step118;try{for(_iterator118.s();!(_step118=_iterator118.n()).done;){var n=_step118.value;if(n.length===1)//dont stack multi-targets
multi.push(n[0]);}}catch(err){_iterator118.e(err);}finally{_iterator118.f();}if(multi.length>1)possibletarget.push(multi);//if there is only [[mole]] we dont want [[mole],[mole]]
return possibletarget;//[[mole1],[mole2],[mole1,mole2]]
}},{key:"previewCast",value:function previewCast(targets){var result=new SkillResult();result.skill=this;result.source=this.caster;result.targets=targets;if(this.isValidTarget(targets)){result.OK=true;var _iterator119=_createForOfIteratorHelper(targets),_step119;try{for(_iterator119.s();!(_step119=_iterator119.n()).done;){var target=_step119.value;result.effects.push({target:target,eff:[new effStunned()]});}}catch(err){_iterator119.e(err);}finally{_iterator119.f();}}return result;}},{key:"getCastDescription",value:function getCastDescription(result){//update msg after sucessful cast
return this.caster.name+" stunned "+(result.targets.length>1?result.targets.name:result.targets[0].name)+".";}},{key:"desc",get:function get(){return"A successful stun lowers the foes chance to evade and might disable them for some time. "+this.getCost().asText();}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkillStun,value.data);}}]);return SkillStun;}(Skill);var SkillStandup=/*#__PURE__*/function(_Skill7){_inherits(SkillStandup,_Skill7);var _super155=_createSuper(SkillStandup);function SkillStandup(){var _this153;_classCallCheck(this,SkillStandup);_this153=_super155.call(this,"Standup");_this153.cost.energy=10;return _this153;}_createClass(SkillStandup,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SkillStandup",this);}},{key:"targetFilter",value:function targetFilter(targets){return this.targetFilterSelf(targets);}},{key:"previewCast",value:function previewCast(targets){var result=new SkillResult();result.skill=this;result.source=this.caster;result.targets=targets;if(this.isValidTarget(targets)){result.OK=true;var _iterator120=_createForOfIteratorHelper(targets),_step120;try{for(_iterator120.s();!(_step120=_iterator120.n()).done;){var target=_step120.value;result.effects.push({target:target,eff:[effPoiseDamage.factory(-20),effChangeStance.factory("StanceStanding")]});}}catch(err){_iterator120.e(err);}finally{_iterator120.f();}}return result;}},{key:"getCastDescription",value:function getCastDescription(result){//update msg after sucessful cast
return result.targets[0].name+"Try to stand up.";}},{key:"isValidStance",value:function isValidStance(){var res=_get(_getPrototypeOf(SkillStandup.prototype),"isValidStance",this).call(this);if(!res.OK)return res;if(!(this.parent.parent.Stance instanceof StanceQuadrup)){res.OK=false,res.msg='wrong stance';}return res;}},{key:"desc",get:function get(){return"Standup. "+this.getCost().asText();}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkillStandup,value.data);}}]);return SkillStandup;}(Skill);/**
 * 
 *
 * @class SkillDetermined
 * @extends {Skill}
 */var SkillDetermined=/*#__PURE__*/function(_Skill8){_inherits(SkillDetermined,_Skill8);var _super156=_createSuper(SkillDetermined);_createClass(SkillDetermined,null,[{key:"factory",value:function factory(){var coolDown=arguments.length>0&&arguments[0]!==undefined?arguments[0]:7;var sk=new SkillDetermined();sk.startDelay=sk.defCoolDown=coolDown;return sk;}}]);function SkillDetermined(){var _this154;_classCallCheck(this,SkillDetermined);_this154=_super156.call(this,"Determined");_this154.cost.energy=5;return _this154;}_createClass(SkillDetermined,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SkillDetermined",this);}},{key:"targetFilter",value:function targetFilter(targets){return this.targetFilterSelf(targets);}},{key:"previewCast",value:function previewCast(targets){var result=new SkillResult();result.skill=this;result.source=this.caster;result.targets=targets;if(this.isValidTarget(targets)){result.OK=true;var _iterator121=_createForOfIteratorHelper(targets),_step121;try{for(_iterator121.s();!(_step121=_iterator121.n()).done;){var target=_step121.value;result.effects.push({target:target,eff:[new effDetermined.factory(10,10,25,4)]});}}catch(err){_iterator121.e(err);}finally{_iterator121.f();}}return result;}},{key:"getCastDescription",value:function getCastDescription(result){//update msg after sucessful cast
return this.caster.name+" stunned "+(result.targets.length>1?result.targets.name:result.targets[0].name)+".";}},{key:"desc",get:function get(){return"Increases recovery of will and energy for some turns. Long cooldown. "+this.getCost().asText();}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkillDetermined,value.data);}}]);return SkillDetermined;}(Skill);var SkillPoisonCloud=/*#__PURE__*/function(_Skill9){_inherits(SkillPoisonCloud,_Skill9);var _super157=_createSuper(SkillPoisonCloud);function SkillPoisonCloud(){var _this155;_classCallCheck(this,SkillPoisonCloud);_this155=_super157.call(this,"PoisonCloud");_this155.cost.energy=20;_this155.amount=4;return _this155;}_createClass(SkillPoisonCloud,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SkillPoisonCloud",this);}},{key:"targetFilter",value:function targetFilter(targets){return this.targetFilterFighting(this.targetFilterEnemy(targets));}},{key:"previewCast",value:function previewCast(targets){var result=new SkillResult();result.skill=this;result.source=this.caster;result.targets=targets;//if(this.isValidTarget(targets)){
result.OK=true;var _iterator122=_createForOfIteratorHelper(targets),_step122;try{for(_iterator122.s();!(_step122=_iterator122.n()).done;){var target=_step122.value;var attack=window.gm.combat.defaultAttackData();attack.mod=new SkillMod();//todo blok damage if airfilter
attack.mod.onHit=[{target:target,eff:[effDamage.factory(this.amount,'poison')]}];var result2=window.gm.combat.calcAttack(this.caster,target,attack);this.msg+=result2.msg;result.effects=result.effects.concat(attack.effects);}//}
}catch(err){_iterator122.e(err);}finally{_iterator122.f();}return result;}},{key:"getCastDescription",value:function getCastDescription(result){return this.caster.name+" puffs out a poisonous cloud that is affecting all around.";}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkillPoisonCloud,value.data);}}]);return SkillPoisonCloud;}(Skill);var SkillHeal=/*#__PURE__*/function(_Skill10){_inherits(SkillHeal,_Skill10);var _super158=_createSuper(SkillHeal);function SkillHeal(){var _this156;_classCallCheck(this,SkillHeal);_this156=_super158.call(this,"Heal");_this156.cost.will=25;return _this156;}_createClass(SkillHeal,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SkillHeal",this);}},{key:"targetFilter",value:function targetFilter(targets){return this.targetFilterAlly(this.targetFilterAlive(targets));}},{key:"previewCast",value:function previewCast(targets){var result=new SkillResult();result.skill=this;result.source=this.caster;result.targets=targets;if(this.isValidTarget(targets)){result.OK=true;var _iterator123=_createForOfIteratorHelper(targets),_step123;try{for(_iterator123.s();!(_step123=_iterator123.n()).done;){var target=_step123.value;result.effects.push({target:target,eff:[effHeal.factory(15)]});}}catch(err){_iterator123.e(err);}finally{_iterator123.f();}}return result;}},{key:"desc",get:function get(){return"Restore some health. "+this.getCost().asText();}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkillHeal,value.data);}}]);return SkillHeal;}(Skill);var SkillFlee=/*#__PURE__*/function(_Skill11){_inherits(SkillFlee,_Skill11);var _super159=_createSuper(SkillFlee);function SkillFlee(){var _this157;_classCallCheck(this,SkillFlee);_this157=_super159.call(this,"Flee");_this157.msg='';_this157.cost.energy=10;_this157.cost.will=10;return _this157;}_createClass(SkillFlee,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SkillFlee",this);}},{key:"targetFilter",value:function targetFilter(targets){return this.targetFilterSelf(targets);}},{key:"isEnabled",value:function isEnabled(){var res=_get(_getPrototypeOf(SkillFlee.prototype),"isEnabled",this).call(this);if(res.OK===false)return res;if(!window.gm.Encounter.enableFlee)return{OK:false,msg:'cant flee from this fight'};return res;}},{key:"previewCast",value:function previewCast(targets){var result=new SkillResult();this.msg='';result.skill=this,result.source=this.caster,result.targets=targets;if(this.isValidTarget(targets)){result.OK=true;var rnd=_.random(1,100);if(rnd>40){//Todo fleeing chance calculation
result.msg+="You escaped the fight.";window.story.state.combat.playerFleeing=true;//just setting the flag, you have to take care of handling!
}else{result.msg+="Your attempts to escape failed.";//result.OK=false;
}this.msg=result.msg;}return result;}},{key:"getCastDescription",value:function getCastDescription(result){return this.msg;}},{key:"desc",get:function get(){return"Try to flee from combat. "+this.getCost().asText();}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkillFlee,value.data);}}]);return SkillFlee;}(Skill);var SkillSubmit=/*#__PURE__*/function(_Skill12){_inherits(SkillSubmit,_Skill12);var _super160=_createSuper(SkillSubmit);function SkillSubmit(){var _this158;_classCallCheck(this,SkillSubmit);_this158=_super160.call(this,"Submit");_this158.msg='';return _this158;}_createClass(SkillSubmit,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SkillSubmit",this);}},{key:"targetFilter",value:function targetFilter(targets){return this.targetFilterSelf(targets);}},{key:"previewCast",value:function previewCast(targets){var result=new SkillResult();this.msg='';result.skill=this,result.source=this.caster,result.targets=targets;if(this.isValidTarget(targets)){result.OK=true;var rnd=_.random(1,100);if(rnd>0){//Todo fleeing chance calculation
//result.msg += "You submit to your foe.";
window.story.state.combat.playerSubmitting=true;//just setting the flag, you have to take care of handling!
}else{result.msg+="Your attempts to submit failed.";//result.OK=false;
}this.msg=result.msg;}return result;}},{key:"getCastDescription",value:function getCastDescription(result){return this.msg;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkillSubmit,value.data);}}]);return SkillSubmit;}(Skill);var SkillGrapple=/*#__PURE__*/function(_Skill13){_inherits(SkillGrapple,_Skill13);var _super161=_createSuper(SkillGrapple);function SkillGrapple(){var _this159;_classCallCheck(this,SkillGrapple);_this159=_super161.call(this,"Grapple");_this159.msg='';return _this159;}_createClass(SkillGrapple,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SkillGrapple",this);}},{key:"targetFilter",value:function targetFilter(targets){return this.targetFilterEnemy(this.targetFilterAlive(targets));}},{key:"previewCast",value:function previewCast(targets){var result=new SkillResult();this.msg='';result.skill=this;result.source=this.caster;result.targets=targets;if(this.isValidTarget(targets)){result.OK=true;var target=targets[0];var rnd=_.random(0,100);if(rnd>30){//todo chance to grapple depends on?
var x=effGrappled.factory();//target get grappled effect and caster grappling until the grapple is undone
result.effects.push({target:this.caster,eff:[x.sourceEff]});result.effects.push({target:target,eff:[x.targetEff]});}}this.msg=result.msg;return result;}},{key:"getCastDescription",value:function getCastDescription(result){return this.msg;}},{key:"desc",get:function get(){return"Grapple the opponent to restrict its movement.";}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkillGrapple,value.data);}}]);return SkillGrapple;}(Skill);//char attaches itself to target and sucks health
var SkillLeechHealth=/*#__PURE__*/function(_Skill14){_inherits(SkillLeechHealth,_Skill14);var _super162=_createSuper(SkillLeechHealth);function SkillLeechHealth(){var _this160;_classCallCheck(this,SkillLeechHealth);_this160=_super162.call(this,"Leech");_this160.msg='';return _this160;}_createClass(SkillLeechHealth,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SkillLeechHealth",this);}},{key:"targetFilter",value:function targetFilter(targets){return this.targetFilterEnemy(this.targetFilterAlive(targets));}},{key:"previewCast",value:function previewCast(targets){var result=new SkillResult();this.msg='';result.skill=this;result.source=this.caster;result.targets=targets;if(this.isValidTarget(targets)){result.OK=true;var target=targets[0];var rnd=_.random(0,100);if(rnd>30){//todo chance to grapple depends on?
var x=effGrappled.factory();this.__combineGrabAndLeech(x.targetEff,x.sourceEff);result.effects.push({target:this.caster,eff:[x.sourceEff]});//,heal,leeching]
result.effects.push({target:target,eff:[x.targetEff]});//im
}}this.msg=result.msg;return result;}},{key:"__combineGrabAndLeech",value:function __combineGrabAndLeech(grabEff,grapplingEff){grapplingEff.onTurnStart=function(me){var eff=grapplingEff;var _old=eff.onTurnStart.bind(eff);var foo=function foo(){_old();//override  but call orignial fct
eff.parent.parent.Stats.increment('health',5);//todo scale by ??
return{OK:true,msg:''};};return foo;}(this);grabEff.onTurnStart=function(me){var eff=grabEff;var _old=eff.onTurnStart.bind(eff);var foo=function foo(){_old();//override  but call orignial fct
eff.parent.parent.Stats.increment('health',-5);return{OK:true,msg:''};};return foo;}(this);}},{key:"getCastDescription",value:function getCastDescription(result){return this.msg;}},{key:"desc",get:function get(){return"Grapple the opponent and suck the life from him.";}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkillLeechHealth,value.data);}}]);return SkillLeechHealth;}(Skill);//try to ungrapple
var SkillStruggle=/*#__PURE__*/function(_Skill15){_inherits(SkillStruggle,_Skill15);var _super163=_createSuper(SkillStruggle);//todo improves defense
function SkillStruggle(){var _this161;_classCallCheck(this,SkillStruggle);_this161=_super163.call(this,"Struggle");_this161.msg='';return _this161;}_createClass(SkillStruggle,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SkillStruggle",this);}},{key:"targetFilter",value:function targetFilter(targets){return this.targetFilterSelf(targets);}},{key:"isEnabled",value:function isEnabled(){var res=_get(_getPrototypeOf(SkillStruggle.prototype),"isEnabled",this).call(this);if(res.OK===false)return res;if(this.parent.parent.Effects.countItem(effGrappled.name)<=0)return{OK:false,msg:'no need to struggle'};return res;}},{key:"previewCast",value:function previewCast(targets){var result=new SkillResult();this.msg='';result.skill=this;result.source=this.caster;result.targets=targets;if(this.isValidTarget(targets)){result.OK=true;var _iterator124=_createForOfIteratorHelper(targets),_step124;try{for(_iterator124.s();!(_step124=_iterator124.n()).done;){var target=_step124.value;if(target.Effects.countItem(effGrappled.name)>0){var rnd=_.random(0,100);var eff=target.Effects.get(effGrappled.name);result.msg="Attempts to escape the grapple failed.";if(rnd>30){//todo chance to ungrapple increase over time
result.effects.push({target:target,eff:[new effUngrappling(eff)]});result.msg=this.caster.name+" was able to escape from "+eff.source.parent.parent.name+".";}}}}catch(err){_iterator124.e(err);}finally{_iterator124.f();}}this.msg=result.msg;return result;}},{key:"getCastDescription",value:function getCastDescription(result){return this.msg;}},{key:"desc",get:function get(){return"Try to escape a grapple.";}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkillStruggle,value.data);}}]);return SkillStruggle;}(Skill);var SkillGuard=/*#__PURE__*/function(_Skill16){_inherits(SkillGuard,_Skill16);var _super164=_createSuper(SkillGuard);//todo guard improves defense and evade for some rounds (each hit has a chance to reduce duration)
function SkillGuard(){var _this162;_classCallCheck(this,SkillGuard);_this162=_super164.call(this,"Guard");_this162.style=0;return _this162;}_createClass(SkillGuard,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SkillGuard",this);}},{key:"targetFilter",value:function targetFilter(targets){return this.targetFilterSelf(targets);}},{key:"previewCast",value:function previewCast(targets){var result=new SkillResult();result.skill=this;result.source=this.caster;result.targets=targets;result.OK=true;var _iterator125=_createForOfIteratorHelper(targets),_step125;try{for(_iterator125.s();!(_step125=_iterator125.n()).done;){var target=_step125.value;result.effects.push({target:target,//weapResist,eRecover,duration
eff:[effGuard.factory(10*Math.min(5,1+this.style),Math.min(5,this.style*20),this.style+1)]});}}catch(err){_iterator125.e(err);}finally{_iterator125.f();}return result;}},{key:"style",set:function set(style){//skilllevel
this._style=style;//this.id=this.name="Guard Lv"+style;
},get:function get(){return this._style;}},{key:"desc",get:function get(){return"Lv"+this.style+": Boosts your defense.";}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkillGuard,value.data);}}]);return SkillGuard;}(Skill);var SkillProtect=/*#__PURE__*/function(_Skill17){_inherits(SkillProtect,_Skill17);var _super165=_createSuper(SkillProtect);_createClass(SkillProtect,null,[{key:"factory",//todo target will be protected by caster
value:function factory(style){var obj=new SkillProtect();obj.style=style;return obj;}}]);function SkillProtect(){var _this163;_classCallCheck(this,SkillProtect);_this163=_super165.call(this,"Protect");_this163.style=0;return _this163;}_createClass(SkillProtect,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SkillProtect",this);}},{key:"targetFilter",value:function targetFilter(targets){var _target=this.targetFilterNotSelf(this.targetFilterAlly(targets));_target=this.targetFilterEffect(_target,[[{id:'effProtect'}]],true);return _target;}},{key:"previewCast",value:function previewCast(targets){var result=new SkillResult();result.skill=this;result.source=this.caster;result.targets=targets;result.OK=true;var _iterator126=_createForOfIteratorHelper(targets),_step126;try{for(_iterator126.s();!(_step126=_iterator126.n()).done;){var target=_step126.value;result.effects.push({target:target,eff:[effProtect.factory(this.style+1)]});}}catch(err){_iterator126.e(err);}finally{_iterator126.f();}return result;}},{key:"style",set:function set(style){//skilllevel
this._style=style;//this.id=this.name="Guard Lv"+style;
},get:function get(){return this._style;}},{key:"desc",get:function get(){return"Lv"+this.style+": Protect someone with your own live.";}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkillProtect,value.data);}}]);return SkillProtect;}(Skill);//cast light to repell dark
var SkillFairyLight=/*#__PURE__*/function(_Skill18){_inherits(SkillFairyLight,_Skill18);var _super166=_createSuper(SkillFairyLight);function SkillFairyLight(){var _this164;_classCallCheck(this,SkillFairyLight);_this164=_super166.call(this,"FairyLight");_this164.style=0;_this164.cost.will=15;return _this164;}_createClass(SkillFairyLight,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SkillFairyLight",this);}},{key:"targetFilter",value:function targetFilter(targets){var x=this.targetMultiple(this.targetFilterFighting(this.targetFilterEnemy(targets)));if(x.length>1)return[x[x.length-1]];//there should be "all" add end of collection
return x;}},{key:"previewCast",value:function previewCast(targets){var result=new SkillResult();result.skill=this;result.source=this.caster;result.targets=targets;if(this.isValidTarget(targets)){result.OK=true;var _iterator127=_createForOfIteratorHelper(targets),_step127;try{for(_iterator127.s();!(_step127=_iterator127.n()).done;){var target=_step127.value;result.effects.push({target:target,//weapResist,eRecover,duration
eff:[effFairyLight.factory(this.style+1)]});}}catch(err){_iterator127.e(err);}finally{_iterator127.f();}}return result;}},{key:"style",set:function set(style){//skilllevel
this._style=style;//this.id=this.name="Guard Lv"+style;
},get:function get(){return this._style;}},{key:"desc",get:function get(){return"Creates a magic light that weakens or repell creatures of the dark. "+this.getCost().asText();}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkillFairyLight,value.data);}}]);return SkillFairyLight;}(Skill);var SkillFly=/*#__PURE__*/function(_Skill19){_inherits(SkillFly,_Skill19);var _super167=_createSuper(SkillFly);function SkillFly(){var _this165;_classCallCheck(this,SkillFly);_this165=_super167.call(this);_this165.id=_this165.name='Fly';_this165.msg='';_this165.cost.energy=20;return _this165;}_createClass(SkillFly,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SkillFly",this);}},{key:"targetFilter",value:function targetFilter(targets){return this.targetFilterSelf(targets);}},{key:"isActive",value:function isActive(){var res={OK:false,msg:''};res.OK=this.parent.parent.Effects.countItem(effFlying.name)>0;return res;}},{key:"previewCast",//onCombatStart(){} Todo birds start combat flying
value:function previewCast(targets){var result=new SkillResult();result.skill=this;result.source=this.caster;result.targets=targets;if(this.isValidTarget(targets)){result.OK=true;var target=targets[0];result.effects.push({target:target,eff:[new effFlying()]});}return result;}},{key:"getCastDescription",value:function getCastDescription(result){return this.msg;}},{key:"desc",get:function get(){return!this.isActive().OK?"Fly around to increase dodge chance. "+this.getCost().asText():'Stop flying.';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkillFly,value.data);}}]);return SkillFly;}(Skill);var SkillUseItem=/*#__PURE__*/function(_Skill20){_inherits(SkillUseItem,_Skill20);var _super168=_createSuper(SkillUseItem);function SkillUseItem(){var _this166;_classCallCheck(this,SkillUseItem);_this166=_super168.call(this,"UseItem");_this166.item='';_this166.msg='';return _this166;}_createClass(SkillUseItem,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SkillUseItem",this);}},{key:"targetFilter",// first item has to be set
// then when targetFilter is called, forward the filterrequest to the item
// the item has to implement targetFilter and also check if the item is valid for use in combat    
value:function targetFilter(targets){return this.caster.Inv.getItem(this.item).targetFilter(targets,this);}},{key:"previewCast",value:function previewCast(targets){var result=new SkillResult();result.skill=this;result.source=this.caster;result.targets=targets;if(this.isValidTarget(targets)){result.OK=true;this.msg=result.msg=this.caster.Inv.use(this.item,targets).msg;//Todo preview shouldnt call use !
}return result;}},{key:"getCastDescription",value:function getCastDescription(result){return this.msg;}},{key:"item",get:function get(){return this._item;},set:function set(item){this._item=item;this.msg='';}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkillUseItem,value.data);}}]);return SkillUseItem;}(Skill);//calls reinforcement; set item-string before casting to the mob-name to spawn
var SkillCallHelp=/*#__PURE__*/function(_Skill21){_inherits(SkillCallHelp,_Skill21);var _super169=_createSuper(SkillCallHelp);_createClass(SkillCallHelp,null,[{key:"factory",value:function factory(item){var cooldown=arguments.length>1&&arguments[1]!==undefined?arguments[1]:3;var sk=new SkillCallHelp();sk.item=item,sk.id+=item,sk.name+=' '+item;sk.defCoolDown=cooldown;sk.cost.will=25;//todo delay,cost and cooldown      TODO despawn if spawner killed?
return sk;}}]);function SkillCallHelp(){var _this167;_classCallCheck(this,SkillCallHelp);_this167=_super169.call(this,"CallHelp");_this167.item='';return _this167;}_createClass(SkillCallHelp,[{key:"isEnabled",value:function isEnabled(){var res=_get(_getPrototypeOf(SkillCallHelp.prototype),"isEnabled",this).call(this);if(res.OK===false)return res;var _itm=this.parent.parent.Effects.findEffect(effCallHelp.name)[0];if(_itm&&_itm.data.spawns.length>0)return{OK:false,msg:'already active'};return res;}},{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SkillCallHelp",this);}},{key:"targetFilter",value:function targetFilter(targets){return this.targetFilterSelf(targets);}},{key:"previewCast",value:function previewCast(targets){var result=new SkillResult();result.skill=this,result.source=this.caster,result.targets=targets;if(this.isValidTarget(targets)){result.OK=true;var _iterator128=_createForOfIteratorHelper(targets),_step128;try{for(_iterator128.s();!(_step128=_iterator128.n()).done;){var target=_step128.value;var eff=new effCallHelp();eff.configureSpawn(this.item,this.caster.faction);result.effects.push({target:target,eff:[eff]});}}catch(err){_iterator128.e(err);}finally{_iterator128.f();}}return result;}},{key:"getCastDescription",value:function getCastDescription(result){return this.parent.parent.name+" calls some "+this.item+" as reinforcement.";}},{key:"desc",get:function get(){return"Summon "+this.item;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkillCallHelp,value.data);}}]);return SkillCallHelp;}(Skill);//replaces a combatant with a different mob. item is [mob-class], see effTransformSelf
var SkillTransformSelf=/*#__PURE__*/function(_Skill22){_inherits(SkillTransformSelf,_Skill22);var _super170=_createSuper(SkillTransformSelf);_createClass(SkillTransformSelf,null,[{key:"factory",value:function factory(item){var cooldown=arguments.length>1&&arguments[1]!==undefined?arguments[1]:3;var sk=new SkillTransformSelf();sk.item=item,sk.id+=item[0],sk.name+=' '+item[0];sk.cost.will=25;//todo delay and cooldown
return sk;}}]);function SkillTransformSelf(){var _this168;_classCallCheck(this,SkillTransformSelf);_this168=_super170.call(this,"TransformSelf");_this168.item=[''];return _this168;}_createClass(SkillTransformSelf,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("SkillTransformSelf",this);}},{key:"targetFilter",value:function targetFilter(targets){return this.targetFilterSelf(targets);}},{key:"previewCast",value:function previewCast(targets){var result=new SkillResult();result.skill=this,result.source=this.caster,result.targets=targets;if(this.isValidTarget(targets)){result.OK=true;var _iterator129=_createForOfIteratorHelper(targets),_step129;try{for(_iterator129.s();!(_step129=_iterator129.n()).done;){var target=_step129.value;var eff=new effTransformSelf();eff.configureSpawn(this.item);result.effects.push({target:target,eff:[eff]});}}catch(err){_iterator129.e(err);}finally{_iterator129.f();}}return result;}},{key:"getCastDescription",value:function getCastDescription(result){return this.parent.parent.name+" transforms into "+this.item[0]+(this.item.length>1?" and some friends":"")+".";}},{key:"desc",get:function get(){return"Transform into "+this.item[0];}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(SkillTransformSelf,value.data);}}]);return SkillTransformSelf;}(Skill);window.gm.SkillsLib=function(Lib){window.storage.registerConstructor(SkillAttack);window.storage.registerConstructor(SkillBite);window.storage.registerConstructor(SkillCallHelp);window.storage.registerConstructor(SkillDetermined);window.storage.registerConstructor(SkillGrapple);window.storage.registerConstructor(SkillFairyLight);window.storage.registerConstructor(SkillFlee);window.storage.registerConstructor(SkillFireball);window.storage.registerConstructor(SkillSpark);window.storage.registerConstructor(SkillFly);window.storage.registerConstructor(SkillGuard);window.storage.registerConstructor(SkillHeal);window.storage.registerConstructor(SkillInspect);window.storage.registerConstructor(SkillKick);window.storage.registerConstructor(SkillLeechHealth);window.storage.registerConstructor(SkillPoisonCloud);window.storage.registerConstructor(SkillProtect);window.storage.registerConstructor(SkillShoot);window.storage.registerConstructor(SkillSlobber);window.storage.registerConstructor(SkillStrongHit);window.storage.registerConstructor(SkillStun);window.storage.registerConstructor(SkillSubmit);window.storage.registerConstructor(SkillSting);window.storage.registerConstructor(SkillStruggle);window.storage.registerConstructor(SkillTailWhip);window.storage.registerConstructor(SkillLustMagic);window.storage.registerConstructor(SkillTease);window.storage.registerConstructor(SkillUltraKill);window.storage.registerConstructor(SkillUseItem);window.storage.registerConstructor(SkillStandup);//    Lib['SkillAttack'] = function (){ return new SkillAttack();};
return Lib;}(window.gm.SkillsLib||{});/*todo 
//Todo: 
disarm/disrobe  ArmorMelting

Enraged +50%damage -25% armor  consumes energy each turn

Slash: (weapontype) causes slash-damage; chance to cause bleed on critical (on non-constructs/conjuration)

Stoneskin: (passive) if a slash-attack would cause bleed; attackers weapon gets blunted for rest of fight

GolemCrusher: increased blunt-damage against golems

LifeDrain: soul-damage; restores health equal to fraction of damage caused on living

Supraconductor: incoming ice-damage has chance to increase spark-damage output for some turns; but fire-damage has the oposite effect

BladeMace: deals slash or blunt-damage depending which would cause more damage

Charge: Anrempeln des Gegners bringt ihn aus dem Gleichgewicht oder wirft ihn um

ShieldBoost: lädt ein Shield um 50% auf so lange es nicht komplett leer ist, cooldown=8

VampireShield: wenn das Schild unter 30% fällt aber >1% zieht es 5% von gegnerischem Schild ab für 4Turns; 10 turn cooldown aktiviert automatisch

ShieldRestore: wenn das Shield komplett leer ist kann es wiederhergestellt werden 33-75%; cd=99

CoolDownReset: for any ally: if there are skills in cooldown, pick a random one and reset cooldown; cd=20

disarm: cant use primary weapon for some time; cd=99

critical eye: 50% chance einen Schwachpunkt zu erkennen der dann 3 turns effektiv angegriffen werden kann

Leader: an ally using this is marked as a leader; as long as he is ingame, all allys except him receive bonus armor/regeneration/damage
        but if he is defeated, everyone gets mallus; can only be cast once per battle

Swift Drinker / Swift ...: you can, in one turn, drink a potion and then do something else. You can only do one swift action and have to choose it before the other action.
Anger Point	9	Maxes Attack after taking a critical hit.
Aura Break	2	Reduces power of Dark- and Fairy-type moves.
Battle Armor	11	The Pokémon is protected against critical hits.
Berserk	2	Raises Special Attack when HP drops below half.
Big Pecks	14	Protects the Pokémon from Defense-lowering attacks.
Blaze	28	Powers up Fire-type moves in a pinch.
Fluffy	4	Halves damage from contact moves, but doubles damage from Fire-type moves.
Friend Guard	8	Reduces damage done to allies.
Gooey	5	Contact with the Pokémon lowers the attacker's Speed stat.
Heatproof	3	Weakens the power of Fire-type moves.
Immunity	3	Prevents the Pokémon from getting poisoned.
Intimidate	37	Lowers the foe's Attack stat.
Klutz	10	The Pokémon can't use any held items.
Limber	14	The Pokémon is protected from paralysis.
Merciless	2	The Pokémon's attacks become critical hits if the target is poisoned.
Moxie	13	Boosts Attack after knocking out any Pokémon.
Pickpocket	10	Steals an item when hit by another Pokémon.
Poison Heal	3	Restores HP if the Pokémon is poisoned.
Poison Touch	11	May poison targets when a Pokémon makes contact.
Rattled	18	Bug, Ghost or Dark type moves scare it and boost its Speed.
Rivalry	18	Deals more damage to a Pokémon of same gender.
Scrappy	13	Enables moves to hit Ghost-type Pokémon.
Soul-Heart	1	Raises Special Attack when an ally faints.
Telepathy	26	Anticipates an ally's attack and dodges it.
Unnerve	26	Makes the foe nervous and unable to eat Berries.
*/"use strict";/*
 *
 */var Position=//TODO how can this work with multiple chars?
function Position(){_classCallCheck(this,Position);this.other=player;this.facing="away";this.distance="far";};var Stance=/*#__PURE__*/function(){function Stance(){_classCallCheck(this,Stance);this.minStability=0,this.regenStability=0;this.id='Stance';}//_parent will be added dynamical
_createClass(Stance,[{key:"_relinkItems",value:function _relinkItems(parent){this._parent=window.gm.util.refToParent(parent);}},{key:"checkStance",value:function checkStance(){//checks if the stance needs to be switched
return null;}},{key:"onCombatStart",value:function onCombatStart(){}},{key:"onTurnStart",value:function onTurnStart(){}},{key:"updateTime",value:function updateTime(){//let now =window.gm.getTime();
}},{key:"transitFrom",value:function transitFrom(old){//override this for better description, old might be null!
var res={OK:true,msg:''};res.msg=this.parent.name+' is now '+this.desc+'.';return res;}},{key:"parent",get:function get(){return this._parent?this._parent():null;}},{key:"desc",get:function get(){return Stance.name;}}]);return Stance;}();var StanceStanding=/*#__PURE__*/function(_Stance){_inherits(StanceStanding,_Stance);var _super171=_createSuper(StanceStanding);_createClass(StanceStanding,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("StanceStanding",this);}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(StanceStanding,value.data);}}]);function StanceStanding(){var _this169;_classCallCheck(this,StanceStanding);_this169=_super171.call(this);_this169.id='StanceStanding';return _this169;}_createClass(StanceStanding,[{key:"checkStance",value:function checkStance(){var stance=null;if(this.parent.Stats.get('poise').value<30){stance=new StanceQuadrup();}return stance;}},{key:"desc",get:function get(){return'walking normally';}}],[{key:"canTransitTo",value:function canTransitTo(who){//checks if this Stance can be applied to who 
var res={OK:false,msg:''};if(who.Stance.id==="StanceStanding")return res;if(who.Stats.get('poise').value<45){res.msg='not enough poise';return res;}res.OK=true;return res;}/*listPossibleAction(){
        //what can you do in this position?
        let list = [{id:"Dodge", type:"counter",requires:{},data:{}}
            ,{id:"Punch", type:"melee",requires:{},data:{}}]
            return(list);
    }
    listPossibleAbuse(){
        //what can others do to you in this position?
        let list = [{id:"Punch", type:"melee",requires:{},data:{}}
            ,{id:"Kiss", type:"melee",requires:{},data:{}}]
            return(list);
    }*/}]);return StanceStanding;}(Stance);var StanceQuadrup=/*#__PURE__*/function(_Stance2){_inherits(StanceQuadrup,_Stance2);var _super172=_createSuper(StanceQuadrup);_createClass(StanceQuadrup,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("StanceQuadrup",this);}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(StanceQuadrup,value.data);}}]);function StanceQuadrup(){var _this170;_classCallCheck(this,StanceQuadrup);_this170=_super172.call(this);_this170.id='StanceQuadrup';return _this170;}_createClass(StanceQuadrup,[{key:"checkStance",value:function checkStance(){var stance=null;return stance;}},{key:"desc",get:function get(){return'crawling on hands and legs';}}],[{key:"canTransitTo",value:function canTransitTo(who){var res={OK:false,msg:''};if(who.Stance.id==="StanceQuadrup")return res;res.OK=true;return res;}}]);return StanceQuadrup;}(Stance);window.gm.StanceLib=function(Lib){window.storage.registerConstructor(StanceStanding);window.storage.registerConstructor(StanceQuadrup);Lib['StanceStanding']=StanceStanding;Lib['StanceQuadrup']=StanceQuadrup;return Lib;}(window.gm.StanceLib||{});"use strict";//this is special stat used together with Relation-collection
//person is used as id instead of stat-name
var stRelation=/*#__PURE__*/function(_Stat){_inherits(stRelation,_Stat);var _super173=_createSuper(stRelation);_createClass(stRelation,null,[{key:"setup",value:function setup(context,base,max,person){//todo Max-Limit
var _stat=new stRelation();var _n=_stat.data;_n.id=person+"_Max",_n.base=max,_n.value=max,_n.limits=[{max:999,min:-999}];context.addItem(_stat);_stat=new stRelation();_n=_stat.data;_n.id=person+"_Min",_n.base=0,_n.value=0,_n.limits=[{max:999,min:-999}];context.addItem(_stat);_stat=new stRelation();_n=_stat.data;_n.id=person,_n.base=base,_n.value=base,_n.limits=[{max:person+"_Max",min:person+"_Min"}];context.addItem(_stat);_stat.Calc();}}]);function stRelation(){_classCallCheck(this,stRelation);return _super173.call(this);}_createClass(stRelation,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("stRelation",this);}},{key:"formatMsgStatChange",value:function formatMsgStatChange(attr,_new,_old){if(_new-_old>0){return'<statup>Your relation to '+attr.id+" improved by "+(_new-_old).toFixed(1).toString()+"</statup>";}else if(_new-_old<0){return'<statdown>Your relation to '+attr.id+" worsend by "+(_new-_old).toFixed(1).toString()+"</statdown>";}else{return'Your relation to '+attr.id+" wasnt affected at all by your behaviour.</br>";}}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(stRelation,value.data);}}]);return stRelation;}(Stat);//generic class for resistance to damage like blunt, fire, poison,...
// Resistance is modified by effects (applied by equipment/perks/items) and stats
// 0 = no bonus resistance; -20 = 20% weaker ; capped at +-100% ?
var stResistance=/*#__PURE__*/function(_Stat2){_inherits(stResistance,_Stat2);var _super174=_createSuper(stResistance);_createClass(stResistance,null,[{key:"setup",value:function setup(context,base,kind){var _stat=new stResistance();var _n=_stat.data;_n.id="rst_"+kind,_n.base=base,_n.value=base,_n.limits=[{max:100,min:-100}];context.addItem(_stat);_stat.Calc();}}]);function stResistance(){_classCallCheck(this,stResistance);return _super174.call(this);}_createClass(stResistance,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("stResistance",this);}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(stResistance,value.data);}}]);return stResistance;}(Stat);//generic class for armor; 
var stArmor=/*#__PURE__*/function(_Stat3){_inherits(stArmor,_Stat3);var _super175=_createSuper(stArmor);_createClass(stArmor,null,[{key:"setup",value:function setup(context,base,name){var _stat=new stArmor();var _n=_stat.data;_n.id="arm_"+name,_n.base=base,_n.value=base,_n.limits=[{max:999999,min:0}];context.addItem(_stat);_stat.Calc();}}]);function stArmor(){_classCallCheck(this,stArmor);return _super175.call(this);}_createClass(stArmor,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("stArmor",this);}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(stArmor,value.data);}}]);return stArmor;}(Stat);//TODO stBlock  //chances to block physical damage; cant block heavy attacks; after block, chance are halved
//TODO stParry  //chance to parry physical attacks
var stHealth=/*#__PURE__*/function(_Stat4){_inherits(stHealth,_Stat4);var _super176=_createSuper(stHealth);_createClass(stHealth,null,[{key:"setup",value:function setup(context,base,max){/*stHealthMax.setup(context,max);
        stHealthRegen.setup(context,0,100);
        var _stat = new stHealth();
        var _n = _stat.data;
        _n.id='health',_n.base=base, _n.value=base,_n.limits=[{max:'healthMax',min:0}];
        context.addItem(_stat);
        _stat.Calc();*/var stats=Stat.setupStatWithLimitAndRegen('health',{base:base,regen:0,max:max});stats.forEach(function(x){context.addItem(x);}),stats.forEach(function(x){x.Calc();});}}]);function stHealth(){_classCallCheck(this,stHealth);return _super176.call(this);}_createClass(stHealth,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("stHealth",this);}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(stHealth,value.data);}}]);return stHealth;}(Stat);var stHealthRegen=/*#__PURE__*/function(_Stat5){_inherits(stHealthRegen,_Stat5);var _super177=_createSuper(stHealthRegen);_createClass(stHealthRegen,null,[{key:"setup",value:function setup(context,base,max){var _stat=new stHealthRegen();var _n=_stat.data;_n.id='healthRegen',_n.base=base,_n.value=base,_n.limits=[{max:max,min:-1*max}];context.addItem(_stat);_stat.Calc();}}]);function stHealthRegen(){_classCallCheck(this,stHealthRegen);return _super177.call(this);}_createClass(stHealthRegen,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("stHealthRegen",this);}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(stHealthRegen,value.data);}}]);return stHealthRegen;}(Stat);var stEnergy=/*#__PURE__*/function(_Stat6){_inherits(stEnergy,_Stat6);var _super178=_createSuper(stEnergy);_createClass(stEnergy,null,[{key:"setup",//physical reserves
value:function setup(context,base,max){var stats=Stat.setupStatWithLimitAndRegen('energy',{base:base,regen:10,max:max});stats.forEach(function(x){context.addItem(x);}),stats.forEach(function(x){x.Calc();});}}]);function stEnergy(){_classCallCheck(this,stEnergy);return _super178.call(this);}_createClass(stEnergy,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("stEnergy",this);}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(stEnergy,value.data);}}]);return stEnergy;}(Stat);var stWill=/*#__PURE__*/function(_Stat7){_inherits(stWill,_Stat7);var _super179=_createSuper(stWill);_createClass(stWill,null,[{key:"setup",//mental reserves
value:function setup(context,base,max){var stats=Stat.setupStatWithLimitAndRegen('will',{base:base,regen:10,max:max});stats.forEach(function(x){context.addItem(x);}),stats.forEach(function(x){x.Calc();});}}]);function stWill(){_classCallCheck(this,stWill);return _super179.call(this);}_createClass(stWill,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("stWill",this);}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(stWill,value.data);}}]);return stWill;}(Stat);var stPoise=/*#__PURE__*/function(_Stat8){_inherits(stPoise,_Stat8);var _super180=_createSuper(stPoise);_createClass(stPoise,null,[{key:"setup",//stability in combat
value:function setup(context,base,max){var stats=Stat.setupStatWithLimitAndRegen('poise',{base:base,regen:4,max:max});stats.forEach(function(x){context.addItem(x);}),stats.forEach(function(x){x.Calc();});}}]);function stPoise(){_classCallCheck(this,stPoise);return _super180.call(this);}_createClass(stPoise,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("stPoise",this);}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(stPoise,value.data);}}]);return stPoise;}(Stat);var stSatiation=/*#__PURE__*/function(_Stat9){_inherits(stSatiation,_Stat9);var _super181=_createSuper(stSatiation);_createClass(stSatiation,null,[{key:"setup",//low value==starving    
value:function setup(context,base,max){var stats=Stat.setupStatWithLimitAndRegen('satiation',{base:base,regen:-2,max:max});stats.forEach(function(x){context.addItem(x);}),stats.forEach(function(x){x.Calc();});}}]);function stSatiation(){_classCallCheck(this,stSatiation);return _super181.call(this);}_createClass(stSatiation,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("stSatiation",this);}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(stSatiation,value.data);}}]);return stSatiation;}(Stat);var stArousal=/*#__PURE__*/function(_Stat10){_inherits(stArousal,_Stat10);var _super182=_createSuper(stArousal);_createClass(stArousal,null,[{key:"setup",value:function setup(context,base,max){var stats=Stat.setupStatWithLimitAndRegen('arousal',{base:base,regen:-1,max:max,min:0});stats.forEach(function(x){context.addItem(x);}),stats.forEach(function(x){x.Calc();});}}]);function stArousal(){_classCallCheck(this,stArousal);return _super182.call(this);}_createClass(stArousal,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("stArousal",this);}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(stArousal,value.data);}}]);return stArousal;}(Stat);////    Base-Stats ///////////////////////////////////////////////
var stAgility=/*#__PURE__*/function(_Stat11){_inherits(stAgility,_Stat11);var _super183=_createSuper(stAgility);_createClass(stAgility,null,[{key:"setup",// core attribute
value:function setup(context,base,max){var _stat=new stAgility();var _n=_stat.data;_n.id='agility',_n.base=base,_n.value=base,_n.limits=[{max:999,min:0}];context.addItem(_stat);_stat.Calc();}}]);function stAgility(){_classCallCheck(this,stAgility);return _super183.call(this);}_createClass(stAgility,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("stAgility",this);}},{key:"updateModifier",value:function updateModifier(){this.parent.addModifier('energyMax',{id:'agility',bonus:this.parent.get('agility').value*1.5});}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(stAgility,value.data);}}]);return stAgility;}(Stat);var stPerception=/*#__PURE__*/function(_Stat12){_inherits(stPerception,_Stat12);var _super184=_createSuper(stPerception);_createClass(stPerception,null,[{key:"setup",// core attribute
value:function setup(context,base,max){var _stat=new stPerception();var _n=_stat.data;_n.id='perception',_n.base=base,_n.value=base,_n.limits=[{max:999,min:0}];context.addItem(_stat);_stat.Calc();}}]);function stPerception(){_classCallCheck(this,stPerception);return _super184.call(this);}_createClass(stPerception,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("stPerception",this);}},{key:"updateModifier",value:function updateModifier(){this.parent.addModifier('willMax',{id:'perception',bonus:this.parent.get('perception').value*1.5});}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(stPerception,value.data);}}]);return stPerception;}(Stat);var stLuck=/*#__PURE__*/function(_Stat13){_inherits(stLuck,_Stat13);var _super185=_createSuper(stLuck);_createClass(stLuck,null,[{key:"setup",// core attribute
value:function setup(context,base,max){var _stat=new stLuck();var _n=_stat.data;_n.id='luck',_n.base=base,_n.value=base,_n.limits=[{max:999,min:0}];context.addItem(_stat);_stat.Calc();}}]);function stLuck(){_classCallCheck(this,stLuck);return _super185.call(this);}_createClass(stLuck,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("stLuck",this);}},{key:"updateModifier",value:function updateModifier(){}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(stLuck,value.data);}}]);return stLuck;}(Stat);var stCharisma=/*#__PURE__*/function(_Stat14){_inherits(stCharisma,_Stat14);var _super186=_createSuper(stCharisma);_createClass(stCharisma,null,[{key:"setup",// core attribute
value:function setup(context,base,max){var _stat=new stCharisma();var _n=_stat.data;_n.id='charisma',_n.base=base,_n.value=base,_n.limits=[{max:999,min:0}];context.addItem(_stat);_stat.Calc();}}]);function stCharisma(){_classCallCheck(this,stCharisma);return _super186.call(this);}_createClass(stCharisma,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("stCharisma",this);}},{key:"updateModifier",value:function updateModifier(){this.parent.addModifier('energyMax',{id:'charisma',bonus:this.parent.get('charisma').value*1.5});}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(stCharisma,value.data);}}]);return stCharisma;}(Stat);var stIntelligence=/*#__PURE__*/function(_Stat15){_inherits(stIntelligence,_Stat15);var _super187=_createSuper(stIntelligence);_createClass(stIntelligence,null,[{key:"setup",// core attribute
value:function setup(context,base,max){var _stat=new stIntelligence();var _n=_stat.data;_n.id='intelligence',_n.base=base,_n.value=base,_n.limits=[{max:999,min:0}];context.addItem(_stat);_stat.Calc();}}]);function stIntelligence(){_classCallCheck(this,stIntelligence);return _super187.call(this);}_createClass(stIntelligence,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("stIntelligence",this);}},{key:"updateModifier",value:function updateModifier(){this.parent.addModifier('willMax',{id:'intelligence',bonus:this.parent.get('intelligence').value*1.5});}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(stIntelligence,value.data);}}]);return stIntelligence;}(Stat);var stStrength=/*#__PURE__*/function(_Stat16){_inherits(stStrength,_Stat16);var _super188=_createSuper(stStrength);_createClass(stStrength,null,[{key:"setup",// core attribute
value:function setup(context,base,max){var _stat=new stStrength();var _n=_stat.data;_n.id='strength',_n.base=base,_n.value=base,_n.modifys=[{id:'healthMax'}];context.addItem(_stat);_stat.Calc();}}]);function stStrength(){_classCallCheck(this,stStrength);return _super188.call(this);}_createClass(stStrength,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("stStrength",this);}},{key:"updateModifier",value:function updateModifier(){this.parent.addModifier('healthMax',{id:'strength',bonus:this.parent.get('strength').value*1.5});//this.parent.addModifier('pAttack',{id:'strength', bonus:Math.floor(this.parent.get('strength').value/4)});
}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(stStrength,value.data);}}]);return stStrength;}(Stat);var stEndurance=/*#__PURE__*/function(_Stat17){_inherits(stEndurance,_Stat17);var _super189=_createSuper(stEndurance);_createClass(stEndurance,null,[{key:"setup",// core attribute
value:function setup(context,base,max){var _stat=new stEndurance();var _n=_stat.data;_n.id='endurance',_n.base=base,_n.value=base,_n.modifys=[{id:'healthMax'}];context.addItem(_stat);_stat.Calc();}}]);function stEndurance(){_classCallCheck(this,stEndurance);return _super189.call(this);}_createClass(stEndurance,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("stEndurance",this);}},{key:"updateModifier",value:function updateModifier(){this.parent.addModifier('healthMax',{id:'endurance',bonus:this.parent.get('endurance').value*1.5});//this.parent.addModifier('pDefense',{id:'strength', bonus:this.parent.get('endurance').value%4});
}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(stEndurance,value.data);}}]);return stEndurance;}(Stat);////////////////////////////////////////////////////////////////////////////////
var stCorruption=/*#__PURE__*/function(_Stat18){_inherits(stCorruption,_Stat18);var _super190=_createSuper(stCorruption);_createClass(stCorruption,null,[{key:"setup",value:function setup(context,base,max){/*stCorruptionMax.setup(context,max);
        var _stat = new stCorruption();
        var _n = _stat.data;
        _n.id='corruption', _n.hidden=3,_n.base=base, _n.value=base,_n.limits=[{max:'corruptionMax',min:0}];
        context.addItem(_stat);
        _stat.Calc();*/var stats=Stat.setupStatWithLimitAndRegen('corruption',{base:base,regen:0,max:max});stats.forEach(function(x){context.addItem(x);}),stats.forEach(function(x){x.Calc();});}}]);function stCorruption(){_classCallCheck(this,stCorruption);return _super190.call(this);}_createClass(stCorruption,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("stCorruption",this);}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(stCorruption,value.data);}}]);return stCorruption;}(Stat);var stSavageness=/*#__PURE__*/function(_Stat19){_inherits(stSavageness,_Stat19);var _super191=_createSuper(stSavageness);_createClass(stSavageness,null,[{key:"setup",value:function setup(context,base,max){/*stSavagenessMax.setup(context,max);
        stSavagenessRegen.setup(context,-1,100);
        var _stat = new stSavageness();
        var _n = _stat.data;
        _n.id='savageness', _n.hidden=3,_n.base=base, _n.value=base,_n.limits=[{max:'savagenessMax',min:0}];
        context.addItem(_stat);
        _stat.Calc();*/var stats=Stat.setupStatWithLimitAndRegen('savageness',{base:base,regen:0,max:max,min:0});stats.forEach(function(x){context.addItem(x);}),stats.forEach(function(x){x.Calc();});}}]);function stSavageness(){_classCallCheck(this,stSavageness);return _super191.call(this);}_createClass(stSavageness,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("stSavageness",this);}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(stSavageness,value.data);}}]);return stSavageness;}(Stat);//Fetish
// value >0 means character likes that fetish or <0 hates it  
var stFetish=/*#__PURE__*/function(_Stat20){_inherits(stFetish,_Stat20);var _super192=_createSuper(stFetish);_createClass(stFetish,null,[{key:"setup",value:function setup(context,base,max,name){var _stat=new stFetish();var _n=_stat.data;_n.hidden=4,_n.id=name+"_Max",_n.base=max,_n.value=max,_n.limits=[{max:100,min:-100}];context.addItem(_stat);_stat=new stFetish();_n=_stat.data;_n.hidden=4,_n.id=name+"_Min",_n.base=0,_n.value=0,_n.limits=[{max:100,min:-100}];context.addItem(_stat);_stat=new stFetish();_n=_stat.data;_n.hidden=4,_n.id=name,_n.base=base,_n.value=base,_n.limits=[{max:name+"_Max",min:name+"_Min"}];context.addItem(_stat);_stat.Calc();}},{key:"listFetish",value:function listFetish(){var list=['ftZoophil','ftDominant','ftSubmissive','ftAnalLover','ftAnalSlut','ftVaginalLover',//using someones cunt
'ftVaginalSlut',//getting your cunt used
'ftOralLover','ftOralSlut','ftCockLover',//
'ftCockSlut',//controlled by your dick
'ftSizeQueen',//when penetrator is much larger then penetrated
'ftCumSlurper','ftBreastLover','ftEggSlut','ftMasochist','ftSadist','ftBondage','ftExhibition'];return list;//ftSizeKing    when penetrator is much smaller ??
//horseCockAddled
}}]);function stFetish(){_classCallCheck(this,stFetish);return _super192.call(this);}_createClass(stFetish,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("stFetish",this);}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(stFetish,value.data);}}]);return stFetish;}(Stat);//effects
var effEnergized=/*#__PURE__*/function(_Effect2){_inherits(effEnergized,_Effect2);var _super193=_createSuper(effEnergized);function effEnergized(){var _this171;_classCallCheck(this,effEnergized);_this171=_super193.call(this);_this171.data.id=_this171.data.name=effEnergized.name,_this171.data.duration=120,_this171.data.hidden=0;return _this171;}_createClass(effEnergized,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effEnergized",this);}},{key:"onTimeChange",value:function onTimeChange(time){//+ 10Energy per hour
var delta=window.gm.getDeltaTime(time,this.data.time);this.data.time=time;this.data.duration-=delta;if(this.data.duration<0){delta=delta+this.data.duration;// if delta is 20 but remaining duration is only 5, delta should be capped to 5
this.data.duration=0;}//Effects impact Stats:  Effect->Effects->Character->Stats    is there a prettier wy?
this.parent.parent.Stats.increment('energy',10*delta/60);if(this.data.duration<=0){//remove yourself
return function(me){return function(Effects){Effects.removeItem(me.data.id);};}(this);}return null;}},{key:"onApply",value:function onApply(){//+10 energy
this.data.duration=120;this.data.time=window.gm.getTime();this.parent.parent.Stats.increment('energy',10);}},{key:"merge",value:function merge(neweffect){if(neweffect.name===this.data.name){this.onApply();//refresh 
return true;}}},{key:"desc",get:function get(){return effEnergized.name;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effEnergized,value.data);}}]);return effEnergized;}(Effect);var effNotTired=/*#__PURE__*/function(_Effect3){_inherits(effNotTired,_Effect3);var _super194=_createSuper(effNotTired);function effNotTired(){var _this172;_classCallCheck(this,effNotTired);_this172=_super194.call(this);_this172.data.id=effNotTired.name,_this172.data.name="not tired",_this172.data.duration=120,_this172.data.hidden=4;return _this172;}_createClass(effNotTired,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effNotTired",this);}},{key:"onTimeChange",value:function onTimeChange(time){//Tired after xxh
this.data.duration-=window.gm.getDeltaTime(time,this.data.time);this.data.time=time;if(this.data.duration<=0){return function(me){return function(Effects){var newdata=new effTired();Effects.replace(me.data.id,newdata);};}(this);}return null;}},{key:"onApply",value:function onApply(){this.data.duration=120;// todo 600;
this.data.time=window.gm.getTime();}},{key:"merge",value:function merge(neweffect){if(neweffect.name===this.data.name){this.onApply();//refresh
return true;}}},{key:"desc",get:function get(){return effNotTired.name;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effNotTired,value.data);}}]);return effNotTired;}(Effect);var effTired=/*#__PURE__*/function(_Effect4){_inherits(effTired,_Effect4);var _super195=_createSuper(effTired);function effTired(){var _this173;_classCallCheck(this,effTired);_this173=_super195.call(this);_this173.data.id=effTired.name,_this173.data.name="tired",_this173.data.duration=0,_this173.data.hidden=4;return _this173;}_createClass(effTired,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effTired",this);}},{key:"onTimeChange",value:function onTimeChange(time){//duration not used -> will never expire unless replaced
var delta=window.gm.getTime()-this.data.time;//-10 max energy after xxh, but only up to 3 times
if(delta>60*12)this.parent.parent.Stats.addModifier('energyMax',{id:'energyMax:Tired',bonus:-30});else if(delta>60*8)this.parent.parent.Stats.addModifier('energyMax',{id:'energyMax:Tired',bonus:-20});else if(delta>60*4)this.parent.parent.Stats.addModifier('energyMax',{id:'energyMax:Tired',bonus:-10});}},{key:"onApply",value:function onApply(){this.data.time=window.gm.getTime();}},{key:"onRemove",value:function onRemove(){this.parent.parent.Stats.removeModifier('energyMax',{id:'energyMax:Tired'});}},{key:"merge",value:function merge(neweffect){if(neweffect.name==='effNotTired'){return function(me){return function(Effects){var newdata=new effNotTired();Effects.replace(me.data.id,newdata);};}(this);}if(neweffect.name===this.data.name){//just ignore
return true;}}},{key:"desc",get:function get(){return effTired.name;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effTired,value.data);}}]);return effTired;}(Effect);var effHunger=/*#__PURE__*/function(_Effect5){_inherits(effHunger,_Effect5);var _super196=_createSuper(effHunger);function effHunger(){var _this174;_classCallCheck(this,effHunger);_this174=_super196.call(this);_this174.data.id=_this174.data.name=effHunger.name,_this174.data.duration=60,_this174.data.hidden=4;return _this174;}_createClass(effHunger,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effHunger",this);}},{key:"onTimeChange",value:function onTimeChange(time){//- x Hunger per hour
var delta=window.gm.getDeltaTime(time,this.data.time);if(this.data.duration-delta<=0){//trigger every ...
this.data.time=time;this.data.duration=60;}else delta=0;this.parent.parent.Stats.increment('satiation',this.parent.parent.Stats.get("satiationRegen").value*delta/60);return null;}},{key:"onApply",value:function onApply(){this.data.time=window.gm.getTime();}},{key:"merge",value:function merge(neweffect){if(neweffect.name===this.data.name){this.onApply();//refresh 
return true;}}},{key:"desc",get:function get(){return this.data.name;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effHunger,value.data);}}]);return effHunger;}(Effect);var effSanity=/*#__PURE__*/function(_effHunger){_inherits(effSanity,_effHunger);var _super197=_createSuper(effSanity);function effSanity(){var _this175;_classCallCheck(this,effSanity);_this175=_super197.call(this);_this175.data.id=_this175.data.name=effSanity.name,_this175.data.duration=60,_this175.data.hidden=4;return _this175;}_createClass(effSanity,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effSanity",this);}},{key:"onTimeChange",value:function onTimeChange(time){// x Sanity per hour
var delta=window.gm.getDeltaTime(time,this.data.time);if(this.data.duration-delta<=0){//trigger every ...
this.data.time=time;this.data.duration=60;}else delta=0;this.parent.parent.Stats.increment('savageness',this.parent.parent.Stats.get("savagenessRegen").value*delta/60);return null;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effSanity,value.data);}}]);return effSanity;}(effHunger);var effLibido=/*#__PURE__*/function(_effHunger2){_inherits(effLibido,_effHunger2);var _super198=_createSuper(effLibido);function effLibido(){var _this176;_classCallCheck(this,effLibido);_this176=_super198.call(this);_this176.data.id=_this176.data.name=effLibido.name,_this176.data.duration=60,_this176.data.hidden=4;return _this176;}_createClass(effLibido,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effLibido",this);}},{key:"onTimeChange",value:function onTimeChange(time){// x arousal per hour
var delta=window.gm.getDeltaTime(time,this.data.time);if(this.data.duration-delta<=0){//trigger every ...
this.data.time=time;this.data.duration=60;}else delta=0;this.parent.parent.Stats.increment('arousal',this.parent.parent.Stats.get("arousalRegen").value*delta/60);return null;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effLibido,value.data);}}]);return effLibido;}(effHunger);var effCombatRecovery=/*#__PURE__*/function(_Effect6){_inherits(effCombatRecovery,_Effect6);var _super199=_createSuper(effCombatRecovery);function effCombatRecovery(){var _this177;_classCallCheck(this,effCombatRecovery);_this177=_super199.call(this);_this177.data.id=effCombatRecovery.name,_this177.data.name="recover",_this177.data.duration=0,_this177.data.hidden=4;_this177.eRecover=_this177.wRecover=10;return _this177;}_createClass(effCombatRecovery,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effCombatRecovery",this);}},{key:"onApply",value:function onApply(){this.data.time=window.gm.getTime();}},{key:"onCombatStart",value:function onCombatStart(){this.parent.parent.Stats.increment("poise",9999);//TODO reset on start??
return{OK:false,msg:''};}},{key:"onTurnStart",value:function onTurnStart(){//this is no combat effect but ticked in combat; dont remmove after combatend !
this.parent.parent.Stats.increment("poise",this.parent.parent.Stats.get('poiseRegen').value);this.parent.parent.Stats.increment("energy",this.parent.parent.Stats.get('energyRegen').value);this.parent.parent.Stats.increment("will",this.parent.parent.Stats.get('willRegen').value);this.parent.parent.Stats.increment("arousal",this.parent.parent.Stats.get('arousalRegen').value);this.parent.parent.Stats.increment("health",this.parent.parent.Stats.get('healthRegen').value);return{OK:true,msg:''};}},{key:"merge",value:function merge(neweffect){if(neweffect.name===this.data.name){return true;}}},{key:"desc",get:function get(){return effCombatRecovery.name;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effCombatRecovery,value.data);}}]);return effCombatRecovery;}(Effect);var effEnergyDrain=/*#__PURE__*/function(_Effect7){_inherits(effEnergyDrain,_Effect7);var _super200=_createSuper(effEnergyDrain);function effEnergyDrain(){var _this178;_classCallCheck(this,effEnergyDrain);_this178=_super200.call(this);_this178.data.id=effEnergyDrain.name,_this178.data.name="energy drained",_this178.data.duration=0,_this178.data.hidden=0;return _this178;}_createClass(effEnergyDrain,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effEnergyDrain",this);}},{key:"onTimeChange",value:function onTimeChange(time){var delta=window.gm.getDeltaTime(time,this.data.time);this.data.time=time;this.parent.parent.Stats.increment('energy',-3*delta/60);}},{key:"onApply",value:function onApply(){this.data.time=window.gm.getTime();}},{key:"merge",value:function merge(neweffect){if(neweffect.name===this.data.name){return true;}}},{key:"desc",get:function get(){return effEnergyDrain.name;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effEnergyDrain,value.data);}}]);return effEnergyDrain;}(Effect);//////////////   Mutations ////////////////////////
var effMutateHorse=/*#__PURE__*/function(_Effect8){_inherits(effMutateHorse,_Effect8);var _super201=_createSuper(effMutateHorse);function effMutateHorse(){var _this179;_classCallCheck(this,effMutateHorse);_this179=_super201.call(this);_this179.data.id=_this179.data.name=effMutateHorse.name,_this179.data.hidden=0;_this179.data.duration=60,_this179.data.cycles=3,_this179.data.magnitude=1;return _this179;}_createClass(effMutateHorse,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effMutateHorse",this);}},{key:"onTimeChange",value:function onTimeChange(time){//after some time you mutate a bit
this.data.duration-=window.gm.getDeltaTime(time,this.data.time);this.data.time=time;if(this.data.duration<=0){this.data.duration=60;return function(me){return function(Effects){me.data.cycles-=1;me.data.magnitude=me.parent.parent.Stats.get("savageness").value;//=(x+Max)/2 ?? 
me.__mutate();if(me.data.cycles<=0){Effects.removeItem(me.data.id);}};}(this);}return null;}},{key:"onApply",value:function onApply(){this.data.duration=60,this.data.cycles=3;this.data.time=window.gm.getTime();}},{key:"merge",value:function merge(neweffect){if(neweffect.name===this.data.name){//dont refresh
return true;}}},{key:"__mutate",value:function __mutate(){window.gm.MutationsLib.mutateHorse(this.parent.parent,this.data.magnitude);//todo non-PC can be mutated (if receives timechange !) but the scene will assume its player?!
}},{key:"desc",get:function get(){return this.data.name;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effMutateHorse,value.data);}}]);return effMutateHorse;}(Effect);var effMutateHuman=/*#__PURE__*/function(_effMutateHorse){_inherits(effMutateHuman,_effMutateHorse);var _super202=_createSuper(effMutateHuman);function effMutateHuman(){var _this180;_classCallCheck(this,effMutateHuman);_this180=_super202.call(this);_this180.data.id=_this180.data.name=effMutateHuman.name,_this180.data.hidden=0;_this180.data.duration=60,_this180.data.cycles=3,_this180.data.magnitude=3;return _this180;}_createClass(effMutateHuman,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effMutateHuman",this);}},{key:"__mutate",value:function __mutate(){window.gm.MutationsLib.mutateHuman(this.parent.parent,this.data.magnitude);}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effMutateHuman,value.data);}}]);return effMutateHuman;}(effMutateHorse);var effMutateCat=/*#__PURE__*/function(_effMutateHorse2){_inherits(effMutateCat,_effMutateHorse2);var _super203=_createSuper(effMutateCat);function effMutateCat(){var _this181;_classCallCheck(this,effMutateCat);_this181=_super203.call(this);_this181.data.id=_this181.data.name=effMutateCat.name,_this181.data.hidden=0;_this181.data.duration=60,_this181.data.cycles=3,_this181.data.magnitude=3;return _this181;}_createClass(effMutateCat,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effMutateCat",this);}},{key:"__mutate",value:function __mutate(){window.gm.MutationsLib.mutateCat(this.parent.parent,this.data.magnitude);}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effMutateCat,value.data);}}]);return effMutateCat;}(effMutateHorse);var effMutateWolf=/*#__PURE__*/function(_effMutateHorse3){_inherits(effMutateWolf,_effMutateHorse3);var _super204=_createSuper(effMutateWolf);function effMutateWolf(){var _this182;_classCallCheck(this,effMutateWolf);_this182=_super204.call(this);_this182.data.id=_this182.data.name=effMutateWolf.name,_this182.data.hidden=0;_this182.data.duration=60,_this182.data.cycles=3,_this182.data.magnitude=3;return _this182;}_createClass(effMutateWolf,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effMutateWolf",this);}},{key:"__mutate",value:function __mutate(){window.gm.MutationsLib.mutateWolf(this.parent.parent,this.data.magnitude);}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effMutateWolf,value.data);}}]);return effMutateWolf;}(effMutateHorse);var effMutateBunny=/*#__PURE__*/function(_effMutateHorse4){_inherits(effMutateBunny,_effMutateHorse4);var _super205=_createSuper(effMutateBunny);function effMutateBunny(){var _this183;_classCallCheck(this,effMutateBunny);_this183=_super205.call(this);_this183.data.id=_this183.data.name=effMutateBunny.name;return _this183;}_createClass(effMutateBunny,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effMutateBunny",this);}},{key:"__mutate",value:function __mutate(){window.gm.MutationsLib.mutateBunny(this.parent.parent,this.data.magnitude);}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effMutateBunny,value.data);}}]);return effMutateBunny;}(effMutateHorse);var effHorsePower=/*#__PURE__*/function(_Effect9){_inherits(effHorsePower,_Effect9);var _super206=_createSuper(effHorsePower);function effHorsePower(){var _this184;_classCallCheck(this,effHorsePower);_this184=_super206.call(this);_this184.data.id=_this184.data.name=effHorsePower.name,_this184.data.hidden=0;_this184.data.duration=120,_this184.data.cycles=1,_this184.data.magnitude=1;return _this184;}_createClass(effHorsePower,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effHorsePower",this);}},{key:"onTimeChange",value:function onTimeChange(time){//+ 10Energy per hour
var delta=window.gm.getDeltaTime(time,this.data.time);this.data.time=time;this.data.duration-=delta;if(this.data.duration<0){delta=delta+this.data.duration;// if delta is 20 but remaining duration is only 5, delta should be capped to 5
this.data.duration=0;}this.parent.parent.Stats.increment('energy',10*delta/60);this.parent.parent.Stats.increment('health',10*delta/60);this.parent.parent.Stats.increment('will',10*delta/60);if(this.data.duration<=0){this.data.cycles-=1;if(this.data.magnitude>=2){this.__trgMutation();}if(this.data.cycles<=0){//remove yourself
return function(me){return function(Effects){Effects.removeItem(me.data.id);};}(this);}}return null;}},{key:"__trgMutation",value:function __trgMutation(){var _i=this.parent.findItemSlot(effMutateHorse.name);if(_i===-1){//todo extend if exist?
this.parent.parent.addEffect(new effMutateHorse(),effMutateHorse.name);}}},{key:"onApply",value:function onApply(){this.data.duration=120;this.data.time=window.gm.getTime();/*this.parent.parent.Stats.addModifier('rst_blunt',{id:'rst_blunt:Guard', bonus:this.data.weapResist});
        this.parent.parent.Stats.addModifier('rst_slash',{id:'rst_slash:Guard', bonus:this.data.weapResist});
        this.parent.parent.Stats.addModifier('rst_pierce',{id:'rst_pierce:Guard', bonus:this.data.weapResist});*/}},{key:"merge",value:function merge(neweffect){if(neweffect.id===this.data.id){this.onApply();//refresh 
this.data.magnitude+=1;//bonus effect triggers only if added multiple times
return true;}}},{key:"desc",get:function get(){return this.data.name;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effHorsePower,value.data);}}]);return effHorsePower;}(Effect);var effLapineSpeed=/*#__PURE__*/function(_effHorsePower){_inherits(effLapineSpeed,_effHorsePower);var _super207=_createSuper(effLapineSpeed);function effLapineSpeed(){var _this185;_classCallCheck(this,effLapineSpeed);_this185=_super207.call(this);_this185.data.id=_this185.data.name=effLapineSpeed.name;return _this185;}_createClass(effLapineSpeed,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effLapineSpeed",this);}},{key:"__trgMutation",value:function __trgMutation(){var _i=this.parent.findItemSlot(effMutateBunny.name);if(_i===-1){//todo extend if exist?
this.parent.parent.addEffect(new effMutateBunny(),effMutateBunny.name);}}},{key:"desc",get:function get(){return effLapineSpeed.name;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effLapineSpeed,value.data);}}]);return effLapineSpeed;}(effHorsePower);var effGrowBreast=/*#__PURE__*/function(_Effect10){_inherits(effGrowBreast,_Effect10);var _super208=_createSuper(effGrowBreast);function effGrowBreast(){var _this186;_classCallCheck(this,effGrowBreast);_this186=_super208.call(this);_this186.data.id=_this186.data.name=effGrowBreast.name,_this186.data.duration=60,_this186.data.hidden=0;_this186.data.cycles=3,_this186.data.magnitude=3;return _this186;}_createClass(effGrowBreast,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effGrowBreast",this);}},{key:"onTimeChange",value:function onTimeChange(time){//after some time you mutate a bit
this.data.duration=Math.max(this.data.duration-window.gm.getDeltaTime(time,this.data.time),0);this.data.time=time;if(this.data.duration<=0&&this.data.cycles>0){this.data.cycles-=1;return function(me){return function(Effects){if(me.data.cycles<=0){Effects.removeItem(me.data.id);window.gm.pushDeferredEvent("MutateBreastEnd");}else window.gm.MutationsLib.growBreast(this.parent.parent);};}(this);}return null;}},{key:"onApply",value:function onApply(){this.data.duration=60;this.data.time=window.gm.getTime();}},{key:"merge",value:function merge(neweffect){if(neweffect.name===this.data.name){this.data.cycles+=neweffect.data.cycles;//prolong the effect
return true;}}},{key:"desc",get:function get(){return effGrowBreast.name;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effGrowBreast,value.data);}}]);return effGrowBreast;}(Effect);var effGrowVulva=/*#__PURE__*/function(_Effect11){_inherits(effGrowVulva,_Effect11);var _super209=_createSuper(effGrowVulva);function effGrowVulva(){var _this187;_classCallCheck(this,effGrowVulva);_this187=_super209.call(this);_this187.data.id=_this187.data.name=effGrowVulva.name,_this187.data.duration=60,_this187.data.hidden=0;_this187.data.cycles=3,_this187.data.magnitude=3;return _this187;}_createClass(effGrowVulva,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effGrowVulva",this);}},{key:"onTimeChange",value:function onTimeChange(time){//after some time you mutate a bit
this.data.duration=Math.max(this.data.duration-window.gm.getDeltaTime(time,this.data.time),0);this.data.time=time;if(this.data.duration<=0&&this.data.cycles>0){this.data.cycles-=1;return function(me){return function(Effects){if(me.data.cycles<=0){Effects.removeItem(me.data.id);window.gm.pushDeferredEvent("MutateVulvaEnd");}else window.gm.MutationsLib.growVulva(this.parent.parent);};}(this);}return null;}},{key:"onApply",value:function onApply(){this.data.duration=60;this.data.time=window.gm.getTime();}},{key:"merge",value:function merge(neweffect){if(neweffect.name===this.data.name){this.data.cycles+=neweffect.data.cycles;//prolong the effect
return true;}}},{key:"desc",get:function get(){return effGrowVulva.name;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effGrowVulva,value.data);}}]);return effGrowVulva;}(Effect);var effPillEffect=/*#__PURE__*/function(_Effect12){_inherits(effPillEffect,_Effect12);var _super210=_createSuper(effPillEffect);_createClass(effPillEffect,null,[{key:"factory",value:function factory(type){var eff=new effPillEffect();eff.type=type;eff.data.id=eff.data.name='eff'+type;return eff;}}]);function effPillEffect(){var _this188;_classCallCheck(this,effPillEffect);_this188=_super210.call(this);_this188.data.id=_this188.data.name=effPillEffect.name,_this188.data.hidden=0;_this188.data.duration=120,_this188.data.cycles=1,_this188.data.magnitude=1;return _this188;}_createClass(effPillEffect,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effPillEffect",this);}},{key:"onTimeChange",value:function onTimeChange(time){var delta=window.gm.getDeltaTime(time,this.data.time);this.data.time=time;this.data.duration-=delta;if(this.data.duration<0){delta=delta+this.data.duration;// if delta is 20 but remaining duration is only 5, delta should be capped to 5
this.data.duration=0;}/*this.parent.parent.Stats.increment('energy',10*delta/60);
        this.parent.parent.Stats.increment('health',10*delta/60);
        this.parent.parent.Stats.increment('will',10*delta/60);    */if(this.data.duration<=0){this.data.cycles-=1;if(this.data.magnitude>=2){this.__trgMutation();}if(this.data.cycles<=0){//remove yourself
return function(me){return function(Effects){Effects.removeItem(me.data.id);};}(this);}}return null;}},{key:"__trgMutation",value:function __trgMutation(){var _i=this.parent.findItemSlot(effMutateHorse.name);if(_i===-1){//todo extend if exist?
this.parent.parent.addEffect(new effMutateHorse(),effMutateHorse.name);}}},{key:"onApply",value:function onApply(){this.data.duration=120;this.data.time=window.gm.getTime();if(this.data.id='effBrownPill'){this.parent.parent.Stats.addModifier('arm_poison',{id:'arm_poison:'+this.data.name,bonus:25});}else if(this.data.id='effRedPill'){this.parent.parent.Stats.addModifier('rst_blunt',{id:'rst_blunt:'+this.data.name,bonus:25});this.parent.parent.Stats.addModifier('rst_slash',{id:'rst_slash:'+this.data.name,bonus:25});this.parent.parent.Stats.addModifier('rst_pierce',{id:'rst_pierce:'+this.data.name,bonus:25});}}},{key:"onRemove",value:function onRemove(){if(this.data.id='effBrownPill'){this.parent.parent.Stats.addModifier('arm_poison',{id:'arm_poison:'+this.data.name,bonus:25});}else if(this.data.id='effRedPill'){this.parent.parent.Stats.addModifier('rst_blunt',{id:'rst_blunt:'+this.data.name,bonus:25});this.parent.parent.Stats.addModifier('rst_slash',{id:'rst_slash:'+this.data.name,bonus:25});this.parent.parent.Stats.addModifier('rst_pierce',{id:'rst_pierce:'+this.data.name,bonus:25});}}},{key:"merge",value:function merge(neweffect){if(neweffect.id===this.data.id){this.onApply();//refresh 
this.data.magnitude+=1;//bonus effect triggers only if added multiple times
return true;}}},{key:"desc",get:function get(){return this.data.name;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effPillEffect,value.data);}}]);return effPillEffect;}(Effect);/**
 * todo 
 * on a female the mark indicates that you can bear soulgems; the stronger the mark, the better the gem but it will take longer and absorb more
 * with each birth, the mark grows stronger ?
 * while pampering the gem, it sucks up your arcana if you dont have sex
 * chance to go into heat if you dont have a gem
 * 
 * on a male the mark encourage cum stud fetish
 * makes host more submissive to females? shrinks cock if not used?
 * there is a slight chance to add lewd mark to fucked female?
 * chance to go into rut
 * 
 * if a male with lm fucks female with lm&gem, the gem will vanish and both gain a level; no effect otherwise
 *
 * @class effLewdMark
 * @extends {Effect}
 */var effLewdMark=/*#__PURE__*/function(_Effect13){_inherits(effLewdMark,_Effect13);var _super211=_createSuper(effLewdMark);function effLewdMark(){var _this189;_classCallCheck(this,effLewdMark);_this189=_super211.call(this);_this189.data.id=effLewdMark.name,_this189.data.name='Lewdmark',_this189.data.duration=60,_this189.data.hidden=0;_this189.data.cycles=3,_this189.data.magnitude=1;return _this189;}_createClass(effLewdMark,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effLewdMark",this);}},{key:"onTimeChange",value:function onTimeChange(time){return null;}},{key:"onApply",value:function onApply(){this.data.duration=60;this.data.time=window.gm.getTime();window.gm.know(window.gm.FKnow.LewdMark);}},{key:"merge",value:function merge(neweffect){if(neweffect.name===this.data.name){return true;}}},{key:"desc",get:function get(){return effLewdMark.name;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effLewdMark,value.data);}}]);return effLewdMark;}(Effect);var effInHeat=/*#__PURE__*/function(_Effect14){_inherits(effInHeat,_Effect14);var _super212=_createSuper(effInHeat);function effInHeat(){var _this190;_classCallCheck(this,effInHeat);_this190=_super212.call(this);_this190.data.id=_this190.data.name=effInHeat.name,_this190.data.duration=60,_this190.data.hidden=3;_this190.data.cycles=3,_this190.data.magnitude=1;return _this190;}_createClass(effInHeat,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effInHeat",this);}},{key:"desc",get:function get(){return effInHeat.name;}//todo if female, you might go into heat (only when not carrying child/soulgem ?) 
//more arousal damage by studs
//succesful impregation or time might end heat
}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effInHeat,value.data);}}]);return effInHeat;}(Effect);var effInRut=/*#__PURE__*/function(_Effect15){_inherits(effInRut,_Effect15);var _super213=_createSuper(effInRut);function effInRut(){var _this191;_classCallCheck(this,effInRut);_this191=_super213.call(this);_this191.data.id=_this191.data.name=effInRut.name,_this191.data.duration=60,_this191.data.hidden=3;_this191.data.cycles=3,_this191.data.magnitude=1;return _this191;}_createClass(effInRut,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effInRut",this);}},{key:"desc",get:function get(){return effInRut.name;}//todo if male, you might go into rut  
//more arousal damage by sluts
//multiple succesful impregations/balldrain or time might end rut
}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effInRut,value.data);}}]);return effInRut;}(Effect);/**
 * #todo
 * walking around makes you horny faster and stretches your bum
 * slowly increases anal sex liking
 * your bum is secured against infestation unless its a holePlug
 * 
 * @class effButtPlugged
 * @extends {Effect}
 */var effButtPlugged=/*#__PURE__*/function(_Effect16){_inherits(effButtPlugged,_Effect16);var _super214=_createSuper(effButtPlugged);_createClass(effButtPlugged,null,[{key:"cycleDur",get:function get(){return 60;}}]);function effButtPlugged(){var _this192;_classCallCheck(this,effButtPlugged);_this192=_super214.call(this);_this192.data.id=_this192.data.name=effButtPlugged.name,_this192.data.duration=effButtPlugged.cycleDur,_this192.data.hidden=3;_this192.data.cycles=0,_this192.data.magnitude=1;return _this192;}_createClass(effButtPlugged,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effButtPlugged",this);}},{key:"onTimeChange",value:function onTimeChange(time){var delta=window.gm.getDeltaTime(time,this.data.time);this.data.time=time;this.data.duration-=delta;if(this.data.duration<0){delta=delta+this.data.duration;this.data.cycles+=1;this.__mutate();this.data.duration=effButtPlugged.cycleDur;}return null;}},{key:"onApply",value:function onApply(){this.data.duration=effButtPlugged.cycleDur;this.data.time=window.gm.getTime();}},{key:"merge",value:function merge(neweffect){if(neweffect.name===this.data.name){return true;}}},{key:"__mutate",value:function __mutate(){// todo window.gm.MutationsLib.effMutateButt(this.parent.parent);
}},{key:"desc",get:function get(){return effButtPlugged.name;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effButtPlugged,value.data);}}]);return effButtPlugged;}(Effect);var effVaginalFertil=/*#__PURE__*/function(_Effect17){_inherits(effVaginalFertil,_Effect17);var _super215=_createSuper(effVaginalFertil);function effVaginalFertil(){var _this193;_classCallCheck(this,effVaginalFertil);_this193=_super215.call(this);_this193.data.id=_this193.data.name=effVaginalFertil.name,_this193.data.duration=60,_this193.data.hidden=3;_this193.data.cycles=3,_this193.data.magnitude=1;return _this193;}_createClass(effVaginalFertil,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effVaginalFertil",this);}},{key:"onTimeChange",value:function onTimeChange(time){//todo can get pregnant with child,eggs ; natural heat might be triggered
// if fertility of Vagina is 0, can still bear parasites,soulgem; fertility heat might not trigger 
return null;}},{key:"onApply",value:function onApply(){//todo remove infertile,fertileEffect
this.parent.removeItem(effVaginalPregnant.name);this.data.duration=60;this.data.time=window.gm.getTime();}},{key:"merge",value:function merge(neweffect){if(neweffect.name===this.data.name){//no merge
return true;}}},{key:"desc",get:function get(){return effVaginalFertil.name;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effVaginalFertil,value.data);}}]);return effVaginalFertil;}(Effect);var effVaginalPregnant=/*#__PURE__*/function(_Effect18){_inherits(effVaginalPregnant,_Effect18);var _super216=_createSuper(effVaginalPregnant);function effVaginalPregnant(){var _this194;_classCallCheck(this,effVaginalPregnant);_this194=_super216.call(this);_this194.data.id=_this194.data.name=effVaginalPregnant.name,_this194.data.duration=60,_this194.data.hidden=3;_this194.data.cycles=3,_this194.data.magnitude=1,_this194.data.type='';return _this194;}_createClass(effVaginalPregnant,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effVaginalPregnant",this);}},{key:"onTimeChange",value:function onTimeChange(time){//todo be pregnant with child,eggs,parasites,soulgem
//normal pregnancy will grow over time, might be aborted by medicine
//soulgem grows over time, consumes arcana or sperm
this.data.duration=Math.max(this.data.duration-window.gm.getDeltaTime(time,this.data.time),0);this.data.time=time;if(this.data.duration<=0&&this.data.cycles>0){this.data.cycles-=1,this.data.duration=60;window.gm.MutationsLib.vaginaPregnancy(this.parent.parent);}return null;}},{key:"onApply",value:function onApply(){//todo remove infertile,fertileEffect
this.parent.removeItem(effVaginalFertil.name);this.data.duration=60;this.data.time=window.gm.getTime();}},{key:"merge",value:function merge(neweffect){if(neweffect.name===this.data.name){//no merge
return true;}}},{key:"desc",get:function get(){return effVaginalPregnant.name;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effVaginalPregnant,value.data);}}]);return effVaginalPregnant;}(Effect);/**
 * if you have womb or anus filled with sperm, this handles impregnation and sperm-decay
 * //todo VaginalParasite
 * @class effSpermDecay
 * @extends {Effect}
 */var effSpermDecay=/*#__PURE__*/function(_Effect19){_inherits(effSpermDecay,_Effect19);var _super217=_createSuper(effSpermDecay);function effSpermDecay(){var _this195;_classCallCheck(this,effSpermDecay);_this195=_super217.call(this);_this195.data.id=_this195.data.name=effSpermDecay.name,_this195.data.duration=60,_this195.data.hidden=3;_this195.data.cycles=1,_this195.data.magnitude=2;return _this195;}_createClass(effSpermDecay,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effSpermDecay",this);}},{key:"onTimeChange",value:function onTimeChange(time){this.data.duration=Math.max(this.data.duration-window.gm.getDeltaTime(time,this.data.time),0);this.data.time=time;if(this.data.duration<=0&&this.data.cycles>0){this.data.duration=60;this.__decay();}return null;}},{key:"onApply",value:function onApply(){this.data.duration=60;this.data.time=window.gm.getTime();}},{key:"merge",value:function merge(neweffect){if(neweffect.name===this.data.name){return true;}}},{key:"__decay",value:function __decay(){var msg='',char=this.parent.parent;var vagina=char.getVagina(),anus=char.getAnus();var lewdMark=char.Effects.findEffect(effLewdMark.name)[0];var pregnancy=char.Effects.findEffect(effVaginalPregnant.name)[0];if(vagina&&vagina.data.sperm>0){vagina.removeSperm(2);//todo decay depends on looseness, soulgem absorption??
msg+="You can feel some of the cum from your womb dribble down your leg. ";//todo "into your panties. Cumslut as you are, shoving your fingers down your nethers, you scope up some of it and slurp it into your mouth."Hmm,Taste like wolf" "
if(pregnancy){if(lewdMark){msg+="More of that precious seed is absorbed by that soulgem growing in you.</br>";vagina.removeSperm(2);//todo decay depends on looseness, soulgem absorption??
}else msg+="But you are pregnant already anyway.</br>";}if(!pregnancy){pregnancy=char.Effects.findEffect(effVaginalFertil.name)[0];if(pregnancy){//todo random chance according to base-fertility-stat, sperm-fertility, vagina-fertility
//race-compatibility between father-mother
if(true||_.random(0,100)>75){msg+="Has your last fling got you impregnated?</br>";pregnancy=new effVaginalPregnant();pregnancy.data.type=vagina.data.spermtype;if(lewdMark)pregnancy.data.type='soulgem';char.addEffect(pregnancy,effVaginalPregnant.name);}else msg+="Hopefully there is nothing to worry about?</br>";}}if(vagina.data.sperm>0){msg+="There might still be "+window.gm.util.formatNumber(vagina.data.sperm,0)+"ml sperm left.</br>";}else msg+="This was possibly the last remains of sperm from your breeding-hole.</br>";}if(anus&&anus.data.sperm>0){anus.removeSperm(2);msg+="Your butt is lubed up by leaking spunk from your hole. ";}if(msg!==''&&char===window.gm.player){window.gm.pushDeferredEvent("GenericDeffered",[msg]);}}},{key:"desc",get:function get(){return effSpermDecay.name;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effSpermDecay,value.data);}}]);return effSpermDecay;}(Effect);/////////////// combateffects /////////////////////////
var effHeal=/*#__PURE__*/function(_CombatEffect){_inherits(effHeal,_CombatEffect);var _super218=_createSuper(effHeal);_createClass(effHeal,null,[{key:"factory",value:function factory(amount){var duration=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var eff=new effHeal();eff.startduration=duration;eff.amount=amount;return eff;}}]);function effHeal(){var _this196;_classCallCheck(this,effHeal);_this196=_super218.call(this);_this196.amount=5;_this196.data.id=_this196.data.name=effHeal.name,_this196.data.startduration=0,_this196.data.hidden=0;return _this196;}_createClass(effHeal,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effHeal",this);}},{key:"onApply",value:function onApply(){this.data.duration=this.data.startduration;this.parent.parent.Stats.increment('health',this.amount);this.castMsg=window.gm.util.descFixer(this.parent.parent)('$[Name]$ $[was]$ healed by +'+this.amount+'.');}},{key:"merge",value:function merge(neweffect){if(neweffect.name===this.data.name){//extends
this.onApply();return true;}}},{key:"onTurnStart",value:function onTurnStart(){this.data.duration-=1;if(this.data.duration<=0)this.parent.removeItem(this.data.id);else{this.parent.parent.Stats.increment('health',this.amount);this.castMsg=window.gm.util.descFixer(this.parent.parent)('$[Name]$ recovered +'+this.amount+' health.');}return{OK:true,msg:''};}},{key:"desc",get:function get(){return effHeal.name;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effHeal,value.data);}}]);return effHeal;}(CombatEffect);var effGuard=/*#__PURE__*/function(_CombatEffect2){_inherits(effGuard,_CombatEffect2);var _super219=_createSuper(effGuard);_createClass(effGuard,null,[{key:"factory",value:function factory(weapResist,eRecover,duration){var x=new effGuard();x.data.weapResist=weapResist;x.data.eRecover=eRecover;x.data.duration=duration;return x;}}]);function effGuard(){var _this197;_classCallCheck(this,effGuard);_this197=_super219.call(this);_this197.data.id=_this197.data.name=effGuard.name,_this197.data.duration=0,_this197.data.hidden=0;_this197.data.weapResist=5;_this197.data.eRecover=0;return _this197;}_createClass(effGuard,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effGuard",this);}},{key:"onApply",value:function onApply(){this.data.duration=2;this.parent.parent.Stats.addModifier('rst_blunt',{id:'rst_blunt:Guard',bonus:this.data.weapResist});this.parent.parent.Stats.addModifier('rst_slash',{id:'rst_slash:Guard',bonus:this.data.weapResist});this.parent.parent.Stats.addModifier('rst_pierce',{id:'rst_pierce:Guard',bonus:this.data.weapResist});}},{key:"merge",value:function merge(neweffect){if(neweffect.name===this.data.name){return true;}}},{key:"onTurnStart",value:function onTurnStart(){this.data.duration-=1;this.parent.parent.Stats.increment("energy",this.data.eRecover);if(this.data.duration<=0)this.parent.removeItem(this.data.id);return{OK:true,msg:''};}},{key:"onRemove",value:function onRemove(){this.parent.parent.Stats.removeModifier('rst_blunt',{id:'rst_blunt:Guard'});this.parent.parent.Stats.removeModifier('rst_slash',{id:'rst_slash:Guard'});this.parent.parent.Stats.removeModifier('rst_pierce',{id:'rst_pierce:Guard'});}},{key:"desc",get:function get(){return effGuard.name;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effGuard,value.data);}}]);return effGuard;}(CombatEffect);var effProtect=/*#__PURE__*/function(_CombatEffect3){_inherits(effProtect,_CombatEffect3);var _super220=_createSuper(effProtect);_createClass(effProtect,null,[{key:"factory",value:function factory(duration){//TODO what to protect for, how much?
var x=new effProtect();x.data.duration=duration;return x;}}]);function effProtect(){var _this198;_classCallCheck(this,effProtect);_this198=_super220.call(this);_this198.data.id=_this198.data.name=effProtect.name,_this198.data.duration=0,_this198.data.hidden=0;return _this198;}_createClass(effProtect,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effProtect",this);}},{key:"onApply",value:function onApply(){//effect is handled in combat-sm
this.data.duration=2;}},{key:"merge",value:function merge(neweffect){if(neweffect.name===this.data.name){return true;}}},{key:"onTurnStart",value:function onTurnStart(){this.data.duration-=1;if(this.data.duration<=0)this.parent.removeItem(this.data.id);return{OK:true,msg:''};}},{key:"onRemove",value:function onRemove(){}},{key:"desc",get:function get(){return effProtect.name;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effProtect,value.data);}}]);return effProtect;}(CombatEffect);var effChangeStance=/*#__PURE__*/function(_CombatEffect4){_inherits(effChangeStance,_CombatEffect4);var _super221=_createSuper(effChangeStance);_createClass(effChangeStance,null,[{key:"factory",value:function factory(newStanceID){var x=new effChangeStance();x.data.newStanceID=newStanceID;return x;}}]);function effChangeStance(){var _this199;_classCallCheck(this,effChangeStance);_this199=_super221.call(this);_this199.data.id=_this199.data.name=effChangeStance.name,_this199.data.duration=0,_this199.data.hidden=0;return _this199;}_createClass(effChangeStance,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effChangeStance",this);}},{key:"onApply",value:function onApply(){this.parent.parent.changeStance(new window.gm.StanceLib[this.data.newStanceID]());}},{key:"merge",value:function merge(neweffect){if(neweffect.name===this.data.name)return true;}},{key:"onTurnStart",value:function onTurnStart(){this.data.duration-=1;if(this.data.duration<=0)this.parent.removeItem(this.data.id);return{OK:true,msg:''};}},{key:"onRemove",value:function onRemove(){}},{key:"desc",get:function get(){return this.data.newStanceID;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effChangeStance,value.data);}}]);return effChangeStance;}(CombatEffect);/** todo
 * boost will&Energy-generation and arousal-resistance
 */var effDetermined=/*#__PURE__*/function(_CombatEffect5){_inherits(effDetermined,_CombatEffect5);var _super222=_createSuper(effDetermined);_createClass(effDetermined,null,[{key:"factory",value:function factory(wRecover,eRecover,teaseResist,duration){var x=new effDetermined();x.data.teaseResist=teaseResist;x.data.eRecover=eRecover;x.data.wRecover=wRecover;x.data.duration=duration;return x;}}]);function effDetermined(){var _this200;_classCallCheck(this,effDetermined);_this200=_super222.call(this);_this200.data.id=_this200.data.name=effDetermined.name,_this200.data.duration=0,_this200.data.hidden=0;_this200.data.teaseResist=5;_this200.data.wRecover=0;_this200.data.eRecover=0;return _this200;}_createClass(effDetermined,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effDetermined",this);}},{key:"onApply",value:function onApply(){this.data.duration=3;this.parent.parent.Stats.addModifier('rst_tease',{id:'rst_tease:Determined',bonus:this.data.teaseResist});this.parent.parent.Stats.addModifier('willRegen',{id:'willRegen:Determined',bonus:this.data.wRecover});this.parent.parent.Stats.addModifier('energyRegen',{id:'energyRegen:Determined',bonus:this.data.eRecover});}},{key:"merge",value:function merge(neweffect){if(neweffect.name===this.data.name)return true;}},{key:"onTurnStart",value:function onTurnStart(){this.data.duration-=1;if(this.data.duration<=0)this.parent.removeItem(this.data.id);return{OK:true,msg:''};}},{key:"onRemove",value:function onRemove(){this.parent.parent.Stats.removeModifier('rst_tease',{id:'rst_tease:Determined'});this.parent.parent.Stats.removeModifier('willRegen',{id:'willRegen:Determined'});this.parent.parent.Stats.removeModifier('energyRegen',{id:'energyRegen:Determined'});}},{key:"desc",get:function get(){return effDetermined.name;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effDetermined,value.data);}}]);return effDetermined;}(CombatEffect);//to combine multiple effects that get dispelled together 
var effCombined=/*#__PURE__*/function(_CombatEffect6){_inherits(effCombined,_CombatEffect6);var _super223=_createSuper(effCombined);function effCombined(EffectsA,EffectsB){var _this201;_classCallCheck(this,effCombined);_this201=_super223.call(this);_this201.effects=EffectsA.concat(EffectsB);_this201.data.id=_this201.data.name=effCombined.name,_this201.data.duration=0,_this201.data.hidden=0;var _iterator130=_createForOfIteratorHelper(_this201.effects),_step130;try{for(_iterator130.s();!(_step130=_iterator130.n()).done;){var n=_step130.value;n.onRemove=function(me){var _old=n.onRemove.bind(n);var foo=function foo(){_old.call(n);//override onRemove but call orignial fct
var i=me.effects.indexOf(n);if(i>=0)me.effects.splice(i,1);me.removeAll();};return foo;}(_assertThisInitialized(_this201));}}catch(err){_iterator130.e(err);}finally{_iterator130.f();}return _this201;}_createClass(effCombined,[{key:"removeAll",value:function removeAll(){var _iterator131=_createForOfIteratorHelper(this.effects),_step131;try{for(_iterator131.s();!(_step131=_iterator131.n()).done;){var n=_step131.value;if(n)n.parent.removeItem(n.id);}}catch(err){_iterator131.e(err);}finally{_iterator131.f();}this.parent.removeItem(this.id);}},{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effCombined",this);}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effCombined,value.data);}}]);return effCombined;}(CombatEffect);var effDamage=/*#__PURE__*/function(_CombatEffect7){_inherits(effDamage,_CombatEffect7);var _super224=_createSuper(effDamage);_createClass(effDamage,null,[{key:"factory",value:function factory(amount,type){var turns=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var msg=arguments.length>3&&arguments[3]!==undefined?arguments[3]:'';var eff=new effDamage();eff.amount=amount,eff.data.duration=turns;eff.type=type;eff.data.id=eff.data.name=type+'-damage';eff.castMsg=msg;return eff;}}]);function effDamage(){var _this202;_classCallCheck(this,effDamage);_this202=_super224.call(this);_this202.amount=8;_this202.data.id=_this202.data.name=effDamage.name,_this202.data.duration=0,_this202.data.hidden=0;return _this202;}_createClass(effDamage,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effDamage",this);}},{key:"onApply",value:function onApply(){//this.data.duration = 0;
this.parent.parent.Stats.increment('health',-1*this.amount);if(this.data.duration<1)this.parent.removeItem(this.data.id);this.castMsg=window.gm.util.descFixer(this.parent.parent)(this.amount+' '+this.data.name+' ');//'$[Name]$ got hurt for '+  
}},{key:"merge",value:function merge(neweffect){if(neweffect.name===this.data.name){//ignore
return;}}},{key:"onTurnStart",value:function onTurnStart(){this.data.duration-=1;if(this.data.duration<=0){this.parent.removeItem(this.data.id);}this.parent.parent.Stats.increment('health',-1*this.amount);return{OK:true,msg:''};}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effDamage,value.data);}}]);return effDamage;}(CombatEffect);/**
 * type says which bonus is applied from lewds
 * lewds is calculated tease bonus from gear
 */var effTeaseDamage=/*#__PURE__*/function(_CombatEffect8){_inherits(effTeaseDamage,_CombatEffect8);var _super225=_createSuper(effTeaseDamage);_createClass(effTeaseDamage,null,[{key:"factory",value:function factory(amount,type,lewds){var msg=arguments.length>3&&arguments[3]!==undefined?arguments[3]:'';var eff=new effTeaseDamage();eff.amount=amount;eff.type=type;eff.lewds=lewds;eff.castMsg=msg;return eff;}}]);function effTeaseDamage(amount){var _this203;_classCallCheck(this,effTeaseDamage);_this203=_super225.call(this);_this203.amount=amount;_this203.data.id=_this203.data.name=effTeaseDamage.name,_this203.data.duration=0,_this203.data.hidden=0;return _this203;}_createClass(effTeaseDamage,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effTeaseDamage",this);}},{key:"onApply",value:function onApply(){this.data.duration=0;this.parent.parent.Stats.increment('arousal',1*this.amount);if(this.data.duration<1)this.parent.removeItem(this.data.id);this.castMsg=window.gm.util.descFixer(this.parent.parent)('$[Name]$ got aroused by '+this.amount+'.');}},{key:"merge",value:function merge(neweffect){if(neweffect.name===this.data.name){//ignore
//this.onApply();
return false;}}},{key:"onTurnStart",value:function onTurnStart(){this.data.duration-=1;if(this.data.duration<=0)this.parent.removeItem(this.data.id);return{OK:true,msg:''};}},{key:"desc",get:function get(){return effTeaseDamage.name;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effTeaseDamage,value.data);}}]);return effTeaseDamage;}(CombatEffect);/**
 * 
 */var effPoiseDamage=/*#__PURE__*/function(_CombatEffect9){_inherits(effPoiseDamage,_CombatEffect9);var _super226=_createSuper(effPoiseDamage);_createClass(effPoiseDamage,null,[{key:"factory",value:function factory(amount){var msg=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'';var eff=new effPoiseDamage();eff.amount=amount;eff.castMsg=msg;return eff;}}]);function effPoiseDamage(amount){var _this204;_classCallCheck(this,effPoiseDamage);_this204=_super226.call(this);_this204.amount=amount;_this204.data.id=_this204.data.name=effPoiseDamage.name,_this204.data.duration=0,_this204.data.hidden=0;return _this204;}_createClass(effPoiseDamage,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effPoiseDamage",this);}},{key:"onApply",value:function onApply(){if(!window.story.state._gm.enablePoise)return;this.data.duration=0;this.parent.parent.Stats.increment('poise',-1*this.amount);if(this.data.duration<1)this.parent.removeItem(this.data.id);this.castMsg=window.gm.util.descFixer(this.parent.parent)('$[Name]$ poise '+(this.amount>0?'decreased':'increased')+' by '+this.amount+'.');this.parent.parent.updateStance();}},{key:"merge",value:function merge(neweffect){if(neweffect.name===this.data.name){//ignore
return false;}}},{key:"onTurnStart",value:function onTurnStart(){this.data.duration-=1;if(this.data.duration<=0)this.parent.removeItem(this.data.id);return{OK:true,msg:''};}},{key:"desc",get:function get(){return effPoiseDamage.name;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effPoiseDamage,value.data);}}]);return effPoiseDamage;}(CombatEffect);//someone with this eff will gain arousal when hit
var effMasochist=/*#__PURE__*/function(_CombatEffect10){_inherits(effMasochist,_CombatEffect10);var _super227=_createSuper(effMasochist);_createClass(effMasochist,null,[{key:"factory",value:function factory(amount){var eff=new effMasochist();eff.amount=amount;return eff;}}]);function effMasochist(){var _this205;_classCallCheck(this,effMasochist);_this205=_super227.call(this);_this205.amount=8;_this205.data.id=_this205.data.name=effMasochist.name,_this205.data.duration=6,_this205.data.hidden=0;return _this205;}_createClass(effMasochist,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effMasochist",this);}},{key:"onApply",value:function onApply(){if(this.data.duration<1)this.parent.removeItem(this.data.id);}},{key:"merge",value:function merge(neweffect){if(neweffect.name===this.data.name){//ignore
return;}}},{key:"onTurnStart",value:function onTurnStart(){this.data.duration-=1;if(this.data.duration<=0)this.parent.removeItem(this.data.id);return{OK:true,msg:''};}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effMasochist,value.data);}}]);return effMasochist;}(CombatEffect);/**
 * damage over time todo affects only bleedable targets 
 */var effBleed=/*#__PURE__*/function(_CombatEffect11){_inherits(effBleed,_CombatEffect11);var _super228=_createSuper(effBleed);function effBleed(amount){var _this206;_classCallCheck(this,effBleed);_this206=_super228.call(this);_this206.amount=amount;_this206.data.id=_this206.data.name=effBleed.name,_this206.data.duration=0,_this206.data.hidden=0;return _this206;}_createClass(effBleed,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effBleed",this);}},{key:"onApply",value:function onApply(){this.data.duration=3;this.parent.parent.Stats.increment('health',-1*this.amount);}},{key:"merge",value:function merge(neweffect){if(neweffect.name===this.data.name){//ignore
//this.onApply();
return true;}}},{key:"onTurnStart",value:function onTurnStart(){this.data.duration-=1;if(this.data.duration<=0){this.parent.removeItem(this.data.id);}else{this.parent.parent.Stats.increment('health',-1*this.amount);}return{OK:true,msg:''};}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effBleed,value.data);}}]);return effBleed;}(CombatEffect);//the character is in close combat with whom; 
var effGrappled=/*#__PURE__*/function(_CombatEffect12){_inherits(effGrappled,_CombatEffect12);var _super229=_createSuper(effGrappled);_createClass(effGrappled,null,[{key:"factory",value:function factory(){var grappled=new effGrappled(2),grappling=new effGrappling();grappled.source=grappling,grappling.target=grappled;return{targetEff:grappled,sourceEff:grappling};}}]);function effGrappled(amount){var _this207;_classCallCheck(this,effGrappled);_this207=_super229.call(this);_this207.source=null;_this207.data.id=_this207.data.name=effGrappled.name,_this207.data.duration=0,_this207.data.hidden=0;return _this207;}_createClass(effGrappled,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effGrappled",this);}},{key:"onApply",value:function onApply(){this.data.duration=5;this.data.name=this.data.name+"("+this.source.parent.parent.name+")";}},{key:"merge",value:function merge(neweffect){if(neweffect.name===this.data.name){//ignore
//this.onApply();
return true;}}},{key:"onRemove",value:function onRemove(){if(this.source){this.source.parent.removeItem(effGrappling.name);this.source=null;}}},{key:"onTurnStart",value:function onTurnStart(){this.data.duration-=1;if(this.data.duration<=0){this.parent.removeItem(this.data.id);}return{OK:true,msg:''};}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effGrappled,value.data);}}]);return effGrappled;}(CombatEffect);//when a char casts grappling, the target gets effGrappled and the caster gets effGrappling
//if one of the effects got removed, it will also remove the other
var effGrappling=/*#__PURE__*/function(_CombatEffect13){_inherits(effGrappling,_CombatEffect13);var _super230=_createSuper(effGrappling);function effGrappling(targetEffect){var _this208;_classCallCheck(this,effGrappling);_this208=_super230.call(this);_this208.target=targetEffect;_this208.data.id=_this208.data.name=effGrappling.name,_this208.data.duration=0,_this208.data.hidden=0;return _this208;}_createClass(effGrappling,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effGrappling",this);}},{key:"onApply",value:function onApply(){this.data.duration=5;}},{key:"merge",value:function merge(neweffect){if(neweffect.name===this.data.name){//ignore
//this.onApply();
return true;}}},{key:"onRemove",value:function onRemove(){if(this.target){this.target.parent.removeItem(effGrappled.name);this.target=null;}}},{key:"onTurnStart",value:function onTurnStart(){this.data.duration-=1;if(this.data.duration<=0){this.parent.removeItem(this.data.id);}return{OK:true,msg:''};}},{key:"desc",get:function get(){return this.data.name;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effGrappling,value.data);}}]);return effGrappling;}(CombatEffect);var effUngrappling=/*#__PURE__*/function(_CombatEffect14){_inherits(effUngrappling,_CombatEffect14);var _super231=_createSuper(effUngrappling);function effUngrappling(targetEffect){var _this209;_classCallCheck(this,effUngrappling);_this209=_super231.call(this);_this209.target=targetEffect;_this209.data.id=_this209.data.name=effUngrappling.name,_this209.data.duration=0,_this209.data.hidden=0;return _this209;}_createClass(effUngrappling,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effUngrappling",this);}},{key:"onApply",value:function onApply(){this.parent.removeItem(this.target.id);this.parent.removeItem(this.data.id);}},{key:"merge",value:function merge(neweffect){if(neweffect.name===this.data.name){//ignore
//this.onApply();
return true;}}},{key:"onTurnStart",value:function onTurnStart(){this.data.duration-=1;if(this.data.duration<=0)this.parent.removeItem(this.data.id);return{OK:true,msg:''};}},{key:"desc",get:function get(){return this.data.name;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effUngrappling,value.data);}}]);return effUngrappling;}(CombatEffect);var effStunned=/*#__PURE__*/function(_CombatEffect15){_inherits(effStunned,_CombatEffect15);var _super232=_createSuper(effStunned);_createClass(effStunned,null,[{key:"factory",value:function factory(){var duration=arguments.length>0&&arguments[0]!==undefined?arguments[0]:2;var eff=new effStunned();eff.startduration=duration;return eff;}}]);function effStunned(){var _this210;_classCallCheck(this,effStunned);_this210=_super232.call(this);_this210.data.id=_this210.data.name=effStunned.name,_this210.data.duration=_this210.data.startduration=2;return _this210;}_createClass(effStunned,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effStunned",this);}},{key:"onApply",value:function onApply(){this.data.duration=2;}},{key:"merge",value:function merge(neweffect){if(neweffect.name===this.data.name){//extends duration
this.onApply();return true;}}},{key:"onTurnStart",value:function onTurnStart(){this.data.duration-=1;if(this.data.duration<=0)this.parent.removeItem(this.data.id);return{OK:true,msg:''};}},{key:"desc",get:function get(){return this.data.name;}},{key:"icon",get:function get(){return window.gm.images.ic_stun();}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effStunned,value.data);}}]);return effStunned;}(CombatEffect);var effFlying=/*#__PURE__*/function(_CombatEffect16){_inherits(effFlying,_CombatEffect16);var _super233=_createSuper(effFlying);function effFlying(){var _this211;_classCallCheck(this,effFlying);_this211=_super233.call(this);_this211.data.id=_this211.data.name=effFlying.name,_this211.data.duration=0;return _this211;}_createClass(effFlying,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effFlying",this);}},{key:"onApply",value:function onApply(){this.data.duration=4;}},{key:"merge",value:function merge(neweffect){if(neweffect.name===this.data.name){//applying effect again toggles it !
return function(me){return function(Effects){Effects.removeItem(me.data.id);};}(this);}}},{key:"onTurnStart",value:function onTurnStart(){this.data.duration-=1;if(this.data.duration<=0)this.parent.removeItem(this.data.id);//todo stop flying if no more stamina
return{OK:true,msg:''};}},{key:"desc",get:function get(){return this.data.name;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effFlying,value.data);}}]);return effFlying;}(CombatEffect);var effFairyLight=/*#__PURE__*/function(_CombatEffect17){_inherits(effFairyLight,_CombatEffect17);var _super234=_createSuper(effFairyLight);_createClass(effFairyLight,null,[{key:"factory",value:function factory(){var duration=arguments.length>0&&arguments[0]!==undefined?arguments[0]:2;var eff=new effFairyLight();eff.startduration=duration;return eff;}}]);function effFairyLight(){var _this212;_classCallCheck(this,effFairyLight);_this212=_super234.call(this);_this212.data.id=_this212.data.name=effFairyLight.name,_this212.data.duration=_this212.data.startduration=2;return _this212;}_createClass(effFairyLight,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effFairyLight",this);}},{key:"onApply",value:function onApply(){this.data.duration=6;}},{key:"merge",value:function merge(neweffect){if(neweffect.name===this.data.name){//extends duration
this.onApply();return true;}}},{key:"onTurnStart",value:function onTurnStart(){this.data.duration-=1;if(this.parent.parent.Stats.get('rst_light').value<0){//if vulnerable to light, the mob will guard instead of attack
this.parent.parent.addEffect(new effHesitant(),'FairyLight:Hesitant');}if(this.data.duration<=0){this.parent.removeItem(this.data.id);}return{OK:true,msg:''};}},{key:"desc",get:function get(){return this.data.name;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effFairyLight,value.data);}}]);return effFairyLight;}(CombatEffect);var effHesitant=/*#__PURE__*/function(_CombatEffect18){_inherits(effHesitant,_CombatEffect18);var _super235=_createSuper(effHesitant);//when active, the Mob should back away; needs to be handled in Mob-AI
function effHesitant(){var _this213;_classCallCheck(this,effHesitant);_this213=_super235.call(this);_this213.data.id=_this213.data.name=effHesitant.name,_this213.data.duration=0;return _this213;}_createClass(effHesitant,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effHesitant",this);}},{key:"onApply",value:function onApply(){this.data.duration=6;}},{key:"merge",value:function merge(neweffect){if(neweffect.name===this.data.name){//extends duration
this.onApply();return true;}}},{key:"onTurnStart",value:function onTurnStart(){this.data.duration-=1;if(this.data.duration<=0){this.parent.removeItem(this.data.id);}return{OK:true,msg:''};}},{key:"desc",get:function get(){return this.data.name;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effHesitant,value.data);}}]);return effHesitant;}(CombatEffect);/**
 * this effect is usd as a marker to block spawning again while there is still a spawn
 *
 * @class effCallHelp
 * @extends {CombatEffect}
 */var effCallHelp=/*#__PURE__*/function(_CombatEffect19){_inherits(effCallHelp,_CombatEffect19);var _super236=_createSuper(effCallHelp);//summons someone
function effCallHelp(){var _this214;_classCallCheck(this,effCallHelp);_this214=_super236.call(this);_this214.data.id=_this214.data.name=effCallHelp.name,_this214.data.duration=2;_this214.data.spawns=[];return _this214;}_createClass(effCallHelp,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effCallHelp",this);}},{key:"onApply",value:function onApply(){this.data.duration=2;}},{key:"merge",value:function merge(neweffect){if(neweffect.name===this.data.name){//ignore
return true;}}},{key:"onTurnStart",value:function onTurnStart(){this.data.duration-=1;if(this.data.duration===0){//spawn after delay
this.data.spawns.push(window.gm.Encounter.spawnChar(this.data.item,this.data.faction,this.parent.parent.level));}else if(this.data.spawns.length>0){//remove effect after spawns are killed
var remove=true;var mobs=window.story.state.combat.enemyParty.concat(window.story.state.combat.playerParty);for(var i=mobs.length-1;i>=0;i--){if(this.data.spawns.includes(mobs[i].name)&&!mobs[i].isKnockedOut())remove=false;}if(remove===true)this.parent.removeItem(this.data.id);}return{OK:true,msg:''};}},{key:"configureSpawn",value:function configureSpawn(item,faction){var amount=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;this.data.item=item,this.data.faction=faction,this.data.amount=amount;}},{key:"desc",get:function get(){return effCallHelp.name;}},{key:"shortDesc",get:function get(){if(this.data.spawns.length>0)return"Summoned a"+this.data.item;else return"Summons "+this.data.item+" in "+this.data.duration+" turns";}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effCallHelp,value.data);}}]);return effCallHelp;}(CombatEffect);//transform the mob into different mob
var effTransformSelf=/*#__PURE__*/function(_CombatEffect20){_inherits(effTransformSelf,_CombatEffect20);var _super237=_createSuper(effTransformSelf);function effTransformSelf(){var _this215;_classCallCheck(this,effTransformSelf);_this215=_super237.call(this);_this215.data.id=_this215.data.name=effTransformSelf.name,_this215.data.duration=1;_this215.data.spawns=[];return _this215;}_createClass(effTransformSelf,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effTransformSelf",this);}},{key:"onApply",value:function onApply(){//this.data.duration = 0;
}},{key:"merge",value:function merge(neweffect){if(neweffect.name===this.data.name){//ignore
return true;}}},{key:"onTurnStart",value:function onTurnStart(){this.data.duration-=1;if(this.data.duration===0){//spawn after delay
for(var i=0;i<this.data.item.length;i++){//todo how to transform into higher level
if(i===0){this.data.spawns.push(window.gm.Encounter.replaceChar(this.data.item[i],this.parent.parent));}else{this.data.spawns.push(window.gm.Encounter.spawnChar(this.data.item[i],this.parent.parent.faction,this.parent.parent.level));}}var _h=this.parent.parent.health();_h=-0.7;//_h=(_h.value/_h.max)-1
var mobs=window.story.state.combat.enemyParty.concat(window.story.state.combat.playerParty);for(var i=mobs.length-1;i>=0;i--){if(this.data.spawns.includes(mobs[i].name))mobs[i].Stats.scaleValue('health',_h);//decrease new mobs health;
}}//todo reverse transformation after time,damage,energyloss...
return{OK:true,msg:''};}//items is a list of mob-ids; the first one will replace this mob, the others will be added 
},{key:"configureSpawn",value:function configureSpawn(items){if(items instanceof Array)this.data.item=items;else this.data.item=[items];}},{key:"desc",get:function get(){return effTransformSelf.name;}},{key:"shortDesc",get:function get(){if(this.data.spawns.length>0)return"Transformed into"+this.data.item[0];else return"Transforms into "+this.data.item[0];}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effTransformSelf,value.data);}}]);return effTransformSelf;}(CombatEffect);var effKamikaze=/*#__PURE__*/function(_CombatEffect21){_inherits(effKamikaze,_CombatEffect21);var _super238=_createSuper(effKamikaze);_createClass(effKamikaze,null,[{key:"factory",//kill yourslef and damage all enemys
value:function factory(style){var duration=arguments.length>1&&arguments[1]!==undefined?arguments[1]:2;var eff=new effKamikaze();eff.data.duration=duration,eff.style=style;return eff;}}]);function effKamikaze(){var _this216;_classCallCheck(this,effKamikaze);_this216=_super238.call(this);_this216.data.id=_this216.data.name=effKamikaze.name,_this216.data.duration=0,_this216.style=0;return _this216;}_createClass(effKamikaze,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("effKamikaze",this);}},{key:"onApply",value:function onApply(){}},{key:"merge",value:function merge(neweffect){if(neweffect.name===this.data.name){//ignore
return true;}}},{key:"onTurnStart",value:function onTurnStart(){var result={OK:true,msg:''},s=window.story.state;this.data.duration-=1;if(this.data.duration<=0){var _targets=s.combat.playerParty.concat(s.combat.enemyParty);var _iterator132=_createForOfIteratorHelper(_targets),_step132;try{for(_iterator132.s();!(_step132=_iterator132.n()).done;){var n=_step132.value;n.addEffect(effDamage.factory(10,'slash'));//TODO dmg = ? should use calcAttack
}}catch(err){_iterator132.e(err);}finally{_iterator132.f();}this.parent.removeItem(this.data.id);this.parent.parent.Stats.increment("health",-1*h-1);result.msg=this.parent.parent.name+' decides to explode in a fiery mess. ';}/*let h = this.parent.parent.Stats.get('health').value, hmax= this.parent.parent.Stats.get('healthMax').value;
        if(h/hmax<0.5){ //if health is low trigger effect and kill yourself
            
        }*/return result;}},{key:"configureSpawn",value:function configureSpawn(item,faction){var amount=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;this.data.item=item,this.data.faction=faction,this.data.amount=amount;}},{key:"desc",get:function get(){return effKamikaze.name;}},{key:"style",set:function set(style){this._style=style;},get:function get(){return this._style;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(effKamikaze,value.data);}}]);return effKamikaze;}(CombatEffect);//todo transformSelf: replace the caster with a different class & regenerate energy  
//restricted: stuck in cobwebs, goo
//skills
//////////////--   abilities   --///////////////////////
// an ability (cooking, climbing) is a stat ? always present, represented by number, can be modified by effects
// or an effect ? might not be present, has a cooldown
var Ability=/*#__PURE__*/function(_Stat21){_inherits(Ability,_Stat21);var _super239=_createSuper(Ability);_createClass(Ability,null,[{key:"setup",//double check if ability is present !
value:function setup(context,base,kind){var _stat=new Ability();var _n=_stat.data;_n.id="sk_"+kind,_n.base=base,_n.value=base,_n.limits=[{max:1000,min:-1000}];context.addItem(_stat);_stat.Calc();}},{key:"info",value:function info(id){return id;}}]);function Ability(){_classCallCheck(this,Ability);return _super239.call(this);}_createClass(Ability,[{key:"toJSON",value:function toJSON(){return window.storage.Generic_toJSON("Ability",this);}},{key:"desc",get:function get(){var msg="";switch(id){case"sk_Cooking":msg="You know how to cook a tasty meal. Improving this skill increases your chance to get extra-meals and allows to cook more difficult meals.";break;case"sk_Diving":msg="You are more comfortable to dive in deep water. You might still require the proper tools like diver googles and scuba gear.";break;case"sk_Swimming":msg="You are confident in your ability to swim larger distance. Big waves and dangerous currents are still a threat. You require less energy with each rank.";break;case"sk_Climbing":msg="Beeing able to climb rocks and walls, as long as they are not to smooth. You might still require the proper tools like rope and pick.";break;case"sk_Fishing":msg="Finding got spots for fishing and making use of net and fishing rod to catch them.";break;case"sk_Herbalist"://Funguist/Insectoist
msg="Its easier to you to identify all kind of plants. Increases chances to find more rare plants or to give extra resources.";break;case"sk_Looter"://Scrapper
msg="Increases chance to find lootable containers or loot.";break;case"sk_Scrapper":msg="Salvaging more craftmaterials from breaking down things.";break;case"sk_WoodWorker"://SteelWorker, StoneWorker
msg="Creating useful things from wood like tools and furniture is your speciality.";break;case"sk_Stitching":msg="Fixing cloths or creating new one is possible for you.";break;default:throw new Error(this.id+' is unknown');}return msg;}},{key:"name",get:function get(){return this.data.id;}}],[{key:"fromJSON",value:function fromJSON(value){return window.storage.Generic_fromJSON(Ability,value.data);}}]);return Ability;}(Stat);/*skAlchemist
 * Lv1 - can create potions from 1 ingredient
 * Lv2 - can create potion from 2 ingredients
 * Lv3 - can combine 2 potions into better one
 * Lv4 - can use 3 ingredients
 */window.gm.StatsLib=function(StatsLib){//...stats
window.storage.registerConstructor(Stat);window.storage.registerConstructor(stHealth);window.storage.registerConstructor(stRelation);window.storage.registerConstructor(stFetish);window.storage.registerConstructor(stAgility);window.storage.registerConstructor(stCharisma);window.storage.registerConstructor(stEndurance);window.storage.registerConstructor(stIntelligence);window.storage.registerConstructor(stLuck);window.storage.registerConstructor(stPerception);window.storage.registerConstructor(stStrength);window.storage.registerConstructor(stResistance);window.storage.registerConstructor(stEnergy);window.storage.registerConstructor(stWill);window.storage.registerConstructor(stSatiation);window.storage.registerConstructor(stArousal);window.storage.registerConstructor(stCorruption);window.storage.registerConstructor(stSavageness);window.storage.registerConstructor(stArmor);window.storage.registerConstructor(stPoise);//...effects
window.storage.registerConstructor(effCallHelp);window.storage.registerConstructor(effCombatRecovery);window.storage.registerConstructor(effDamage);window.storage.registerConstructor(effDetermined);window.storage.registerConstructor(effHunger);window.storage.registerConstructor(effLibido);window.storage.registerConstructor(effSanity);window.storage.registerConstructor(effFlying);window.storage.registerConstructor(effBleed);window.storage.registerConstructor(effCombined);window.storage.registerConstructor(effFairyLight);window.storage.registerConstructor(effGrappled);window.storage.registerConstructor(effGrappling);window.storage.registerConstructor(effUngrappling);window.storage.registerConstructor(effEnergized);window.storage.registerConstructor(effNotTired);window.storage.registerConstructor(effPillEffect);window.storage.registerConstructor(effPoiseDamage);window.storage.registerConstructor(effTeaseDamage);window.storage.registerConstructor(effTired);window.storage.registerConstructor(effStunned);window.storage.registerConstructor(effTransformSelf);window.storage.registerConstructor(effGuard);window.storage.registerConstructor(effProtect);window.storage.registerConstructor(effHeal);window.storage.registerConstructor(effMasochist);window.storage.registerConstructor(effEnergyDrain);window.storage.registerConstructor(effHorsePower);window.storage.registerConstructor(effLapineSpeed);window.storage.registerConstructor(effMutateBunny);window.storage.registerConstructor(effMutateHorse);window.storage.registerConstructor(effMutateWolf);window.storage.registerConstructor(effMutateCat);window.storage.registerConstructor(effMutateHuman);window.storage.registerConstructor(effGrowBreast);window.storage.registerConstructor(effGrowVulva);window.storage.registerConstructor(effLewdMark);window.storage.registerConstructor(effInHeat);window.storage.registerConstructor(effInRut);window.storage.registerConstructor(effSpermDecay);window.storage.registerConstructor(effButtPlugged);window.storage.registerConstructor(effVaginalFertil);window.storage.registerConstructor(effVaginalPregnant);//non-combat skills
window.storage.registerConstructor(Ability);StatsLib.Ability=Ability;return StatsLib;}(window.gm.StatsLib||{});
/* twine-user-script #2: "Story JavaScript" */
</script><tw-tag name="_fragm_" color="blue"></tw-tag><tw-tag name="template" color="orange"></tw-tag><tw-tag name="_back_" color="gray"></tw-tag><tw-tag name="_nosave_" color="yellow"></tw-tag><tw-tag name="_nodeffered_" color="yellow"></tw-tag><tw-tag name="_isdeffered_" color="brown"></tw-tag><tw-tag name="_noshortkey_" color="brown"></tw-tag><tw-passagedata pid="1" name="Info_Jake" tags="_back_" position="100,100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
Jake is here.&lt;/br&gt;
You barely know anything about him.&lt;/br&gt;
[[Back|_back_]]&lt;/br&gt;&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="2" name="Talk_Cyril" tags="_back_" position="225,100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
Cyril is here.&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.printOutput(&quot;Well, a bulky man in a robe. His face is hidden by the hood.&quot;)&#39;&gt;Look at&lt;/a&gt;&lt;/br&gt;
&lt;/br&gt;&lt;div id=&#39;output&#39;&gt;&lt;/div&gt;&lt;/br&gt;   &lt;!--message is rendered here--&gt;
[[Back|_back_]]&lt;/br&gt;&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="3" name="Info_Mom" tags="_back_" position="350,100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
Your mom is here.&lt;/br&gt;
&lt;% if(window.gm.player.Rel.get(&#39;Mom&#39;).value&gt;10){ %&gt;
She gives you a hug.
&lt;% } else { %&gt;
You can see a disapproving look on her face.
&lt;% }  %&gt;
&lt;/br&gt;
[[Back|_back_]]&lt;/br&gt;&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="4" name="Info_Trent" tags="_back_" position="475,100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
You walk over to Trent. He is a horse-man.  
&lt;/br&gt;[[Back|_back_]]&lt;/br&gt;&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="5" name="TrentVictory" tags="_nosave_" position="600,100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;% if(window.gm.quests.getMilestoneState(&quot;qBondageKink&quot;).id&lt;=300){ window.gm.quests.forceQuestMilestone(&quot;qBondageKink&quot;,400,300);%&gt;
Finally you found a weak spot in the defense of the stud. Reluctantly he gives up fighting.  &lt;/br&gt;&lt;!--todo--&gt;
&lt;p class=&quot;dev&quot;&gt;&quot;Fine, you won...this time.&quot;&lt;/p&gt; 
You dont have any breath left to give him a quirky response. &lt;/br&gt;
His comrades strut over to you and you are worried if they will give you some trouble. &lt;/br&gt;
But they just snicker and mock your opponent.&lt;/br&gt;
&lt;p class=&quot;tNPC2&quot;&gt;&quot;Whats up trent ? Did this whimp give your pony-ass a hard spanking.&quot;&lt;/p&gt;
&lt;span class=&quot;dev&quot;&gt;&quot;I&#39;m not a pony you fuckers !&quot;&lt;/span&gt; he yells. Being called a pony seems really to piss him off.&lt;/br&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;I&#39;m on my way then.&quot;&lt;/p&gt; Better to leave now before things get troublesome.&lt;/br&gt;
&lt;p class=&quot;author&quot;&gt;This is right now the end of the story. As you can see there is need for a lot of polishing.&lt;/p&gt;
[[Forward to new places]]&lt;/br&gt;
&lt;%} else {%&gt;
&quot;You just were lucky to pull that trick. Next time I will show you - SLAVE.&quot;
...
&quot;You are really though.&quot; admits the horse &quot;or I&#39;m just a little out of shape.&quot;
...
[[The winner takes it all]]
&lt;p class=&quot;tPC&quot;&gt;&quot;So horsie how about we go for a ride?&quot;&lt;/p&gt; 
Trent looks up to you, he already knows what that means. | Trent looks up to you with lust in his eyes. You should be careful not to end under his muscular body. | The recent acitivties got him quite pent up. But not that much that he will get involved with you. Maybe if you know each other better...  
&lt;a0 onclick=&#39;window.gm.postVictory({flee:false});&#39;&gt;Walk away&lt;/a&gt;
&lt;%}%&gt;
&lt;/br&gt;&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="6" name="TrentSubmit" tags="_nosave_" position="725,100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;% if(window.gm.quests.getMilestoneState(&quot;qBondageKink&quot;).id&lt;=300){ %&gt;
&lt;%} else {%&gt;
&lt;%}%&gt;
That didnt went as planned. That bully delivered a though blow and knocked you out. It didnt felt that lethal but the game has decided that you earned your death. &lt;/br&gt;
&lt;p class=&quot;tPC&quot;&gt;&#39;I need to do some leveling and get stronger or find another way to give myself a head start. Maybe the alchemist could help.&#39;&lt;/p&gt;
&lt;a0 onclick=&#39;window.gm.postDefeat();&#39;&gt;Black out&lt;/a&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="7" name="Leon_Arrival" tags="" position="850,100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
As you make your way back to your room, you run right into Cyril who is accompanied by another person.
&lt;p class=&quot;tNPC2&quot;&gt;&quot;Ah, there you are. Please welcome Leon, he is also an acolythe and just arrived here some hours ago.&quot;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;Good afternoon Leon, I&#39;m &lt;%= window.gm.player.name%&gt; and I&#39;m seeing forward to work together.&quot;&lt;/p&gt; 
Well, actually you dont know what work that will be but whatever...&lt;/br&gt;
He is around your age, maybe 1 or 2 years off and looks pretty self confident and pampered.&lt;/br&gt;
&lt;p class=&quot;tNPC3&quot;&gt;&quot;Hello &lt;%= window.gm.player.name%&gt;. Master Cyril is showing me around this fabolous location. I feel chosen to be in such a magical place.&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC3&quot;&gt;&quot;For sure only the best of our circle can be selected to study here and learn the ways of the temple.&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC3&quot;&gt;&quot;Just help me. I cant remember your face and name. You werent in the Aborus-course, or? &quot;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&#39;Uh oh. Thats not good - he could blow my cover.&#39;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;No I was in a different course, a different part of the temple school even.&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC2&quot;&gt;&quot;I&#39;m sorry but we really need to move on. For sure you will find time later for chit-chat.&quot;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;Yes, I&#39;m in a hurry too.&quot;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&#39;That was close. How am I&#39;m going to keep my cover up?&#39;&lt;/p&gt;
Continue to your [[room|DngSY_Your_Room]]
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="8" name="YouDiedOnce" tags="" position="975,100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;
window.gm.quests.forceQuestMilestone(&quot;qDiedAgain&quot;,100,2);%&gt;
Darkness... &lt;/br&gt;
After some moments your vision fades in. &lt;/br&gt; 
&lt;p class=&#39;tPC&#39;&gt;&quot;What happend? Why I&#39;m sitting in a pool of ...goo?&quot;&lt;/p&gt;
&quot;Choosen one, this is a shrine of restoration! ...&quot; a priestess in a white robe with purple borders approachs you.
&lt;!--todo--&gt;
&lt;p class=&#39;tPC&#39;&gt;&quot;So I died? And after death I return here?&quot;&lt;/p&gt;
&quot;Those choosen by the goods might be revived in a shrine of restoration after their death or collaps of mind.&quot;
&lt;p class=&#39;tPC&#39;&gt;&quot;Collaps of mind? I just need to get stunned and will be sent back here?&quot;&lt;/p&gt;
&lt;p class=&#39;dev&#39;&gt;As a safeguard against mental trauma (*1) the players neural activity is supervised. If a certain amount of stress is detected (*2), the safeguard is triggered.
&lt;/br&gt;*1): This applys not just to painful trauma but also marvelous sensations to avoid addictive states (*3).
&lt;/br&gt;*2): Chances that the trigger is delayed or supressed might decrease if the user is inclined to the situation and has the proper mindset.
&lt;/br&gt;*3): According to user agreement §34-f2, the service-provider is not responsible for addiction caused by the use of the game.
&lt;/p&gt;
&lt;p class=&#39;tPC&#39;&gt;&quot;Addictive states? I&#39;m pretty sure I will not get addicted on getting killed.&quot;&lt;/p&gt;
You decide that you have been sitting in this sizzling pool of mysterious liquid long enough and rise to your feet to step out of it.
You notice that you are naked and try to hide your privates with your hands. 
&lt;p class=&#39;tPC&#39;&gt;&quot;Uhm...where is my gear?&quot;&lt;/p&gt;
&quot;The gods restored your body and mind but your gear is nowwhere to be found.&quot;
&lt;p class=&#39;tPC&#39;&gt;&quot;Oh come on should I ran around in my birthday suite?&quot;&lt;/p&gt;
&quot;Please take this cloth and staff as they are blessed by the gods to help you to live up to your goal.&quot;
&lt;p class=&#39;dev&#39;&gt; For testing purpose the game is set to rougelike mode: on death you will loose your equipment and get the starter-gear. 
But you keep your stats and skills (*1).  
&lt;/br&gt;*1): It might occur that the questline has to be started from the beginning. We are doing our best to solve the problem in the next updates. 
&lt;/p&gt; 
&lt;p class=&#39;tPC&#39;&gt;&quot;Start the questline from the beginning? I really hope they get that fixed soon.&quot;&lt;/p&gt;
&lt;div&gt;&lt;a0 onclick=&#39;window.story.show(&quot;ServerDisconnected&quot;);&#39;&gt;Next&lt;/a&gt;&lt;/br&gt;&lt;/div&gt;  &lt;!--todo forward time to evenning--&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="9" name="ServerDisconnected" tags="_nosave_" position="1100,100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.leaveVR();%&gt;
&lt;p class=&#39;div_alarm&#39;&gt;Server connection error&lt;/p&gt;
&lt;/br&gt;&lt;p class=&quot;tPC&quot;&gt;&quot;Great, I lost connection to the game server. Maybe it does reconnect...&quot; &lt;/p&gt;
You wait for some time but nothing happens,
&lt;p class=&quot;tPC&quot;&gt;&quot;I&#39;m tired anyway. I will check tomorrow if I can reconnect.&quot; &lt;/p&gt;
&lt;div&gt;&lt;/br&gt;[[Next|Your Bedroom]]&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="10" name="YouDiedWithCursedGear" tags="" position="1225,100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&quot;Choosen one, this is a shrine of restoration!&quot; ... the acolyte starts heir rant.&lt;/br&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;Yeah, I know. I just got ass kicked again. At least I got rid of that freaking cursed... &quot;&lt;/p&gt;&lt;/br&gt;
But that damned thing is still there!&lt;/br&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;Hey, why is everthing gone except this?&quot;&lt;/p&gt;
&quot;At times the heros burden is increased by evil deeds and his epic story is extended further by finding closure for his curse.&quot; the priestess chants, holding out heir hands upward to heir gods.&lt;/br&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;So I&#39;m stuck with cursed gear but have to let go the good one?&quot;&lt;/p&gt;
&lt;p class=&#39;dev&#39;&gt;Some gear will stick to you. That doesnt need to be cursed one. In fact you can buy special gear that is bonded to you.&lt;/p&gt;
&lt;/br&gt;&lt;a0 id=&#39;1&#39; onclick=&#39;foo(this)&#39;&gt;This sucks&lt;/a&gt; &lt;a0 id=&#39;2&#39; onclick=&#39;foo(this)&#39;&gt;Would have been to easy&lt;/a&gt; &lt;a0 id=&#39;3&#39; onclick=&#39;foo(this)&#39;&gt;Its an incentive to not die&lt;/a&gt;&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt; function foo(select){
    window.gm.quests.forceQuestMilestone(&quot;qDiedAgain&quot;,200,100);
    window.story.show(&quot;ServerDisconnected&quot;);
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="11" name="YouDiedBeforeOrgasm" tags="" position="100,225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
Delicate sensations builds in your nethers. 
&#39;Uh..yeah.. thats nice. &#39;
Longing for the carnal pleasure that this is promissing, you lose your eyes. But as you open them, the stimulation is gone and your surrounding is still black.
&quot;Whut ?!  What happend?&quot;
&quot;Choosen one, this is a shrine of restoration!&quot; 
&quot;Noo, the fun was just starting. Why are I&#39;m suddenly at the respawn again.&quot;
&quot;The gods saved you before your mind was breaking apart by onslaught of unsettling feelings.&quot;
&quot;Unsettling feelings? I didnt feel unsettleed by the prospect of getting fucked in the slightest!&quot;
&#39;Didn&#39;t they say that they supervise my stress-level and trigger a safeguard?&#39;
&quot;Hey dev !&quot; you scream out &quot;Can you hear me?&quot;
&quot;Anyone there listening? I want some adjustments here please.&quot;
As it seems dev-gods are right now not around or dont bother to answer to you.
&#39;Damit, I will just quit for now.&#39; 
[[Leave game]]  &lt;!--todo--&gt;
... receive chat from dev
&quot;Its difficult to separate the good stress from the bad one. Every persons has a different tolerance and it can change over time. Currently its in general set to be more on the safe side.&quot;
There isnt a slider controller or switch to simply adjust the setting to your liking. I can try to tweak it in a way.
...
I got kicked out again. 
&quot;That I expected. I wasnt able to change the setting directly. But I could activate the auto-tuning.&quot;
&quot;auto-tuning?.&quot;
&quot;Yes, the game will learn your individual excitation. Just calm yourself when you get in a situation you would like to hold on. It might be necessary to rerun a situation to improve the reaction.&quot;
&quot;OK, I will try it again.&quot;
&quot;Be careful, though. This can also lead to the fact that you have to endure unpleasant experiences longer.&quot;
&quot;I will keep that in mind.&quot; 
&lt;p class=&#39;author&#39;&gt;Scenes might gradually unlock depending how often you see them and how you react (also to other situations). &lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="12" name="Skills" tags="" position="225,225" size="100,100">Disrobe: cast on Self or other; does not remove jewellery, enhanted or summoned armor
a naked body is less protected but might increase tease damage; exhibitionist streak increases targets arousal 
&quot;Why the fuck should I want to disrobe mids in combat?&quot;

Reduce Suffering: cast on Self or other; reduces willpower damage by physical pain but also makes you less sensitiv to other physical stimulation
lets you endure stressful situations better and reduces blackout chance;increases masochism tendency;
&quot;other physical stimulation means sex?&quot;

Animal Comprehension: cast on self or other; silently understand what animals say
having a chorus of thrilled animals in your mind might cause headache 
&quot;Now I can discuss the hen-egg-problem with chicken&quot;

Regeneration: cast on self or other; healing over time ; might increase fertility/virility for a limited time
overhealing friendly target might get them randy
&quot;Those side effects dont appear that terrible.&quot;

Hedgehog Eyes: you can see in the dark - a little bit better then most humans but far as good as a common cat
&quot;I would prefer cat-eyes. Spider-senses would be even better. But you have to take what you get.&quot;</tw-passagedata><tw-passagedata pid="13" name="SpecialItems" tags="" position="350,225" size="100,100">Orb of Tremor: a floating orb of variyng size and mass that slings itself against an enemy to deal blunt damage;
training allows to give better control about the motion and to navigate tight spaces
upgraded version can be used as spydrone
&quot;What could it be good for to squeeze a solid ball into a tight?.&quot;

SnakeRope: a leathery rope that is at least a dozen meters; it can move on its own and this movement can be controlled by whom held  
useful as climbing aid or to bind something up
&quot;Somehow this remmebers me at Indys whip.&quot;

Vial of slipery: a small vial with an unending supply of some slimy, greasy liquid of most likely organic origin.
can be used as grease for machinery or other parts that need lubrication. 
upgraded version can change color and taste
&quot;Unending huh? Will the world drown in goo if i put it upside down?&quot;</tw-passagedata><tw-passagedata pid="14" name="HowWillKnow" tags="" position="475,225" size="100,100">Its not like you do hand out blowjobs in real. This is virtual, right? No one will know beause this dude is just a mob.</tw-passagedata><tw-passagedata pid="15" name="PostDefeatCombat" tags="" position="600,225" size="100,100">&lt;devnote&gt;&quot;We are happy to announce that we have extended combat with exceptional new possibilities to allow more variety in tactics and better chances for certain character builds.
We would like to thank our player for the constructive criticism and are intent on your feedback.
Here is a short description what we changed:
Until now you had 2 options to defeat someone: kill them or fill up their arousal-meter.
If you get your health drowned but the foe is horny enough, there is a chance that combat switches over to sexual innuendo mode.
If you are able to wear out the foe before you do (*1), you score a win. 
So get out their and do some loving!
*1) balancing is still in progress&quot;&lt;/devnote&gt;
&quot;OOhKKeyyy. So this is now a rape-game?&quot;</tw-passagedata><tw-passagedata pid="16" name="PostDefeatCombat2" tags="" position="725,225" size="100,100">&quot;That brute is just to though. My staff doesnt deal enough damage.&quot;
You dodge another attack barely.
&quot;And he has that salacious grin on his face.&quot;
... You tease him until is meter is nearly full. But this just gets him enraged further.
You try to block him with your staff, but the smash just pushed the breath out of you.
He uses just that short moment and is on you, ripping your clothes away.
&quot;Ieekh&quot; you black out
&quot;Ieekh&quot; you are pretty sure that you already had this situation before and expect the safeguard to get you out of this. But it doesnt trigger.
...</tw-passagedata><tw-passagedata pid="17" name="GetPrincessBackSafe" tags="" position="850,225" size="100,100">Your task is to escort Princess Eve safely back to her step-mother, the queen regent.
She made clear that save means healthy with all body parts attached and - that she mentioned three times - as a virgin.
So you not only have to defend her against foes, but also the advances of suitors. The princess trys hard to be not a burden and to stay chaste.
But the primal urges of a youg girl in her age grow stronger...</tw-passagedata><tw-passagedata pid="18" name="RockFlowers" tags="" position="975,225" size="100,100">You have to collect a bunch of flowers growing on Mt.Scree for the local alchemist.
While this seems to be easy at first, it gets quickly difficult:
- climbing is not your thing; you need to borrow that snakerope for a favor
- harpies are trying to mate with you as does an oversized eagle
- Rams ram you 
- a snow-leopard-lady is prowling around for some nice, hard meat to stuff herself full with
Maybe you can play those 4 partys against each other</tw-passagedata><tw-passagedata pid="19" name="PantyPantsy" tags="" position="1100,225" size="100,100">&lt;Trader&gt;&quot;No thanks, Im not wasting my good money for some useless scrap.&quot;&lt;/Trader&gt;
&quot;But those arent useless! Everyone here needs an sword.&quot;
&lt;Trader&gt;&quot;Everyone here already HAS as sword. Except those that cant afford one.&quot;&lt;/Trader&gt;
&quot;Oh come on. Sell them to a smith so that he can forge them into something useful then.&quot;
&lt;Trader&gt;&quot;Hmm, just because you are so persistant about this I offer you this: 1 coin for each.&quot;&lt;/Trade&gt;
&quot;1 coin! You sell them for 20!&quot;
&lt;Trader&gt;&quot;Yes, but I have to refurbish them you know.&quot;&lt;/Trader&gt;
&lt;Trader&gt;&quot;... scrap the blood and gore off them, polish them, put a price-label on each...But just keep them if you are fond of them&quot;&lt;/Trader&gt;
&#39;I can&#39;t even use those on my own.&#39;
[[Fine. I sell them]][[Nope]]
...
&lt;Trader&gt;&quot;A pleasure to make business with you. If you are really interested in making money, I have a job for you.&lt;/Trader&gt;
&lt;Trader&gt;I got some request for slips.&lt;/Trader&gt;
&quot;Slips? You mean underwear?&quot;
&lt;Trader&gt;Yes. Some fine female underwear. They just have to be ... used.&lt;/Trader&gt;
&quot;Used. Who on earth would want to buy dirty underwear?&quot;
&lt;Trader&gt;Not dirty! Not really dirty. Well, its kinda odd I agree. But that request was from a trader from the eastern sea. Nut sure what kind of customers he has. Those eastern guys are strange anyway.&lt;/Trader&gt;
&quot;If - and I&#39;m just saying IF - I would do that, what would you pay me?&quot;
&lt;Trader&gt;Lets see, I can pay you half of what I get. Thats around 500 coins but only if you gather at least 5. &lt;/Trader&gt;
&quot;Only half? I do all the work and only get 50% of your profit?&quot;
&lt;Trader&gt;Hey I have work with this too. Filling out papers, ordering shipment, alculating taxes...&lt;/Trader&gt;
&quot;And just some random underwear?&quot;
&lt;Trader&gt;Oh no. They have to be worn by dryads.&lt;/Trader&gt;
&quot;Dryads? Where can I find dryads? ..And do they really wear cloths at all?&quot;
&lt;Trader&gt;Dryads should live in forests I assume. If they wear cloths I &#39;m not sure of&#39;.&lt;/Trader&gt;
[[I will do it]]
&quot;So did you sell those slips?&quot;
&lt;Trader&gt;&quot;Yes and no. I sold them, but only for 5.&quot;&lt;/Trader&gt;
&quot;Only 5 each?&quot;
&lt;Trader&gt;&quot;No 5 in total. He rumbled something about that they werent smelly enough. Its diffiult with those guys you know. They barely cut to the point.&quot;&lt;/Trader&gt;
&quot;Oh man, all the work for nothing.&quot;
&lt;Trader&gt;He still wants 5 soaked dryad panties.&lt;/Trader&gt;
&quot;Soaked dryad panties. Could you please improve my understanding of the term soaked.&quot;
&lt;Trader&gt;&quot;A panty has a chance to aquire the soaked-state when its wearer - the dryad in this matter - is so horny that her own mumu produces enough stickiness.&quot;&lt;/Trade&gt;
&quot;Doubt it or not but I guessed that.&quot;
&lt;Trader&gt;Shouldnt be a big issue for a pretty boy like you. Heard they are horny all the time anyway.&lt;/Trade&gt;
...
&lt;Trader&gt;&quot;Unfortunatly the trader left. So you should travel after him to bring those messy slips to him. I already placed them here on this cart in a strongbox.&quot;&lt;/Trader&gt;
&quot;A strongbox? Maybe I&#39;m wrong but couldn&#39;t a strongbox rise suspicion that I&#39;m delivering some valuables.&quot;
&lt;Trader&gt;&quot;They are valuables, at least to someone. And we put so much work in it, would be a shame to let it go to waste, right?
Just make sure that you get as fast as possible to westport.&quot;&lt;/Trader&gt;
&quot;Because of the bandits that will go after me because they think I have some gold in that strongboX?&quot;
&lt;Trader&gt;Bandits aybe. But also other things might interested if they pickup the scent of horny dryad cunt crossing their territory.&lt;/Trader&gt;
&quot;Other things?&quot;
...
&lt;Trader2&gt;&quot;I appreciate your servitude and would like to give you one of those as a bonus.&quot;&lt;Trader2&gt;
&quot;I would prefer somme coin instead.&quot;
&lt;Trader2&gt;&quot;But really I would like you to have that one. And I will give you 10 as a tip or 100 if you wear them.&quot;&lt;Trader2&gt;
&quot;Just give me the 10.&quot;
&quot;Hey thats to much&quot;
&lt;Trader2&gt;So you have to wear them, a deal is a deal.&lt;/Trader2&gt;</tw-passagedata><tw-passagedata pid="20" name="PantyPantsy2" tags="" position="1225,225" size="100,100">&quot;Are you still in pantie-business? I got some more request here. Someone asks for panties from a dragoness.&quot;
&quot;I doubt dragons wear panties. They are animals right? Animals dont wear cloths.&quot;
&quot;Ahh. prejudice.... &quot;
&quot;And who in the world would want that anyway?&quot;
&quot;Even more prejudice. Anyway. Find a dragon and get those panties. And if it doesnt have some, obtain some and get her to wear them. And then get them back. Easy peasy right?
I mean, I dont ask to get me 3 pieces again, just one.&quot;
&quot;I dont even know where I could find a dragon. And if knew, I would stay away from there.&quot;
&#39;I could just get some oversized pantys and make him believe its from a dragon.&#39;
&quot;I will do it.&quot;
&quot;Very good&quot; you seal the contract by hand. &quot;I&#39;m really sure you get this done.&quot; 
...
&quot;You got pantys? That cocksure grin tells me: for sure you do. &quot;
&quot;Well I can tell...&quot; before you can even start to narrate your devised story the trader bubbles on.
&quot;That was much faster then the other guys. Just show me what you got and I will get my detector to proof it.&quot;
&quot;detector?&quot; you are dumbfounded and deeple worried at the same time.
&quot;Yeah thats some awesome gadget I spent a lot of money in. You wont believe how many people tried to rip me off telling this for that. A mage sold it to me, showed how it can be used to detect different sort of things.
As I said some guys brought me that crude slip just a short while ago. Swush - I used the detector - didnt show dragon. They were really surprised as the guards led them to the gallows.&quot;
&quot;Gallows?!&quot;
&quot;They take it really serious now with faking things. Order from top management: no business with fake-items, be it gold-coin or dragon-pantys. Just visit them, maybe you saw them when entering the market, dancing happily in the air.&quot;
&quot;Uhm...I..I just wanted to tell you that I will need some more time OK. Its...its...I&#39;m on it yes?&quot;
&quot;Oh sure sure&quot;
You quickly hurry off &#39;a detector that can detect dragons?! Who in the world would be in need for that. I mean, you see a dragon or not.&#39;
No cheating here, get that mission done.
...
&#39;Thats a dragon, question is, is it male or female.&#39;
You try to peek undertail from your hiding spot.
&#39;Is that a slit?&#39; you are not really an expert for dragon genitalia - and for sure doesnt want to become one.
So you found a dragon, a female one you guess. 
&#39;That was the easy part. But how to get to wear that thing underwear, without beeing eaten. And where would I get something fitting anyway.&#39;
Get some of those gobbled up spiderweb from the cave. Those are stretchy and durable and might be useful as cloth-replacement. &#39;Its spidersilk fashion, I will tell them.&#39;
...
The dragon is now resting lazily on its side and watches you.
You circle around but keep your eyes peeled on that muzzle that is filled with dagger-sized teeth. As you pass by it slowly raises that hindleg not resting on the ground.
Your gaze is attracted to that movement and you blush deeply as you find yourself staring at whats inbetween those legs. 
&#39;She did that on cause. Oh my, I really thought SHE. I should think - IT - not she! &#39;
...</tw-passagedata><tw-passagedata pid="21" name="DemonVisitant" tags="" position="100,350" size="100,100">...
With on hand on the wall and a torch in another you walk forward down another corridor of that labyrinthian place.
A uncareful step on a old, wodden plank that is to rotten to bear your wight and your foot crashs through the floor. Not far but enough to let you trip. With both hands you catch your fall.
Unfortunatly you let go of the torch that falls down to the ground, sending out firey sparks as it rolls around.
At first you fear that this will set the whole place at fire. But that fear is soon replaced with another one as you see it rolling to the edge of the ballustrade. 
Quickly dashing forward you try to grab it before it vanishs, but its to late. 
The torch falls over the edge and all the light is gone.
&#39;This is really bad.&#39;
...
Just before you hear it you an feel wood splittering again. And how you fall through the air. 
And you think: &quot;If I&#39;m lucky I die and I get out of here.&quot;
And dying you do as your body hits the paved ground 2 dozen meters below.
And you are back. As usual sitting in that restoration-pool.
But something is wrong. Its still dark except the dim glow caused by the fluid in the pool. This is for sure not the usual shrine that you had now enough chances to wake up in.
You climb out of it and look around as far as you can see with that little light.
&#39;Hello?...Priestess are you here?&#39;
There is just some echo. An echo that indicates that you are somewhere in a building - or underground.
&#39;Oh fuck where am I?&#39; You rush another turn around the shrine, looking everywhere for some hints where you are. And for something to dress in.
You are still naked. 

&lt;Demon&gt;You arent going to make it from here. Just try and you will see.&lt;/Demon&gt;
While you cannot see any trace of whoever is speaking to you, your imagination shows you a face with a sardonic grin plasterd on it.

You need to find a way out of here. But the further you strive a way from the shrine the darker it gets until you cant see your hand in front your eyes.
&quot;This sucks.&quot;

&lt;Demon&gt;Come on, lets help each other. I wanna leave that hellhole just like you.&lt;/Demon&gt;
&quot;Help you? You keep me prison here and dare to ask for help!&quot;

&lt;Demon&gt;It wasnt me that trapped you here. This place is either a well thougth snare or an accident.&lt;/Demon&gt;
&quot;How could I trust you, I dont know how you are and cannot even see you.&quot;

&lt;Demon&gt;Thats a point my. But is it to much to ask for a little bit o trust nowadays?&lt;/Demon&gt;
&quot;Stay away. I will find a way, believe me.&quot;
&lt;Demon&gt;Fine. Suit yourself.&lt;/Demon&gt;

&quot;Hello?...Hello voice. Are you still there?&quot;
Silence
&quot;Can we talk again?...About helping each other&quot;
Silence
&quot;HEY...can you here me?&quot;
Silence
[[Plead some more]]
Still now answer. You crouch down on your knees, feeling helpless and left-behind. 
&lt;Demon&gt;So you going to listen now?&lt;/Demon&gt;
&quot;Huh..you are still here&quot;
&lt;Demon&gt;Nope&lt;/Demon&gt;
&quot;You said we should help each other. So, how could I help you and you me.&quot;
&lt;Demon&gt;I&#39;m stuck here similiar to you. Except that I dont have the variety to die and be revived. 
I could grant you a skill, that lets say, make you see in the dark.&lt;/Demon&gt;
&quot;See in the dark!&quot; you blurt out. &#39;That would really be o help.&#39;
&lt;Demon&gt;Just to be clear. Its not like walking in bright daylight.&lt;/Demon&gt;
&quot;Sure. But what do you want for this.&quot;
&lt;Demon&gt;As you can see - or better not see. I lack a suitable body at the moment. Which makes it difficult to get anywhere. &lt;/Demon&gt;
&quot;How did that happen? I guess a bug made your avatar glitch.&quot;
&lt;Demon&gt;I&#39;m not sure what you mean with glitch, but it wasn&#39;t a bug that caused my loss. No, it was a bunch of zombies that ripped that body appart &lt;/Demon&gt;
&quot;Zombies!?&quot; 
&lt;Demon&gt;Yes. Those stinky, shuffling, brain slurping meatpiles. They usually are not a big issue. But..well I got a little careless and they overrun us.&lt;/Demon&gt;
&quot;Us? You mean there are others here to.&quot;
&lt;Demon&gt;Only one. And I&#39;m pretty sure he switched sides in the meantime. Just try to be silent for a moment. Maybe then you are able to hear them stirring up. &lt;/Demon&gt;
You hold your breath and try to listen as intense as possible. Are there some shuffling noises from the oposite of the room?
Right now you feel even more in a hurry to get out of here.
&quot;So, what exactly do you want from me?&quot;
&lt;Demon&gt;If you check those dirtpile other there, you will notice several mushrooms. Somewhere there has to be an amulett with a small figurine. Just pick up and wear it.&lt;/Demon&gt;
&quot;Do I really have to wear it? I had some bad experiences with cursed gear.&quot;
&lt;Demon&gt;Oh. Well I think its good enough if you just hold it in your hands or put it in a pocket. Sorry, I forgot. Pockets are actual out of scope.&lt;/Demon&gt;
&quot;And how do you grant me that skill?&quot;
&lt;Demon&gt;Please pickup the amulet first, then I will tell you&lt;/Demon&gt;
&lt;Demon&gt;Fine, please dont loose it. So, you see those fungus all around. Some of them are white as a bone. I recommend to not even touch those. But you should also see some more bluish color.&lt;/Demon&gt;
You check the fungus. &#39;White,white, shitbrown, white,white,coalblack...hm not sure if this would count as blue&#39;
&quot;I only see a single stalk here that could be called bluish. Is it that kind?&quot;
&lt;Demon&gt;Yes, yes very good. You have to eat it, make sure to consume the entire stalk. &lt;/Demon&gt;
&quot;And you sure that isnt poisenous to me?&quot;
&lt;Demon&gt;Guarantee. Everything will be fine. And you will be able to see in the dark, but just for an amount of limited time.&lt;/Demon&gt;
[[Eat the fungus]]
...</tw-passagedata><tw-passagedata pid="22" name="GroupActivities" tags="" position="225,350" size="100,100">...
While Brad is talking with that huntress, the other 2 members are whispering to each other and you try to catch some of ther talk.
But you only catch &#39;...could be useful...&#39; and &#39;...distraction...&#39;. At least you think that you heard.</tw-passagedata><tw-passagedata pid="23" name="VirtualPregnancy" tags="" position="350,350" size="100,100">...
As you drift of into afterglow, a sudden thought crosses your mind: &quot;You cant get pregnant here do you?&quot;
&quot;But no. At least not reallife pregnant. Virtual pregnant is a complete different issue.&quot;
&quot;Virtual pregnant?&quot;
&quot;Yeah, I heard they are working on that. Not sure if I would like that. Hope they add an option to switch it off.&quot;
&quot;You mean, you can get children here?&quot;
&quot;Those guys go where the money is. If people want to grow a family here, I&#39;m sure they will do something about it.&quot;</tw-passagedata><tw-passagedata pid="24" name="FreedomOfArt" tags="" position="475,350" size="100,100">&quot;we are curently working to upgrade our servers that should help improving performance and accessibility from more locations. More content will be added once we have finished with this operation.&quot;
...
&quot;Breaking news:We are happy to announce that we found a solution for our increasing server-capacity-demand by teaming up with the national hosting service of the VR northkorea.
The offizielle Verantwortliche unterstützt das Abkomen mit folgenden Worten (*automatische Übersetzung): ...der Missbrauch und Ausbeutung ihrer eigenen Bevölkerung kümmert uns wenig. Dies wird sogar den Prozess beschleunigen ihnen die Augen zu öffnen wie sie von kapitalistischen Ausbeutern unterdrückt werden. 
So lange werden wir ihr Geld nehmen und für unsere eigenen Zwecke einsetzen um die degenerierten Elemente zu bekämpfen.
Der CEO von brachte seine Wertschätzung gegenüber der so positiv eingestellten Regierung des Landes zu Ausdruck: Allen jenen die behaupten es handle sich bei VR NK um ein rückständiges, unterentwickeltes Land, dessen korrupte Offizielle die eigene Bevölkerung  in Lagern einsperrt und dort elendlich verhungern lässt entgegne ich:
das mag schon sein aber mit dem nun abgeschlossenen Vertrag haben wir weitaus besser Konditionen und rechtliche Freiheiten als dies in unseren eigenen Heimatländern ja möglich wäre. Dieses Geschäft verspricht enorme Renditen bei gleichzeitig minimierter Verantwortung durch die Geschäftsführung von VR. &quot;</tw-passagedata><tw-passagedata pid="25" name="MeettheDev#2" tags="" position="600,350" size="100,100">&quot;Sure, since the command-input of the game is done via your body motion instead of a simple button press, its much more difficult to solve some skills.&quot;
&quot;Maybe you it can help if you improve your skills by training them in realworld.&quot;
&quot;So I should run around and hit people on the head with a bat?&quot;
&quot;Nah, that could cause some trouble of course. But for example dancing or other non threatening skills.&quot;</tw-passagedata><tw-passagedata pid="26" name="MeettheDev#3" tags="" position="725,350" size="100,100">&quot;I have to say I&#39;m not so happy about all your complaints. In fact it cast a slur on our department.&quot;
&quot;But its my job as a betatester to point out issues in the game.&quot;
&quot;You need to understand that we have to check everyone of your findings and this causes even more work in our crunch-phase and delays our schedule. And if we dont met our schedule the bosses will reprimand us.&quot;
&quot;Isn&#39;t the main goal to have the best game quality for the customers?&quot;
&quot;Thats the priority of the quality guys, our priority is to meet the schedule. If anyone is to find some bugs after the game is released, its the problem of the quality department, not ours. Thats the reason they force those betatesting un us.&quot;
&quot;But the tests are running autonomous anymway, I cannot influence them.&quot;
&quot;Enough of your complains. I see I have to find a way to make you less an annoyence.&quot;</tw-passagedata><tw-passagedata pid="27" name="MetttheDev#4" tags="" position="850,350" size="100,100">&quot;I got an idea how to get us some extra money. Do you know something called bitcoin&quot;
...
&quot;So, maybe someone found a way to reroute some processing power from the servers to do the calculation. They would still face the risk that this is detected by the supervising dispatch processors. So as an countermeasure it would be necessary to keep those supervisors distracted with other things... &quot;
&quot;And here you come into view.&quot;</tw-passagedata><tw-passagedata pid="28" name="PureMedical" tags="" position="975,350" size="100,100">&quot;VRGames will cooperate with Impert, a developer of equipment for sport and medical application. Impert brings in a deep scientific knowledge about how to greatly improve the physical and mental condition that we will try to use to add an additional benefit to the games mechanic.&quot;
&quot;for consumer safety testing purpose, you will be required to wear those gadgets for a duration we see fit. To encourage your engagement in the game we will raise additional penaltys when not meeting the required conditions.&quot;
Unlock VR headset with muzzle+gag, crotch cover, fuckmachine, drugapplicators, estim-devices</tw-passagedata><tw-passagedata pid="29" name="ClairesPotionDisaster" tags="" position="1100,350" size="100,100">Clair isnt allowed to visit the forest anymore because the apothecary is angry with her.
&quot;I need your help. I made a mistake and accidently dropped something in the waterhole in the deep forest. Now those wolves seem to act more aggressively.
Please help me to straighten out this error.&quot;
&quot;What did you drop into the waterhole?&quot; &quot;Its some kind of charm.&quot;
&quot;So you want this charm back? And that solves the problem and she wont be angry with you anymore?&quot;
&quot;I&#39;m not sure if it resolves the situation immediatly but at least its a start. Please dont speak to her about this.&quot;
[[Promise]] [[Not sure]]
The apothecary is here. Maybe you should ask for more information even if you promissed to not talk about the issue.
&quot;She is really a bad girl.&quot; &quot;But it was an accident.&quot;
&quot;An accident? For sure not. She made that charm by herself and placed it at the waterhole on intent.&quot;
&quot;What intent?&quot; &quot;Well, by what I was able to squeeze out of her, she tried to create a love incentive.&quot;
&quot;Huh. Why would she do that.&quot;
&quot;I think she has taken some interest at those damn wolves and tried to befriend them.&quot;
&quot;Watch your back and keep your pants up.&quot;
The idea of being hunted down by randy wolves [[worrys you]][[gives you a thrill]].</tw-passagedata><tw-passagedata pid="30" name="HippieSlaver" tags="" position="1225,350" size="100,100">Du triffst auf eine friedfertige Gruppe
Unterwegs triffst du einen verwundeten Krieger den du zur Gruppe bringst damit sie ihn aufpäppeln.
Er freundet sich mit ihnen an.
Später bringt er noch einen Freund mit und sie bandeln mit einigen Frauen an.
Als noch mehr auftauchen wird es problematisch.
Entscheide was zu tun ist: a) stelle dich gegen die Eindringlinge oder b) bringe die Gruppe dazu sich aufzuteilen
a) die Fremden ziehen ab aber du verlierst wegen deiner Gewalt das Vertrauen der Gruppe; die Krieger nehmen sich dich ins Korn happy Gangrape
b) einige Frauen gehen mit den Kriergern mit; sie werden versklavt; später wird dann auch der Rest der geschwächten Gruppe hopsgenommen</tw-passagedata><tw-passagedata pid="31" name="ManOfGoats" tags="" position="100,475" size="100,100">Eine Bauernfamilie hat mehrere Ziegen und stellen Ziegenkäse her von dessen erkauf sie leben.
Allerdings ist der Geisbock weggelaufen und wenn die Geissen keine Junge haben geben sie keine Milch. 
Ohne genug Geld kann kein neuer Bock gekauft werden.
1a) finde den alten Bock
1b) seine libido muss etwas aufgefrischt werden
1c) now he is eager for anyone
2a) oder überzeuge einen Satyr auszuhelfen 
2b) damit die Geissen ihn ranlassen brauchen sie einen Liebestrank</tw-passagedata><tw-passagedata pid="32" name="FastForward" tags="" position="225,475" size="100,100">Depending if you played the game already you might skip to a certain point:
[[Create avatar]]</tw-passagedata><tw-passagedata pid="33" name="GameInvite" tags="" position="350,475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
As you skim through your email, you notice a letter from a Gaming-service where you have your Online-Roleplaying-Account for Dominion-of-Slayers registered.&lt;/br&gt;
&lt;p class=&#39;tNPC2&#39;&gt;&quot;Dear sir or madam, we are happy to announce that your starter subscription will end soon and you will be automatically upgraded to an experienced-member account for free*. 
If you are no longer interested in our service, click the link below to cancel your membership. However, canceling your membership now would lead to unrecoverable loss of your avatars game-progress, stats and inventory.
Note*: the upgrade from starter to experienced-member is free of cost; monthly subscription cost will be only 30$ instead of 2$ for your actual starter-membership.&quot;&lt;/p&gt;
&lt;p class=&#39;tPC&#39;&gt;&#39;WTF...they are going to charge me 30 bucks a month! Those fuckers. I cant afford that. There wasn&#39;t much good content update recently anyway. &#39;&lt;/p&gt;
&lt;div id=&#39;select1&#39; &gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;)&#39;&gt;Call your friend Brad&lt;/a&gt;
&lt;/div&gt;
&lt;div id=&#39;choice1a&#39; hidden&gt;
&lt;p class=&#39;tPC&#39;&gt;&quot;Hey Brad, did you also receive that mail from GameWorld with account-change?&quot;&lt;/p&gt;
&quot;Yeah, I just wanted to talk about it with you too. What do you think?&quot;
&lt;p class=&#39;tPC&#39;&gt;&quot;We put so much work into this, I wouldnt like to get all of this to waste. But 30$ is really a lot of money for someone studying.&quot;&lt;/p&gt;
&quot;Even for someone who is working regulary this is alot of money dude. If you leave the game I will leave too.&quot;
&lt;p class=&#39;tPC&#39;&gt;&quot;To tell you the truth, it wasnt that fun to play recently. Somehow they messed up the games balancing with those updates.&quot;&lt;/p&gt;
&quot;Thats on purpose. They just want you to buy those boosters for real money!&quot;
&lt;p class=&#39;tPC&#39;&gt;&quot;Yep. So its set. Lets pull them a finger and quit.&quot;&lt;/p&gt;
&quot;Lets do it together 3..2..1..Sent&quot;
&lt;p class=&#39;tPC&#39;&gt;&quot;Me too. Maybe we should try one of those free-to-play games next? I heard SandyBeachBattle is worth a look.&quot;&lt;/p&gt;
&quot;Im not sure. ..Hey wait I got a mail. But its not from DoS. Its some kind of Invite to a different game... Lets see...&quot;
Just in that moment you got mail too: &lt;/br&gt;  
[[Check mail|GameInvite1b]]&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="34" name="GameInvite1b" tags="" position="475,475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
&lt;p class=&#39;tNPC2&#39;&gt;Dear &lt;%=window.gm.player.name%&gt;,&lt;/br&gt;
you got selected by ServiceAsGame to receive an invite as beta-tester for our new, MOBDSMRP-Game MiracoulusMultiplayerAlwaysOnlineVirtualReallityMassiveServiceRougue-Game.
Be part of a growing gaming community and get involved in exciting quests and rakish adventures. 
Please note that the content rating of the game is pending and is therefore restricted to adult audience only.
Click the personalized link below to sign up for a free selected account in &lt;/br&gt;Season-Quest&lt;/br&gt;
Because of the high demands on this new generation service-game, only thoose that act quickly will get a chance to parttake on the program. So hurry up!&lt;/p&gt;
&lt;/br&gt;
&#39;A new game, huh? I would really like to see what this is about. If its free of charge, that would be nice. &#39;
&lt;p class=&#39;tPC&#39;&gt;&quot;I got an invite too. For something called Season-Quest. Never heard of that.&quot;&lt;/p&gt;
&quot;Thats the same I got! If thats just a coincidence ?! But its from a different company.&quot;
&lt;p class=&#39;tPC&#39;&gt;&quot;Should we try this? Its adult only, so no annoying kiddos fucking up our game.&quot;&lt;/p&gt;
&quot;Yeah lets sign in together. I always wanted to see what beta-testing is about!&quot;&lt;/br&gt;
Clicking the link you got forwared to a registration page where you have to enter personal information.
&lt;p class=&#39;tPC&#39;&gt;&quot;Uhm, they want the passportnumber&quot;&lt;/p&gt;
&quot;Of course, because age-checking&quot;&lt;/br&gt;
Entering the required information you press Next and are presented a window with densly scribbled text that is barely readable and even less understandable: the user-agreement.&lt;/br&gt;
&lt;span class=&quot;tPC&quot;&gt;&#39;I should check this...&#39;&lt;/span&gt; you start reading but soon just scroll trhough the text.&lt;/br&gt;
&lt;span class=&quot;tPC&quot;&gt;&#39;Looks standard for me&#39;&lt;/span&gt; you click next and are presented another window with similiar advocat scribbling.&lt;/br&gt;
&lt;span class=&quot;tPC&quot;&gt;&#39;Come on now&#39;&lt;/span&gt; you groan, just scrolling down endless text and hitting next.&lt;/br&gt;
&quot;Congratulations. You are now registered in our beta-test-program and will receive login-credentials and gaming equipment.&quot;
&lt;span class=&quot;tPC&quot;&gt;&#39;What gaming equipment?&#39;&lt;/span&gt;
&lt;p class=&#39;tPC&#39;&gt;&quot;Hey Brad did you finish registration? I got a confirmation about receiving gaming equipment.&quot;&lt;/p&gt;
&quot;Oh yes, I think I saw something about that there is some new generation MoCap-equipment required to play.&quot;
&lt;p class=&#39;tPC&#39;&gt;&quot;MoCap?&quot;&lt;/p&gt;
&quot;Motion-Capturing dude. Seems you need something more than just your ordinary VR-googles to play this.&quot;
&lt;p class=&#39;tPC&#39;&gt;&quot;Do we have to pay.&quot;&lt;/p&gt;
&quot;They just stated they lent it for the test....uhm .I forgot I have to leave. see ya later.&quot;
&lt;p class=&#39;tPC&#39;&gt;&quot;Sure.&quot;&lt;/p&gt;
&#39;Im really tired now. Lets see when the equipment shows up.&#39;&lt;/p&gt;
&lt;a0 onclick=&#39;start()&#39;&gt;Close Browser&lt;/a&gt;

&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt; function start(){
    window.gm.quests.addQuest(&quot;qDLCMain&quot;,100);
    window.gm.quests.addQuest(&quot;qDiedAgain&quot;,1);
    window.gm.quests.addQuest(&quot;qFixLaptop&quot;,1);
    window.gm.quests.addQuest(&quot;qBeastKink&quot;,1);
    window.gm.quests.addQuest(&quot;qBondageKink&quot;,1);
    window.story.show(&quot;Your Bedroom&quot;);
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="35" name="ReceiveVREquipment" tags="" position="600,475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.quests.forceQuestMilestone(&quot;qDLCMain&quot;,500,100)%&gt;
As you got home from your daily chores and fiddling with the keys to your dorm, you find a parcel at the door step.&lt;/br&gt;
By the label on it you guess it might contain the gear from the game.&lt;/br&gt; 
&#39;Lets get started with that.&#39;&lt;/br&gt;
[[Next|SetupVREquipment]]&lt;/div&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="36" name="SetupVREquipment" tags="" position="725,475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.quests.forceQuestMilestone(&quot;qDLCMain&quot;,600,500)%&gt;
The package contains a VR-headset, some papers and something that looks like gloves for your hands. They have some cables worked into them, so you guess they are used instead of controllers.&lt;/br&gt;
[[Call Brad]]&lt;/br&gt;
You pull out your phone and choose Brads number. But he doesnt answer the call. Maybe he is still at work.&lt;/br&gt;
[[Check the papers]]&lt;/br&gt;
The first piece of paper welcomes you as to the beta-tester-program for Season-quest and also contains your login credentials.&lt;/br&gt;
The other paper contains a list of the delivery and to your horror sums up a bill at the end.&lt;/br&gt; 
&#39;2300$ ! I will send this right back. They never said I have to buy that.&#39;&lt;/br&gt;
You read some more:&lt;/br&gt;
&quot;...the delivered equipment will be lent free of charge for the participation in beta-test. At the end of the test, the equipment might be handed over to the user.&quot;&lt;/br&gt;
&#39;Phew. So I dont have to pay it &#39; Reading some more &lt;/br&gt; 
&quot;...compensation fines might be raised on contract violation as of example:&lt;/br&gt; 
* preliminary abort of the participation by the user
* damage or misuse of the provided equipment
* obstruction of beta-test-program or the game itself
* disclosure of game-related information&quot;
&lt;/br&gt;&lt;/br&gt;&#39;Ok, no problem yet. I think thats just reasonable for something like a beta-test.&#39;&lt;/br&gt;
&quot;Please note that you are responsible to regulary check your test-schedule for your assigned pending task.
Tasks noted as required have to be fullfilled within the given time window. Continous failing to do so might count as obstruction of the test-program... &quot;&lt;/br&gt;
&#39;Damit, what did I get mmyself into. Lets check online about this schedule.&#39;&lt;/br&gt;
You login with your credentials on the PC and are greeted by a welcome screen:&lt;/br&gt;
&quot;Welcome &lt;%=window.gm.player.name%&gt;, this is your actual profile:&quot; &lt;/br&gt; 
* no avatar
&lt;/br&gt;Tasks:&lt;/br&gt;
* Setup equipment to game
* Create avatar
* Finish Game introduction
&lt;/br&gt;&lt;/br&gt;Adorning the gloves and the VR-googles, you first have to run introductory tutorial. &lt;/br&gt;
You get some info how to use your hands movement for navigationg the screen and you even can use speech-control to do so.&lt;/br&gt;
You are eager to create your avatar and get a look at the game. On the other side, you would like to talk about your current experience with Brad first and see if he has gotten as far as you.&lt;/br&gt;
Besides its already gotten late.&lt;/br&gt;
[[Logout]]
You remove the headset. Still in the suite you call Brad again. This time he responds after some time.&lt;/br&gt;
&quot;Heya whatsup?&quot;
&lt;p class=&#39;tPC&#39;&gt;&quot;I got that equipment, you too? Isnt it awesome?&quot;&lt;/p&gt;
&quot;Yeah. You already got it working dude?&quot;
&lt;p class=&#39;tPC&#39;&gt;&quot;It took me over an hour. Did you already login?&quot;&lt;/p&gt;
&quot;Uh no, I&#39;m still struggling with the gear. Maybe there is something missing here.&quot;&lt;/br&gt;
You chuckle to yourself &#39;So Mr.IKnowEverything failed on the mechanical part already&#39;&lt;/br&gt;
[[Offer your help]]
&lt;p class=&#39;tPC&#39;&gt;&quot;I can help you tomorrow to get it setup if you want.&quot;&lt;/p&gt;
&quot;I will just give it a try tommorow morning on my own. I&#39;m just to tired from work, you know.&quot;
&lt;p class=&#39;tPC&#39;&gt;&quot;So you have a day off tomorrow? Just wait for me before doing quests. Its not fair if you get a head start just because I&#39;m busy all day.&quot;&lt;/p&gt;
&quot;Dont worry. As usual I will help your lazy ass leveling up to catch up with me.&quot;
&lt;p class=&#39;tPC&#39;&gt;&quot;For sure&quot;&lt;/p&gt;
You can hear him yawning &quot;I&#39;m going to sleep now.&quot;
&lt;p class=&#39;tPC&#39;&gt;&quot;Me too. See you tomorrow then, bro.&quot;&lt;/p&gt;
&quot;Yup. See ya.&quot;&lt;/br&gt;
You put your phone away. A shower and some sleep would be nice.&lt;/br&gt;
[[Next|Your Bedroom]]
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="37" name="VREquipment2" tags="" position="850,475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
The email reads:
&quot;Dear tester, we just noticed that a part of the game equipment was not delivered to you. We will make another attempt to send it to you within short time.&quot;
&#39;But I have equipment received. I didnt notice anything missing.&#39;
[[Next]]&lt;/div&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="38" name="ReceiveVREquipment2" tags="" position="975,475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.quests.forceQuestMilestone(&quot;qDLCMain&quot;,500,100)%&gt;
As you got home from your daily chores and fiddling with the keys to your dorm, you find a sticky note on your door:&lt;/br&gt;
&quot;Pickup parcel from Melanie&quot;&lt;/br&gt;
&#39;Melanie? parcel?&#39; You slap your forehead &#39;Ah yes, that might be the gaming equipment.&#39;&lt;/br&gt;
&lt;div id=&#39;select1&#39; &gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;)&#39;&gt;knock at her door&lt;/a&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div id=&#39;choice1a&#39; hidden&gt;
Melanie opens. You guess she is around 20-something. She alway seemed to be annoyed by something.&lt;/br&gt;
Just like now.&lt;/br&gt;
&quot;Hello &lt;%=window.gm.player.name%&gt;. &quot; &lt;/br&gt;
&lt;p class=&#39;tPC&#39;&gt;&quot;Hi. I&#39;m sorry to disturb you but I found this note on my door.&quot;&lt;/p&gt;
&quot;There was some delivery for you.&quot; she really seems pissed.
&lt;p class=&#39;tPC&#39;&gt;&quot;I hope it wasnt any trouble for you to receive it while I&#39;m...&quot;&lt;/p&gt;
&quot;If I had known its some furniture delivery I would have rejected it.&quot;
&lt;p class=&#39;tPC&#39;&gt;&quot;Furniture?&quot; you ask puzzled. You didnt order any furniture, did you.&lt;/p&gt;
She opens the door and you can now see a large parcel the size of a washer and a smaller one, blocking nearly all of the space after the entrance.
&lt;!--todo--&gt;
You are eager to get the equipment into your dorm and setup everything. So you move the boxes out of Melanies room into your own.&lt;/br&gt;
[[Next|SetupVREquipment2]]&lt;/div&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="39" name="SetupVREquipment2" tags="" position="1100,475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
You unpack the heavier one of the large parcels. It contains a number of metal pipes and plates, cables and screws.
The other package contains something that looks like a diver&#39;s suite made from neoprene and another VR-headset. 

&#39;I first need to figure out how that equipment needs to be setup.&#39;
You grab the assembly-instructions. Those metal-pipes and plates have to be assembled together to form a kind of scaffolding where the user hangs inside in the air. 
That way he can move his hands and feet around and the MoCap-suite can be used to generate steering commands.
&#39;I dont have enough space here for such a large gear.&#39;
But where else could you place it?
There is this room in the basement that was planned to be changed over into a party cellar.&lt;/br&gt;
But that plan was never finished and the room is unused right now.
[[Move everything into the cellar]]
[[Assemble the rack]]
[[Connect VR-Headset]]
That VR-Headset seems a lot better than your old one. Its not as heavy as your old one and can be better adapt to your skull-shape. There are also several cameras that have to be assembled to the rig. You guess they are used to detect the position of the mocap-suite. 
You connect the cables harness to your PC. There is a message from operating system: &quot;installing drivers...&#39;
[[put MoCap-suite on]]
That mocap-suite is, of course, skin thight. You dont want to risk tearing it appart by pulling it above your trousers and shirt. So you strip down except of your undies of course.
&lt;!--todo--&gt;Its still really difficult to get inside. Maybe they send it in a size to small.
Finally you got your arms in an close it shut by pulling up the zipper from the groin to its collar.
&#39;Thats a snuggly fit.&#39; You walk around some more and check yourself in the wardrobes mirror &#39;I really loolk like a surfer boy now&#39;
There are also some gloves with cables attached to each finger. So there are no controllers required?
You slip your hands into the gloves and connect the plugs of the cables to the matching one in the suite.
But how to get yourself hung into that scaffolding?
[[check parcels again]]
Rummaging through the large parcel again you find a large paper bag that at first you had put off as package material. Inside the bag you find several carabiners, velcrostraps and something that looks like a climbing harness with additional straps for the upperbody up to the neck.
[[adorn the harness]]
&#39;I think those carabiners are meant to connect the harness to the rack here and here...&#39;
In the meantime the drivers for the system got installed successfully and the headset already shows an screen. You still have to get yourself into the rack before you adorn it. 
You step into the harness and thighten the straps. &#39;But how do I get myself up far enough to connect the harness to the carabiners?&#39;  
You have a flat stool without backrest. You move it below the rack and climb on top of it; now its easy to connect the carabiners.
[[adorn headset]]
The headset that you have hung at one of the bars of the rack is within reach. You pull it over your head and secure it with the strap.
But there is a error message: &quot;Please remove object&quot;
&#39;Ah yes the stool&#39; The screen show a picture of you standing on it and the stool has a red outline. 
So now what?
[[push the stool away]]
You bent your knees to check if the rack can support your weight.
Its not giving: check.
You give the stool a small push with a feet just to move it out of the racks space but not to far. You might need it to undo yourself from the rack.
The screen confirms the sucessful removal and proceeds to the &#39;introductory-screen&#39;. You get some info how to use your hands movement for navigationg the screen and you even can use speech-control to do so.
You are eager to create your avatar and get a look at the game. On the other side, you would like to talk about your current experience with Brad first and see if he has gotten as far as you.
Besides its already gotten late.
[[get out of the rack]]
You remove the headset and fish with one feet for the stool. Gladly you didnt push it to far away.
You can undock yourself and disconnect the cables.
You put your phone away. Stripping out of the suite is as difficult as getting inside. That rubbery fabric is painfully pulling at each hair on your body.
A shower and some sleep would be nice.
[[Next|Your Bedroom]]
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="40" name="RL_Day1" tags="" position="1225,475" size="100,100">In 2 days most of your intramural courses are done and you will have more free time. Just lets get the day started and get to university.
[[Attend studys]]
&lt;!--todo--&gt;
[[Lunch with Ariane&amp;friends]]
[[Attend studys]]
[[Go home]]

You grab a snack from the fridge and call Brad.
Brad doesnt respond on the phone. &#39;Maybe he is already in game. I should get started too..&#39;

&quot;Welcome back. Lets just clarify some things about the beta-testing process. In most cases you just have to play the game as you like. We will track your actions and progress to adapt and improve the experience of the finished game.
However, at times you might be requested to do certain things and do it in a certain way.  
Remember that this is not the final game. We continously modify aspects to get the best experience for the players.  
&quot;
You say &#39;Create new avatar&#39;. The screen switches to those kind of screens that are common to other RPGs.
You can select class, race, character-traits and some visual aspects.
&#39;Lets see what classes we have...Staff Zealot..never heard of that one  &#39;
As you try to flip through the classes you got a message &quot;For testing purpose the following condition is applied: character-class and race restricted&quot;
&#39;Oh man, I&#39;m stuck with that class? I would at least know what other classes are available.&#39; You try to change race, but find that you are stuck to some kind of elf-youngling. 
You can toggle between male and female though the difference between the androgyne male and the female seem just to be some perky but small titts.
The description of the class is sparse. The picture you see indicates that this class uses a 2-handed staff and light armor. You expect also some magic abilities - its an elf, isn&#39;t it?.
&#39;I will choose male. Brad would make fun of me all time if I would choose any other option. On the other hand, it is roleplay right?&#39;
[[male elf]] [[female elf]]</tw-passagedata><tw-passagedata pid="41" name="AIAwesome" tags="" position="100,600" size="100,100">...&quot;Actually we dont design everything manually. That would be much to tedious.&quot;&lt;/br&gt;
&quot;Instead we use an AI that learns while the game is played.&quot;
&quot;You mean an artificial intelligence? But doesnt most games have some AI to control the NPCs?&quot;
&quot;I didnt talk about AI to control the behaviour of some mobs. And for sure the fewest games have anything near to an AI. Most often its just some logic. Maybe complex logic but still predefined logic.&quot;
&quot;First: our AI is utilized to build the game-world and keep the ecosystem running. But actually most of the NPC aren&#39;t really driven by AI. But the logic they follow was created with the help of it.&quot;
&quot;Second: we call it AI because its able to learn. It keeps track what it is doing and if the result isn&#39;t like we want it, it changes its doing.&quot;
&quot;That sounds like the game is creating itslef on its own.&quot;
&quot;Better dont tell the management. They might think they just dont need devs anymore.&quot;
&quot;Anyway, its still required that someone supervises the AI and correct the goals.&quot;
...
&quot;Those darn AI! How can we do qualitychecking if everything can change at every time.&quot;
&quot;I spent 1 week to verify that all trees are growing upside down and then the AI decides to overhaul the entire growth-system and I have to redo it again and again.&quot;
&quot;The problem is, the AI doesnt tell you whats going to change and how it is doing it.&quot;
&quot;And I dont trust it. What if its decide to just delete the game and itself?&quot;</tw-passagedata><tw-passagedata pid="42" name="SisterInTown" tags="" position="225,600" size="100,100">Your mother informs you that your sister has business in town.
Sis seems to be instructed to watch over you. Lets hope she doesnt find out what game you are playing.</tw-passagedata><tw-passagedata pid="43" name="ForceFeedback" tags="" position="350,600" size="100,100">...
Als du aus dem Suite kletterst bist du hundemüde und deine Muskeln schmerzen als hättest du an einem Ironman-Lauf teilgenommen. Was du vom prinzip ja hast zumindest virtuel.
&#39;Diese Forcefeedback ist echt krass. Jetzt muss ich kein schlechtes Gewissen mehr haben wenn ich zocke das ich besser Sport machen sollte. Jetzt kann ich beides gleichzeitig!&#39;</tw-passagedata><tw-passagedata pid="44" name="AnalAddict" tags="" position="475,600" size="100,100">As you walk through the city, a thought crosses your mind again and again.
Its about that situation in the game where a foe had you pushed against the wall pressing his front against your lower back to keep you in place.
That sensation was rather edgy. But would have been much worse if one of you had their pants down. 
Of course that werent the case and even then it wouldnt automatically implicate that some butt-rape is imminent.
Getting your butt ravaged is [[a No-No]] [[an odd idea ]].
...   
...Your butt feels kinda empty. Like it needs to be filled with some...some... ugh you dont know.
Would you really try to stick something up your hole? [[Yeah]] [[No way]] [[not sure]]</tw-passagedata><tw-passagedata pid="45" name="DLCShopWelcome" tags="_back_" position="600,600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
Welcome to the games Shop where you can buy Quality-of-life-service and equipment for your travel in our game.&lt;/br&gt;
Please note that you need vouchers to buy something. They can be bougth for real money or they can be earned in the game or granted by the content managers. 

[[Buy 100 Bronze-Token for 50$]]
[[Buy 1000 Bronze-Token for 500$]]

Options to retain equipment after death:&lt;/br&gt;
[[up to 2 health potions - 100 BT]]
[[up to 100gld - 100 BT]]
[[starter gear - 300 BT]]
There might also be some pay-by-use offers at respawn like: removal of status alignment and deseases

&lt;div&gt;&lt;/br&gt;
[[Checkout|_back_]]&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="46" name="EncounterStartTurn" tags="_nosave_" position="650,25" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;div id=&#39;canvas&#39;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt; &lt;!--filled by statspanel--&gt;
&lt;div id=&#39;output&#39;&gt;&lt;/div&gt;&lt;/br&gt;    &lt;!--message is rendered here--&gt;
&lt;div id=&quot;choice&quot;&gt;&lt;/div&gt;&lt;/br&gt; &lt;!--filled by combat-statemachine--&gt;
&lt;div id=&quot;choice2&quot;&gt;&lt;/div&gt;&lt;/br&gt;  &lt;!--filled by combat-statemachine--&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;
&lt;/section&gt;
&lt;script&gt;
window.gm.Encounter.battle();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="47" name="statspanel" tags="" position="850,600" size="100,100">&lt;!--subpanel--&gt;
&lt;%=window.gm.Encounter.printStats()%&gt;</tw-passagedata><tw-passagedata pid="48" name="GameOver" tags="" position="200,275" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
Game Over. Better luck next time.&lt;/br&gt;
&lt;/br&gt;[[New Game|Start]]
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="49" name="Mole Submit" tags="" position="500,175" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
The mole took you down into his cave. &lt;/br&gt;
Which was very difficult since you are far to large - you know?&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.postDefeat();&#39;&gt;Black out&lt;/a&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;
&lt;/section&gt;</tw-passagedata><tw-passagedata pid="50" name="sidebar_old" tags="" position="375,500" size="100,100">&lt;h3&gt;&lt;%=window.story.name%&gt; V&lt;%=window.gm.getSaveVersion().toString().replaceAll(&quot;,&quot;,&quot;.&quot;)%&gt;&lt;/h3&gt;
&lt;img src=&#39;&lt;%=window.gm.getSidebarPic()%&gt;&#39; width=&quot;256&quot; height=&quot;256&quot;&gt;
&lt;div&gt;&lt;%=window.gm.util.printLocationName(window.gm.player.location)%&gt;&lt;/br&gt;&lt;%=window.gm.getTimeString()%&gt;&lt;/br&gt;&lt;%=window.gm.getDateString()%&gt;&lt;/br&gt;&lt;/div&gt;&lt;hr&gt;
&lt;div&gt;&lt;%=window.gm.player.name%&gt;&lt;/br&gt;
&lt;%=window.gm.util.statsbar(&quot;health&quot;)%&gt;&lt;%=window.gm.util.statsbar(&quot;energy&quot;)%&gt;&lt;%=window.gm.util.statsbar(&quot;will&quot;)%&gt;
&lt;%if(s._gm.debug&amp; 0x1&gt;0){%&gt;
&lt;%=window.gm.util.statsbar(&quot;arousal&quot;)%&gt;&lt;%=window.gm.util.statsbar(&quot;satiation&quot;)%&gt;&lt;%=window.gm.util.statsbar(&quot;savageness&quot;)%&gt;&lt;/div&gt;
&lt;%}%&gt;
&lt;div&gt;Money: &lt;%=window.gm.player.Inv.countItem(&#39;Money&#39;)%&gt;&lt;/div&gt;
&lt;!--&lt;div &lt;%=window.gm.player.canLevelUp?&quot;class=\&quot;green\&quot;&quot;:&quot;&quot;%&gt;&gt;XP/Level: &lt;%=window.gm.player._data.XP+&quot;/&quot;+window.gm.player._data.level%&gt;&lt;/div&gt;--&gt;
&lt;hr&gt;
&lt;form&gt;
&lt;button type=&quot;button&quot; id=&quot;LinkS&quot;&gt;Status&lt;sup&gt;[s]&lt;/sup&gt;&lt;/button&gt;
&lt;button type=&quot;button&quot; id=&quot;LinkI&quot;&gt;Inventory&lt;sup&gt;[i]&lt;/sup&gt;&lt;/button&gt;
&lt;button type=&quot;button&quot; id=&quot;LinkO&quot;&gt;Outfit&lt;sup&gt;[o]&lt;/sup&gt;&lt;/button&gt;
&lt;button type=&quot;button&quot; id=&quot;LinkQ&quot;&gt;Quests&lt;sup&gt;[q]&lt;/sup&gt;&lt;/button&gt;
&lt;button type=&quot;button&quot; id=&quot;dashboard&quot;&gt;More&lt;/button&gt;
&lt;!--&lt;button type=&quot;button&quot; id=&quot;wait&quot; style=&quot;width: 100%&quot;&gt;Rest 45min&lt;/button&gt;--&gt;
&lt;hr&gt;
&lt;button type=&quot;button&quot; id=&quot;save&quot; style=&quot;width: 80%&quot;&gt;Save/load&lt;/button&gt;
&lt;button type=&quot;button&quot; id=&quot;help&quot; style=&quot;width: 80%&quot;&gt;Help&lt;/button&gt;
&lt;button type=&quot;button&quot; id=&quot;settings&quot; style=&quot;width: 80%&quot;&gt;Settings&lt;/button&gt;
&lt;button type=&quot;button&quot; id=&quot;achievements&quot; onclick=&#39;window.story.show(&quot;Achievements&quot;);&#39; style=&quot;width: 80%&quot;&gt;Achievements&lt;/button&gt;
&lt;%if(s._gm.debug&amp; 0x1&gt;0){%&gt;
&lt;button type=&quot;button&quot; id=&quot;LinkD&quot; style=&quot;width: 80%&quot;&gt;Debug&lt;sup&gt;[d]&lt;/sup&gt;&lt;/button&gt;
&lt;script&gt;document.querySelector(&#39;#LinkD&#39;).addEventListener(&#39;click&#39;, function(){window.story.show(&#39;debug&#39;);});&lt;/script&gt;
&lt;%}%&gt;
&lt;/form&gt;
&lt;script&gt;
//document.querySelector(&#39;#wait&#39;).addEventListener(&#39;click&#39;, function(){window.gm.addTime(45);window.gm.refreshAllPanel();}); 
document.querySelector(&#39;#LinkI&#39;).addEventListener(&#39;click&#39;, function(){window.story.show(&#39;Inventory&#39;);});
document.querySelector(&#39;#LinkQ&#39;).addEventListener(&#39;click&#39;, function(){window.story.show(&#39;QuestList&#39;);});
document.querySelector(&#39;#dashboard&#39;).addEventListener(&#39;click&#39;, function(){window.story.show(&#39;Player_Dashboard&#39;);});
document.querySelector(&#39;#LinkS&#39;).addEventListener(&#39;click&#39;, function(){window.story.show(&#39;Status&#39;);});
document.querySelector(&#39;#save&#39;).addEventListener(&#39;click&#39;, function(){window.gm.toggleDialog(&#39;#dialog_save&#39;);});
document.querySelector(&#39;#help&#39;).addEventListener(&#39;click&#39;, function(){window.story.show(&#39;Help_Index&#39;);}); 
document.querySelector(&#39;#settings&#39;).addEventListener(&#39;click&#39;, function(){window.story.show(&#39;Settings&#39;);}); 
document.querySelector(&#39;#LinkO&#39;).addEventListener(&#39;click&#39;, function(){window.story.show(&#39;Wardrobe&#39;);}); 
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="51" name="sidebar" tags="" position="100,725" size="100,100">&lt;h3&gt;&lt;%=window.story.name%&gt; V&lt;%=window.gm.getSaveVersion().toString().replaceAll(&quot;,&quot;,&quot;.&quot;)%&gt;&lt;/h3&gt;
&lt;img src=&#39;&lt;%=window.gm.getSidebarPic()%&gt;&#39; width=&quot;256&quot; height=&quot;256&quot;&gt;
&lt;div&gt;&lt;%=window.gm.util.printLocationName(window.gm.player.location)%&gt;&lt;/br&gt;&lt;%=window.gm.getTimeString()%&gt;&lt;/br&gt;&lt;%=window.gm.getDateString()%&gt;&lt;/br&gt;&lt;/div&gt;&lt;hr&gt;
&lt;div&gt;&lt;%=window.gm.player.name%&gt;&lt;/br&gt;
&lt;%=window.gm.util.statsbar(&quot;health&quot;)%&gt;&lt;%=window.gm.util.statsbar(&quot;energy&quot;)%&gt;&lt;%=window.gm.util.statsbar(&quot;will&quot;)%&gt;
&lt;%if(s._gm.debug&amp; 0x1&gt;0){%&gt;
&lt;%=window.gm.util.statsbar(&quot;arousal&quot;)%&gt;&lt;%=window.gm.util.statsbar(&quot;satiation&quot;)%&gt;&lt;%=window.gm.util.statsbar(&quot;savageness&quot;)%&gt;&lt;/div&gt;
&lt;%}%&gt;
&lt;div&gt;&lt;/div&gt;
&lt;!--&lt;div &lt;%=window.gm.player.canLevelUp?&quot;class=\&quot;green\&quot;&quot;:&quot;&quot;%&gt;&gt;XP/Level: &lt;%=window.gm.player._data.XP+&quot;/&quot;+window.gm.player._data.level%&gt;&lt;/div&gt;--&gt;
&lt;hr&gt;
&lt;form&gt;
&lt;button type=&quot;button&quot; id=&quot;LinkS&quot; onclick=&#39;window.story.show(&quot;InspectPlayer&quot;);&#39;&gt;Status&lt;sup&gt;[s]&lt;/sup&gt;&lt;/button&gt;
&lt;button type=&quot;button&quot; id=&quot;LinkI&quot; onclick=&#39;window.story.show(&quot;Inventory&quot;);&#39;&gt;Inventory&lt;sup&gt;[i]&lt;/sup&gt;&lt;/button&gt;
&lt;hr&gt;
&lt;button type=&quot;button&quot; id=&quot;save&quot; onclick=&#39;window.gm.toggleDialog(&quot;#dialog_save&quot;);&#39; style=&quot;width: 80%&quot;&gt;Save/load&lt;/button&gt;
&lt;button type=&quot;button&quot; id=&quot;help&quot; onclick=&#39;window.story.show(&quot;Help_Index&quot;);&#39; style=&quot;width: 80%&quot;&gt;Help&lt;/button&gt;
&lt;button type=&quot;button&quot; id=&quot;settings&quot; onclick=&#39;window.story.show(&quot;Settings&quot;);&#39; style=&quot;width: 80%&quot;&gt;Settings&lt;/button&gt;
&lt;button type=&quot;button&quot; id=&quot;achievements&quot; onclick=&#39;window.story.show(&quot;Achievements&quot;);&#39; style=&quot;width: 80%&quot;&gt;Achievements&lt;/button&gt;
&lt;%if(s._gm.debug&amp; 0x1&gt;0){%&gt;
&lt;button type=&quot;button&quot; id=&quot;LinkD&quot; onclick=&#39;window.story.show(&quot;debug&quot;);&#39; style=&quot;width: 80%&quot;&gt;Debug&lt;sup&gt;[d]&lt;/sup&gt;&lt;/button&gt;
&lt;%}%&gt;
&lt;/form&gt;</tw-passagedata><tw-passagedata pid="52" name="CenterDialogs" tags="" position="225,725" size="100,100">&lt;!--called to include important dialogs; mainly the save-Dialog because of special behaviour--&gt;
&lt;%=window.story.render(&quot;SaveDialog&quot;) %&gt;</tw-passagedata><tw-passagedata pid="53" name="LogPanel" tags="" position="350,725" size="100,100">&lt;!--&lt;button type=&quot;button&quot; id=&quot;toggleview&quot; onclick=toggleview()&gt;&lt;i class=&quot;fa fa-compress&quot;&gt;&lt;/i&gt;&lt;/button&gt;
&lt;button type=&quot;button&quot; id=&quot;clearview&quot; onclick=clearview()&gt;&lt;i class=&quot;fa fa-trash-alt&quot;&gt;&lt;/i&gt;&lt;/button&gt;--&gt;
&lt;div style=&quot;font-size: smaller;&quot;&gt;&lt;a0 onclick=toggleview()&gt;toggle view&lt;/a&gt;&lt;a0 onclick=clearview()&gt;clear log&lt;/a&gt;&lt;/div&gt;
&lt;div class=&quot;scroll&quot; style=&quot;font-size: smaller;&quot;&gt;&lt;%=window.gm.getLog()%&gt;&lt;/br&gt;&lt;/div&gt;
&lt;script&gt;
function toggleview(){
  let list=document.querySelector(&quot;section&quot;).classList;
  if(list.contains(&quot;log_fullview&quot;)) list.toggle(&quot;log_fullview&quot;),list.toggle(&quot;log_hideview&quot;);
  else if(list.contains(&quot;log_hideview&quot;)) list.toggle(&quot;log_hideview&quot;);
  else list.toggle(&quot;log_fullview&quot;);
}
function clearview(){
  window.gm.clearLog();window.gm.refreshAllPanel();
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="54" name="SaveDialog" tags="_noshortkey_" position="475,725" size="100,100">&lt;dialog role=&quot;dialog&quot; id=&#39;dialog_save&#39; aria-labelledby=&quot;dialog-heading&quot;&gt;
    &lt;button id=&quot;close-dialog&quot;&gt;Back&lt;/button&gt; &lt;div&gt;&lt;%=(window.story.state._gm.nosave?&quot;save disabled in this scene&quot;:&quot;&quot;)%&gt;&lt;/div&gt;
    &lt;form&gt;
    &lt;label&gt;&lt;output&gt;&lt;/output&gt;&lt;/label&gt;&lt;/br&gt;
    &lt;button type=&quot;button&quot; id=&quot;saveAuto&quot; hidden&gt; &lt;/button&gt;&lt;button type=&quot;button&quot; id=&quot;loadAuto&quot;&gt;load Auto&lt;/button&gt;
    &lt;button type=&quot;button&quot; id=&quot;deleteAuto&quot;&gt;delete Auto&lt;/button&gt;&lt;label&gt;&lt;outputAuto&gt;&lt;/outputAuto&gt;&lt;/label&gt;&lt;/br&gt;
    &lt;button type=&quot;button&quot; id=&quot;save1&quot; &lt;%=(window.story.state._gm.nosave?&quot;disabled&quot;:&quot;&quot;)%&gt;&gt;save 1&lt;/button&gt;&lt;button type=&quot;button&quot; id=&quot;load1&quot;&gt;load 1&lt;/button&gt;
    &lt;button type=&quot;button&quot; id=&quot;delete1&quot;&gt;delete 1&lt;/button&gt;&lt;label&gt;&lt;output1&gt;&lt;/output1&gt;&lt;/label&gt;&lt;/br&gt;
    &lt;button type=&quot;button&quot; id=&quot;save2&quot; &lt;%=(window.story.state._gm.nosave?&quot;disabled&quot;:&quot;&quot;)%&gt;&gt;save 2&lt;/button&gt;&lt;button type=&quot;button&quot; id=&quot;load2&quot;&gt;load 2&lt;/button&gt;
    &lt;button type=&quot;button&quot; id=&quot;delete2&quot;&gt;delete 2&lt;/button&gt;&lt;label&gt;&lt;output2&gt;&lt;/output2&gt;&lt;/label&gt;&lt;/br&gt;
    &lt;button type=&quot;button&quot; id=&quot;save3&quot; &lt;%=(window.story.state._gm.nosave?&quot;disabled&quot;:&quot;&quot;)%&gt;&gt;save 3&lt;/button&gt;&lt;button type=&quot;button&quot; id=&quot;load3&quot;&gt;load 3&lt;/button&gt;
    &lt;button type=&quot;button&quot; id=&quot;delete3&quot;&gt;delete 3&lt;/button&gt;&lt;label&gt;&lt;output3&gt;&lt;/output3&gt;&lt;/label&gt;&lt;/br&gt;
    &lt;button type=&quot;button&quot; id=&quot;save4&quot; &lt;%=(window.story.state._gm.nosave?&quot;disabled&quot;:&quot;&quot;)%&gt;&gt;save 4&lt;/button&gt;&lt;button type=&quot;button&quot; id=&quot;load4&quot;&gt;load 4&lt;/button&gt;
    &lt;button type=&quot;button&quot; id=&quot;delete4&quot;&gt;delete 4&lt;/button&gt;&lt;label&gt;&lt;output4&gt;&lt;/output4&gt;&lt;/label&gt;&lt;/br&gt;
    &lt;button type=&quot;button&quot; id=&quot;save5&quot; &lt;%=(window.story.state._gm.nosave?&quot;disabled&quot;:&quot;&quot;)%&gt;&gt;save 5&lt;/button&gt;&lt;button type=&quot;button&quot; id=&quot;load5&quot;&gt;load 5&lt;/button&gt;
    &lt;button type=&quot;button&quot; id=&quot;delete5&quot;&gt;delete 5&lt;/button&gt;&lt;label&gt;&lt;output5&gt;&lt;/output5&gt;&lt;/label&gt;&lt;/br&gt;
    &lt;button type=&quot;button&quot; id=&quot;save6&quot; &lt;%=(window.story.state._gm.nosave?&quot;disabled&quot;:&quot;&quot;)%&gt;&gt;save 6&lt;/button&gt;&lt;button type=&quot;button&quot; id=&quot;load6&quot;&gt;load 6&lt;/button&gt;
    &lt;button type=&quot;button&quot; id=&quot;delete6&quot;&gt;delete 6&lt;/button&gt;&lt;label&gt;&lt;output6&gt;&lt;/output6&gt;&lt;/label&gt;&lt;/br&gt;
    &lt;button type=&quot;button&quot; id=&quot;save7&quot; &lt;%=(window.story.state._gm.nosave?&quot;disabled&quot;:&quot;&quot;)%&gt;&gt;save 7&lt;/button&gt;&lt;button type=&quot;button&quot; id=&quot;load7&quot;&gt;load 7&lt;/button&gt;
    &lt;button type=&quot;button&quot; id=&quot;delete7&quot;&gt;delete 7&lt;/button&gt;&lt;label&gt;&lt;output7&gt;&lt;/output7&gt;&lt;/label&gt;&lt;/br&gt;
    &lt;button type=&quot;button&quot; id=&quot;save8&quot; &lt;%=(window.story.state._gm.nosave?&quot;disabled&quot;:&quot;&quot;)%&gt;&gt;save 8&lt;/button&gt;&lt;button type=&quot;button&quot; id=&quot;load8&quot;&gt;load 8&lt;/button&gt;
    &lt;button type=&quot;button&quot; id=&quot;delete8&quot;&gt;delete 8&lt;/button&gt;&lt;label&gt;&lt;output8&gt;&lt;/output8&gt;&lt;/label&gt;&lt;/br&gt;
    &lt;button type=&quot;button&quot; id=&quot;saveFile&quot; &lt;%=(window.story.state._gm.nosave?&quot;disabled&quot;:&quot;&quot;)%&gt;&gt;save file...&lt;/button&gt;
    &lt;input type=&quot;file&quot; id=&quot;loadFile&quot; name=&quot;loadfile&quot; onchange=readFile(this)&gt;&lt;/br&gt;
    &lt;/form&gt;
&lt;/dialog&gt;
&lt;script&gt;
var infodisp = &#39;dialog form label output&#39;; //Url to output according nesting node classes; see structure of dialog below
var x = 1; 
var _slots = [&#39;Auto&#39;,&#39;1&#39;,&#39;2&#39;,&#39;3&#39;,&#39;4&#39;,&#39;5&#39;,&#39;6&#39;,&#39;7&#39;,&#39;8&#39;]; //number saveslots available; has to fit save form
for(var i=0; i&lt; _slots.length;i++){
  const _x = _slots[i];
  const slot = &#39;save&#39;.concat(_x);
  document.querySelector(&#39;#save&#39;.concat(_x)).addEventListener(&#39;click&#39;, function(){
    document.querySelector(infodisp).textContent=&#39;&#39;;
    window.storage.saveBrowser(slot);
    refresh(_x);
    document.querySelector(infodisp).textContent=slot;
    });
  document.querySelector(&#39;#load&#39;.concat(_x)).addEventListener(&#39;click&#39;, function(){
    window.storage.loadBrowser(slot);
    div = document.querySelector(&#39;#backdrop&#39;);
    div.parentNode.removeChild(div);
    });
  document.querySelector(&#39;#delete&#39;.concat(_x)).addEventListener(&#39;click&#39;, function(){
      window.storage.delete(slot);
      refresh(_x);
      });
  document.querySelector(infodisp).textContent=&#39;&#39;;
   refresh(_x);
}
document.querySelector(&#39;#saveFile&#39;).addEventListener(&#39;click&#39;, function(){
    document.querySelector(infodisp).textContent=&#39;&#39;;
    window.storage.saveFile();
});
function refresh(slot){
    var ok = window.storage.getSaveInfo(&#39;save&#39;.concat(slot));
    document.querySelector(&#39;#load&#39;.concat(slot)).disabled=(ok===&#39;&#39;);
    var out = document.querySelector(&#39;dialog form output&#39;.concat(slot));
    if(out) out.textContent = ok;
}
function readFile(input){
    var OK = window.storage.loadFile(input);  //TODO this runs asynchron
    if(!OK){ 
      return;
    } //aborted by user
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="55" name="Inventory" tags="_back_ _nodeffered_" position="600,725" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
[[Back|_back_]]&lt;/br&gt;
&lt;%=window.gm.player.name%&gt; inventory: &lt;/br&gt;&lt;/br&gt;
&lt;%
var x = 0, id=&#39;&#39;; 
var inv = window.gm.player.Inv;
var maxSlots = inv.count(); 
for(var i=0;i&lt;maxSlots;i++){
  id=inv.getItemId(i);
  %&gt;&lt;%=window.gm.printItem(id,inv.countItem(id).toString()+&#39;x &#39;+inv.getItem(id).desc+&#39; &#39;
    //+inv.getItem(id).usable(inv).msg
    ,window.gm.player)%&gt;&lt;%
} 
%&gt;
&lt;div id=&#39;output&#39;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="56" name="Relations" tags="_back_ _nodeffered_" position="725,725" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
[[Back|_back_]]&lt;/br&gt;
&lt;%=window.gm.player.name%&gt; relations: &lt;/br&gt;&lt;/br&gt;
&lt;%=window.gm.printRelationSummary()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="57" name="Achievements" tags="_back_" position="850,725" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
[[Back|_back_]]&lt;/br&gt;
&lt;%=window.gm.printAchievements()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="58" name="Player_Dashboard" tags="_back_" position="975,725" size="100,100">&lt;!--a dashboard where the player can check his other stuff--&gt;
&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
Here you can check and modify several options: &lt;/br&gt;
Your outfit can only be changed by using a wardrobe.&lt;/br&gt;
&lt;%if(window.story.state._gm.playerParty.length&gt;1){%&gt;
  Your party consist of &lt;%=(function(){var msg=[];for(var n of window.story.state._gm.playerParty){msg.push(window.story.state.chars[n].name);}return(msg);}()).join(&#39;,&#39;)%&gt;&lt;/br&gt;
&lt;%}%&gt;
[[Back|_back_]] [[Status]] [[Levelup]] [[View|Mirror]] [[Inventory]] [[Relations]] [[QuestList]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="59" name="QuestList" tags="_back_" position="1100,725" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
[[Back|_back_]]&lt;/br&gt;
&lt;%=window.gm.printQuestList()%&gt;
&lt;/br&gt;[[Back|_back_]]
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="60" name="Mirror" tags="_back_" position="1225,725" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
[[Back|_back_]]&lt;/br&gt; Checking out &lt;%=window.gm.player.name%&gt;:&lt;/br&gt;
&lt;div id=&#39;output&#39;&gt;&lt;%=window.gm.printBodyDescription(window.gm.player,true)%&gt;&lt;div&gt;
[[Back|_back_]]&lt;/br&gt;
&lt;!--todo: set height depending on browsersize--&gt;
&lt;!--&lt;div id=&#39;Canvas&#39; style=&#39;height: 30em;background: url(&quot;assets/doll/doll_small_xcf-Skirt.png&quot;) no-repeat center,url(&quot;assets/doll/doll_small_xcf-Body.png&quot;) no-repeat center, url(&lt;%=window.gm.getScenePic(window.gm.player.location)%&gt;)no-repeat center;color:black;&#39;&gt;&lt;/div&gt;--&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="61" name="Wardrobe" tags="_back_ _nodeffered_" position="100,850" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;p&gt;[[Back|_back_]] [[Mirror]]&lt;/p&gt; (Tools and weapons can be changed via Inventory.)&lt;/br&gt;
&lt;%=window.gm.player.name%&gt; has equipped: &lt;%=window.gm.printEquipmentSummary()%&gt;&lt;/br&gt;&lt;/br&gt;
&lt;div id=&quot;output&quot;&gt;&lt;/div&gt;&lt;div id=&quot;choice&quot;&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
var x = 0, id=&#39;&#39;; 
var whom = window.gm.player,_ids2 = whom.Outfit.getAllIds();;
var _ids = whom.Wardrobe.getAllIds().filter(x=&gt;{return(_ids2.indexOf(x)&lt;0)}); //filter away already equipped ids 
for(var i=0;i&lt;_ids.length;i++){window.gm.printEquipment(whom,whom.Wardrobe.getItem(_ids[i]));}
for(var i=0;i&lt;_ids2.length;i++){window.gm.printEquipment(whom,whom.Outfit.getItem(_ids2[i]));}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="62" name="Settings" tags="_back_ _noshortkey_" position="225,850" size="100,100">&lt;section&gt; &lt;!--&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;--&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
[[Back|_back_]]&lt;/br&gt;
&lt;p class=&quot;author&quot;&gt;settings are stored in save-game until I find a way to store them in cookies.&lt;/p&gt;
Theme:
&lt;a href=&quot;javascript:window.styleSwitcher.setStyle(&#39;light&#39;);window.gm.refreshAllPanel();&quot;&gt;light&lt;/a&gt;
&lt;a href=&quot;javascript:window.styleSwitcher.setStyle(&#39;gray&#39;);window.gm.refreshAllPanel();&quot;&gt;gray&lt;/a&gt;
&lt;a href=&quot;javascript:window.styleSwitcher.setStyle(&#39;dark&#39;);window.gm.refreshAllPanel();&quot;&gt;dark&lt;/a&gt;&lt;/br&gt;
show Lewd pictures: &lt;input type=&quot;checkbox&quot; id=&#39;showNSFWPictures&#39; onclick=&#39;toggleSetting(this);&#39; name=&quot;showNSFWPictures&quot; value=&quot;x&quot;&gt; (If false, lewd graphics are not shown/replaced with SFW.)&lt;/br&gt;
show dungeon map: &lt;input type=&quot;checkbox&quot; id=&#39;showDungeonMap&#39; onclick=&#39;toggleSetting(this);&#39; name=&quot;showDungeonMap&quot; value=&quot;x&quot;&gt; (If false, the dungeon map is not rendered.)&lt;/br&gt;
show Combat-pictures: &lt;input type=&quot;checkbox&quot; id=&#39;showCombatPictures&#39; onclick=&#39;toggleSetting(this);&#39; name=&quot;showCombatPictures&quot; value=&quot;x&quot;&gt; (Some graphics are large and take time to render, thus slowing down combat.)&lt;/br&gt;
non-metric measurement: &lt;input type=&quot;checkbox&quot; id=&#39;nonMetric&#39; onclick=&#39;toggleSetting(this);&#39; name=&quot;nonMetric&quot; value=&quot;x&quot; disabled&gt; (NOT IMPLEMENTED! Use inch/galllons instead of metric units)&lt;/br&gt;
&lt;!--TODO what settings ?
*  Disable over-penetration &lt;/br&gt;
A lot of female are not happy about the fact that many erotic fiction or imagery picture the penetration of cervix because its pretty painful. You might disable this here therefore. &lt;/br&gt;
On the other hand a lot of males have some kind of fetish for this. &lt;/br&gt;
*  Disable snuff &amp; gore
*  Disable vore
*  Less-sex-mode
If you enable this your route to bad end by sex-related action is much shorter. This should enforce a more chaste play.&lt;/br&gt;
--&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
function toggleSetting(elmt){
  let toggle=window.story.state.Settings[elmt.id]=!window.story.state.Settings[elmt.id];
  elmt.checked=toggle;
}
[&#39;showNSFWPictures&#39;,&#39;showDungeonMap&#39;,&#39;showCombatPictures&#39;,&#39;nonMetric&#39;].forEach(x=&gt;(document.querySelector(&quot;#&quot;+x).checked=window.story.state.Settings[x]));
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="63" name="Settings2" tags="_back_" position="350,850" size="100,100">&lt;!--just test--&gt;
&lt;section&gt;&lt;!--&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;--&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;div&gt;&lt;canvas id=&quot;exampleCanvas&quot; width=&quot;240&quot; height=&quot;225&quot;&gt;Your browser doesn&#39;t support the canvas tag.    &lt;/canvas&gt;&lt;/div&gt;
&lt;svg height=&quot;200px&quot; id=&quot;svg&quot;&gt;&lt;%=window.gm.images[&quot;CatGirl1&quot;]()%&gt;&lt;/svg&gt;
&lt;button onclick=&#39;window.gm.printCombatScreen()&#39;&gt;test a&lt;/button&gt;
&lt;button onclick=&#39;onimage(&quot;assets/favicon.png&quot;)&#39;&gt;test IMG&lt;/button&gt;
&lt;button onclick=&#39;window.gm.util.fitSVGtoContent(&quot;svg&quot;)&#39;&gt;test SVG&lt;/button&gt;
&lt;script&gt;
  function onimage(imgsrc){
    var canvas = document.getElementById(&quot;exampleCanvas&quot;);
    var ctx = canvas.getContext(&quot;2d&quot;);
    //var img = document.getElementById(&quot;photo&quot;);
    var img = new Image(); // Create new img element
    img.src = imgsrc;//&#39;https://twinery.org/homepage/img/logo.svg&#39;;   //todo the loading o image takes a while and it will not refreh automatically
    ctx.drawImage(img, 0, 0);
  };
  onimage(&quot;assets/bird.gif&quot;);
&lt;/script&gt;
[[Back|_back_]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="64" name="Status" tags="_back_" position="475,850" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;%let char=window.gm.player;%&gt;
Status of &lt;%=char.name%&gt;:   [[Back|_back_]]&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.printOutput(window.gm.printEffectSummary(&quot;&lt;%=char.id%&gt;&quot;,{showstats:true}));&#39;&gt;Stats&lt;/a&gt;
&lt;a0 onclick=&#39;window.gm.printOutput(window.gm.printEffectSummary(&quot;&lt;%=char.id%&gt;&quot;,{showresistance:true}));&#39;&gt;Resistance&lt;/a&gt;
&lt;a0 onclick=&#39;window.gm.printOutput(window.gm.printEffectSummary(&quot;&lt;%=char.id%&gt;&quot;,{showskill:true}));&#39;&gt;Skills&lt;/a&gt;
&lt;a0 onclick=&#39;window.gm.printOutput(window.gm.printEffectSummary(&quot;&lt;%=char.id%&gt;&quot;,{showfetish:true}));&#39;&gt;Fetish&lt;/a&gt;
&lt;/br&gt;&lt;div id=&#39;output&#39;&gt;&lt;/div&gt;&lt;/br&gt;   &lt;!--message is rendered here--&gt;
[[Back|_back_]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;window.gm.printOutput(window.gm.printEffectSummary(window.gm.player.id,{showstats:true}));&lt;/script&gt;</tw-passagedata><tw-passagedata pid="65" name="Levelup" tags="_back_ _nosave_ _noshortkey_" position="600,850" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
[[Back|_back_]]&lt;/br&gt;
&lt;% let char=window.gm.player;if(char.canLevelUp){%&gt;
&lt;%=char.name%&gt; has enough XP to &lt;a0 onclick=&#39;levelUp(&quot;&lt;%=char.id%&gt;&quot;)&#39;&gt;Level up&lt;/a&gt;!&lt;/br&gt;
&lt;% }else{%&gt;
&lt;%=char.name%&gt; need more XP to level up.&lt;/br&gt;
&lt;% }%&gt;
&lt;div id=&#39;output&#39;&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;function levelUp(char){
  window.story.state.chars[char].levelUp(1);
  window.gm.refreshAllPanel();
}
function statUp(statid,charname){
  let char =window.story.state.chars[charname];
  char.Stats.increment(statid,1);
  char._data.unspentStat-=1; //todo ugly
  window.gm.refreshAllPanel();
}
function showStats(charname){
  let char =window.story.state.chars[charname];
  let _wheights = char.autolevelWheight();
  let msg=&#39;&#39;;
  if(char._data.unspentStat&gt;0){
    msg=char._data.unspentStat+&#39; points can be distributed on stats:&lt;/br&gt;&lt;table&gt;&#39;;
    for(var n of _wheights){
      msg+=&quot;&lt;tr&gt;&lt;td&gt;&lt;a href=\&quot;javascript:void(0)\&quot; onclick=&#39;statUp(\&quot;&quot;+n.id+&quot;\&quot;,\&quot;&quot;+char.id+&quot;\&quot;)&#39;&gt;&quot;+n.id+&quot;&lt;/a&gt;&lt;/td&gt;&lt;td&gt;is &quot;+char.Stats.getItem(n.id).base+&quot;&lt;/td&gt;&lt;/tr&gt;&quot;;
    }
    msg+=&#39;&lt;/table&gt;&#39;;
  }
  window.gm.printOutput(msg);
}
showStats(&lt;%=&quot;\&quot;&quot;+char.id+&quot;\&quot;&quot;%&gt;);
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="66" name="listsell" tags="" position="725,850" size="100,100">&lt;!--this fragment can be used to setup a list of items to sell:
add into passage: &lt;div id=&quot;choice&quot;&gt;&lt;/div&gt;&lt;/br&gt;&lt;/br&gt; &lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;&lt;/br&gt;   
in &lt;script&gt; define variable _Entrys and specify wares to sell
and run renderToSelector(&quot;#panel&quot;, &quot;listsell&quot;); 
--&gt;
&lt;script&gt;
//define window.gm.shop.WaresToSell in your passage !
for(var i=0;window.gm.shop.WaresToSell.length&gt;i;i++){
    let item = window.gm.shop.WaresToSell[i].item;
    let _cost=window.gm.shop.WaresToSell[i].cost;
    window.gm.shop.printShopSellEntry(item,_cost,
    cbCanBuy=(function(item){return(window.gm.shop.defaultCanSell(item,_cost));}),
    cbPostBuy=(function(item){window.gm.shop.defaultPostSell(item,_cost)}));
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="67" name="LocalChest" tags="_back_ _nosave_" position="850,850" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;a0 id=&#39;hint&#39; onclick=&#39;(function($event){document.querySelector(&quot;#&quot;+id+&quot;~p&quot;).toggleAttribute(&quot;hidden&quot;);})(this);&#39;&gt;Hint&lt;/a&gt;
&lt;p class=&#39;speech&#39; hidden&gt;The left column shows the items currently present in this location, the right one your inventory.&lt;br&gt;
Use the arrows to move the items between the columns but remember: the space in your inventory might be limited.&lt;br&gt;
When you leave the location, all items you didnt store in your inventory are lost.  
&lt;/p&gt;[[Done|_back_]]&lt;p id=&quot;choice&quot;&gt;&lt;/p&gt;&lt;br&gt;&lt;p id=&quot;output&quot;&gt;&lt;/p&gt;
&lt;br&gt;[[Done|_back_]]
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;window.gm.shop.printItemTransfer(window.story.state.chars.LocalChest,window.gm.player);
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="68" name="listbuy" tags="" position="975,850" size="100,100">&lt;!--this fragment can be used to setup a list of items to buy:
add into passage: &lt;div id=&quot;choice&quot;&gt;&lt;/div&gt;&lt;/br&gt;&lt;/br&gt; &lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;&lt;/br&gt;   
in &lt;script&gt; define variable _Entrys and specify wares to buy
and run renderToSelector(&quot;#panel&quot;, &quot;listbuy&quot;); 
--&gt;
&lt;script&gt;
//define window.gm.shop.WaresToBuy in your passage !
for(var i=0;window.gm.shop.WaresToBuy.length&gt;i;i++){
    let item=window.gm.shop.WaresToBuy[i].item;
    let _cost=window.gm.shop.WaresToBuy[i].cost;
    window.gm.shop.printShopBuyEntry(item,_cost,
    cbCanBuy=(function(item){return window.gm.shop.cbCanBuyPerverse(item,_cost,0)}),
    cbPostBuy=(function(item){window.gm.shop.defaultPostBuy(item,_cost)}));
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="69" name="_back_" tags="" position="1100,850" size="100,100">&lt;!--this just exists because Back-links would rendered as non existent--&gt;</tw-passagedata><tw-passagedata pid="70" name="PassageTemplate" tags="template" position="250,500" size="100,100">The page should be setup like this:
&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
content here !
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="71" name="SubpanelTemplate" tags="_back_" position="75,600" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
If this is a subpanel you can use back-tag and _back_-Link
[[Back|_back_]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="72" name="_SaveAndRestore_" tags="" position="225,975" size="100,100">&lt;script&gt;
var x = 1; 
var maxSlots = 4; //number saveslots available; has to fit form below
 do {
   const _x = x;
   const slot = &#39;save&#39;.concat(x);
  document.querySelector(&#39;#save&#39;.concat(x)).addEventListener(&#39;click&#39;, function(){window.storage.saveBrowser(slot)});
  document.querySelector(&#39;#load&#39;.concat(x)).addEventListener(&#39;click&#39;, function(){window.storage.loadBrowser(slot)});
  document.querySelector(&#39;#delete&#39;.concat(x)).addEventListener(&#39;click&#39;, function(){window.storage.delete(slot)});
  document.querySelector(&#39;#save&#39;.concat(x)).addEventListener(&#39;click&#39;, function(){refresh(_x)});
  document.querySelector(&#39;#load&#39;.concat(x)).addEventListener(&#39;click&#39;, function(){refresh(_x)});
  document.querySelector(&#39;#delete&#39;.concat(x)).addEventListener(&#39;click&#39;, function(){refresh(_x)});
   refresh(x);
   x = x + 1;
 } while (x &lt;= maxSlots);
function refresh(slot){
  var ok = window.storage.getSaveInfo(&#39;save&#39;.concat(slot));
   document.querySelector(&#39;output&#39;.concat(slot)).textContent = ok;
}
&lt;/script&gt;
&lt;form&gt;
&lt;label&gt;Info:&lt;output&gt;&lt;/output&gt;&lt;/label&gt;&lt;/br&gt;
&lt;button type=&quot;button&quot; id=&quot;save1&quot;&gt;save 1&lt;/button&gt;&lt;button type=&quot;button&quot; id=&quot;load1&quot;&gt;load 1&lt;/button&gt;
&lt;button type=&quot;button&quot; id=&quot;delete1&quot;&gt;delete 1&lt;/button&gt;&lt;label&gt;Info:&lt;output1&gt;&lt;/output1&gt;&lt;/label&gt;&lt;/br&gt;
&lt;button type=&quot;button&quot; id=&quot;save2&quot;&gt;save 2&lt;/button&gt;&lt;button type=&quot;button&quot; id=&quot;load2&quot;&gt;load 2&lt;/button&gt;
&lt;button type=&quot;button&quot; id=&quot;delete2&quot;&gt;delete 2&lt;/button&gt;&lt;label&gt;Info:&lt;output2&gt;&lt;/output2&gt;&lt;/label&gt;&lt;/br&gt;
&lt;button type=&quot;button&quot; id=&quot;save3&quot;&gt;save 3&lt;/button&gt;&lt;button type=&quot;button&quot; id=&quot;load3&quot;&gt;load 3&lt;/button&gt;
&lt;button type=&quot;button&quot; id=&quot;delete3&quot;&gt;delete 3&lt;/button&gt;&lt;label&gt;Info:&lt;output3&gt;&lt;/output3&gt;&lt;/label&gt;&lt;/br&gt;
&lt;button type=&quot;button&quot; id=&quot;save4&quot;&gt;save 4&lt;/button&gt;&lt;button type=&quot;button&quot; id=&quot;load4&quot;&gt;load 4&lt;/button&gt;
&lt;button type=&quot;button&quot; id=&quot;delete4&quot;&gt;delete 4&lt;/button&gt;&lt;label&gt;Info:&lt;output4&gt;&lt;/output4&gt;&lt;/label&gt;&lt;/br&gt;
&lt;/form&gt;
[[Start]]</tw-passagedata><tw-passagedata pid="73" name="_SuperSimpleStory_" tags="" position="1200,125" size="100,100">&lt;%if(visited(window.passage.name)&lt;=1){%&gt;
Welcome to this short story.&lt;/br&gt;&lt;/br&gt;
&lt;%}%&gt;
&lt;mark&gt;The previous part is an example how to conditional build the html output &lt;/br&gt;&lt;/mark&gt;
You are lying in your bed.&lt;/br&gt;
What would you like to do.&lt;/br&gt;
[[Sleep|SleepALittle]]&lt;/br&gt;
[[Wakeup]] &lt;/br&gt;</tw-passagedata><tw-passagedata pid="74" name="SleepALittle" tags="" position="400,825" size="100,100">You are sleeping some more. &lt;/br&gt;
&lt;mark&gt;The folowing is an example how to print a javascript calculation to html:&lt;/br&gt;&lt;/mark&gt;
It is now &lt;%= 5*visited(window.passage.name)%&gt; minutes later.&lt;/br&gt;
[[Continue|_SuperSimpleStory_]]</tw-passagedata><tw-passagedata pid="75" name="Wakeup" tags="" position="575,825" size="100,100">You groan as you wake up. &#39;Damn life&#39;&lt;/br&gt;
[[Start]]</tw-passagedata><tw-passagedata pid="76" name="_ImagesAndOtherMedia_" tags="" position="1075,125" size="100,100">&lt;mark&gt;embed images in the following way:&lt;/mark&gt;&lt;/br&gt;
stored on a server:&lt;/br&gt;
&lt;img alt=&quot;twinerylogo&quot; src=&quot;https://twinery.org/homepage/img/logo.svg&quot; width=&quot;256&quot; height=&quot;256&quot;&gt;&lt;/br&gt;
stored in .dist/assets:&lt;/br&gt;
&lt;img alt=&quot;tweegoicon&quot; src=&quot;assets/favicon.png&quot; &gt;&lt;/br&gt;
animated gif:&lt;/br&gt;
&lt;img alt=&quot;bird.gif&quot; src=&quot;assets/bird.gif&quot; &gt;&lt;/br&gt;
audio with manual control:&lt;/br&gt; 
&lt;audio id=&quot;audio_with_controls&quot; controls src=&quot;assets/drink.ogg&quot; type=&quot;audio/ogg&quot; &gt;&lt;/audio&gt;
audio autoplay:&lt;/br&gt;
&lt;audio id=&quot;audio_autoplay&quot; autoplay src=&quot;assets/chimes.ogg&quot; type=&quot;audio/ogg&quot; &gt;&lt;/audio&gt;
video with autoplay:&lt;/br&gt;
&lt;video id=&quot;player2&quot; autoplay &gt;
  &lt;source src=&quot;assets/Comedy.mp4&quot; type=&quot;video/mp4&quot;&gt;
&lt;/video&gt;

video with integrated and separate controls:&lt;/br&gt;
&lt;video id=&quot;player&quot; controls&gt;
  &lt;source src=&quot;assets/Comedy.mp4&quot; type=&quot;video/mp4&quot;&gt;
&lt;/video&gt;

&lt;button id=&quot;play&quot;&gt;Play&lt;/button&gt;
&lt;button id=&quot;pause&quot;&gt;Pause&lt;/button&gt;
&lt;button id=&quot;duration&quot;&gt;Länge anzeigen&lt;/button&gt;
&lt;p id=&quot;ausgabe&quot;&gt;&lt;/p&gt;
 
&lt;script&gt;
  var song = document.getElementById(&#39;player&#39;);
  document.getElementById(&#39;play&#39;).addEventListener(&#39;click&#39;, function(){ song.play(); }, false);
  document.getElementById(&#39;pause&#39;).addEventListener(&#39;click&#39;, function(){ song.pause(); }, false);
  document.getElementById(&#39;duration&#39;).addEventListener(&#39;click&#39;, function(){ 
  document.getElementById(&#39;ausgabe&#39;).innerHTML = &#39;Die Dauer des Videos beträgt: &#39;+ song.duration; +&#39; Sekunden.&#39;}, false);
&lt;/script&gt;
[[Start]]</tw-passagedata><tw-passagedata pid="77" name="_ControlElements_" tags="" position="1200,25" size="100,100">&lt;div id=&quot;choice&quot;&gt;
&lt;p&gt;click on image to show related text and border&lt;/p&gt;
&lt;table&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;img id=&quot;1&quot; src=&quot;https://twinery.org/homepage/img/logo.svg&quot; width=&quot;256&quot; height=&quot;256&quot; onclick=&#39;window.gm.onSelect(this,&quot;div#choice table tbody tr td *&quot;,&quot;div#info&quot;);&#39;&gt;&lt;/td&gt;
&lt;td&gt;&lt;img id=&quot;2&quot; src=&quot;https://twinery.org/homepage/img/logo.svg&quot; width=&quot;256&quot; height=&quot;256&quot; onclick=&#39;window.gm.onSelect(this,&quot;div#choice table tbody tr td *&quot;,&quot;div#info&quot;);&#39;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;img id=&quot;3&quot; src=&quot;https://twinery.org/homepage/img/logo.svg&quot; width=&quot;256&quot; height=&quot;256&quot; onclick=&#39;window.gm.onSelect(this,&quot;div#choice table tbody tr td *&quot;,&quot;div#info&quot;);&#39;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div id=&quot;info&quot;&gt;
&lt;p id=&quot;1&quot; hidden&gt;Text 1&lt;/p&gt;&lt;p id=&quot;2&quot; hidden&gt;[[Start]]&lt;/p&gt;&lt;p id=&quot;3&quot; hidden&gt;Text 3&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Geben Sie Ihre Zahlungsweise an:&lt;/p&gt;
  &lt;fieldset&gt; &lt;legend&gt;creditcard&lt;/legend&gt;
    &lt;input type=&quot;radio&quot; id=&quot;mc&quot; name=&quot;Zahlmethode&quot; value=&quot;Mastercard&quot; disabled&gt;
    &lt;label for=&quot;mc&quot;&gt; Mastercard&lt;/label&gt; 
    &lt;input type=&quot;radio&quot; id=&quot;vi&quot; name=&quot;Zahlmethode&quot; value=&quot;Visa&quot; checked&gt;
    &lt;label for=&quot;vi&quot;&gt; Visa&lt;/label&gt;
    &lt;input type=&quot;radio&quot; id=&quot;ae&quot; name=&quot;Zahlmethode&quot; value=&quot;AmericanExpress&quot;&gt;
    &lt;label for=&quot;ae&quot;&gt; American Express&lt;/label&gt; 
  &lt;/fieldset&gt;
&lt;label&gt;static dropdown:
		&lt;select id=&quot;person&quot; onchange=&#39;selectperson(this)&#39;&gt;
			&lt;option value=&quot;23&quot;&gt;Albers, Alfred&lt;/option&gt;
			&lt;option value=&quot;24&quot; selected&gt;Braun, Berta&lt;/option&gt;
      &lt;option value=&quot;25&quot;&gt;Zeta, Bort&lt;/option&gt;
		&lt;/select&gt;
&lt;/label&gt;
&lt;form name=&quot;terminauswahl&quot;&gt;
	&lt;label&gt;Professor:
		&lt;select id=&quot;professor&quot;&gt;
			&lt;option value=&quot;&quot;&gt;Bitte wählen:&lt;/option&gt;
      &lt;option value=&quot;P23&quot;&gt;Albers, Alfred&lt;/option&gt;
			&lt;option value=&quot;P24&quot;&gt;Braun, Berta&lt;/option&gt;
			&lt;option value=&quot;P25&quot;&gt;Drachenzaun, Doris&lt;/option&gt;
			&lt;option value=&quot;P26&quot;&gt;Münz, Stephan&lt;/option&gt;
			&lt;option value=&quot;P27&quot;&gt;Meier, Manfred&lt;/option&gt;
		&lt;/select&gt;
	&lt;/label&gt;
	&lt;label&gt;Lesung:
		&lt;select id=&quot;vorlesung&quot; disabled&gt;
			&lt;option value=&quot;&quot;&gt;------&lt;/option&gt;
		&lt;/select&gt;
	&lt;/label&gt;
	&lt;label&gt;Termin:
		&lt;select id=&quot;termin&quot; disabled&gt;
			&lt;option value=&quot;&quot;&gt;------&lt;/option&gt;
		&lt;/select&gt;
	&lt;/label&gt;
  	&lt;output id=&quot;auswahl&quot;&gt;&lt;/output&gt;
&lt;/form&gt;
&lt;div id=&#39;output&#39;&gt;&lt;/div&gt;
&lt;script&gt;
function selectperson(elmnt){
		var menu = document.getElementById(elmnt.id);
		document.querySelector(&#39;div#output&#39;).innerHTML = menu.value +&quot;&quot;+menu.options[menu.selectedIndex].label+&quot; &quot;+menu.options[menu.selectedIndex].value;		
}
/*class SelectionController extends EventTarget {
    constructor(selectElement, datasource, parentNode = null){
        super(); // Pflicht: Konstruktor der Superklasse aufrufen
        if (!(selectElement instanceof HTMLSelectElement)){
            throw new Error(
                &quot;Controller-Objekt benötigt ein select Element als ersten Parameter&quot;);
        }
        if (parentNode &amp;&amp; !(parentNode instanceof SelectionController)){
            throw new Error(
                &quot;Controller-Objekt benötigt einen SelectionController als zweiten Parameter&quot;
            );
        }
        this.selectElement = selectElement;
        this.parentNode = parentNode;
        this.dataSource = dataSource;
        this.selectElement.addEventListener(&quot;change&quot;, event =&gt; this._handleChangeEvent(event))
        if (parentNode){
            parentNode.addEventListener(&quot;change&quot;, event =&gt; this.mapData(event.selectedObject)); //?? event =&gt; this.mapData(event.selectedObject));
        }
    }
    // Ordnet dem select Element eine Datenquelle zu. 
    // dataSource ist ein Objekt, aus dem die getValueList die Daten für die
    // select-Optionen ermitteln kann, oder null, um das select-Element zu disablen
    mapData(dataSource){
        // Quelldaten-Objekt im Controller speichern.
        this.dataSource = dataSource;
        // Optionen nur anfassen, wenn eine getValueList Methode vorhanden ist.
        //  Andernfalls davon ausgehen, dass die options durch das HTML
        // bereitgestellt werden.
        if (typeof this.getValueList == &quot;function&quot;){
            // Existierende Optionen entfernen
            removeOptions(this.selectElement);
            // Wenn dataSource nicht null war, die neuen Optionen daraus beschaffen
            // Andernfalls das select-Element deaktivieren
            const options = dataSource &amp;&amp; this.getValueList(dataSource(this.selectElement.id,this.selectElement.value))//??this.getValueList(dataSource);
            if (!options || !options.length){
                setToDisabled(this.selectElement)
            } else {
                setToEnabled(this.selectElement, options);
            }
        }
        // Zum Abschluss ein change-Event auf dem select-Element feuern, damit
        // jeder weiß, dass hier etwas passiert ist
        this.selectElement.dispatchEvent(new Event(&quot;change&quot;));
        // Helper: Entferne alle options aus einem select Element	
        function removeOptions(selectElement){
                while (selectElement.length &gt; 0) selectElement.remove(0);
            }
            // Helper: select-Element auf disabled setzen und eine Dummy-Option 
            // eintragen. Eine Variante wäre: das selectElement auf hidden setzten
        function setToDisabled(selectElement){
                addOption(selectElement, &quot;&quot;, &quot;------&quot;);
                selectElement.disabled = true;
            }
            // Helper: disabled-Zustand vom select-Element entfernen und die
            // übergebenen Optionen eintragen. Vorweg eine Dummy-Option &quot;Bitte wählen&quot;.
        function setToEnabled(selectElement, options){
                addOption(selectElement, &quot;&quot;, &quot;Bitte wählen:&quot;);
                for (var optionData of options){
                    addOption(selectElement, optionData.value, optionData.text);
                }
                selectElement.disabled = false;
            }
            // Helper: Option-Element erzeugen, ausfüllen und im select-Element eintragen
        function addOption(selectElement, value, text){
            let option = document.createElement(&quot;option&quot;);
            option.value = value;
            option.text = text
            selectElement.add(option);
        }
    }
    // Abstrakte Methode! Wird sie nicht überschrieben, wird der TypeError geworfen
    getValue(key){
      this.datasource(this.selectElement.id,key);
        //throw new TypeError(&quot;Die abstrakte Methode &#39;getValue&#39; wurde nicht implementiert!&quot;);
    }
    // Stellt den im select Element ausgewählten Optionswert zur Verfügung
    get selectedKey(){
        return this.selectElement.value;
    }
    // Liefert das Datenobjekt zum ausgewählten Optionswert
    get selectedObject(){
            return this.dataSource ? this.getValue(this.selectElement.value) : null;
    }
    // privat
    // Die Methode reagiert auf das change-Event des select-Elements
    // und stellt es als eigenes change-Event des Controllers zur Verfügung
    _handleChangeEvent(event){
        let nodeChangeEvent = new Event(&quot;change&quot;);
        nodeChangeEvent.selectedObject = this.selectedObject;
        this.dispatchEvent(nodeChangeEvent);
    }
}*/
/*class ProfessorController extends SelectionController {
  constructor(selectElement){
    super(selectElement, null);
  }
  getValue(quelle, profId){
    return quelle.find(prof =&gt; prof.id == profId);
  }
}
class VorlesungController extends SelectionController {
  constructor(selectElement, parentController){
    super(selectElement, parentController);
  }
  getValueList(professor){
    return professor.vorlesungen.map(vorlesung =&gt; ({
      value: vorlesung.nummer,
      text: vorlesung.thema
    }));
  }
  getValue(professor, vorlesungNr){
    return professor.vorlesungen.find(vorlesung =&gt; vorlesung.nummer ==
      vorlesungNr);
  }
}
class TerminController extends SelectionController {
  constructor(selectElement, parentController){
    super(selectElement, parentController);
  }
  getValueList(vorlesung){
    return vorlesung.termine.map(termin =&gt; ({
      value: termin.id,
      text: termin.zeit
    }));
  }
  getValue(vorlesung, terminId){
    return vorlesung.termine.find(termin =&gt; termin.id == terminId);
  }
}*/
function datasource(category,key){
    if(category===&quot;professor&quot;){
      return([{ value: &quot;V1&quot;, text: &quot;vorlesung1&quot;}]);
    } else if (category===&quot;vorlesung&quot;){
      return([{ value: &quot;T1&quot;, text: &quot;termin11&quot;}]);
    } else {
      return([{ value: &quot;P1&quot;, text: &quot;professor1&quot;}]);
    }
}/*
//document.addEventListener(&#39;DOMContentLoaded&#39;, 
(function (){
  const form = document.forms.terminauswahl;
  const profCtrl = new SelectionController(form.professor);
  const vorlesungCtrl = new SelectionController(form.vorlesung, profCtrl);
  const terminCtrl = new SelectionController(form.termin, vorlesungCtrl);
  terminCtrl.addEventListener(&quot;change&quot;, terminChanged)
  profCtrl.mapData(data)
  function terminChanged(event){
    let terminCtrl = event.target;
    let vorlesungCtrl = terminCtrl.parentNode;
    let profCtrl = vorlesungCtrl.parentNode;
    let ausgabe = document.getElementById(&#39;auswahl&#39;);
    ausgabe.textContent = terminCtrl.selectedKey != &quot;&quot; ?
      `${profCtrl.selectedKey}:${profCtrl.selectedObject.name} / ` +
      `${vorlesungCtrl.selectedKey}:${vorlesungCtrl.selectedObject.thema} / ` +
      `${terminCtrl.selectedKey}:${terminCtrl.selectedObject.zeit}` : &quot;&quot;;
  }
})();//);*/
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="78" name="_ControlElements2_" tags="" position="1200,25" size="100,100">&lt;div id=&quot;choice&quot;&gt;
&lt;p&gt;click on image to show related text and border&lt;/p&gt;
&lt;table&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;img id=&quot;1&quot; src=&quot;https://twinery.org/homepage/img/logo.svg&quot; width=&quot;256&quot; height=&quot;256&quot; onclick=&#39;window.gm.onSelect(this,&quot;div#choice table tbody tr td *&quot;,&quot;div#info&quot;);&#39;&gt;&lt;/td&gt;
&lt;td&gt;&lt;img id=&quot;2&quot; src=&quot;https://twinery.org/homepage/img/logo.svg&quot; width=&quot;256&quot; height=&quot;256&quot; onclick=&#39;window.gm.onSelect(this,&quot;div#choice table tbody tr td *&quot;,&quot;div#info&quot;);&#39;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;img id=&quot;3&quot; src=&quot;https://twinery.org/homepage/img/logo.svg&quot; width=&quot;256&quot; height=&quot;256&quot; onclick=&#39;window.gm.onSelect(this,&quot;div#choice table tbody tr td *&quot;,&quot;div#info&quot;);&#39;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div id=&quot;info&quot;&gt;
&lt;p id=&quot;1&quot; hidden&gt;Text 1&lt;/p&gt;&lt;p id=&quot;2&quot; hidden&gt;[[Start]]&lt;/p&gt;&lt;p id=&quot;3&quot; hidden&gt;Text 3&lt;/p&gt;
&lt;/div&gt;
&lt;label&gt;static dropdown:
		&lt;select id=&quot;person&quot; onchange=&#39;selectperson(this)&#39;&gt;
			&lt;option value=&quot;23&quot;&gt;Albers, Alfred&lt;/option&gt;
			&lt;option value=&quot;24&quot; selected&gt;Braun, Berta&lt;/option&gt;
      &lt;option value=&quot;25&quot;&gt;Zeta, Bort&lt;/option&gt;
		&lt;/select&gt;
&lt;/label&gt;
&lt;form name=&quot;terminauswahl&quot;&gt;
	&lt;label&gt;Professor:
		&lt;select id=&quot;professor&quot;&gt;
			&lt;option value=&quot;&quot;&gt;Bitte wählen:&lt;/option&gt;
      &lt;option value=&quot;P23&quot;&gt;Albers, Alfred&lt;/option&gt;
			&lt;option value=&quot;P24&quot;&gt;Braun, Berta&lt;/option&gt;
			&lt;option value=&quot;P25&quot;&gt;Drachenzaun, Doris&lt;/option&gt;
			&lt;option value=&quot;P26&quot;&gt;Münz, Stephan&lt;/option&gt;
			&lt;option value=&quot;P27&quot;&gt;Meier, Manfred&lt;/option&gt;
		&lt;/select&gt;
	&lt;/label&gt;
	&lt;label&gt;Lesung:
		&lt;select id=&quot;vorlesung&quot; disabled&gt;
			&lt;option value=&quot;&quot;&gt;------&lt;/option&gt;
		&lt;/select&gt;
	&lt;/label&gt;
	&lt;label&gt;Termin:
		&lt;select id=&quot;termin&quot; disabled&gt;
			&lt;option value=&quot;&quot;&gt;------&lt;/option&gt;
		&lt;/select&gt;
	&lt;/label&gt;
  	&lt;output id=&quot;auswahl&quot;&gt;&lt;/output&gt;
&lt;/form&gt;
&lt;div id=&#39;output&#39;&gt;&lt;/div&gt;
&lt;script&gt;
function selectperson(elmnt){
		var menu = document.getElementById(elmnt.id);
		document.querySelector(&#39;div#output&#39;).innerHTML = menu.value +&quot;&quot;+menu.options[menu.selectedIndex].label+&quot; &quot;+menu.options[menu.selectedIndex].value;		
}
var data = [
	{
		id: &quot;P23&quot;,
		name: &quot;Albers, Alfred&quot;,
		vorlesungen: [
			{
				nummer: &quot;L55&quot;,
				thema: &quot;Katzen in der freien Wildbahn&quot;,
				termine: [
					{
						id: &quot;T123&quot;,
						zeit: &quot;freitags 10 - 12&quot;
					},
					{
						id: &quot;T124&quot;,
						zeit: &quot;sonntags 18 - 20&quot;
					}
				]
			},
			{
				nummer: &quot;L56&quot;,
				thema: &quot;Katzen im Gefängnis&quot;,
				termine: [
					{
						id: &quot;T125&quot;,
						zeit: &quot;montags 12 - 14&quot;
					},
					{
						id: &quot;T126&quot;,
						zeit: &quot;dienstags 8 - 10&quot;
					}
				]
			},
			{
				nummer: &quot;L57&quot;,
				thema: &quot;Katzen in Musicals&quot;,
				termine: [
					{
						id: &quot;T127&quot;,
						zeit: &quot;dienstags 10 - 12&quot;
					},
					{
						id: &quot;T128&quot;,
						zeit: &quot;mittwochs 13 - 15&quot;
					}
				]
			}
		]
	},
	{
		id: &quot;P24&quot;,
		name: &quot;Braun, Berta&quot;,
		vorlesungen: [
			{
				nummer: &quot;L65&quot;,
				thema: &quot;Hunde im Himmel&quot;,
				termine: [
					{
						id: &quot;T163&quot;,
						zeit: &quot;freitags 10 - 12&quot;
					},
					{
						id: &quot;T164&quot;,
						zeit: &quot;sonntags 18 - 20&quot;
					}
				]
			},
			{
				nummer: &quot;L66&quot;,
				thema: &quot;Hunde in der Hölle&quot;,
				termine: [
					{
						id: &quot;T165&quot;,
						zeit: &quot;montags 12 - 14&quot;
					},
					{
						id: &quot;T166&quot;,
						zeit: &quot;dienstags 8 - 10&quot;
					}
				]
			},
			{
				nummer: &quot;L67&quot;,
				thema: &quot;Höllenhunde&quot;,
				termine: [
					{
						id: &quot;T167&quot;,
						zeit: &quot;dienstags 10 - 12&quot;
					},
					{
						id: &quot;T168&quot;,
						zeit: &quot;mittwochs 13 - 15&quot;
					}
				]
		}
	  ]
	},
	{
		id: &quot;P25&quot;,
		name: &quot;Drachenzaun, Doris&quot;,
		vorlesungen: [
			{
				nummer: &quot;L75&quot;,
				thema: &quot;Wirtschaftskram I&quot;,
				termine: [
					{
						id: &quot;T171&quot;,
						zeit: &quot;freitags 10 - 12&quot;
					},
					{
						id: &quot;T172&quot;,
						zeit: &quot;sonntags 18 - 20&quot;
					}
				]
			},
			{
				nummer: &quot;L76&quot;,
				thema: &quot;Wirtschaftskram II&quot;,
				termine: [
					{
						id: &quot;T173&quot;,
						zeit: &quot;montags 12 - 14&quot;
					},
					{
						id: &quot;T174&quot;,
						zeit: &quot;dienstags 8 - 10&quot;
					}
				]
			},
			{
				nummer: &quot;L77&quot;,
				thema: &quot;Wirtschaftskram III&quot;,
				termine: [
					{
						id: &quot;T175&quot;,
						zeit: &quot;dienstags 10 - 12&quot;
					},
					{
						id: &quot;T176&quot;,
						zeit: &quot;mittwochs 13 - 15&quot;
					}
				]
			}
		]
	},
	{
		id: &quot;P26&quot;,
		name: &quot;Münz, Stefan&quot;,
		vorlesungen: [
			{
				nummer: &quot;L85&quot;,
				thema: &quot;Webdesign in den 90ern&quot;,
				termine: [
					{
						id: &quot;T181&quot;,
						zeit: &quot;freitags 10 - 12&quot;
					},
					{
						id: &quot;T182&quot;,
						zeit: &quot;sonntags 18 - 20&quot;
					}
				]
			},
			{
				nummer: &quot;L86&quot;,
				thema: &quot;Webdesign nach der Jahrtausendwende&quot;,
				termine: [
					{
						id: &quot;T183&quot;,
						zeit: &quot;montags 12 - 14&quot;
					},
					{
						id: &quot;T184&quot;,
						zeit: &quot;dienstags 8 - 10&quot;
					}
				]
			},
			{
				nummer: &quot;L87&quot;,
				thema: &quot;Responsives Webdesign&quot;,
				termine: [
					{
						id: &quot;T185&quot;,
						zeit: &quot;dienstags 10 - 12&quot;
					},
					{
						id: &quot;T186&quot;,
						zeit: &quot;mittwochs 13 - 15&quot;
					}
				]
			}
		],
	},
	{
		id: &quot;P27&quot;,
		name: &quot;Meier, Manfred&quot;,
		vorlesungen: [
			{
				nummer: &quot;L95&quot;,
				thema: &quot;Althochdeutsch&quot;,
				termine: [
					{
						id: &quot;T191&quot;,
						zeit: &quot;freitags 10 - 12&quot;
					},
					{
						id: &quot;T192&quot;,
						zeit: &quot;sonntags 18 - 20&quot;
					}
				]
			},
			{
				nummer: &quot;L96&quot;,
				thema: &quot;Mittelhochdeutsch&quot;,
				termine: [
					{
						id: &quot;T193&quot;,
						zeit: &quot;montags 12 - 14&quot;
					},
					{
						id: &quot;T194&quot;,
						zeit: &quot;dienstags 8 - 10&quot;
					}
				]
			},
			{
				nummer: &quot;L97&quot;,
				thema: &quot;Deutsch für Angefangene&quot;,
				termine: [
					{
						id: &quot;T195&quot;,
						zeit: &quot;dienstags 10 - 12&quot;
					},
					{
						id: &quot;T196&quot;,
						zeit: &quot;mittwochs 13 - 15&quot;
					}
				]
			}
		]
	}
];
class SelectionController extends EventTarget {
    constructor(selectElement, parentNode = null){
        super(); // Pflicht: Konstruktor der Superklasse aufrufen
        if (!(selectElement instanceof HTMLSelectElement)){
            throw new Error(
                &quot;Controller-Objekt benötigt ein select Element als ersten Parameter&quot;);
        }
        if (parentNode &amp;&amp; !(parentNode instanceof SelectionController)){
            throw new Error(
                &quot;Controller-Objekt benötigt einen SelectionController als zweiten Parameter&quot;
            );
        }
        this.selectElement = selectElement;
        this.parentNode = parentNode;
        this.selectElement.addEventListener(&quot;change&quot;, event =&gt; this._handleChangeEvent(
            event))
        if (parentNode){
            parentNode.addEventListener(&quot;change&quot;, event =&gt; this.mapData(event.selectedObject));
        }
    }
    // Ordnet dem select Element eine Datenquelle zu. 
    // dataSource ist ein Objekt, aus dem die getValueList die Daten für die
    // select-Optionen ermitteln kann, oder null, um das select-Element zu disablen
    mapData(dataSource){
        // Quelldaten-Objekt im Controller speichern.
        this.dataSource = dataSource;
        // Optionen nur anfassen, wenn eine getValueList Methode vorhanden ist.
        //  Andernfalls davon ausgehen, dass die options durch das HTML
        // bereitgestellt werden.
        if (typeof this.getValueList == &quot;function&quot;){
            // Existierende Optionen entfernen
            removeOptions(this.selectElement);
            // Wenn dataSource nicht null war, die neuen Optionen daraus beschaffen
            // Andernfalls das select-Element deaktivieren
            const options = dataSource &amp;&amp; this.getValueList(dataSource);
            if (!options || !options.length){
                setToDisabled(this.selectElement)
            } else {
                setToEnabled(this.selectElement, options);
            }
        }
        // Zum Abschluss ein change-Event auf dem select-Element feuern, damit
        // jeder weiß, dass hier etwas passiert ist
        this.selectElement.dispatchEvent(new Event(&quot;change&quot;));
        // Helper: Entferne alle options aus einem select Element	
        function removeOptions(selectElement){
                while (selectElement.length &gt; 0) selectElement.remove(0);
            }
            // Helper: select-Element auf disabled setzen und eine Dummy-Option 
            // eintragen. Eine Variante wäre: das selectElement auf hidden setzten
        function setToDisabled(selectElement){
                addOption(selectElement, &quot;&quot;, &quot;------&quot;);
                selectElement.disabled = true;
            }
            // Helper: disabled-Zustand vom select-Element entfernen und die
            // übergebenen Optionen eintragen. Vorweg eine Dummy-Option &quot;Bitte wählen&quot;.
        function setToEnabled(selectElement, options){
                addOption(selectElement, &quot;&quot;, &quot;Bitte wählen:&quot;);
                for (var optionData of options){
                    addOption(selectElement, optionData.value, optionData.text);
                }
                selectElement.disabled = false;
            }
            // Helper: Option-Element erzeugen, ausfüllen und im select-Element eintragen
        function addOption(selectElement, value, text){
            let option = document.createElement(&quot;option&quot;);
            option.value = value;
            option.text = text
            selectElement.add(option);
        }
    }
    // Abstrakte Methode! Wird sie nicht überschrieben, wird der TypeError geworfen
    getValue(key){
        throw new TypeError(
            &quot;Die abstrakte Methode &#39;getValue&#39; wurde nicht implementiert!&quot;);
    }
    // Stellt den im select Element ausgewählten Optionswert zur Verfügung
    get selectedKey(){
        return this.selectElement.value;
    }
    // Liefert das Datenobjekt zum ausgewählten Optionswert
    get selectedObject(){
            return this.dataSource ? this.getValue(this.dataSource, this.selectElement.value) : null;
    }
    // privat
    // Die Methode reagiert auf das change-Event des select-Elements
    // und stellt es als eigenes change-Event des Controllers zur Verfügung
    _handleChangeEvent(event){
        let nodeChangeEvent = new Event(&quot;change&quot;);
        nodeChangeEvent.selectedObject = this.selectedObject;
        this.dispatchEvent(nodeChangeEvent);
    }
}
class ProfessorController extends SelectionController {
  constructor(selectElement){
    super(selectElement, null);
  }
  getValue(quelle, profId){
    return quelle.find(prof =&gt; prof.id == profId);
  }
}
class VorlesungController extends SelectionController {
  constructor(selectElement, parentController){
    super(selectElement, parentController);
  }
  getValueList(professor){
    return professor.vorlesungen.map(vorlesung =&gt; ({
      value: vorlesung.nummer,
      text: vorlesung.thema
    }));
  }
  getValue(professor, vorlesungNr){
    return professor.vorlesungen.find(vorlesung =&gt; vorlesung.nummer ==
      vorlesungNr);
  }
}</tw-passagedata><tw-passagedata pid="79" name="_VariablesAndScript_" tags="" position="1075,25" size="100,100">&lt;script&gt;
function getBanana(elmnt,val){
    window.story.state.vars.bananas +=val;
    //window.story.show(window.passage.name); this would reload the passage but would overwrite the elmnt-replace
    elmnt.replaceWith(&quot;took bananas &quot;+val); //replace the calling link with simple text to it a one-timer. But it will be restored if passage is reloaded 
}
&lt;/script&gt;
&lt;%
//initialise game state
//s is window.story.state from snowman!
//create a vars-container and define startvalues for some variables
if (!s.vars){ 
	s.vars = {
    bananas : 0
  }; 
}
%&gt;
&lt;% if(visited(window.passage.name)&lt;=1){
    s.vars.bananas+=2;}
%&gt;
You have &lt;%=s.vars.bananas%&gt; bananas. &lt;/br&gt;
&lt;mark&gt;If you want to call functions in this way you have to add them to a global object.This is done in the StoryScrip-passage. See there. &lt;/br&gt;&lt;/mark&gt;
You droped a banana and have now &lt;%-window.gm.dropBanana()%&gt;. &lt;/br&gt;

&lt;mark&gt;This is a empty link that is used to trigger a function that is defined in the page-script &lt;/br&gt;&lt;/mark&gt;
&lt;a0 onclick=getBanana(this,5)&gt;Get more banana&lt;/a&gt; &lt;/br&gt;
&lt;mark&gt;or calling a anonymous function (take notice how alert-string is escaped):&lt;/br&gt;&lt;/mark&gt;
&lt;a0 id=&#39;money&#39; onclick=&#39;(function ( $event ){ alert(&quot;alert &quot;.concat($event.id)); })(this);&#39;&gt;Get much money&lt;/a&gt;
&lt;mark&gt;Press refreh to update page display &lt;/br&gt;&lt;/mark&gt;
[[Refresh|_VariablesAndScript_]] &lt;/br&gt;
[[Start]]</tw-passagedata><tw-passagedata pid="80" name="debug_cheat" tags="_back_ _noshortkey_" position="1225,975" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
Some things for debugging:&lt;/br&gt;
&lt;/br&gt;[[MemoryGame]] [[HangmanGame]] [[MinesweeperAscii]] [[Evade]] [[Pong]]&lt;/br&gt; &lt;!--todo--&gt;
&lt;/br&gt;[[NewGamePlus]]&lt;/br&gt; &lt;!--todo--&gt;
[[Cheats|debug]]&lt;/br&gt;
[[Back|_back_]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="81" name="debug" tags="_back_ _noshortkey_" position="100,1100" size="100,100">&lt;section&gt; &lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
[[Back|_back_]] [[DebugTransform]] [[Styletest]] [[Emergency-Wardrobe|Wardrobe]] [[DebugImages]] [[DebugImages2]] [[dont use!|debug_cheat]]&lt;/br&gt;
Cheat buttons: those are meant for debugging and might break your game&lt;/br&gt;
&lt;a0  onclick=&#39;window.gm.player.Inv.addItem(new window.storage.constructors[&quot;Money&quot;](),200);window.gm.refreshAllPanel();&#39;&gt;Get 200$&lt;/a&gt;&lt;/br&gt;
&lt;/br&gt;
&lt;a0  onclick=&#39;unhideStats();window.gm.refreshAllPanel();&#39;&gt;unhide player stats&lt;/a&gt;&lt;/br&gt;
&lt;%if(window.story.state._gm.dbgShowCombatRoll){%&gt;
&lt;a0  onclick=&#39;window.story.state._gm.dbgShowCombatRoll=false;window.gm.refreshAllPanel();&#39;&gt;disable combat debug&lt;/a&gt;
&lt;%} else {%&gt;
&lt;a0  onclick=&#39;window.story.state._gm.dbgShowCombatRoll=true;window.gm.refreshAllPanel();&#39;&gt;enable combat debug (log combat calculations)&lt;/a&gt;
&lt;%}%&gt;
&lt;%if(window.story.state._gm.dbgShowQuestInfo){%&gt;
&lt;a0  onclick=&#39;window.story.state._gm.dbgShowQuestInfo=false;window.gm.refreshAllPanel();&#39;&gt;disable extended questinfo&lt;/a&gt;
&lt;%} else {%&gt;
&lt;a0  onclick=&#39;window.story.state._gm.dbgShowQuestInfo=true;window.gm.refreshAllPanel();&#39;&gt;enable ext. questinfo&lt;/a&gt;
&lt;%}%&gt;
&lt;label for=&quot;addXP&quot;&gt;addXP:&lt;input type=&quot;text&quot; id=&quot;addXP&quot; name=&quot;addXP&quot;&gt;&lt;/label&gt;&lt;a0  onclick=&#39;window.gm.player.addXP(parseInt(document.getElementById(&quot;addXP&quot;).value));window.gm.refreshAllPanel();&#39;&gt;GO&lt;/a&gt;&lt;/br&gt;
&lt;a0  onclick=&#39;window.gm.player.Stats.increment(&quot;health&quot;,25);window.gm.refreshAllPanel();&#39;&gt;Health +25&lt;/a&gt;&lt;/br&gt;
&lt;a0  onclick=&#39;window.gm.player.Stats.increment(&quot;energy&quot;,25);window.gm.refreshAllPanel();&#39;&gt;Energy +25&lt;/a&gt;&lt;/br&gt;
&lt;a0  onclick=&#39;window.gm.player.Stats.increment(&quot;corruption&quot;,25);window.gm.refreshAllPanel();&#39;&gt;corruption +25&lt;/a&gt;
&lt;a0  onclick=&#39;window.gm.player.Stats.increment(&quot;corruption&quot;,-25);window.gm.refreshAllPanel();&#39;&gt;corruption -25&lt;/a&gt;&lt;/br&gt;
&lt;a0  onclick=&#39;window.gm.player.Stats.increment(&quot;arousal&quot;,25);window.gm.refreshAllPanel();&#39;&gt;Arousal +25&lt;/a&gt;
&lt;a0  onclick=&#39;window.gm.player.Stats.increment(&quot;arousal&quot;,-25);window.gm.refreshAllPanel();&#39;&gt;Arousal -25&lt;/a&gt;&lt;/br&gt;
Crash if you enter wrong things below !&lt;/br&gt;
&lt;label for=&quot;passage&quot;&gt;passage:&lt;input type=&quot;text&quot; id=&quot;passage&quot; name=&quot;passage&quot;&gt;&lt;/label&gt;&lt;a0  onclick=&#39;window.story.show(document.getElementById(&quot;passage&quot;).value)&#39;&gt;Go&lt;/a&gt;&lt;/br&gt;
&lt;label for=&quot;additem&quot;&gt;add item:&lt;input type=&quot;text&quot; id=&quot;additem&quot; name=&quot;additem&quot;&gt;&lt;/label&gt;&lt;a0  onclick=&#39;window.gm.player.Inv.addItem(window.gm.ItemsLib[document.getElementById(&quot;additem&quot;).value]())&#39;&gt;Go&lt;/a&gt;&lt;/br&gt;
(only non-wardrobe-items and weapons!)&lt;/br&gt;
&lt;label for=&quot;addoutfit&quot;&gt;add wardrobe:&lt;input type=&quot;text&quot; id=&quot;addoutfit&quot; name=&quot;addoutfit&quot;&gt;&lt;/label&gt;&lt;a0  onclick=&#39;window.gm.player.Wardrobe.addItem(window.gm.ItemsLib[document.getElementById(&quot;addoutfit&quot;).value]())&#39;&gt;Go&lt;/a&gt;&lt;/br&gt;
(only wardrobe-items except weapons! You need to equip them in wardrobe.)&lt;/br&gt;
&lt;label for=&quot;startfight&quot;&gt;start fight:&lt;input type=&quot;text&quot; id=&quot;startfight&quot; name=&quot;startfight&quot;&gt;&lt;/label&gt;&lt;label for=&quot;startfight2&quot;&gt;params:&lt;input type=&quot;text&quot; id=&quot;startfight2&quot; name=&quot;startfight2&quot;&gt;&lt;/label&gt;
&lt;a0  onclick=&#39;startfight()&#39;&gt;Go&lt;/a&gt;&lt;/br&gt;
(use Encounter-name, might sent you to certain events on defeat/victory. Might need extra params like {&quot;amount&quot;:1} )&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt; function unhideStats(){
    var ids = window.gm.player.Stats.getAllIds();
    for(var i=0; ids.length&gt;i;i++){
        window.gm.player.Stats.modifyHidden(ids[i],0);
    }
}
function startfight(){
  var _p=document.getElementById(&quot;startfight2&quot;).value||&quot;{}&quot;;
  window.gm.getSaveVersion();
  _p=_p.replace(/“/g,&#39;&quot;&#39;).replace(/”/g,&#39;&quot;&#39;);
  _p=JSON.parse(_p);
  window.gm.encounters[document.getElementById(&quot;startfight&quot;).value](_p);
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="82" name="DebugTransform" tags="_back_ _noshortkey_" position="225,1100" size="100,100">&lt;section&gt; &lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;/br&gt;[[Back|_back_]]&lt;/br&gt;
Test transformation events. Because they are deffered-events you need to return to story and move between rooms.&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.MutationsLib.growBreast(window.gm.player)&#39;&gt;Breast grow&lt;/a&gt;&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.MutationsLib.growVulva(window.gm.player)&#39;&gt;Vagina grow&lt;/a&gt;&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.MutationsLib.swapGender(window.gm.player,window.storage.constructors[&quot;VulvaHuman&quot;])&#39;&gt;to female&lt;/a&gt;&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.MutationsLib.swapGender(window.gm.player,window.storage.constructors[&quot;PenisHuman&quot;])&#39;&gt;to male&lt;/a&gt;&lt;/br&gt;
&lt;hr&gt;Anthros:&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.MutationsLib.mutateCat(window.gm.player)&#39;&gt;Cat&lt;/a&gt;
&lt;a0 onclick=&#39;window.gm.MutationsLib.mutateWolf(window.gm.player)&#39;&gt;Wolf&lt;/a&gt;&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.MutationsLib.mutateHorse(window.gm.player)&#39;&gt;Horse&lt;/a&gt;&lt;/br&gt;
&lt;hr&gt;Ferals:&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="83" name="DebugImages" tags="_back_ _noshortkey_" position="350,1100" size="100,100">&lt;section&gt; &lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;/br&gt;[[Back|_back_]]&lt;/br&gt;&lt;div id=&#39;canvas&#39;&gt;&lt;/div&gt;&lt;/br&gt;&lt;div id=&#39;choice&#39;&gt;&lt;/div&gt;&lt;/br&gt;
Test svg inlined in code.&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;window.gm.listImages();&lt;/script&gt;</tw-passagedata><tw-passagedata pid="84" name="DebugImages2" tags="_back_ _noshortkey_" position="475,1100" size="100,100">&lt;section&gt; &lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;/br&gt;[[Back|_back_]]&lt;/br&gt;&lt;div id=&#39;canvas&#39;&gt;&lt;/div&gt;&lt;/br&gt;&lt;div id=&#39;choice&#39;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;%=window.gm.images.daynight()%&gt;&lt;/p&gt;
&lt;div&gt;600 = 6:00 &lt;input id=&quot;progress-value&quot; type=&quot;number&quot; placeholder=&quot;Enter value&quot; min=&quot;0&quot; max=&quot;2400&quot; value=&quot;1200&quot; /&gt;
	&lt;input type=&quot;button&quot; value=&quot;Change&quot; onclick=&quot;change()&quot;/&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
var oldTime = 1200;
function change(){
  var menu = document.getElementById(&quot;progress-value&quot;);
  var n = SVG(&quot;#wheel&quot;)//document.querySelector(&quot;#wheel&quot;)
  var y,y2,x=n.node.ownerSVGElement.viewBox.baseVal.x+n.node.ownerSVGElement.viewBox.baseVal.width/2;//n.ownerSVGElement.width.baseVal.value/2;
  y=(oldTime-1200)*360/2400;y2=(menu.value-oldTime)*360/2400;
  if((menu.value-oldTime)&lt;0){n.rotate(-360,x,x),y2+=360};
  n.animate().rotate(y2,x,x);//use SVG.js
  oldTime=menu.value;
  //n.setAttribute(&#39;transform&#39;, &quot;rotate(&quot;+y+&quot;,&quot;+x+&quot;,&quot;+x+&quot;)&quot;);
  /*n.animate([{
				transform: &quot;rotate(&quot;+y+&quot;,&quot;+x+&quot;,&quot;+x+&quot;)&quot;
      }, {
				transform: &quot;rotate(&quot;+y2+&quot;,&quot;+x+&quot;,&quot;+x+&quot;)&quot;
      }
      ], {
			duration: 2000,
			iterations: 1,
			fill: &#39;forwards&#39;
		});*/
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="85" name="Styletest" tags="_back_" position="600,1100" size="100,100">&lt;section&gt; &lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;div&gt;&lt;/br&gt;[[Back|_back_]]
Theme:
&lt;a href=&quot;javascript:window.styleSwitcher.setStyle(&#39;default&#39;);window.gm.refreshAllPanel();&quot;&gt;default&lt;/a&gt;
&lt;a href=&quot;javascript:window.styleSwitcher.setStyle(&#39;dark&#39;);window.gm.refreshAllPanel();&quot;&gt;dark&lt;/a&gt;&lt;/br&gt;&lt;/div&gt;
&lt;/br&gt;&lt;hr&gt;
&lt;div class=&quot;speech tNPC2&quot;&gt;&lt;span class=&quot;avatar&quot;&gt;&lt;/span&gt;NPCx&lt;hr&gt;&lt;br&gt;&quot;There you are&quot;&lt;/div&gt;
&lt;p class=&#39;tPC&#39;&gt;PC-talk&lt;/p&gt;&lt;p class=&#39;tNPC1&#39;&gt;NPC1-talk&lt;/p&gt;&lt;p class=&#39;tNPC2&#39;&gt;NPC2-talk&lt;/p&gt;&lt;p class=&#39;tNPC3&#39;&gt;NPC3-talk&lt;/p&gt;&lt;p class=&#39;tNPC4&#39;&gt;NPC4-talk&lt;/p&gt;
&lt;p class=&#39;dev&#39;&gt;notes from developer.&lt;%=window.gm.images.ic_heart()%&gt;&lt;/p&gt;
&lt;p class=&#39;author&#39;&gt;notes from author.&lt;/p&gt;
&lt;form&gt;&lt;ul style=&quot;list-style-type: none; padding-inline-start: 0px;&quot; &gt;&lt;legend&gt;List&lt;/legend&gt;
&lt;button type=&quot;button&quot; id=&quot;button1&quot;&gt;Button1&lt;/button&gt;
&lt;div class=&quot;meter&quot;&gt;&lt;div class=&quot;bar&quot; style=&quot;width:23%&quot;&gt;&lt;/div&gt;&lt;div style=&quot;position:absolute; top:0; left:0; width:100%&quot;&gt;5/45&lt;/div&gt;&lt;/div&gt;
&lt;li style=&quot;padding-bottom: 0.5em;&quot;&gt;&lt;input type=&quot;checkbox&quot; name=&quot;y&quot; value=&quot;x&quot; readonly disabled&gt;&lt;label&gt;chekbox disabled&lt;/label&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/form&gt;&lt;/br&gt;
&lt;statup&gt;Statup&lt;/statup&gt;  &lt;statdown&gt;Statdown&lt;/statdown&gt; &lt;span class=&#39;red&#39;&gt;RED&lt;/span&gt;&lt;span class=&#39;green&#39;&gt;GREEN&lt;/span&gt;
&lt;p class=&#39;div_alarm&#39;&gt;ALARM&lt;/p&gt;
&lt;hr&gt;
&lt;div id=&#39;bartest&#39; class=&quot;progressbar&quot;&gt;&lt;div style=&quot;width: 100%;&quot;&gt;&lt;b&gt;&lt;p&gt;100%&lt;/p&gt;&lt;/b&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div&gt;&lt;input id=&quot;progress-value&quot; type=&quot;number&quot; placeholder=&quot;Enter desired percentage&quot; min=&quot;0&quot; max=&quot;100&quot; value=&quot;7&quot; /&gt;
	&lt;input type=&quot;button&quot; value=&quot;Change&quot; onclick=&quot;change()&quot;/&gt;&lt;/div&gt;
&lt;hr&gt;
&lt;p&gt;This &lt;a0 onclick=&#39;window.gm.util.swapText(this,[ [&quot;red Color&quot;,&quot;1&quot;,&quot;red&quot;],[&quot;green color&quot;,&quot;2&quot;,&quot;green&quot;] ]);alert(this.getAttribute(&quot;data-value&quot;))&#39; data-value=&quot;0&quot;&gt;blue&lt;/a&gt; link can be toggled onclick.&lt;/p&gt;
&lt;p&gt;This is a&lt;a0 class=&quot;nolink&quot; data-nokey=&quot;true&quot; onclick=&#39;window.gm.util.swapText(this,[ [&quot;red Color&quot;,&quot;1&quot;,&quot;red&quot;],[&quot;green color&quot;,&quot;2&quot;,&quot;green&quot;] ]);&#39; data-value=&quot;0&quot;&gt;secret&lt;/a&gt; link that can be toggled onclick.&lt;/p&gt;
&lt;label&gt;[hint]&lt;input type=&quot;checkbox&quot;  style=&quot;display: none;&quot; &gt;
  &lt;span role=&#39;tooltip&#39;&gt;hkljj  fdggfdsf gf   dfsd afsdafgdae sgfegf&lt;/span&gt;
&lt;/label&gt;       &lt;label&gt; &lt;input type=&quot;checkbox&quot; &gt;
  &lt;span role=&#39;tooltip&#39;&gt;hkljj  fdggfdsf gf   dfsd afsdafgdae sgfegf&lt;/span&gt;
&lt;/label&gt;
&lt;div class=&quot;popup&quot;&gt;[hover here]
  &lt;span class=&quot;popuptext&quot; id=&quot;myPopup2&quot;&gt;A Simple window.gm.printPickupAndClear(&#39;Crowbar&#39;,&#39;A crowbar is lying other there.&#39;&lt;/span&gt;
&lt;/div&gt;
&lt;div class=&quot;popup&quot;&gt;[hover here]
  &lt;span class=&quot;popuptext&quot; id=&quot;myPopup2&quot;&gt;A Simple window.gm.printPickupAndClear(&#39;Crowbar&#39;,&#39;A crowbar is lying other there.&#39;&lt;/span&gt;
&lt;/div&gt;
&lt;label&gt; &lt;input type=&quot;checkbox&quot; &gt;
  &lt;span role=&#39;tooltip&#39;&gt;hkljj  fdggfdsf gf   dfsd afsdafgdae sgfegf&lt;/span&gt;
&lt;/label&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
function change(){
    var selectedValue = document.querySelector(&quot;#progress-value&quot;).value;
    document.querySelector(&quot;#bartest &gt; div&quot;).textContent = selectedValue + &quot;%&quot;;
    document.querySelector(&quot;#bartest &gt; div&quot;).style.width = selectedValue + &quot;%&quot;;
  }
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="86" name="NOP" tags="_back_" position="725,1100" size="100,100">&lt;section&gt; &lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;p class=&#39;author&#39;&gt;Sorry, this location is curently not implemented.&lt;/p&gt; &lt;!--todo  implement passages pointing to this--&gt;
&lt;div&gt; &lt;/br&gt;
[[Back|_back_]]&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
window.gm.achievements.looseEnd=&#39;You found a dead end somewhere in &#39;+window.gm.location;
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="87" name="Deffered1" tags="" position="850,1100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
Deffered1
[[Home]]
&lt;a0 onclick= window.story.show(&quot;&quot;)&gt;Next&lt;/a&gt;&lt;/br&gt;&lt;/br&gt;
&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="88" name="Deffered2" tags="" position="975,1100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
Deffered2
[[Home]]
&lt;a0 onclick=&#39;window.gm.pushDeferredEvent(&quot;Deffered3&quot;,[13],true)&#39;&gt;Deffered3&lt;/a&gt;&lt;/br&gt;
&lt;a0 onclick= window.story.show(&quot;&quot;)&gt;go on&lt;/a&gt;&lt;/br&gt;&lt;/br&gt;
&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="89" name="Deffered3" tags="" position="1100,1100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
Deffered3
[[Home]]
&lt;a0 onclick=&#39;window.gm.pushDeferredEvent(&quot;Deffered3&quot;,[13])&#39;&gt;Deffered1&lt;/a&gt;&lt;/br&gt;
&lt;a0 onclick= window.story.show(&quot;&quot;)&gt;go on&lt;/a&gt;&lt;/br&gt;&lt;/br&gt;
&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="90" name="ForestAlchemistTalk" tags="_nosave_" position="1225,1100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;% if(!window.gm.quests.hasActiveQuest(&quot;qPurpleBerry&quot;) || window.gm.quests.getMilestoneState(&quot;qPurpleBerry&quot;).id&lt;1){ %&gt;
    &lt;%=window.story.render(&quot;AlchTalkStartPurpleBerry&quot;); %&gt;
&lt;% } else if(window.gm.quests.getMilestoneState(&quot;qPurpleBerry&quot;).id===1 &amp;&amp; window.gm.player.Inv.countItem(&quot;PurpleBerry&quot;)&gt;=5){ %&gt;
    &lt;%=window.story.render(&quot;AlchTalkFinishPurpleBerry&quot;); %&gt;
&lt;% } else if(window.gm.quests.getMilestoneState(&quot;qBondageKink&quot;).id===300){%&gt;
    &lt;%=window.story.render(&quot;AlchTalkFinishPurpleBerry&quot;); %&gt;
&lt;% } else if(window.gm.quests.getMilestoneState(&quot;qCarlia&quot;).id===700){%&gt;
    &lt;%=window.story.render(&quot;AlchTalkShelterCarlia&quot;); %&gt;
&lt;%} else {%&gt; He seems busy right now. [[Back|ForestAlchemistHut]] &lt;%}%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="91" name="AlchTalkShelterCarlia" tags="" position="100,1225" size="100,100">todo  Convince Alchemist to take Carlia in.
&lt;p class=&quot;tPC&quot;&gt;&quot;I&#39;m pretty sure she can help you around; fetching ingredients from the forest, keeping you company...&quot;&lt;/p&gt;
&quot;Well yes.&quot; the alchemist scratches his chin in thought &quot;Sometimes it gets really lonely here and if someone others collects the ingredients, I can spent more time with potion-making..&quot;&lt;/br&gt;
&quot;Just bring her here and we will see if we can workout something.&quot;&lt;/br&gt;
&lt;&lt;p class=&quot;tPC&quot;&gt;&#39;That went smoother then I thought.&#39;&lt;/p&gt;&gt;
&lt;a0 onclick=&#39;window.gm.quests.forceQuestMilestone(&quot;qCarlia&quot;,800,700);window.story.show(&quot;ForestAlchemistHut&quot;);&#39;&gt;Leave&lt;/a&gt;&lt;/br&gt;</tw-passagedata><tw-passagedata pid="92" name="AlchTalkBridgeThugs" tags="" position="225,1225" size="100,100">As you stumble into the hut, the alchemists greets you: &quot;Ah, nice to see you again. You fine so far?&quot;
&lt;p class=&quot;tPC&quot;&gt;&quot;Nope. There are some thugs at the bridge, they dont let me pass.&quot;&lt;/p&gt;
&quot;Thugs? Did they rob you?&quot;
&lt;p class=&quot;tPC&quot;&gt;&quot;I got away before they got that idea. Is there an alternative to get over the canyon.&quot;&lt;/p&gt;
He shakes his head &quot;Not that I know. Cant you sneak around them or trick them somehow to let you pass?&quot;
&lt;p class=&quot;tPC&quot;&gt;&quot;Well, thats what I wanted to ask you. You dont have an elixier or something that makes me hardier and stronger?&quot;&lt;/p&gt; 
&quot;Huff, no. I&#39;m still out of stock. I can give you those berry-potions if you bring me enough berries. It wouldnt take much to improve it though...&quot;
&quot;If you can get me 4 purple berries, 2 apoca flowers and 2 leeches I can mix up some potion to boost your strength.&quot;
&lt;p class=&quot;tPC&quot;&gt;&quot;Thats exactly what I need ! But where can I find them?&quot;&lt;/p&gt;
&quot;The flowers grow in the forest too. They have colorful blue and yellow blossoms. But those leeches...they lurk in dark,humid places, swamps and such.&quot;
&lt;p class=&quot;tPC&quot;&gt;&quot;I will see to get some.&quot;&lt;/p&gt;
&lt;a0 onclick=&#39;window.gm.quests.forceQuestMilestone(&quot;qPurpleBerry&quot;,200,100);window.story.show(&quot;ForestBorder&quot;);&#39;&gt;Leave&lt;/a&gt;&lt;/br&gt;</tw-passagedata><tw-passagedata pid="93" name="AlchTalkFinishPurpleBerry" tags="" position="350,1225" size="100,100">&lt;div id=&#39;select1&#39; &gt; You got enough purple berries to trade in for the alchemist. Will you do so?
&lt;a0 onclick=&#39;window.gm.player.Inv.removeItem(&quot;PurpleBerry&quot;,5);window.gm.player.Inv.addItem(new window.gm.ItemsLib[&quot;HealthPotionSmall&quot;](),2);window.gm.quests.forceQuestMilestone(&quot;qPurpleBerry&quot;,100,1);window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;);&#39;&gt;Yes&lt;/a&gt;
&lt;a0 onclick=&#39;window.story.show(&quot;ForestBorder&quot;);&#39;&gt;Leave&lt;/a&gt;
&lt;/div&gt;
&lt;div id=&#39;choice1a&#39; hidden&gt;
&lt;p class=&#39;tPC&#39;&gt;&quot;I&#39;ve got those berries for you.&quot;&lt;/p&gt; You place them on the desk and wait for the approval of the alchemist.&lt;/br&gt;
&quot;Very good. Like I said I will give you 2 potions for those.&quot;
&lt;a0 onclick=&#39;window.gm.refreshAllPanel();&#39;&gt;Next&lt;/a&gt;
&lt;/div&gt;&lt;div id=&#39;choice1b&#39; hidden&gt;&lt;/div&gt;
&lt;% } else if(window.gm.quests.getMilestoneState(&quot;qBondageKink&quot;).id===100){%&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;Hello. sorry to bother you again but can you take a look at this.&quot;&lt;/p&gt;
You tilt your head to a side and point at the choker.&lt;/br&gt;
&quot;Fancy. You are in this sort of thing?&quot;&lt;/br&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;What? No! This somehow attached itself on me. I want to get it off!&lt;/p&gt;
&quot;Let me see. Hm.. I&#39;m not sure if this here is a locking mechanic.. I think I cant help you with that one. A locksmith might be the right person to ask.&quot;
&lt;p class=&quot;tPC&quot;&gt;&quot;And do you know where to find one?&quot;&lt;/p&gt;
&quot;There is a town east of here, called Elderant. You might be able to find someone that can unlock this thing there.&quot;
&lt;p class=&quot;tPC&quot;&gt;&quot;There is a town nearby?&quot;&lt;/p&gt;
&quot;Nearby is relative. Its about a 3 or 4 days walk I guess. As I think over it, maybe you shouldnt go. It can be dangerous traveling alone.&quot;
&lt;p class=&quot;tPC&quot;&gt;&quot;More dangerous than the forest? I died on the first visit of this damn forest ... by an stupid accident !&quot;&lt;/p&gt;
&quot;The forest isnt dangerous. I never had any issues. Maybe you just had a little bad luck.&quot;
An idea forms in your mind: &lt;span class=&quot;tPC&quot;&gt;&#39;when I die, I lose the equipment&#39;&lt;/span&gt;&lt;/br&gt;
Of ourse dying would be bad if it causes a large loss. But right now you just have little to no gear and will be replenished with a new set.
You smirk to yourself for your ingenuity.&lt;/br&gt; 
&lt;p class=&quot;tPC&quot;&gt;&#39;So if I dont have any other option, I still just need to find a way to die to get rid of that thing.&#39;&lt;/p&gt;
&lt;a0 onclick=&#39;window.gm.quests.forceQuestMilestone(&quot;qBondageKink&quot;,200,100);window.story.show(&quot;ForestAlchemistHut&quot;);&#39;&gt;Death is a solution&lt;/a&gt;
&lt;a0 onclick=&#39;window.gm.quests.forceQuestMilestone(&quot;qBondageKink&quot;,200,100);window.story.show(&quot;ForestAlchemistHut&quot;);&#39;&gt;Its not worth dieing to get rid of it&lt;/a&gt;
&lt;a0 onclick=&#39;window.gm.quests.forceQuestMilestone(&quot;qBondageKink&quot;,200,100);window.story.show(&quot;ForestAlchemistHut&quot;);&#39;&gt;Strangely, it doesnt bother me that much anymore&lt;/a&gt;&lt;!--todo increase submissive--&gt;</tw-passagedata><tw-passagedata pid="94" name="AlchTalkStartPurpleBerry" tags="" position="475,1225" size="100,100">&lt;p class=&#39;tPC&#39;&gt;&quot;Hello? Anyone there?&quot;&lt;/p&gt;
A man appears from a door at the side of the room. Worn old clothing adorns his skinny frame. 
&lt;p class=&#39;tPC&#39;&gt;&quot;I would like to ask if you have a quest for me.&quot;&lt;/p&gt;
&quot;A quest? Thats an odd question. Do you mean a job?&quot;
&lt;p class=&#39;tPC&#39;&gt;&quot;Not a job. Something that is really important to you but you cant do it yourself.&quot;&lt;/p&gt;
Ah, you mean cake. I like cake but I cant bake a deent one myself.
&lt;p class=&#39;tPC&#39;&gt;&quot;What?! No I mean something that is a matter of life.&quot;&lt;/p&gt;
&quot;Cake is important for my life. Its a tasty treat that sweetens my existance.&quot;
&lt;p class=&#39;tPC&#39;&gt;&quot;No listen. Do you need help with some task? I could help you and you give me something. Except for baking a cake.&quot;
&quot;I should give you something? What could I give you? A potion maybe. I dont have much else I could give away.&quot;
&lt;p class=&#39;tPC&#39;&gt;&quot;What potions do you create.&quot;&lt;/p&gt;
&quot;Oh hoho now we are talking my language. I could make a lot of useful potions. Unfortunatly my alembic is broken so I can only do the basic stuff.
Now that I think about it, we could make a trade: you get me some purple berrys, and you get some berry juice I create from it.&quot;
&lt;p class=&#39;tPC&#39;&gt;&quot;I could crush them myself and have all of the juice for myself!&quot;&lt;/p&gt;
&quot;Uhm.. but you cant do it like I do .. I have special equipment for that. It empowers the natural healing benefit.&quot;
&lt;p class=&#39;tPC&#39;&gt;&quot;So that juice is some kind of health potion?&quot;&lt;/p&gt;
&quot;For sure it is. Therefore I say: bring me 5 handful of berries and you get to 2 bottles of potion.&quot;
&lt;p class=&#39;tPC&#39;&gt;&quot;Sigh. Whatever. Seems to be the only possible quest I an get right now.&quot;&lt;/p&gt;
&quot;Are they with caramel? I like caramel. And choclat.&quot;
&lt;p class=&#39;tPC&#39;&gt;&quot;Please? What do you talk about?&quot;&lt;/p&gt;
&quot;About the cakes. What kind of cake are we speaking about.&quot;
&lt;p class=&#39;tPC&#39;&gt;&quot;I will get you your berries now.&quot;&lt;/p&gt;
&lt;a0 onclick=&#39;window.gm.quests.addQuest(&quot;qPurpleBerry&quot;,1);window.story.show(&quot;ForestBorder&quot;);&#39;&gt;Leave&lt;/a&gt;</tw-passagedata><tw-passagedata pid="95" name="TFCanineCock" tags="" position="600,1225" size="100,100">getCockType &amp; Rating
if Type!=this decrease rating
else increase rating
if rating drops below 0 ??  &quot;Something in your nethers is changing, you can feel it. Your once average sized human dong has changed its shape. At least that what you think.&quot;
if rating increases just above 0 &quot;You &quot;</tw-passagedata><tw-passagedata pid="96" name="GenericDeffered" tags="_isdeffered_" position="725,1225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;div id=&#39;output&#39;&gt;&lt;%=window.story.state.tmp.args[0]%&gt;&lt;/div&gt;&lt;/br&gt;   &lt;!--message is rendered here--&gt;
&lt;a0 onclick= &#39;window.story.show(&quot;&quot;)&#39;&gt;Next&lt;/a&gt;&lt;/br&gt;
&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="97" name="CatHabit" tags="_isdeffered_" position="850,1225" size="100,100">&lt;section&gt; &lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
You feel the urge to sit down and give yourself a good licking...&lt;/br&gt;
&lt;a0 onclick= window.story.show(&quot;&quot;)&gt;Next&lt;/a&gt;&lt;/br&gt;
&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="98" name="MutateBreastEnd" tags="_isdeffered_" position="975,1225" size="100,100">&lt;section&gt; &lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
Somehow you know your breast stopped changing ...&lt;/br&gt;
&lt;a0 onclick=&#39;window.story.state.msg=&quot;&quot;;window.story.show(&quot;&quot;)&#39;&gt;Next&lt;/a&gt;&lt;/br&gt;
&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="99" name="MutateVulvaEnd" tags="_isdeffered_" position="1100,1225" size="100,100">&lt;section&gt; &lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
Your cunt didnt change since some time now. At least you cant see any... &lt;/br&gt;
&lt;a0 onclick= window.story.show(&quot;&quot;)&gt;Next&lt;/a&gt;&lt;/br&gt;
&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="100" name="Cyril" tags="" position="1225,1225" size="100,100">Was nützt es den Geist zu stärken wenn der Körper nicht mithalten kann. Your body has to embrace your savageness too.

Giving and receiving the essence of life is a sacred action. And as it is with all sacred things, there are always some trying to corrupt them.

You need to open up your mind. Mankind futily struggled to separate themself from nature and other beeings. Still, man are animals and trying to deny this does them no good.

Savageness is what separates us from non-living objects. Without savageness we would lie still like a rock or fall down to earth, blown around by gusts of wind. Savageness lets a deer rush across the plains or a bird fly between clouds. Honor your savageness as this is life.

Cultivating ones savageness is what we try to assume here. you need to grow it, carefully, to not get overwhelmed and loosing yourself

So you think animals are less worth than humans? he sounds annoyed. No, no of course not. I wouldnt say they are equal to humans. 
Lets see if you think so after walking in their shoes for a mile.</tw-passagedata><tw-passagedata pid="101" name="Claudio" tags="" position="100,1350" size="100,100">You don&#39;t know exactly how he feels about you. On the one hand, he does not understand that you will have a chance to experience the test of the acolyte. On the other hand, he doesn&#39;t want you to die. 
Maybe he warms up to you over time.</tw-passagedata><tw-passagedata pid="102" name="Kumala" tags="" position="225,1350" size="100,100"></tw-passagedata><tw-passagedata pid="103" name="MinoRant" tags="_nosave_" position="350,1350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
You hear the angry huff of the mino.
&lt;/br&gt;&lt;p&gt;&lt;a0 onclick=&#39;window.gm.dng.resumeRoom()&#39;&gt;Next&lt;/a&gt;&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="104" name="MinoMeet" tags="_nosave_" position="475,1350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
Mino found you.
&lt;/br&gt;&lt;p&gt;&lt;a0 onclick=&#39;window.gm.dng.resumeRoom()&#39;&gt;Next&lt;/a&gt;&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="105" name="Masturbate" tags="_nosave_" position="600,1350" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;div id=&#39;select1&#39; &gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;)&#39;&gt;Pinch your own nipples.&lt;/a&gt;&lt;/br&gt;
&lt;/div&gt;
&lt;div id=&#39;choice1a&#39; hidden&gt;&lt;/br&gt;
Tweasing your [small] nipples between thumb and index finger until it nearly gets painful.&lt;/br&gt;
&lt;div id=&#39;select2&#39; &gt;
&lt;a0 id=&#39;tweazeNipple&#39; onclick=&#39;window.gm.printTalkLink(&quot;div#select2&quot;,&quot;div#choice2a&quot;, fondlebreast)&#39;&gt;Just some more&lt;/a&gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select2&quot;,&quot;div#choice2b&quot;)&#39;&gt;Stop it&lt;/a&gt;
&lt;/div&gt;
&lt;div id=&#39;choice2a&#39; hidden&gt;&lt;/br&gt;
Now you increase the pressure until there is pain.
&#39;I think thats enough right now.&#39; [[Next|&lt;%=window.gm.player.location%&gt;]]&lt;/br&gt; 
&lt;/div&gt;
&lt;div id=&#39;choice2b&#39; hidden&gt;&lt;/br&gt;
Releasing the pressure on your nubs, they just feel numb right now.
&#39;I think thats enough right now.&#39; [[Next|&lt;%=window.gm.player.location%&gt;]]&lt;/br&gt; 
&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
function fondlebreast(elmnt){
    elmnt.replaceWith(&quot;You nipple stiffens under this attention.&quot;);
    window.gm.player.addEffect(new window.storage.constructors[&#39;effGrowBreast&#39;](),&quot;effGrowBreast&quot;);
    window.gm.quests.forceQuestMilestone(&quot;qMyPleasure&quot;,100,1);
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="106" name="WolfSubmit" tags="" position="725,1350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
The wolf raises a hind leg and gives your prone form a good amount of watering.
After a final sniff it runs of into the woods.
&lt;div&gt;&lt;/br&gt;&lt;a0 onclick=&#39;window.gm.player.addEffect(new window.storage.constructors[&quot;effMutateWolf&quot;](),&quot;effMutateWolf&quot;);window.gm.postDefeat()&#39;);&#39;&gt;Black out&lt;/a&gt;&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="107" name="WolfSubmitLewd" tags="" position="850,1350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
The wolf isn&#39;t aroused enough and leaves you alone.
---
The wolf is quite in the mood to fool around.
---
Stiffleged the wolf is strutting over to you. From your point of view you can easily see a red tip poking out of the sheath below his belly.
You get on all 4 to crawl away, but he quickly jumps on your lower back, pushing you further down with his mass.
---
As soon as you can feel his tip hitting your backdoor you pass out.
[[Pass out]]  
---
That bitch seems to be aggresive and submissive at the same time. Does she expect you to take care of her needs?
[[Lick her]] [[Get behind her]]
---
Again she growls baring her teeth as you get behind her. But she also raises her tail giving you a good view of her sex. The black lips of her pussy already swelling in that canine like manner.
[[Enter her]]
--- 
That hot pussy of her is squeezing down on you. 
You cant hold any longer and shoot your jizzm inside her.
---
&lt;div&gt;&lt;/br&gt;&lt;a0 onclick=&#39;window.gm.respawn();&#39;&gt;Black out&lt;/a&gt;&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="108" name="GenericPassage" tags="_nosave_" position="975,1350" size="100,100">&lt;!--call this passage after setting tmp.args !--&gt;
&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;div id=&#39;panel&#39;&gt;&lt;/div&gt;&lt;!--description is rendered here--&gt;
&lt;div id=&#39;choice&#39;&gt;&lt;/div&gt; &lt;!--choice is rendered here--&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;window.story.state.tmp.args[0]();&lt;/script&gt;</tw-passagedata><tw-passagedata pid="109" name="PostCombatPassage" tags="_nosave_" position="1100,1350" size="100,100">&lt;!--call this passage after setting tmp.args !--&gt;
&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;div id=&#39;panel&#39;&gt;&lt;/div&gt;&lt;!--description is rendered here--&gt;
&lt;div id=&#39;choice&#39;&gt;&lt;/div&gt; &lt;!--choice is rendered here--&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;window.story.state.tmp.args[0]();&lt;/script&gt;</tw-passagedata><tw-passagedata pid="110" name="WolffightIntermezzo" tags="_nosave_" position="1225,1350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
Wolf snarls at you.
&lt;div&gt; [[Next|EncounterStartTurn]]&lt;/br&gt;&lt;/div&gt; 
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;div&gt;&lt;/br&gt;
[[Next|&lt;%=window.gm.player.location%&gt;]]&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="111" name="Arousalchange" tags="" position="100,1475" size="100,100">&lt;!--deffered event--&gt;
You are so horny ! If you ran into a virile stud right now, you wouldnt be able to resist his advances.</tw-passagedata><tw-passagedata pid="112" name="SoulCrystalGrowth" tags="" position="225,1475" size="100,100">&lt;!--deffered event--&gt;
As you get comfortable to rest for a while, you get some warm, blissful feeling from your stomach.
...
Something is growing in you.
...
You guess a soul crystal absorbs fertile sperm slushing around in your uterus, converting it to arcane essence.
...
For sure that hungry soul crystal is busy absorbing seed and your own life preserving fluids to grow its power. Its essence concetration, you guess, is tiny/small/medium/large/massive/grand.
...
You gain the impression that the soul crystal has reached the maximum size that your body is able to sustain. Time to get it out form the oven.</tw-passagedata><tw-passagedata pid="113" name="SoulcrystalKnowledge" tags="" position="350,1475" size="100,100">&quot;Soul crystals are arcane essence contained in a crystalin sphere. They are commonly used as a source of power for crafts of the arcana.&quot;
&quot;Soul crystal, also called soul gems by some, can be sometimes found at locations with a strong etheral crossroads.&quot;
&quot;It was stated that soul gems can also form in-uteri of special aligned individuals. The process of forming the crystal seems to be bound to sexual interaction. Various studies have led to the view that the crystal feds on the live-force of the received sperm and also the hosts ovary.
&quot;A developing soul gem interferes and supresses normal pregnancys. There are different cases known where host used this effect as alternative to other birth control measures.&quot; 
Several religious directions state that this is against natures law and has to be prohibited. However, the high demand for crystals encourages unofficial experimentation.&quot;</tw-passagedata><tw-passagedata pid="114" name="BlockPuzzleTest" tags="" position="475,1475" size="100,100">&lt;div style=&quot;background-color:lightgray;&quot;&gt;
&lt;p&gt;Click here to restart &lt;a0 id=&#39;btStart&#39;&gt;Start&lt;/a&gt;&lt;/p&gt;&lt;p&gt;Press &#39;R&#39; while dragging a part with a circle to rotate them.&lt;/p&gt;
&lt;a0 id=&#39;howtoplay&#39; onclick=&#39;(function($event){document.querySelector(&quot;#&quot;+id+&quot;~p&quot;).toggleAttribute(&quot;hidden&quot;);})(this);&#39;&gt;How to play&lt;/a&gt;
&lt;p hidden&gt;You have to cover all gray rectangles with dashed border with the other colored pieces. DragNDrop the pieces with left click. Parts with a circle in it can be rotated while dragging by pressing &#39;R&#39;.&lt;/p&gt;
&lt;p id=&#39;result&#39;&gt;&lt;/p&gt;
&lt;canvas id=&quot;canvas&quot; tabindex=&quot;3&quot; width=&quot;400&quot; height=&quot;400&quot; style=&quot;background-color: #ddd;border:1px solid black;&quot;&gt;&lt;/canvas&gt;&lt;/div&gt;
&lt;script&gt;
const grid=40;
var _game = window.gm.startBlockPuzzle();
document.getElementById(&#39;btStart&#39;).addEventListener(&quot;click&quot;, function(){_game.start(1);});
//document.getElementById(&#39;clickHere&#39;).addEventListener(&quot;click&quot;, _game.click);
_game.setup=function(level){
  if(level===2){
   return({goals:[ _game.createGoal(3,3 ,grid,[ [0,0],[0,1],[1,0],[1,1] ]),
             _game.createGoal(3 ,6 ,grid,[ [1,2],[2,2],[2,3] ])],
    pieces:[ _game.createPiece(2 , 0 , grid, [ [0,0],[-1,0],[0,1] ],{ fill:&#39;#f08080&#39;}),
             _game.createPiece(4 , 1 , grid, [ [0,0],[0,1],[1,0],[1,1] ]),
             _game.createPiece(2 , 4 , grid, [ [0,0],[-1,0],[0,1],[1,1],[2,1] ],{ canRotate:true,fill:&#39;#f0f080&#39;})
        ]})
  } else if(level===1){
    return({goals:[ this.createGoal(3 ,3 ,grid,[ [0,0],[0,1],[1,0],[1,1],[1,2],[2,2],[2,3] ])],
    pieces:[ this.createPiece(0 , 0 , grid, [ [0,0],[1,0],[1,1] ],{canRotate:true,fill:&#39;#f08080&#39;}),
             this.createPiece(4 , 1 , grid, [ [0,0],[0,1],[1,0],[1,1] ])
        ]})
    } else return(null);
};
_game.init(grid);
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="115" name="CounterCombat" tags="_nosave_" position="600,1475" size="100,100">&lt;div style=&#39;background-color:gray;&#39;  id=&#39;canvas&#39;&gt;
&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;div id=&#39;output&#39;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;div id=&quot;choice&quot;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;div id=&quot;choice2&quot;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;p id=&#39;result&#39;&gt;&lt;/p&gt;
&lt;a0 id=&#39;btstartDominoCombat&#39;&gt;Start Domino-Combat&lt;/a&gt;&lt;a0 id=&#39;startDominoCombat&#39; onclick=&#39;(function($event){document.querySelector(&quot;#&quot;+id+&quot;~p&quot;).toggleAttribute(&quot;hidden&quot;);})(this);&#39;&gt;Hint&lt;/a&gt;
&lt;p hidden&gt;The top 2 rows are the 2 teams. The button with the khaki border is the active player. Only the player-button from the other team is enabled and should be used to select the target for the player.
Below those buttons are the skill-buttons of the active player. The first color should match targets and players color, the second color will be the end color. Disabled buttons are in cooldown. Execute one skill by pressing the button.Then the next player will get activated. Repeat until all players of one team are at 0hp.&lt;/br&gt;
I tried different variants and only the last is implemented here.&lt;/br&gt;
Variant 1: damage is only dealt if start color matches target and attacker. Also target color is only changed then. Attacker color is always changed.&lt;/br&gt;
Problems: if only 1 player has a certain start-color and no one else has a fitting skill, the other players cannot attack her and the game would run forever.&lt;/br&gt;
Variant 2: now there is a little bit of damage even if color doesnt match. The targets color stays unchanged.&lt;/br&gt;
Problems: the game is now not running forever like before but it might take long. If the target uses skill with a &quot;common&quot; color, the game runs normal. &lt;/p&gt;
&lt;a0 id=&#39;btstartCounterChargeCombat&#39;&gt;Start Counter-Charge ombat&lt;/a&gt;&lt;a0 id=&#39;startCounterChargeCombat&#39; onclick=&#39;(function($event){document.querySelector(&quot;#&quot;+id+&quot;~p&quot;).toggleAttribute(&quot;hidden&quot;);})(this);&#39;&gt;Hint&lt;/a&gt;
&lt;p hidden&gt;The top 2 rows are the 2 teams. The button with the khaki border is the active player.&lt;/br&gt; 
Phase0: Only the player-button from the other team is enabled and should be used to select the target for the player. Below those buttons are the skill-buttons of the active player. Disabled buttons are in cooldown or you dont have enough charge. Execute one skill by pressing the button. This will trigger phase1.&lt;/br&gt;
Phase1: The target may select a defense-skill with a mathing color. If this is possible the damage will be reduced and the charge of the target increases.&lt;/br&gt;
Then the next player will get activated. Repeat until all players of one team are at 0hp. &lt;/br&gt;
Note that sucessful attack will earn you little charge of your skill-color but a succesful defense supplys the defender with a bigger charge.&lt;/br&gt;
Todo: The player should see what defenses the target has available (ould also be &quot;learned&quot; by playing against the enemy multiple times.).&lt;/p&gt;
&lt;/div&gt;&lt;script&gt;
function onStop(value){
document.getElementById(&#39;result&#39;).innerHTML=&#39;scored &#39;+value;
}
var _game = window.gm.startCounterChargeCombat(),_game2 = window.gm.startDominoCombat();
document.getElementById(&#39;btstartCounterChargeCombat&#39;).addEventListener(&quot;click&quot;, _game.start);
document.getElementById(&#39;btstartDominoCombat&#39;).addEventListener(&quot;click&quot;, _game2.start);
&lt;/script&gt;

&lt;div style=&#39;background-color:gray;&#39;  id=&#39;canvas&#39;&gt;
&lt;div id=&quot;panel2&quot;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;div id=&#39;output&#39;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;div id=&quot;choice&quot;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;div id=&quot;choice2&quot;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;p id=&#39;result&#39;&gt;&lt;/p&gt;
 &lt;label&gt;foe:
		&lt;select id=&quot;Foe&quot; onchange=&#39;selOption(this)&#39;&gt;
			&lt;option value=&quot;human&quot; selected&gt;human&lt;/option&gt;
      &lt;option value=&quot;demon&quot;&gt;demon&lt;/option&gt;
			&lt;option value=&quot;fuckmachine&quot;&gt;fuckmachine&lt;/option&gt;
		&lt;/select&gt;
&lt;/label&gt;
&lt;label&gt;Player#0-AI:
		&lt;select id=&quot;AI1&quot; onchange=&#39;selOption(this)&#39;&gt;
			&lt;option value=&quot;none&quot; selected&gt;None&lt;/option&gt;
			&lt;option value=&quot;passive&quot;&gt;passive&lt;/option&gt;
      &lt;option value=&quot;virgin&quot;&gt;virgin&lt;/option&gt;
      &lt;option value=&quot;together&quot;&gt;together&lt;/option&gt;
      &lt;option value=&quot;selfish&quot;&gt;selfish&lt;/option&gt;
      &lt;option value=&quot;denial&quot;&gt;mean&lt;/option&gt;
      &lt;option value=&quot;cassanova&quot;&gt;cassanova&lt;/option&gt;
      &lt;option value=&quot;random&quot;&gt;random&lt;/option&gt;
		&lt;/select&gt;
&lt;/label&gt; &lt;label&gt;Player#1-AI:
		&lt;select id=&quot;AI2&quot; onchange=&#39;selOption(this)&#39;&gt;
			&lt;option value=&quot;none&quot; selected&gt;None&lt;/option&gt;
			&lt;option value=&quot;passive&quot;&gt;passive&lt;/option&gt;
      &lt;option value=&quot;virgin&quot;&gt;virgin&lt;/option&gt;
      &lt;option value=&quot;together&quot;&gt;together&lt;/option&gt;
      &lt;option value=&quot;selfish&quot;&gt;selfish&lt;/option&gt;
      &lt;option value=&quot;denial&quot;&gt;mean&lt;/option&gt;
      &lt;option value=&quot;cassanova&quot;&gt;cassanova&lt;/option&gt;
      &lt;option value=&quot;random&quot;&gt;random&lt;/option&gt;
		&lt;/select&gt;
&lt;/label&gt; &lt;fieldset&gt; 
	&lt;legend&gt;debug:&lt;/legend&gt; 
	&lt;input type=&quot;checkbox&quot; name=&quot;debug&quot; value=&quot;ignoreStamina&quot; id=&quot;debug1&quot; onchange=&#39;selOption(this)&#39;&gt;
	&lt;label for=&quot;debug1&quot;&gt;ignore Stamina&lt;/label&gt;
	&lt;input type=&quot;checkbox&quot; name=&quot;debug&quot; value=&quot;displayAll&quot; id=&quot;debug2&quot; onchange=&#39;selOption(this)&#39; checked&gt;
	&lt;label for=&quot;debug2&quot;&gt;display all&lt;/label&gt;
&lt;/fieldset&gt;
&lt;a0 id=&#39;btstartOmeterCombat&#39;&gt;Start Ometer-Combat&lt;/a&gt;&lt;a0 id=&#39;startOmeterCombat&#39; onclick=&#39;(function($event){document.querySelector(&quot;#&quot;+id+&quot;~p&quot;).toggleAttribute(&quot;hidden&quot;);})(this);&#39;&gt;Hint&lt;/a&gt;
&lt;p hidden&gt;You are a succubus and need to feast on your victim by sexual drain. &lt;/br&gt;
For this you need their orgasmmeter, which indicate their pent-up need, get into the pink area and then trigger their PointOfNoReturn. A fuller bar will gain you more essence.&lt;/br&gt;
PNR is indicated red in the pleasure-bar. Oh and by the way, the orgasm-meter only fills if the pleasure is in the green range. Just be careful to not trigger PNR to early or you will receive only little essence, or nothing at all if ometer is in blue area.&lt;/br&gt;
And if the ometer gets into the orange range, this means overstimulation which will cause pleasure to drop quickly to the blue range, indicating their annoyence. But if you can trigger PNR now, your essence gain will be much bigger.&lt;/br&gt;
If they are annoyed, ometer will drain quickly, letting your efforts go to waste.&lt;/br&gt;
Since actions need stamina, you need to be careful to not waste it and take a breather in between. Different actions result in different pleasure gains or losses on both sides and also affect the pleasure you gain from your opponent.&lt;/br&gt; 
Stamina is also drained if you trigger PNR, so you better are not to lazy about it.&lt;/br&gt;
The game ends if everyone exhaust their stamina (red range).&lt;/br&gt;
As you can see, you have the same bars and the same rules apply for you.&lt;/br&gt;
You can set some settings before you start.&lt;/br&gt;
&lt;/p&gt;
&lt;script&gt;
function selOption(elmnt){
		var msg=&#39;&#39;,menu = document.getElementById(elmnt.id);
    if(elmnt.id===&quot;AI1&quot;|| elmnt.id===&quot;AI2&quot;) {
      msg+=&#39;behavior= &#39;+menu.value+&#39; - &#39;;
      switch(menu.value) {
        case &#39;none&#39;: msg+=&#39;control participant by player&#39;;break;
        case &#39;passive&#39;: msg+=&#39;always passive, let you do all the work&#39;;break;
        //case &#39;random&#39;: msg+=&#39;random&#39;;break;
        //case &#39;virgin&#39;: msg+=&#39;foe trys to avoid own orgasm&#39;;break;
        //case &#39;cassanova&#39;: msg+=&#39;foe trys to make you orgasm without own orgasm&#39;;break;
        //case &#39;together&#39;: msg+=&#39;cooperative,foe trys to have you both orgasm at same time&#39;;break;
        case &#39;selfish&#39;: msg+=&#39;doesnt care about you and just wants a quickie&#39;;break;
        //case &#39;denial&#39;: msg+=&#39;edging you but preventing your orgasm&#39;;break;
        default:
          msg+=&#39; not implemented ! Dont use !&#39;
      }      
    } else if([&quot;debug1&quot;,&quot;debug2&quot;].includes(elmnt.id)) {
      msg+=&#39;debug= &#39;+menu.value+&#39; - &#39;;
      switch(menu.value) {
        case &#39;displayAll&#39;: msg+=&#39;show all info &amp; bars&#39;;break;
        case &#39;ignoreStamina&#39;: msg+=&#39;stamina is not evaluated&#39;;break;
        default:
          msg+=&#39; not implemented ! Dont use !&#39;
      }      
    } if(elmnt.id===&quot;Foe&quot;) {
      msg+=&#39;stats of second player= &#39;+menu.value+&#39; - &#39;;
      switch(menu.value) {
        case &#39;hotshot&#39;: msg+=&#39;quick to fire&#39;;break;
        case &#39;human&#39;: msg+=&#39;equal to you&#39;;break;
        case &#39;demon&#39;: msg+=&#39;bigger pleasure bar&#39;;break;
        case &#39;fuckmachine&#39;: msg+=&#39;high stamina&#39;;break;
        default:
          msg+=&#39; not implemented ! Dont use !&#39;
      }      
    }
    document.querySelector(&#39;div#output&#39;).innerHTML=msg;
}
function onStop(value){ document.getElementById(&#39;result&#39;).innerHTML=&#39;scored &#39;+value;}
var _game = window.gm.startOmeterCombat();
document.getElementById(&#39;btstartOmeterCombat&#39;).addEventListener(&quot;click&quot;, 
function(){
  var foeDict={human:{ stamina:{min:0,max:100,exhausted:20,curr:80,regen:5},
                      ometer:{min:0,denial:20,minor:40,gasm:85,max:100,curr:0}, 
                      pleasure:{min:0,annoy:20,good:30,max:50,PNR:45,curr:10}}
              ,hotshot:{ stamina:{min:0,max:100,exhausted:20,curr:80,regen:5},
                      ometer:{min:0,denial:20,minor:25,gasm:65,max:70,curr:0}, 
                      pleasure:{min:0,annoy:10,good:30,max:60,PNR:45,curr:10}}
              ,demon:{ stamina:{min:0,max:100,exhausted:20,curr:80,regen:5},
                      ometer:{min:0,denial:20,minor:60,gasm:85,max:100,curr:0},
                      pleasure:{min:0,annoy:20,good:90,max:120,PNR:110,curr:10}}
        ,fuckmachine:{ stamina:{min:0,max:150,exhausted:20,curr:120,regen:5},
                      ometer:{min:0,denial:20,minor:60,gasm:85,max:100,curr:0},
                      pleasure:{min:0,annoy:20,good:60,max:80,PNR:70,curr:10}}
  }
  _game.start([ [window.gm.util.deepCloneObj(foeDict[&#39;human&#39;])],[window.gm.util.deepCloneObj(foeDict[document.getElementById(&#39;Foe&#39;).value])] ],
    [document.getElementById(&#39;AI1&#39;).value,document.getElementById(&#39;AI2&#39;).value],
    {display:document.getElementById(&#39;debug2&#39;).checked,staminaOff:document.getElementById(&#39;debug1&#39;).checked});});
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="116" name="Pong" tags="" position="725,1475" size="100,100">&lt;div id=&quot;pong&quot;&gt;&lt;/div&gt;
&lt;a0 id=&#39;btStart&#39;&gt;Start&lt;/a&gt;&lt;p id=&#39;result&#39;&gt;&lt;/p&gt;
&lt;script&gt;window.gm.startPong();&lt;/script&gt;</tw-passagedata><tw-passagedata pid="117" name="ReactionTest" tags="" position="850,1475" size="100,100">&lt;p&gt;Click Start and then click somewhere on the bar to stop the green rectangle in the yellow hit-area.&lt;/p&gt;
&lt;div id=&#39;canvas&#39;&gt;&lt;/div&gt;
&lt;div class=&quot;progressbar&quot; id=&#39;clickHere&#39; style=&#39;height:1em; width: 100%;&#39;&gt;&lt;div id=&#39;bar&#39; style=&quot;position:relative; width:5%; height:100%; background-color:green;&quot;&gt;&lt;/div&gt;&lt;/div&gt;
&lt;a0 id=&#39;btStart&#39;&gt;Start&lt;/a&gt;&lt;p id=&#39;result&#39;&gt;&lt;/p&gt;
&lt;script&gt;
function onStop(value){
document.getElementById(&#39;result&#39;).innerHTML=&#39;scored &#39;+value;
}
var _game = window.gm.startReactTest(&#39;bar&#39;,2000,onStop,null,[{a:40,b:60,color:&#39;orange&#39;},{a:90,b:100,color:&#39;yellow&#39;}]);
document.getElementById(&#39;btStart&#39;).addEventListener(&quot;click&quot;, _game.start);
document.getElementById(&#39;clickHere&#39;).addEventListener(&quot;click&quot;, _game.click);
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="118" name="ReactionTest2" tags="" position="975,1475" size="100,100">&lt;p&gt;Click Start and then keypress A/D to fill meter.&lt;/p&gt;
&lt;div class=&quot;progressbar&quot; id=&#39;clickHere&#39; style=&#39;height:1em; width: 100%;&#39;&gt;&lt;div id=&#39;bar&#39; style=&quot;position:relative; width:5%; height:100%; background-color:green;&quot;&gt;&lt;/div&gt;&lt;/div&gt;
&lt;a0 id=&#39;btStart&#39;&gt;Start&lt;/a&gt;&lt;p id=&#39;result&#39;&gt;&lt;/p&gt;
&lt;p&gt;&lt;output id=&quot;losgelassen&quot;&gt;&lt;output&gt;&lt;/output&gt;&lt;/p&gt;
&lt;script&gt;
function onStop(value){
  document.getElementById(&#39;result&#39;).innerHTML=&#39;scored &#39;+value;
}
var _game = window.gm.startReactTest2(&#39;bar&#39;,100,onStop,null,[{a:40,b:60,color:&#39;orange&#39;},{a:90,b:100,color:&#39;yellow&#39;}]);
document.getElementById(&#39;btStart&#39;).addEventListener(&quot;click&quot;, _game.start);
document.querySelector(&#39;body&#39;).addEventListener(&quot;keyup&quot;, _game.click);
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="119" name="ReactionTest3" tags="" position="1100,1475" size="100,100">&lt;article style=&quot;background-color: antiquewhite;display:flex; flex-flow: row wrap;&quot;&gt;
&lt;aside style=&quot;flex: 1 1 0%;&quot;&gt;&lt;p&gt;Click Start and then keypress displayed arrows to fill meter.&lt;/p&gt;&lt;a0 id=&#39;btStart&#39;&gt;Start&lt;/a&gt;&lt;/br&gt;
&lt;label for=&quot;drainSpeed&quot;&gt;drainSpeed&lt;/label&gt;&lt;input id=&quot;drainSpeed&quot; type=&quot;number&quot; title=&quot;time until drain&quot; min=&quot;10&quot; max=&quot;10000&quot; value=&quot;500&quot; /&gt;
&lt;label for=&quot;passFill&quot;&gt;passFill&lt;/label&gt;&lt;input id=&quot;passFill&quot; type=&quot;number&quot; title=&quot;gain&quot; min=&quot;1&quot; max=&quot;10000&quot; value=&quot;5&quot; /&gt;
&lt;label for=&quot;comboSteps&quot;&gt;comboSteps&lt;/label&gt;&lt;input id=&quot;comboSteps&quot; type=&quot;number&quot; title=&quot;comboSteps&quot; min=&quot;2&quot; max=&quot;10000&quot; value=&quot;3&quot; /&gt;
&lt;label for=&quot;comboLevels&quot;&gt;comboLevels&lt;/label&gt;&lt;input id=&quot;comboLevels&quot; type=&quot;number&quot; title=&quot;comboLevels&quot; min=&quot;0&quot; max=&quot;10000&quot; value=&quot;2&quot; /&gt;
&lt;label for=&quot;comboBoost&quot;&gt;comboBoost&lt;/label&gt;&lt;input id=&quot;comboBoost&quot; type=&quot;number&quot; title=&quot;comboBoost&quot; min=&quot;0&quot; step=&quot;0.1&quot; max=&quot;2&quot; value=&quot;1&quot; /&gt;
&lt;label&gt;what does change when you fill the bar:
		&lt;select id=&quot;style&quot;&gt;
			&lt;option value=&quot;movetrack&quot; selected&gt;loop different parts of video&lt;/option&gt;
      &lt;option value=&quot;switchvideo&quot;&gt;switch displayed video&lt;/option&gt;
      &lt;option value=&quot;imageswap&quot;&gt;swap poster image (no video)&lt;/option&gt;
		&lt;/select&gt;
&lt;/label&gt;
&lt;p id=&#39;result&#39;&gt;
&lt;/aside&gt;
&lt;article style=&quot;flex: 3 1 0%;&quot;&gt;
    &lt;div style=&quot;position: relative; place-content: center;display: flex;&quot;&gt;
    &lt;img id=&quot;myImage&quot; src=&quot;&quot; style=&quot;width=100%; max-height:80vH&quot;&gt;&lt;/img&gt;
    &lt;video controls playsinline muted loop id=&quot;myVideo&quot; poster=&quot;&quot; src=&quot;&quot; style=&quot;width=100%; max-height:80vH&quot;&gt;&lt;/video&gt;
      &lt;div id=&quot;controls&quot; style=&quot;position: absolute;top: 50%;width: 100%;&quot; hidden&gt;
      &lt;p style=&quot;display: flex;	align-items: center; justify-content: center;margin: 0px;&quot;&gt;&lt;input id=&quot;spKey2&quot; type=&quot;image&quot; src=&quot;assets/icons/none.png /&gt;&lt;input id=&quot;upKey&quot; type=&quot;image&quot; src=&quot;assets/icons/arrow_up.png&quot; /&gt;&lt;input id=&quot;spKey&quot; type=&quot;image&quot; src=&quot;assets/icons/none.png /&gt;&lt;/p&gt;
      &lt;p style=&quot;display: flex;	align-items: center; justify-content: center;margin: 0px;&quot;&gt;&lt;input id=&quot;leftKey&quot; type=&quot;image&quot; src=&quot;assets/icons/arrow_left.png&quot; /&gt;&lt;input id=&quot;downKey&quot; type=&quot;image&quot; src=&quot;assets/icons/arrow_down.png&quot; /&gt;&lt;input id=&quot;rightKey&quot; type=&quot;image&quot; src=&quot;assets/icons/arrow_right.png&quot; /&gt;&lt;/p&gt;
    &lt;div class=&quot;progressbar&quot; id=&#39;clickHere&#39; style=&#39;height:1em; width: 100%;&#39;&gt;&lt;div id=&#39;bar&#39; style=&quot;position:relative; width:5%; height:100%; background-color:green;&quot;&gt;&lt;/div&gt;&lt;/div&gt;
  &lt;/div&gt;
&lt;/article&gt;
&lt;/article&gt;
&lt;script&gt;
var ssvid=document.getElementById(&#39;myVideo&#39;),imgid=document.getElementById(&#39;myImage&#39;);
var oldtrack=track=maxValue=0,style;
function onStop(value,maxcombo) {
  ssvid.pause();
  document.getElementById(&#39;controls&#39;).setAttribute(&#39;hidden&#39;,&quot;&quot;)
  document.getElementById(&#39;result&#39;).innerHTML=(value&gt;99)?&#39;You WON ! maxCombo=&#39;+maxcombo:&quot;You FAILED !&quot;;
}
function onStart() {
  ssvid.currentTime=0;oldtrack=-1;track=maxValue=0;
  ssvid.src=&quot;assets/workout.mp4&quot;; 
  if(style!=&quot;imageswap&quot;) {
    ssvid.play();
  } else modifyVideo()
  document.getElementById(&#39;result&#39;).innerHTML=&#39;GO !!&#39;;
}
function onComboUp(value) {
  if(value==0) document.getElementById(&#39;result&#39;).innerHTML=&#39;combo broken !&#39;;
  else  document.getElementById(&#39;result&#39;).innerHTML=&#39;combo-up &#39;+value;
}
function onTrigger(valueNew,valueOld,combo) {
  if(valueNew&gt;maxValue) { maxValue=valueNew;
    track=Math.floor(valueNew/30);
  }
  if(style==&quot;imageswap&quot; &amp;&amp; track!=oldtrack) modifyVideo();
  document.getElementById(&#39;result&#39;).innerHTML=&#39;track=&#39;+track;
}
function start(){
  document.getElementById(&#39;controls&#39;).removeAttribute(&#39;hidden&#39;);
  style=document.querySelector(&quot;#style&quot;).value;
  _game.start({drainSpeed:parseInt(document.querySelector(&quot;#drainSpeed&quot;).value),
    passFill:parseInt(document.querySelector(&quot;#passFill&quot;).value),
    comboSteps:parseInt(document.querySelector(&quot;#comboSteps&quot;).value),
    comboLevels:parseInt(document.querySelector(&quot;#comboLevels&quot;).value),
    comboBoost:parseInt(document.querySelector(&quot;#comboBoost&quot;).value)
     });
}
ssvid.addEventListener(&#39;timeupdate&#39;, modifyVideo);//Note timeupdate is only fired when video plays
function modifyVideo() {
  //since I cannot modify video.videoTracks directly, I fallback to currentTime. But timeUpdate might called every 250ms only.
  //changing track will be delayed until current track is done
    var time = ssvid.currentTime; 
    switch(style){
      case &quot;imageswap&quot;:
        if(track!=oldtrack){
          imgid.src=&quot;assets/bg/&quot;+([&quot;bg_ruin_1.png&quot;,&quot;bg_ruin_2.png&quot;,&quot;bg_ruin_3.png&quot;,&quot;bg_sewer_1.png&quot;][track]); 
          oldtrack=track;
        }
        break;
      case &quot;switchvideo&quot;:
        if(track!=oldtrack){
          ssvid.src=&quot;assets/&quot;+([&quot;workout.mp4&quot;,&quot;Monsterhunter Now My first fight JR 9.mp4&quot;,&quot;workout.mp4&quot;,&quot;workout.mp4&quot;][track]);
          ssvid.play();  
          oldtrack=track;
        }
      break;
      default:
        if(track==0 &amp;&amp; time&gt;3.0){
          ssvid.currentTime=1.0;
        } else if(track==1 &amp;&amp; time&gt;5.0) {
          ssvid.currentTime=3.0;
        } else if(track==2 &amp;&amp; time&gt;7.0) {
          ssvid.currentTime=5.0;
        }
    }
}
//
/*ssvid.addEventListener(&#39;pause&#39;, function(e) {
    //when using timerange, we could listen to onpause and set the next src but
    //if setting src=&quot;assets/workout.mp4#t=0,3.3&quot; , this causes to reload the video and the video gets interrupted !
  });*/
var _game = window.gm.startReactTest3(&#39;bar&#39;,[&quot;leftKey&quot;,&quot;rightKey&quot;,&quot;upKey&quot;,&quot;downKey&quot;],[&quot;spKey&quot;],onStop,onStart,onComboUp,onTrigger);
document.getElementById(&#39;btStart&#39;).addEventListener(&quot;click&quot;, start);
document.querySelector(&#39;body&#39;).addEventListener(&quot;keyup&quot;, _game.click);
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="120" name="SVGInteractive" tags="" position="1225,1475" size="100,100">&lt;p&gt;example on how to create reactive graphics from svg parts&lt;/p&gt;
* Define g-object with id in defs.
* use-xlink to create instances of those objects
* use var(--) to define variables that you can set in css 
* 
&lt;svg class=&quot;pink-cube&quot; viewBox=&quot;0 0 300 230&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot;&gt;
&lt;defs&gt;
  &lt;g id=&quot;Leg&quot; class=&quot;cube-unit&quot;&gt;
    &lt;rect width=&quot;21&quot; height=&quot;24&quot; fill=&quot;var(--lightColor)&quot; stroke=&quot;var(--strokeColor)&quot;/&gt;
  &lt;/g&gt;
  &lt;/defs&gt;
  &lt;use xlink:href=&quot;#Leg&quot; x=&quot;121&quot; y=&quot;112&quot;/&gt;
&lt;/svg&gt;
&lt;svg class=&quot;pink-cube&quot; viewBox=&quot;0 0 300 230&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot;&gt;
  &lt;defs&gt;
  &lt;g id=&quot;cube&quot; class=&quot;cube-unit&quot;&gt;
    &lt;rect width=&quot;21&quot; height=&quot;24&quot; fill=&quot;var(--lightColor)&quot; stroke=&quot;var(--strokeColor)&quot; transform=&quot;skewY(30)&quot;/&gt;
    &lt;rect width=&quot;21&quot; height=&quot;24&quot; fill=&quot;var(--darkColor)&quot; stroke=&quot;var(--strokeColor)&quot; transform=&quot;skewY(-30) translate(21 24.3)&quot;/&gt;
    &lt;rect width=&quot;21&quot; height=&quot;21&quot; fill=&quot;var(--mainColor)&quot; stroke=&quot;var(--strokeColor)&quot; transform=&quot;scale(1.41,.81) rotate(45) translate(0 -21)&quot;/&gt;
  &lt;/g&gt;
  &lt;/defs&gt;
  &lt;line opacity=&quot;.5&quot; x1=&quot;80&quot; x2=&quot;100&quot; y1=&quot;150&quot; y2=&quot;150&quot; fill=&quot;none&quot; stroke-width=&quot;1&quot; stroke-linecap=&quot;round&quot; stroke=&quot;var(--lightColor)&quot; stroke-dasharray=&quot;2.5&quot; /&gt;
   &lt;line opacity=&quot;.5&quot; x1=&quot;186&quot; x2=&quot;204&quot; y1=&quot;90&quot; y2=&quot;90&quot; fill=&quot;none&quot; stroke-width=&quot;1&quot; stroke-linecap=&quot;round&quot; stroke=&quot;var(--lightColor)&quot; stroke-dasharray=&quot;2.5&quot; /&gt;
   &lt;line opacity=&quot;.5&quot; x1=&quot;115&quot; x2=&quot;115&quot; y1=&quot;75&quot; y2=&quot;85&quot; fill=&quot;none&quot; stroke-width=&quot;1&quot; stroke-linecap=&quot;round&quot; stroke=&quot;var(--lightColor)&quot; stroke-dasharray=&quot;2.5&quot; /&gt;
    &lt;use xlink:href=&quot;#cube&quot; x=&quot;121&quot; y=&quot;112&quot;/&gt;
    &lt;use xlink:href=&quot;#cube&quot; x=&quot;100&quot; y=&quot;124&quot;/&gt;
    &lt;use xlink:href=&quot;#cube&quot; x=&quot;142&quot; y=&quot;124&quot;/&gt;
    &lt;use xlink:href=&quot;#cube&quot; x=&quot;121&quot; y=&quot;136&quot;/&gt;
    &lt;use class=&quot;m-left&quot; xlink:href=&quot;#cube&quot; x=&quot;79&quot; y=&quot;136&quot;/&gt;
    &lt;use xlink:href=&quot;#cube&quot; x=&quot;163&quot; y=&quot;136&quot;/&gt;
    &lt;use xlink:href=&quot;#cube&quot; x=&quot;142&quot; y=&quot;148&quot;/&gt;
    &lt;use xlink:href=&quot;#cube&quot; x=&quot;100&quot; y=&quot;148&quot;/&gt;
    &lt;use xlink:href=&quot;#cube&quot; x=&quot;121&quot; y=&quot;160&quot;/&gt;
    &lt;use xlink:href=&quot;#cube&quot; x=&quot;121&quot; y=&quot;88&quot;/&gt;
    &lt;use xlink:href=&quot;#cube&quot; x=&quot;100&quot; y=&quot;100&quot;/&gt;
    &lt;use xlink:href=&quot;#cube&quot; x=&quot;142&quot; y=&quot;100&quot;/&gt;
    &lt;use xlink:href=&quot;#cube&quot; x=&quot;121&quot; y=&quot;112&quot;/&gt;
    &lt;use xlink:href=&quot;#cube&quot; x=&quot;79&quot; y=&quot;112&quot;/&gt;
    &lt;use xlink:href=&quot;#cube&quot; x=&quot;163&quot; y=&quot;112&quot;/&gt;
    &lt;line opacity=&quot;.5&quot; x1=&quot;165&quot; x2=&quot;185&quot; y1=&quot;155&quot; y2=&quot;155&quot; fill=&quot;none&quot; stroke-width=&quot;1&quot; stroke-linecap=&quot;round&quot; stroke=&quot;var(--lightColor)&quot; stroke-dasharray=&quot;2.5&quot; /&gt;
    &lt;use class=&quot;m-right&quot; xlink:href=&quot;#cube&quot; x=&quot;142&quot; y=&quot;124&quot;/&gt;
    &lt;use xlink:href=&quot;#cube&quot; x=&quot;100&quot; y=&quot;124&quot;/&gt;
    &lt;use xlink:href=&quot;#cube&quot; x=&quot;121&quot; y=&quot;136&quot;/&gt;
    &lt;use xlink:href=&quot;#cube&quot; x=&quot;121&quot; y=&quot;64&quot;/&gt;
    &lt;use class=&quot;m-up&quot; xlink:href=&quot;#cube&quot; x=&quot;100&quot; y=&quot;76&quot;/&gt;
    &lt;use xlink:href=&quot;#cube&quot; x=&quot;142&quot; y=&quot;76&quot;/&gt;
    &lt;use xlink:href=&quot;#cube&quot; x=&quot;121&quot; y=&quot;88&quot;/&gt;
    &lt;use xlink:href=&quot;#cube&quot; x=&quot;79&quot; y=&quot;88&quot;/&gt;
    &lt;use class=&quot;m-right&quot; xlink:href=&quot;#cube&quot; x=&quot;163&quot; y=&quot;88&quot;/&gt;
    &lt;use xlink:href=&quot;#cube&quot; x=&quot;142&quot; y=&quot;100&quot;/&gt;
    &lt;use xlink:href=&quot;#cube&quot; x=&quot;100&quot; y=&quot;100&quot;/&gt;
    &lt;use xlink:href=&quot;#cube&quot; x=&quot;121&quot; y=&quot;112&quot;/&gt;
  &lt;/svg&gt;
  &lt;p&gt;hover over me&lt;/p&gt;</tw-passagedata><tw-passagedata pid="121" name="Evade" tags="" position="100,1600" size="100,100">&lt;!-- präsentiert von kostenlose-javascripts.de (c) Copyright By N00b1000--&gt;
&lt;script type=&#39;text/javascript&#39;&gt;
//&lt;!--
//alert(&quot;Versuche den herunterfallenden Objekten so lange wie möglich auszuweichen.nSteuere die Figur mit den Pfeiltasten.nDrücke &#39;N&#39; für ein neues Spiel.&quot;)
var bilderpfad = &quot;http://www.eurehomepage.tld/bilder&quot;;
var up=0;
var down=0;
var left=0;
var right=0;
var a=0;
var b=0;
var d=0;
var z=0;
var life=1;
var c=Math.round(Math.random()*5);
var starttime = new Date();
document.write(&#39;&lt;div id=&quot;feld&quot; style=&quot;position:relative; left:0px; top:0px; background-color: black; width: 300px; height: 350px;&quot;&gt;&lt;/div&gt;&#39;);
document.write(&#39;&lt;div id=&quot;spieler&quot; style=&quot;position:absolute; left:0px; top:0px&quot;&gt;&#39;);
document.write(&#39;	&lt;img width=&quot;50&quot; id=&quot;imgplayer&quot; height=&quot;50&quot; src=&quot;&#39;+bilderpfad+&#39;/spieler0.gif&quot; alt=&quot;&quot; /&gt;&#39;);
document.write(&#39;&lt;/div&gt;&#39;);
document.write(&#39;&lt;div id=&quot;auto&quot; style=&quot;position:absolute; left:0px; top:0px&quot;&gt;&#39;);
document.write(&#39;	&lt;img width=&quot;50&quot; id=&quot;imgkristall&quot; height=&quot;50&quot; src=&quot;&#39;+bilderpfad+&#39;/kristall0.gif&quot; alt=&quot;&quot; /&gt;&#39;);
document.write(&#39;&lt;/div&gt;&#39;);
function move(){
	spieler0 = new Image();
	spieler0.src = bilderpfad+&quot;/spieler0.gif&quot;;
	spieler1 = new Image();
	spieler1.src = bilderpfad+&quot;/spieler1.gif&quot;;

	if (life==1){
	zaehler();
	if (a&gt;5) a=5;
	document.getElementById(&#39;spieler&#39;).style.left = (a*50)+&quot;px&quot;;
	document.getElementById(&#39;spieler&#39;).style.top = &quot;300px&quot;;
	d++;
	document.getElementById(&#39;auto&#39;).style.top = (d*z/200)+&quot;px&quot;;
	document.getElementById(&#39;auto&#39;).style.left = (c*50)+&quot;px&quot;;
	hit();

	if (d*z/200&gt;300){d=0; c=Math.round(Math.random()*5);} }
	window.setTimeout (&#39;move()&#39;, 10);
}

function keyleft(y){
	if (y==37){ left++; a-- }
}

function keyright(y){
	if (y==39){ right++; a++ }
}

function hit(){
	if (a==c &amp;&amp; d*z/200&gt;250 &amp;&amp; life==1){
		wechsel(&#39;imgplayer&#39;,spieler1);
		alert(&quot;Getroffen!!!nDu hast &quot; + (new Date()-starttime)/1000 + &quot; Sekunden überlebt.&quot;);
		life=0;
	}
}

function zaehler(){
	z=z+1
}

function keycheck(e){
	y = (e) ? e.which : window.event.keyCode;
	if ( y == 78 ){
		restart();
	}

	keyleft(y);
	keyright(y);
	if (a&lt;0) a=0;
	if (b&lt;0) b=0;
}

function restart(){
	a=0; b=0; c=Math.round(Math.random()*5);
	d=0; z=0; life=1; starttime=new Date();
	wechsel(&#39;imgplayer&#39;,spieler0);
}

function wechsel(Bildnr,Bildobjekt){
	document.getElementById(Bildnr).src = Bildobjekt.src;
}
document.onkeydown = keycheck;
move();
//--&gt;
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="122" name="MinesweeperAscii" tags="" position="225,1600" size="100,100">&lt;!-- präsentiert von kostenlose-javascripts.de --&gt;
&lt;script type=&#39;text/javascript&#39;&gt;
//&lt;!--
function neu(){
minen=3;
minen1=0;
verloren=false;
verdeckt=new Array();
aufgedeckt=new Array();
for (i=0;i&lt;16;i++)
{
a = 1 + 6*(Math.random());
a = Math.round(a);
if(a==6 &amp;&amp; minen!=0||a==2 &amp;&amp; minen!=0){
verdeckt[i]=&quot;mine&quot;;
aufgedeckt[i]=&quot;mine&quot;;
minen1+=1;
}
else{
verdeckt[i]=&quot;leer&quot;;
aufgedeckt[i]=&quot;leer&quot;;
}
aktuell=&quot;feld&quot;+i;
document.getElementById(aktuell).innerHTML = &quot;( )&quot;;
}
document.getElementById(&#39;smiley&#39;).innerHTML=&#39;&lt;font color=&quot;lime&quot; onclick=&quot;neu();&quot;&gt;:)&lt;/font&gt;&#39;;
}
neu();
function klick(feld){
ausgabe=&quot;&lt;b&gt;( )&lt;/b&gt;&quot;
if(verloren==false){

checken=&quot;feld&quot;+feld;
if(verdeckt[feld]==&quot;mine&quot;){
verloren=true;
document.getElementById(checken).innerHTML=&quot;(&lt;font color=&#39;red&#39;&gt;*&lt;/font&gt;)&quot;;
document.getElementById(&#39;smiley&#39;).innerHTML=&#39;&lt;font color=&quot;red&quot; onclick=&quot;neu();&quot;&gt;:(&lt;/font&gt;&#39;;
}
else{
ausgabe=0;
aufgedeckt[feld]=&quot;&quot;;
if(verdeckt[feld+1]==&quot;mine&quot; &amp;&amp; feld!=3 || verdeckt[feld-1]==&quot;mine&quot; &amp;&amp; feld!=7 ||verdeckt[feld-1]==&quot;mine&quot; &amp;&amp; feld!=11 ||verdeckt[feld-1]==&quot;mine&quot; &amp;&amp; feld!=15){
ausgabe+=1
}
if(verdeckt[feld-1]==&quot;mine&quot; &amp;&amp; feld!=0 || verdeckt[feld-1]==&quot;mine&quot; &amp;&amp; feld!=4 || verdeckt[feld-1]==&quot;mine&quot; &amp;&amp; feld!=8 ||verdeckt[feld-1]==&quot;mine&quot; &amp;&amp; feld!=12){
ausgabe+=1
}
if(verdeckt[feld-4]==&quot;mine&quot;){
ausgabe+=1
}
if(verdeckt[feld+4]==&quot;mine&quot;){
ausgabe+=1
}
if(ausgabe==0){
ausgabe=&quot;( )&quot;;
}
test=0;
for (i=0;i&lt;16;i++)
{
if(aufgedeckt[i]==&quot;&quot;){
test+=1;

}
if(test==16-minen1){
alert(&quot;Sie haben gewonnen.&quot;);
}

}
ausgaben=&quot;&lt;font color=&#39;green&#39;&gt; &quot;+ausgabe+&quot;&lt;/font&gt;&quot;;
document.getElementById(checken).innerHTML=ausgaben;
}}}
neu();
//--&gt;
&lt;/script&gt;
&lt;div style=&quot;font-size: 30px;&quot; align=&quot;center&quot;&gt;&lt;span id=&quot;smiley&quot; style=&quot;background-color:yellow;&quot;&gt;&lt;font color=&quot;lime&quot; onclick=&quot;neu();&quot;&gt;:)&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;background-color:yellow;&quot;&gt;&lt;font color=&quot;lime&quot;&gt;
&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;
&lt;p align=&quot;center&quot;&gt;&lt;span id=&quot;feld0&quot; onclick=&quot;klick(0)&quot;&gt;()&lt;/span&gt; &lt;span id=&quot;feld1&quot;  onclick=&quot;klick(1)&quot;&gt;()&lt;/span&gt; &lt;span id=&quot;feld2&quot; onclick=&quot;klick(2)&quot;&gt;()&lt;/span&gt; &lt;span id=&quot;feld3&quot; onclick=&quot;klick(3)&quot;&gt;()&lt;/span&gt; &lt;/p&gt;
&lt;p align=&quot;center&quot;&gt;&lt;span id=&quot;feld4&quot; onclick=&quot;klick(4)&quot;&gt;()&lt;/span&gt; &lt;span id=&quot;feld5&quot; onclick=&quot;klick(5)&quot;&gt;()&lt;/span&gt; &lt;span id=&quot;feld6&quot; onclick=&quot;klick(6)&quot;&gt;()&lt;/span&gt; &lt;span id=&quot;feld7&quot; onclick=&quot;klick(7)&quot;&gt;()&lt;/span&gt; &lt;/p&gt;

&lt;p align=&quot;center&quot;&gt;&lt;span id=&quot;feld8&quot; onclick=&quot;klick(8)&quot;&gt;()&lt;/span&gt; &lt;span id=&quot;feld9&quot; onclick=&quot;klick(9)&quot;&gt;()&lt;/span&gt; &lt;span id=&quot;feld10&quot; onclick=&quot;klick(10)&quot;&gt;()&lt;/span&gt; &lt;span id=&quot;feld11&quot; onclick=&quot;klick(11)&quot;&gt;()&lt;/span&gt; &lt;/p&gt;
&lt;p align=&quot;center&quot;&gt;&lt;span id=&quot;feld12&quot; onclick=&quot;klick(12)&quot;&gt;()&lt;/span&gt; &lt;span id=&quot;feld13&quot; onclick=&quot;klick(13)&quot;&gt;()&lt;/span&gt; &lt;span id=&quot;feld14&quot; onclick=&quot;klick(14)&quot;&gt;()&lt;/span&gt; &lt;span id=&quot;feld15&quot;  onclick=&quot;klick(15)&quot;&gt;()&lt;/span&gt; &lt;/p&gt;
&lt;br /&gt;</tw-passagedata><tw-passagedata pid="123" name="HangmanGame" tags="" position="350,1600" size="100,100">&lt;!--adapted from https://remybeumier.be/#creations-anchor--&gt;
&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article class=&quot;main&quot;&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;main&gt;&lt;div class=&quot;alphabet&quot; style=&quot;&quot;&gt;
    &lt;span class=&quot;&quot;&gt;a&lt;/span&gt;
    &lt;span class=&quot;&quot;&gt;b&lt;/span&gt;
    &lt;span class=&quot;&quot;&gt;c&lt;/span&gt;
    &lt;span class=&quot;&quot;&gt;d&lt;/span&gt;
    &lt;span class=&quot;&quot;&gt;e&lt;/span&gt;
    &lt;span class=&quot;&quot;&gt;f&lt;/span&gt;
    &lt;span class=&quot;&quot;&gt;g&lt;/span&gt;
    &lt;span class=&quot;&quot;&gt;h&lt;/span&gt;
    &lt;span class=&quot;&quot;&gt;i&lt;/span&gt;
    &lt;span class=&quot;&quot;&gt;j&lt;/span&gt;
    &lt;span class=&quot;&quot;&gt;k&lt;/span&gt;
    &lt;span class=&quot;&quot;&gt;l&lt;/span&gt;
    &lt;span class=&quot;&quot;&gt;m&lt;/span&gt;
    &lt;span class=&quot;&quot;&gt;n&lt;/span&gt;
    &lt;span class=&quot;&quot;&gt;o&lt;/span&gt;
    &lt;span class=&quot;&quot;&gt;p&lt;/span&gt;
    &lt;span class=&quot;&quot;&gt;q&lt;/span&gt;
    &lt;span class=&quot;&quot;&gt;r&lt;/span&gt;
    &lt;span class=&quot;&quot;&gt;s&lt;/span&gt;
    &lt;span class=&quot;&quot;&gt;t&lt;/span&gt;
    &lt;span class=&quot;&quot;&gt;u&lt;/span&gt;
    &lt;span class=&quot;&quot;&gt;v&lt;/span&gt;
    &lt;span class=&quot;&quot;&gt;w&lt;/span&gt;
    &lt;span class=&quot;&quot;&gt;x&lt;/span&gt;
    &lt;span class=&quot;&quot;&gt;y&lt;/span&gt;
    &lt;span class=&quot;green&quot;&gt;z&lt;/span&gt;
  &lt;/div&gt;
  &lt;div class=&quot;word&quot;&gt;&lt;span class=&quot;z found&quot;&gt;z&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;o&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;o&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;m&lt;/span&gt;&lt;/div&gt;
  &lt;button&gt;Restart&lt;/button&gt;&lt;/main&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
var words = {
  w3: [&quot;car&quot;, &quot;bus&quot;, &quot;red&quot;, &quot;fun&quot;, &quot;arm&quot;, &quot;leg&quot;, &quot;hat&quot;, &quot;dog&quot;, &quot;cat&quot;, &quot;pie&quot;, &quot;egg&quot;, &quot;cow&quot;, &quot;pen&quot;, &quot;key&quot;, &quot;mug&quot;, &quot;tea&quot;, &quot;air&quot;, &quot;ant&quot;, &quot;ape&quot;, &quot;ash&quot;, &quot;add&quot;, &quot;art&quot;, &quot;awn&quot;, &quot;bat&quot;, &quot;bee&quot;, &quot;bug&quot;, &quot;bad&quot;, &quot;bet&quot;, &quot;box&quot;, &quot;big&quot;, &quot;bag&quot;, &quot;bay&quot;, &quot;bed&quot;, &quot;beg&quot;, &quot;bet&quot;, &quot;bra&quot;, &quot;bun&quot;, &quot;cap&quot;, &quot;car&quot;, &quot;cut&quot;, &quot;cup&quot;, &quot;cry&quot;, &quot;dot&quot;, &quot;dye&quot;, &quot;die&quot;, &quot;dip&quot;, &quot;ear&quot;, &quot;ewe&quot;, &quot;egg&quot;, &quot;eel&quot;, &quot;era&quot;, &quot;fan&quot;, &quot;fry&quot;, &quot;fax&quot;, &quot;for&quot;, &quot;flu&quot;, &quot;fur&quot;, &quot;gel&quot;, &quot;gym&quot;, &quot;god&quot;, &quot;ham&quot;, &quot;hen&quot;, &quot;hot&quot;, &quot;hit&quot;, &quot;ice&quot;, &quot;ink&quot;, &quot;inn&quot;, &quot;jam&quot;, &quot;jar&quot;, &quot;joy&quot;, &quot;lap&quot;, &quot;law&quot;, &quot;let&quot;, &quot;mat&quot;, &quot;man&quot;, &quot;mix&quot;, &quot;net&quot;, &quot;nib&quot;, &quot;now&quot;, &quot;not&quot;, &quot;oak&quot;, &quot;odd&quot;, &quot;oil&quot;, &quot;ode&quot;, &quot;pan&quot;, &quot;pet&quot;, &quot;rag&quot;, &quot;red&quot;, &quot;row&quot;, &quot;set&quot;, &quot;sun&quot;, &quot;six&quot;, &quot;tea&quot;, &quot;toe&quot;, &quot;tip&quot;, &quot;urn&quot;, &quot;van&quot;, &quot;vet&quot;, &quot;web&quot;, &quot;wax&quot;, &quot;why&quot;, &quot;yam&quot;, &quot;yak&quot;, &quot;yet&quot;, &quot;zip&quot;, &quot;zoo&quot;],
  w4: [&quot;boat&quot;, &quot;ball&quot;, &quot;blue&quot;, &quot;rose&quot;, &quot;hero&quot;, &quot;city&quot;, &quot;shoe&quot;, &quot;hand&quot;, &quot;sock&quot;, &quot;head&quot;, &quot;back&quot;, &quot;foot&quot;, &quot;bear&quot;, &quot;beer&quot;, &quot;duck&quot;, &quot;lion&quot;, &quot;wine&quot;, &quot;milk&quot;, &quot;meat&quot;, &quot;rice&quot;, &quot;kiwi&quot;, &quot;peer&quot;, &quot;salt&quot;, &quot;fish&quot;, &quot;rock&quot;, &quot;bike&quot;, &quot;book&quot;, &quot;fire&quot;, &quot;tree&quot;, &quot;acid&quot;, &quot;acne&quot;, &quot;anti&quot;, &quot;away&quot;, &quot;beat&quot;, &quot;beef&quot;, &quot;blur&quot;, &quot;bomb&quot;, &quot;cage&quot;, &quot;camp&quot;, &quot;clue&quot;, &quot;cube&quot;, &quot;curl&quot;, &quot;dark&quot;, &quot;dead&quot;, &quot;dial&quot;, &quot;demo&quot;, &quot;disk&quot;, &quot;dorm&quot;, &quot;dose&quot;, &quot;dumb&quot;, &quot;dump&quot;, &quot;duty&quot;, &quot;eyes&quot;, &quot;exam&quot;, &quot;evil&quot;, &quot;epic&quot;, &quot;fate&quot;, &quot;fear&quot;, &quot;film&quot;, &quot;find&quot;, &quot;flag&quot;, &quot;flea&quot;, &quot;fund&quot;, &quot;gain&quot;, &quot;game&quot;, &quot;gift&quot;, &quot;girl&quot;, &quot;gold&quot;, &quot;golf&quot;, &quot;grow&quot;, &quot;hail&quot;, &quot;heal&quot;, &quot;help&quot;, &quot;hide&quot;, &quot;hill&quot;, &quot;hike&quot;, &quot;high&quot;, &quot;hunt&quot;, &quot;join&quot;, &quot;jute&quot;, &quot;junk&quot;, &quot;jump&quot;, &quot;kick&quot;, &quot;kite&quot;, &quot;knit&quot;, &quot;knob&quot;, &quot;kiss&quot;, &quot;lamp&quot;, &quot;land&quot;, &quot;loaf&quot;, &quot;lump&quot;, &quot;math&quot;, &quot;mend&quot;, &quot;mint&quot;, &quot;mode&quot;, &quot;mute&quot;, &quot;myth&quot;, &quot;nest&quot;, &quot;next&quot;, &quot;news&quot;, &quot;noon&quot;, &quot;nerd&quot;, &quot;oats&quot;, &quot;oven&quot;, &quot;oval&quot;, &quot;open&quot;, &quot;pest&quot;, &quot;pick&quot;, &quot;pale&quot;, &quot;palm&quot;, &quot;plot&quot;, &quot;plug&quot;, &quot;rank&quot;, &quot;read&quot;, &quot;real&quot;, &quot;rate&quot;, &quot;rain&quot;, &quot;risk&quot;, &quot;rise&quot;, &quot;seat&quot;, &quot;salt&quot;, &quot;ship&quot;, &quot;side&quot;, &quot;soil&quot;, &quot;stem&quot;, &quot;sure&quot;, &quot;swap&quot;, &quot;tree&quot;, &quot;toad&quot;, &quot;tape&quot;, &quot;tone&quot;, &quot;tyre&quot;, &quot;urge&quot;, &quot;vale&quot;, &quot;vary&quot;, &quot;vote&quot;, &quot;wage&quot;, &quot;warm&quot;, &quot;wilt&quot;, &quot;womb&quot;, &quot;yawn&quot;, &quot;yeti&quot;, &quot;zero&quot;, &quot;zoom&quot;, &quot;zinc&quot;],
  w5: [&quot;green&quot;, &quot;black&quot;, &quot;white&quot;, &quot;house&quot;, &quot;world&quot;, &quot;space&quot;, &quot;earth&quot;, &quot;night&quot;, &quot;shirt&quot;, &quot;boxer&quot;, &quot;scarf&quot;, &quot;glove&quot;, &quot;sheep&quot;, &quot;snake&quot;, &quot;horse&quot;, &quot;water&quot;, &quot;juice&quot;, &quot;pasta&quot;, &quot;apple&quot;, &quot;mango&quot;, &quot;melon&quot;, &quot;salad&quot;, &quot;candy&quot;, &quot;bread&quot;, &quot;ruler&quot;, &quot;phone&quot;, &quot;paper&quot;, &quot;plane&quot;, &quot;train&quot;, &quot;mouse&quot;, &quot;chair&quot;, &quot;align&quot;, &quot;actor&quot;, &quot;agony&quot;, &quot;clean&quot;, &quot;cloak&quot;, &quot;curve&quot;, &quot;drain&quot;, &quot;drape&quot;, &quot;dwell&quot;, &quot;eager&quot;, &quot;erect&quot;, &quot;erase&quot;, &quot;faith&quot;, &quot;fight&quot;, &quot;flirt&quot;, &quot;genie&quot;, &quot;goose&quot;, &quot;grant&quot;, &quot;graph&quot;, &quot;haiku&quot;, &quot;heavy&quot;, &quot;hello&quot;, &quot;humid&quot;, &quot;humor&quot;, &quot;ideal&quot;, &quot;index&quot;, &quot;input&quot;, &quot;judge&quot;, &quot;joker&quot;, &quot;jeans&quot;, &quot;knife&quot;, &quot;knock&quot;, &quot;labor&quot;, &quot;level&quot;, &quot;latte&quot;, &quot;leach&quot;, &quot;lyric&quot;, &quot;lodge&quot;, &quot;major&quot;, &quot;maths&quot;, &quot;music&quot;, &quot;myths&quot;, &quot;night&quot;, &quot;novel&quot;, &quot;noble&quot;, &quot;nudes&quot;, &quot;often&quot;, &quot;organ&quot;, &quot;ozone&quot;, &quot;panda&quot;, &quot;paper&quot;, &quot;peach&quot;, &quot;phase&quot;, &quot;plans&quot;, &quot;power&quot;, &quot;queen&quot;, &quot;quick&quot;, &quot;quill&quot;, &quot;ramen&quot;, &quot;rants&quot;, &quot;react&quot;, &quot;saint&quot;, &quot;sauce&quot;, &quot;skill&quot;, &quot;spike&quot;, &quot;small&quot;, &quot;story&quot;, &quot;swags&quot;, &quot;tease&quot;, &quot;towel&quot;, &quot;tower&quot;, &quot;truck&quot;, &quot;twice&quot;, &quot;veins&quot;, &quot;vital&quot;, &quot;verge&quot;, &quot;watch&quot;, &quot;water&quot;, &quot;wheel&quot;, &quot;widow&quot;, &quot;xylem&quot;, &quot;yatch&quot;, &quot;yours&quot;, &quot;zebra&quot;],
  w6: [&quot;yellow&quot;, &quot;pencil&quot;, &quot;finger&quot;, &quot;street&quot;, &quot;jacket&quot;, &quot;rabbit&quot;, &quot;monkey&quot;, &quot;cookie&quot;, &quot;banana&quot;, &quot;potato&quot;, &quot;orange&quot;, &quot;carrot&quot;, &quot;tomato&quot;, &quot;cheese&quot;, &quot;pepper&quot;, &quot;letter&quot;, &quot;cisors&quot;, &quot;wallet&quot;, &quot;bottle&quot;, &quot;coffee&quot;, &quot;laptop&quot;, &quot;screen&quot;, &quot;garden&quot;, &quot;toilet&quot;, &quot;behalf&quot;, &quot;behind&quot;, &quot;belief&quot;, &quot;belong&quot;, &quot;berlin&quot;, &quot;better&quot;, &quot;beyond&quot;, &quot;bishop&quot;, &quot;border&quot;, &quot;bottle&quot;, &quot;bottom&quot;, &quot;bought&quot;, &quot;branch&quot;, &quot;breath&quot;, &quot;bridge&quot;, &quot;bright&quot;, &quot;broken&quot;, &quot;budget&quot;, &quot;burden&quot;, &quot;bureau&quot;, &quot;button&quot;, &quot;camera&quot;, &quot;cancer&quot;, &quot;cannot&quot;, &quot;carbon&quot;, &quot;career&quot;, &quot;castle&quot;, &quot;casual&quot;, &quot;caught&quot;, &quot;center&quot;, &quot;center&quot;, &quot;chance&quot;, &quot;change&quot;, &quot;charge&quot;, &quot;choice&quot;, &quot;choose&quot;, &quot;chosen&quot;, &quot;church&quot;, &quot;circle&quot;, &quot;client&quot;, &quot;closed&quot;, &quot;closer&quot;, &quot;coffee&quot;, &quot;column&quot;, &quot;combat&quot;, &quot;coming&quot;, &quot;common&quot;, &quot;comply&quot;, &quot;copper&quot;, &quot;corner&quot;, &quot;costly&quot;, &quot;county&quot;, &quot;couple&quot;, &quot;course&quot;, &quot;covers&quot;, &quot;create&quot;, &quot;credit&quot;, &quot;crisis&quot;, &quot;custom&quot;, &quot;damage&quot;, &quot;danger&quot;, &quot;dealer&quot;, &quot;debate&quot;, &quot;decade&quot;, &quot;decide&quot;, &quot;defeat&quot;, &quot;defend&quot;, &quot;define&quot;, &quot;degree&quot;, &quot;demand&quot;, &quot;depend&quot;, &quot;deputy&quot;, &quot;desert&quot;, &quot;design&quot;, &quot;desire&quot;, &quot;detail&quot;, &quot;detect&quot;, &quot;device&quot;, &quot;differ&quot;, &quot;dinner&quot;, &quot;direct&quot;, &quot;doctor&quot;, &quot;dollar&quot;, &quot;domain&quot;, &quot;double&quot;, &quot;driven&quot;, &quot;driver&quot;, &quot;during&quot;, &quot;easily&quot;, &quot;eating&quot;, &quot;editor&quot;, &quot;effect&quot;, &quot;effort&quot;, &quot;eighth&quot;, &quot;either&quot;, &quot;eleven&quot;, &quot;emerge&quot;, &quot;empire&quot;, &quot;employ&quot;, &quot;enable&quot;, &quot;ending&quot;, &quot;energy&quot;, &quot;engage&quot;, &quot;engine&quot;, &quot;enough&quot;, &quot;ensure&quot;, &quot;entire&quot;, &quot;entity&quot;, &quot;equity&quot;, &quot;escape&quot;, &quot;estate&quot;, &quot;ethnic&quot;, &quot;exceed&quot;, &quot;except&quot;, &quot;excess&quot;, &quot;expand&quot;, &quot;expect&quot;, &quot;expert&quot;, &quot;export&quot;, &quot;extend&quot;, &quot;extent&quot;, &quot;fabric&quot;, &quot;facing&quot;, &quot;factor&quot;, &quot;failed&quot;, &quot;fairly&quot;, &quot;fallen&quot;, &quot;family&quot;, &quot;famous&quot;, &quot;father&quot;, &quot;fellow&quot;, &quot;female&quot;, &quot;figure&quot;, &quot;filing&quot;, &quot;finger&quot;, &quot;finish&quot;, &quot;fiscal&quot;, &quot;flight&quot;, &quot;flying&quot;, &quot;follow&quot;, &quot;forced&quot;, &quot;forest&quot;, &quot;forget&quot;, &quot;formal&quot;, &quot;format&quot;, &quot;former&quot;, &quot;foster&quot;, &quot;fought&quot;, &quot;fourth&quot;, &quot;French&quot;, &quot;friend&quot;, &quot;future&quot;, &quot;garden&quot;, &quot;gather&quot;, &quot;gender&quot;, &quot;german&quot;, &quot;global&quot;, &quot;golden&quot;, &quot;ground&quot;, &quot;growth&quot;, &quot;guilty&quot;, &quot;handed&quot;, &quot;handle&quot;, &quot;happen&quot;, &quot;hardly&quot;, &quot;headed&quot;, &quot;health&quot;, &quot;height&quot;, &quot;hidden&quot;, &quot;holder&quot;, &quot;honest&quot;, &quot;impact&quot;, &quot;import&quot;, &quot;income&quot;, &quot;indeed&quot;, &quot;injury&quot;, &quot;inside&quot;, &quot;intend&quot;, &quot;intent&quot;, &quot;invest&quot;, &quot;island&quot;, &quot;itself&quot;, &quot;jersey&quot;, &quot;joseph&quot;, &quot;junior&quot;, &quot;killed&quot;, &quot;labour&quot;, &quot;latest&quot;, &quot;latter&quot;, &quot;launch&quot;, &quot;lawyer&quot;, &quot;leader&quot;, &quot;league&quot;, &quot;leaves&quot;, &quot;legacy&quot;, &quot;length&quot;, &quot;lesson&quot;, &quot;letter&quot;, &quot;lights&quot;, &quot;likely&quot;, &quot;linked&quot;, &quot;liquid&quot;, &quot;listen&quot;, &quot;little&quot;, &quot;living&quot;, &quot;losing&quot;, &quot;lucent&quot;, &quot;luxury&quot;, &quot;mainly&quot;, &quot;making&quot;, &quot;manage&quot;, &quot;manner&quot;, &quot;manual&quot;, &quot;margin&quot;, &quot;marine&quot;, &quot;marked&quot;, &quot;market&quot;, &quot;martin&quot;, &quot;master&quot;, &quot;matter&quot;, &quot;mature&quot;, &quot;medium&quot;, &quot;member&quot;, &quot;memory&quot;, &quot;mental&quot;, &quot;merely&quot;, &quot;merger&quot;, &quot;method&quot;, &quot;middle&quot;, &quot;miller&quot;, &quot;mining&quot;, &quot;minute&quot;, &quot;mirror&quot;, &quot;mobile&quot;, &quot;modern&quot;, &quot;modest&quot;, &quot;module&quot;, &quot;moment&quot;, &quot;morris&quot;, &quot;mostly&quot;, &quot;mother&quot;, &quot;motion&quot;, &quot;moving&quot;, &quot;murder&quot;, &quot;museum&quot;, &quot;mutual&quot;, &quot;myself&quot;, &quot;narrow&quot;, &quot;nation&quot;, &quot;native&quot;, &quot;nature&quot;, &quot;nearby&quot;, &quot;nearly&quot;, &quot;nights&quot;, &quot;nobody&quot;, &quot;normal&quot;, &quot;notice&quot;, &quot;notion&quot;, &quot;number&quot;, &quot;object&quot;, &quot;obtain&quot;, &quot;office&quot;, &quot;offset&quot;, &quot;online&quot;, &quot;option&quot;, &quot;orange&quot;, &quot;origin&quot;, &quot;output&quot;, &quot;oxford&quot;, &quot;packed&quot;, &quot;palace&quot;, &quot;parent&quot;, &quot;partly&quot;, &quot;patent&quot;, &quot;people&quot;, &quot;period&quot;, &quot;permit&quot;, &quot;person&quot;, &quot;phrase&quot;, &quot;picked&quot;, &quot;planet&quot;, &quot;player&quot;, &quot;please&quot;, &quot;plenty&quot;, &quot;pocket&quot;, &quot;police&quot;, &quot;policy&quot;, &quot;prefer&quot;, &quot;pretty&quot;, &quot;prince&quot;, &quot;prison&quot;, &quot;profit&quot;, &quot;proper&quot;, &quot;proven&quot;, &quot;public&quot;, &quot;pursue&quot;, &quot;raised&quot;, &quot;random&quot;, &quot;rarely&quot;, &quot;rather&quot;, &quot;rating&quot;, &quot;reader&quot;, &quot;really&quot;, &quot;reason&quot;, &quot;recall&quot;, &quot;recent&quot;, &quot;record&quot;, &quot;reduce&quot;, &quot;reform&quot;, &quot;regard&quot;, &quot;regime&quot;, &quot;region&quot;, &quot;relate&quot;, &quot;relief&quot;, &quot;remain&quot;, &quot;remote&quot;, &quot;remove&quot;, &quot;repair&quot;, &quot;repeat&quot;, &quot;replay&quot;, &quot;report&quot;, &quot;rescue&quot;, &quot;resort&quot;, &quot;result&quot;, &quot;retail&quot;, &quot;retain&quot;, &quot;return&quot;, &quot;reveal&quot;, &quot;review&quot;, &quot;reward&quot;, &quot;riding&quot;, &quot;rising&quot;, &quot;robust&quot;, &quot;ruling&quot;, &quot;safety&quot;, &quot;salary&quot;, &quot;sample&quot;, &quot;saving&quot;, &quot;saying&quot;, &quot;scheme&quot;, &quot;school&quot;, &quot;screen&quot;, &quot;search&quot;, &quot;season&quot;, &quot;second&quot;, &quot;secret&quot;, &quot;sector&quot;, &quot;secure&quot;, &quot;seeing&quot;, &quot;select&quot;, &quot;seller&quot;, &quot;senior&quot;, &quot;series&quot;, &quot;server&quot;, &quot;settle&quot;, &quot;severe&quot;, &quot;sexual&quot;, &quot;should&quot;, &quot;signal&quot;, &quot;signed&quot;, &quot;silent&quot;, &quot;silver&quot;, &quot;simple&quot;, &quot;simply&quot;, &quot;single&quot;, &quot;sister&quot;, &quot;slight&quot;, &quot;smooth&quot;, &quot;social&quot;, &quot;solely&quot;, &quot;sought&quot;, &quot;source&quot;, &quot;soviet&quot;, &quot;speech&quot;, &quot;spirit&quot;, &quot;spoken&quot;, &quot;spread&quot;, &quot;spring&quot;, &quot;square&quot;, &quot;stable&quot;, &quot;status&quot;, &quot;steady&quot;, &quot;stolen&quot;, &quot;strain&quot;, &quot;stream&quot;, &quot;street&quot;, &quot;stress&quot;, &quot;strict&quot;, &quot;strike&quot;, &quot;string&quot;, &quot;strong&quot;, &quot;struck&quot;, &quot;studio&quot;, &quot;submit&quot;, &quot;sudden&quot;, &quot;suffer&quot;, &quot;summer&quot;, &quot;summit&quot;, &quot;supply&quot;, &quot;surely&quot;, &quot;survey&quot;, &quot;switch&quot;, &quot;symbol&quot;, &quot;system&quot;, &quot;taking&quot;, &quot;talent&quot;, &quot;target&quot;, &quot;taught&quot;, &quot;tenant&quot;, &quot;tender&quot;, &quot;tennis&quot;, &quot;thanks&quot;, &quot;theory&quot;, &quot;thirty&quot;, &quot;though&quot;, &quot;threat&quot;, &quot;thrown&quot;, &quot;ticket&quot;, &quot;timely&quot;, &quot;timing&quot;, &quot;tissue&quot;, &quot;toward&quot;, &quot;travel&quot;, &quot;treaty&quot;, &quot;trying&quot;, &quot;twelve&quot;, &quot;twenty&quot;, &quot;unable&quot;, &quot;unique&quot;, &quot;united&quot;, &quot;unless&quot;, &quot;unlike&quot;, &quot;update&quot;, &quot;useful&quot;, &quot;valley&quot;, &quot;varied&quot;, &quot;vendor&quot;, &quot;versus&quot;, &quot;victim&quot;, &quot;vision&quot;, &quot;visual&quot;, &quot;volume&quot;, &quot;walker&quot;, &quot;wealth&quot;, &quot;weekly&quot;, &quot;weight&quot;, &quot;wholly&quot;, &quot;window&quot;, &quot;winner&quot;, &quot;winter&quot;, &quot;within&quot;, &quot;wonder&quot;, &quot;worker&quot;, &quot;wright&quot;, &quot;writer&quot;, &quot;yellow&quot;],
  w7: [&quot;morning&quot;, &quot;sweater&quot;, &quot;coconut&quot;, &quot;ketchup&quot;, &quot;mostard&quot;, &quot;chicken&quot;, &quot;country&quot;, &quot;kitchen&quot;, &quot;ability&quot;, &quot;absence&quot;, &quot;academy&quot;, &quot;account&quot;, &quot;accused&quot;, &quot;achieve&quot;, &quot;acquire&quot;, &quot;address&quot;, &quot;advance&quot;, &quot;adverse&quot;, &quot;advised&quot;, &quot;adviser&quot;, &quot;against&quot;, &quot;airline&quot;, &quot;airport&quot;, &quot;alcohol&quot;, &quot;alleged&quot;, &quot;already&quot;, &quot;analyst&quot;, &quot;ancient&quot;, &quot;another&quot;, &quot;anxiety&quot;, &quot;anxious&quot;, &quot;anybody&quot;, &quot;applied&quot;, &quot;arrange&quot;, &quot;arrival&quot;, &quot;article&quot;, &quot;assault&quot;, &quot;assumed&quot;, &quot;assured&quot;, &quot;attempt&quot;, &quot;attract&quot;, &quot;auction&quot;, &quot;average&quot;, &quot;backing&quot;, &quot;balance&quot;, &quot;banking&quot;, &quot;barrier&quot;, &quot;battery&quot;, &quot;bearing&quot;, &quot;beating&quot;, &quot;because&quot;, &quot;bedroom&quot;, &quot;believe&quot;, &quot;beneath&quot;, &quot;benefit&quot;, &quot;besides&quot;, &quot;between&quot;, &quot;billion&quot;, &quot;binding&quot;, &quot;brother&quot;, &quot;brought&quot;, &quot;burning&quot;, &quot;cabinet&quot;, &quot;caliber&quot;, &quot;calling&quot;, &quot;capable&quot;, &quot;capital&quot;, &quot;captain&quot;, &quot;caption&quot;, &quot;capture&quot;, &quot;careful&quot;, &quot;carrier&quot;, &quot;caution&quot;, &quot;ceiling&quot;, &quot;central&quot;, &quot;centric&quot;, &quot;century&quot;, &quot;certain&quot;, &quot;chamber&quot;, &quot;channel&quot;, &quot;chapter&quot;, &quot;charity&quot;, &quot;charlie&quot;, &quot;charter&quot;, &quot;checked&quot;, &quot;chicken&quot;, &quot;chronic&quot;, &quot;circuit&quot;, &quot;classes&quot;, &quot;classic&quot;, &quot;climate&quot;, &quot;closing&quot;, &quot;closure&quot;, &quot;clothes&quot;, &quot;collect&quot;, &quot;college&quot;, &quot;combine&quot;, &quot;comfort&quot;, &quot;command&quot;, &quot;comment&quot;, &quot;compact&quot;, &quot;company&quot;, &quot;compare&quot;, &quot;compete&quot;, &quot;complex&quot;, &quot;concept&quot;, &quot;concern&quot;, &quot;concert&quot;, &quot;conduct&quot;, &quot;confirm&quot;, &quot;connect&quot;, &quot;consent&quot;, &quot;consist&quot;, &quot;contact&quot;, &quot;contain&quot;, &quot;content&quot;, &quot;contest&quot;, &quot;context&quot;, &quot;control&quot;, &quot;convert&quot;, &quot;correct&quot;, &quot;council&quot;, &quot;counsel&quot;, &quot;counter&quot;, &quot;country&quot;, &quot;crucial&quot;, &quot;crystal&quot;, &quot;culture&quot;, &quot;current&quot;, &quot;cutting&quot;, &quot;dealing&quot;, &quot;decided&quot;, &quot;decline&quot;, &quot;default&quot;, &quot;defence&quot;, &quot;deficit&quot;, &quot;deliver&quot;, &quot;density&quot;, &quot;deposit&quot;, &quot;desktop&quot;, &quot;despite&quot;, &quot;destroy&quot;, &quot;develop&quot;, &quot;devoted&quot;, &quot;diamond&quot;, &quot;digital&quot;, &quot;discuss&quot;, &quot;disease&quot;, &quot;display&quot;, &quot;dispute&quot;, &quot;distant&quot;, &quot;diverse&quot;, &quot;divided&quot;, &quot;drawing&quot;, &quot;driving&quot;, &quot;dynamic&quot;, &quot;eastern&quot;, &quot;economy&quot;, &quot;edition&quot;, &quot;elderly&quot;, &quot;element&quot;, &quot;engaged&quot;, &quot;enhance&quot;, &quot;essence&quot;, &quot;evening&quot;, &quot;evident&quot;, &quot;exactly&quot;, &quot;examine&quot;, &quot;example&quot;, &quot;excited&quot;, &quot;exclude&quot;, &quot;exhibit&quot;, &quot;expense&quot;, &quot;explain&quot;, &quot;explore&quot;, &quot;express&quot;, &quot;extreme&quot;, &quot;factory&quot;, &quot;faculty&quot;, &quot;failing&quot;, &quot;failure&quot;, &quot;fashion&quot;, &quot;feature&quot;, &quot;federal&quot;, &quot;feeling&quot;, &quot;fiction&quot;, &quot;fifteen&quot;, &quot;filling&quot;, &quot;finance&quot;, &quot;finding&quot;, &quot;fishing&quot;, &quot;fitness&quot;, &quot;foreign&quot;, &quot;forever&quot;, &quot;formula&quot;, &quot;fortune&quot;, &quot;forward&quot;, &quot;founder&quot;, &quot;freedom&quot;, &quot;further&quot;, &quot;gallery&quot;, &quot;gateway&quot;, &quot;general&quot;, &quot;genetic&quot;, &quot;genuine&quot;, &quot;gigabit&quot;, &quot;greater&quot;, &quot;hanging&quot;, &quot;heading&quot;, &quot;healthy&quot;, &quot;hearing&quot;, &quot;heavily&quot;, &quot;helpful&quot;, &quot;helping&quot;, &quot;herself&quot;, &quot;highway&quot;, &quot;himself&quot;, &quot;history&quot;, &quot;holding&quot;, &quot;holiday&quot;, &quot;housing&quot;, &quot;however&quot;, &quot;hundred&quot;, &quot;husband&quot;, &quot;illegal&quot;, &quot;illness&quot;, &quot;imagine&quot;, &quot;imaging&quot;, &quot;improve&quot;, &quot;include&quot;, &quot;initial&quot;, &quot;inquiry&quot;, &quot;insight&quot;, &quot;install&quot;, &quot;instant&quot;, &quot;instead&quot;, &quot;intense&quot;, &quot;interim&quot;, &quot;involve&quot;, &quot;jointly&quot;, &quot;journal&quot;, &quot;journey&quot;, &quot;justice&quot;, &quot;justify&quot;, &quot;keeping&quot;, &quot;killing&quot;, &quot;kingdom&quot;, &quot;kitchen&quot;, &quot;knowing&quot;, &quot;landing&quot;, &quot;largely&quot;, &quot;lasting&quot;, &quot;leading&quot;, &quot;learned&quot;, &quot;leisure&quot;, &quot;liberal&quot;, &quot;liberty&quot;, &quot;library&quot;, &quot;license&quot;, &quot;limited&quot;, &quot;listing&quot;, &quot;logical&quot;, &quot;loyalty&quot;, &quot;machine&quot;, &quot;manager&quot;, &quot;married&quot;, &quot;massive&quot;, &quot;maximum&quot;, &quot;meaning&quot;, &quot;measure&quot;, &quot;medical&quot;, &quot;meeting&quot;, &quot;mention&quot;, &quot;message&quot;, &quot;million&quot;, &quot;mineral&quot;, &quot;minimal&quot;, &quot;minimum&quot;, &quot;missing&quot;, &quot;mission&quot;, &quot;mistake&quot;, &quot;mixture&quot;, &quot;monitor&quot;, &quot;monthly&quot;, &quot;morning&quot;, &quot;musical&quot;, &quot;mystery&quot;, &quot;natural&quot;, &quot;neither&quot;, &quot;nervous&quot;, &quot;network&quot;, &quot;neutral&quot;, &quot;notable&quot;, &quot;nothing&quot;, &quot;nowhere&quot;, &quot;nuclear&quot;, &quot;nursing&quot;, &quot;obvious&quot;, &quot;offense&quot;, &quot;officer&quot;, &quot;ongoing&quot;, &quot;opening&quot;, &quot;operate&quot;, &quot;opinion&quot;, &quot;optical&quot;, &quot;organic&quot;, &quot;outcome&quot;, &quot;outdoor&quot;, &quot;outlook&quot;, &quot;outside&quot;, &quot;overall&quot;, &quot;pacific&quot;, &quot;package&quot;, &quot;painted&quot;, &quot;parking&quot;, &quot;partial&quot;, &quot;partner&quot;, &quot;passage&quot;, &quot;passing&quot;, &quot;passion&quot;, &quot;passive&quot;, &quot;patient&quot;, &quot;pattern&quot;, &quot;payable&quot;, &quot;payment&quot;, &quot;penalty&quot;, &quot;pending&quot;, &quot;pension&quot;, &quot;percent&quot;, &quot;perfect&quot;, &quot;perform&quot;, &quot;perhaps&quot;, &quot;phoenix&quot;, &quot;picking&quot;, &quot;picture&quot;, &quot;pioneer&quot;, &quot;plastic&quot;, &quot;pointed&quot;, &quot;popular&quot;, &quot;portion&quot;, &quot;poverty&quot;, &quot;precise&quot;, &quot;predict&quot;, &quot;premier&quot;, &quot;premium&quot;, &quot;prepare&quot;, &quot;present&quot;, &quot;prevent&quot;, &quot;primary&quot;, &quot;printer&quot;, &quot;privacy&quot;, &quot;private&quot;, &quot;problem&quot;, &quot;proceed&quot;, &quot;process&quot;, &quot;produce&quot;, &quot;product&quot;, &quot;profile&quot;, &quot;program&quot;, &quot;project&quot;, &quot;promise&quot;, &quot;promote&quot;, &quot;protect&quot;, &quot;protein&quot;, &quot;protest&quot;, &quot;provide&quot;, &quot;publish&quot;, &quot;purpose&quot;, &quot;pushing&quot;, &quot;qualify&quot;, &quot;quality&quot;, &quot;quarter&quot;, &quot;radical&quot;, &quot;railway&quot;, &quot;readily&quot;, &quot;Reading&quot;, &quot;reality&quot;, &quot;realize&quot;, &quot;receipt&quot;, &quot;receive&quot;, &quot;recover&quot;, &quot;reflect&quot;, &quot;regular&quot;, &quot;related&quot;, &quot;release&quot;, &quot;remains&quot;, &quot;removal&quot;, &quot;removed&quot;, &quot;replace&quot;, &quot;request&quot;, &quot;require&quot;, &quot;reserve&quot;, &quot;resolve&quot;, &quot;respect&quot;, &quot;respond&quot;, &quot;restore&quot;, &quot;retired&quot;, &quot;revenue&quot;, &quot;reverse&quot;, &quot;rollout&quot;, &quot;routine&quot;, &quot;running&quot;, &quot;satisfy&quot;, &quot;science&quot;, &quot;section&quot;, &quot;segment&quot;, &quot;serious&quot;, &quot;service&quot;, &quot;serving&quot;, &quot;session&quot;, &quot;setting&quot;, &quot;seventh&quot;, &quot;several&quot;, &quot;shortly&quot;, &quot;showing&quot;, &quot;silence&quot;, &quot;silicon&quot;, &quot;similar&quot;, &quot;sitting&quot;, &quot;sixteen&quot;, &quot;skilled&quot;, &quot;smoking&quot;, &quot;society&quot;, &quot;somehow&quot;, &quot;someone&quot;, &quot;speaker&quot;, &quot;special&quot;, &quot;species&quot;, &quot;sponsor&quot;, &quot;station&quot;, &quot;storage&quot;, &quot;strange&quot;, &quot;stretch&quot;, &quot;student&quot;, &quot;studied&quot;, &quot;subject&quot;, &quot;succeed&quot;, &quot;success&quot;, &quot;suggest&quot;, &quot;summary&quot;, &quot;support&quot;, &quot;suppose&quot;, &quot;supreme&quot;, &quot;surface&quot;, &quot;surgery&quot;, &quot;surplus&quot;, &quot;survive&quot;, &quot;suspect&quot;, &quot;sustain&quot;, &quot;teacher&quot;, &quot;telecom&quot;, &quot;telling&quot;, &quot;tension&quot;, &quot;theatre&quot;, &quot;therapy&quot;, &quot;thereby&quot;, &quot;thought&quot;, &quot;through&quot;, &quot;tonight&quot;, &quot;totally&quot;, &quot;touched&quot;, &quot;towards&quot;, &quot;traffic&quot;, &quot;trouble&quot;, &quot;turning&quot;, &quot;typical&quot;, &quot;uniform&quot;, &quot;unknown&quot;, &quot;unusual&quot;, &quot;upgrade&quot;, &quot;upscale&quot;, &quot;utility&quot;, &quot;variety&quot;, &quot;various&quot;, &quot;vehicle&quot;, &quot;venture&quot;, &quot;version&quot;, &quot;veteran&quot;, &quot;victory&quot;, &quot;viewing&quot;, &quot;village&quot;, &quot;violent&quot;, &quot;virtual&quot;, &quot;visible&quot;, &quot;waiting&quot;, &quot;walking&quot;, &quot;wanting&quot;, &quot;warning&quot;, &quot;warrant&quot;, &quot;wearing&quot;, &quot;weather&quot;, &quot;webcast&quot;, &quot;website&quot;, &quot;wedding&quot;, &quot;weekend&quot;, &quot;welcome&quot;, &quot;welfare&quot;, &quot;western&quot;, &quot;whereas&quot;, &quot;whereby&quot;, &quot;whether&quot;, &quot;willing&quot;, &quot;winning&quot;, &quot;without&quot;, &quot;witness&quot;, &quot;working&quot;, &quot;writing&quot;, &quot;written&quot;],
  w8: [&quot;elephant&quot;, &quot;zucchini&quot;, &quot;eggplant&quot;, &quot;computer&quot;, &quot;keyboard&quot;, &quot;bathroom&quot;, &quot;basement&quot;, &quot;breaking&quot;, &quot;breeding&quot;, &quot;building&quot;, &quot;bulletin&quot;, &quot;business&quot;, &quot;calendar&quot;, &quot;campaign&quot;, &quot;capacity&quot;, &quot;casualty&quot;, &quot;catching&quot;, &quot;category&quot;, &quot;Catholic&quot;, &quot;cautious&quot;, &quot;cellular&quot;, &quot;ceremony&quot;, &quot;chairman&quot;, &quot;champion&quot;, &quot;chemical&quot;, &quot;children&quot;, &quot;circular&quot;, &quot;civilian&quot;, &quot;clearing&quot;, &quot;clinical&quot;, &quot;clothing&quot;, &quot;collapse&quot;, &quot;colonial&quot;, &quot;colorful&quot;, &quot;commence&quot;, &quot;commerce&quot;, &quot;complain&quot;, &quot;complete&quot;, &quot;composed&quot;, &quot;compound&quot;, &quot;comprise&quot;, &quot;computer&quot;, &quot;conclude&quot;, &quot;concrete&quot;, &quot;conflict&quot;, &quot;confused&quot;, &quot;congress&quot;, &quot;consider&quot;, &quot;constant&quot;, &quot;consumer&quot;, &quot;continue&quot;, &quot;contract&quot;, &quot;contrary&quot;, &quot;contrast&quot;, &quot;convince&quot;, &quot;corridor&quot;, &quot;coverage&quot;, &quot;covering&quot;, &quot;creation&quot;, &quot;creative&quot;, &quot;criminal&quot;, &quot;critical&quot;, &quot;crossing&quot;, &quot;cultural&quot;, &quot;currency&quot;, &quot;customer&quot;, &quot;database&quot;, &quot;daughter&quot;, &quot;daylight&quot;, &quot;deadline&quot;, &quot;deciding&quot;, &quot;decision&quot;, &quot;decrease&quot;, &quot;deferred&quot;, &quot;definite&quot;, &quot;delicate&quot;, &quot;delivery&quot;, &quot;describe&quot;, &quot;designer&quot;, &quot;detailed&quot;, &quot;diabetes&quot;, &quot;dialogue&quot;, &quot;diameter&quot;, &quot;directly&quot;, &quot;director&quot;, &quot;disabled&quot;, &quot;disaster&quot;, &quot;disclose&quot;, &quot;discount&quot;, &quot;discover&quot;, &quot;disorder&quot;, &quot;disposal&quot;, &quot;distance&quot;, &quot;distinct&quot;, &quot;district&quot;, &quot;dividend&quot;, &quot;division&quot;, &quot;doctrine&quot;, &quot;document&quot;, &quot;domestic&quot;, &quot;dominant&quot;, &quot;dominate&quot;, &quot;doubtful&quot;, &quot;dramatic&quot;, &quot;dressing&quot;, &quot;dropping&quot;, &quot;duration&quot;, &quot;dynamics&quot;, &quot;earnings&quot;, &quot;economic&quot;, &quot;educated&quot;, &quot;efficacy&quot;, &quot;eighteen&quot;, &quot;election&quot;, &quot;electric&quot;, &quot;eligible&quot;, &quot;emerging&quot;, &quot;emphasis&quot;, &quot;employee&quot;, &quot;endeavor&quot;, &quot;engaging&quot;, &quot;engineer&quot;, &quot;enormous&quot;, &quot;entirely&quot;, &quot;entrance&quot;, &quot;envelope&quot;, &quot;equality&quot;, &quot;equation&quot;, &quot;estimate&quot;, &quot;evaluate&quot;, &quot;eventual&quot;, &quot;everyday&quot;, &quot;everyone&quot;, &quot;evidence&quot;, &quot;exchange&quot;, &quot;exciting&quot;, &quot;exercise&quot;, &quot;explicit&quot;, &quot;exposure&quot;, &quot;extended&quot;, &quot;external&quot;, &quot;facility&quot;, &quot;familiar&quot;, &quot;featured&quot;, &quot;feedback&quot;, &quot;festival&quot;, &quot;finished&quot;, &quot;firewall&quot;, &quot;flagship&quot;, &quot;flexible&quot;, &quot;floating&quot;, &quot;football&quot;, &quot;foothill&quot;, &quot;forecast&quot;, &quot;foremost&quot;, &quot;formerly&quot;, &quot;fourteen&quot;, &quot;fraction&quot;, &quot;franklin&quot;, &quot;frequent&quot;, &quot;friendly&quot;, &quot;frontier&quot;, &quot;function&quot;, &quot;generate&quot;, &quot;generous&quot;, &quot;genomics&quot;, &quot;goodwill&quot;, &quot;governor&quot;, &quot;graduate&quot;, &quot;graphics&quot;, &quot;grateful&quot;, &quot;guardian&quot;, &quot;guidance&quot;, &quot;handling&quot;, &quot;hardware&quot;, &quot;heritage&quot;, &quot;highland&quot;, &quot;historic&quot;, &quot;homeless&quot;, &quot;homepage&quot;, &quot;hospital&quot;, &quot;humanity&quot;, &quot;identify&quot;, &quot;identity&quot;, &quot;ideology&quot;, &quot;imperial&quot;, &quot;incident&quot;, &quot;included&quot;, &quot;increase&quot;, &quot;indicate&quot;, &quot;indirect&quot;, &quot;industry&quot;, &quot;informal&quot;, &quot;informed&quot;, &quot;inherent&quot;, &quot;initiate&quot;, &quot;innocent&quot;, &quot;inspired&quot;, &quot;instance&quot;, &quot;integral&quot;, &quot;intended&quot;, &quot;interact&quot;, &quot;interest&quot;, &quot;interior&quot;, &quot;internal&quot;, &quot;interval&quot;, &quot;intimate&quot;, &quot;intranet&quot;, &quot;invasion&quot;, &quot;involved&quot;, &quot;isolated&quot;, &quot;judgment&quot;, &quot;judicial&quot;, &quot;junction&quot;, &quot;keyboard&quot;, &quot;landlord&quot;, &quot;language&quot;, &quot;laughter&quot;, &quot;learning&quot;, &quot;leverage&quot;, &quot;lifetime&quot;, &quot;lighting&quot;, &quot;likewise&quot;, &quot;limiting&quot;, &quot;literary&quot;, &quot;location&quot;, &quot;magazine&quot;, &quot;magnetic&quot;, &quot;maintain&quot;, &quot;majority&quot;, &quot;marginal&quot;, &quot;marriage&quot;, &quot;material&quot;, &quot;maturity&quot;, &quot;maximize&quot;, &quot;meantime&quot;, &quot;measured&quot;, &quot;medicine&quot;, &quot;medieval&quot;, &quot;memorial&quot;, &quot;merchant&quot;, &quot;midnight&quot;, &quot;military&quot;, &quot;minimize&quot;, &quot;minister&quot;, &quot;ministry&quot;, &quot;minority&quot;, &quot;mobility&quot;, &quot;modeling&quot;, &quot;moderate&quot;, &quot;momentum&quot;, &quot;monetary&quot;, &quot;moreover&quot;, &quot;mortgage&quot;, &quot;mountain&quot;, &quot;mounting&quot;, &quot;movement&quot;, &quot;multiple&quot;, &quot;national&quot;, &quot;negative&quot;, &quot;nineteen&quot;, &quot;northern&quot;, &quot;notebook&quot;, &quot;numerous&quot;, &quot;observer&quot;, &quot;occasion&quot;, &quot;offering&quot;, &quot;official&quot;, &quot;offshore&quot;, &quot;operator&quot;, &quot;opponent&quot;, &quot;opposite&quot;, &quot;optimism&quot;, &quot;optional&quot;, &quot;ordinary&quot;, &quot;organize&quot;, &quot;original&quot;, &quot;overcome&quot;, &quot;overhead&quot;, &quot;overseas&quot;, &quot;overview&quot;, &quot;painting&quot;, &quot;parallel&quot;, &quot;parental&quot;, &quot;patented&quot;, &quot;patience&quot;, &quot;peaceful&quot;, &quot;periodic&quot;, &quot;personal&quot;, &quot;persuade&quot;, &quot;petition&quot;, &quot;physical&quot;, &quot;pipeline&quot;, &quot;platform&quot;, &quot;pleasant&quot;, &quot;pleasure&quot;, &quot;politics&quot;, &quot;portable&quot;, &quot;portrait&quot;, &quot;position&quot;, &quot;positive&quot;, &quot;possible&quot;, &quot;powerful&quot;, &quot;practice&quot;, &quot;precious&quot;, &quot;pregnant&quot;, &quot;presence&quot;, &quot;preserve&quot;, &quot;pressing&quot;, &quot;pressure&quot;, &quot;previous&quot;, &quot;princess&quot;, &quot;printing&quot;, &quot;priority&quot;, &quot;probable&quot;, &quot;probably&quot;, &quot;producer&quot;, &quot;profound&quot;, &quot;progress&quot;, &quot;property&quot;, &quot;proposal&quot;, &quot;prospect&quot;, &quot;protocol&quot;, &quot;provided&quot;, &quot;provider&quot;, &quot;province&quot;, &quot;publicly&quot;, &quot;purchase&quot;, &quot;pursuant&quot;, &quot;quantity&quot;, &quot;question&quot;, &quot;rational&quot;, &quot;reaction&quot;, &quot;received&quot;, &quot;receiver&quot;, &quot;recovery&quot;, &quot;regional&quot;, &quot;register&quot;, &quot;relation&quot;, &quot;relative&quot;, &quot;relevant&quot;, &quot;reliable&quot;, &quot;reliance&quot;, &quot;religion&quot;, &quot;remember&quot;, &quot;renowned&quot;, &quot;repeated&quot;, &quot;reporter&quot;, &quot;republic&quot;, &quot;required&quot;, &quot;research&quot;, &quot;reserved&quot;, &quot;resident&quot;, &quot;resigned&quot;, &quot;resource&quot;, &quot;response&quot;, &quot;restrict&quot;, &quot;revision&quot;, &quot;rigorous&quot;, &quot;romantic&quot;, &quot;sampling&quot;, &quot;scenario&quot;, &quot;schedule&quot;, &quot;scrutiny&quot;, &quot;seasonal&quot;, &quot;secondly&quot;, &quot;security&quot;, &quot;sensible&quot;, &quot;sentence&quot;, &quot;separate&quot;, &quot;sequence&quot;, &quot;sergeant&quot;, &quot;shipping&quot;, &quot;shortage&quot;, &quot;shoulder&quot;, &quot;simplify&quot;, &quot;situated&quot;, &quot;slightly&quot;, &quot;software&quot;, &quot;solution&quot;, &quot;somebody&quot;, &quot;somewhat&quot;, &quot;southern&quot;, &quot;speaking&quot;, &quot;specific&quot;, &quot;spectrum&quot;, &quot;sporting&quot;, &quot;standard&quot;, &quot;standing&quot;, &quot;standout&quot;, &quot;sterling&quot;, &quot;straight&quot;, &quot;strategy&quot;, &quot;strength&quot;, &quot;striking&quot;, &quot;struggle&quot;, &quot;stunning&quot;, &quot;suburban&quot;, &quot;suitable&quot;, &quot;superior&quot;, &quot;supposed&quot;, &quot;surgical&quot;, &quot;surprise&quot;, &quot;survival&quot;, &quot;sweeping&quot;, &quot;swimming&quot;, &quot;symbolic&quot;, &quot;sympathy&quot;, &quot;syndrome&quot;, &quot;tactical&quot;, &quot;tailored&quot;, &quot;takeover&quot;, &quot;tangible&quot;, &quot;taxation&quot;, &quot;taxpayer&quot;, &quot;teaching&quot;, &quot;tendency&quot;, &quot;terminal&quot;, &quot;terrible&quot;, &quot;thinking&quot;, &quot;thirteen&quot;, &quot;thorough&quot;, &quot;thousand&quot;, &quot;together&quot;, &quot;tomorrow&quot;, &quot;touching&quot;, &quot;tracking&quot;, &quot;training&quot;, &quot;transfer&quot;, &quot;traveled&quot;, &quot;treasury&quot;, &quot;triangle&quot;, &quot;tropical&quot;, &quot;turnover&quot;, &quot;ultimate&quot;, &quot;umbrella&quot;, &quot;universe&quot;, &quot;unlawful&quot;, &quot;unlikely&quot;, &quot;valuable&quot;, &quot;variable&quot;, &quot;vertical&quot;, &quot;victoria&quot;, &quot;violence&quot;, &quot;volatile&quot;, &quot;warranty&quot;, &quot;weakness&quot;, &quot;weighted&quot;, &quot;whatever&quot;, &quot;whenever&quot;, &quot;wherever&quot;, &quot;wildlife&quot;, &quot;wireless&quot;, &quot;withdraw&quot;, &quot;woodland&quot;, &quot;workshop&quot;, &quot;yourself&quot;],
  w9: [&quot;aardvarks&quot;, &quot;alligator&quot;, &quot;boulevard&quot;, &quot;hamburger&quot;, &quot;turquoise&quot;, &quot;telephone&quot;, &quot;furniture&quot;, &quot;checklist&quot;, &quot;container&quot;, &quot;professor&quot;, &quot;frequency&quot;, &quot;spaceship&quot;, &quot;scarecrow&quot;, &quot;deodorant&quot;, &quot;cranberry&quot;],
  w10: [&quot;department&quot;, &quot;watermelon&quot;, &quot;strawberry&quot;, &quot;skateboard&quot;, &quot;rainforest&quot;, &quot;helicopter&quot;, &quot;percentage&quot;, &quot;restaurant&quot;, &quot;microscope&quot;, &quot;vegetables&quot;, &quot;university&quot;, &quot;volleyball&quot;, &quot;toothbrush&quot;, &quot;laboratory&quot;, &quot;calculator&quot;, &quot;wheelchair&quot;, &quot;chandelier&quot;, &quot;blackberry&quot;, &quot;binoculars&quot;],
  all: []
};
words.all = words.w3.concat(words.w4, words.w5, words.w6, words.w7, words.w8, words.w9, words.w10);
getRandomWord();
function getRandomWord(){
  var randomWord = words.all[Math.floor(Math.random() * words.all.length)];
  $(&quot;.word&quot;).html(&quot;&quot;);
  console.log(randomWord);
  var randomWordSplitted = randomWord.split(&quot;&quot;);
  randomWordSplitted.forEach(function (x){
    $(&quot;.word&quot;).append(&quot;&lt;span class=&#39;&quot; + x + &quot;&#39;&gt;&quot; + x + &quot;&lt;/span&gt;&quot;);
  });
  $(&quot;.alphabet span&quot;).on(&quot;click&quot;, function (){
    var letter = $(this).text();
    if (checkLetter(letter, randomWordSplitted)){
      $(this).addClass(&quot;green&quot;);
      $(&quot;.&quot; + letter).addClass(&quot;found&quot;);
      if (checkWin(randomWordSplitted.length)){
        $(&quot;.alphabet&quot;).fadeOut();
        // setTimeout(function(){
        //   $(&quot;.word&quot;).hide(400);
        //   gameReset();
        // }, 800); 
      }
    }
    else {
      $(this).addClass(&quot;red2&quot;);
    }
  });
}
$(&quot;button&quot;).on(&quot;click&quot;, function (){
  gameReset();
});
function checkWin(length){
  if ($(&quot;.found&quot;).length === length){
    return true;
  }
}
function checkLetter(letter, arr){
  if (arr.indexOf(letter) !== -1){
    return true;
  }
  else {
    return false;
  }
}
function gameReset(){
  $(&quot;.alphabet span&quot;).off().removeClass();
  $(&quot;.word span&quot;).removeClass(&quot;found&quot;);
  $(&quot;.alphabet, .word&quot;).fadeIn();
  getRandomWord();
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="124" name="MemoryGame" tags="" position="475,1600" size="100,100">&lt;!--adapted from https://remybeumier.be/#creations-anchor--&gt;
&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article class=&quot;main&quot;&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
  &lt;div class=&quot;box play&quot;&gt;&lt;/div&gt;
  &lt;div class=&quot;box play&quot;&gt;&lt;/div&gt;
  &lt;div class=&quot;box play&quot;&gt;&lt;/div&gt;
  &lt;div class=&quot;box play&quot;&gt;&lt;/div&gt;
  &lt;div class=&quot;box play&quot;&gt;&lt;/div&gt;
  &lt;div class=&quot;box play&quot;&gt;&lt;/div&gt;
  &lt;div class=&quot;box play&quot;&gt;&lt;/div&gt;
  &lt;div class=&quot;box play&quot;&gt;&lt;/div&gt;
  &lt;div class=&quot;box play&quot;&gt;&lt;/div&gt;
  &lt;div class=&quot;box play&quot;&gt;&lt;/div&gt;
  &lt;div class=&quot;box play&quot;&gt;&lt;/div&gt;
  &lt;div class=&quot;box play&quot;&gt;&lt;/div&gt;
  &lt;div class=&quot;box play&quot;&gt;&lt;/div&gt;
  &lt;div class=&quot;box play&quot;&gt;&lt;/div&gt;
  &lt;div class=&quot;box play&quot;&gt;&lt;/div&gt;
  &lt;div class=&quot;box play&quot;&gt;&lt;/div&gt;
  &lt;div class=&quot;box play&quot;&gt;&lt;/div&gt;
  &lt;div class=&quot;box play&quot;&gt;&lt;/div&gt;
  &lt;div class=&quot;box play&quot;&gt;&lt;/div&gt;
  &lt;div class=&quot;box play&quot;&gt;&lt;/div&gt;  
  &lt;div id=&quot;state&quot;&gt;
    &lt;span id=&quot;time&quot;&gt;0&lt;/span&gt;
    &lt;span id=&quot;score&quot;&gt;0&lt;/span&gt;
  &lt;/div&gt;
&lt;/article&gt;

&lt;article id=&quot;pre&quot; class=&quot;&quot;&gt;
  &lt;div id=&quot;themes&quot;&gt;
    Chose your theme !
    &lt;p id=&quot;pokemon&quot; class=&quot;themes&quot; title=&quot;Pokemon&quot;&gt;Pokemon&lt;/p&gt;
    &lt;p id=&quot;starwars&quot; class=&quot;themes&quot; title=&quot;Star Wars&quot;&gt;Star Wars&lt;/p&gt;
    &lt;p id=&quot;lotr&quot; class=&quot;themes&quot; title=&quot;Lord of the Ring&quot;&gt;Lord of the Ring&lt;/p&gt;
    &lt;p id=&quot;disney&quot; class=&quot;themes&quot; title=&quot;Disney&quot;&gt;Disney&lt;/p&gt;
    &lt;p id=&quot;pixar&quot; class=&quot;themes&quot; title=&quot;Pixar&quot;&gt;Pixar&lt;/p&gt;
    &lt;p id=&quot;harrypotter&quot; class=&quot;themes&quot; title=&quot;Harry Potter&quot;&gt;Harry Potter&lt;/p&gt;
  &lt;/div&gt;
&lt;/article&gt;
&lt;article id=&quot;post&quot; class=&quot;hidden&quot;&gt;
  &lt;div&gt;
    &lt;p&gt;BRAVO !&lt;/p&gt;
    &lt;p id=&quot;final&quot;&gt;&lt;/p&gt;
    &lt;br&gt;
    &lt;p&gt;
      &lt;a id=&quot;again&quot;&gt;Play Again !&lt;/a&gt;
    &lt;/p&gt;
  &lt;/div&gt;
&lt;/article&gt;
&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
var library = {
harrypotter: [
    &#39;https://res.cloudinary.com/beumsk/image/upload/v1547998926/memory/harrypotter/harry.jpg&#39;,
    &#39;https://res.cloudinary.com/beumsk/image/upload/v1547998958/memory/harrypotter/ron.jpg&#39;,
    &#39;https://res.cloudinary.com/beumsk/image/upload/v1547998992/memory/harrypotter/hermione.jpg&#39;,
    &#39;https://res.cloudinary.com/beumsk/image/upload/v1547999106/memory/harrypotter/dumbledore.jpg&#39;,
    &#39;https://res.cloudinary.com/beumsk/image/upload/v1547999032/memory/harrypotter/malfoy.jpg&#39;,
    &#39;https://res.cloudinary.com/beumsk/image/upload/v1547999143/memory/harrypotter/voldemort.jpg&#39;,
    &#39;https://res.cloudinary.com/beumsk/image/upload/v1547999401/memory/harrypotter/rogue.jpg&#39;,
    &#39;https://res.cloudinary.com/beumsk/image/upload/v1547999196/memory/harrypotter/hagrid.jpg&#39;,
    &#39;https://res.cloudinary.com/beumsk/image/upload/v1547999271/memory/harrypotter/sirius.jpg&#39;,
    &#39;https://res.cloudinary.com/beumsk/image/upload/v1547999577/memory/harrypotter/neville.jpg&#39;,
    &#39;https://res.cloudinary.com/beumsk/image/upload/v1547998926/memory/harrypotter/harry.jpg&#39;,
    &#39;https://res.cloudinary.com/beumsk/image/upload/v1547998958/memory/harrypotter/ron.jpg&#39;,
    &#39;https://res.cloudinary.com/beumsk/image/upload/v1547998992/memory/harrypotter/hermione.jpg&#39;,
    &#39;https://res.cloudinary.com/beumsk/image/upload/v1547999106/memory/harrypotter/dumbledore.jpg&#39;,
    &#39;https://res.cloudinary.com/beumsk/image/upload/v1547999032/memory/harrypotter/malfoy.jpg&#39;,
    &#39;https://res.cloudinary.com/beumsk/image/upload/v1547999143/memory/harrypotter/voldemort.jpg&#39;,
    &#39;https://res.cloudinary.com/beumsk/image/upload/v1547999401/memory/harrypotter/rogue.jpg&#39;,
    &#39;https://res.cloudinary.com/beumsk/image/upload/v1547999196/memory/harrypotter/hagrid.jpg&#39;,
    &#39;https://res.cloudinary.com/beumsk/image/upload/v1547999271/memory/harrypotter/sirius.jpg&#39;,
    &#39;https://res.cloudinary.com/beumsk/image/upload/v1547999577/memory/harrypotter/neville.jpg&#39;
  ]
}
var images = [],
    tempElt1 = &quot;&quot;,
    tempElt2 = &quot;&quot;,
    click = -1,
    win = 0,
    score = 0,
    time = 0;
var preElt = document.querySelector(&quot;#pre&quot;),
    themesElt = document.querySelector(&quot;#themes&quot;),
    boxElts = document.getElementsByClassName(&quot;box&quot;),
    mainElt = document.querySelector(&quot;.main&quot;),
    timeElt = document.querySelector(&quot;#time&quot;),
    scoreElt = document.querySelector(&quot;#score&quot;),
    postElt = document.querySelector(&quot;#post&quot;),
    finalElt = document.querySelector(&quot;#final&quot;),
    againElt = document.querySelector(&quot;#again&quot;);
// initiate the game with chosen theme
themesElt.addEventListener(&quot;click&quot;, function(e){
  if (e.target.classList.contains(&quot;themes&quot;)){
    activateTheme(e.target.id);
    preElt.classList.add(&quot;hidden&quot;);
  }
});
function activateTheme(theme){
  // insert theme in images array
  switch (theme){
    case &quot;pokemon&quot;:
      for (let i=0; i&lt;20; i++){images.push(library.pokemon[i]);}
      break;
    case &quot;starwars&quot;:
      for (let i=0; i&lt;20; i++){images.push(library.starwars[i]);}
      break;
    case &quot;lotr&quot;:
      for (let i=0; i&lt;20; i++){images.push(library.lotr[i]);}
      break;
    case &quot;disney&quot;:
      for (let i=0; i&lt;20; i++){images.push(library.disney[i]);}
      break;
    case &quot;pixar&quot;:
      for (let i=0; i&lt;20; i++){images.push(library.pixar[i]);}
      break;
    case &quot;harrypotter&quot;:
      for (let i=0; i&lt;20; i++){images.push(library.harrypotter[i]);}
      break;
  }
  preElt.classList.add(&quot;hidden&quot;);
  // insert images in memory game
  for (let i=0; i&lt;20; i++){
    var rand = Math.floor(Math.random() * (images.length-1));
    boxElts[i].innerHTML = &quot;&lt;img src=&#39;&quot; + images[rand] + &quot;&#39; alt=&#39;image&#39; class=&#39;hidden&#39;&gt;&quot;;
    images.splice(rand, 1);
  }
}
// Handle the play
mainElt.addEventListener(&quot;click&quot;, gameLogic);
function gameLogic(e){
  // make sure the box is playable
  if (e.target.classList.contains(&quot;play&quot;)){
    e.target.firstChild.classList.remove(&quot;hidden&quot;);
    // first of two click
    if (click &lt; 1){
      tempElt1 = e.target;
      // timer
      if (click === -1){
        timer = setInterval(function(){
          time++;
          timeElt.innerHTML = time;
        }, 1000);
      }
      click = 1;
    }
    // second click
    else if (e.target !== tempElt1){
      tempElt2 = e.target;
      // different images
      if (tempElt1.firstChild.src !== tempElt2.firstChild.src){
        mainElt.removeEventListener(&quot;click&quot;, gameLogic);
        setTimeout( function(){
          tempElt1.firstChild.classList.add(&quot;hidden&quot;);
          tempElt2.firstChild.classList.add(&quot;hidden&quot;);
          mainElt.addEventListener(&quot;click&quot;, gameLogic);
        }, 400);
        if (score &gt; 0){
          score -= 2;
        }
        scoreElt.innerHTML = score;
      }
      // same images
      else {
        score += 10;
        win += 2;
        tempElt1.firstChild.classList.add(&quot;outlined&quot;);
        tempElt2.firstChild.classList.add(&quot;outlined&quot;);
        tempElt1.classList.remove(&quot;play&quot;);
        tempElt2.classList.remove(&quot;play&quot;);
        scoreElt.innerHTML = score;
        // game won
        if (win === 20){
          clearTimeout(timer);
          finalElt.innerHTML = &quot;You won &quot; + score + &quot; points &lt;br&gt; in &quot; + time + &quot; seconds&quot;;
          postElt.classList.remove(&quot;hidden&quot;);
        }
      }
      click = 0;
    }
  }
}
againElt.addEventListener(&quot;click&quot;, resetGame);
function resetGame(){
  // reset game
  tempElt1 = &quot;&quot;;
  tempElt2 = &quot;&quot;;
  click = -1;
  win = 0;
  score = 0;
  time = 0;
  postElt.classList.add(&quot;hidden&quot;);
  preElt.classList.remove(&quot;hidden&quot;);
  for (let i=0; i&lt;20; i++){
    boxElts[i].classList.add(&quot;play&quot;);
    boxElts[i].firstChild.classList.add(&quot;hidden&quot;);
  }
  timeElt.textContent = time;
  scoreElt.textContent = score;
}
activateTheme(&quot;harrypotter&quot;);
// handle focus of the page
// function checkPageFocus(){
//   if (document.hasFocus()){
//     preElt.classList.remove(&quot;hidden&quot;);
//   }
//   else {
//     preElt.classList.add(&quot;hidden&quot;);
//   }
// }
// var checkPageInterval = setInterval(checkPageFocus, 300);
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="125" name="DngNG_SpiderFight" tags="_nosave_" position="600,1600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
You are facing one of  those spider bots.
Try to hit it with your &lt;a0 onclick=&#39;window.story.show(window.story.state.combat.tmp.inst+&quot;Melee&quot;)&#39;&gt;bare hands&lt;/a&gt; 
or &lt;a0 onclick=&#39;window.story.show(window.story.state.combat.tmp.inst+&quot;Flee&quot;)&#39;&gt;run away&lt;/a&gt;?
&lt;div hidden&gt;
-&gt;melee-click -&gt;
-&gt;calculate success based on attribute &amp; status; select passage and store roll in tmp -&gt;
-&gt;print passage + tmp
&lt;/div&gt;

&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;function initCombat(){
    window.gm.simpleCombatInit(&quot;DngNG_Spider&quot;);
    var tmp=window.story.state.combat.tmp;
    tmp.npc={hp:1};
}
initCombat();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="126" name="DngNG_SpiderMelee" tags="_nosave_" position="725,1600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;div id=&#39;select10&#39; &gt;
&lt;/div&gt;&lt;div id=&#39;choice10a&#39; hidden&gt;&lt;/br&gt; The bot was to slow to evade your fist. You didnt deal much damage but at least the bot seems to be intimidated and scurrys off.
&lt;a0 onclick=&#39;window.story.show(window.story.state.combat.tmp.inst+&quot;Victory&quot;)&#39;&gt;Leave the place&lt;/a&gt;
&lt;/div&gt;
&lt;div id=&#39;choice10b&#39; hidden&gt;&lt;/br&gt; Sidestepping your puny attack, you just hit thin air. While the momentum drives you forward, the bot jumps at you &lt;a0 onclick=&#39;window.story.show(window.story.state.combat.tmp.inst+&quot;Loss&quot;)&#39;&gt;jumps at you.&lt;/a&gt;
&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;function foo(){
    var s = window.story.state,tmp=s.combat.tmp;
    if(tmp.now===window.passage.name) return;
    tmp.now=window.passage.name;
    var _dmg=0,_rng=_.random(0,100);
    if(_rng&gt;50) {
        _dmg=1;
    }
    if(_dmg&gt;0) {
        tmp.npc.hp-=_dmg;
        window.gm.printTalkLink(&quot;div#select10&quot;,&quot;div#choice10a&quot;)
    } else {
        window.gm.printTalkLink(&quot;div#select10&quot;,&quot;div#choice10b&quot;)
    }
}
foo();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="127" name="DngNG_SpiderFlee" tags="_nosave_" position="850,1600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;div id=&#39;select10&#39; &gt;
&lt;/div&gt;&lt;div id=&#39;choice10a&#39; hidden&gt;&lt;/br&gt; Making a dash back where you came from, you &lt;a0 onclick=&quot;leave();&quot;&gt;leave&lt;/a&gt; the bot behind.
&lt;/div&gt;
&lt;div id=&#39;choice10b&#39; hidden&gt;&lt;/br&gt; Turning your back to the bot was a bad idea. It jumped on your back and dealt some damage to your clothing as it grabbed at you with its spindly legs.
&lt;/br&gt;Shaking it of, you &lt;a0 onclick=&quot;leave();&quot;&gt;dash&lt;/a&gt; away.
&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt; function foo(){
    var s = window.story.state,tmp=s.combat.tmp;
    if(tmp.now===window.passage.name) return;
    tmp.now=window.passage.name;
    var _dmg=0,_rng=_.random(0,100);
    if(_rng&gt;50) {
        window.gm.printTalkLink(&quot;div#select10&quot;,&quot;div#choice10a&quot;)
    } else {
        window.gm.printTalkLink(&quot;div#select10&quot;,&quot;div#choice10b&quot;)
    }
};
function leave(){
    window.gm.simpleCombatCleanup();
    window.story.show(window.gm.player.location);
};
foo();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="128" name="DngNG_SpiderLoss" tags="_nosave_" position="975,1600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;div id=&#39;select10&#39; &gt;
&lt;/div&gt;&lt;div id=&#39;choice10a&#39; hidden&gt;&lt;/br&gt;
- the bot fuses your bodycoat together, now you have a hooble dress/bitchsuite
&lt;/div&gt;
&lt;div id=&#39;choice10b&#39; hidden&gt;&lt;/br&gt; 
&lt;/div&gt;
As you topple down, you are trying to slink away. And as it seems the bot doesnt have any further interest in you and you might &lt;a0 onclick=&#39;leave()&#39;&gt;leave&lt;/a&gt;.
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;function foo(){
    var s = window.story.state,tmp=s.combat.tmp;
    if(tmp.now===window.passage.name) return;
    tmp.now=window.passage.name;
    var _dmg=0,_rng=_.random(0,100);
};
function leave(){
    window.gm.simpleCombatCleanup();
    window.story.show(window.gm.player.location);
};
foo();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="129" name="DngNG_SpiderVictory" tags="_nosave_" position="1100,1600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;div id=&#39;select10&#39; &gt;
&lt;/div&gt;&lt;div id=&#39;choice10a&#39; hidden&gt;&lt;/br&gt; As the bot hurries away, you notice it lost something that you collect as your prize: &lt;div id=&#39;output&#39;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#39;choice10b&#39; hidden&gt;&lt;/br&gt; 
&lt;/div&gt;
&lt;a0 onclick=&#39;leave()&#39;&gt;Leave the place&lt;/a&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;function foo(){
    var s = window.story.state,tmp=s.combat.tmp;
    if(tmp.now===window.passage.name) return;
    tmp.now=window.passage.name;
    var _dmg=0,_rng=_.random(0,100);
    if(_rng&gt;50) {
        window.gm.player.Inv.addItem(window.gm.ItemsLib.Gorb());
        window.gm.printTalkLink(&quot;div#select10&quot;,&quot;div#choice10a&quot;)
    } else {
        window.gm.printTalkLink(&quot;div#select10&quot;,&quot;div#choice10b&quot;)
    }
}
function leave(){
    window.gm.simpleCombatCleanup();
    window.story.show(window.story.state.DngSY.nextLocation)//window.gm.player.location);
}
foo();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="130" name="DogSit" tags="" position="1225,1600" size="100,100">&lt;script&gt;
//quest milestones
var qDogSitLib = [ [0,&#39;unknown&#39;],
    [0x100 , &#39;found dogsit annonce&#39; ],
    [0x200 , &#39;called phone, no answer&#39;],
    [0x300 , &#39;callback received, accepted offer&#39;],
    [0x310 , &#39;callback received, delayed decision&#39;],
    [0x400 , &#39;first visit at dogsit-center&#39;],
    [0x500 , &#39;interview run done&#39;],
    [0x550 , &#39;training run done&#39;],
    [0x600 , &#39;job offers lv1&#39;]
];&lt;/script&gt;</tw-passagedata><tw-passagedata pid="131" name="qDogSit_Status" tags="" position="100,1725" size="100,100">&lt;!--called  to print status---&gt;</tw-passagedata><tw-passagedata pid="132" name="Park_DogsitAd" tags="" position="225,1725" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;% window.gm.player.location=window.passage.name;
if(s.vars.qDogSit&lt;0x200){ s.vars.qDogSit=0x100; %&gt;
    A closer look on the paper reveals that it is an advertisment for an agency where you can rent people for dog-sitting.&lt;/br&gt;
    There is also a sidenote that new dog-sitters are hired and payed 20-100$ per hour.&lt;/br&gt;
    That sounds like easy money. Maybe you should call them and see if this is something for you.&lt;/br&gt;
    [[Call|Dogsit_FirstCall]]&lt;/br&gt;
&lt;%} else {%&gt;
    You already got the advertisment of the dog-sitting-agency.&lt;/br&gt;
    [[Call Dogsit|Dogsit_NewCall]]&lt;/br&gt;
&lt;% } %&gt;
[[Ignore the ad|Park]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="133" name="Dogsit_FirstCall" tags="" position="350,1725" size="100,100">&lt;section&gt;
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;% window.gm.player.location=window.passage.name;s.vars.qDogSit=0x200;%&gt;
Using the qr-scanner of your phone you scan the ad and start the call.&lt;/br&gt;
The ringing-sound is repeated several times but there is no one picking up the call.&lt;/br&gt;
After entering the number manually (just to make sure) you again got no connection.&lt;br&gt;
Darn. Maybe they are all busy caring for dogs. &lt;/br&gt;
[[Ignore the ad|Park]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt; 
&lt;/section&gt;</tw-passagedata><tw-passagedata pid="134" name="Dogsit_FirstCallBack" tags="" position="475,1725" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&quot;Yes hello here is Trisha from Dog-Sit-Agency.&quot; a female voice calls out.&lt;br&gt;
&quot;Im calling you back because your number was in our phones unanswered list.&quot; &lt;/br&gt;&lt;/br&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;Hello, I saw your ad and would like to ask about the job as a dog-sitter.&quot;&lt;/p&gt;&lt;/br&gt;
Todo: explain job&lt;/br&gt;
&quot;If you want to apply just come around at our shop at any time, ok?&quot;  &lt;/br&gt;
&lt;div id=&quot;choice&quot;&gt;
&lt;a href=&quot;javascript:void(0)&quot; id=&quot;yes&quot; onclick=&#39;choice(this,&quot;div#choice&quot;)&#39;&gt;Yes I will come by.&lt;/a&gt;&lt;/br&gt;
&lt;a href=&quot;javascript:void(0)&quot; id=&quot;no&quot; onclick=&#39;choice(this,&quot;div#choice&quot;)&#39;&gt;I not sure about this.&lt;/a&gt;&lt;/br&gt;
&lt;/div&gt;
[[Ignore the ad|&lt;%=window.gm.player.location%&gt;]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
function choice(elmt,replaceThis){
	var msg =&#39;&#39;;
	if(elmt.id===&quot;yes&quot;){
	window.story.state.vars.qDogSit=0x300;
	msg = &quot;You aggreed to visit them.&lt;/br&gt;&quot;;
	} else {
		window.story.state.vars.qDogSit=0x310;
		msg = &quot;You have to think about this. You can pay them a visit anyway.&lt;/br&gt;&quot;;
	}
	$(replaceThis).replaceWith(msg+window.gm.printPassageLink(&quot;Next&quot;,&quot;Kitchen&quot;));
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="135" name="Dogsit_Center" tags="" position="600,1725" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;% window.gm.player.location=window.passage.name;
if(s.vars.qDogSit&lt;0x400){ s.vars.qDogSit=0x400; %&gt;
&lt;!--intro--&gt;
Walking down the street you finally find the dogsit-center. Its located in the ground floor of an old appartment.
A small name plate showing the outline of a dog and a human states that you have found the dogsit-center.
&quot;Hello how may I help you?&quot; a friendly woman at the reception desk welcoms you as you push trough the entry door.
&lt;p class=&quot;tPC&quot;&gt;&quot;Hello, I&#39;m &lt;%=window.gm.player.name%&gt;. I called before because I saw your ad. &quot;&lt;/p&gt;
&quot;Ah, yes. I remember your call. You said you dont have much experience about dogsitting. 
Please go over there through this door. Micheal is there and he will take care.&quot;&lt;/br&gt;
[[Dogsit_Intro2]]&lt;/br&gt;
&lt;%} else {%&gt;
&lt;!--default--&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;Hi, Thrisha. How are you.&quot;&lt;/p&gt; 
&quot;Hi, &lt;%=window.gm.player.name%&gt;. Fine. Nice to meet you. Are you here for some job?&quot;&lt;/br&gt;
[[walk a dog|Dogsit_NewJob]]&lt;/br&gt;[[Dogsit_TalkTrisha]] [[Dogsit_TalkMichael]] &lt;/br&gt;
[[Home]]&lt;/br&gt;
&lt;%}%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="136" name="Dogsit_TalkTrisha" tags="_back_" position="725,1725" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;!--&lt;% window.gm.player.location=window.passage.name;%&gt;--&gt;
todo
[[Back|_back_]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="137" name="Dogsit_TalkMichael" tags="_back_" position="850,1725" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;!--&lt;% window.gm.player.location=window.passage.name;%&gt;--&gt;
todo
[[Back|_back_]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="138" name="Dogsit_NewCall" tags="" position="975,1725" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;!--&lt;% window.gm.player.location=window.passage.name;%&gt;--&gt;
Ask for a new job.
[[Ignore the ad|Park]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="139" name="Dogsit_NewJob" tags="_back_" position="1100,1725" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;!--&lt;% window.gm.player.location=window.passage.name;%&gt;--&gt;
&quot;Let&#39;s see if there what requests we have...&quot; Trisha starts working on the computer&lt;/br&gt;
&quot;Seems there is actually no request. I will message you if we get a new.&quot;

[[Lenny]] A playful and friendly corgi. 
[[Ole]] Golden Retriever. As a family dog this one should not cause much trouble.
[[Dotti]] Young Dalmatian female. Curious and lacks some obedience training.
[[Snow]] Husky-female. This breed needs a lot of action so you better get your workout dress. 
[[Klaus]] That doberman-stud isn&#39;t a easy one. He will question your role as a leader costantly.
[[Victor]] As a Great Dane this matured male is quite a large breed. While usually not the troublemaker, it could be quite difficult to get him in line should he act unruly.

[[None|_back_]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="140" name="qLaptop_Status" tags="" position="1225,1725" size="100,100">&lt;!--called  to print status---&gt;
&lt;li&gt;&lt;label&gt;&lt;input type=&quot;checkbox&quot; name=&quot;y&quot; value=&quot;x&quot; readonly disabled&gt;
&lt;%=function(){
    if(s.vars.qLaptop==0){
       return(&#39;Get a powerconverter for your laptop&#39;);
    } else {
        return(&#39;COMPLETED: Laptop working again&#39;);
    }
}()%&gt;
&lt;/label&gt;&lt;/li&gt;</tw-passagedata><tw-passagedata pid="141" name="_Laptop_" tags="_back_" position="100,1850" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
You seat yourself in front of the laptop. &lt;/br&gt;
&lt;%if(window.gm.quests.getMilestoneState(&quot;qFixLaptop&quot;).id&lt;1000){%&gt;
The battery has run out of power but the powerconverter is missing. You need to get a new one.&lt;/br&gt;
&lt;%} else if(window.gm.quests.getMilestoneState(&quot;qFixLaptop&quot;).id&gt;=1000){%&gt;
After pushing the powerbutton the pc takes ages to start.&lt;/br&gt;
todo mail,Browser&lt;/br&gt;
&lt;%}%&gt;
[[Back|_back_]]</tw-passagedata><tw-passagedata pid="142" name="Quayla_Meet1" tags="_nosave_" position="225,1850" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&quot;The heat is killing me. Cant you help me?&quot;
&quot;Heat, its not that hot around here...&quot;
&quot;No no, I&#39;m not talking about the temperature around here, the heat down there...&quot;
She is pointing down to her crotch where the fabric of her garments seems to be soaked with some fluid.
&quot;I&#39;m not sure what you expect from me? Cant you take care of it yourself?&quot;
&quot;I tried but its not working. Get me off got dammit&quot;
[[Nope]][[Yeah]]
&lt;if female gay++ else &quot;but dont even think to put your thingy in there, I&#39;m not planning to get pregnant now!&quot;&gt; 
You kneel before her and pull down her pants, the smell of her juices hits you.
As you exhale, the flow of air makes her shiver already.
...
&quot;NNgh, use your tongue - pleeasse&quot; she whines, the stimulation with your digits doesnt seem to be enough. 
You lick her clit and she harshly grabs your head, smoothering your face with her pussy.
Enduring the rough grinding you try your best to run your tongue around her pleasure valley. And soon your efforts earn you a shivering clench of her upper thights around the sides of your head and a generous faucet of her fem-lube in your face.
After a minute or so she releases her grip from the back of your head and looks aghast down at you and the mess she made.
&quot;I..I&#39;m really sorry, I didnt mean to force you...I didnt hurt you did I ?&quot;
&quot;No, I&#39;m fine. Didnt expect to get that messy too.&quot;
Quayla bites her lips as she notice her juices dripping down your nose lips and chin.
...
&quot;I just hope that doesnt cause you some trouble, for dear life, I couldnt forgive myself if I spread it to you.&quot;
&quot;Spreaded what?&quot; you ask bewildered.
&quot;Well that &#39;condition&#39; of me - its not in my nature. I had an argument with someone around here and in the end they, well, they put a spell on me because I didnt take on to their advances.&quot;
She knits her hands togehter while you process what you heard.
&quot;Wait, are we talking about being cursed? What exactly is this spell for.&quot;
&quot;Uuh cursed, thats a harsh word. He just said it would make me more aggreeable to advances from him or other males. And share the fun with other girls.&quot;
More than a little pissed you say &quot;God no, you are telling me you got cursed and you walk around spreading that curse to others.&quot;
&quot;Well, he didn&#39;t exactly say that I would pass it on.&quot;
Angry at the girl you stomp away. &#39;That girl is just nuts. I dont feel any different then before.&#39; you confidently think to yourself.
...
Later: your arousal increased; Oralfetish++
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="143" name="Marga_Info" tags="" position="350,1850" size="100,100">Margarethe bezeichnet sch selber als Enchanter-Scholar.
Sie verschlingt Bücher und untersucht magische Artefakte um herauszufinden wie man Verzauberungen selber herstellt.
Wie weit fortgeschritten sie ist, ist aber schwer einzuschätzen.</tw-passagedata><tw-passagedata pid="144" name="MargaCursedItemsTalk" tags="_nosave_" position="475,1850" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;% if(!window.gm.quests.hasActiveQuest(&quot;???&quot;) || window.gm.quests.getMilestoneState(&quot;???&quot;).id&lt;1){ 
    window.story.render(&quot;AlchTalkStartPurpleBerry&quot;); %&gt;
&lt;% } else if(window.gm.quests.getMilestoneState(&quot;???&quot;).id===1 &amp;&amp; window.gm.player.Inv.countItem(&quot;???&quot;)&gt;=5){ 
    window.story.render(&quot;AlchTalkFinishPurpleBerry&quot;); %&gt;
&lt;% }  else {%&gt; Margarethe seems busy right now. [[Back|SC_Library]] &lt;%}%&gt;&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="145" name="Marga_Librarian" tags="" position="600,1850" size="100,100">&quot;Oh, I know this and that about arcane arts. If you have some equipment that you are not sure what kind of magic trick it might hide, I can try to rveal it.
I might even be able to enhance its power - for a price and a risk.&quot;
&quot;What risk?&quot;
&quot;If I put a good amount of effort and resources in it, I might be able to improve a certain aspect. But this is quite a lengthy and expensive procedure.&quot;
&quot;With less sophisticated techniques you could get the same or even better results. But its also quite possible to accidently amplify an adverse effect.&quot;
&quot;So, more expenses means less risk for failure.&quot;
&quot;So lets say I have those boots here with some speed-bonus. Could you improve the bonus even further? And what would it cost me?&quot;
&quot;Depends on the level of enchantment the item already has. Lets say it has a Level 3 bonus. To enhance it to Lv4 in a failure-proof way, I would need a medium soulcrystal, 2 sulfur and 500gd.&quot;
&quot;If its already at Lv5, I would need a greater SoulCrystal, 3 sulfur, a blue pearl and 1000gd to make sure its enchanted to Lv6.&quot;
&quot;But if you give me free hand, I would gladly offer an option that also has the possibility to get a stronger enchantment with the smaller cost.&quot;
&quot;Its a win-win, well mostly. I have the possibility to improve my techniques and you might get a even better equipment.&quot;
...
&quot;Oh my, not again. I was pretty sure that this wouldnt occur again.&quot;
&quot;Happen again? Why didnt you warn me about this! I cant remove it.&quot;
&quot;I&#39;m sorry. There has to be a flaw in the item or the soulcrystal wasn&#39;t good enough.That created some resonance that after some time collapses and transmogrifys the item.&quot;
&quot;Or you have no idea what you are doing and have done a sloppy job! How do I get rid of this?&quot;
&quot;Whoa whoa.. keep calm. No reason to get enraged. &quot;
&quot;Now that I think about it. Items that change themself...in benefical ways...or not so benefical...that could be interesting.&quot;</tw-passagedata><tw-passagedata pid="146" name="MargaQuest" tags="" position="725,1850" size="100,100">&quot;Please bring me some item with a arcane trait. Something like a bracer that is magical reenforced.&quot;
&quot;What would I get for this?&quot;
&quot;My gratitude, really. I cant pay you right now in terms of money or arcana. But when I get some more knowledge about those enchants, I could create some of them myself and that would open up a lot possibilities to help you and me.&quot;
&quot;So I do the dirty work but might not get anything out of it?&quot;
&quot;I would owe you a favour. That could be much more valuable than some plain money, dont you think.&quot; she smiles at you.
&quot;How do I notice if an item has magic on it? Is it glowing blue or something like that.&quot;
&quot;Thats a good question. In fact I once had a dagger that glowed blue when a ham-sandwich was close to it. But often there are no so clear indicators for magical traits. I can feel if something is enchanted and you might be able to develop that sense too. In general the stronger the enchantment is that easier it is to recognize that there is something. Except if someone took some additional precautions to hide it.&quot;
---
&quot;So I found this. I&#39;m not sure but I think it has some magic on it.&quot;
&quot;I see.. yes there is something on it. Did you try to use it?&quot;
&quot;Actually not because I didn&#39;t like to take the risk to fetch another curse.&quot; you nestle at the collar around your neck.
&quot;Hmh, I will first have to determine what kind of magic trait is hidden there..please come back later, that will take some time.&quot; already deep in thought she walks away with the item
&quot;...and keep an eye out there for some more items like this.&quot;
---
&quot;That item you brought me has some magic on it that improves the perception of the wearer&quot;
&quot;Perception? You mean you can see like an eagle or hear like a cat?&quot;
&quot;Well, not as good as that, I assume. Someone would just be more attentive.&quot;
&quot;Thats interesting. Since you are done with your research can you give it back to me? It would be of good use for me.&quot;
&quot;Not yet. Determining the enchantment was only the first step. Now I want to try to improve it. That might indeed amplify the magnitude of the spell.&quot;
&quot;Fine. And then I can use it?&quot;
&quot;Oh yes. But I need some ingredients and tools for that and I would like to ask...&quot;
&quot;... if I can help you another time. Sigh. What do you need?&quot;
&quot;That5s so nice of you to offer your help. I would need some apoca-bloom and a soul-gem, the bigger the better. It should be at least of medium size.&quot;
&quot;I think I know where to find those flowers. But that other thing, I dont have a clue.&quot;</tw-passagedata><tw-passagedata pid="147" name="Help_Index" tags="_back_" position="850,1850" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
[[Back|_back_]]&lt;/br&gt;
Here you can find some information about the gameplay.&lt;/br&gt;
[[Your goal|Help_background]]&lt;/br&gt;
[[Basics|Help_Basics]]&lt;/br&gt;
[[What should I do, where should I go|Help_Quest]]&lt;/br&gt;
[[Im stuck!|Help_Fixes]]&lt;/br&gt;
[[Credits]]&lt;/br&gt;
[[Back|_back_]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="148" name="Help_background" tags="_back_" position="975,1850" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
TODO&lt;/br&gt;
&lt;/br&gt;[[Back|_back_]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="149" name="Help_Basics" tags="_back_" position="1100,1850" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;hr&gt;&lt;/br&gt;
&lt;hr&gt;&lt;/br&gt;Navigating the dungeon&lt;/br&gt;
&lt;hr&gt;&lt;/br&gt;Combat&lt;/br&gt;
TODO&lt;/br&gt;
&lt;hr&gt;&lt;/br&gt;Keyboardcontrols&lt;/br&gt;
Links that have [x] attached can be triggered by pressing key x on the keyboard.
&lt;/br&gt;&lt;hr&gt;&lt;/br&gt;[[Back|_back_]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="150" name="Help_backgroundold" tags="_back_" position="1225,1850" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
Your goal is - to save the earth.&lt;/br&gt;
No, just joking. You are far from a superhero and earth has so many serious problems, you cant do much about it.&lt;/br&gt;
If you can make a living for yourself and find friends then you are on a good way.&lt;/br&gt;  &lt;/br&gt;
Here is a task-list for you: &lt;/br&gt;
1. explore your surroundings to unlock new places and events&lt;/br&gt;
2. check your quest-log regulary&lt;/br&gt;
3. talk to others and help them to build your relationship and unlock content&lt;/br&gt;
4. find ways to earn money. Money can unlock things,you know? &lt;/br&gt;
5. dont eat yellow snow&lt;/br&gt;
&lt;/br&gt;
[[Back|_back_]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="151" name="Help_Basicsold" tags="_back_" position="100,1975" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
Real Life&lt;/br&gt;&lt;hr&gt;&lt;/br&gt;
For many activities you have to spend energy and time. F.e. walking into the city takes some time and effort.&lt;/br&gt;
Energy can be recovered by sleeping. Also some activities, food or drugs can restore energy.&lt;/br&gt;
Use the sleep-option in your own bedroom to rest.&lt;/br&gt;
&lt;/br&gt;Virtual Reallity&lt;/br&gt;&lt;hr&gt;&lt;/br&gt;
Leaving the VR is only possible at the spawn-points, and only if in freeplay. If there is some storyrelevant stage running, you cant leave.&lt;/br&gt;
Entering VR is also only possible if the story-stage is at a certain points and requires it or freeplay is on.&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;Combat&lt;/br&gt;&lt;hr&gt;&lt;/br&gt;
You defeat enemys by damaging their health. If you have the skill, you can tease them until they are to aroused to bother fighting.
Postbattle scenes might differ if the victor is excited !
For some actions you need energy, f.e. a heavy strike or blocking with shield. Energy is recovered slowly on each turn.
Will can be used to cast magic.
Be aware that running out of energy/will might get you in a weakened condition.
&lt;/br&gt;
[[Back|_back_]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="152" name="Help_Questold" tags="_back_" position="225,1975" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
For the beginning:
- you should receive game equipment after 2 days
- try to explore the college in the meantime and look around for a job.&lt;/br&gt;
[[Back|_back_]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="153" name="Help_Fixes" tags="_back_" position="350,1975" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
If you are stuck on a page and you cannot escape. Press this [[Button|NOP]] to get back to your Home.&lt;/br&gt;&lt;/br&gt;
If you are even unable to get to this page because you see a weird plain textmessage in your browser:&lt;/br&gt;
Im sorry but no one can help you. I will try to add some debug-log that shows some more information that you can send me.&lt;/br&gt;
Then I might be abel to backtrack the error.&lt;/br&gt;
[[Back|_back_]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="154" name="Credits" tags="_back_" position="475,1975" size="100,100">&lt;section&gt; &lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
Credits:&lt;/br&gt;

Icons &amp; Images:&lt;/br&gt;
https://game-icons.net/&lt;/br&gt;
https://www.svgrepo.com/&lt;/br&gt;
https://www.hiclipart.com/&lt;/br&gt;
https://pixabay.com/de/&lt;/br&gt;
https://www.klipartz.com/&lt;/br&gt;
https://www.vecteezy.com/&lt;/br&gt;

Artist I took inspiration on (list incomplete): &lt;/br&gt;
https://www.deviantart.com/undeadkitty13

[[Back|_back_]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="155" name="StartPage" tags="" position="600,1975" size="100,100">&lt;article&gt;
&lt;h1 align=&quot;center&quot;&gt;&lt;%=window.story.name%&gt; V&lt;%=window.gm.getSaveVersion().toString().replaceAll(&quot;,&quot;,&quot;.&quot;)%&gt;&lt;/h1&gt;
&lt;h1 align=&quot;center&quot;&gt;DISCLAIMER&lt;/h1&gt;
&lt;h2 align=&quot;center&quot;&gt;Warning: Adult content!&lt;/h2&gt;
&lt;hr&gt;
&lt;div align=&quot;center&quot;&gt;This is a work of fiction; any resemblance to actual persons, places, or events is unintended. All characters in the game are fictional too. All coincidence with reality is random.
All characters in this game are fictional and any similarities to any persons living or dead are purely coincidental.
All explicit images are performed by consenting adults aged 18 or older. Images are for illustrative purposes only.&lt;/div&gt;
&lt;hr&gt;&lt;hr&gt;
&lt;div align=&quot;center&quot;&gt;Are you 21+ years old and want to play?
&lt;a0 id=&#39;yes&#39; onclick=&#39;(function($event){document.querySelector(&quot;#&quot;+id+&quot;~p&quot;).toggleAttribute(&quot;hidden&quot;);})(this);&#39;&gt;YES&lt;/a&gt;
&lt;p hidden&gt;Are you sure? I mean really? There might be some sick shit going on here. I recommend to play safe and stay away.&lt;/br&gt;
    [[Get me out of here|StartPage]]  |  [[I&#39;m really sure I want to play this.|Intro]]
&lt;/p&gt;
&lt;a0 id=&#39;no&#39; onclick=&#39;(function($event){document.querySelector(&quot;#&quot;+id+&quot;~p&quot;).toggleAttribute(&quot;hidden&quot;);})(this);&#39;&gt;NO&lt;/a&gt;
&lt;p hidden&gt;Thats the right decission. Now close this window in your browser, just to be safe.&lt;/p&gt;
&lt;/div&gt;
&lt;hr&gt;
&lt;hr&gt;
&lt;div&gt;This game is powered by twine/tweego and snowman.&lt;img src=&quot;https://twinery.org/homepage/img/logo.svg&quot; width=&quot;32&quot; height=&quot;32&quot;&gt;&lt;/div&gt;
&lt;/article&gt;</tw-passagedata><tw-passagedata pid="156" name="List_Fetish" tags="_back_" position="725,1975" size="100,100">&lt;article&gt;
&lt;p class=&#39;author&#39;&gt;There is barely any lewd content right now. Those lists should just reflect what the game would contain if I ever get it done at least halfway.&lt;/p&gt;
&lt;h1 align=&quot;center&quot;&gt;Primary fetish&lt;/h1&gt;
Those are very present through the game and in the main-story (also check the settings in game to disable some of them):  &lt;/br&gt;
*  Hetero-, Bi-,Homo- and whatever-sexual;&lt;/br&gt;
*  Furries,Scalies and anything else known as anthro&lt;/br&gt;
*  Beastiality; If you dont know what this means, than you are completely wrong here and should leave immediatly!&lt;/br&gt;
*  Not-so-consent-sex, formerly known as rape&lt;/br&gt;
*  Size difference; (between certain body parts of interacting subjects; see previous points)&lt;/br&gt;
*  Enslavement/Submission and Domination&lt;/br&gt;
*  bondage and masochism&lt;/br&gt;
*  slithering, wriggling tentacles

&lt;h1 align=&quot;center&quot;&gt;Other fetish with rare occurence&lt;/h1&gt;
*  Milking&lt;/br&gt;
*  Egg-Laying&lt;/br&gt;
*  Orgasm denial&lt;/br&gt;
*  Latex-play&lt;/br&gt;
*  gender change&lt;/br&gt;
*  body-transformation&lt;/br&gt; 
*  Size-change (of certain body parts)&lt;/br&gt;
*  Dismembermend; some of your bodyparts have gone missing, we are sorry for the inconvienience&lt;/br&gt;
*  Parasite infestation&lt;/br&gt;

&lt;h1 align=&quot;center&quot;&gt;Fetish that might be added at some point&lt;/h1&gt;
*  Brainwash/Hypnotizing&lt;/br&gt;
*  Watersport&lt;/br&gt;
*  Death and suffering; &lt;/br&gt;

&lt;h1 align=&quot;center&quot;&gt;Things you will definitly not find here&lt;/h1&gt;
*  Scat&lt;/br&gt;
*  Diapers&lt;/br&gt;
*  Child porn&lt;/br&gt;
[[Back|_back_]]
&lt;/article&gt;</tw-passagedata><tw-passagedata pid="157" name="Intro_KH" tags="" position="850,1975" size="100,100">&lt;article&gt;&lt;%window.gm.initGame(true);window.gm.player.location=window.passage.name;%&gt;
&lt;p class=&#39;author&#39;&gt;You might see a lot of links that are formated red-strikethrough. Those are currently broken and you shouldnt use them.&lt;/p&gt;
&lt;p class=&quot;author&quot;&gt;Player name and start gender are currently unchangeable.&lt;/p&gt;
&lt;p class=&#39;author&#39;&gt;Loading of savegame is only possible in game. Saving might be disabled in some locations.&lt;/p&gt;
&lt;p class=&#39;author&#39;&gt;[[Fetishes ! (spoiler alert)|List_Fetish]]&lt;/p&gt;&lt;/br&gt;&lt;/br&gt;&lt;hr&gt;
&lt;p&gt;The count sent his men after you because you were poaching in his woods. Therefore, you left your home and fled to this remote place. A roadhouse stands not far from the crossroads. Maybe you can find shelter there for the time being. &lt;/p&gt;
&lt;p&gt;&lt;a0 onclick=&#39;start();&#39;&gt;Walk into the inn&lt;/a&gt;&lt;/p&gt;&lt;hr&gt;
&lt;/article&gt;
&lt;script&gt; function start(){
    window.story.state.DngSY.remainingNights=0,window.story.state.DngSY.dngLevel=0;
    window.story.state.vars.spawnAt=&quot;KH_NextDay&quot;;
    window.gm.enterVR();
    //window.gm.MutationsLib[&#39;swapGender&#39;](window.gm.player,window.storage.constructors[&quot;VulvaHuman&quot;]);
    window.gm.player.levelUp(5);window.gm.player.autoLeveling();
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="158" name="Intro" tags="" position="975,1975" size="100,100">&lt;article&gt;&lt;%window.gm.initGame(true);window.gm.player.location=window.passage.name;%&gt;
&lt;p class=&#39;author&#39;&gt;Note that there is no back-button implemented. Pressing the back button of your browser will get your game aborted.&lt;/br&gt;
You might see a lot of links that are formated red-strikethrough. Those are currently broken and you shouldnt use them.&lt;/p&gt;
&lt;p class=&#39;author&#39;&gt;Loading of savegame is only possible in game. Saving might be disabled in some locations.&lt;/p&gt;
&lt;p class=&#39;author&#39;&gt;[[Fetishes ! (spoiler alert)|List_Fetish]]&lt;/p&gt;&lt;/br&gt;&lt;/br&gt;&lt;hr&gt;
&lt;p&gt;This is a kind of remake of NightgamesMod. I wasnt able to mod it in Java, so I started from scratch. &lt;/br&gt;&lt;/p&gt;
&lt;p&gt;&lt;a0 onclick=&#39;start();&#39;&gt;Start&lt;/a&gt;&lt;/p&gt;&lt;hr&gt;
&lt;p&gt;&lt;a0 onclick=&#39;startRandom();&#39;&gt;random Dng&lt;/a&gt;
&lt;label&gt;length:
    &lt;select id=&quot;length&quot;&gt;
        &lt;option value=&quot;1&quot;&gt;1&lt;/option&gt;&lt;option value=&quot;2&quot; &gt;2&lt;/option&gt;&lt;option value=&quot;3&quot; &gt;3&lt;/option&gt;&lt;option value=&quot;4&quot; selected&gt;4&lt;/option&gt;
        &lt;option value=&quot;5&quot; &gt;5&lt;/option&gt;&lt;option value=&quot;6&quot; &gt;6&lt;/option&gt;&lt;option value=&quot;7&quot; &gt;7&lt;/option&gt;&lt;option value=&quot;8&quot; &gt;8&lt;/option&gt;
    &lt;/select&gt;
&lt;/label&gt;
&lt;label&gt;add doors:
    &lt;select id=&quot;extradoors&quot;&gt;
        &lt;option value=&quot;0&quot;&gt;0&lt;/option&gt;&lt;option value=&quot;1&quot; selected&gt;1&lt;/option&gt;&lt;option value=&quot;2&quot; &gt;2&lt;/option&gt;&lt;option value=&quot;3&quot; &gt;3&lt;/option&gt;&lt;option value=&quot;4&quot; &gt;4&lt;/option&gt;
    &lt;/select&gt;
&lt;/label&gt;
&lt;label&gt;naming:
    &lt;select id=&quot;naming&quot;&gt;
        &lt;option value=&quot;A1&quot; selected&gt;A1&lt;/option&gt;&lt;option value=&quot;-12_1&quot;&gt;-12_1&lt;/option&gt;&lt;option value=&quot;-12_+01&quot; &gt;-12_+01&lt;/option&gt;
    &lt;/select&gt;
&lt;/label&gt;&lt;/br&gt;
&lt;label&gt;branches:
    &lt;select id=&quot;branches&quot;&gt;
        &lt;option value=&quot;0&quot; selected&gt;0&lt;/option&gt;&lt;option value=&quot;1&quot;&gt;1&lt;/option&gt;&lt;option value=&quot;2&quot; &gt;2&lt;/option&gt;
    &lt;/select&gt;
&lt;/label&gt;
&lt;/p&gt;&lt;hr&gt;
&lt;hr&gt;&lt;div id=&#39;canvas&#39;style=&#39;max-height: 256px;overflow: auto;&#39;&gt;&lt;/div&gt;&lt;div id=&#39;svgpopup&#39;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;/article&gt;
&lt;script&gt; function start(){
    window.story.state.DngSY.remainingNights=0,window.story.state.DngSY.dngLevel=0;
    window.story.state.vars.spawnAt=&quot;DngNG_Home&quot;;
    window.gm.enterVR();
    window.gm.player.autoLeveling();
    window.gm.player.Outfit.removeItem(&quot;StaffWodden&quot;);window.gm.player.Inv.removeItem(&quot;StaffWodden&quot;);
}
function startRandom(){
    window.story.state.DngSY.remainingNights=0,window.story.state.DngSY.dngLevel=0;
    window.story.state.vars.spawnAt=&quot;DngNG_Home&quot;;
    var selLength=document.getElementById(&#39;length&#39;),selDoors=document.getElementById(&#39;extradoors&#39;),selName=document.getElementById(&#39;naming&#39;);
    var selBranches=document.getElementById(&#39;branches&#39;)
    var length=selLength.options[selLength.selectedIndex].value,doors=selDoors.options[selDoors.selectedIndex].value,naming=selName.options[selName.selectedIndex].value;
    var branches=selBranches.options[selBranches.selectedIndex].value;
    window.story.state.tmp = window.GenerateDng.DngGen.generate({length:length,doors:doors,naming:naming,branches:branches});
    window.gm.printMap2(window.story.state.tmp,&#39;&#39;,&#39;&#39;,null);
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="159" name="Intro_SY" tags="" position="1100,1975" size="100,100">&lt;article&gt;&lt;%window.gm.initGame(true);window.gm.player.location=window.passage.name;%&gt;
&lt;p class=&#39;author&#39;&gt;Note that there is no back-button implemented. Pressing the back button of your browser will get your game aborted.&lt;/br&gt;
You might see a lot of links that are formated red-strikethrough. Those are currently broken and you shouldnt use them.&lt;/p&gt;
&lt;p class=&quot;author&quot;&gt;Player name and start gender are currently unchangeable.&lt;/p&gt;
&lt;p class=&#39;author&#39;&gt;Loading of savegame is only possible in game. Saving might be disabled in some locations.&lt;/p&gt;
&lt;p class=&#39;author&#39;&gt;[[Fetishes ! (spoiler alert)|List_Fetish]]&lt;/p&gt;&lt;/br&gt;&lt;/br&gt;&lt;hr&gt;
&lt;p&gt;To avoid problems with the local law enforcement, you temporarily moved to another settlement. &lt;/br&gt;
As you look around for possible sources of income, e.g. stuff that someone carelessly leaves lying around, you also come across a temple of some sort.&lt;/br&gt; 
There you see interesting items - interesting for you because they look valuable and could easily be hidden in your pockets. &lt;/br&gt;
But the first thing you grab is a monk&#39;s robe drying on the line. That coarse cloak should help you to move through the temple without arousing suspicion.&lt;/br&gt; 
As you secure one shiny gadget, you trigger some magic anomaly... &lt;/br&gt;&lt;/p&gt;
&lt;p&gt;&lt;a0 onclick=&#39;startSY();&#39;&gt;That magic portal sucks you right in...wush (start SanctumPortal story)&lt;/a&gt;&lt;/p&gt;&lt;hr&gt;
&lt;p&gt;&lt;a0 onclick=&#39;startPC();&#39;&gt;start rougelite&lt;/a&gt;&lt;/p&gt;&lt;hr&gt;
&lt;p&gt;[[OmeterCombat]]&lt;/p&gt;&lt;hr&gt;
There are also some options to make a fastforward (might behave oddly): &lt;/br&gt;
&lt;/article&gt;
&lt;script&gt; function startSY(){
    window.story.state.DngSY.remainingNights=1;
    window.story.state.vars.spawnAt=&quot;DngSY_Your_Room&quot;;
    window.gm.enterVR();
    //window.gm.MutationsLib[&#39;swapGender&#39;](window.gm.player,window.storage.constructors[&quot;VulvaHuman&quot;]);
    window.gm.player.levelUp(5);window.gm.player.autoLeveling();
    window.story.state.DngSY.dngLevel=1;//todo
}
function startHC(){
    window.story.state.DngSY.remainingNights=0,window.story.state.DngSY.dngLevel=0;
    window.story.state.vars.spawnAt=&quot;DngHC_Entry&quot;;
    window.gm.enterVR();
    window.gm.quests.addQuest(&quot;qBlackCandle&quot;,1);window.gm.quests.addQuest(&quot;qDoorControl&quot;,1);
    //[&#39;qGetPierced&#39;,&#39;qFindCursed&#39;].foreach(x=&gt;window.gm.quests.addQuest(x,1));
    window.gm.player.levelUp(5);window.gm.player.autoLeveling();
}
function startPC(){
    window.story.state.DngSY.remainingNights=0,window.story.state.DngSY.dngLevel=0;
    window.story.state.vars.spawnAt=&quot;DngPC_Entry&quot;;
    window.gm.enterVR();
    window.gm.player.levelUp(5);window.gm.player.autoLeveling();
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="160" name="FF Endgame" tags="" position="1225,1975" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
This is for testing purpose with some configurable settings.
&lt;div&gt;&lt;/br&gt;[[Back|Intro]] &lt;a0 onclick=&#39;start();&#39;&gt;Start&lt;/a&gt;&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt; function start(){
    window.story.state.DngSY.remainingNights=1;
    window.story.state.vars.spawnAt=&quot;DngSY_Your_Room&quot;;
    window.gm.enterVR();
    //window.gm.MutationsLib[&#39;swapGender&#39;](window.gm.player,window.storage.constructors[&quot;VulvaHuman&quot;]);
    window.gm.player.levelUp(5);window.gm.player.autoLeveling();
    window.gm.player.Stats.increment(&quot;savagenessMax&quot;,100);
    window.story.state.DngSY.dngLevel=10;//todo
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="161" name="Intro_DLC" tags="" position="100,2100" size="100,100">&lt;article&gt;&lt;%window.gm.initGame(true);window.gm.player.location=window.passage.name;%&gt;
&lt;p&gt;Welcome to Meason, a town somewhere in these days. &lt;/br&gt;
You are a student in the local university and live in a shared house with some other fellows. &lt;/br&gt;&lt;/p&gt;
&lt;p class=&#39;author&#39;&gt;You might see a lot of links that are formated red-strikethrough. Those are currently broken and you shouldnt use them.&lt;/p&gt;
&lt;/br&gt;Press [[Start|Intro2]] to enter the game. 
&lt;p class=&quot;author&quot;&gt;Please note: player name and start gender are currently unchangeable.&lt;/p&gt;
&lt;p class=&#39;author&#39;&gt;Loading of savegame is only possible in game.&lt;/p&gt;
There are also some options to make a fastforward (might behave oddly): &lt;/br&gt;
[[FF VR Character creation]] &lt;/br&gt;
[[FF before the bridge]]&lt;/br&gt;
[[FF Bridge passage unlocked]]&lt;/br&gt;
debug only! :&lt;/br&gt;
[[FF WolfVictory]]&lt;/br&gt;
[[FF TestArena]]&lt;/br&gt;
&lt;/article&gt;</tw-passagedata><tw-passagedata pid="162" name="Intro2" tags="" position="225,2100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
Here you are: a student sitting in your dorm, working on the laptop in front.
Progress in studys isnt going as smooth as expected.&lt;/br&gt;
To divert yourself, you decide to check your emails. 
&lt;div&gt;&lt;/br&gt;
[[Next|GameInvite]]&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="163" name="FF VR Character creation" tags="" position="350,2100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
Start at the character creation screen in the VR-game.
&lt;div&gt;&lt;/br&gt;[[Back|Intro]] &lt;a0 onclick=&#39;start();window.story.show(&quot;CharacterEditor&quot;);&#39;&gt;Start&lt;/a&gt;&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt; function start(){
    window.gm.quests.addQuest(&quot;qDLCMain&quot;,1);
    window.gm.quests.addQuest(&quot;qDiedAgain&quot;,1);
    window.gm.quests.addQuest(&quot;qFixLaptop&quot;,1);
    window.gm.quests.addQuest(&quot;qBeastKink&quot;,1);
    window.gm.quests.addQuest(&quot;qBondageKink&quot;,1);
    window.gm.quests.forceQuestMilestone(&quot;qDLCMain&quot;,600,1);
    window.gm.quests.forceQuestMilestone(&quot;qFixLaptop&quot;,1000,1);
    window.gm.enterVR();
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="164" name="FF before the bridge" tags="" position="475,2100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
Start at forest with introductory quest done so far. Roam around and prepare to defeat bridge boss.
&lt;div&gt;&lt;/br&gt;[[Back|Intro]] &lt;a0 onclick=&#39;start();window.story.show(&quot;ForestSpawn&quot;);&#39;&gt;Start&lt;/a&gt;&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt; function start(){
    window.gm.quests.addQuest(&quot;qBeastKink&quot;,1);
    window.gm.quests.addQuest(&quot;qBondageKink&quot;,200);
    window.gm.quests.addQuest(&quot;qDLCMain&quot;,600);
    window.gm.quests.addQuest(&quot;qFixLaptop&quot;,1000);
    window.gm.quests.addQuest(&quot;qDiedAgain&quot;,300);    //?? 100
    window.gm.quests.addQuest(&quot;qPurpleBerry&quot;,100);
    window.gm.enterVR();
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="165" name="FF Bridge passage unlocked" tags="" position="600,2100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
You can now pass the bridge and leave the forest.
&lt;div&gt;&lt;/br&gt;[[Back|Intro]] &lt;a0 onclick=&#39;start();window.story.show(&quot;ForestBridge&quot;);&#39;&gt;Start&lt;/a&gt;&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt; function start(){
    window.gm.quests.addQuest(&quot;qBeastKink&quot;,1);
    window.gm.quests.addQuest(&quot;qBondageKink&quot;,400);
    window.gm.quests.addQuest(&quot;qDLCMain&quot;,600);
    window.gm.quests.addQuest(&quot;qFixLaptop&quot;,1000);
    window.gm.quests.addQuest(&quot;qDiedAgain&quot;,300);
    window.gm.quests.addQuest(&quot;qPurpleBerry&quot;,100);
    window.gm.enterVR();
    window.gm.player.Outfit.addItem(new window.gm.ItemsLib[&quot;CollarQuest&quot;]());
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="166" name="FF WolfVictory" tags="" position="725,2100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
&lt;div&gt;&lt;/br&gt;[[Back|Intro]] &lt;a0 onclick=&#39;start();window.story.show(&quot;WolfVictory&quot;);&#39;&gt;Start&lt;/a&gt;&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt; function start(){
    window.gm.quests.addQuest(&quot;qBeastKink&quot;,1);
    window.gm.quests.addQuest(&quot;qBondageKink&quot;,400);
    window.gm.quests.addQuest(&quot;qDLCMain&quot;,600);
    window.gm.quests.addQuest(&quot;qFixLaptop&quot;,1000);
    window.gm.quests.addQuest(&quot;qDiedAgain&quot;,300);
    window.gm.quests.addQuest(&quot;qPurpleBerry&quot;,100);
    window.gm.enterVR();
    window.gm.MutationsLib[&#39;swapGender&#39;](window.gm.player,window.storage.constructors[&quot;VulvaHuman&quot;]);
    window.gm.player.addEffect(new window.storage.constructors[&#39;effLewdMark&#39;](),&#39;effLewdMark&#39;);
    window.gm.player.Stats.increment(&quot;arousal&quot;,50);
    var mob = window.gm.Mobs.Wolf();
    window.story.state.combat.enemyParty[0]=mob;
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="167" name="FF TestArena" tags="" position="850,2100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
Enter the Grind-geon.
&lt;div&gt;&lt;/br&gt;[[Back|Intro]] &lt;a0 onclick=&#39;start();&#39;&gt;Start&lt;/a&gt;&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt; function start(){
    window.story.state.vars.spawnAt=&quot;AM_Lv2_Start&quot;;
    window.gm.enterVR();
    window.gm.player.levelUp(2);window.gm.player.autoLeveling();//todo else its to difficult against wolf
    window.gm.MutationsLib[&#39;swapGender&#39;](window.gm.player,window.storage.constructors[&quot;PenisHuman&quot;]);
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="168" name="Laptop-PS" tags="" position="975,2100" size="100,100">A powersupply for a laptop.
[[Back|&lt;%=window.gm.player.location%&gt;]]</tw-passagedata><tw-passagedata pid="169" name="DngAT_MAP" tags="_back_" position="1100,2100" size="100,100">&lt;hr&gt;&lt;div id=&#39;canvas&#39;&gt;&lt;/div&gt;&lt;div id=&#39;svgpopup&#39;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;script&gt; window.gm.printMap2(window.story.state.DngSY.dngMap,window.gm.player.location.replace(window.story.state.DngSY.dng+&#39;_&#39;,&#39;&#39;),
    window.story.state.DngAT.mapReveal,window.story.state.DngAT.visitedTiles);
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="170" name="DngAT_Entry" tags="" position="1225,2100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
TODO Through the portal you arrive at a dark and eerie underground location.
&lt;/br&gt;&lt;p&gt; [[Next|DngAT_J6]] &lt;/br&gt;&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
function buildRooms(){
    const _m=[
        &#39;    H2--I2--J2        &#39;,
        &#39;    |       |         &#39;,
        &#39;    H3  I3--J3--K3    &#39;,
        &#39;    |   |       |     &#39;,
        &#39;G4--H4--I4      K4    &#39;,
        &#39;    |           |     &#39;,
        &#39;    H5--I5--J5--K5--L5&#39;,
        &#39;                    | &#39;,
        &#39;            J6--K6--L6&#39;];
    let grid =[
    {room:&#39;H2&#39;, dirs:[&#39;H3&#39;,&#39;I2&#39;]},
    {room:&#39;I2&#39;, dirs:[&#39;H2&#39;,&#39;J2&#39;]},
    {room:&#39;J2&#39;, dirs:[&#39;I2&#39;,&#39;J3&#39;]},
    {room:&#39;H3&#39;, dirs:[&#39;H2&#39;,&#39;H4&#39;]},
    {room:&#39;I3&#39;, dirs:[&#39;I4&#39;,&#39;J3&#39;],anno:[&#39;X&#39;]},
    {room:&#39;J3&#39;, dirs:[&#39;I3&#39;,&#39;K3&#39;,&#39;J2&#39;]},
    {room:&#39;K3&#39;, dirs:[&#39;J3&#39;,&#39;K4&#39;]},
    {room:&#39;G4&#39;, dirs:[&#39;H4&#39;]},
    {room:&#39;H4&#39;, dirs:[&#39;G4&#39;,&#39;I4&#39;,&#39;H5&#39;,&#39;H3&#39;]},
    {room:&#39;I4&#39;, dirs:[&#39;H4&#39;,&#39;I3&#39;]},
    {room:&#39;K4&#39;, dirs:[&#39;K3&#39;,&#39;K5&#39;]},
    {room:&#39;H5&#39;, dirs:[&#39;H4&#39;,&#39;I5&#39;]},
    {room:&#39;I5&#39;, dirs:[&#39;H5&#39;,&#39;J5&#39;]},
    {room:&#39;J5&#39;, dirs:[&#39;I5&#39;,&#39;K5&#39;]},
    {room:&#39;K5&#39;, dirs:[&#39;J5&#39;, &#39;K4&#39;,&#39;L5&#39;]},
    {room:&#39;L5&#39;, dirs:[&#39;K5&#39;]},
    {room:&#39;J6&#39;, dirs:[&#39;K6&#39;],anno:[&#39;E&#39;]},
    {room:&#39;K6&#39;, dirs:[&#39;L6&#39;,&#39;J6&#39;]},
    {room:&#39;L6&#39;, dirs:[&#39;L5&#39;,&#39;K6&#39;]}];
    let dng={grid:grid,width:14,height:8}
    window.story.state.DngSY.dngMap=dng;
    window.story.state.DngAT.visitedTiles=[],
    window.story.state.DngAT.mapReveal=[&#39;I3&#39;];
    window.story.state.DngAT.tmp.graph=window.gm.gridToGraph(grid);
    //let start = new window.GraphNode({name:&quot;I3&quot;}), end = new window.GraphNode({name:&quot;H2&quot;}),path = window.astar.search(window.story.state.DngAT.tmp.graph,start,end,null,{heuristic:(function(a,b){return(1);})})
    /*let graph = new window.Graph(grid); todo:grid not compatible
    graph.neighbors=function(node){return(node.origNode.dirs); };
    window.story.state.DngAT.tmp.graph=graph;
    let start = new window.GraphNode(grid[0]), end = new window.GraphNode(grid=[3]),path = window.astar.search(graph,start,end,null,{heuristic:(function(a,b){return(1);})});*/
}
    var s = window.story.state;
    s.DngSY.dng=&#39;DngAT&#39;;
    s.vars.spawnAt=&quot;DngSY_Recover_Death&quot;;
    s.DngAT.tmp.guard1Here=s.DngAT.tmp.guard2Here=&#39;&#39;;s.DngAT.tmp.gotRing=0;s.DngSY.dngLevel===6;
    s.DngAT.leverG4=false;
    buildRooms();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="171" name="DngAT_Encounters" tags="" position="100,2225" size="100,100">&lt;script&gt;
function tick(){
    let here = window.passage.name,_d=window.story.state.DngAT.tmp;
    if(here===_d.tickPass) return;
    _d.tickPass=here;
    if(here===&#39;DngAT_&#39;+_d.guard1Here || here===&#39;DngAT_&#39;+_d.guard2Here){fightGuardian(); return;} 
    if(_d.guard1Here!==&#39;&#39;){
        var _go=&#39;I4&#39;;
        switch(_d.guard1Here){ //move guard
            case &#39;I4&#39;:  _go=&#39;I3&#39;; break;
            case &#39;I3&#39;:  _go=&#39;J3&#39;; break;
            case &#39;J3&#39;:  _go=&#39;J2&#39;; break;
            case &#39;J2&#39;:  _go=&#39;I2&#39;; break;
            case &#39;I2&#39;:  _go=&#39;H2&#39;; break;
            case &#39;H2&#39;:  _go=&#39;H3&#39;; break;
            case &#39;H3&#39;:  _go=&#39;H4&#39;; break;
            case &#39;H4&#39;:  _go=&#39;H5&#39;; break;
            case &#39;H5&#39;:  _go=&#39;I5&#39;; break;
            case &#39;I5&#39;:  _go=&#39;J5&#39;; break;
            default: 
        }
        _d.guard1Here=_go;
        document.getElementById(&#39;panel&#39;).textContent+=&quot;You hear strange noises from &quot;+_go+&quot;.\n&quot;;
    }
    if(_d.guard2Here!==&#39;&#39;){
        var _go=&#39;J6&#39;;
        switch(_d.guard2Here){ //move guard
            case &#39;J6&#39;:  _go=&#39;K6&#39;; break;
            case &#39;K6&#39;:  _go=&#39;L6&#39;; break;
            case &#39;L6&#39;:  _go=&#39;L5&#39;; break;
            case &#39;L5&#39;:  _go=&#39;K5&#39;; break;
            case &#39;K5&#39;:  _go=&#39;J5&#39;; break;
            default: 
        }
        _d.guard2Here=_go;
        document.getElementById(&#39;panel&#39;).textContent+=&quot;You hear strange noises from &quot;+_go+&quot;.\n&quot;;
    }
    if(here===&#39;DngAT_&#39;+_d.guard1Here || here===&#39;DngAT_&#39;+_d.guard2Here){fightGuardian(); return;} 
}
function fightGuardian(){
    window.gm.encounters.mechanicguy({amount:1, noStart:true});
    window.gm.Encounter.initCombat();
}
tick();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="172" name="DngAT_H2" tags="" position="225,2225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
A dark, eerie tunnel in an old temple. 
&lt;/br&gt;&lt;p&gt;&lt;%=window.gm.printNav(&#39;Go north&#39;,&#39;north&#39;)%&gt;&lt;/br&gt;&lt;%=window.gm.printNav(&#39;Go west&#39;,&#39;west&#39;)%&gt;&lt;%=window.gm.printNav(&#39;Go east&#39;,&#39;east&#39;)%&gt;&lt;/br&gt;&lt;%=window.gm.printNav(&#39;Go south&#39;,&#39;south&#39;)%&gt;&lt;/br&gt;&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngAT_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="173" name="DngAT_I2" tags="" position="350,2225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;%if(window.story.state.DngAT.tmp.gotRing &amp;&amp; window.story.state.DngAT.tmp.guard1Here===&#39;&#39;){ window.story.state.DngAT.tmp.guard1Here=&#39;I4&#39;; %&gt;
    As you make your way through the tunnel, you here some crunching noises like those of breaking rocks. At first you imagine that the hallways are coming down and will bury you alive. 
    But the crumbling sound soon stops. You listen carefully.
    You can now hear some rythmical thuds. They come evenly but slow and might getting louder. 
    &lt;p class=&quot;tPC&quot;&gt;&quot;Those arent footsteps, are they? Maybe that is the guardian of this place. I should get the heck out of here.&quot;&lt;/p&gt;
&lt;%}else{%&gt;
    A dark, eerie tunnel in an old temple. 
&lt;%}%&gt;
&lt;/br&gt;&lt;p&gt; &lt;%=window.gm.printNav(&#39;Go west&#39;,&#39;west&#39;)%&gt;&lt;%=window.gm.printNav(&#39;Go east&#39;,&#39;east&#39;)%&gt;&lt;/br&gt;&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngAT_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="174" name="DngAT_J2" tags="" position="475,2225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
A dark, eerie tunnel in an old temple. 
&lt;/br&gt;&lt;p&gt; &lt;%=window.gm.printNav(&#39;Go north&#39;,&#39;north&#39;)%&gt;&lt;/br&gt;&lt;%=window.gm.printNav(&#39;Go west&#39;,&#39;west&#39;)%&gt;&lt;%=window.gm.printNav(&#39;Go east&#39;,&#39;east&#39;)%&gt;&lt;/br&gt;&lt;%=window.gm.printNav(&#39;Go south&#39;,&#39;south&#39;)%&gt;&lt;/br&gt;&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngAT_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="175" name="DngAT_H3" tags="" position="600,2225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
A dark, eerie tunnel in an old temple. 
&lt;/br&gt;&lt;p&gt; &lt;%=window.gm.printNav(&#39;Go north&#39;,&#39;north&#39;)%&gt;&lt;/br&gt;&lt;%=window.gm.printNav(&#39;Go south&#39;,&#39;south&#39;)%&gt;&lt;/br&gt;&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngAT_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="176" name="DngAT_I3" tags="" position="725,2225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
This has to be the central chaber of the temple.
&lt;%if(window.story.state.DngAT.tmp.gotRing===0){%&gt;
    You notice a glint on a stone cuboid that might be used as a desk for some rite. The glint comes from a metal ring placed in a depression in the front of the slab.&lt;/br&gt;
    &lt;p class=&quot;tPC&quot;&gt;&#39;Is this the ring? Whose fingers would fit such a ring?&#39;&lt;/p&gt;
    This is indeed not a ring to be worn on a human finger. Its diameter is nearly the size of your palm.&lt;/br&gt; 
    &lt;div id=&#39;select1&#39; &gt;
    &lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;)&#39;&gt;Pull the ring from the cavity&lt;/a&gt;
    &lt;/br&gt;&lt;p&gt; &lt;%=window.gm.printNav(&#39;Go east&#39;,&#39;east&#39;)%&gt;&lt;/br&gt;&lt;%=window.gm.printNav(&#39;Go south&#39;,&#39;south&#39;)%&gt;&lt;/br&gt;&lt;/p&gt;
    &lt;/div&gt;&lt;div id=&#39;choice1a&#39; hidden&gt;
    Its not that difficult to get the ring moving, a careful punch is enough to loosen it.&lt;/br&gt; 
    You try to catch it as it drops from the cavity. But you cant hold it. With a loud clang it hits the ground.&lt;/br&gt;
    &lt;p class=&quot;tPC&quot;&gt;&#39;Whew, quite heavy for its size. Maybe thats the reason its called ring of burden&#39;&lt;/p&gt;
    &lt;div id=&#39;select2&#39; &gt; With some hassle you
    &lt;a0 onclick=&#39;window.story.state.DngAT.tmp.gotRing=1;window.gm.printTalkLink(&quot;div#select2&quot;,&quot;div#choice2a&quot;)&#39;&gt;pocket&lt;/a&gt; the ring.
    &lt;/div&gt;&lt;div id=&#39;choice2a&#39; hidden&gt;
    &lt;/br&gt; Just now you notice that sound of stone sliding over stone.
    &lt;p class=&quot;tPC&quot;&gt;&#39;Shit that door is closing! I need to get out of here.&#39;&lt;/p&gt;
    [[Run|DngAT_I3]]
    &lt;/div&gt;
    &lt;/div&gt;
&lt;%}else{%&gt;
    &lt;/br&gt; You already have the ring. Now better leave this place before it is to late.&lt;/br&gt;
    The door in south direction is already closed. Lets just hope you arent already trapped.
    &lt;/br&gt;&lt;p&gt; &lt;%=window.gm.printNav(&#39;Go east&#39;,&#39;east&#39;)%&gt;&lt;/br&gt;&lt;/p&gt;
&lt;%}%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngAT_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="177" name="DngAT_J3" tags="" position="850,2225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
This is a crossroad.
&lt;%if(window.story.state.DngAT.tmp.gotRing===0){%&gt;
&lt;/br&gt;&lt;p&gt; &lt;%=window.gm.printNav(&#39;Go north&#39;,&#39;north&#39;)%&gt;&lt;/br&gt;&lt;%=window.gm.printNav(&#39;Go west&#39;,&#39;west&#39;)%&gt;&lt;%=window.gm.printNav(&#39;Go east&#39;,&#39;east&#39;)%&gt;&lt;/br&gt;&lt;%=window.gm.printNav(&#39;Go south&#39;,&#39;south&#39;)%&gt;&lt;/br&gt;&lt;/p&gt;
&lt;%}else{%&gt;
&lt;p class=&quot;tPC&quot;&gt;&#39;Damn, there is now a closed door too. Wasn&#39;t that the shortest path to the portal?&#39;&lt;/p&gt;
&lt;/br&gt;&lt;p&gt; &lt;%=window.gm.printNav(&#39;Go north&#39;,&#39;north&#39;)%&gt;&lt;/br&gt;&lt;%=window.gm.printNav(&#39;Go west&#39;,&#39;west&#39;)%&gt;&lt;/br&gt;&lt;%=window.gm.printNav(&#39;Go south&#39;,&#39;south&#39;)%&gt;&lt;/br&gt;&lt;/p&gt;
&lt;%}%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngAT_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="178" name="DngAT_K3" tags="" position="975,2225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
A dark, eerie tunnel in an old temple. &lt;/br&gt;
There is a 

&lt;/br&gt;&lt;p&gt; &lt;%=window.gm.printNav(&#39;Go north&#39;,&#39;north&#39;)%&gt;&lt;/br&gt;&lt;%=window.gm.printNav(&#39;Go west&#39;,&#39;west&#39;)%&gt;&lt;%=window.gm.printNav(&#39;Go east&#39;,&#39;east&#39;)%&gt;&lt;/br&gt;&lt;%=window.gm.printNav(&#39;Go south&#39;,&#39;south&#39;)%&gt;&lt;/br&gt;&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngAT_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="179" name="DngAT_G4" tags="" position="1100,2225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
This is a dead end, but there is a lever. Should you pull that?&lt;/br&gt;
&lt;div id=&#39;select1&#39; &gt;
The lever is currently &lt;%=(!window.story.state.DngAT.leverG4)?&#39;not&#39;:&#39;&#39;%&gt; pulled.&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;)&#39;&gt;Pull it&lt;/a&gt;
&lt;/div&gt;&lt;div id=&#39;choice1a&#39; hidden&gt;
    You pull the lever.
    &lt;%if(window.story.state.DngAT.tmp.gotRing===1){ window.story.state.DngAT.leverG4=!window.story.state.DngAT.leverG4; %&gt;
        Nothing seems to happen but you can hear some screeching noise further down the cooridor.
    &lt;%}else{%&gt;
        You listen silently but you cant hear anything unusual. Maybe the lever doesnt work?
    &lt;%}%&gt;
&lt;/div&gt;
&lt;/br&gt;&lt;p&gt; &lt;%=window.gm.printNav(&#39;Go north&#39;,&#39;north&#39;)%&gt;&lt;/br&gt;&lt;%=window.gm.printNav(&#39;Go west&#39;,&#39;west&#39;)%&gt;&lt;%=window.gm.printNav(&#39;Go east&#39;,&#39;east&#39;)%&gt;&lt;/br&gt;&lt;%=window.gm.printNav(&#39;Go south&#39;,&#39;south&#39;)%&gt;&lt;/br&gt;&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngAT_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="180" name="DngAT_H4" tags="" position="1225,2225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
A dark, eerie tunnel in an old temple. 
&lt;/br&gt;&lt;p&gt; &lt;%=window.gm.printNav()%&gt;&lt;/br&gt;&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngAT_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="181" name="DngAT_I4" tags="" position="100,2350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;%if(window.story.state.DngAT.tmp.gotRing===0){%&gt;
&lt;/br&gt;&lt;p&gt; &lt;%=window.gm.printNav(&#39;Go north&#39;,&#39;north&#39;)%&gt;&lt;/br&gt;&lt;%=window.gm.printNav(&#39;Go west&#39;,&#39;west&#39;)%&gt;&lt;/p&gt;
&lt;%}else{%&gt;
The door into the chamber is closed shut.
&lt;/br&gt;&lt;p&gt;&lt;%=window.gm.printNav(&#39;Go west&#39;,&#39;west&#39;)%&gt;&lt;/br&gt;&lt;/p&gt;
&lt;%}%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngAT_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="182" name="DngAT_K4" tags="" position="225,2350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
A dark, eerie tunnel in an old temple. 
&lt;/br&gt;&lt;p&gt; &lt;%=window.gm.printNav(&#39;Go north&#39;,&#39;north&#39;)%&gt;&lt;/br&gt;&lt;%=window.gm.printNav(&#39;Go east&#39;,&#39;east&#39;)%&gt;&lt;/br&gt;&lt;%=window.gm.printNav(&#39;Go south&#39;,&#39;south&#39;)%&gt;&lt;/br&gt;&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngAT_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="183" name="DngAT_H5" tags="" position="350,2350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
A dark, eerie tunnel in an old temple. 
&lt;/br&gt;&lt;p&gt; &lt;%=window.gm.printNav(&#39;Go north&#39;,&#39;north&#39;)%&gt;&lt;/br&gt;&lt;%=window.gm.printNav(&#39;Go west&#39;,&#39;west&#39;)%&gt;&lt;%=window.gm.printNav(&#39;Go east&#39;,&#39;east&#39;)%&gt;&lt;/br&gt;&lt;%=window.gm.printNav(&#39;Go south&#39;,&#39;south&#39;)%&gt;&lt;/br&gt;&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngAT_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="184" name="DngAT_I5" tags="" position="475,2350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
A dark, eerie tunnel in an old temple. &lt;/br&gt;
&lt;%if(window.story.state.DngAT.tmp.gotRing===1 &amp;&amp; !window.story.state.DngAT.leverG4){%&gt;
    &lt;p class=&quot;tPC&quot;&gt;&#39;Damit, another door closed shut! Wasnt there a lever hidden? Maybe that is opening the door.&#39;&lt;/p&gt;
    &lt;/br&gt;&lt;p&gt; &lt;%=window.gm.printNav(&#39;Go west&#39;,&#39;west&#39;)%&gt;&lt;/p&gt;
&lt;%}else{%&gt;
    There is an old door made of bronze, standing invitingly open.
    &lt;/br&gt;&lt;p&gt; &lt;%=window.gm.printNav(&#39;Go west&#39;,&#39;west&#39;)%&gt;&lt;%=window.gm.printNav(&#39;Go east&#39;,&#39;east&#39;)%&gt;&lt;/br&gt;&lt;/p&gt;
&lt;%}%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngAT_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="185" name="DngAT_J5" tags="" position="600,2350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
The tunnel opens up on one side to a large window. There is a bottomless abyss and beyond that you can spot the entry where you came from. 
&lt;%if(window.story.state.DngAT.tmp.gotRing===1){%&gt;
    &lt;p class=&quot;tPC&quot;&gt;&#39;I can see the portal from here. Damn it&#39;s so close but I have to walk detour to get there.&#39;&lt;/p&gt;
&lt;%}%&gt; 
&lt;%if(window.story.state.DngAT.tmp.gotRing &amp;&amp; window.story.state.DngAT.tmp.guard2Here===&#39;&#39;){ window.story.state.DngAT.tmp.guard2Here=&#39;J6&#39;; %&gt;
    You spot a glimpse of something moving from the room with portal further down the tunnels.&lt;p class=&quot;tPC&quot;&gt;&#39;Damit there is something behind me and in front of me. I need to find somewhere to hide or bypass.&#39;&lt;/p&gt;
&lt;%}%&gt;
&lt;/br&gt;&lt;p&gt; &lt;%=window.gm.printNav(&#39;Go north&#39;,&#39;north&#39;)%&gt;&lt;/br&gt;&lt;%=window.gm.printNav(&#39;Go west&#39;,&#39;west&#39;)%&gt;&lt;%=window.gm.printNav(&#39;Go east&#39;,&#39;east&#39;)%&gt;&lt;/br&gt;&lt;%=window.gm.printNav(&#39;Go south&#39;,&#39;south&#39;)%&gt;&lt;/br&gt;&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngAT_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="186" name="DngAT_K5" tags="" position="725,2350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
A dark, eerie tunnel in an old temple. 
&lt;/br&gt;&lt;p&gt; &lt;%=window.gm.printNav(&#39;Go north&#39;,&#39;north&#39;)%&gt;&lt;/br&gt;&lt;%=window.gm.printNav(&#39;Go west&#39;,&#39;west&#39;)%&gt;&lt;%=window.gm.printNav(&#39;Go east&#39;,&#39;east&#39;)%&gt;&lt;/br&gt;&lt;%=window.gm.printNav(&#39;Go south&#39;,&#39;south&#39;)%&gt;&lt;/br&gt;&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngAT_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="187" name="DngAT_L5" tags="" position="850,2350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
A dark, eerie tunnel in an old temple. 
&lt;/br&gt;&lt;p&gt; &lt;%=window.gm.printNav(&#39;Go north&#39;,&#39;north&#39;)%&gt;&lt;/br&gt;&lt;%=window.gm.printNav(&#39;Go west&#39;,&#39;west&#39;)%&gt;&lt;%=window.gm.printNav(&#39;Go east&#39;,&#39;east&#39;)%&gt;&lt;/br&gt;&lt;%=window.gm.printNav(&#39;Go south&#39;,&#39;south&#39;)%&gt;&lt;/br&gt;&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngAT_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="188" name="DngAT_J6" tags="" position="975,2350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;%if(window.story.state.DngAT.tmp.gotRing===1){%&gt;
    &lt;p class=&quot;tPC&quot;&gt;&#39;Thank gods, there is the portal. I need to hurry.&#39;&lt;/p&gt;
    &lt;p&gt;[[Into the portal|DngAT_Success]] &lt;/br&gt;&lt;/p&gt;
&lt;%}else{%&gt;
    There is the usual stoneplate in the ground that marks the spot where the portal will appear after you finished your task.&lt;/br&gt;
&lt;%}%&gt; 
&lt;/br&gt;&lt;p&gt;&lt;%=window.gm.printNav(&#39;Go north&#39;,&#39;north&#39;)%&gt;&lt;/br&gt;&lt;%=window.gm.printNav(&#39;Go west&#39;,&#39;west&#39;)%&gt;&lt;%=window.gm.printNav(&#39;Go east&#39;,&#39;east&#39;)%&gt;&lt;/br&gt;&lt;%=window.gm.printNav(&#39;Go south&#39;,&#39;south&#39;)%&gt;&lt;/br&gt;&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngAT_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="189" name="DngAT_K6" tags="" position="1100,2350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
A dark, eerie tunnel in an old temple. 
&lt;/br&gt;&lt;p&gt; &lt;%=window.gm.printNav(&#39;Go west&#39;,&#39;west&#39;)%&gt;&lt;%=window.gm.printNav(&#39;Go east&#39;,&#39;east&#39;)%&gt;&lt;/br&gt;&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngAT_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="190" name="DngAT_L6" tags="" position="1225,2350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
A dark, eerie tunnel in an old temple. 
&lt;/br&gt;&lt;p&gt; &lt;%=window.gm.printNav(&#39;Go north&#39;,&#39;north&#39;)%&gt;&lt;/br&gt;&lt;%=window.gm.printNav(&#39;Go west&#39;,&#39;west&#39;)%&gt;&lt;%=window.gm.printNav(&#39;Go east&#39;,&#39;east&#39;)%&gt;&lt;/br&gt;&lt;%=window.gm.printNav(&#39;Go south&#39;,&#39;south&#39;)%&gt;&lt;/br&gt;&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngAT_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="191" name="DngCV_MAP" tags="_back_" position="100,2475" size="100,100">&lt;hr&gt;&lt;div id=&#39;canvas&#39;&gt;&lt;/div&gt;&lt;div id=&#39;svgpopup&#39;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;script&gt; window.gm.printMap2(window.story.state.DngSY.dngMap,window.gm.player.location.replace(window.story.state.DngSY.dng+&#39;_&#39;,&#39;&#39;),
    window.story.state.DngCV.mapReveal,window.story.state.DngCV.visitedTiles);
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="192" name="DngCV_Entry" tags="" position="225,2475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
You need a moment to orient yourself and meanwhile the gate disappears. You are now left alone in a dimly lit cave.
&lt;/br&gt;&lt;p&gt; [[Next|DngCV_G4]] &lt;/br&gt;&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
function buildRooms(){
    const _m=[
        &#39;    H2--I2    &#39;,
        &#39;    |   |     &#39;,
        &#39;    H3  I3    &#39;,
        &#39;    |         &#39;,
        &#39;G4--H4        &#39;];
    function _d(dir){return({dir:dir,exp:0});}
    let grid =[
    {room:&#39;H2&#39;, dirs:[_d(&#39;H3&#39;),_d(&#39;I2&#39;)]},
    {room:&#39;I2&#39;, dirs:[_d(&#39;H2&#39;),_d(&#39;I3&#39;)]},
    {room:&#39;H3&#39;, dirs:[_d(&#39;H2&#39;),_d(&#39;H4&#39;)]},
    {room:&#39;I3&#39;, dirs:[_d(&#39;I2&#39;)],anno:[&#39;X&#39;]},
    {room:&#39;G4&#39;, dirs:[_d(&#39;H4&#39;)],anno:[&#39;E&#39;]},
    {room:&#39;H4&#39;, dirs:[_d(&#39;H3&#39;),_d(&#39;G4&#39;)]}];
    let dng={grid:grid,width:14,height:8}
    window.story.state.DngSY.dngMap=dng;
    window.story.state.DngCV.visitedTiles=[],
    window.story.state.DngCV.mapReveal=[&#39;I3&#39;];
}
    var s = window.story.state;
    s.vars.spawnAt=&quot;DngSY_Recover_Death&quot;;//might also set this in encounter
    s.DngSY.dng=&#39;DngCV&#39;;
    s.DngCV.visitedTiles=[];
    s.DngCV.tmp = {bathedInLake:0,
    water:[]};
    buildRooms();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="193" name="DngCV_Success" tags="" position="350,2475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
You step through the portal and are facing Cyril again.
&lt;p class=&#39;tNPC2&#39;&gt;&quot;There you are, I was already worrying what could delay that little task.&quot;&lt;/p&gt;
&lt;p class=&#39;tNPC2&#39;&gt;&quot;You have the glass with you?&quot;&lt;/p&gt;
&lt;%if(window.story.state.DngCV.tmp.bathedInLake&gt;0){%&gt;
&lt;p class=&#39;tNPC2&#39;&gt;&quot;And why are your clothes all wet. You didn&#39;t fall in the lake, did you?&quot;&lt;/p&gt;
You are kinda embarassed, like a child that did something stupid.
&lt;%}%&gt;
&lt;/br&gt;&lt;a0 onclick=&#39;lvl2()&#39;&gt;Hand&lt;/a&gt; him the glas.
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;function lvl2(){
    window.gm.player.Inv.removeItem(&quot;CrystalWater&quot;,1);
    window.story.state.DngSY.dngLevel=2;
    window.story.state.DngSY.remainingNights=2;
    window.story.show(&quot;DngCV_Success2&quot;);
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="194" name="DngCV_Success2" tags="" position="475,2475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
&lt;p class=&#39;tPC&#39;&gt;&quot;Here, Sir.&quot;&lt;/p&gt;
Cyril takes the glass you present him.&lt;/br&gt;
&lt;p class=&#39;tNPC2&#39;&gt;&quot;Please follwo me to the lab. Someone is already waiting to analyse this.&quot;&lt;/p&gt;
&lt;p class=&#39;tPC&#39;&gt;&quot;There are others here around? I didn&#39;t notice anyone.&quot;&lt;/p&gt;
&lt;p class=&#39;tNPC2&#39;&gt;&quot;Kumala just returned this night, thats a good oppurtunity to meet her.&quot;&lt;/p&gt;
&lt;p class=&#39;tPC&#39;&gt;&quot;Is she also an acolyte?&quot;&lt;/p&gt;
You hurry behind Cyril to keep up, following him back to the hall towards its long side where another door is now opened. 
&lt;p class=&#39;tNPC2&#39;&gt;&quot;No she is a instructor and our alchemist. Oh and she also does the cooking.&quot;&lt;/p&gt;
&lt;/br&gt;&lt;span class=&#39;tPC&#39;&gt;&#39;I just hope she separates the cooking from the alchemy.&#39;&lt;/span&gt; you mumble to yourself.
The door from the hall opens into another tunnel and you both walk to another entrance further down.
&lt;p class=&#39;tNPC2&#39;&gt;&quot;Kumala? Kumala are you here?&quot;&lt;/p&gt;
You look around. All the strange equipment here seems to fit into a laboratory. But it could also be a kitchen of haute cuisine, you arent sure.&lt;/br&gt;
There is some clanking going on in a backroom where someone seems busy.
&lt;p class=&#39;tNPC1&#39;&gt;&quot;Just a moment.. Let me put the preserved on the shelf and I will be right with you.&quot;&lt;/p&gt;
A moment later a woman appears. She might be in her mid-thirtys and is wearing the same garment as Cyril. She just didnt put on the hood.
&lt;p class=&#39;tNPC1&#39;&gt;&quot;Ah...hello. You are the new apprentice right?&quot;&lt;/p&gt;
You return the bow with which she greeted you.
&lt;p class=&#39;tPC&#39;&gt;&quot;Yes my name is &lt;%=window.gm.player.name%&gt;. I&#39;m just back from some woozy caves where I had to fetch this water.&quot;&lt;/p&gt;
&lt;p class=&#39;tNPC1&#39;&gt;&quot;The water yes. I need this for my work, I just need to find...&quot;&lt;/p&gt;
Cyril does not seem to expect that Kumala is finished soon with whatever she is doing.
&lt;p class=&#39;tNPC2&#39;&gt;&quot;Come, let&#39;s leave her alone. Better not divert her while she is doing the alchemistic stuff...it could get messy.&quot;&lt;/p&gt;
You follow him suit behind.
&lt;p class=&#39;tNPC2&#39;&gt;&quot;Thats all for now. You should contemplate on what you have learned and prepare for your next task in 2 days.&quot;&lt;/p&gt;
&lt;p class=&#39;tPC&#39;&gt;&quot;Sure. What will be my next task?&quot;&lt;/p&gt;
&lt;p class=&#39;tNPC2&#39;&gt;&quot;This I will tell you before you leave. Dont worry, its not to difficult.&quot;&lt;/p&gt;
&lt;p class=&#39;tPC&#39;&gt;&#39;Great. I should prepare for the job but they dont tell me what the job is. Well, lets contemplate what I&#39;ve learned: Caves a dark and water is wet. Done.&#39;&lt;/p&gt;
With a sigh you return to your [[room|DngSY_Your_Room]].&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="195" name="DngCV_FallToDeath" tags="" position="600,2475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
&lt;p class=&#39;tPC&#39;&gt;Its so damn dark, here.&lt;/p&gt;
Just as that thought crosses your mind, a gusty wind blows strong in your face.
...
You fall into the abyss never to return. &lt;/br&gt;
&lt;a0 onclick=&#39;window.story.state.vars.spawnAt=&quot;DngSY_Recover_Death&quot;,window.gm.respawn()&#39;&gt;Next&lt;/a&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="196" name="DngCV_Encounters" tags="" position="725,2475" size="100,100">&lt;script&gt;
function fightPillRoller(){
    window.gm.encounters.pillRoller();
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="197" name="DngCV_G4" tags="" position="850,2475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
It takes a moment until your eyes adjust to the dim light and you can see what is around you.&lt;/br&gt;
Below a cave dome is a stone-plateu that has some kind of runes on it. 
&lt;%if(window.story.state.DngSY.dngLevel&gt;1){%&gt;
    &lt;p&gt;[[Into the portal|DngSY_Portal]]&lt;/br&gt;&lt;/p&gt;
&lt;%}else if(window.story.state.DngSY.dngLevel===1 &amp;&amp; window.gm.player.Inv.countItem(&#39;CrystalWater&#39;)&gt;=1){%&gt;
    &lt;/br&gt;The portal has opened, time for your return.
    &lt;p&gt;[[Into the portal|DngCV_Success]]&lt;/br&gt;&lt;/p&gt;
&lt;%}else{%&gt;
    &lt;/br&gt;You are worried because the portal is gone. &lt;p class=&quot;tPC&quot;&gt;&#39;He didn&#39;t say that the portal vanishs ! How should I get back then.&#39;&lt;/p&gt;
    &lt;/br&gt;The runes carved in the rock dont give you a clue. &lt;p class=&quot;tPC&quot;&gt;&#39;Maybe it will open up after some time or I first need to get that water.&#39;&lt;/p&gt;
&lt;%}%&gt; 
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="198" name="DngCV_H2" tags="" position="975,2475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
You can see the crystal lake from here. 
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="199" name="DngCV_I2" tags="" position="1100,2475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
You can see the crystal lake from here. Its a little steep downwards. 
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="200" name="DngCV_H3" tags="" position="1225,2475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
The cave tunnel leads to a plateau inside a large hall. Only at second glance do you realize that there is a lake at the bottom of the hall. The water is so clear that you only notice it when you take a closer look. &lt;/br&gt;
From up here there is no direct way to the lake.&lt;/br&gt;&lt;/br&gt; 
A narrow path leads along the precipice. At the wall that you have to pass by, several regular shaped, round plates form a line. &lt;/br&gt;
&lt;div id=&#39;select1&#39; &gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;)&#39;&gt;Take a closer look&lt;/a&gt;&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1b&quot;)&#39;&gt;Try to ignore it and slip by&lt;/a&gt;&lt;/br&gt;
&lt;/div&gt;&lt;div id=&#39;choice1a&#39; hidden&gt;&lt;/br&gt; You look closer. And as you do so, it starts moving. Its some kind of bug or creeper and much bigger then you have ever seen.
 &lt;a0 onclick=&#39;fightPillRoller();&#39;&gt;Defend yourself&lt;/a&gt;.&lt;/br&gt;
&lt;/div&gt;
&lt;div id=&#39;choice1b&#39; hidden&gt;&lt;/br&gt;
You hurry past the narrow to continue your way. As you look back, you cant see the formation anymore. For sure because of your different point of view.&lt;/br&gt;  
&lt;%=window.gm.printNav()%&gt;
&lt;/div&gt; 
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngCV_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="201" name="DngCV_I3" tags="" position="100,2600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
&lt;%if(!s.DngCV.tmp.water[window.gm.player.location]){%&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;The water at the shore of the lake isnt as clean as it seemed from a distance. Its much cleaner a little further inside.&quot;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;I could just fill the glas here, but maybe they then dont believe me its from the lake if its spoiled with all that grime.&quot;&lt;/p&gt;
You look around and spot a larger one of those crystals growing from the wall toward the center of the lake, just above its surface.
&lt;p class=&quot;tPC&quot;&gt;&#39;Maybe if I climb on that one and slide on it a little further along away from the polluted shore...&#39; &lt;/p&gt;
&lt;div id=&#39;select1&#39; &gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;)&#39;&gt;Just fill the glas right here&lt;/a&gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1b&quot;)&#39;&gt;climb on the crystal&lt;/a&gt;
&lt;/div&gt;&lt;div id=&#39;choice1a&#39; hidden&gt;
    &lt;p class=&quot;tPC&quot;&gt;&#39;Lets get it over with. It shouldnt matter if there is some dirt in it.&#39;&lt;/p&gt;
    You fill the glas and try to keep most of the grime away. Still, you wouldnt say this is crystal clear.
    Now its time to return to the entrance but for this you have to climb the steep &lt;a0 onclick=&#39;window.gm.player.Inv.addItem(new window.gm.ItemsLib[&quot;CrystalWater&quot;]()),window.story.state.DngCV.tmp.water[window.gm.player.location]=true,window.story.show(&quot;DngCV_I3_SlopeUp&quot;)&#39;&gt;slope&lt;/a&gt;.
&lt;/div&gt;
&lt;div id=&#39;choice1b&#39; hidden&gt;
    You walk over to the crystal spike and hit it with your hand.
    &lt;p class=&quot;tPC&quot;&gt;&#39;Looks solid enough.&#39;&lt;/p&gt;
    Carefully you pull yourself on the smooth crystal and, stradling it, slide forward to a point where you can plunge the glas into the water.
    &lt;p class=&quot;tPC&quot;&gt;&#39;Its to far, only some fingerwidth...&#39;&lt;/p&gt;
    The round glas isnt helpful at all. 
    &lt;p class=&quot;tPC&quot;&gt;&#39;If I hold it just between 2 fingers at the edge, it should be possible to scoop up some water.&#39;&lt;/p&gt;
    &lt;div id=&#39;select2&#39; &gt;
    &lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select2&quot;,&quot;div#choice2a&quot;)&#39;&gt;Do it&lt;/a&gt;
    &lt;/div&gt;&lt;div id=&#39;choice2a&#39; hidden&gt;
        You are happy that your plan is working, until you notice that the water filled glas is now quite heavy.&lt;/br&gt;
        Feeling it slip from your fingers, you stretch a little bit further down and try to get a hold on it.&lt;/br&gt;
        Just a moment later you realize that this was a little bit to far and that your body weight is now drawing you down.
        &lt;div id=&#39;select3&#39; &gt;
        &lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select3&quot;,&quot;div#choice3a&quot;),window.story.state.DngCV.tmp.bathedInLake=1;&#39;&gt;Next&lt;/a&gt;
        &lt;/div&gt;&lt;div id=&#39;choice3a&#39; hidden&gt;
        &lt;span class=&quot;tPC&quot;&gt;&quot;AAhhh...&quot;&lt;/span&gt;, with a splash you fall into the lake.&lt;/br&gt;
        You trash around to stay above the surface of the cold water. Thankfully you quickly notice that it isnt that deep as it seemed from above and you can stand on the ground.&lt;/br&gt;
        The glas you somehow still have in your hand and you quickly make your way to escape the pond.
        &lt;p class=&quot;tPC&quot;&gt;&quot;Thats cold...brr&quot;&lt;/p&gt;
        You teeth rattle as you step out of the water and the previous shock subsides. Why dont you even have a torch to warm you.
        &lt;p class=&quot;tPC&quot;&gt;&quot;Better get going before I catch a cold.&quot;&lt;/p&gt;
        Now its time to return to the entrance but for this you have to climb the steep &lt;a0 onclick=&#39;window.gm.player.Inv.addItem(new window.gm.ItemsLib[&quot;CrystalWater&quot;]()),window.story.state.DngCV.tmp.water[window.gm.player.location]=true,window.story.show(&quot;DngCV_I3_SlopeUp&quot;)&#39;&gt;slope&lt;/a&gt;.
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;%}else{%&gt;
&lt;%=window.gm.printNav()%&gt;
&lt;%}%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="202" name="DngCV_I3_SlopeUp" tags="" position="225,2600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
The steep climb would not be a problem if you didn&#39;t have to carry the glas.
...
&lt;/br&gt;&lt;p&gt; [[Go north|DngCV_I2]] &lt;/br&gt;&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="203" name="DngCV_H4" tags="" position="350,2600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
There are some candles on the floor. If you [[follow them north|DngCV_H3]] , you should get to the crystal lake.&lt;/br&gt;
The portal should be in [[opposite direction|DngCV_G4]]. There is also a pathway leading [[east|DngCV_FallToDeath]], but it seems very dark there.&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="204" name="Into the city" tags="" position="475,2600" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;!-- dont overwrite location --&gt;
&lt;%=window.gm.printPickupAndClear(&#39;Crowbar&#39;,&#39;A crowbar is lying other there.&#39;,window.story.state.vars.crowBarLeft,(function(){window.story.state.vars.crowBarLeft-=1;}))%&gt;
You are actually at [[&lt;%=window.gm.player.location%&gt;]].
Where would you like to go from here?&lt;/br&gt;
&lt;a0 onclick=window.gm.rollExploreCity()&gt;Explore your surroundings&lt;/a&gt; &lt;/br&gt;&lt;/br&gt;
[[Home]]
&lt;%  if(s.vars.qUnlockPark&gt;0){      %&gt;[[Park]]
&lt;%}; if(s.vars.qUnlockMall&gt;0){     %&gt;[[Mall]]
&lt;%}; if(s.vars.qUnlockDowntown&gt;0){ %&gt;[[Downtown]]
&lt;%}; if(s.vars.qUnlockBeach&gt;0){    %&gt;[[Beach]]
&lt;%};%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="205" name="Mall" tags="" position="600,2600" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;%window.gm.player.location=window.passage.name;
if(s.vars.qUnlockMall==0){s.vars.qUnlockMall=1;%&gt;
You found the &lt;%=window.passage.name%&gt; ! &lt;/br&gt;&lt;/br&gt;
&lt;%}%&gt;
You are actually at [[&lt;%=window.gm.player.location%&gt;]].
Where would you like to go from here?&lt;/br&gt;
&lt;a0 onclick=window.gm.rollExploreCity()&gt;Explore your surroundings&lt;/a&gt; &lt;/br&gt;&lt;/br&gt;
[[Into the Mall|Mall 0F]]&lt;/br&gt; [[Home]]&lt;/br&gt;
&lt;%  if(s.vars.qUnlockPark&gt;0){      %&gt;[[Park]]&lt;/br&gt;
&lt;%}; if(s.vars.qUnlockBeach&gt;0){      %&gt;[[Beach]]&lt;/br&gt;
&lt;%};%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="206" name="Park" tags="" position="725,2600" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;%window.gm.player.location=window.passage.name;
if(s.vars.qUnlockPark==0){s.vars.qUnlockPark=1;%&gt;
You found the &lt;%=window.passage.name%&gt; ! &lt;/br&gt;&lt;/br&gt;
&lt;%}%&gt;
You are actually at [[&lt;%=window.gm.player.location%&gt;]].&lt;/br&gt;
People in sportswear are jogging around the paths or doing gymnastics on the grassfield. Maybe you should also do some [[sports|Park_Jogging]] &lt;/br&gt; 
&lt;%if(s.vars.qDogSit===0 &amp;&amp; visited(window.passage.name)&gt;=5){%&gt;
    On a direction sign near the entrance of the park you spot a piece of paper that someone must have placed there.&lt;/br&gt;
    Would you like to check whats up with the [[Sign|Park_DogsitAd]].
&lt;%} else if(s.vars.qDogSit&gt;0){%&gt;
    [[DogSit-ad|Park_DogsitAd]]
&lt;%}%&gt;
Where would you like to go from here?&lt;/br&gt;
&lt;a0 onclick=window.gm.rollExploreCity()&gt;Explore your surroundings&lt;/a&gt; &lt;/br&gt;&lt;/br&gt;
[[Home]]&lt;/br&gt;
&lt;%  if(s.vars.qUnlockMall&gt;0){      %&gt;[[Mall]]&lt;/br&gt;
&lt;%};%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="207" name="Park_Jogging" tags="_back_" position="850,2600" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;%if(window.gm.player.Stats.get(&#39;energy&#39;).value&lt;=50){%&gt;
You feel you dont have enough energy left to do anything sporty. Maybe another time. &lt;/br&gt;

&lt;%} else {%&gt;
After a quick warmup and stretching you take a fast pace jog around the outer paths of the park.&lt;/br&gt;
&lt;p class=&#39;red&#39;&gt;Energy -50&lt;/p&gt;
&lt;% window.gm.player.Stats.increment(&#39;energy&#39;,-50);
  if(window.gm.player.Stats.get(&#39;endurance&#39;).value&lt;=6 &amp;&amp; visited(window.passage.name)%2){%&gt;
    After several rounds you are exhausted. But happy.
    This really seems to improve your fitness.
    &lt;p class=&#39;green&#39;&gt;Endurance +1&lt;/p&gt;
    &lt;% window.gm.player.Stats.increment(&#39;endurance&#39;,1);
} else {%&gt;
    This time you didnt feel that kind of exhausted euphoria. Maybe you have to work harder. Or you are as fit as you can get with this workout. &lt;/br&gt; 
&lt;%}}%&gt;
&lt;/br&gt;[[Back|_back_]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="208" name="Beach" tags="" position="975,2600" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;%window.gm.player.location=window.passage.name;
if(s.vars.qUnlockBeach==0){s.vars.qUnlockBeach=1;%&gt;
You found the &lt;%=window.passage.name%&gt; ! &lt;/br&gt;&lt;/br&gt;
&lt;%}%&gt;
You are actually at [[&lt;%=window.gm.player.location%&gt;]].&lt;/br&gt;&lt;/br&gt;
The splashing waves are inviting but you dont have some proper swimwear with you.
You could wander at the shoreline. Maybe you find some jetsam.&lt;/br&gt;

&lt;/br&gt;
Where would you like to go from here?&lt;/br&gt;
&lt;a0 onclick=window.gm.rollExploreCity()&gt;Explore your surroundings&lt;/a&gt; &lt;/br&gt;&lt;/br&gt;
[[Home]]&lt;/br&gt;
&lt;%  if(s.vars.qUnlockMall&gt;0){      %&gt;[[Mall]]&lt;/br&gt;
&lt;%};%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="209" name="Downtown" tags="" position="1100,2600" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;%window.gm.player.location=window.passage.name;
if(s.vars.qUnlockDowntown===0){s.vars.qUnlockDowntown=1;%&gt;
You found the &lt;%=window.passage.name%&gt; ! &lt;/br&gt;&lt;/br&gt;
&lt;%}%&gt;
You are actually at [[&lt;%=window.gm.player.location%&gt;]].
Where would you like to go from here?&lt;/br&gt;
&lt;a0 onclick=window.gm.rollExploreCity()&gt;Explore your surroundings&lt;/a&gt; &lt;/br&gt;&lt;/br&gt;
[[Home]]&lt;/br&gt;
&lt;%  if(s.vars.qUnlockMall&gt;0){      %&gt;[[Mall]]&lt;%};%&gt;
[[Harcon_Health]]
&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="210" name="Pawn shop" tags="_back_" position="1225,2600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
&lt;%if((s.vars.qUnlockDowntown &amp; 0x2)===0){s.vars.qUnlockDowntown|=0x2;%&gt;
You found the &lt;%=window.passage.name%&gt; ! &lt;/br&gt;&lt;/br&gt;
&lt;%}%&gt;
A sign denoting &quot;quick money - no questions&quot; sparks your interest. It leads you to a pawn shop where you can trade in your valuables to get some money.&lt;/br&gt;
&lt;div id=&quot;choice&quot;&gt;&lt;/div&gt;&lt;/br&gt;&lt;/br&gt;   &lt;!--display buy message--&gt;
&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;&lt;/br&gt;    &lt;!--display wares list--&gt;
Where would you like to go from here?&lt;/br&gt;
&lt;a0 onclick=window.gm.rollExploreCity()&gt;Explore your surroundings&lt;/a&gt; &lt;/br&gt;&lt;/br&gt;
[[Back|_back_]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
window.gm.shop.findWaresToSell(window.gm.player,[window.gm.ItemTags.Ingredient]);
renderToSelector(&quot;#panel&quot;, &quot;listsell&quot;);
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="211" name="DngDF_MAP" tags="_back_" position="100,2725" size="100,100">&lt;hr&gt;&lt;div id=&#39;canvas&#39;&gt;&lt;/div&gt;&lt;div id=&#39;svgpopup&#39;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;script&gt; window.gm.printMap2(window.story.state.DngSY.dngMap,window.gm.player.location.replace(window.story.state.DngSY.dng+&#39;_&#39;,&#39;&#39;),
    window.story.state.DngDF.mapReveal,window.story.state.DngDF.visitedTiles);
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="212" name="DngDF_Entry" tags="" position="225,2725" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
The portal drops you within a clearing of a beautiful, thriving forest. Once you have fullfilled your task, the portal should reapear opening your way back to the sanctuary.
&lt;p class=&quot;tPC&quot;&gt;&quot;Wow, I expected some cave but not an open landscape. Let&#39;s look for a vantage point.&quot;&lt;/p&gt;  
&lt;/br&gt;&lt;p&gt; [[Next|DngDF_F2]] &lt;/br&gt;&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
function buildRooms(){
    const _m=[
        &#39;A2--B2--C2--D2--E2--F2--G2--H2  I2--J2  K2--L2 &#39;,
        &#39;                        |   |   |   |   |   |  &#39;,
        &#39;A3  B3--C3--D3--E3  F3  G3  H3  I3  J3--K3  L3 &#39;,
        &#39;                    |   |   |   |           |   &#39;,
        &#39;A4--B4--C4--D4--E4  F4--G4--H4  I4--J4--K4  L4  &#39;,
        &#39;                    |   |           |       |  &#39;,
        &#39;A5--B5--C5--D5--E5--F5  G5--H5  I5--J5--K5--L5&#39;,
        &#39;                    |   |                   |  &#39;,
        &#39;A6--B6--C6--D6--E6  F6--G6      I6--J6--K6--L6&#39;];
    function _d(dir){return({dir:dir,exp:0});};
    let grid =[
    {room:&#39;F2&#39;, dirs:[_d(&#39;G2&#39;)]             ,anno:[&#39;E&#39;]},
    {room:&#39;G2&#39;, dirs:[_d(&#39;F2&#39;),_d(&#39;H2&#39;),_d(&#39;G3&#39;)]},
    {room:&#39;H2&#39;, dirs:[_d(&#39;G2&#39;),_d(&#39;H3&#39;)]},
    {room:&#39;I2&#39;, dirs:[_d(&#39;J2&#39;)]},
    {room:&#39;J2&#39;, dirs:[_d(&#39;I2&#39;),_d(&#39;J3&#39;)]},
    {room:&#39;F3&#39;, dirs:[_d(&#39;F4&#39;)]},
    {room:&#39;G3&#39;, dirs:[_d(&#39;G2&#39;),_d(&#39;G4&#39;)]},
    {room:&#39;H3&#39;, dirs:[_d(&#39;H2&#39;),_d(&#39;H4&#39;)],           },
    {room:&#39;I3&#39;, dirs:[_d(&#39;I4&#39;),_d(&#39;J3&#39;)],           },
    {room:&#39;J3&#39;, dirs:[_d(&#39;I3&#39;),_d(&#39;K3&#39;),_d(&#39;J2&#39;)]},
    {room:&#39;K3&#39;, dirs:[_d(&#39;J3&#39;)]},
    {room:&#39;F4&#39;, dirs:[_d(&#39;F3&#39;),_d(&#39;G4&#39;),_d(&#39;F5&#39;)]},
    {room:&#39;G4&#39;, dirs:[_d(&#39;G3&#39;),_d(&#39;F4&#39;),_d(&#39;H4&#39;),_d(&#39;G5&#39;)]},
    {room:&#39;H4&#39;, dirs:[_d(&#39;H3&#39;),_d(&#39;G4&#39;)]},
    {room:&#39;I4&#39;, dirs:[_d(&#39;H4&#39;),_d(&#39;I3&#39;),_d(&#39;J4&#39;)]},
    {room:&#39;J4&#39;, dirs:[_d(&#39;I4&#39;),_d(&#39;J5&#39;),_d(&#39;K4&#39;)]},
    {room:&#39;K4&#39;, dirs:[_d(&#39;J4&#39;)],                },
    {room:&#39;F5&#39;, dirs:[_d(&#39;F4&#39;),_d(&#39;F6&#39;)]},
    {room:&#39;G5&#39;, dirs:[_d(&#39;G4&#39;),_d(&#39;H5&#39;),_d(&#39;G6&#39;)]},
    {room:&#39;H5&#39;, dirs:[_d(&#39;G5&#39;)]},
    {room:&#39;I5&#39;, dirs:[_d(&#39;J5&#39;)]},
    {room:&#39;J5&#39;, dirs:[_d(&#39;I5&#39;),_d(&#39;K5&#39;),_d(&#39;J4&#39;)]},
    {room:&#39;K5&#39;, dirs:[_d(&#39;J5&#39;),_d(&#39;K6&#39;),_d(&#39;L5&#39;)]},
    {room:&#39;L5&#39;, dirs:[_d(&#39;K5&#39;)],                },
    {room:&#39;F6&#39;, dirs:[_d(&#39;F5&#39;),_d(&#39;G6&#39;)],                },
    {room:&#39;G6&#39;, dirs:[_d(&#39;F6&#39;),_d(&#39;G5&#39;)],                },
    {room:&#39;I6&#39;, dirs:[_d(&#39;J6&#39;)],           },
    {room:&#39;J6&#39;, dirs:[_d(&#39;I6&#39;),_d(&#39;K6&#39;)]},
    {room:&#39;K6&#39;, dirs:[_d(&#39;K5&#39;),_d(&#39;L6&#39;),_d(&#39;J6&#39;)]},
    {room:&#39;L6&#39;, dirs:[_d(&#39;K6&#39;)]}];
    let dng={grid:grid,width:14,height:8}
    window.story.state.DngSY.dngMap=dng;
}
    var s = window.story.state;
    s.vars.spawnAt=&quot;DngSY_Recover_Death&quot;;//might also set this in encounter
    s.DngSY.dng=&#39;DngDF&#39;;
    s.DngDF.plum={};
    s.DngDF.tmp={stung:0};
    buildRooms();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="213" name="DngDF_Success" tags="" position="350,2725" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
Balancing all those ripe plums, you step through the portal.
&lt;p class=&#39;tNPC2&#39;&gt;&quot;Welcome back. I see you have quite some large plums.&quot;&lt;/p&gt;
&lt;p class=&#39;tPC&#39;&gt;&quot;Yeah, those a really a different size. What should I do with them now?&quot;&lt;/p&gt;
&lt;p class=&#39;tNPC2&#39;&gt;&quot;Bring them to Kumala.&quot;&lt;/p&gt;
&lt;p class=&#39;tPC&#39;&gt;&quot;Is she going to make some jar from those?.&quot;&lt;/p&gt;
&lt;p class=&#39;tNPC2&#39;&gt;&quot;I dont think so. Well, I cant be sure...&quot;&lt;/p&gt;
Carrying your truckload of fruits toward the laboratory, you right away run into &lt;a0 onclick=&#39;lvl3()&#39;&gt;Kumala&lt;/a&gt;.
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;function lvl3(){
    window.gm.player.Inv.removeItem(&quot;GiantPlum&quot;,5);
    window.story.state.DngSY.dngLevel=3;
    window.story.state.DngSY.remainingNights=2;
    window.story.show(&quot;DngDF_Success2&quot;);
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="214" name="DngDF_Success2" tags="" position="475,2725" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
&lt;p class=&#39;tNPC1&#39;&gt;&quot;Oh my, those should be more then enough for me.&quot;&lt;/p&gt;
&lt;p class=&#39;tPC&#39;&gt;&quot;What are you going to do with them? Boil down as jam or preserve?&quot;&lt;/p&gt;
&lt;p class=&#39;tNPC1&#39;&gt;&quot;I will have to do some analyzes. But indeed, if there are remains I could still make something out of it.&quot;&lt;/p&gt;
&lt;p class=&#39;tPC&#39;&gt;&quot;Why are you analyze those things anyway?&quot;&lt;/p&gt;
&lt;p class=&#39;tNPC1&#39;&gt;&quot;Did you run into those hornets? Didn&#39;t you think they are somewhat oversized.&quot;&lt;/p&gt;
&lt;p class=&#39;tPC&#39;&gt;&quot;Oh, yes. For sure people at home would panic if they are facing some buggers like that. You think the plums have something to do with it?&quot;&lt;/p&gt;
&lt;p class=&#39;tNPC1&#39;&gt;&quot;Well, that we have to find out. I guess its not the fruit but something different that lets them grow.&quot;&lt;/p&gt;
&lt;p class=&#39;tNPC1&#39;&gt;&quot;Anyway, did you have any problems with the hornetts, they didn&#39;t sting you did they?&quot;&lt;/p&gt;
&lt;div id=&#39;select1&#39; &gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;)&#39;&gt;&lt;p class=&#39;tPC&#39;&gt;&quot;Of course they stung me! What were you thinking.&quot;&lt;/p&gt;&lt;/a&gt;&lt;/br&gt;
&lt;/div&gt;&lt;div id=&#39;choice1a&#39; hidden&gt;
    &lt;p class=&#39;tNPC1&#39;&gt;&quot;Oh my. Are you feeling well? How many stings did you receive? I have some antitoxin to neutralize the poison. But it need to be properly dosed.&lt;/p&gt;
    &lt;div id=&#39;select2&#39; &gt;
    &lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select2&quot;,&quot;div#choice2a&quot;)&#39;&gt;&lt;span class=&#39;tPC&#39;&gt;&quot;It wasn&#39;t more then 3 times.&quot;&lt;/span&gt;&lt;/a&gt;&lt;/br&gt;
    &lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select2&quot;,&quot;div#choice2a&quot;)&#39;&gt;&lt;span class=&#39;tPC&#39;&gt;&quot;5 times or more, I guess.&quot;&lt;/span&gt;&lt;/a&gt;&lt;/br&gt;
    &lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select2&quot;,&quot;div#choice2c&quot;)&#39;&gt;&lt;span class=&#39;tPC&#39;&gt;&quot;I can&#39;t remember. I will just sit it out.&quot;&lt;/span&gt;&lt;/a&gt;&lt;/br&gt;
    &lt;/div&gt;&lt;div id=&#39;choice2a&#39; hidden&gt;
        &lt;p class=&#39;tNPC1&#39;&gt;&quot;Here trink that, it should neutralize the toxins.&lt;/p&gt;
        You down the concotion she hands you.
        &lt;p class=&#39;tPC&#39;&gt;&quot;Blergh. That really has to be some good medicine if it tastes that bad.&quot;&lt;/p&gt;
        &lt;p class=&#39;tNPC1&#39;&gt;&quot;Please excuse me. I better get started with the tests.&quot;&lt;/p&gt;
        You are feeling somewhat nauseous now that she seemed to be worried about the wasps toxins. Maybe you should get to your [[room|DngSY_Your_Room]] and take a nap.&lt;/br&gt;
    &lt;/div&gt;
    &lt;div id=&#39;choice2c&#39; hidden&gt;
        &lt;p class=&#39;tNPC1&#39;&gt;&quot;Hmm, Please see me if it does cause problems.&quot;&lt;/p&gt;
        You are feeling somewhat nauseous now that she seemed to be worried about the wasps toxins. Maybe you should get to your [[room|Leon_Arrival]] and take a nap.&lt;/br&gt;
            Todo TF of...
    &lt;/div&gt;
&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="215" name="DngDF_Encounters" tags="" position="600,2725" size="100,100">&lt;script&gt;
function tick(){
    let here = window.passage.name;
    if(here===window.story.state.DngDF.tmp.tickPass) return;
    window.story.state.DngDF.tmp.tickPass=here;
    if(here===&#39;DngMN_I2&#39; || here===&#39;DngMN_F2&#39;){ //todo
        window.gm.encounters.wolf({amount:1});
        window.gm.Encounter.initCombat();
    }
}
function fightHornet(){
    window.gm.encounters.hornett({levelUp:-5, amount:(window.gm.player.Inv.countItem(&#39;GiantPlum&#39;)&gt;=2)?2:1, noStart:true});
    window.gm.Encounter.onVictory = (function(){
        window.story.state.DngDF.plum[window.gm.player.location]=true;
        window.gm.player.Inv.addItem(new window.gm.ItemsLib[&#39;GiantPlum&#39;]());
        return(&#39;You defeated the angry hornet and earned that &lt;b&gt;juicy fruit&lt;/b&gt;.&lt;/br&gt; &#39;+this.fetchLoot()+&#39;&lt;/br&gt;&#39; + window.gm.printLink(&#39;Next&#39;,&#39;window.gm.postVictory({flee:false})&#39;));});
    window.gm.Encounter.initCombat();
}
function fightLapine(){
    window.gm.encounters.lapine({amount:1, noStart:true});
    window.story.state.DngDF.lapine.met=true;
    window.gm.Encounter.initCombat();
}
function fightWolf(){
    window.gm.encounters.wolf({amount:1, noStart:true});
    window.gm.Encounter.initCombat();
}
function explore(){
    let rnd = _.random(0,100);
    window.gm.pushLog(&quot;rolled &quot;+rnd);
    window.story.state.tmp.args = [];
    if(rnd &gt; 70 ){
        window.gm.encounters.huntress();
    }else if(rnd &gt; 50){
        let find = [&#39;PurpleBerry&#39;,&#39;ApocaFlower&#39;];
        let rnd2 = _.random(0,find.length-1);
        window.story.state.tmp.args = [find[rnd2],1]
        window.story.show(&#39;ForestSearchAround&#39;);
    }
    else {
        window.story.show(&#39;ForestSearchAround&#39;); //nothing
    }
}
tick();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="216" name="DngDF_F2" tags="" position="725,2725" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
There is a clearing with a stone-plateu that has some kind of runes on it. 
&lt;%if(window.story.state.DngSY.dngLevel===2 &amp;&amp; window.gm.player.Inv.countItem(&#39;GiantPlum&#39;)&gt;=3){%&gt;
    &lt;/br&gt;The portal has opened, time for your return.&lt;/br&gt;
    &lt;%if(window.story.state.DngDF.tmp.stung&gt;0){%&gt;
    Those &lt;%=window.story.state.DngDF.tmp.stung%&gt; stings you received from those hornetts are itchy.
    &lt;%}else{%&gt;&lt;%}%&gt;
    &lt;p&gt;[[Into the portal|DngDF_Success]] &lt;/br&gt;&lt;/p&gt;
&lt;%}else{%&gt;
    &lt;/br&gt;Once you have at least 3 plums, the portal should reapear opening your way back to the sanctuary.
    &lt;/br&gt;Check your quest-log if you need a reminder on what to do.
&lt;%}%&gt; 
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="217" name="DngDF_G2" tags="" position="850,2725" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
&lt;%if(window.gm.player.Inv.countItem(&#39;GiantPlum&#39;)&gt;=3 &amp;&amp; !window.story.state.DngDF.lapine.met){%&gt;
As you make your way through the bushes, you here someone shout at you:
&lt;p class=&quot;tNPC3&quot;&gt;&quot;Hey you! Are you stealing all those plums?&quot;&lt;/p&gt;
&lt;div id=&#39;select1&#39; &gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;)&#39;&gt;Look around&lt;/a&gt;&lt;/br&gt;
&lt;/div&gt;&lt;div id=&#39;choice1a&#39; hidden&gt;
    You quickly turn around toward the source of the shout and are surprised by what you see:&lt;/br&gt;
    Someone is walking toward you. At first you think its a human wearing a mask that looks like a rabbit. But as it gets closer it becomes clear that this is in fact the real face of this person.
    Besides that you also notice the light grey fur visible on its body, at least those parts not covered by some tattered cloths.&lt;/br&gt;   
    &lt;div id=&#39;select3&#39; &gt;
    &lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select3&quot;,&quot;div#choice3a&quot;)&#39;&gt;&quot;I didn&#39;t know they are yours.&quot;&lt;/a&gt;&lt;/br&gt;
    &lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select3&quot;,&quot;div#choice3b&quot;)&#39;&gt;&quot;Get out of my way&quot;&lt;/a&gt;
    &lt;/div&gt;&lt;div id=&#39;choice3a&#39; hidden&gt;
    &lt;p class=&quot;tNPC3&quot;&gt;&quot;Technical they arent all mine. Its just not very friendly to plunder someones territory.&quot;&lt;/p&gt;
    &lt;div id=&#39;select4&#39; &gt;
    &lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select4&quot;,&quot;div#choice4a&quot;)&#39;&gt;&quot;I see. But I have to get 3 of those. If you want, you can get the others.&quot;&lt;/a&gt;&lt;/br&gt;
    &lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select4&quot;,&quot;div#choice4b&quot;)&#39;&gt;&quot;I already had to fight some nasty hornetts to get them. So I guess I earned them somehow.&quot;&lt;/a&gt;
    &lt;/div&gt;&lt;div id=&#39;choice4a&#39; hidden&gt;
    &lt;p class=&quot;tNPC3&quot;&gt;&quot;Fine. This time I will let it pass. But better not get caught raiding again...&quot;&lt;/p&gt;
    With that the creature walks away and for sure you arent going after it.
    &lt;%=window.gm.printNav()%&gt;
    &lt;/div&gt;
    &lt;div id=&#39;choice4b&#39; hidden&gt;
    &lt;p class=&quot;tNPC3&quot;&gt;&quot;So if fighting is what you want...&quot;&lt;/p&gt;
    &lt;a0 onclick=&#39;fightLapine();&#39;&gt;Defend yourself&lt;/a&gt;
    &lt;/div&gt;
    &lt;/div&gt;
    &lt;div id=&#39;choice3b&#39; hidden&gt;
    &lt;p class=&quot;tNPC3&quot;&gt;&quot;Oh just wait - I will kick your ass.&quot;&lt;/p&gt;
    &lt;a0 onclick=&#39;fightLapine();&#39;&gt;Defend yourself&lt;/a&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;%}else{%&gt;
High grass grows between sparse bushes.
&lt;%=window.gm.printNav()%&gt;
&lt;%}%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="218" name="DngDF_H2" tags="" position="975,2725" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="219" name="DngDF_F3" tags="" position="1100,2725" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="220" name="DngDF_G3" tags="" position="1225,2725" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
&lt;%if(!window.story.state.DngDF.plum[window.passage.name]){%&gt;
A large purple fruit hangs on one branch of a broad-leafed tree. Its so heavy that it has pulled down the branch to a height where you can reach it with your hand.&lt;/br&gt;
&lt;div id=&#39;select1&#39; &gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;)&#39;&gt;harvest it&lt;/a&gt;
&lt;/div&gt;&lt;div id=&#39;choice1a&#39; hidden&gt;
As you plug the fruit from the twig, the branch snaps back to its origin.&lt;/br&gt;
That doesnt surprise you. What surprises you is the giant hornett that flys buzzing angrily out of the trees crown toward you.
&lt;a0 onclick=&#39;fightHornet();&#39;&gt;Defend yourself&lt;/a&gt;
&lt;/div&gt;
&lt;%} else {%&gt;
No more plums are growing on the trees here.&lt;/br&gt;
&lt;%}%&gt;
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngDF_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="221" name="DngDF_H3" tags="" position="100,2850" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
&lt;%if(!window.story.state.DngDF.plum[window.passage.name]){%&gt;
    A large purple fruit hangs on one branch of a broad-leafed tree. Its so heavy that it has pulled down the branch to a height where you can reach it with your hand.&lt;/br&gt;
    &lt;div id=&#39;select1&#39; &gt;
    &lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;)&#39;&gt;harvest it&lt;/a&gt;
    &lt;/div&gt;&lt;div id=&#39;choice1a&#39; hidden&gt;
    As you plug the fruit from the twig, the branch snaps back to its origin.&lt;/br&gt;
    That doesnt surprise you. What surprises you is the giant hornett that flys buzzing angrily out of the trees crown toward you.
    &lt;a0 onclick=&#39;fightHornet();&#39;&gt;Defend yourself&lt;/a&gt;
    &lt;/div&gt;
&lt;%} else {%&gt;
No more plums are growing on the trees here.&lt;/br&gt;
&lt;%}%&gt;
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngDF_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="222" name="DngDF_F4" tags="" position="225,2850" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
&lt;%if(!window.story.state.DngDF.plum[window.passage.name]){%&gt;
A large purple fruit hangs on one branch of a broad-leafed tree. Its so heavy that it has pulled down the branch to a height where you can reach it with your hand.&lt;/br&gt;
&lt;div id=&#39;select1&#39; &gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;)&#39;&gt;harvest it&lt;/a&gt;
&lt;/div&gt;&lt;div id=&#39;choice1a&#39; hidden&gt;
As you plug the fruit from the twig, the branch snaps back to its origin.&lt;/br&gt;
That doesnt surprise you. What surprises you is the giant hornett that flys buzzing angrily out of the trees crown toward you.
&lt;a0 onclick=&#39;fightHornet();&#39;&gt;Defend yourself&lt;/a&gt;
&lt;/div&gt;
&lt;%} else {%&gt;
No more plums are growing on the trees here.&lt;/br&gt;
&lt;%}%&gt;
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="223" name="DngDF_G4" tags="" position="350,2850" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
Several large trees grow here.&lt;/br&gt;
&lt;div id=&#39;select1&#39; &gt;A small spring ripples out from between the roots.
&lt;a0 onclick=&#39;window.gm.player.Stats.increment(&quot;health&quot;,50);window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;),window.gm.refreshSidePanel()&#39;&gt;Sipping&lt;/a&gt; some of that clear water might give you back some energy.&lt;/br&gt;
&lt;/div&gt;&lt;div id=&#39;choice1a&#39; hidden&gt;You feel surprisingly refreshed after some gulps of that clear water.
&lt;/div&gt;
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngDF_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="224" name="DngDF_H4" tags="" position="475,2850" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="225" name="DngDF_F5" tags="" position="600,2850" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
&lt;%if(!window.story.state.DngDF.plum[window.passage.name]){%&gt;
A large purple fruit hangs on one branch of a broad-leafed tree. Its so heavy that it has pulled down the branch to a height where you can reach it with your hand.&lt;/br&gt;
&lt;div id=&#39;select1&#39; &gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;)&#39;&gt;harvest it&lt;/a&gt;
&lt;/div&gt;&lt;div id=&#39;choice1a&#39; hidden&gt;
As you plug the fruit from the twig, the branch snaps back to its origin.&lt;/br&gt;
That doesnt surprise you. What surprises you is the giant hornett that flys buzzing angrily out of the trees crown toward you.
&lt;a0 onclick=&#39;fightHornet();&#39;&gt;Defend yourself&lt;/a&gt;
&lt;/div&gt;
&lt;%} else {%&gt;
No more plums are growing on the trees here.&lt;/br&gt;
&lt;%}%&gt;
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngDF_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="226" name="DngDF_G5" tags="" position="725,2850" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
&lt;%if(!window.story.state.DngDF.plum[window.passage.name]){%&gt;
A large purple fruit hangs on one branch of a broad-leafed tree. Its so heavy that it has pulled down the branch to a height where you can reach it with your hand.&lt;/br&gt;
&lt;div id=&#39;select1&#39; &gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;)&#39;&gt;harvest it&lt;/a&gt;
&lt;/div&gt;&lt;div id=&#39;choice1a&#39; hidden&gt;
As you plug the fruit from the twig, the branch snaps back to its origin.&lt;/br&gt;
That doesnt surprise you. What surprises you is the giant hornett that flys buzzing angrily out of the trees crown toward you.
&lt;a0 onclick=&#39;fightHornet();&#39;&gt;Defend yourself&lt;/a&gt;
&lt;/div&gt;
&lt;%} else {%&gt;
No more plums are growing on the trees here.&lt;/br&gt;
&lt;%}%&gt;
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngDF_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="227" name="DngDF_H5" tags="" position="850,2850" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
High grass grows between sparse bushes.
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="228" name="DngDF_F6" tags="" position="975,2850" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
High grass grows between sparse bushes.
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="229" name="DngDF_G6" tags="" position="1100,2850" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
High grass grows between sparse bushes.
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="230" name="AM_MAP_Level1" tags="_back_" position="1225,2850" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
You have some kind of map from the mine:&lt;/br&gt;
&lt;pre&gt;
[E]-[A2]-[A3]      [A5]
      |             |
    [B2]-[B3]-[B4]-[B5] 
&lt;/pre&gt;
&lt;div&gt;&lt;/br&gt;[[Back|_back_]]&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="231" name="AM_Entrance" tags="" position="100,2975" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.moveHere();%&gt;
Eine dunkle Öffnung in der Felswand ist wohl der Eingang in die Mine.
&lt;div&gt;&lt;/br&gt;[[PlainsFarmland]] [[Go In|AM_Lv1_A2]]&lt;/br&gt;[[Map|AM_MAP_Level1]]&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="232" name="AM_Lv1_A2" tags="" position="225,2975" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.moveHere();%&gt;
Es wird schnell dunkler je tiefer du gehst.
&lt;div&gt;&lt;/br&gt;[[West|AM_Entrance]] [[East|AM_Lv1_A3]] [[South|AM_Lv1_B3]]&lt;/br&gt;[[Map|AM_MAP_Level1]]&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="233" name="AM_Lv1_A3" tags="" position="350,2975" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.moveHere();%&gt;
Hier ist die Decke zusammengebrochen und blockiert nun den Weg.
&lt;div&gt;&lt;/br&gt;[[West|AM_Lv1_A2]]&lt;/br&gt;[[Map|AM_MAP_Level1]]&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="234" name="AM_Lv1_B2" tags="" position="475,2975" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.moveHere();%&gt;
Ein Abzweig zum Hauptgang.
&lt;div&gt;&lt;/br&gt;[[North|AM_Lv1_A2]] [[East|AM_Lv1_B3]]&lt;/br&gt;[[Map|AM_MAP_Level1]]&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="235" name="AM_Lv1_B3" tags="" position="600,2975" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.moveHere();%&gt;
Kaum noch Licht vom Ausgang.
&lt;div&gt;&lt;/br&gt;[[West|AM_Lv1_B2]] [[East|AM_Lv1_B4]]&lt;/br&gt;[[Map|AM_MAP_Level1]]&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="236" name="AM_Lv1_B4" tags="" position="725,2975" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.moveHere();%&gt;
Die Stützbalken sind durch das eindringende Wasser vermodert.
&lt;div&gt;&lt;/br&gt;[[West|AM_Lv1_B3]] [[East|AM_Lv1_B5]]&lt;/br&gt;[[Map|AM_MAP_Level1]]&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="237" name="AM_Lv1_B5" tags="" position="850,2975" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.moveHere();%&gt;
Schwierig noch irgendwas zu sehen...ist da ein Loch im Boden?
&lt;div&gt;&lt;/br&gt;[[West|AM_Lv1_B4]] [[North|AM_Lv1_A5]]&lt;/br&gt;[[Map|AM_MAP_Level1]]&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="238" name="AM_Lv1_A5" tags="" position="975,2975" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.moveHere();%&gt;
Eine Sackgasse.
&lt;div&gt;&lt;/br&gt;[[South|AM_Lv1_B5]]&lt;/br&gt;[[Map|AM_MAP_Level1]]&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="239" name="AM_MAP_Level2" tags="_back_" position="1100,2975" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
You have some kind of map:&lt;/br&gt;
&lt;div id=&#39;canvas&#39;&gt;&lt;/div&gt;&lt;/br&gt;
Remember: If you have earned some money you should weight the option to retreat and invest that money in better gear.
That might give you better chances to survive the tougher fights at the cost of fighting the previous foes again.&lt;/br&gt;
Grinding is fun. :)  &lt;/br&gt;
&lt;div&gt;&lt;/br&gt;[[Back|_back_]]&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt; window.gm.printMap(&quot;testMap&quot;,window.gm.player.location,window.story.state.dng.arena.mapReveal);
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="240" name="AM_Lv2_Exit" tags="_back_" position="1225,2975" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;% if(window.story.state.dng.arena.enc===&#39;&#39;){ %&gt;
You finished all fights. Congratulation. Now fetch your prize and go partying.
&lt;div&gt;&lt;/br&gt;&lt;a0 onclick=&#39;leave()&#39;&gt;Collect prize&lt;/a&gt;&lt;/div&gt;
&lt;% }else{ %&gt;
Are you really going to flee from battle?
&lt;div&gt;&lt;/br&gt;&lt;a0 onclick=&#39;leave()&#39;&gt;Yes&lt;/a&gt;[[Back|_back_]]&lt;/br&gt;&lt;/div&gt;
&lt;% }%&gt;
&lt;div id=&#39;output&#39;&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;function leave(){
  var tmp=window.story.state.dng.arena;
  for(let n of tmp.loot){
    window.gm.player.changeInventory(window.gm.ItemsLib[n.id](),n.count);
  }
  window.story.show((tmp.enc===&#39;&#39;)?&#39;ForestBorder&#39;:&#39;AM_Lv2_Start&#39;);
}
function showPrize(){
  let msg=&#39;&#39;, tmp=window.story.state.dng.arena;
  for(let n of tmp.loot){
    msg+=n.count+&#39;x &#39;+window.gm.ItemsLib[n.id]().name+&#39;&lt;/br&gt;&#39;;
  }
  return msg;
}
window.gm.printOutput(showPrize());
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="241" name="AM_Lv2_Shop" tags="_back_" position="100,3100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.moveHere();%&gt; Would you like to buy something?&lt;/br&gt;[[Back|_back_]]&lt;/br&gt;
&lt;div id=&quot;choice&quot;&gt;&lt;/div&gt;&lt;/br&gt;&lt;/br&gt;   &lt;!--display buy message--&gt;
&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;&lt;/br&gt;    &lt;!--display wares list--&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
window.gm.shop.findWaresToBuy(&quot;Arena:Shop&quot;);
renderToSelector(&quot;#panel&quot;, &quot;listbuy&quot;);
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="242" name="AM_Lv2_Start" tags="" position="225,3100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;% window.gm.moveHere();window.story.state.dng.arena= window.story.state.dng.arena||{
  foundGate:0,mapReveal:0}; if((window.story.state.dng.arena.foundGate &amp; 0x3)===1){%&gt;
Deep in the dungeon you found a gate that you suspect to only open with a soulgem.
Those are quite rare. Some magicans know how to grow them in a females uterus.
Here is the plan:
*  you need a lewd mark spell on you. Some lusty demons are granting them for free.
*  But those demons only show up to those that show there debauchery. Go, grab some lewd gear from the shop.
*  then, if you are female you just need to find someone to cuddle with to get the gem growing
*  or you could court a lady and visit her often to have the gem well fed 
&lt;% } else if((window.story.state.dng.arena.foundGate &amp; 0x2)&gt;0){ %&gt;
The dungeons gate should be still open, except someone took the soulgem away.  
&lt;% } else { %&gt;
You are stuck in this dungeon and need to find your way out.
You have to challenge several enemys one by one. After each fight you may decide to return here with the loot gathered so far.&lt;/br&gt; 
If you go on and get defeated, you will loose most items you carry with you.&lt;/br&gt;
You can store loot in this chest if you dont want to risk loosing it in battle. Dont forget to gear up in the shop close by.&lt;/br&gt;
&lt;% } %&gt;
&lt;/br&gt;Are you ready for your first fight?&lt;/br&gt;
&lt;div&gt;&lt;/br&gt;[[Magic Chest|GlobalChest]] [[Shop|AM_Lv2_Shop]] [[Map|AM_MAP_Level2]] 
&lt;a href=&quot;javascript:void(0)&quot; onclick=&#39;($(&quot;tw-passage&quot;).fadeOut(1000, function(){window.gm.player.sleep(700);window.story.show(&quot;AM_Lv2_Start&quot;);}));&#39;&gt;Sleep Until Morning&lt;/a&gt;
&lt;/br&gt;&lt;a0 onclick=&#39;window.gm.fightArena(&quot;wolf&quot;,null,[{id:&quot;Money&quot;,count:30}],&quot;AM_Lv2_E3&quot;)&#39;&gt;Into battle&lt;/a&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
window.story.state.dng.arena.loot=[]; //reset flags
/*foundGate-bits:
1 = foundgate
2 = placed soulgem
4 = succubusdeal
8 = impregnated bitch
16,32,64,128 = preg-counter
*/
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="243" name="AM_SucDeal" tags="_nosave_" position="350,3100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;p class=&quot;tPC&quot;&gt;Hey you, I would like to ask you something. Do you know where to get a soulgem?&lt;/p&gt;
&lt;p class=&quot;tNPC1&quot;&gt;Soulgems? Mages want them as do others that are related to arcana. But I dont have some...unfortunatly.&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;But where can I find one? Or can they be produced somehow?.&lt;/p&gt;
&lt;p class=&quot;tNPC1&quot;&gt;If you ask how you could produce one, there is in fact a way I could help you. Soulgems can be grown in a fertile woman. It requires some help of magic to do so.&lt;/p&gt;
&lt;p class=&quot;tNPC1&quot;&gt;Thats where I come into the game: I can grant you such power.&lt;/p&gt;
Of course there is some footangle with this. She is a demon after all and you should be careful what deal you make.&lt;/br&gt;
&lt;p class=&quot;tPC&quot;&gt;What prize would you have in mind for that power?&lt;/p&gt;
&lt;p class=&quot;tNPC1&quot;&gt;My life. You defeated me and could banish me from this plane of existence. But I would like to stay a little longer. So I would repay your kindness with this gift.&lt;/p&gt;
She smiles at you and is even able to not let it look to deviously. Should you take the deal?&lt;/br&gt;
[[Deal|AM_SucDeal2]] [[No Deal|AM_Lv2_Exit]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="244" name="AM_SucDeal2" tags="_nosave_" position="475,3100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;p class=&quot;tPC&quot;&gt;What does this power exactly do and how do I use it?&lt;/p&gt;
&lt;p class=&quot;tNPC1&quot;&gt;Its a kind of arcane rune, some call it mark of the womb. If its placed on a woman and she is in an situation where she would receive a child, instead she would receive a soulgem.&lt;/p&gt;
&lt;p class=&quot;tNPC1&quot;&gt;...well a seed of a soulgem that would grow to a soulgem over time.&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;So this is only working for females?&lt;/p&gt;
&lt;p class=&quot;tNPC1&quot;&gt;Ahh, for males it would give them the opportunity to impregnate a woman with a soulgem, even if she doesnt bear the mark.&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;This sounds quite - improper ? I&#39;m not even sure I would find someone to get started with. It&#39;s not like this is a big party where a lot of nice people hang around.&lt;/p&gt;
&lt;p class=&quot;tNPC1&quot;&gt;Oh, you neccesarily dont even need people.&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;Please?&lt;/p&gt;
She smiles at you and is even able to not let it look to deviously.&lt;/br&gt;
&lt;p class=&quot;tNPC1&quot;&gt;Well, it wouldn&#39;t ultimatly require another human to get this working. A healthy goblin would do the trick too, or anything alike... &lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;I&#39;m not really getting the picture here, and I even dont want too. &lt;/p&gt;
&lt;p class=&quot;tNPC1&quot;&gt;But you are interested in it. The spell I mean. It could still be helpful.&lt;/p&gt;
&lt;a0 onclick=&#39;window.gm.player.Outfit.addItem(new window.gm.ItemsLib[&quot;LewdMark&quot;]());window.story.state.dng.arena.foundGate|=0x4;window.story.show(&quot;AM_SucDeal3&quot;);&#39;&gt;Do it&lt;/a&gt; [[I will find another way|AM_Lv2_Exit]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="245" name="AM_SucDeal3" tags="_nosave_" position="600,3100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;p class=&quot;tPC&quot;&gt;Fine, do it !&lt;/p&gt;
She smirks again and strides forward to step in front of you. Then the palm of her hand touches your stomach just below the ribs. And slides a little bit lower.&lt;/br&gt; 
&lt;p class=&quot;tPC&quot;&gt;Hey what are you...&lt;/p&gt; 
Just as you start to protest she begins to speak some strange words and your lower belly grows warm. Its not an unpleasent feeling and after a moment its gone and she takes her hand away.  
&lt;p class=&quot;tNPC1&quot;&gt;All done, now go and start making some gems. And if things aren&#39;t going like planned, just come by again. Sometimes those spells need some adjustment.&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;Thanks...I mean...I will see about that.&lt;/p&gt;
Just to make sure everthing is ok, you check your abdomen below your cloths.
&lt;p class=&quot;tPC&quot;&gt;Hey, wait whats that !?.&lt;/p&gt; you found your groin to be tattoed with some purple colored rune, shaped like some triangle in tribal style.
&lt;p class=&quot;tNPC1&quot;&gt;Thats the mark of course. Isn&#39;t it cute? Dont worry, usually it will fade away after some time.&lt;/p&gt;
That might be true, the color seem to fade away while you stare at it.&lt;/br&gt;
[[Leave|AM_Lv2_Exit]]
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="246" name="AM_Lv2_E3" tags="" position="725,3100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.moveHere();window.story.state.dng.arena.mapReveal|=10;%&gt; Are you ready for your next fight?&lt;/br&gt;
&lt;div&gt;&lt;/br&gt;[[Retreat|AM_Lv2_Exit]] [[Map|AM_MAP_Level2]]&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.fightArena(&quot;mole&quot;,{amount:2},[{id:&quot;Money&quot;,count:30}],&quot;AM_Lv2_F3&quot;)&#39;&gt;Continue to B3&lt;/a&gt; 
&lt;a0 onclick=&#39;window.gm.fightArena(&quot;huntress&quot;,null,[{id:&quot;Money&quot;,count:30}],&quot;AM_Lv2_F4&quot;)&#39;&gt;Continue to C3&lt;/a&gt;&lt;/div&gt;
&lt;a0 onclick=&#39;window.gm.fightArena(&quot;succubus&quot;,null,[{id:&quot;Money&quot;,count:30}],&quot;&lt;%=((window.story.state.dng.arena.foundGate &amp;0xF)===1)?&quot;AM_SucDeal&quot;:&quot;AM_Lv2_F5&quot;%&gt;&quot;)&#39;&gt;Continue to D3&lt;/a&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="247" name="AM_Lv2_F3" tags="_nosave_" position="850,3100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.moveHere();%&gt; 
&lt;/br&gt;[[Retreat|AM_Lv2_Exit]] [[Map|AM_MAP_Level2]]&lt;/br&gt; There is a loot chest !&lt;/br&gt;
&lt;a0 onclick=&#39;window.story.show(&quot;AM_Lv2_G3&quot;)&#39;&gt;Ignore chest&lt;/a&gt;
&lt;a0 onclick=&#39;window.gm.cursedChest(&quot;AM_Lv2_G3&quot;);window.story.show(&quot;AM_Lv2_LootChest&quot;)&#39;&gt;Open chest&lt;/a&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="248" name="AM_Lv2_G3" tags="" position="975,3100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.moveHere();%&gt; Are you ready for your next fight?&lt;/br&gt;
&lt;div&gt;&lt;/br&gt;[[Retreat|AM_Lv2_Exit]] [[Map|AM_MAP_Level2]]&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.fightArena(&quot;mole&quot;,{amount:2},[{id:&quot;Money&quot;,count:30}],&quot;AM_Lv2_H3&quot;)&#39;&gt;Continue to B5&lt;/a&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="249" name="AM_Lv2_H3" tags="" position="1100,3100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.moveHere();%&gt; Are you ready for your next fight?&lt;/br&gt;
&lt;div&gt;&lt;/br&gt;[[Retreat|AM_Lv2_Exit]] [[Map|AM_MAP_Level2]]&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.fightArena(&quot;slug&quot;,null,[{id:&quot;Money&quot;,count:30}],&quot;AM_Lv2_I3&quot;)&#39;&gt;Continue to B6&lt;/a&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="250" name="AM_Lv2_I3" tags="" position="1225,3100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.moveHere();%&gt; The path forward is blocked by a heavy gate that is somehow locked in place. There is a pedestal near it with an empty stand.&lt;/br&gt;
Maybe you have to place something there to make the gate open. A soulgem possibly. But where to get one?
&lt;div&gt;&lt;/br&gt;[[Retreat|AM_Lv2_Exit]] [[Map|AM_MAP_Level2]]&lt;/br&gt;
&lt;div id=&#39;output&#39;&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
function placeSoulGem(evt){
  let msg=&#39;You dont have a soulgem.&#39;;
  if((window.story.state.dng.arena.foundGate &amp; 0x2)&gt;0){
    msg=window.gm.printPassageLink(&quot;Pass the gate&quot;,&quot;AM_Lv2_J3&quot;);
  } else if (evt===0){
    msg=window.gm.printLink(&quot;Use soulgem&quot;,&#39;placeSoulGem(1)&#39;);
  } else if(window.gm.player.Inv.countItem(&quot;TinySoulGem&quot;)&gt;0){
    window.story.state.dng.arena.foundGate=window.story.state.dng.arena.foundGate | 0x2;
    msg=&#39;As you place the soulgem into the stand, the gate opens.&#39;;
    msg+=window.gm.printPassageLink(&quot;Pass the gate&quot;,&quot;AM_Lv2_J3&quot;);
  }
  window.gm.printOutput(msg)
}
window.story.state.dng.arena.foundGate=window.story.state.dng.arena.foundGate | 0x1;
placeSoulGem(0);
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="251" name="AM_Lv2_J3" tags="" position="100,3225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.moveHere();%&gt; And now?
&lt;div&gt;&lt;/br&gt;[[Retreat|AM_Lv2_Exit]] [[Map|AM_MAP_Level2]]&lt;/br&gt;
&lt;div id=&#39;output&#39;&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="252" name="AM_Lv2_LootChest" tags="_nosave_" position="225,3225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
You open the chest and find...&lt;div id=&#39;output&#39;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;a0 onclick=&#39;foo()&#39;&gt;Next&lt;/a&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
var foo,msg=&#39;&#39;,Items=[];
var rnd=window.story.state.tmp.args[1],next=window.story.state.tmp.args[2];   
function addLoot(){
  for(let n of Items){ msg+=n.name+&quot;, &quot;;};
  foo=function(){ window.story.state.tmp.args=[];
    for(let n of Items){window.gm.player.changeInventory(n,1);}
    window.story.show(next); //adding to inventory only if player is leaving the passage, otherwise he could glitch if switching to status-pane and back
  }
}
if(rnd&lt;10){
  Items.push(window.gm.ItemsLib.HorsePotion());
  addLoot();
} else if(rnd&gt;40){
  Items.push(window.gm.ItemsLib.HealthPotionSmall());
  if(rnd&gt;60){
    Items.push(window.gm.ItemsLib.HorsePotion());
  }
  addLoot();
} else {
  msg+=&#39;trouble !&#39;;
  foo=(function(){ window.story.state.tmp.args=[]; 
    window.gm.fightArena(&quot;mole&quot;,{amount:2},[{id:&quot;Money&quot;,count:30}],next);});
}
window.gm.printOutput(msg);
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="253" name="AM_Lv2_F5" tags="_nosave_" position="350,3225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.moveHere();%&gt; 
&lt;/br&gt;[[Retreat|AM_Lv2_Exit]] [[Map|AM_MAP_Level2]]&lt;/br&gt; There is a loot chest !&lt;/br&gt;
&lt;a0 onclick=&#39;window.story.show(&quot;AM_Lv2_F5&quot;)&#39;&gt;Ignore chest&lt;/a&gt;
&lt;a0 onclick=&#39;window.gm.cursedChest(&quot;AM_Lv2_H5&quot;);window.story.show(&quot;AM_Lv2_LootChest&quot;)&#39;&gt;Open chest&lt;/a&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="254" name="AM_Lv2_H5" tags="" position="475,3225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.moveHere();%&gt; Are you ready for your next fight?&lt;/br&gt;
&lt;div&gt;&lt;/br&gt;[[Retreat|AM_Lv2_Exit]] [[Map|AM_MAP_Level2]]&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.fightArena(&quot;slug&quot;,null,[{id:&quot;Money&quot;,count:30}],&quot;AM_Lv2_I3&quot;)&#39;&gt;Continue to B6&lt;/a&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="255" name="AM_Lv2_XX" tags="" position="600,3225" size="100,100">The exit in this room seems to be unable to reach. Its on the opposite wall and some drawbridge is pulled up. But thats not the problem.
The problem are the dense layer of long spikes sticking out of the floor several meters below you. Jumping down and walking over to the gate isnt an option.
There seems to be a lever on a platform on your left side. You an only guess that it might lower the drawbridge. But you would have to jump 4m or more to reach it, which seems to be quite far for a human.
How could anyone reach that lever without the ability to jump really far or to fly? The walls seems also to smooth unless you are a gecko.
- would there be a way to learn flying, climbing or jumping?
- could someone help me with the lever?</tw-passagedata><tw-passagedata pid="256" name="PlainsWest" tags="" position="725,3225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;window.gm.moveHere();%&gt;
Some large grassland is laid out before you. There are some bushes here and there and even group of trees.&lt;/br&gt;
[[to Forest|ForestBridge]] [[West|PlainsCrossroad]]
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;&lt;/script&gt;</tw-passagedata><tw-passagedata pid="257" name="PlainsCrossroad" tags="" position="850,3225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;window.gm.moveHere();%&gt;
The dirtroad branches in different directions and there is also a wodden post with several withered signs on it, pointing in different directions:&lt;/br&gt;
[[West: to Forest|PlainsWest]] [[East: Village|PlainsEast]]  [[NorthWest: TrumpetHills|NOP]]  [[South: Wasteland|NOP]]
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="258" name="PlainsEast" tags="" position="975,3225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;window.gm.moveHere();%&gt;
Just more grassland. In the distance you can see herds of animals, probably deer or antelope.&lt;/br&gt;
A skilled hunter could certainly earn his living here with &lt;a0 onclick=&#39;explore()&#39;&gt;hunting&lt;/a&gt;.&lt;/br&gt;
[[West: to Crossroads|PlainsCrossroad]] [[East: to Farmland|PlainsFarmland]]
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt; function explore(){
    let rnd = _.random(0,100);
    window.gm.pushLog(&quot;rolled &quot;+rnd);
    window.story.state.tmp.args = [];
    if(rnd &gt; 70 ){
        window.gm.encounters.huntress();
    }else if(rnd &gt; 50){
        let find = [&#39;PurpleBerry&#39;,&#39;ApocaFlower&#39;];
        let rnd2 = _.random(0,find.length-1);
        window.story.state.tmp.args = [find[rnd2],1]
        window.story.show(&#39;ForestSearchAround&#39;);
    }
    else {
        window.story.show(&#39;ForestSearchAround&#39;); //nothing
    }
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="259" name="PlainsFarmland" tags="" position="1100,3225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;window.gm.moveHere();%&gt;
Fields with grain and also with vegetables stretch along the road. In between are farms, barns and windmills, most of them more or less run down.&lt;/br&gt;
[[West: Plains|PlainsEast]] [[East: Village|VillageEntranceIntro]] [[NorthWest: Large Rocks|AM_Entrance]]
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="260" name="ForestSpawn" tags="" position="1225,3225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name; window.gm.enterVR();%&gt;
After the VR connects to the server, your avatar appears near the top of a hill in a magic puff. &lt;/br&gt;
&lt;div&gt;&lt;/br&gt;[[Spawn sanctum|ForestRespawnPodExit]][[Settlement|ForestBorder]]&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="261" name="ForestRespawnPodExit" tags="" position="100,3350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
You are in the sanctum of spawn. Its located on top of the hill above the settlement.&lt;/br&gt; 
&lt;/br&gt;[[Magic Chest|GlobalChest]]&lt;/br&gt;
&lt;/br&gt;Some leather bracers ly on the road.
&lt;a0 onclick=&#39;takeBracers();&#39;&gt;pickup fancy bracers&lt;/a&gt;&lt;/br&gt;&lt;a0 onclick=&#39;takeBracers2();&#39;&gt;pickup even fancier bracers&lt;/a&gt;&lt;/br&gt;
&lt;div&gt;&lt;/br&gt;[[Settlement|ForestBorder]]&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
function takeBracers(){
    let item = new window.storage.constructors[&#39;BracerLeather&#39;]();
    item = window.gm.makeCursedItem(item,{lock:true,energydrain:2});
    item = window.gm.makeBonusItem(item,{statBoost:&#39;agility&#39;, statBonus:3});
    window.gm.player.Wardrobe.addItem(item);
    window.gm.player.Outfit.addItem(item);
    this.disabled=true;
}
function takeBracers2(){
    let item = new window.storage.constructors[&#39;BracerLeather&#39;]();
    item = window.gm.makeCursedItem(item,{minItems:2,convert:&#39;GlovesRubber&#39;});
    item = window.gm.makeBonusItem(item,{statBoost:&#39;agility&#39;, statBonus:2});
    window.gm.player.Wardrobe.addItem(item);
    window.gm.player.Outfit.addItem(item);
    this.disabled=true;
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="262" name="ForestBorder" tags="" position="225,3350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.moveHere();%&gt;
&lt;!--todo--&gt; There is a dirt road here crossing the lush grassland that is bordered by the trees of an forest.&lt;/br&gt; 
One direction leads east, past a hut. The other direction follows the border of the forest but gets out of view quickly.&lt;/br&gt; 
&lt;div&gt;&lt;a0 onclick=&#39;window.gm.addTime(25);window.story.show(window.passage.name);&#39;&gt;Rest&lt;/a&gt;
[[Enter Hut|ForestAlchemistHut]] [[Into the forest|ForestEntrance]] [[follow Road|ForestBridge]] [[Up the hill|ForestRespawnPodExit]]&lt;/br&gt;
&lt;a0 onclick=&#39;enterMinoLair(); &#39;&gt;Enter Mino&#39;s Lair&lt;/a&gt;
&lt;a0 onclick=&#39;enterBeehive(); &#39;&gt;Enter Beehive&lt;/a&gt; &lt;a0 onclick=&#39;enterShatteredCity();&#39;&gt;Enter Shattered City&lt;/a&gt;&lt;a0 onclick=&#39;enterArena();&#39;&gt;Enter Arena&lt;/a&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt; function enterBeehive(){
    window.gm.dng = window.gm.dngs.BeeHive();
    window.gm.dng.enterDungeon();
}
function enterMinoLair(){
    window.gm.dng = window.gm.dngs.MinoLair();
    window.gm.dng.enterDungeon();
}
function enterShatteredCity(){
    window.gm.dng = window.gm.dngs.ShatteredCity();
    window.gm.dng.enterDungeon();
}
function enterArena(){
    window.gm.dng = window.gm.dngs.ArenaTrialsNo1();
    window.gm.dng.enterDungeon();
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="263" name="ForestSearchAround" tags="_back_" position="350,3350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;% let args = window.story.state.tmp.args; if(args[0]===&#39;PurpleBerry&#39; &amp;&amp; args[1]&gt;0){ window.gm.player.Inv.addItem(window.gm.ItemsLib[args[0]](),args[1]); %&gt;
On a secluded spot you found a batch of berry bushes. Most of them dont have any more berrys but you are able to collect a handful.&lt;/br&gt;
&lt;%} else if(args[0]===&#39;PurpleBerry&#39;){%&gt;
There arent any purple berrys left. You have to search on a different place.&lt;/br&gt;
&lt;%} else if(args[0]===&#39;ApocaFlower&#39; &amp;&amp; args[1]&gt;0){ window.gm.player.Inv.addItem(window.gm.ItemsLib[args[0]](),args[1]);%&gt;
You found some pretty flowers with blue and yellow blossoms.&lt;/br&gt;
&lt;%} else {%&gt;
Unfortunatly you didnt find anything useful.&lt;/br&gt;
&lt;%}%&gt;
&lt;div&gt;&lt;/br&gt;[[Next|_back_]]&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="264" name="ForestWolfEncounter" tags="_back_" position="475,3350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;% window.gm.quests.addQuest(&quot;qWolfMate&quot;,1); if(window.gm.quests.getMilestoneState(&quot;qWolfMate&quot;).id&lt;=1){%&gt;
Distracted by rummaging around in the bushes, you just caught by surprise as you turn around.&lt;/br&gt;
A dog is staring into your face. Its looks very close to a wolf you think. But wolfs would stay away from humans.
&#39;Oh wait, I&#39;m in a game. In games wolves are nether to shy to attack.&#39;
The wolf doesnt do a thing, just stands there and looks at you.
&lt;div id=&#39;select1&#39; &gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;)&#39;&gt;First strike&lt;/a&gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1b&quot;)&#39;&gt;Dont move&lt;/a&gt;
&lt;/div&gt;
&lt;div id=&#39;choice1a&#39; hidden&gt;
I&#39;m in this game right now for how long and havent killed anything? &lt;/br&gt;
Lets get started to earn some XP. &lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.encounters.wolf()&#39;&gt;Next&lt;/a&gt;
&lt;/div&gt;
&lt;div id=&#39;choice1b&#39; hidden&gt;
There is nearly no chance in real life to accidently run into a wolf. So lets saviour that thrilling feeling even if this is not reallity.&lt;/br&gt;
That wolf is around 1m large from tip to toe. It has a dark gray fur with some darker areas on its back and feet.&lt;/br&gt;
Dark yellow eyes stare into your own and you stare back.&lt;/br&gt;
...Which provokes the wolf to attack...  
&lt;a0 onclick=&#39;window.gm.encounters.wolf()&#39;&gt;Next&lt;/a&gt;
&lt;/div&gt;
&lt;%} else {%&gt;
There is a wolf again. Or is it the same?&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.encounters.wolf()&#39;&gt;Next&lt;/a&gt;
&lt;%}%&gt;&lt;/br&gt;
&lt;%=(window.story.state._gm.debug)?(&quot;[[Skip|_back_]]&quot;):(&quot;&quot;)%&gt;&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="265" name="ForestEntrance" tags="" position="600,3350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.moveHere();%&gt;
The forest makes a friendly impression.&lt;/br&gt; The trees are still light and are not yet as expansive and large as that no more light can get through the canopy.&lt;/br&gt; 
Maybe you can &lt;a0 onclick=&#39;explore(); &#39;&gt;explore&lt;/a&gt; the surrounding woods and see if you can find anything useful.&lt;/br&gt;
&lt;div&gt;&lt;/br&gt;[[ForestBorder]] [[ForestCliff]] &lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt; function explore(){
    let rnd = _.random(0,100);
    window.gm.pushLog(&quot;rolled &quot;+rnd);
    window.story.state.tmp.args = [];
    if(window.gm.quests.getMilestoneState(&quot;qDiedAgain&quot;).id&lt;=2 &amp;&amp; window.gm.player.Inv.countItem(&#39;PurpleBerry&#39;)&gt;=2){
        window.story.state.tmp.args = [&#39;PurpleBerry&#39;,0];window.story.show(&#39;ForestSearchAround&#39;); //find nothing !
    } else if(!window.gm.quests.hasActiveQuest(&quot;qCarlia&quot;) &amp;&amp; window.gm.player.Inv.countItem(&#39;PurpleBerry&#39;)&gt;=3){
        window.story.show(&#39;ForestMeetCarlia1&#39;);
    } else if(window.gm.quests.getMilestoneState(&quot;qCarlia&quot;).id===100 &amp;&amp; window.gm.player.Inv.countItem(&#39;PurpleBerry&#39;)&gt;=4){
        window.story.show(&#39;ForestMeetCarlia2&#39;);
    } else if(window.gm.quests.getMilestoneState(&quot;qCarlia&quot;).id===500 &amp;&amp; window.gm.player.Inv.countItem(&#39;SquishedLeech&#39;)&gt;=1){
        window.story.show(&#39;ForestMeetCarlia3&#39;);
    } else if(rnd &gt; 70 ){
         window.story.show(&#39;ForestWolfEncounter&#39;);
    } else if(rnd &gt; 65 ){
         window.story.show(&#39;ForestMudGlade&#39;);
    }else if(rnd &gt; 20){ //todo limit berys per day
        let find = [&#39;PurpleBerry&#39;,&#39;PurpleBerry&#39;,&#39;ApocaFlower&#39;];
        let rnd2 = _.random(0,find.length-1);
        window.story.state.tmp.args = [find[rnd2],1]
        window.story.show(&#39;ForestSearchAround&#39;);
    }
    else {
        window.story.show(&#39;ForestSearchAround&#39;); //nothing
    }
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="266" name="ForestMeetCarlia1" tags="_nosave_ _back_" position="725,3350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
Standing around and thinking where to go next, you get the feeling of beeing watched.&lt;/br&gt;
You listen carefully but can&#39;t pickup any unusual noise or other sign that something is sneaking up on you.&lt;/br&gt;&lt;/br&gt;
Then you turn around.&lt;/br&gt;&lt;/br&gt;
Nothing.&lt;/br&gt;
You turn slowly and let your eyes wander. &lt;/br&gt;
That tree there, did you just see something vanishing behind it?&lt;/br&gt;&lt;/br&gt;
&lt;/br&gt;&lt;div&gt; &lt;a0 onclick=&#39;window.gm.quests.addQuest(&quot;qCarlia&quot;,100);window.story.show(&quot;_back_&quot;);&#39;&gt;Next&lt;/a&gt;&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="267" name="ForestMeetCarlia2" tags="_nosave_ _back_" position="850,3350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
Again you have the feeling on beeing watched, maybe you also heard some rustling in one of those bushes behind you.&lt;/br&gt;
You decide to go onward. Some way ahead are several large trees and as you already know one of them has a large hollow.&lt;/br&gt;
As you make your way through the trees, as soon as you think you are out of line of sight, you hide into the musty opening and fall silent.&lt;/br&gt;
Holding your breath, you listen carefully.The birds are singing and the wind lets the leaves rustle but nothing else.&lt;/br&gt;
You wait a minute and just as you decide to get back on your way, you hear a dry twig breaking some meters back where you came from.&lt;/br&gt;
&lt;div id=&#39;select1&#39; &gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;)&#39;&gt;Jump out of your cover&lt;/a&gt;
&lt;/div&gt;&lt;div id=&#39;choice1a&#39; hidden&gt;&lt;/br&gt;
Ejecting yourself out of your cover and facing the direction of the noise, you can discern a figure trying to hide in the shadow of a tree trunk.
Your eyes need to adapt a moment and in that moment the figur starts running away.
&lt;p class=&quot;tPC&quot;&gt;&quot;Hey you wait !&quot;&lt;/p&gt;
But however it was has vanished in the undergrow.
You werent sure what you saw, but it seemed to be around your size and was moving upright. The murky cloak it was wearing preented to see more details.
&lt;p class=&quot;tPC&quot;&gt;&#39;So I were right, someone is hiding around. If I can follow their trail, I might find out who it is.&#39;&lt;/p&gt;
The figure was running into the direction of the cliff. But that might also be a diversion.
&lt;div&gt; &lt;a0 onclick=&#39;window.gm.quests.forceQuestMilestone(&quot;qCarlia&quot;,200,100);window.story.show(&quot;_back_&quot;);&#39;&gt;Next&lt;/a&gt;&lt;/br&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="268" name="ForestMeetCarlia3" tags="_nosave_ _back_" position="975,3350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
While scrutinizing a bush for further treasues, you hear something plop down on the grassy floor some distance behind you.&lt;/br&gt;
You swirl around to see whats going on and find yourself confronted with that hooded figure that you already tried to catch.&lt;/br&gt;
Now it is leering at you in a half crouching stand.&lt;/br&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;Hey you, why are you pursuing me ! How are you?&quot;&lt;/p&gt;
&quot;Thief ! You are thief !&quot; the figure shouts and adds a long growl. &lt;/br&gt;
&lt;p class=&quot;tPC&quot;&gt;&#39;Did he just growl at me like a dog? What is this?&#39;&lt;/p&gt;
&quot;Give back what stolen !&quot;&lt;/br&gt;
&lt;p class=&quot;tPC&quot;&gt;&#39;I didnt steal anything !&#39;&lt;/p&gt;
&quot;Liar! You took necklace! Give back!&quot;&lt;/br&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;That damned collar? I didnt mean to take it! It just got alive and wrapped itself around my neck. What the heck is this?&quot;&lt;/p&gt;
&quot;Its present! Give back!&quot;&lt;/br&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;I would gladly do so if you an tell me how to get rid of it! Do you have a key?&quot;&lt;/p&gt;
&quot;No key. Just unlatch.&quot;&lt;/br&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;I already tried but its not giving. The guy from the hut said it might be cursed!&quot;&lt;/p&gt;
&quot;Not unlatch? ...Maybe need magic perfom.&quot; you can here it muttering.&lt;/br&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;Huh? Is it cursed? With what?&quot;&lt;/p&gt;
&quot;Depends&quot;&lt;/br&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;Depends? Depends on what? Do you know how to get it off or not?&quot;&lt;/p&gt;
&quot;Wear some time and you will see. Might unlatch if curse finished.&quot;&lt;/br&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;Aahrg! Listen. You want it back and I want to get rid of it. So why dont we help each other? &quot;&lt;/p&gt;
&quot;No help no. You thief!&quot;&lt;/br&gt;
With that, the figure jumps up and runs away diving through the undergrowth with a good amount of speed.
You hurry after it but its of no use, at some point your target vanishs behind some close standing trees.&lt;/br&gt; 
&lt;div&gt; &lt;a0 onclick=&#39;window.gm.quests.forceQuestMilestone(&quot;qCarlia&quot;,600,500);window.story.show(&quot;_back_&quot;);&#39;&gt;Next&lt;/a&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="269" name="ForestMeetCarlia4" tags="_nosave_" position="1100,3350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
The cloaked pursuer drops from a thick branch just above your head as you pass by below it.&lt;/br&gt;
Pouncing on you, you get knocked over and the figure is stradling you on your back.
You hear a &#39;rawr&#39; and feel the choker been pulled thight. Either it want to choke you or to rip of the collar around your neck.
Trashing around with your legs, you land a diverting hit and prepping yourself up from the ground with one hand, you can push the figure off from you.
You get hold on the cloak while both of you struggle to get up to the feet before the other. 
As you pull hard on the cloth to stop your assailant from getting up, you an feel something give away.
&quot;Thief stealing cloth  RAAWWR!&quot;
You are still on the ground and look up at her. Indeed, its not a he but a she.
She is wearing some kind of bikini bottom made of coarse cloth and a small satchel on a long lether strap dangles at her hip.
Otherwise she is nude, you get a good view of her small bossom from down here.
Her round face has some distinct cat-like features like the snub nose and pointed ears that are now folded against her skull.
She bares several small but sharph looking teeth.
&lt;p class=&quot;tPC&quot;&gt;&quot;What the hell are you?&quot;&lt;/p&gt;
With that, the enraged cat-girl pounces at you with her outstretched hands, adorned with razor-sharph extended claws. 
&lt;div&gt; &lt;a0 onclick=&#39;window.story.show(&quot;_back_&quot;);&#39;&gt;Next&lt;/a&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="270" name="CarliaMakeDeal" tags="_nosave_" position="1225,3350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
You dive under Calias claw as she trys to land another hit.&lt;/br&gt;
At the same time - either because you have some hidden wrestler champion skill or by pure accident - you bring her down face first by tripping a feet.
Now its your time to pounce on her back. Gripping her wrists with your hands and using your legs to keep hers in check, you can keep her face down on all fours.  
&lt;p class=&quot;tPC&quot;&gt;&#39;And now what?&#39;&lt;/p&gt;
As soon as you let go she will either be up and away or give you some nasty scratching. She is struggling against you pinning her down.
&lt;div id=&#39;select1&#39; &gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;)&#39;&gt;She is quite in a vulnerable position...&lt;/a&gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1b&quot;)&#39;&gt;Lets try to talk some sense into her.&lt;/a&gt;
&lt;/div&gt;&lt;div id=&#39;choice1a&#39; hidden&gt;
&lt;/br&gt;That bottom of hers rubbing against your groin is quite a diversion.
&lt;p class=&quot;tPC&quot;&gt;&#39;I wonder how far I could go in that game..&#39;&lt;/p&gt;
Maybe she picked up your thoughts or she just run out of endurance. But she stopped struggling for the most and started to snuffle and sob.
&lt;p class=&quot;tPC&quot;&gt;&#39;Damn, those sobs a really getting onto me. Am I realy such a bad guy to force myself onto her?&#39;&lt;/p&gt;
&lt;div id=&#39;choice1a_&#39;&gt;&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#choice1a_&quot;,&quot;div#choice1b&quot;)&#39;&gt;Be kind&lt;/a&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#39;choice1b&#39; hidden&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;Hey stop kicking and listen ! I dont want to hurt you.&quot;&lt;/p&gt;
After a minute or so, she indeed reduces her struggeling. 
&quot;You are meany. Let me go&quot;
&lt;p class=&quot;tPC&quot;&gt;&quot;Hey..YOU attacked ME, remember? If I let go, do you promise to not attack me? You can also get your cloak back.&quot;&lt;/p&gt;
Snuffeling she seems to think about this.
&quot;Fine. I promise. But give cloak back yes?&quot;
&lt;p class=&quot;tPC&quot;&gt;&#39;She might tell me anything to get out of the situation. But what other choice do I have.&#39;&lt;/p&gt;
So you let her wrist go, push your self up and hurriedly back away some distance. She rises to her feetquickly but doesnt run away, maybe because you still haver her cloth.
&lt;p class=&quot;tPC&quot;&gt;&quot;Here, I will give you your cloth. But first you explain who you are and why you follow me around.&quot;&lt;/p&gt;
&quot;Name is Carlia.&quot;
....
&lt;p class=&quot;tPC&quot;&gt;&quot;Just as you want that choker back I want to get rid of it. Lets help each other. I will see to get you some home in favor for your trust.&quot;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&#39;Maybe the alchemist could help again. Who else could I ask?&#39;&lt;/p&gt; 
With that thought in mind you leave Carlia behind.&lt;/br&gt; 
&lt;a0 onclick=&#39;window.gm.quests.forceQuestMilestone(&quot;qCarlia&quot;,700,600);window.story.show(&quot;ForestCliff&quot;);&#39;&gt;Next&lt;/a&gt;
&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="271" name="ForestMudGlade" tags="" position="100,3475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
This area of the forest seems to be more watery and sludgy. Your feet sink into the muddy soil.
&lt;a0 onclick=&#39;explore();&#39;&gt;Searching around&lt;/a&gt; might only get you wet and dirty.&lt;/br&gt;
&lt;div&gt;&lt;/br&gt;[[ForestEntrance]] &lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt; function explore(){
    let rnd = _.random(0,100);
    window.gm.pushLog(&quot;rolled &quot;+rnd);
    window.story.state.tmp.args = [];
    if(rnd &gt; 0 ){
         window.story.show(&#39;ForestLeechEncounter&#39;);
    } else {
        window.story.show(&#39;ForestSearchAround&#39;); //nothing
    }
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="272" name="ForestLeechEncounter" tags="_back_" position="225,3475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;% if(true){%&gt;
Some sludgy leeches are crawling up your legs, each easily long as a hand !&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.encounters.leech(window.gm.player.location,_.random(1,3))&#39;&gt;Next&lt;/a&gt;
&lt;%}%&gt;&lt;/br&gt;
&lt;%=(window.story.state._gm.debug)?(&quot;[[Skip|_back_]]&quot;):(&quot;&quot;)%&gt;&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="273" name="ForestDryadEncounter" tags="_back_" position="350,3475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;% if(true){%&gt;
As you make your way through the trees, a strange woman-like figure steps out behind one of them !&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.encounters.dryad(window.gm.player.location,_.random(1,3))&#39;&gt;Next&lt;/a&gt;
&lt;%}%&gt;&lt;/br&gt;
&lt;%=(window.story.state._gm.debug)?(&quot;[[Skip|_back_]]&quot;):(&quot;&quot;)%&gt;&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="274" name="ForestCliff" tags="" position="475,3475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.moveHere();%&gt;
&lt;% if(window.gm.quests.getMilestoneState(&quot;qDiedAgain&quot;).id===2){ %&gt;
You fight your way through the dense undergrowth and realize just in time that you have reached the edge of a cliff.&lt;/br&gt; 
&lt;div id=&#39;select1&#39; &gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;)&#39;&gt;Peak into the chasm&lt;/a&gt;
&lt;/div&gt;
&lt;div id=&#39;choice1a&#39; hidden&gt;&lt;/br&gt;
There is a slab of rock from which you should be able to look down quite well.&lt;/br&gt;
You look carefully over the edge. It&#39;s not a real abyss, but a pretty steep, rocky slope. &lt;/br&gt;
&#39;I&#39;m not climbing down there now.&#39; you think when you want to go back to the forest. &lt;/br&gt;
&lt;div id=&#39;select2&#39; &gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select2&quot;,&quot;div#choice2a&quot;)&#39;&gt;Next&lt;/a&gt;
&lt;/div&gt;
&lt;div id=&#39;choice2a&#39; hidden&gt;&lt;/br&gt;
The rock slab is not so rock-solid and just as you turn around it begins to tip into the abyss. 
Unfortunatly, your jump-ability isn&#39;t quite good enough. The slab drags you down with it.&lt;/br&gt;
At some point you see a massive rock coming onto you, reaching out with your hands to stop it squishing you.
&lt;div id=&#39;select3&#39; &gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select3&quot;,&quot;div#choice3a&quot;)&#39;&gt;Next&lt;/a&gt;
&lt;/div&gt;
&lt;div id=&#39;choice3a&#39; hidden&gt;&lt;/br&gt;
But of course its futile trying to catch that crushing weight. &lt;/br&gt;  
You dont feel any pain, everything is just going &lt;a0 onclick=&#39;window.gm.respawn();&#39;&gt;black&lt;/a&gt; as if pulling the cord from a TV.&lt;/br&gt;  
&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;% } else if(window.gm.quests.getMilestoneState(&quot;qCarlia&quot;).id===200){ %&gt;
Walking along the edge of the cliff, you check the ground. Maybe you can find some footprints or something that would help you track down the figure that stalked you.
And really you can find one footprint in the muddy leftovers of a rain puddle. 
&lt;p class=&quot;tPC&quot;&gt;&#39;It looks like from a boot - is it my own? No, mine is not as broad but longer&#39; &lt;/p&gt;
You go forward where you would guess someone would be walking, carefully watching not to miss another clue or falling down the cliff. 
&lt;a0 onclick=&#39;window.gm.quests.forceQuestMilestone(&quot;qCarlia&quot;,300,200);window.story.show(&quot;ForestCliff&quot;);&#39;&gt;Next&lt;/a&gt;&lt;/br&gt;
&lt;% } else {%&gt;
&lt;div&gt;
A path leads along the cliff until it vanishs into a [[cave entrance|ForestCliffCave]] .  
Or you might just return to [[ForestEntrance]]. &lt;/br&gt;&lt;/div&gt; 
&lt;%}%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="275" name="ForestCliffCave" tags="" position="600,3475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.moveHere();%&gt;
&lt;% if(window.gm.quests.getMilestoneState(&quot;qBondageKink&quot;).id&lt;=1 &amp;&amp; window.gm.quests.getMilestoneState(&quot;qCarlia&quot;).id===300){ %&gt;
At some point the small path leads further downward the cliff, makes a curve and ends in front of a cave.&lt;/br&gt;
The cave entrance is possibly 5m in width and around 3m at its heighest point. It tapers while it goes inside the cliff but maybe it doesnt end soon, its just to dark to see if it goes on. 
Someone made himself a home here. There is a small fireplace with burned up charcoal and a sleeping mat.&lt;/br&gt;
As you snoop around you find a worn bag or satchel made of leather and fur.&lt;/br&gt;
It could give you some information about its owner if you take a look at it.&lt;/br&gt;
&lt;div id=&#39;select1&#39; &gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;)&#39;&gt;Peek inside&lt;/a&gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1b&quot;)&#39;&gt;or dont&lt;/a&gt;
&lt;/div&gt;&lt;div id=&#39;choice1a&#39; hidden&gt;
After undoing the clasp, you carefuly peek inside the bag.
&lt;p class=&quot;tPC&quot;&gt;&#39;I&#39;m not going to stick my hand in it - better safe then sorry.&#39;&lt;/p&gt;
Just as you think those smartass-words, something bursts out of the depths of the satchel into your face.&lt;/br&gt;
You stumble backwards in surprise, letting the bag fall to the ground and trying to grab whatever is now moving around on your front.&lt;/br&gt;
The uneven floor lets you loose your footing and you fall on your back beeing stunned just for an blink of an eye.&lt;/br&gt;
But in this moment, the snake - you guess - squirms up around your neck and ... enclose it ??&lt;/br&gt;
Using both hands to feel up around your neck, trying to get an idea what is now circling it. It doesnt move anymore and thats a good sign, right?&lt;/br&gt;
You feel a ring made from some rigid material, most likely leather. The surface is mostly smooth and flat. Its broad as a thumb but only half a cm thick.&lt;/br&gt;
&#39;Its some kind of choker. How do I get it off ?!&#39; &lt;/br&gt; 
You cant make out a latch or buckle.&lt;/br&gt; Fitting 2 fingers between it and your throat is barely possible without choking yourself&lt;/br&gt;
Maybe you can ask someone for help.&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.player.Outfit.addItem(new window.gm.ItemsLib[&quot;CollarQuest&quot;]());window.gm.quests.forceQuestMilestone(&quot;qCarlia&quot;,500,300);window.gm.quests.forceQuestMilestone(&quot;qBondageKink&quot;,100,1);window.story.show(&quot;ForestCliff&quot;)&#39;&gt;Leave&lt;/a&gt;
&lt;/div&gt;
&lt;div id=&#39;choice1b&#39; hidden&gt;
Come on, what kind of adventurer are you? How will you ever get good loot if you dont open every chest and jar you find - or stinky old leatherbags.
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#choice1b&quot;,&quot;div#choice1a&quot;)&#39;&gt;Peek inside&lt;/a&gt;
&lt;/div&gt;
&lt;% } else {%&gt;
&lt;div&gt;
The path leads up to [[ForestCliff]] or further down to a [[river|NOP]]. &lt;/br&gt;&lt;/div&gt; 
&lt;%}%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="276" name="ForestOldForest" tags="" position="725,3475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.moveHere();%&gt;
&lt;!--todo--&gt; Very old oak-trees grow here with thick branches forking out of the large trunks several meters above the ground. Equally large roots dig into the humid soil. &lt;/br&gt; 
The leaf canopy is dense but in some places bundles of sun rays reach the forest floor.
&lt;/br&gt; &lt;a0 onclick=&#39;explore();&#39;&gt;Explore&lt;/a&gt;&lt;/br&gt;
&lt;div&gt;[[ForestMudGlade]]&lt;/br&gt;&lt;/div&gt; 
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt; function explore(){
    let rnd = _.random(0,100);
    window.gm.pushLog(&quot;rolled &quot;+rnd);
    window.story.state.tmp.args = [];
    if(rnd &gt; 0 ){
         window.story.show(&#39;ForestDryadEncounter&#39;);
    } else {
        window.story.show(&#39;ForestSearchAround&#39;); //nothing
    }
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="277" name="ForestStoneCircle" tags="" position="850,3475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.moveHere();%&gt;
&lt;!--todo--&gt; Out of the dense undergrowth you step into a clearing. This would be an idyllic place if it weren&#39;t for this creepy stone circle.&lt;/br&gt; 
&lt;/br&gt; 
&lt;% if(true){ %&gt;
&lt;div id=&#39;select1&#39; &gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;)&#39;&gt;Inspect stone circle&lt;/a&gt;
&lt;/div&gt;
&lt;div id=&#39;choice1a&#39; hidden&gt;
Du gehst zu den übermannsgroßen Steinen. Es scheint hier etwas kühler zu sein und etwas Nebel liegt in der Luft.
Ansonsten gibt es hier nichts.&lt;/br&gt;
[[Leave|NOP]]
&lt;/div&gt;
&lt;% } else {%&gt;
&lt;div&gt;[[ForestEntrance]]&lt;/br&gt;&lt;/div&gt; 
&lt;%}%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="278" name="ForestAlchemistHut" tags="name:shaby_hut" position="975,3475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.moveHere();%&gt;
&lt;p class=&quot;tPC&quot;&gt;&lt;/p&gt;&#39;Puh, what a stink. I shouldnt stay here for long for I might suffocate&#39;&lt;/p&gt;
&lt;!--&quot;About that cake we talked earlier - what kind of cake are we speaking about.&quot;&lt;p class=&#39;tPC&#39;&gt;NOO CAKE !&lt;/p&gt;--&gt;
&lt;a0 onclick=&#39;window.gm.player.Inv.addItem(new window.gm.ItemsLib[&quot;KeyRestraintA&quot;]());&#39;&gt;pickup small key&lt;/a&gt;
&lt;% if(window.gm.quests.getMilestoneState(&quot;qPurpleBerry&quot;).id&gt;=100){%&gt;
&lt;a0 onclick=&#39;window.gm.player.Inv.removeItem(&quot;PurpleBerry&quot;,5);window.gm.player.Inv.addItem(new window.gm.ItemsLib[&quot;HealthPotionSmall&quot;](),1);window.gm.refreshAllPanel();&#39; &lt;%=(window.gm.player.Inv.countItem(&quot;PurpleBerry&quot;)&gt;=5)?(&quot;&quot;):(&quot;hidden&quot;)%&gt;&gt;Trade 5 purple berries for 1 health-potion&lt;/a&gt;&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.player.Inv.removeItem(&quot;PurpleBerry&quot;,5);window.gm.player.Inv.addItem(new window.gm.ItemsLib[&quot;HorsePowerPotion&quot;](),1);window.gm.refreshAllPanel();&#39; &lt;%=(true)?(&quot;&quot;):(&quot;hidden&quot;)%&gt;&gt;Trade xxx for 1 HorsePower-Draft&lt;/a&gt;
&lt;%}%&gt;
&lt;div&gt;&lt;/br&gt;[[Outside|ForestBorder]]  [[Alchemist|ForestAlchemistTalk]]&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="279" name="ForestBridge" tags="" position="1100,3475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.moveHere();%&gt;
&lt;% if(window.gm.quests.getMilestoneState(&quot;qBondageKink&quot;).id&lt;100){ %&gt;
Somehow you cant go into this direction. Maybe this route unlocks later.
[[Leave|ForestBorder]]
&lt;% } else if(window.gm.quests.getMilestoneState(&quot;qBondageKink&quot;).id&lt;=200){ %&gt;
&lt;p class=&quot;tPC&quot;&gt;&#39;I guess this road leads to that town the alchemist mentioned.&#39;&lt;/p&gt;
You follow the path until after a curve a wooden bridge comes into view.
The bridge spans about the canyon,a deep chasm between the forest and the eastern area thereof.&lt;/br&gt;
You carefully set a foot on it, so far it looks stable enough to carry ones weight.
&lt;div id=&#39;select1&#39; &gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;)&#39;&gt;Go on&lt;/a&gt;
&lt;/div&gt;
&lt;div id=&#39;choice1a&#39; hidden&gt;
When you have half of the bridge behind you, a large figure steps into view.&lt;/br&gt;
&quot;Stop. You have to pay a fee to pass the bridge.&quot; it shouts over to you.
Squinching your eyes and slowing down your steps, you try to get a better view of that hindrance.&lt;/br&gt; &lt;!--todo--&gt;
&lt;p class=&#39;tPC&#39;&gt;&quot;A fee? I didnt see a sign. Who are you?&quot; &lt;/p&gt;
&lt;p class=&quot;tNPC1&quot;&gt;&quot;There is no sign yet beause...we where busy with...bridge repair. You give ...20coin and then you may pass.&quot;&lt;/p&gt;
&lt;span class=&quot;tPC&quot;&gt;&#39;Looks more like highwayman then a craftsman&#39;&lt;/span&gt; you think to yourself. &lt;/br&gt;
&lt;div id=&#39;select2&#39; &gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select2&quot;,&quot;div#choice2a&quot;)&#39;&gt;Cant pay&lt;/a&gt;
&lt;/div&gt;
&lt;div id=&#39;choice2a&#39; hidden&gt;
&lt;p class=&#39;tPC&#39;&gt;&quot;I cant pay you, I have nothing of value.&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC1&quot;&gt;&quot;Then, just turn around and walk back before I force you to do so.&quot;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&#39;I could tackle him. I bet he wouldnt take the risk of a fight if he is alone and cant expect some loot from me.&#39;&lt;/p&gt;
&lt;p class=&quot;tNPC1&quot;&gt;&quot;Nice collar. So you are a slave? Maybe you have fled from your master huh? I should just take you into custody for some reward - SLAVE.&quot;&lt;/p&gt;
&lt;div id=&#39;select3&#39; &gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select3&quot;,&quot;div#choice3a&quot;);&#39;&gt;&quot;I&#39;m not a slave!&quot;&lt;/a&gt;
&lt;/div&gt;
&lt;div id=&#39;choice3a&#39; hidden&gt;
While you scream at your offender, he bolts forward trying to knock you over.&lt;/br&gt;
You are in a &lt;a0 onclick=&#39;window.gm.quests.forceQuestMilestone(&quot;qBondageKink&quot;,300,200);window.gm.encounters.Trent(window.gm.player.location)&#39;&gt;fight!&lt;/a&gt;&lt;/br&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;% } else if(window.gm.quests.getMilestoneState(&quot;qBondageKink&quot;).id&lt;=300){ %&gt;
Carefully approaching the bridge, you are scanning the surrounding.&lt;/br&gt;
Trent is over there, watching that no one passes the bridge without payment. &lt;/br&gt;
At least two other people are sitting around a firepit near the eastern end of the bridge.&lt;/br&gt;
Maybe you can [[speak up to him|TrentTalk]].&lt;/br&gt;
[[Leave|ForestBorder]] &lt;/br&gt;
&lt;% } else {%&gt;
A large bridge made of wood crosses a deep canyon that separates the forest from the land east of it.&lt;/br&gt;
&lt;div&gt;[[to Forest|ForestBorder]] [[to Plains|PlainsWest]]. &lt;/br&gt;&lt;/div&gt;
&lt;%}%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="280" name="TrentTalk" tags="" position="1225,3475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
Trent the horse-man is leaning at the handrail of the bridge and says with a smug grin: &lt;/br&gt;
&lt;p class=&quot;tNPC1&quot;&gt;&quot;There you are again. Are you here for another lesson?&quot;&lt;/p&gt;
&lt;div&gt; [[Leave|ForestBridge]] [[offer him something]] &lt;a0 onclick=&#39;window.gm.encounters.Trent(window.gm.player.location);&#39;&gt;wrestle with him(again)&lt;/a&gt;&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="281" name="VillageEntranceIntro" tags="" position="100,3600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;!--todo--&gt; A neat little village comes into view as you make your way along the dirtroad.&lt;/br&gt;
Someone has painted &#39;Thetain&#39; on the planks above the wooden gate. Most likely thats the name of this commune.&lt;/br&gt;
&#39;I wonder if I can really visit those houses or if they are just scenery of the game.&#39;
&lt;div&gt;&lt;/br&gt;
[[Continue|VillageMarketPlace]]&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="282" name="VillageEntrance" tags="" position="225,3600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.moveHere();%&gt;
&lt;!--todo--&gt; You are at the entrance to the town Thetain.
&lt;/br&gt;&lt;/br&gt;
&lt;div&gt;&lt;/br&gt;
[[Enter village|VillageMarketPlace]]  [[leave village|PlainsFarmland]] [[Spawn sanctum|VillageRespawnPodExit]]&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="283" name="VillageMarketPlace" tags="" position="350,3600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.moveHere();%&gt;
&lt;!--todo--&gt; No people can be seen around the place right now.&lt;/br&gt; There seems to be a smithy, a Inn and another shop where you cant say what kind of wares - if any - they are trading.&lt;/br&gt;
&lt;/br&gt; Near the entrance of the Inn is also a [[bulletin-board|VillageBlackboard]]. 
&lt;div&gt;&lt;/br&gt;
[[Gate|VillageEntrance]] [[Inn|VillageInn]] [[Smithy|VillageSmithy]] [[Shop|VillagePawnshop]]&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="284" name="VillageBlackboard" tags="_back_" position="475,3600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
Some tattered notes are pinned to the board: &lt;/br&gt;
&lt;hr&gt; Farmhand needed &lt;/br&gt; Someone is searching for help with their farm work.&lt;/br&gt; &quot;I&#39;m here for adventure,not boring work !&quot;&lt;/br&gt;
&lt;div&gt;&lt;/br&gt;
[[Leave|_back_]]&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="285" name="VillageInn" tags="" position="600,3600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.moveHere();%&gt;
&lt;!--todo--&gt; &#39;This really looks like they scavenged that place from a typical fantasy story book.&#39;&lt;/br&gt; 
&lt;p class=&quot;tPC&quot;&gt;&quot;Hello, uhm... lady. I would like to ask if you know someone who could have some knowledge about magic.&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC1&quot;&gt;&quot;Actually, there was some kind of scholar that we had hosted here. I&#39;m a little bit worried because she didnt show up again since nearly 2 days.&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC1&quot;&gt;Could you try to find her? She was asking everyone out about the ruins north of the town. I guess she went there.&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;Ruins, eh? Sounds like another quest to me.&quot;&lt;/p&gt;
&lt;&lt;p class=&quot;tNPC1&quot;&gt;&quot;Please ?!&quot;&lt;/p&gt;&gt;
&lt;div&gt;&lt;/br&gt;[[Square|VillageMarketPlace]] [[Innkeeper|NOP]] &lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt; &lt;/script&gt;</tw-passagedata><tw-passagedata pid="286" name="VillagePawnshop" tags="" position="725,3600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.moveHere();%&gt;
&lt;!--todo--&gt; If this is a shop, then they sell everything: Shoes, cooking pans, assault ballista and chicken.&lt;/br&gt; 
&lt;!--todo--&gt;On the other side of the room is a large [[Wardrobe]] with a [[Mirror]] where you can take a look at yourself.&lt;/br&gt;
&lt;div id=&quot;choice&quot;&gt;&lt;/div&gt;&lt;/br&gt;  &lt;!--display buy message--&gt;
&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;    &lt;!--display wares list--&gt;
&lt;div&gt;&lt;/br&gt; [[Buy]] or [[Sell]] something.&lt;/br&gt;
[[Square|VillageMarketPlace]]  [[Shopkeeper|NOP]]&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;&lt;/script&gt;</tw-passagedata><tw-passagedata pid="287" name="VillageSmithy" tags="" position="850,3600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.moveHere();%&gt;
This smithy is especially - especially dirty, noisy and smelly.
&lt;p class=&quot;tPC&quot;&gt;Excuse me, could you help me a second&lt;/p&gt; you shout at the figure working the metal on the forge.
That figure - you think its a human but you wont place a bet on that- gives you an annoyed look and carefully places the dim glowing bar into the forge fire before walking over to you.
&lt;span class=&quot;tNPC2&quot;&gt;&quot;What is it?&quot;&lt;/span&gt; the gruff man asked.
&lt;p class=&quot;tPC&quot;&gt;&quot;I&#39;m sorry to disturb you while you are working, but I would like to ask if you can help me with that.&quot;&lt;p&gt; you point at the collar around your neck.
The man just gives a short glance at it before crossing his arms again before his chest.
&lt;p class=&quot;tNPC2&quot;&gt;&quot;Help with what? A tag, a chain?&quot;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;No no, I want to remove it but I dont have a key. I dont even know if there is a key, it somehow wrapped itself around my neck...&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC2&quot;&gt;&quot;Its kind of magical?&quot;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;Maybe, thats the...&quot;&lt;/p&gt;   
&lt;span class=&quot;tNPC2&quot;&gt;&quot;I dont touch that kind of stuff !&quot;&lt;/span&gt; he is already walking back to the forge, very obviously not interested to make your problem into one of his own.
&lt;p class=&quot;tPC&quot;&gt;&quot;But who could help me?&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC2&quot;&gt;&quot;I dunno&quot; he shrugs his shoulders &quot;a magican maybe.&quot;&lt;/p&gt;
&lt;/br&gt;[[Square|VillageMarketPlace]]  [[Shopkeeper|NOP]]&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="288" name="VillageRespawnPodExit" tags="" position="975,3600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
You are in the sanctum of spawn located in Thetain.&lt;/br&gt; 
&lt;/br&gt;[[Magic Chest|GlobalChest]]&lt;/br&gt;
&lt;div&gt;&lt;/br&gt;[[Leave|VillageEntrance]]&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="289" name="VRSuiteUp" tags="" position="1100,3600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;!--todo--&gt; You are eager to try that virtual reallity game. &lt;/br&gt;
&quot;Welcome to the test version of our new game. Lets just clarify some things about the beta-testing process. In most cases you just have to play the game as you like. We will track your actions and progress to adapt and improve the experience of the finished game.
However, at times you might be requested to do certain things and do it in a certain way.  &lt;/br&gt;
Remember that this is not the final game. We continously modify aspects to get the best experience for the players.&quot;   &lt;/br&gt;
&lt;div&gt;&lt;/br&gt;
[[Start the game|CharacterEditor]]&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="290" name="CharacterEditor" tags="" position="1225,3600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
You say &#39;Create new avatar&#39;. The screen switches to those kind of screens that are common to other RPGs.&lt;/br&gt;
You can select class, race, character-traits and some visual aspects.&lt;/br&gt;
&lt;p class=&quot;tPC&quot;&gt;&#39;Lets see what classes we have...Staff Zealot..never heard of that one  &#39;&lt;/p&gt;
As you try to flip through the classes you got a message &quot;For testing purpose the following condition is applied: character-class and race restricted&quot;&lt;/br&gt;
&lt;p class=&quot;tPC&quot;&gt;&#39;Oh man, I&#39;m stuck with that class? I would at least know what other classes are available.&#39;&lt;/p&gt; 
You try to change race, but find that you are stuck to some kind of elf-boy. 
You can toggle between male and female though the difference between the androgyne male and the female seem just to be some perky but small titts.&lt;/br&gt;
The description of the class is sparse. The picture you see indicates that this class uses a 2-handed staff and light armor. You expect also some magic abilities - its an elf, isn&#39;t it?.&lt;/br&gt;
&lt;p class=&quot;tPC&quot;&gt;&#39;I will choose male. Brad would make fun of me all time if I would choose any other option. On the other hand, it is roleplay right?&#39;&lt;/p&gt;&lt;/br&gt;
&lt;div id=&#39;select1&#39; &gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;);window.gm.MutationsLib[&quot;swapGender&quot;](window.gm.player,window.storage.constructors[&quot;PenisHuman&quot;]);&#39;&gt;male&lt;/a&gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1b&quot;);window.gm.MutationsLib[&quot;swapGender&quot;](window.gm.player,window.storage.constructors[&quot;VulvaHuman&quot;]);window.gm.player.Outfit.addItem(new window.storage.constructors[&quot;BreastHuman&quot;].factory(&quot;human&quot;));&#39;&gt;female&lt;/a&gt;
&lt;/div&gt;&lt;div id=&#39;choice1a&#39; hidden&gt; You selected male.
&lt;/br&gt;[[Ready|StartLocation]]&lt;/br&gt;
&lt;/div&gt;
&lt;div id=&#39;choice1b&#39; hidden&gt; You selected female.
&lt;/br&gt;[[Ready|StartLocation]]&lt;/br&gt;
&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="291" name="StartLocation" tags="" position="100,3725" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;
window.gm.enterVR();%&gt;
&lt;%window.gm.quests.forceQuestMilestone(&quot;qDiedAgain&quot;,2,1);window.gm.quests.forceQuestMilestone(&quot;qDLCMain&quot;,700,600)%&gt;
&lt;!--todo--&gt; &quot;You magically appear near the top of a hill. &lt;/br&gt;
You can see some hut from here. You just need to follow the trail down the hill.&quot;&lt;/br&gt;
&lt;div&gt;&lt;/br&gt;
[[Settlement|ForestBorder]]&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="292" name="Training1" tags="" position="225,3725" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
&lt;!--todo--&gt; The path snakes down the grassy flanks of the hill. As you make your way around a large boulder, something strange happens:&lt;/br&gt;
&lt;devnote&gt;&quot;Welcome to our little world. Just in case you are not used to that kind of game we should get you some training.&quot;&lt;/devnote&gt;&lt;/br&gt;
&lt;div&gt;&lt;/br&gt;
[[Continue|Training1Done]]&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="293" name="Training1Done" tags="" position="350,3725" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
&lt;!--todo--&gt; &lt;/br&gt;
&lt;devnote&gt;&quot;I wish you good luck in exploring this world. May the gods be with you.&quot;&lt;/devnote&gt;&lt;/br&gt;
&lt;div&gt;&lt;/br&gt;
[[Continue|ForestBorder]]&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="294" name="Dungeon" tags="" position="475,3725" size="100,100">&lt;!--dont &quot;show&quot; this! setup the dungeon and call enterDungeon--&gt;
&lt;!--if not explicitly allowed, save is disabled in dungeon--&gt;
&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%= window.gm.dng.name%&gt;-&lt;%= window.gm.dng.actualRoom.floor.name%&gt;-&lt;%= window.gm.dng.actualRoom.name%&gt;&lt;/br&gt; 
&lt;%= window.gm.dng.actualRoom.descr()%&gt;&lt;%= (window.gm.dng.actualRoom.allowSave?&quot; &lt;b&gt;You can save here !&lt;/b&gt;&quot;:&quot;&quot;)%&gt;&lt;/br&gt;
&lt;%= window.gm.dng.Mapper.printMap( window.gm.dng.actualRoom,true)%&gt;&lt;/br&gt;
&lt;/br&gt; 
&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;&lt;/br&gt;    &lt;!--display button list--&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
window.gm.dng.printButtons()
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="295" name="DungeonMap" tags="_nosave_" position="600,3725" size="100,100">&lt;!--dont &quot;show&quot; this! setup the dungeon and call displayMap--&gt;
&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%= window.gm.dng.Mapper.printMap( window.gm.dng.actualRoom,false)%&gt;&lt;/br&gt;
&lt;/br&gt; 
[[Back|Dungeon]]
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="296" name="DungeonFoundNothing" tags="_nosave_" position="725,3725" size="100,100">&lt;!--example-scene for onenter/onexit event--&gt;
&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%= window.gm.dng.actualRoom.descr()%&gt;&lt;/br&gt;
There are some buckets here, but there is nothing useful inside.&lt;/br&gt;
&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.dng.resumeRoom();&#39;&gt;Go on&lt;/a&gt;&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="297" name="DungeonGenericEvent" tags="_nosave_" position="850,3725" size="100,100">&lt;!--example-scene for operation--&gt;
&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;div id=&#39;panel&#39;&gt;&lt;/div&gt;&lt;!--event is rendered here--&gt;
&lt;%= window.gm.dng.renderEvent(window.gm.dng.evtData)%&gt;&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="298" name="DungeonCrashedThroughFloor" tags="_nosave_" position="975,3725" size="100,100">&lt;!--example-scene for onenter/onexit event--&gt;
&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%= window.gm.dng.actualRoom.descr()%&gt;&lt;/br&gt;
You crash down through the floor and find yourself back on the lowest level of the area.&lt;/br&gt;
&lt;/br&gt;
&lt;a0 onclick=&#39;crashThrough();&#39;&gt;Go on&lt;/a&gt;&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
function crashThrough(){
    var floor1 = window.gm.dng.allFloors()[0];
    var Room = floor1.getRoom(window.gm.dng.actualRoom.name);  //room names are the same at same position of floor
    window.gm.dng.teleport(Room);
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="299" name="GlobalChest" tags="_nosave_ _back_" position="1100,3725" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
Items you store in this magic chest dont get lost if you are knocked out.
&lt;/br&gt;[[Back|_back_]] [[Wardrobe...|GlobalChestWardrobe]]&lt;/br&gt;
&lt;div id=&quot;choice&quot;&gt;&lt;/div&gt;
&lt;/br&gt;[[Back|_back_]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;window.gm.printItemTransfer(window.gm.player,window.story.state.chars.GlobalChest,false);&lt;/script&gt;</tw-passagedata><tw-passagedata pid="300" name="GlobalChestWardrobe" tags="_nosave_ _back_" position="1225,3725" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
Items you store in this magic chest dont get lost if you are knocked out.&lt;/br&gt;Only unequipped equipment can be transferred.
&lt;/br&gt;[[Items...|_back_]]&lt;/br&gt;
&lt;div id=&quot;choice&quot;&gt;&lt;/div&gt;
&lt;/br&gt;[[Items...|_back_]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;window.gm.printItemTransfer(window.gm.player,window.story.state.chars.GlobalChest,true);&lt;/script&gt;</tw-passagedata><tw-passagedata pid="301" name="NOP_VR" tags="_nosave_ _back_" position="100,3850" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;p class=&#39;dev&#39;&gt; You cant go that way. Either because its WIP or you need to solve a quest first. &lt;/p&gt;
&lt;/br&gt;[[Back|_back_]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="302" name="DngFM_MAP" tags="_back_" position="225,3850" size="100,100">&lt;hr&gt;&lt;div id=&#39;canvas&#39;&gt;&lt;/div&gt;&lt;div id=&#39;svgpopup&#39;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;script&gt; window.gm.printMap2(window.story.state.DngSY.dngMap,window.gm.player.location.replace(window.story.state.DngSY.dng+&#39;_&#39;,&#39;&#39;),
    window.story.state.DngFM.mapReveal,window.story.state.DngFM.visitedTiles);
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="303" name="DngFM_Entry" tags="" position="350,3850" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
TODO Appear at farm.
&lt;/br&gt;&lt;p&gt; [[Next|DngFM_F6]] &lt;/br&gt;&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
function buildRooms(){
    const _m=[
        &#39;        H2  I2--J2        &#39;,
        &#39;        |       |         &#39;,
        &#39;        H3  I3--J3--K3    &#39;,
        &#39;        |   |             &#39;,
        &#39;F4--G4--H4--I4--J4--K4    &#39;,
        &#39;|   |           |         &#39;,
        &#39;F5  G5--H5--I5--J5--K5--L5&#39;,
        &#39;|       |           |     &#39;,
        &#39;F6      H6--I6--J6--K6--L6&#39;];
    function _d(dir){return({dir:dir,exp:0});};
    //Milker, breeding-stock/ dummy-mare, branding, Hufschmied, butterfass, Mühle/Laufrad
    let grid =[
    {room:&#39;H2&#39;, dirs:[_d(&#39;H3&#39;)]},
    {room:&#39;I2&#39;, dirs:[_d(&#39;J2&#39;)]},
    {room:&#39;J2&#39;, dirs:[_d(&#39;I2&#39;),_d(&#39;J3&#39;)]},
    {room:&#39;H3&#39;, dirs:[_d(&#39;H2&#39;),_d(&#39;H4&#39;)],           anno:[&#39;B&#39;]},
    {room:&#39;I3&#39;, dirs:[_d(&#39;I4&#39;),_d(&#39;J3&#39;)],           anno:[&#39;Q&#39;]},
    {room:&#39;J3&#39;, dirs:[_d(&#39;I3&#39;),_d(&#39;K3&#39;),_d(&#39;J2&#39;)]},
    {room:&#39;K3&#39;, dirs:[_d(&#39;J3&#39;)]},
    {room:&#39;F4&#39;, dirs:[_d(&#39;G4&#39;),_d(&#39;F5&#39;)]},
    {room:&#39;G4&#39;, dirs:[_d(&#39;F4&#39;),_d(&#39;H4&#39;),_d(&#39;G5&#39;)]},
    {room:&#39;H4&#39;, dirs:[_d(&#39;H3&#39;),_d(&#39;G4&#39;),_d(&#39;I4&#39;)]},
    {room:&#39;I4&#39;, dirs:[_d(&#39;H4&#39;),_d(&#39;I3&#39;),_d(&#39;J4&#39;)]},
    {room:&#39;J4&#39;, dirs:[_d(&#39;I4&#39;),_d(&#39;J5&#39;),_d(&#39;K4&#39;)]},
    {room:&#39;K4&#39;, dirs:[_d(&#39;J4&#39;)],                anno:[&#39;L&#39;]},
    {room:&#39;F5&#39;, dirs:[_d(&#39;F4&#39;),_d(&#39;F6&#39;)]},
    {room:&#39;G5&#39;, dirs:[_d(&#39;G4&#39;),_d(&#39;H5&#39;)]},
    {room:&#39;H5&#39;, dirs:[_d(&#39;G5&#39;),_d(&#39;I5&#39;),_d(&#39;H6&#39;)]},
    {room:&#39;I5&#39;, dirs:[_d(&#39;H5&#39;),_d(&#39;J5&#39;)]},
    {room:&#39;J5&#39;, dirs:[_d(&#39;I5&#39;),_d(&#39;K5&#39;),_d(&#39;J4&#39;)]},
    {room:&#39;K5&#39;, dirs:[_d(&#39;J5&#39;),_d(&#39;K6&#39;),_d(&#39;L5&#39;)]},
    {room:&#39;L5&#39;, dirs:[_d(&#39;K5&#39;)],                anno:[&#39;A&#39;]},
    {room:&#39;F6&#39;, dirs:[_d(&#39;F5&#39;)],                anno:[&#39;E&#39;]},
    {room:&#39;H6&#39;, dirs:[_d(&#39;H5&#39;),_d(&#39;I6&#39;)]},
    {room:&#39;I6&#39;, dirs:[_d(&#39;H6&#39;),_d(&#39;J6&#39;)],           anno:[&#39;S&#39;]},
    {room:&#39;J6&#39;, dirs:[_d(&#39;I6&#39;),_d(&#39;K6&#39;)]},
    {room:&#39;K6&#39;, dirs:[_d(&#39;K5&#39;),_d(&#39;L6&#39;),_d(&#39;J6&#39;)]},
    {room:&#39;L6&#39;, dirs:[_d(&#39;K6&#39;)]}];
    let dng={grid:grid,width:14,height:8,legend:&#39;E=Portal B=Beehives S=Stables L=Lake A=Plantation Q=Quarters &#39;}
    window.story.state.DngSY.dngMap=dng;
    //window.story.state.DngFM.visitedTiles=[];
    window.story.state.DngFM.tmp={FoxBunnyCabbage:false};
}
    var s = window.story.state;
    s.DngSY.dng=&#39;DngFM&#39;;
    s.vars.spawnAt=&quot;DngSY_Recover_Death&quot;;
    buildRooms();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="304" name="DngFM_H2" tags="" position="475,3850" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
Several beehives are placed on wooden tables. They are rather big, but for sure you arent an expert in that matter. 
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="305" name="DngFM_I2" tags="" position="600,3850" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
A back room of the quarters.
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="306" name="DngFM_J2" tags="" position="725,3850" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
A back room of the quarters.
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="307" name="DngFM_H3" tags="" position="850,3850" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
Several beehives are placed on wooden tables. They are rather big, but for sure you arent an expert in that matter. 
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="308" name="DngFM_I3" tags="" position="975,3850" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
You are now inside the abode of the workser of the farm. 
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="309" name="DngFM_J3" tags="" position="1100,3850" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
You are now inside the abode of the workser of the farm. 
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="310" name="DngFM_K3" tags="" position="1225,3850" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
You are now inside the abode of the workser of the farm. 
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="311" name="DngFM_F4" tags="" position="100,3975" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
The dirtroad to the farm.
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="312" name="DngFM_G4" tags="" position="225,3975" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
The dirtplace before the buildings of the farm.
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="313" name="DngFM_H4" tags="" position="350,3975" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
TODO The dirtroad to the farm.
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="314" name="DngFM_I4" tags="" position="475,3975" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
The dirtplace before the buildings of the farm.
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="315" name="DngFM_J4" tags="" position="600,3975" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
You can see Kelly other there. She waves you over, maybe she needs some [[help|DngFM_FoxBunnyCabbage]]. 
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="316" name="DngFM_K4" tags="" position="725,3975" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
The dirtplace before the buildings of the farm.
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="317" name="DngFM_F5" tags="" position="850,3975" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
The dirtroad to the farm.
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="318" name="DngFM_G5" tags="" position="975,3975" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
TODO The dirtroad to the farm.
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="319" name="DngFM_H5" tags="" position="1100,3975" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
TODO The dirtroad to the farm.
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="320" name="DngFM_I5" tags="" position="1225,3975" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
TODO The dirtroad to the farm.
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="321" name="DngFM_J5" tags="" position="100,4100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
TODO The dirtroad to the farm.
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="322" name="DngFM_K5" tags="" position="225,4100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
TODO The dirtroad to the farm.
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="323" name="DngFM_L5" tags="" position="350,4100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
TODO The dirtroad to the farm.
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="324" name="DngFM_F6" tags="" position="475,4100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
The portalstone to the farm.
&lt;%if(window.story.state.DngSY.dngLevel===4 &amp;&amp; window.story.state.DngFM.tmp.FoxBunnyCabbage){%&gt;
    &lt;/br&gt;The portal has opened, time for your return.
    &lt;p&gt;[[Into the portal|DngCV_Lv4_Success]] &lt;/br&gt;&lt;/p&gt;
&lt;%}else if(window.story.state.DngSY.dngLevel===4 &amp;&amp; !window.story.state.DngFM.tmp.FoxBunnyCabbage){%&gt;
    &lt;/br&gt;You need to do some work on the farm before the portal opens.
&lt;%}else{%&gt; 
    [[Into the portal|DngSY_Portal]]
&lt;%}%&gt; 
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="325" name="DngFM_H6" tags="" position="600,4100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
The large wooden buildings have to be the stables. 
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="326" name="DngFM_I6" tags="" position="725,4100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
The large wooden buildings have to be the stables. 
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="327" name="DngFM_J6" tags="" position="850,4100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
The large wooden buildings have to be the stables. 
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="328" name="DngFM_K6" tags="" position="975,4100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
The large wooden buildings have to be the stables. 
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="329" name="DngFM_L6" tags="" position="1100,4100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
The large wooden buildings have to be the stables. 
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="330" name="DngFM_FoxBunnyCabbage" tags="" position="1225,4100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
&lt;% if(!window.story.state.DngFM.tmp.FoxBunnyCabbage){%&gt;
&lt;span class=&quot;tNPC1&quot;&gt;&quot;See, I have some kind of problem here. I need to get those&quot;&lt;/span&gt; she points at 3 cages &lt;span class=&quot;tNPC1&quot;&gt;&quot;over this river by using this boat.&quot;&lt;/span&gt;
&lt;/br&gt; Each of the cages contains a single critter: the first one has a white furred bunny inside. The second one contains a scrawny looking fox that trys to hide itself behind its bushy tail. The third has a cabbage placed inside. Why would someone place a cabbage in a cage?
&lt;p class=&quot;tNPC1&quot;&gt;&quot;The boat isn&#39;t big enough to fit more then one of those inside and even then I have to leave the cages behind.&quot;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;Don&#39;t worry. I know the solution right away.&quot;&lt;/p&gt; Hasn&#39;t this riddle already been solved a hundred of times? &lt;/br&gt;
&lt;p class=&quot;tNPC1&quot;&gt;&quot;You need to make sure to not leave two of them behind because...&quot;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;I know, I know. They will eat each other.&quot;&lt;/p&gt; Its the food chain of course. &lt;/br&gt;
For some reason there is a sign placed on the other side of the river showing &quot;B&quot; and another one with &quot;A&quot; on this site.
&lt;div id=&#39;panel&#39;&gt;&lt;/div&gt;&lt;div id=&#39;choice&#39;&gt;&lt;/div&gt;
&lt;%}else{%&gt;
[[Leave]]
&lt;%}%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
var data={fox:&#39;A&#39;,cabbage:&#39;A&#39;,bunny:&#39;A&#39;},boat=&#39;A&#39;,done=false;
function move(){
    let choice=$(&quot;div#choice&quot;)[0],panel=$(&quot;div#panel&quot;)[0];
    while(choice.firstChild) choice.removeChild(choice.firstChild);
    var link = document.createElement(&#39;p&#39;);
    link.textContent =&quot;shore A: &quot;+(data.fox===&#39;A&#39;)?&#39;fox &#39;:&#39;&#39; + (data.bunny===&#39;A&#39;)?&#39;bunny &#39;:&#39;&#39; + (data.cabbage===&#39;A&#39;)?&#39;cabbage &#39;:&#39;&#39;;
    link.textContent+=&quot;shore B: &quot;+(data.fox===&#39;B&#39;)?&#39;fox &#39;:&#39;&#39; + (data.bunny===&#39;B&#39;)?&#39;bunny &#39;:&#39;&#39; + (data.cabbage===&#39;B&#39;)?&#39;cabbage &#39;:&#39;&#39;;
    panel.appendChild(link);
    var _list = Object.keys(data);
    const _target = ((boat===&#39;A&#39;)?&#39;B&#39;:&#39;A&#39;); 
    for(var n of _list){
        if(data[n]===boat){
            const _critter=el;
            link = document.createElement(&#39;a&#39;),link.href=&#39;javascript:void(0)&#39;,
            link.addEventListener(&quot;click&quot;, function(me){
                data[_critter]=_target;boat=_target;
                check();
            });
            link.textContent=&quot;place &quot;+n+&quot; in the boat and row to &quot;+_target;
            choice.appendChild(link);
        }
    }
    link = document.createElement(&#39;a&#39;),link.href=&#39;javascript:void(0)&#39;,
    link.addEventListener(&quot;click&quot;, function(me){boat=_target; check(); });
    link.textContent=&quot;dont take anything with you and row to &quot;+_target;
    choice.appendChild(link);
}
function check(){
    let _other=((boat===&#39;A&#39;)?&#39;B&#39;:&#39;A&#39;), _sucess=false,_fail=false;
    let choice=$(&quot;div#choice&quot;)[0],panel=$(&quot;div#panel&quot;)[0];
    while(choice.firstChild) choice.removeChild(choice.firstChild);
    while(panel.firstChild) panel.removeChild(panel.firstChild);
    let link = document.createElement(&#39;p&#39;),link2 = document.createElement(&#39;a&#39;);;
    link.textContent =&quot;shore A: &quot;+((data.fox===&#39;A&#39;)?&#39;fox &#39;:&#39;&#39;) + ((data.bunny===&#39;A&#39;)?&#39;bunny &#39;:&#39;&#39;) + ((data.cabbage===&#39;A&#39;)?&#39;cabbage &#39;:&#39;&#39;);
    link.textContent+=&quot;| shore B: &quot;+((data.fox===&#39;B&#39;)?&#39;fox &#39;:&#39;&#39;) + ((data.bunny===&#39;B&#39;)?&#39;bunny &#39;:&#39;&#39;) + ((data.cabbage===&#39;B&#39;)?&#39;cabbage &#39;:&#39;&#39;);
    panel.appendChild(link);
    link = document.createElement(&#39;p&#39;)
    link2.href=&#39;javascript:void(0)&#39;;
    if(&#39;B&#39;===data.bunny &amp;&amp; data.bunny===data.fox &amp;&amp; data.fox===data.cabbage){ _sucess=true;
        link.classList.add(&#39;tNPC1&#39;);link.textContent =&#39;\&quot;You really did it, thats wonderful. Now I can bring them to the market. Thank you so much.\&quot;&#39;;
    } else if(_other===data.bunny &amp;&amp; _other===data.cabbage){ _fail=true;
        link.textContent =&#39;To late you notice your mistake, leaving the bunny and the cabbage together behind. You turn back just in time to see how the bunny advances the juicy veggy.&#39;;
        panel.appendChild(link);
        link = document.createElement(&#39;p&#39;);
        link.textContent =&#39;Just as the bunny moves close enough for getting a good bite, to your big surprise the CABBAGE SWALLOWS IT WHOLE WTF !&#39;;
        panel.appendChild(link);
        link = document.createElement(&#39;p&#39;);link.classList.add(&#39;tNPC1&#39;);
        link.textContent =&#39;\&quot;This is a special breeding success. It took some effort but we have managed to provide cabbage with a mechanism for self-defense against its worst enemies.\&quot;&#39;;
    } else if(_other===data.fox &amp;&amp; _other===data.cabbage){ _fail=true;
        link.textContent =&#39;The bunny is save in your boat. But you hear some shredding, munching noises behind you.&#39;;
        panel.appendChild(link);
        link = document.createElement(&#39;p&#39;);
        link.textContent =&#39;That scrawny fox is tearing the cabbage appart, eagerly munching down its leaves.&#39;;
        panel.appendChild(link);
        link = document.createElement(&#39;p&#39;);link.classList.add(&#39;tNPC1&#39;);
        link.textContent =&#39;\&quot;That foxy is a weird one. I think some incident made him a vegetarian.\&quot;&#39;;
    } else if(_other===data.fox &amp;&amp; _other===data.bunny){
        link.textContent =&#39;You have a bad feeling that you made an error. The bunny and the fox are left alone together.&#39;;
        panel.appendChild(link);
        link = document.createElement(&#39;p&#39;);
        link.textContent =&#39;You look back to find the bunny starring at the fox but the fox simply ignoring it. Odd.&#39;;
    }
    panel.appendChild(link);
    if(_fail){
        link2.textContent = &#39;You failed. Start again.&#39;;
        link2.addEventListener(&quot;click&quot;, function(me){
                data={fox:&#39;A&#39;,cabbage:&#39;A&#39;,bunny:&#39;A&#39;},boat=&#39;A&#39;;
                check();
            });
    } else if(_sucess){
        link2.textContent = &#39;Success !&#39;;
        link2.addEventListener(&quot;click&quot;, function(me){ 
            window.story.state.DngFM.tmp.FoxBunnyCabbage=true; window.story.show(window.gm.player.location);
            });
    } else {
        link2.textContent = &#39;You are now at shore &#39;+boat+&#39;. Ponder your options&#39;;
        link2.addEventListener(&quot;click&quot;, function(me){move();});
    }
    choice.appendChild(link2);
}
if(!window.story.state.DngFM.tmp.FoxBunnyCabbage) check();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="331" name="DngHC_MAP" tags="_back_" position="100,4225" size="100,100">&lt;hr&gt;&lt;div id=&#39;canvas&#39;&gt;&lt;/div&gt;&lt;div id=&#39;svgpopup&#39;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;script&gt; window.gm.printMap2(window.story.state.DngSY.dngMap,window.gm.player.location.replace(window.story.state.DngSY.dng+&#39;_&#39;,&#39;&#39;),
    window.story.state.DngHC.mapReveal,window.story.state.DngHC.visitedTiles);
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="332" name="DngHC_Entry" tags="" position="225,4225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
You are trapped in this dungeon and need to find a way out of it.
&lt;/br&gt;&lt;p&gt; [[Next|DngHC_H3]] &lt;/br&gt;&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
    var s = window.story.state,map,data;
    ({map,data}=window.gm.build_DngHC());
    s.DngPC=data;
    s.DngSY.dngMap=map;s.DngSY.dng=&#39;DngHC&#39;;
    s.vars.spawnAt=&quot;DngHC_Respawn&quot;;
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="333" name="DngHC_Encounters" tags="" position="350,4225" size="100,100">&lt;script&gt;
function tick(){
    let here = window.gm.player.location,_d=window.story.state.DngHC.tmp;
    if(here===_d.tickPass) return;
    _d.tickPass=here;
    for(var i=_d.mobs.length-1;i&gt;=0;i--){
      var mob=_d.mobs[i];
      window.gm.mobAI(mob);
      if(window.story.state.DngSY.dng+&quot;_&quot;+mob.pos===here){
        //if mob is at same position as player: trigger passage or just show note
        if(mob.state===0){
          window.gm.encounters[mob.mob]({noStart:true});
          var _oldVictory=window.gm.Encounter.onVictory.bind(window.gm.Encounter);
          window.gm.Encounter.onVictory= function(){mob.state=1;return(_oldVictory());}
          window.gm.Encounter.initCombat(); return;
        }
      }
    }
}
function fightGuardian(){
    window.gm.encounters.wolf({amount:1, noStart:true});
    window.gm.Encounter.initCombat();
}
function dogEncounter(){
  let _evt = window.story.state.DngHC.tmp.evtEnter[window.story.state.DngSY.nextLocation.replace(window.story.state.DngSY.dng+&quot;_&quot;,&quot;&quot;)][&quot;dog&quot;];
  if(window.gm.player.Outfit.countItem(&quot;CollarDog&quot;)&gt;0){
    _evt.state=1;
    window.story.show(&quot;DngHC_Meet_Dog_Greet&quot;);
  } else {
    _evt.state=1;
    window.gm.encounters.wolf({amount:1,type:&quot;Guarddog&quot;, noStart:true, levelUp:10});
    window.gm.Encounter.initCombat();
  }
}
tick();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="334" name="DngHC_Lectern" tags="_nosave_" position="475,4225" size="100,100">&lt;div id=&#39;select1&#39;&gt;Some kind of lectern or stand is placed in an alcoven.&lt;/br&gt;Looks like some scribbled note is placed on it.&lt;/br&gt;It might be useful. On the other hand it could also be a trap. So, are you going to  
&lt;a0 onclick=&#39;grab();window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;)&#39;&gt;take a look at&lt;/a&gt;? Or just 
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1b&quot;)&#39;&gt;ignore it&lt;/a&gt;&lt;/br&gt;
&lt;/div&gt;&lt;div id=&#39;choice1a&#39; hidden&gt;&lt;/br&gt;&lt;/div&gt;
&lt;div id=&#39;choice1b&#39; hidden&gt;&lt;/br&gt;
  Might be a good decision to not touch that lectern and walk away.
&lt;/div&gt;
&lt;script&gt; function grab(){
  let item,msg=&#39;&#39;;
  window.story.state.DngHC.tmp.evtSpawn[window.passage.name][&quot;lectern&quot;].state=1;
  if(loot[1]===&quot;&quot;){
    msg=&#39;You found a &#39;+loot[0]+&#39;. &#39;+window.gm.printLink(&#39;Continue&#39;,&#39;window.story.show(window.gm.passage)&#39;);
    window.gm.player.Wardrobe.addItem(window.gm.ItemsLib[loot[0]]());
  } else if(loot[1]===&#39;pierce&#39;){
    msg=&#39;As you take the item from the lectern, a bright flash stuns you. \&quot;Its a trap damit..\&quot;&#39;;
    if(window.gm.player.Outfit.getItemForSlot(&quot;pEars&quot;)){
      msg+= &#39;&lt;/br&gt;But nothing happens after.&#39;
    } else {
      item=window.gm.ItemsLib[&#39;PiercingEars&#39;]();window.gm.player.Wardrobe.addItem(item);window.gm.player.Outfit.addItem(item);
      msg+= &#39;A short, sharp pain in both earlobes lets your hands immediately shoot up and check whats going on: &#39;;
      msg+= &#39;Your ears got some jewelery: &#39;+item.desc;
      msg+= &#39;&lt;/br&gt; Well, you have to live with that for now.&#39;
    }
  }
  window.gm.printOutput(msg,&#39;div#choice1a&#39;);
}
function randomLoot(){
  var rnd=_.random(0,100);
  var trap=[&#39;arouse&#39;,&#39;pierce&#39;,&#39;ravage&#39;,&#39;drug&#39;,&#39;bound&#39;,&#39;cursed&#39;]
  var chest=[&#39;Tank-shirt&#39;,&#39;HealthPotion&#39;,&#39;Sandwich&#39;]
  loot.push(&quot;Tank-shirt&quot;);
  loot.push(&quot;pierce&quot;);
  window.gm.printOutput(loot[0],&#39;b#choice&#39;);
}
var loot=[];
randomLoot();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="335" name="DngHC_Trent" tags="_nosave_" position="600,4225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
TODO Meet horsy. &lt;/br&gt;
You may try your luck and &lt;a0 onclick=&#39;&#39;&gt;sneak around&lt;/a&gt; , boldly &lt;a0 onclick=&#39;&#39;&gt;walk toward it&lt;/a&gt; or rush and try to &lt;a0 onclick=&#39;fight()&#39;&gt;strike first&lt;/a&gt;. 
&lt;/br&gt;Safest option would be to retreat &lt;a0 onclick=&#39;window.story.show(window.story.state.DngSY.prevLocation)&#39;&gt;retreat&lt;/a&gt;.
&lt;div id=&#39;output&#39;&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="336" name="DngHC_wolf" tags="_nosave_" position="725,4225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
There is wolf resting on the ground. It might be sleeping. &lt;/br&gt;
You may try your luck and &lt;a0 onclick=&#39;&#39;&gt;sneak around&lt;/a&gt; , boldly &lt;a0 onclick=&#39;&#39;&gt;walk toward it&lt;/a&gt; or rush and try to &lt;a0 onclick=&#39;fight()&#39;&gt;strike first&lt;/a&gt;. 
&lt;/br&gt;Safest option would be to retreat &lt;a0 onclick=&#39;window.story.show(window.story.state.DngSY.prevLocation)&#39;&gt;retreat&lt;/a&gt;.
&lt;div id=&#39;output&#39;&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;function fight(){
  window.gm.encounters[&#39;wolf&#39;]({type:&#39;AlphaWolf&#39;,noFlee:true});               
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="337" name="DngHC_Meet_Dog" tags="_nosave_" position="850,4225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
There is some kind of dog lurking in the dark in front of you. &lt;/br&gt;
You may try your luck and &lt;a0 onclick=&#39;dogEncounter();&#39;&gt;walk further&lt;/a&gt; in its direction but maybe its wise to &lt;a0 onclick=&#39;window.story.show(window.story.state.DngSY.prevLocation)&#39;&gt;retreat&lt;/a&gt;. 
&lt;/br&gt;todo A hound was waiting for you. It sensed your weakness and is now quickly running toward you...
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngHC_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="338" name="DngHC_Meet_Dog_Greet" tags="_nosave_" position="975,4225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
For some reason the dog doesnt oppose you as you try to walk past it. Might this be because of the collar you are wearing?&lt;/br&gt;
&lt;div id=&#39;select1&#39; &gt;It could be quite possible to give it some head scratches. Maybe you could make a friend by doing so?&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;)&#39;&gt;Why not&lt;/a&gt;&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1b&quot;)&#39;&gt;Just get away&lt;/a&gt;&lt;/br&gt;
&lt;/div&gt;&lt;div id=&#39;choice1a&#39; hidden&gt;&lt;/br&gt; At first reserved but soon stronger you give the dog some good ruffling of its fur at his neck an back of the head.
  &lt;a0 onclick=&#39;window.story.show(window.story.state.DngSY.nextLocation);&#39;&gt;Next&lt;/a&gt;&lt;/div&gt;
&lt;div id=&#39;choice1b&#39; hidden&gt;&lt;/br&gt;You press onward to leave the possible threat behind.&lt;/br&gt;
  &lt;a0 onclick=&#39;window.story.show(window.story.state.DngSY.nextLocation);&#39;&gt;Next&lt;/a&gt;
&lt;/div&gt; 
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngHC_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="339" name="DngHC_Door_Closed" tags="_nosave_" position="1100,4225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
There is a gate in front of you but it is locked.&lt;/br&gt;
&lt;a0 onclick=&#39;window.story.show(window.story.state.DngSY.prevLocation)&#39;&gt;Go back&lt;/a&gt;. 
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngHC_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="340" name="DngHC_Mushroom" tags="_nosave_ _fragm_" position="1225,4225" size="100,100">&lt;/br&gt;&lt;%if(window.story.state.DngHC.tmp.evtSpawn[window.passage.name][&quot;mushroom&quot;].state===0){%&gt;There is a &lt;%=window.story.state.DngHC.tmp.evtSpawn[window.passage.name][&quot;mushroom&quot;].loot%&gt;. Do you collect it?
&lt;div id=&#39;select992&#39; &gt;
&lt;a0 onclick=&#39;var _evt=window.story.state.DngHC.tmp.evtSpawn[window.passage.name][&quot;mushroom&quot;];_evt.state=1;_evt.tick=window.gm.getTime();window.gm.player.changeInventory(window.gm.ItemsLib[_evt.loot](),1);window.gm.printTalkLink(&quot;div#select992&quot;,&quot;div#choice992a&quot;)&#39;&gt;Yes&lt;/a&gt;&lt;/br&gt;
&lt;/div&gt;&lt;div id=&#39;choice992a&#39; hidden&gt;&lt;/br&gt; You collected some mushroom.
&lt;/div&gt;
&lt;%}else{%&gt;
No mushrooms growing here right now.
&lt;%}%&gt;</tw-passagedata><tw-passagedata pid="341" name="DngHC_Chest" tags="_nosave_ _fragm_" position="100,4350" size="100,100">&lt;/br&gt;&lt;%if(window.story.state.DngHC.tmp.evtSpawn[window.passage.name][&quot;chest&quot;].state===0){%&gt;There is a chest. Do you dare open it?
&lt;a0 onclick=&#39;window.story.state.DngHC.tmp.evtSpawn[window.passage.name][&quot;chest&quot;].state=1;window.story.state.tmp.args[1]=70;window.story.state.tmp.args[2]=window.passage.name;window.story.show(&quot;DngHC_LootChest&quot;)&#39;&gt;Yes&lt;/a&gt;&lt;/br&gt;
&lt;%}else{%&gt;
An empty chest sits over there.
&lt;%}%&gt;</tw-passagedata><tw-passagedata pid="342" name="DngHC_LootChest" tags="_nosave_" position="225,4350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
You open the chest and find...&lt;div id=&#39;output&#39;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;a0 onclick=&#39;foo()&#39;&gt;Next&lt;/a&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
var foo,msg=&#39;&#39;,Items=[];
var rnd=window.story.state.tmp.args[1],next=window.story.state.tmp.args[2]; //see window.gm.cursedChest
function addLoot(){
  for(let n of Items){ msg+=n.name+&quot;, &quot;;};
  foo=function(){ window.story.state.tmp.args=[];
    for(let n of Items){window.gm.player.changeInventory(n,1);}
    window.story.show(next); //adding to inventory only if player is leaving the passage, otherwise he could glitch if switching to status-pane and back
  }
}
if(rnd&lt;10){
  Items.push(window.gm.ItemsLib.HorsePotion());
  addLoot();
} else if(rnd&gt;40){
  Items.push(window.gm.ItemsLib.HealthPotionSmall());
  if(rnd&gt;60){
    Items.push(window.gm.ItemsLib.HorsePotion());
  }
  addLoot();
} else {
  msg+=&#39;nothing !&#39;;foo=function(){window.story.show(next);};
  /*foo=(function(){ window.story.state.tmp.args=[]; 
    window.gm.fightArena(&quot;mole&quot;,{amount:2},[{id:&quot;Money&quot;,count:30}],next);});*/
}
window.gm.printOutput(msg);
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="343" name="DngHC_HungerThirst" tags="_isdeffered_" position="350,4350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
You start to feel hungry. If you dont get something in your belly, you will get weaker by the time.
---
&lt;a0 onclick= &#39;window.story.show(&quot;&quot;)&#39;&gt;Next&lt;/a&gt;&lt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngHC_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="344" name="DngHC_Respawn" tags="_nosave_ _nodeffered_" position="475,4350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
It&#39;s impossible to say how long you were passed out and how you ended up here. &lt;/br&gt;
But at least you are alive and - mostly - unharmed.&lt;/br&gt;
&lt;a0 onclick= &#39;window.story.show(&quot;DngHC_H3&quot;)&#39;&gt;Next&lt;/a&gt;&lt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngHC_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="345" name="DngHC_Sleep" tags="" position="600,4350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
Wrapping yourself in that shaggy, old quilt, you try to get some rest.&lt;/br&gt;
&lt;/br&gt;&lt;div id=&#39;output&#39;&gt;&lt;/div&gt;
&lt;/br&gt;&lt;a0 onclick=&#39;nap()&#39;&gt;Next&lt;/a&gt;&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
function nap(){
  var _room,_evt,_evts=window.story.state.DngHC.tmp.evtEnter;
  var _list = Object.keys(_evts);
  for(var i=_list.length-1;i&gt;=0;i--){ //respawn foes
    _room = _evts[_list[i]];
    if(_room[&#39;dog&#39;]) _room[&#39;dog&#39;].state=0;
  }
  _list=window.story.state.DngHC.tmp.mobs;
  for(var i=_list.length-1;i&gt;=0;i--){ //respawn foes
    _room = _list[i];
    _room.state=0;
  }
  window.story.show(window.gm.player.location);
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="346" name="DngHC_I2" tags="" position="725,4350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;

&lt;%=window.gm.renderRoom(window.passage.name)%&gt;&lt;%=window.gm.printNav2()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngHC_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="347" name="DngHC_H2" tags="" position="850,4350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
The majority of floor of this room is a huge hole. There isnt enough light to see how deep it is. A plank is laid loosly about the hole . Someone hero enough might walk or crawl  
&lt;%=window.gm.renderRoom(window.passage.name)%&gt;&lt;%=window.gm.printNav2()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngHC_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="348" name="DngHC_G3" tags="" position="975,4350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
A little bit of water trickles down the wall. You could take a &lt;a0 onclick=&#39;&#39;&gt;sip&lt;/a&gt; to still your thirst.
&lt;%=window.gm.renderRoom(window.passage.name)%&gt;&lt;%=window.gm.printNav2()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngHC_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="349" name="DngHC_H3" tags="" position="1100,4350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
This is a small cell with a bunk and a heavy door that can be locked from inside.&lt;/br&gt;
You could rest here to recover health and energy. However this would also give someone you got rid of a chance to crawl back from their hiding place.&lt;/br&gt;
&lt;a0 onclick=&#39;($(&quot;tw-passage&quot;).fadeOut(1000, function(){window.gm.addTime(60);window.story.show(&quot;DngHC_Sleep&quot;);}));&#39;&gt;Nap 1hour&lt;/a&gt;
&lt;%if(window.gm.getTimeStruct().hour&lt;11){ %&gt;
&lt;a0 onclick=&#39;($(&quot;tw-passage&quot;).fadeOut(1000, function(){window.gm.player.sleep(1800);window.story.show(&quot;DngHC_Sleep&quot;);}));&#39;&gt;Sleep Until Evening&lt;/a&gt; 
&lt;%} else {%&gt;
&lt;a0 onclick=&#39;($(&quot;tw-passage&quot;).fadeOut(1000, function(){window.gm.player.sleep(700);window.story.show(&quot;DngHC_Sleep&quot;);}));&#39;&gt;Sleep Until Morning&lt;/a&gt;
&lt;%}%&gt;
&lt;%=window.gm.renderRoom(window.passage.name)%&gt;&lt;%=window.gm.printNav2()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngHC_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="350" name="DngHC_I3" tags="" position="1225,4350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;%=window.gm.renderRoom(window.passage.name)%&gt;&lt;%=window.gm.printNav2()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngHC_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="351" name="DngHC_J3" tags="" position="100,4475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
A large symbol is imprinted in the floor resembling a star or pentagram. On a bookstand a tome is resting.
Maybe someone used that place for some witchcraft?

&lt;%=window.gm.renderRoom(window.passage.name)%&gt;&lt;%=window.gm.printNav2()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngHC_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="352" name="DngHC_F4" tags="" position="225,4475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;%=window.gm.renderRoom(window.passage.name)%&gt;&lt;%=window.gm.printNav2()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngHC_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="353" name="DngHC_G4" tags="" position="350,4475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
You find yourself standing in a large hall topped with a cross vault.&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.cursedChest(&quot;DngHC_G4&quot;);window.story.show(&quot;DngHC_LootChest&quot;)&#39;&gt;Open chest&lt;/a&gt;
&lt;%=window.gm.renderRoom(window.passage.name)%&gt;&lt;%=window.gm.printNav2()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngHC_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="354" name="DngHC_H4" tags="" position="475,4475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
A corridor illuminated by some torches.
&lt;%=window.gm.renderRoom(window.passage.name)%&gt;&lt;%=window.gm.printNav2()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngHC_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="355" name="DngHC_I4" tags="" position="600,4475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
A corridor illuminated by some torches.
&lt;%=window.gm.renderRoom(window.passage.name)%&gt;&lt;%=window.gm.printNav2()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngHC_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="356" name="DngHC_J4" tags="" position="725,4475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
A corridor illuminated by some torches.
&lt;%=window.gm.renderRoom(window.passage.name)%&gt;&lt;%=window.gm.printNav2()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngHC_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="357" name="DngHC_K4" tags="" position="850,4475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
A corridor illuminated by some torches.
&lt;%=window.gm.renderRoom(window.passage.name)%&gt;&lt;%=window.gm.printNav2()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngHC_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="358" name="DngHC_F5" tags="" position="975,4475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
Another hallway. Several passages to the small rooms are set into the wall. The doors are made of thick steel bars and give you the impression of prison cells.&lt;/br&gt;
All of the doors are closed right now. You cant see keyholes on them. There might be a different mechanism to unlock them.
Are you going to peek inside each cell and check if the door is locked?
Your eye catches something glinting in the darkness. Could be something useful like a weapon or gadget.
You peek into the darkness between the steel bars of the door. But there seems to be nothing inside beside some rotten straw and bowls. Just as you turn away a something dashs against the bars, barking and growling menacly.
Instinctively you take a big leap backwards. Fortunately the door withstands the onslaught and you take a glance at the attacker. Its some kind of dog and a large one of that. Short black fur covers its taut rump and head. The pointed ears and snarling snout makes it look like doberman. 

As soon as you enter the room you notice that some of the cell-doors are standing a jar. Thats not good. Some of the inhabitants might have left their home and might now room the rest of the compound.
&lt;%=window.gm.renderRoom(window.passage.name)%&gt;&lt;%=window.gm.printNav2()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngHC_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="359" name="DngHC_G5" tags="" position="1100,4475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
The altar of the good deeds: A demure person might &lt;a0 onclick=&#39;window.story.show(&quot;DngHC_Altar&quot;)&#39;&gt;pray&lt;/a&gt; here to get a blessing or a penalty removed. But you might have a deed to fullfill to prove you are a worthy person. 
&lt;%=window.gm.renderRoom(window.passage.name)%&gt;&lt;%=window.gm.printNav2()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngHC_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="360" name="DngHC_H5" tags="" position="1225,4475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;%=window.gm.renderRoom(window.passage.name)%&gt;&lt;%=window.gm.printNav2()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngHC_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="361" name="DngHC_I5" tags="" position="100,4600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
todo
&lt;%=window.gm.renderRoom(window.passage.name)%&gt;&lt;%=window.gm.printNav2()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngHC_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="362" name="DngHC_J5" tags="" position="225,4600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
A contraption is installed in the middle of the room. 
[[Check it out]] todo This seems to be a milking machinery, but who would make use of that here? Beeing locked in this device leaves you in no position to defend yourself.   

&lt;%=window.gm.renderRoom(window.passage.name)%&gt;&lt;%=window.gm.printNav2()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngHC_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="363" name="DngHC_L5" tags="" position="350,4600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
There is a opening in the northern wall. But its to high up and the wall is to smooth to climb. &lt;/br&gt;
A contraption is installed in the middle of the room.
&lt;%=window.gm.renderRoom(window.passage.name)%&gt;&lt;%=window.gm.printNav2()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngHC_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="364" name="DngHC_F6" tags="" position="475,4600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;%=window.gm.renderRoom(window.passage.name)%&gt;&lt;%=window.gm.printNav2()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngHC_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="365" name="DngHC_G6" tags="" position="600,4600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
On both side of this hallway, you spot several large levers. There are no inscriptions or symbols beside a single letter next to them. So you cant tell what each of them does.&lt;/br&gt;
They possibly open a door remotely or activate a mechanism. Opening a door sounds like a good idea - unless something nasty got relased by doing so.&lt;/br&gt;  
You could pull one of the levers: &lt;a0 id=&#39;A&#39; onclick=&#39;pullLever(this)&#39;&gt;Lever A&lt;/a&gt; &lt;a0 id=&#39;B&#39; onclick=&#39;pullLever(this)&#39;&gt;Lever B&lt;/a&gt;
&lt;div id=&#39;output&#39;&gt;&lt;/div&gt;
&lt;%=window.gm.renderRoom(window.passage.name)%&gt;&lt;%=window.gm.printNav2()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngHC_Encounters&quot;)%&gt;
&lt;script&gt;function pullLever(evt){
  var doors=window.story.state.DngHC.tmp.doors;
  if(evt.id==&#39;A&#39;){
    if(doors[&#39;H5&#39;][&#39;G5&#39;].state===0){
      doors[&#39;G5&#39;][&#39;H5&#39;].state=doors[&#39;H5&#39;][&#39;G5&#39;].state=1;
      window.gm.printOutput(&#39;Some chains are rattling and you hear some clanking noises in the east.&lt;/br&gt; That might be a opening gate. Lets just hope you didnt unleash anything else.&#39;);
      window.story.state.DngHC.tmp.mobs.push({id:&quot;SlimeG2&quot;,mob:&quot;slime&quot;,pos:&quot;G2&quot;,path:[&quot;G2&quot;,&quot;G3&quot;,&quot;G4&quot;],state:0,tick:&#39;&#39;,aggro:0});
    } else window.gm.printOutput(&#39;You pull the lever but nothing happens. Whatever the lever has triggered cannot be undone.&#39;);
  }
  if(evt.id==&#39;B&#39;){
    if(doors[&#39;J4&#39;][&#39;K4&#39;].state===0){
      doors[&#39;J4&#39;][&#39;K4&#39;].state=1;
      window.gm.printOutput(&#39;After the rusty old lever switched over, some mechanic works in the background for a bit of time.&#39;)
    } else window.gm.printOutput(&#39;You pull the lever but nothing happens. Whatever the lever has triggered cannot be undone.&#39;);
  }
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="366" name="DngHC_H6" tags="" position="725,4600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
Stone walls left right top bottom. I need air.&lt;/br&gt;
The tunnel towards west is leading downward and covered with some grime dripping out of the rotten pipes in the roof. It might be slippery, sending you sliding down on your rear, making it IMPOSSIBLE to return from that direction.&lt;/br&gt;

&lt;%=window.gm.renderRoom(window.passage.name)%&gt;&lt;%=window.gm.printNav2()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngHC_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="367" name="DngHC_I6" tags="" position="850,4600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
The area here is flooded with some murky water. You cant know how deep it is - or what else mmight be lurking below its surface.
&lt;%=window.gm.renderRoom(window.passage.name)%&gt;&lt;%=window.gm.printNav2()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngHC_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="368" name="DngHC_J6" tags="" position="975,4600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
The area here is flooded with some murky water. You cant know how deep it is - or what else mmight be lurking below its surface.
&lt;%=window.gm.renderRoom(window.passage.name)%&gt;&lt;%=window.gm.printNav2()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngHC_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="369" name="DngHC_K6" tags="" position="1100,4600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
The area here is flooded with some murky water. You cant know how deep it is - or what else mmight be lurking below its surface.
&lt;%=window.gm.renderRoom(window.passage.name)%&gt;&lt;%=window.gm.printNav2()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngHC_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="370" name="DngHC_Altar" tags="" position="1225,4600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;p class=&quot;tNPC1&quot;&gt;&quot;There is a portal hidden somewhere here but it is vamished and corrrupted. You need to resurrect its power to be able to flee from this place.&quot;&lt;/br&gt;
&quot;No one will come here to help you. If you just stay in that cell, you will just starve to death or get insane..&quot;&lt;/br&gt;
&quot;To be able to help you, you have to help me first. &quot;&lt;/br&gt;&lt;/p&gt;
&lt;% if(window.gm.quests.getMilestoneState(&quot;qDoorControl&quot;).id&lt;100){ %&gt;
&lt;div id=&#39;select1&#39; &gt; &lt;p class=&quot;tNPC1&quot;&gt;&quot;You might have noticed that some of the gates are closed, keeping you trapped here. There is a room with controls that can open the doors remotely. Find it and open the door to the east.&quot;&lt;/br&gt;
  &quot;You might meet some ... guards on your travel. Sometimes they don&#39;t let you pass just easily. It usually helps if you wear some of those collars.&quot;&lt;/p&gt;
  &lt;a0 onclick=&#39;window.gm.player.Wardrobe.addItem(window.gm.ItemsLib.CollarDog());window.gm.quests.forceQuestMilestone(&quot;qDoorControl&quot;,100,1);window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;);&#39;&gt;Accept &lt;/a&gt;&lt;/br&gt;
  &lt;/div&gt;&lt;div id=&#39;choice1a&#39; hidden&gt;Some kind of collar is placed on the altar. why didnt you notice it before? Its made from red leather and bones are imprinted on it all around. Its a dog collar obviously. &lt;/br&gt;
  &lt;p class=&quot;tNPC1&quot;&gt;&quot;Wear it and they should let you pass.&quot;&lt;/br&gt;&lt;/p&gt;
  &lt;p class=&quot;author&quot;&gt;You&#39;ve got a quest! Check your quest log. You also got something that you can equip in your outfit.&lt;/p&gt; 
&lt;/div&gt;
&lt;% }else if(window.gm.quests.getMilestoneState(&quot;qDoorControl&quot;).id===100 &amp;&amp; window.story.state.DngHC.tmp.doors[&#39;H5&#39;][&#39;G5&#39;].state===0){ %&gt;
  &lt;p class=&quot;tNPC1&quot;&gt;&quot;Find the room with some levers. It should be somewhere west of here. There you can open the gate in the east. Remember to outfit the collar if the guards give you to much trouble.&quot;&lt;/p&gt;
&lt;% }else if(window.gm.quests.getMilestoneState(&quot;qDoorControl&quot;).id===100 &amp;&amp; window.story.state.DngHC.tmp.doors[&#39;H5&#39;][&#39;G5&#39;].state===1){ 
  window.gm.quests.forceQuestMilestone(&quot;qDoorControl&quot;,200,100);window.gm.player.Inv.addItem(window.gm.ItemsLib.Sandwich(),2);%&gt;
  &lt;p class=&quot;tNPC1&quot;&gt;&quot;The gate should now be open so that you can explore further down the path.&quot;&lt;/br&gt;&lt;/br&gt;&quot;Take this food in case you feel hungry. There arent many things around that you could eat safely. But starving to death doesnt help either.&quot;&lt;/p&gt;
  &lt;p class=&quot;author&quot;&gt;That quest is finished. Use your inventory to check on your consumables.&lt;/p&gt; 
&lt;!-------------------------------------------------------------------------------&gt;
&lt;% }else if(window.gm.quests.getMilestoneState(&quot;qBlackCandle&quot;).id&lt;100){ %&gt;
&lt;div id=&#39;select1&#39; &gt; &lt;p class=&quot;tNPC1&quot;&gt;&quot;3 black candles were stolen. Someone could use them for a ritual. We need to secure them.&quot;&lt;/p&gt;
  &lt;a0 onclick=&#39;window.gm.quests.forceQuestMilestone(&quot;qBlackCandle&quot;,100,1);window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;);&#39;&gt;Accept&lt;/a&gt;&lt;/br&gt;
&lt;/div&gt;&lt;div id=&#39;choice1a&#39; hidden&gt;&lt;/br&gt;
&lt;/div&gt;
&lt;% }else if(window.gm.quests.getMilestoneState(&quot;qBlackCandle&quot;).id===100 &amp;&amp; window.gm.player.Inv.countItem(&quot;BlackCandle&quot;)&lt;3){ %&gt;
  &lt;p class=&quot;tNPC1&quot;&gt;&quot;You need to find 3 black candles.&quot;&lt;/p&gt;
&lt;% }else if(window.gm.quests.getMilestoneState(&quot;qBlackCandle&quot;).id===100 &amp;&amp; window.gm.player.Inv.countItem(&quot;BlackCandle&quot;)&gt;=3){ %&gt;
&lt;div id=&#39;select10&#39; &gt; &lt;p class=&quot;tNPC1&quot;&gt;&quot;Did you get those candles?&quot;&lt;/p&gt;
  &lt;a0 onclick=&#39;window.gm.player.Inv.removeItem(&quot;BlackCandle&quot;,3);window.gm.quests.forceQuestMilestone(&quot;qBlackCandle&quot;,200,100);window.gm.printTalkLink(&quot;div#select10&quot;,&quot;div#choice10a&quot;);&#39;&gt;Yes&lt;/a&gt;
&lt;/div&gt;&lt;div id=&#39;choice10a&#39; hidden&gt;You hand over the candles.&lt;/br&gt; &lt;p class=&quot;tNPC1&quot;&gt;&quot;Now rest and return to me later.&quot;&lt;/p&gt;
&lt;/div&gt;
&lt;% } %&gt;
&lt;/br&gt;[[Leave|DngHC_G5]]
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="371" name="DngHC_Vendor" tags="" position="100,4725" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
There is a vendor that sells some wares.
Steal - He sees to be sleeping most of the time, maybe you can pick something small when he closes his eyes
      - that stolen goods where cursed; some kind of theft counter measures?
&lt;/br&gt;[[Leave|DngHC_G5]]
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="372" name="Home" tags="name:your_dorms_hallway" position="225,4725" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
&lt;%window.gm.quests.addQuest(&quot;qFindGarden&quot;,1);window.gm.quests.addQuest(&quot;qStudy&quot;,1); %&gt;
At the doorsteps of your home. &lt;/br&gt;
The following things are on your schedule-list:&lt;/br&gt;
&lt;%=window.gm.printSchedule()%&gt;
&lt;/br&gt;&lt;/br&gt;&lt;div&gt;Where would you like to go?&lt;/br&gt;
[[Living_Room]]   [[Your Bedroom]]  [[Melanies Bedroom]] [[Kitchen]]  [[Garden]] [[Cellar|NOP]] &lt;/br&gt;
[[Into the city]]&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
function checkQuest(){
	if(window.story.state._gm.day&gt;1 &amp;&amp; window.gm.getTimeStruct().hour&gt;12 &amp;&amp; window.gm.quests.hasActiveQuest(&quot;qDLCMain&quot;,100)){
		window.story.show(&#39;ReceiveVREquipment&#39;);
	}
}
checkQuest();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="373" name="Kitchen" tags="" position="1231,613" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
You are in the kitchen. &lt;/br&gt;
&lt;%=window.gm.printPickupAndClear(&#39;CanOfCoffee&#39;,&#39;get a can of ice-coffee from the fridge&#39;,s.mom.coffeeStore)%&gt;
&lt;%=window.gm.printPickupAndClear(&#39;SimpleFood&#39;,&#39;eat some food mom prepared&#39;,s.mom.foodStore,function(){window.story.state.mom.foodStore=Math.max(0,--window.story.state.mom.foodStore);})%&gt;
Mom will take care to resupply the fridge. But she might be disappointed if you plunder heir fridge without giving something back.&lt;/br&gt;
&lt;% if(s.mom.location===window.passage.name &amp;&amp; s.mom.foodStore===0){ %&gt;
&#39;Sorry hun&#39; , mom responds on your greeetings, &#39;but if you eat all of the food, cant you take care to get some resupply?&#39; &lt;/br&gt;
&lt;% window.gm.player.gainRelation(&#39;Mom&#39;,-2);
}%&gt;
&lt;% if(s.mom.location===window.passage.name){ %&gt;
[[Mom|Info_Mom]] is here. &lt;/br&gt;
&lt;a href=&quot;javascript:void(0)&quot; onclick=&quot;window.gm.player.gainRelation(&#39;Mom&#39;,2);window.gm.refreshSidePanel();&quot; &gt;Greet her&lt;/a&gt;&lt;/br&gt;&lt;/br&gt;
&lt;%}%&gt;
Where would you like to go?&lt;/br&gt;
[[Living_Room]]   [[Hallway|Home]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="374" name="Melanies Bedroom" tags="" position="475,4725" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
This is the bedroom of Melanie.
A double bed is there with [[nightstands|moms_treasure]] on each side. &lt;br&gt;
&lt;%if(window.gm.player.name!==&#39;Cyril&#39;){%&gt;
&lt;a0 onclick=&#39;window.story.show(&quot;Talk_Cyril&quot;)&#39;&gt;Cyril is here&lt;/a&gt;&lt;/br&gt;
&lt;%}%&gt;
&lt;a0 onclick=&#39;switchChar(this)&#39;&gt;Switch Char&lt;/a&gt;&lt;/br&gt;
&lt;a0 onclick=&#39;inviteChar(this)&#39;&gt;Invite Char&lt;/a&gt;&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.pushDeferredEvent(&quot;HairGrow&quot;)&#39;&gt;Hair Tonic&lt;/a&gt;&lt;/br&gt;
[[Hallway|Home]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
function switchChar(elmnt){
	if(window.story.state._gm.activePlayer ===&#39;Cyril&#39;){
		window.gm.switchPlayer(&#39;PlayerRL&#39;);
	} else {
		window.gm.switchPlayer(&#39;Cyril&#39;);
	}
	elmnt.outerHTML=(&quot;&lt;div class=&#39;red&#39;&gt;You are now playing as &quot;+window.story.state._gm.activePlayer+&quot;. &lt;/div&gt;&quot;);
}
function inviteChar(elmnt){
	if(window.gm.isInParty(&#39;Cyril&#39;)){
		window.gm.removeFromParty(&#39;Cyril&#39;);
		elmnt.outerHTML=(&quot;&lt;div class=&#39;red&#39;&gt;You kicked Cyril from your team. &lt;/div&gt;&quot;);
	} else {
		window.gm.addToParty(&#39;Cyril&#39;);
		elmnt.outerHTML=(&quot;&lt;div class=&#39;red&#39;&gt;Cyril added to your team. &lt;/div&gt;&quot;);
	}
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="375" name="moms_treasure" tags="_back_" position="600,4725" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
In one of the nightstand you find some handcuffs.They look thorough but you think they just might be used for some bedplay.&lt;/br&gt;
&lt;a0 onclick=&#39;useHandcuff(this)&#39;&gt;Play with them&lt;/a&gt;&lt;/br&gt;
[[Back|_back_]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
function useHandcuff(elmnt){
	window.gm.player.Wardrobe.addItem(new Handcuffs());
	window.gm.player.Outfit.addItem(new Handcuffs());
	elmnt.replaceWith(&quot;&lt;div class=&#39;red&#39;&gt;Playing around with the cuffs you suddenly find yourself locked up with them. You panick as you find the locking-mechanic quite tight. You need a key and maybe some help to unlock them!&lt;/div&gt;&quot;);
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="376" name="Your Bedroom" tags="" position="1033,470" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;%window.gm.player.location=window.passage.name; 
window.gm.quests.addQuest(&quot;qMyPleasure&quot;,1);%&gt;
This is your Bedroom.
A desk with a wooden chair is setup as workingplace. &lt;br&gt;
Your [[Laptop|_Laptop_]] is placed on it and also a handwritten [[TODO-List|QuestList]]. &lt;/br&gt;
Above the desk is a window facing toward the backside of the house.&lt;/br&gt;
On the other side of the room is a large [[Wardrobe]] with a [[Mirror]] where you can take a look at yourself.
There is a large bed for sleeping with a nightstand aside. &lt;/br&gt;
&lt;!--todoYou are quite horny right now. Maybe you have some time to [[play with yourself|Masturbate]].&lt;/br&gt;--&gt;
&lt;a href=&quot;javascript:void(0)&quot; onclick=&#39;($(&quot;tw-passage&quot;).fadeOut(1000, function(){window.gm.addTime(60);window.story.show(&quot;Sleep&quot;);}));&#39;&gt;Nap 1hour&lt;/a&gt;
&lt;%if(window.gm.getTimeStruct().hour&lt;11){ %&gt;
&lt;a href=&quot;javascript:void(0)&quot; onclick=&#39;($(&quot;tw-passage&quot;).fadeOut(1000, function(){window.gm.player.sleep(1800);window.story.show(&quot;Sleep&quot;);}));&#39;&gt;Sleep Until Evening&lt;/a&gt; 
&lt;%} else {%&gt;
&lt;a href=&quot;javascript:void(0)&quot; onclick=&#39;($(&quot;tw-passage&quot;).fadeOut(1000, function(){window.gm.player.sleep(700);window.story.show(&quot;Sleep&quot;);}));&#39;&gt;Sleep Until Morning&lt;/a&gt;
&lt;%}%&gt;
&lt;div &lt;%=((window.gm.quests.getMilestoneState(&quot;qDLCMain&quot;).id&lt;600)?&quot;hidden&quot;:&quot;&quot;) %&gt; &gt;That bulky VR-scaffold is taking up a lot of space.  
	&lt;%if(window.gm.getTimeStruct().hour&gt;13){%&gt;
	You could &lt;a0 onclick=&#39;if(window.gm.quests.getMilestoneState(&quot;qDLCMain&quot;).id&lt;700) window.story.show(&quot;VRSuiteUp&quot;); else {window.story.show(&quot;ForestSpawn&quot;)}&#39;&gt;Try to enter the VR&lt;/a&gt;&lt;/br&gt; 
	&lt;%} else {%&gt;
	You have other things to do then play with it.&lt;/br&gt;
	&lt;%}%&gt;
&lt;/div&gt;
&lt;% if(window.gm.player.clothLevel()===&quot;naked&quot;){ %&gt;
&lt;div class=&quot;red&quot;&gt;You should at least cover up your unmentionables before leaving your room.&lt;/div&gt;&lt;/br&gt;
&lt;% } else { %&gt;
Where do you want to go ? &lt;/br&gt;
[[Hallway|Home]]&lt;/br&gt; &lt;%}%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="377" name="Sleep" tags="" position="850,4725" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
You fall into your bedsheets and sleep until your smartphone buzzes you out of your dreams.&lt;/br&gt;
&lt;/br&gt;&lt;div id=&#39;output&#39;&gt;&lt;/div&gt;
&lt;/br&gt;[[Next|&lt;%=window.gm.player.location%&gt;]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
function checkJob(){
	let text =&#39;&#39;;
	if(window.gm.getTimeStruct().DoW===1 &amp;&amp; window.gm.quests.hasActiveQuest(&quot;qFindAJob&quot;,200)){ 
		if(window.gm.quests.getQuestState(&quot;qFindAJob&quot;).flags&gt;=2){ 
			window.gm.player.Inv.addItem(new window.gm.ItemsLib.Money(),window.gm.quests.getQuestState(&quot;qFindAJob&quot;).flags*25);
			text+=&#39;You earned &#39;+window.gm.quests.getQuestState(&quot;qFindAJob&quot;).flags*25+&#39; $ for doing shifts at Harcon Medical.&#39;;
		} else {
			text+=&#39;You didnt do enough shifts at Harcon Medical to earn your minimum pay.&#39;;
		}
		window.gm.quests.getQuestState(&quot;qFindAJob&quot;).flags=0;
	}
	return(text);
}
window.gm.printOutput(checkJob());
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="378" name="Living_Room" tags="" position="975,4725" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
The living room that you share with your mom is sparsely decorated (until now).&lt;/br&gt;
An old wooden table with 4 chairs rests on a wornout green carpet.&lt;/br&gt;
Some money is laying on the table. Maybe mom forgot it there.&lt;/br&gt;
There is a brown couch with a television in front of it. A smaller table with a lamp on it is close by.&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.pushDeferredEvent(&quot;Deffered1&quot;,[1,2])&#39;&gt;Deffered1&lt;/a&gt;&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.pushDeferredEvent(&quot;Deffered2&quot;,[4,5])&#39;&gt;Deffered2&lt;/a&gt;&lt;/br&gt;
&lt;a0 onclick=&quot;getMoney(this,5)&quot;&gt;Get much money&lt;/a&gt;&lt;/br&gt;
&lt;%if(window.gm.quests.getMilestoneState(&quot;qFixLaptop&quot;).id&lt;1000){%&gt;
&lt;a0 onclick=&#39;window.gm.quests.forceQuestMilestone(&quot;qFixLaptop&quot;,1000,1);window.gm.refreshAllPanel();&#39;&gt;take powerconverter for laptop&lt;/a&gt;
&lt;%}%&gt;
&lt;%if(s.vars.qDogSit==0x200){%&gt;
Your phone rings with an unknown number. [[Answer call|Dogsit_FirstCallBack]] 
&lt;%}%&gt;
On one of the shelves is a small statue of a striding cat. &lt;a0 onclick=&quot;touchCatIdol(this)&quot;&gt;inspect cat idol&lt;/a&gt;&lt;/br&gt;
Where would you like to go?&lt;/br&gt;
[[Kitchen]] [[Hallway|Home]] &lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;script&gt;
function getMoney(elmnt,val){
	let msg=&quot;&lt;/br&gt;You shouldnt steal that money, should you?&quot;;
	let vulva = window.gm.player.Outfit.getItemForSlot(window.gm.OutfitSlotLib.bVulva);
	let pierc = window.gm.player.Outfit.getItemForSlot(window.gm.OutfitSlotLib.pClit);
	if(vulva &amp;&amp; vulva instanceof (window.storage.constructors[&#39;VulvaHuman&#39;])){
		if(pierc===null ){
			pierc= new window.gm.ItemsLib[&#39;PiercingClit&#39;]();
			pierc.style =100; 
			window.gm.player.Outfit.addItem(pierc,true);
			msg += &#39;You feel a short pain in your most private area. Maybe you should check up yourself.&#39;;
		} else {
			msg += &#39;You feel a tingling in your nethers where your privates are pierced.&#39;;
		}
	}
	elmnt.replaceWith(msg);
}
function touchCatIdol(elmnt){
	elmnt.replaceWith(&quot;Its just a simple statue.&quot;); //elmnt.replaceWith(&quot;There is a tickling feeling in your hand.&quot;);
}
&lt;/script&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="379" name="Cabinet" tags="" position="1100,4725" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
There is nothing here
[[Living_Room]]
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="380" name="Garden" tags="" position="1225,4725" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;window.gm.quests.tick();%&gt;
The garden behind the house is quite a mess. &lt;/br&gt;
&lt;p class=&quot;tPC&quot;&gt;&#39;There are a lot of molehills on the green. I should teach their creator a lesson.&#39;&lt;/p&gt;&lt;/br&gt;
&lt;a href=&quot;javascript:void(0)&quot; onclick=&#39;window.gm.encounters.moleX2(window.gm.player.location);&#39;&gt;Whack a mole&lt;/a&gt; &lt;/br&gt;
You accidently stepped on a mole and killed it. Achievement unlocked ! &lt;%window.gm.achievements.moleKillerGoldMedal=true;%&gt;
&lt;% if(s.mom.location==window.passage.name){ %&gt;
[[Mom|Info_Mom]] is wandering around. Maybe she is planning to setup some flower beds. &lt;/br&gt;
&lt;%}%&gt;
&lt;% if(window.gm.player.Inv.countItem(&#39;Shovel&#39;)&lt;=0){%&gt;
&lt;a0 id=&#39;Shovel&#39; onclick=&#39;(function($event){window.gm.player.Inv.addItem(new window.storage.constructors[$event.id]());window.gm.refreshAllPanel();}(this))&#39;&gt;take shovel&lt;/a&gt;&lt;/br&gt;
&lt;%} else {%&gt;
You remember that you took the shovel from here.&lt;/br&gt;
&lt;%}%&gt;
Where would you like to go?&lt;/br&gt;
[[Hallway|Home]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="381" name="Cellar" tags="" position="100,4850" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
The portal is still active. Do you dare to [[enter|Cellar_Portal]] it? &lt;/br&gt;&lt;/br&gt;
Where would you like to go?&lt;/br&gt;
[[Hallway|Home]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="382" name="Cellar_PortalReverse" tags="" position="225,4850" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
The portal spits you out in the dim light of your cellar.&lt;/br&gt;&lt;/br&gt;
[[Next|Cellar]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="383" name="Cellar_Portal" tags="" position="350,4850" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
A blinding light engulfs you just for a second and then a deafening darkness.  &lt;/br&gt;&lt;/br&gt;
Its impossible to tell what else happens or how long the process takes.&lt;/br&gt;&lt;/br&gt;
As you come back to your senses you find yourself cowering on the floor, still croggy from the experience.&lt;/br&gt;
Time to move on.&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;
Where would you like to go?&lt;/br&gt;
[[Home|Cellar_PortalReverse]] [[Mall|Mall 0F (postapocalypse)]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="384" name="HairGrow" tags="deferred" position="475,4850" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
A blinding light engulfs you just for a second and then a deafening darkness.  &lt;/br&gt;&lt;/br&gt;
Its impossible to tell what else happens or how long the process takes.&lt;/br&gt;&lt;/br&gt;
As you come back to your senses you find yourself cowering on the floor, still croggy from the experience.&lt;/br&gt;
Time to move on.&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;
Where would you like to go?&lt;/br&gt;
[[Next|&lt;%=window.gm.player.location%&gt;]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="385" name="Home_Study" tags="" position="600,4850" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;% window.gm.player.Stats.increment(&#39;energy&#39;,-20);window.gm.addTime(120);window.gm.quests.forceQuestMilestone(&quot;qStudy&quot;,100,1);%&gt;
You sit down with your books and scriblings and try to get some sense out of it.&lt;/br&gt;
[[Give up|&lt;%=window.gm.player.location%&gt;]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="386" name="DngLB_MAP" tags="_back_" position="725,4850" size="100,100">&lt;hr&gt;&lt;div id=&#39;canvas&#39;&gt;&lt;/div&gt;&lt;div id=&#39;svgpopup&#39;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;script&gt; window.gm.printMap2(window.story.state.DngSY.dngMap,window.gm.player.location.replace(window.story.state.DngSY.dng+&#39;_&#39;,&#39;&#39;),
    window.story.state.DngLB.mapReveal,window.story.state.DngLB.visitedTiles);
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="387" name="DngLB_Entry" tags="" position="850,4850" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
TODO Appear at bog.
&lt;/br&gt;&lt;p&gt; [[Next|DngLB_J4]] &lt;/br&gt;&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
function buildRooms(){
    const _m=[
        &#39;        H2  I2--J2        &#39;,
        &#39;        |       |         &#39;,
        &#39;        H3  I3--J3--K3    &#39;,
        &#39;        |   |             &#39;,
        &#39;F4--G4--H4--I4--J4--K4    &#39;,
        &#39;|   |           |         &#39;,
        &#39;F5  G5--H5--I5--J5--K5--L5&#39;,
        &#39;|       |           |     &#39;,
        &#39;F6      H6--I6--J6--K6--L6&#39;];
    let grid =[
    {room:&#39;H2&#39;, dirs:[&#39;H3&#39;]},
    {room:&#39;I2&#39;, dirs:[&#39;J2&#39;]},
    {room:&#39;J2&#39;, dirs:[&#39;I2&#39;,&#39;J3&#39;]},
    {room:&#39;H3&#39;, dirs:[&#39;H2&#39;,&#39;H4&#39;],           },
    {room:&#39;I3&#39;, dirs:[&#39;I4&#39;,&#39;J3&#39;],           },
    {room:&#39;J3&#39;, dirs:[&#39;I3&#39;,&#39;K3&#39;,&#39;J2&#39;]},
    {room:&#39;K3&#39;, dirs:[&#39;J3&#39;]},
    {room:&#39;F4&#39;, dirs:[&#39;G4&#39;,&#39;F5&#39;]},
    {room:&#39;G4&#39;, dirs:[&#39;F4&#39;,&#39;H4&#39;,&#39;G5&#39;]},
    {room:&#39;H4&#39;, dirs:[&#39;H3&#39;,&#39;G4&#39;,&#39;I4&#39;]},
    {room:&#39;I4&#39;, dirs:[&#39;H4&#39;,&#39;I3&#39;,&#39;J4&#39;]},
    {room:&#39;J4&#39;, dirs:[&#39;I4&#39;,&#39;J5&#39;,&#39;K4&#39;]       anno:[&#39;E&#39;]},
    {room:&#39;K4&#39;, dirs:[&#39;J4&#39;],                },
    {room:&#39;F5&#39;, dirs:[&#39;F4&#39;,&#39;F6&#39;]},
    {room:&#39;G5&#39;, dirs:[&#39;G4&#39;,&#39;H5&#39;]},
    {room:&#39;H5&#39;, dirs:[&#39;G5&#39;,&#39;I5&#39;,&#39;H6&#39;]},
    {room:&#39;I5&#39;, dirs:[&#39;H5&#39;,&#39;J5&#39;]},
    {room:&#39;J5&#39;, dirs:[&#39;I5&#39;,&#39;K5&#39;,&#39;J4&#39;]},
    {room:&#39;K5&#39;, dirs:[&#39;J5&#39;, &#39;K6&#39;,&#39;L5&#39;]},
    {room:&#39;L5&#39;, dirs:[&#39;K5&#39;],                },
    {room:&#39;F6&#39;, dirs:[&#39;F5&#39;],                ,
    {room:&#39;H6&#39;, dirs:[&#39;H5&#39;,&#39;I6&#39;]},
    {room:&#39;I6&#39;, dirs:[&#39;H6&#39;,&#39;J6&#39;],           },
    {room:&#39;J6&#39;, dirs:[&#39;I6&#39;,&#39;K6&#39;]},
    {room:&#39;K6&#39;, dirs:[&#39;K5&#39;,&#39;L6&#39;,&#39;J6&#39;]},
    {room:&#39;L6&#39;, dirs:[&#39;K6&#39;]}];
    let dng={grid:grid,width:14,height:8,legend:&#39;E=Portal&#39;}
    window.story.state.DngSY.dngMap=dng;
    //window.story.state.DngFM.visitedTiles=[];
}
    var s = window.story.state;
    s.DngSY.dng=&#39;DngLB&#39;;
    s.vars.spawnAt=&quot;DngSY_Recover_Death&quot;;
    s.DngLB.tmp={bovus:[], tickPass:&#39;&#39;};
    buildRooms();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="388" name="DngLB_Encounters" tags="" position="975,4850" size="100,100">&lt;script&gt;
function tick(){
    let here = window.passage.name;
    if(here===window.story.state.DngMN.tmp.tickPass) return;
    window.story.state.DngMN.tmp.tickPass=here;
    if(here===&#39;DngLB_H4&#39; || here===&#39;DngLB_G5&#39;|| here===&#39;DngLB_J3&#39;){
        window.gm.encounters.leech({amount:8, noStart:true});
        window.gm.Encounter.initCombat();
    }
}
function explore(){
    let rnd = _.random(0,100);
    window.gm.pushLog(&quot;rolled &quot;+rnd);
    window.story.state.tmp.args = [];
    if(rnd &gt; 70 ){
        window.gm.encounters.huntress();
    }else if(rnd &gt; 50){
        let find = [&#39;PurpleBerry&#39;,&#39;ApocaFlower&#39;];
        let rnd2 = _.random(0,find.length-1);
        window.story.state.tmp.args = [find[rnd2],1]
        window.story.show(&#39;ForestSearchAround&#39;);
    }
    else {
        window.story.show(&#39;ForestSearchAround&#39;); //nothing
    }
}
tick();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="389" name="DngLB_J4" tags="" position="1100,4850" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
A sludgy swamp&lt;/br&gt; 
&lt;%if(window.story.state.DngSY.dngLevel===4 &amp;&amp; window.gm.player.Inv.countItem(&#39;BogBovus&#39;)&gt;=4){%&gt;
    &lt;/br&gt;The portal has opened, time for your return.&lt;/br&gt;
    &lt;p&gt;[[Into the portal|DngLB_Lv4_Success]]&lt;/p&gt;
&lt;%}else{%&gt;
    &lt;p class=&quot;tPC&quot;&gt;&#39;I need to gather 4 mushrooms (purple cap with yellow splotches) before I&#39;m allowed to return.&#39;&lt;/p&gt;&lt;/br&gt;
&lt;%}%&gt; 
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="390" name="OBSOLETEDngNG_Door_Closed" tags="_nosave_" position="1225,4850" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
There is a gate in front of you but it is locked.&lt;/br&gt;
&lt;div id=&#39;output&#39;&gt;&lt;/div&gt;
&lt;a0 onclick=&#39;window.story.show(window.story.state.DngSY.prevLocation)&#39;&gt;Go back&lt;/a&gt;. 
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;function requiredKey(){
    var msg=&#39;&#39;,dng=window.story.state.DngSY.dng,doors=window.story.state.DngNG.tmp.doors;
    var x=window.story.state.DngSY.prevLocation.replace(dng+&#39;_&#39;,&#39;&#39;),y=window.story.state.DngSY.nextLocation.replace(dng+&#39;_&#39;,&#39;&#39;);
    var door = window.gm.canOpenDoor(x,y);
    window.gm.printOutput(door.msg+&quot;&lt;/br&gt;&quot;);
}
requiredKey()
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="391" name="DngNG_Timeout" tags="_nosave_" position="100,4975" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
todo you failed to finish the given task and get punished &lt;/br&gt;
get 2xmoney deducted if bringMoney task&lt;/br&gt;
get one of your items cursed &lt;/br&gt;
&lt;p&gt;[[Back|DngNG_D4]]&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="392" name="DngNG_Entry" tags="" position="225,4975" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
Finding yourself in a futuristic bunker, you need to make your escape.&lt;/br&gt;
Exit cryopod.
wearing fullbody coverall.
&lt;p&gt; [[Next|DngNG_D4]] &lt;/br&gt;&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
    var s = window.story.state,map,data;
    ({map,data}=window.gm.build_DngNG());
    s.DngNG=data;
    s.DngSY.dngMap=map;s.DngSY.dng=&#39;DngNG&#39;;
    s.vars.spawnAt=&quot;DngNG_Respawn&quot;;
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="393" name="DngNG_A1" tags="" position="350,4975" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
Somewhere in the dungeon.&lt;/br&gt;
&lt;%=window.gm.renderRoom(window.passage.name)%&gt;&lt;/br&gt;
&lt;div id=&#39;output&#39;&gt;&lt;/div&gt;
&lt;/br&gt;&lt;%=window.story.render(&#39;DngNG_Action&#39;)%&gt;&lt;/br&gt;&lt;div id=&quot;navpanel&quot;&gt;&lt;%=window.gm.printNav2()%&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngNG_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="394" name="DngNG_F3" tags="" position="475,4975" size="100,100">&lt;%=window.story.render(&quot;DngNG_A1&quot;)%&gt;</tw-passagedata><tw-passagedata pid="395" name="DngNG_G3" tags="" position="600,4975" size="100,100">&lt;%=window.story.render(&quot;DngNG_A1&quot;)%&gt;</tw-passagedata><tw-passagedata pid="396" name="DngNG_D4" tags="" position="725,4975" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;div id=&#39;select10&#39; &lt;%=((s.DngNG.tmp.qBabble&lt;=0)?&quot;&quot;:&quot;hidden&quot;)%&gt;&gt;
&lt;a0 onclick=&#39;window.story.state.DngNG.tmp.qBabble=1;window.gm.printTalkLink(&quot;div#select10&quot;,&quot;div#choice10a&quot;);&#39;&gt;pick up datapad&lt;/a&gt;
&lt;/div&gt;&lt;div id=&#39;choice10a&#39; hidden&gt;Aquired a datapad that speaks.
&lt;/div&gt;&lt;/br&gt;
&lt;div hidden&gt;You could rest here to recover health and energy. It might also be a good idea to save your progress.
&lt;%if(window.gm.getTimeStruct().hour&lt;11){ %&gt;
&lt;a0 onclick=&#39;($(&quot;tw-passage&quot;).fadeOut(1000, function(){window.gm.player.sleep(1800);window.story.show(&quot;DngNG_Sleep&quot;);}));&#39;&gt;Sleep Until Evening&lt;/a&gt; 
&lt;%} else {%&gt;
&lt;a0 onclick=&#39;($(&quot;tw-passage&quot;).fadeOut(1000, function(){window.gm.player.sleep(700);window.story.show(&quot;DngNG_Sleep&quot;);}));&#39;&gt;Sleep Until Morning&lt;/a&gt;
&lt;%}%&gt;&lt;/div&gt;
&lt;div hidden&gt;[[Storage Chest|GlobalChest]]&lt;/br&gt;&lt;/div&gt;&lt;/br&gt;
&lt;%=window.gm.printNav2()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngNG_Encounters&quot;)%&gt;
&lt;script&gt;function checkTask(){ //if a task is running but time is over -&gt; punishment
    let s=window.story.state,_t=s.DngNG.task;
    if(!_t || !_t.id) return;
    if(_t.time!==0,window.gm.getDeltaTime(window.gm.getTime(),_t.start)&gt;_t.time){
        s.DngNG.task={};
        window.story.show(&#39;DngNG_Timeout&#39;);
    }
}
checkTask();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="397" name="DngNG_E4" tags="" position="850,4975" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
A small corridor with only 2 doors.&lt;/br&gt;
There is some kind of a &lt;a0 onclick=&#39;window.story.show(&quot;DngNG_ChangeBooth&quot;)&#39;&gt;round booth&lt;/a&gt; with a display next to it. It reminds you of a changing cubicle in a clothing store or a shower cabine .
&lt;/br&gt;There is a hatch in the wall next to the booth, maybe it can be opened.&lt;/br&gt; 
&lt;%=window.gm.renderRoom(window.passage.name)%&gt;&lt;%=window.gm.printNav2()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngNG_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="398" name="DngNG_DngNG_E4DngNG_E5" tags="_nosave_" position="975,4975" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%if(s.DngNG.tmp.qKeyBlue===0){%&gt;
    The hatch is securely closed. There is a slot with a blue colored border and some runes around it. Could this be a keyhole?&lt;/br&gt; 
&lt;%}else{ s.DngNG.tmp.doors[&quot;E4&quot;][&quot;E5&quot;].state=1; %&gt;
    The blue keycard in your possesion fits in the colored slot on the hatch.    
&lt;%}%&gt;
&lt;a0 onclick=&#39;window.story.show(window.story.state.DngSY.prevLocation)&#39;&gt;Next&lt;/a&gt;. 
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="399" name="DngNG_F4" tags="" position="1100,4975" size="100,100">&lt;%=window.story.render(&quot;DngNG_A1&quot;)%&gt;</tw-passagedata><tw-passagedata pid="400" name="DngNG_F4_Explore" tags="_back_" position="1225,4975" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
You scanned this place for anything useful but your effort was a waste of time.
&lt;p&gt;[[Next|_back_]]&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="401" name="DngNG_G4" tags="" position="100,5100" size="100,100">&lt;%=window.story.render(&quot;DngNG_A1&quot;)%&gt;</tw-passagedata><tw-passagedata pid="402" name="DngNG_DngNG_G4DngNG_G5" tags="_nosave_" position="225,5100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
There is a password entry on that door. Its just 4 digits.&lt;/br&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;I need a passcode here. Maybe I should look around if I find a clue.&quot;&lt;/p&gt;
TODO: there are 4 hints scattered around, but if you try to get them all you get badend.
&lt;%if(s.DngNG.tmp.passFail&lt;3){%&gt;
    &lt;div id=&#39;select10&#39; &gt; 
    &lt;a0 onclick=&#39;window.story.state.DngNG.tmp.passFail+=1;window.gm.printTalkLink(&quot;div#select10&quot;,&quot;div#choice10a&quot;)&#39;&gt;Try a random code&lt;/a&gt;&lt;/br&gt;
    &lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select10&quot;,&quot;div#choice10b&quot;),window.story.show(window.story.state.DngSY.prevLocation);&#39;&gt;Stay away&lt;/a&gt;&lt;/br&gt;
    &lt;/div&gt;&lt;div id=&#39;choice10a&#39; hidden&gt;&lt;/br&gt; Pressing some of the runic letters in random order you expect some negative response.&lt;/br&gt;
        And indeed their is a disapproving chirp. &lt;/br&gt;
        You could possibly try your luck with another random code. But maybe there is a lockout logic that triggers if you enter the wrong passcode to many times. 
        &lt;/br&gt;&lt;a0 onclick=&#39;window.story.show(window.story.state.DngSY.prevLocation)&#39;&gt;Next&lt;/a&gt;.
    &lt;/div&gt;
    &lt;div id=&#39;choice10b&#39; hidden&gt;&lt;/br&gt;
    &lt;/div&gt;
&lt;%}else{%&gt;
    &lt;a0 onclick=&#39;window.story.show(window.story.state.DngSY.prevLocation)&#39;&gt;Next&lt;/a&gt;. 
&lt;%}%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="403" name="DngNG_DngNG_G4DngNG_G3" tags="_nosave_" position="350,5100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%if(window.gm.player.Outfit.countItem(&quot;CollarID&quot;)&gt;0){%&gt;
    &quot;Scanning...&quot; a voice chirps &quot;ID valid - access granted&quot; and the door in front of you opens. &lt;/br&gt;
    Better &lt;a0 onclick=&#39;window.story.show(window.story.state.DngSY.nextLocation)&#39;&gt;move on&lt;/a&gt; before it closes again.
&lt;%}else{%&gt;
    &quot;Scanning...&quot; a voice chirps &quot;No valid ID detected&quot;.&lt;/br&gt;
    &lt;p class=&quot;tPC&quot;&gt;&#39;So I need to find some ID-badge to get through this door?&#39;&lt;/p&gt; 
    &lt;a0 onclick=&#39;window.story.show(window.story.state.DngSY.prevLocation)&#39;&gt;Leave the door for now&lt;/a&gt;. 
&lt;%}%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="404" name="DngNG_H4" tags="" position="475,5100" size="100,100">&lt;%=window.story.render(&quot;DngNG_A1&quot;)%&gt;</tw-passagedata><tw-passagedata pid="405" name="DngNG_DngNG_H4DngNG_I4" tags="_nosave_" position="600,5100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
There is another locked bulkdoor and you are pretty sure it blocks your route to leaving this place.
&lt;p class=&quot;tNPC1&quot;&gt;&quot;This is a security gate that has been locked because some power brown out. You need to restore power, reset the door locks and get an ID-Tag to open it.&quot;&lt;/p&gt;
&lt;%if(s.DngNG.tmp.powerLevel&lt;=0){%&gt;
    &lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select10&quot;,&quot;div#choice10a&quot;)&#39;&gt;&quot;I&#39;m not a technican. How should I know how to fix a power system?&quot;&lt;/a&gt;&lt;/br&gt;
    &lt;div id=&#39;select10&#39; &gt; 
    &lt;/div&gt;&lt;div id=&#39;choice10a&#39; hidden&gt;&lt;/br&gt; 
        &lt;p class=&quot;tNPC1&quot;&gt;&quot;I guess we need some help here. Those spider bots do maintenance jobs. If we get into control of some, I could assign it to work on that issue.&quot;&lt;/p&gt;
        &lt;p class=&quot;tPC&quot;&gt;&quot;Why didnt they fix the power failure already on their own?&quot;&lt;/p&gt;
        &lt;p class=&quot;tNPC1&quot;&gt;&quot;That I dont know.&quot;&lt;/p&gt;
        &lt;p class=&quot;tPC&quot;&gt;&quot;And how do I remote control such a bot.&quot;&lt;/p&gt;
        &lt;p class=&quot;tNPC1&quot;&gt;&quot;You dont. But I can do that if we are able to get access to its CPU. Try to knock out some but dont deal to much damage.&quot;&lt;/p&gt;
    &lt;/div&gt;
&lt;%}else{%&gt;
    The power system seemsis back to a moderate state.&lt;/br&gt;
&lt;%}%&gt;
&lt;%if(s.DngNG.tmp.doorLock&lt;=0){%&gt;
    &lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select20&quot;,&quot;div#choice20a&quot;)&#39;&gt;&quot;How do I unlock this door?&quot;&lt;/a&gt;&lt;/br&gt;
    &lt;div id=&#39;select20&#39; &gt; 
    &lt;/div&gt;&lt;div id=&#39;choice20a&#39; hidden&gt;&lt;/br&gt; 
        &lt;p class=&quot;tNPC1&quot;&gt;&quot;There has to be some security terminal. I can do the hacking if we find an way to connect this pad to the system.&quot;&lt;/p&gt;
        &lt;p class=&quot;tNPC1&quot;&gt;&quot;This way I can reset the emergency lockdown, but you still have to get a ID-tag.&quot;&lt;/p&gt;
    &lt;/div&gt;
&lt;%}else{%&gt;
    The door locks seem to have disengaged.&lt;/br&gt;
&lt;%}%&gt;
&lt;%if(true){%&gt;
    &lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select30&quot;,&quot;div#choice30a&quot;)&#39;&gt;&quot;Where do I get an ID-tag?&quot;&lt;/a&gt;&lt;/br&gt;
    &lt;div id=&#39;select30&#39; &gt; 
    &lt;/div&gt;&lt;div id=&#39;choice30a&#39; hidden&gt;&lt;/br&gt; 
        &lt;p class=&quot;tNPC1&quot;&gt;&quot;We need to find a bare one that is not attached to any individual. Normally they are molded into the drones. To fit your kind, we should look around if we find some unused garments that has one.&quot;&lt;/p&gt;
    &lt;/div&gt;
&lt;%}else{%&gt;
    The id-tag you have should grant you access.&lt;/br&gt;
&lt;%}%&gt;
&lt;/br&gt;&lt;a0 onclick=&#39;window.story.show(window.story.state.DngSY.prevLocation)&#39;&gt;Next&lt;/a&gt;.
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="406" name="DngNG_I4" tags="" position="725,5100" size="100,100">&lt;%=window.story.render(&quot;DngNG_A1&quot;)%&gt;</tw-passagedata><tw-passagedata pid="407" name="DngNG_J4" tags="" position="850,5100" size="100,100">&lt;%=window.story.render(&quot;DngNG_A1&quot;)%&gt;</tw-passagedata><tw-passagedata pid="408" name="DngNG_D5" tags="" position="975,5100" size="100,100">&lt;%=window.story.render(&quot;DngNG_A1&quot;)%&gt;</tw-passagedata><tw-passagedata pid="409" name="DngNG_DngNG_E5DngNG_F5" tags="_nosave_" position="1100,5100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
The crawlspace gets thighter here.
&lt;%if(false){ s.DngNG.tmp.doors[&quot;E5&quot;][&quot;F5&quot;].state=1;%&gt;
    &lt;p class=&quot;tPC&quot;&gt;&quot;Seems I&#39;m small enough to fit into that pipe.&quot;&lt;/p&gt;
&lt;%}else{%&gt;
    As with your size, you are not comfortable to try to slip into that tight opening.&lt;/br&gt;
    &lt;a0 onclick=&#39;window.story.show(window.story.state.DngSY.prevLocation)&#39;&gt;Next&lt;/a&gt;. 
&lt;%}%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="410" name="DngNG_E5" tags="" position="1225,5100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
Behind the hatch in the ajoining room you find a crawlspace with leading left and right.&lt;/br&gt;
There is also some kind of [[switchbox|DngNG_E5_Switch]] with a display on it.&lt;/br&gt;
&lt;%=window.gm.renderRoom(window.passage.name)%&gt;&lt;%=window.gm.printNav2()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="411" name="DngNG_F5" tags="" position="100,5225" size="100,100">&lt;%=window.story.render(&quot;DngNG_A1&quot;)%&gt;</tw-passagedata><tw-passagedata pid="412" name="DngNG_G5" tags="" position="225,5225" size="100,100">&lt;%=window.story.render(&quot;DngNG_A1&quot;)%&gt;</tw-passagedata><tw-passagedata pid="413" name="DngNG_H5" tags="" position="350,5225" size="100,100">&lt;%=window.story.render(&quot;DngNG_A1&quot;)%&gt;</tw-passagedata><tw-passagedata pid="414" name="DngNG_I5" tags="" position="475,5225" size="100,100">&lt;%=window.story.render(&quot;DngNG_A1&quot;)%&gt;</tw-passagedata><tw-passagedata pid="415" name="DngNG_J5" tags="" position="600,5225" size="100,100">&lt;%=window.story.render(&quot;DngNG_A1&quot;)%&gt;</tw-passagedata><tw-passagedata pid="416" name="DngNG_D6" tags="" position="725,5225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
This seems to be an abandoned storage.&lt;/br&gt; Crude equipment and boxes are lined up on the shelves. 
&lt;/br&gt;
&lt;div id=&#39;select10&#39; &gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select10&quot;,&quot;div#choice10a&quot;)&#39;&gt;Look for something useful&lt;/a&gt;&lt;/br&gt;
&lt;/div&gt;&lt;div id=&#39;choice10a&#39; hidden&gt;&lt;/br&gt; Without knowing what to look for, this seems just a waste of time. Most of it seems to be rubble anyway.
&lt;/div&gt;
&lt;%=window.gm.renderRoom(window.passage.name)%&gt;&lt;%=window.gm.printNav2()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="417" name="DngNG_E6" tags="" position="850,5225" size="100,100">&lt;%=window.story.render(&quot;DngNG_A1&quot;)%&gt;</tw-passagedata><tw-passagedata pid="418" name="DngNG_F6" tags="" position="975,5225" size="100,100">&lt;%=window.story.render(&quot;DngNG_A1&quot;)%&gt;</tw-passagedata><tw-passagedata pid="419" name="DngNG_Meet_Dog" tags="_nosave_" position="1100,5225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
There is some kind of robot shuffling around. &lt;/br&gt;
It looks like some of those robotic pet dogs you saw in a science show. It just looks a little bigger, around half a meter. And its movements are much more fluid and natural.&lt;/br&gt;&lt;/br&gt;

&lt;%if(s.DngNG.tmp.qLatex===0){%&gt;
    Ignoring your presence it just continues its duty of patrolling the corridors. You hurry &lt;a0 onclick=&#39;window.story.show(window.story.state.DngSY.nextLocation)&#39;&gt;onward&lt;/a&gt;.    
&lt;%}else if(true){%&gt;
    As the robot notices you, it shows some kind of interest in you and trots over. &lt;/br&gt;
    &lt;div id=&#39;select10&#39; &gt;
    &lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select10&quot;,&quot;div#choice10a&quot;)&#39;&gt;Push it away&lt;/a&gt;&lt;/br&gt;
    &lt;/div&gt;&lt;div id=&#39;choice10a&#39; hidden&gt;&lt;/br&gt; That might have been an error as your behaviour earned you a growl. &lt;a0 onclick=&#39;dogEncounter();&#39;&gt;You might have to defend yourself.&lt;/a&gt;
    &lt;/div&gt; 
&lt;%}else if(true){%&gt;
    The apparatus seems not interested in you and you &lt;a0 onclick=&#39;window.story.show(window.story.state.DngSY.nextLocation)&#39;&gt;might pass&lt;/a&gt; or walk back where you &lt;a0 onclick=&#39;window.story.show(window.story.state.DngSY.prevLocation)&#39;&gt;came from&lt;/a&gt;.
&lt;%}else{%&gt;
    As you are in no position to start a quarrel, you just halt your movement as the mechanic creature checks up on you. &lt;/br&gt;
    &lt;%if(true){%&gt;
        With your legs and arms bound you just keep your quaddrupped stance and wait what will happen. &lt;/br&gt;
        &lt;a0 onclick=&#39;dogSex();&#39;&gt;Shiver in fear&lt;/a&gt;
    &lt;%}else{%&gt;

    &lt;%}%&gt; 
&lt;%}%&gt;
You may try your luck and &lt;a0 onclick=&#39;dogEncounter();&#39;&gt;walk further&lt;/a&gt; in its direction but maybe its wise to  
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngHC_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="420" name="DngNG_Sleep" tags="" position="1225,5225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
Get some rest on that bunk.&lt;/br&gt;
&lt;/br&gt;&lt;div id=&#39;output&#39;&gt;&lt;/div&gt;
&lt;/br&gt;&lt;a0 onclick=&#39;window.story.show(&quot;DngNG_D4&quot;)&#39;&gt;Next&lt;/a&gt;&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="421" name="DngNG_Trap_Dehair" tags="_nosave_" position="100,5350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
Scanner triggers and laser turret shots.&lt;/br&gt; You just triggered a trap! &lt;/br&gt;
&lt;div id=&#39;select10&#39; hidden&gt;&lt;/div&gt;
&lt;div id=&#39;choice10a&#39; hidden&gt;&lt;/br&gt;Your attempt to evade the ray failed. As your upper gets hit, you can feel the heat on your back. Checking on yourself after you have rolled into cover, you find your upper clothing beeing damaged.&lt;/br&gt;
The &lt;%=(&quot;...&quot;)%&gt; that covers your body now is &lt;%=(&quot;slightly&quot;)%&gt; damaged.
&lt;/div&gt;
&lt;div id=&#39;choice10b&#39; hidden&gt;&lt;/br&gt;Gladly, you could evade the ray and and escape unscathed.&lt;/br&gt;
&lt;/div&gt;
&lt;div id=&#39;choice10c&#39; hidden&gt;&lt;/br&gt;Your upper clothing vanishs in a puff of smoke, leaving your chest exposed! &lt;/br&gt;
&lt;/div&gt;
&lt;a0 onclick=&#39;_done=false,window.story.show(window.story.state.DngSY.prevLocation)&#39;&gt;retreat&lt;/a&gt;.
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
{var _triggered,_done,_item;
    if(!_done){ _done=true;
        _item=window.gm.player.Outfit.getItemForSlot(&quot;Breast&quot;);
        if(_item){
            _item.HP=_item.HP-25;
            if(_item.HP&lt;=0) { window.gm.player.Outfit.removeItem(_item.id);
                window.gm.printTalkLink(&quot;div#select10&quot;,&quot;div#choice10c&quot;);
            } else {
                window.gm.printTalkLink(&quot;div#select10&quot;,&quot;div#choice10a&quot;);
            }
        } else {
            window.gm.printTalkLink(&quot;div#select10&quot;,&quot;div#choice10b&quot;);
        }
    }
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="422" name="InspectPlayer" tags="_back_" position="225,5350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
[[Back|_back_]]&lt;/br&gt; Checking on yourself you find..&lt;/br&gt;
&lt;div id=&#39;output&#39;&gt;&lt;%=window.gm.InspectSelf(window.gm.player,true)%&gt;&lt;div&gt;
&lt;/br&gt;[[Back|_back_]]&lt;/br&gt;
&lt;!--todo: set height depending on browsersize--&gt;
&lt;!--&lt;div id=&#39;Canvas&#39; style=&#39;height: 30em;background: url(&quot;assets/doll/doll_small_xcf-Skirt.png&quot;) no-repeat center,url(&quot;assets/doll/doll_small_xcf-Body.png&quot;) no-repeat center, url(&lt;%=window.gm.getScenePic(window.gm.player.location)%&gt;)no-repeat center;color:black;&#39;&gt;&lt;/div&gt;--&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="423" name="DngNG_Spider" tags="_nosave_" position="350,5350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;%if(true){%&gt;
    Hearing something clicking and clacking, you look around in the new room to find its source.&lt;/br&gt;
    Its caused by a small bot with spider like appearance. Its as big as 2 hands.
    &lt;p class=&quot;tPC&quot;&gt;&#39;Im just glad that this is not a real spider.&lt;/p&gt; Even someone without explicit fear of spiders wouldnt like to handle something of that size.
    As you try to sneak by, the bot whirls around - you have its attention.
    &lt;div id=&#39;select10&#39; &gt;
    &lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select10&quot;,&quot;div#choice10a&quot;),window.story.show(&quot;DngNG_SpiderFight&quot;)&#39;&gt;Stomp it.&lt;/a&gt;&lt;/br&gt;
    &lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select10&quot;,&quot;div#choice10b&quot;),window.story.show(window.story.state.DngSY.nextLocation)&#39;&gt;Try to avoid it.&lt;/a&gt;&lt;/br&gt;
    &lt;/div&gt;&lt;div id=&#39;choice10a&#39; hidden&gt;&lt;/br&gt;
    &lt;/div&gt;
    &lt;div id=&#39;choice10b&#39; hidden&gt;&lt;/br&gt;
    &lt;/div&gt;
&lt;%}else{%&gt;
    Another of those spider bots is busy here. Lets see what you can do about that.
    &lt;/br&gt;&lt;a0 onclick=&#39;window.story.show(&quot;DngNG_SpiderFight&quot;)&#39;&gt;Smash it&lt;/a&gt;
&lt;%}%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="424" name="DngNG_F3_Screen" tags="" position="475,5350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
Your babble companion translates the symbols on the screen.
&lt;%if()%&gt;
&lt;p class=&quot;tNPC1&quot;&gt;&quot;main power interrupted ; switchover to spare relais failed du to electrical failure in switchboard SS+02&quot;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&#39;Maybe there is a problem in one of those cabinets?&#39;&lt;/p&gt;
&lt;a0 onclick=&#39;window.story.show(window.story.state.DngSY.prevLocation)&#39;&gt;retreat&lt;/a&gt;.
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="425" name="DngNG_E5_Switch" tags="_nosave_" position="600,5350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
With the help of your companion you decypher the display on the switch box.&lt;/br&gt;
&lt;%if(window.story.state.DngNG.tmp.qPowRoute===0){%&gt;
&lt;p class=&quot;tNPC1&quot;&gt;&quot;Constructor unit Cro-4E5D in maintenance mode. Reason: power conservation due to power failure.&quot;&lt;/p&gt;
Some options are listed, maybe you can activate the constructor.
&lt;div id=&#39;select10&#39; &gt;
&lt;a0 onclick=&#39;window.story.state.DngNG.tmp.qPowRoute=1;window.gm.printTalkLink(&quot;div#select10&quot;,&quot;div#choice10a&quot;)&#39;&gt;Disable maintenance mode&lt;/a&gt;&lt;/br&gt;
&lt;/div&gt;&lt;div id=&#39;choice10a&#39; hidden&gt;&lt;/br&gt;
    &lt;p class=&quot;tNPC1&quot;&gt;&quot;Rerouting power to constructor. Warning: power level low. Switching to operation mode.&quot;&lt;/p&gt;
    Well that seems to work. But if its rerouting the power from somewhere, maybe other things are not working. At least until you find a way to fix the powersupply in general.

&lt;/div&gt;
&lt;%}else{%&gt;
    The display shows nothing.
&lt;%}%&gt;

&lt;a0 onclick=&#39;window.story.show(window.gm.player.location)&#39;&gt;leave&lt;/a&gt;.
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="426" name="DngNG_ChangeBooth" tags="_nosave_" position="725,5350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
Your AI-companion decyphers the symbols on the panel:
&lt;p&gt;&quot;Devices disabled for maintenance. Normal operation requires disabling of maintenance mode.&quot;&lt;/p&gt;
&quot;There should be a maintenance terminal somewhere, just look around.&quot;
The booth seems to be made from one piece of plastic. There are no panels to unscrew. But some thick wires seem to go into the wall, right next to that hatch.&lt;/br&gt;
----------
&lt;p&gt;&quot;Operational&quot;&lt;/p&gt;
Seems the booth is working again.
&lt;a0 onclick=&#39;window.story.show(&quot;DngNG_ChangeBoothFitID&quot;)&#39;&gt;Inspect the booth&lt;/a&gt;.
&lt;a0 onclick=&#39;window.story.show(&quot;DngNG_ChangeBoothShop&quot;)&#39;&gt;Step into the booth&lt;/a&gt;.

&lt;a0 onclick=&#39;window.story.show(window.gm.player.location)&#39;&gt;leave&lt;/a&gt;.
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="427" name="DngNG_ChangeBoothFitID" tags="_nosave_" position="850,5350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
The door of the booth swishes closed after you have stepped inside.
&quot;Scanning - please adjust position to markings&quot; 

&quot;Warning: ID detection failed. Select how to proceede:&quot;
&quot;a) terminate process&quot;
&quot;b) reassign ID&quot;

&quot;Please select an option for the reassigning process:&quot;
&quot;a) temporary ID-token&quot;
&quot;b) permanent ID-token&quot;
&quot;Huh, whats the difference?&quot;
&#39;Permanent somehow sounds -permanent. Better choose temporary.&#39;

&quot;I choose the temporary token.&quot;
As soon as you say that the robotical voice confirms with &quot;request accepted&quot;. 
&quot;Um, do I need to stay in that position while I wait?&quot;
&quot;Please attach your temporary ID-token to your neck.&quot; A hatch in front of you slides open and presents you a&lt;/br&gt;
...collar?
Its made from shiny black material with a metalic clasp.
&lt;p class=&quot;tPC&quot;&gt;&quot;Oh no, thats not what I expected. Dont you have some badge with a neckband or clip?&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC2&quot;&gt;&quot;Attach temporary ID-token to your neck.&quot;&lt;/p&gt;
&lt;div id=&#39;select30&#39; &gt;
&lt;a0 onclick=&#39;window.gm.player.Outfit.addItem(new window.gm.ItemsLib[&quot;CollarID&quot;]());window.gm.printTalkLink(&quot;div#select30&quot;,&quot;div#choice30a&quot;)&#39;&gt;Do as ordered&lt;/a&gt;&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.player.Outfit.addItem(new window.gm.ItemsLib[&quot;CollarID&quot;]());window.gm.printTalkLink(&quot;div#select30&quot;,&quot;div#choice30b&quot;)&#39;&gt;reject&lt;/a&gt;&lt;/br&gt;
&lt;/div&gt;&lt;div id=&#39;choice30a&#39; hidden&gt;&lt;/br&gt;
    &quot;Dam it, thats tight.&quot; You fiddle around with your fingers to find the clasp and unlock this thing. But you cant find a clue how to do so.
    &quot;OK, no problem its only temporary whatever it means. Maybe I can cut it through with some knife.&quot;
    &lt;a0 onclick=&#39;window.story.show(&quot;DngNG_ChangeBooth&quot;)&#39;&gt;Next&lt;/a&gt;.
&lt;/div&gt;
&lt;div id=&#39;choice30b&#39; hidden&gt;&lt;/br&gt;
    &lt;a0 onclick=&#39;window.story.show(&quot;DngNG_ChangeBooth&quot;)&#39;&gt;Next&lt;/a&gt;.
&lt;/div&gt;

&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="428" name="DngNG_ChangeBoothShop" tags="_nosave_" position="975,5350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
The door of the booth swishes closed after you have stepped inside.
&quot;Scanning - please adjust position to markings&quot; 

&quot;Coat contamination detected&quot;
Get Latexitus removed. with coverall

&quot;Select option:&quot;

&quot;Warning: construction material depleted. Please provide provisions.&quot;
&quot;I guess we will need to get some of those materials or I will end up running around naked.&quot;

[[DngNG_ChangeBooth]]
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="429" name="PowerupIntro" tags="" position="1100,5350" size="100,100">&lt;p class=&quot;tPC&quot;&gt;&quot;That was awesome ! How did I do that?&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC1&quot;&gt;&quot;Its in the technology of those attachements.&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC1&quot;&gt;&quot;Most of those are prototypes, so they might have a flaw or two. And they need lots of energy.&quot;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;So I have to carry lots of batteries with me?&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC1&quot;&gt;&quot;Yes keep those batteries charged. Some of the gadgets also require sophiasted components to operate. Its called matter.&quot;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;What do you mean with matter?&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC1&quot;&gt;&quot;They have developed different semi-organic materials with unique capabilitys. Only with those sophiasted components, all this tech can be created and maintained.&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC1&quot;&gt;&quot;This also means you can get some of the required matter from those drones.&quot;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;So I just need to scrap some of those metall guys to get the stuff.&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC1&quot;&gt;&quot;That I would not recommend. It could alert maintenance supervisors if they detect some uncommon loss of bots. But if you cut off a little bit here and there, it might go unnoticed.&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC1&quot;&gt;&quot;Lets see what kind of ways we can get by.&quot;&lt;/p&gt;
&lt;/br&gt;</tw-passagedata><tw-passagedata pid="430" name="MaintenanceIntro" tags="" position="1225,5350" size="100,100">&lt;p class=&quot;tNPC1&quot;&gt;&quot;Your augments got damaged and need to be repaired. There are service stations all around.&quot;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;Wont they recognize me as human?&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC1&quot;&gt;&quot;Maybe. But they will just try to repair your broken mechanic. There could be a diiferent issue.&quot; &lt;/p&gt;
&lt;p class=&quot;tNPC1&quot;&gt;&quot;Well, its sometimes cheaper to scrap a damaged machine and build it anew instead of trying to patch it up. So if your maintenance is expensive, it might cost you extra.&quot;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;But I have no money with me.&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC1&quot;&gt;&quot;Guess what, payment is done with matter. Matter is the new money.&quot;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;And if I dont have the matter?&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC1&quot;&gt;&quot;If you are a \&quot;good, helpful drone\&quot;, the repair-AI might give a maintenace for free. ;)&quot;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;That wink was kinda unsettling. What do you mean with good and helpful?&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC1&quot;&gt;&quot;I will explain later. Lets get going and get you fixed.&quot;&lt;/p&gt;</tw-passagedata><tw-passagedata pid="431" name="RepairDroneDestroyer" tags="" position="100,5475" size="100,100">&quot;Hey, someone has repaired those controls.&quot;
&quot;Yes. May I remember you about those small bots all around. Its their job to fix things.&quot;
&quot;I cant be at multiple places at the same time. So how can we make stop them repairing it.&quot;
&quot;Multiple approaches possible:&quot;
&quot;a) damage enough of those drones. But that might alert supervisors&quot;
&quot;b) alter their work parameters. It might not be possible to make them stop repairing things completely. But if they get a bit lazzy no one should note immediatly.&quot;
Destroyed bots regrow, so you have to act quickly. More fight-drids appear.
Altering programm requires terminal access, requires security, requires restraints?</tw-passagedata><tw-passagedata pid="432" name="DngMN_MAP" tags="_back_" position="225,5475" size="100,100">&lt;hr&gt;&lt;div id=&#39;canvas&#39;&gt;&lt;/div&gt;&lt;div id=&#39;svgpopup&#39;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;script&gt; window.gm.printMap2(window.story.state.DngSY.dngMap,window.gm.player.location.replace(window.story.state.DngSY.dng+&#39;_&#39;,&#39;&#39;),
    window.story.state.DngMN.mapReveal,window.story.state.DngMN.visitedTiles);
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="433" name="DngMN_Entry" tags="" position="350,5475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
The other side of the portal exits on a large slab of rock. It is located at the upper end of a cliff.
From here you have a great view of the lower valley and a large waterfall on the other side of the crevasse.&lt;/br&gt; 
The water thunders into a rushing river that meanders through the canyon.&lt;/br&gt; 
&lt;/br&gt;&lt;p&gt; [[Next|DngMN_I3]] &lt;/br&gt;&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
function buildRooms(){
    const _m=[
        &#39;F1                        &#39;,
        &#39;|                         &#39;,
        &#39;F2--G2--H2--I2--J2        &#39;,
    &#39;                    |         &#39;,
    &#39;                I3--J3--K3    &#39;,
    &#39;                        |     &#39;,
    &#39;                        K4    &#39;,
    &#39;                        |     &#39;,
    &#39;            H5--I5--J5--K5--L5&#39;];
    function _d(dir){return({dir:dir,exp:0});};
    let grid =[
    {room:&#39;F1&#39;, dirs:[_d(&#39;F2&#39;)]             },
    {room:&#39;F2&#39;, dirs:[_d(&#39;F1&#39;),_d(&#39;G2&#39;)]             },
    {room:&#39;G2&#39;, dirs:[_d(&#39;F2&#39;),_d(&#39;H2&#39;)]             },
    {room:&#39;H2&#39;, dirs:[_d(&#39;G2&#39;),_d(&#39;I2&#39;)]             },
    {room:&#39;I2&#39;, dirs:[_d(&#39;J2&#39;),_d(&#39;H2&#39;)]             },
    {room:&#39;J2&#39;, dirs:[_d(&#39;I2&#39;),_d(&#39;J3&#39;)]        },
    //{room:&#39;F3&#39;, dirs:[&#39;_d(F4&#39;)]},
    //{room:&#39;G3&#39;, dirs:[&#39;_d(G2&#39;),_d(&#39;G4&#39;)]},
    //{room:&#39;H3&#39;, dirs:[&#39;_d(H2&#39;),_d(&#39;H4&#39;)],           },
    {room:&#39;I3&#39;, dirs:[_d(&#39;J3&#39;)]             ,anno:[&#39;E&#39;]},
    {room:&#39;J3&#39;, dirs:[_d(&#39;I3&#39;),_d(&#39;K3&#39;),_d(&#39;J2&#39;)]   },
    {room:&#39;K3&#39;, dirs:[_d(&#39;J3&#39;),_d(&#39;K4&#39;)]        },
    //{room:&#39;F4&#39;, dirs:[&#39;_d(F3&#39;),_d(&#39;G4&#39;),_d(&#39;F5&#39;)]},
    //{room:&#39;G4&#39;, dirs:[&#39;_d(G3&#39;),_d(&#39;F4&#39;),_d(&#39;H4&#39;),_d(&#39;G5&#39;)]},
    //{room:&#39;H4&#39;, dirs:[&#39;_d(H3&#39;),_d(&#39;G4&#39;)]},
    //{room:&#39;I4&#39;, dirs:[&#39;_d(H4&#39;),_d(&#39;I3&#39;),_d(&#39;J4&#39;)]},
    //{room:&#39;J4&#39;, dirs:[&#39;_d(I4&#39;),_d(&#39;J5&#39;),_d(&#39;K4&#39;)]},
    {room:&#39;K4&#39;, dirs:[_d(&#39;K3&#39;),_d(&#39;K5&#39;)]         },
    //{room:&#39;F5&#39;, dirs:[&#39;_d(F4&#39;),_d(&#39;F6&#39;)]},
    //{room:&#39;G5&#39;, dirs:[&#39;_d(G4&#39;),_d(&#39;H5&#39;),_d(&#39;G6&#39;)]},
    {room:&#39;H5&#39;, dirs:[_d(&#39;I5&#39;)]             },
    {room:&#39;I5&#39;, dirs:[_d(&#39;H5&#39;),_d(&#39;J5&#39;)]        },
    {room:&#39;J5&#39;, dirs:[_d(&#39;I5&#39;),_d(&#39;K5&#39;)]        },
    {room:&#39;K5&#39;, dirs:[_d(&#39;J5&#39;),_d(&#39;K4&#39;),_d(&#39;L5&#39;)]  },
    {room:&#39;L5&#39;, dirs:[_d(&#39;K5&#39;)]             }];
    window.story.state.DngSY.dngMap={grid:grid,width:14,height:8};
}
    var s = window.story.state;
    s.vars.spawnAt=&quot;DngSY_Recover_Death&quot;;//might also set this in encounter
    s.DngSY.dng=&#39;DngMN&#39;;
    s.DngMN.tmp={page:[], tickPass:&#39;&#39;};
    buildRooms();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="434" name="DngMN_Encounters" tags="" position="475,5475" size="100,100">&lt;script&gt;
function tick(){
    let here = window.passage.name;
    if(here===window.story.state.DngMN.tmp.tickPass) return;
    window.story.state.DngMN.tmp.tickPass=here;
    if(here===&#39;DngMN_J5&#39; || here===&#39;DngMN_F2&#39;){
        window.gm.encounters.wolf({levelUp:-3,amount:1});
    }
}
function fightHawk(){
    window.gm.encounters.hawk({levelUp:-3,amount:1, noStart:true});
    window.gm.Encounter.onVictory = (function(){
        window.story.state.DngMN.tmp.page[window.gm.player.location]=true;
        window.gm.player.Inv.addItem(new window.gm.ItemsLib[&#39;IgneumPage&#39;]());
        return(&#39;After getting rid of that huge hawk, that &lt;b&gt;book page&lt;/b&gt; is yours.&lt;/br&gt; &#39;+this.fetchLoot()+&#39;&lt;/br&gt;&#39; + window.gm.printLink(&#39;Next&#39;,&#39;window.gm.postVictory()&#39;));});
    window.gm.Encounter.initCombat();
}
function fightWolf(){
    window.gm.encounters.wolf({amount:1, noStart:true});
    window.gm.Encounter.initCombat();
}
function explore(){
    let rnd = _.random(0,100);
    window.gm.pushLog(&quot;rolled &quot;+rnd);
    window.story.state.tmp.args = [];
    if(rnd &gt; 70 ){
        window.gm.encounters.huntress();
    }else if(rnd &gt; 50){
        let find = [&#39;PurpleBerry&#39;,&#39;ApocaFlower&#39;];
        let rnd2 = _.random(0,find.length-1);
        window.story.state.tmp.args = [find[rnd2],1]
        window.story.show(&#39;ForestSearchAround&#39;);
    }
    else {
        window.story.show(&#39;ForestSearchAround&#39;); //nothing
    }
}
tick();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="435" name="DngMN_Success" tags="" position="600,5475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
Finally, you got all the pages and can step through the portal.&lt;/br&gt;
Cyril is already there waiting for you.&lt;/br&gt;
&lt;span class=&quot;tPC&quot;&gt;&quot;I&#39;ve got the pages&quot;&lt;/span&gt; you wave at him with the papers. &lt;/br&gt;
&lt;p class=&quot;tNPC2&quot;&gt;&quot;Hand them over then&quot;&lt;/p&gt;
He seems strangely reserved. Is he upset?
Handing him the pages you ask &lt;p class=&quot;tPC&quot;&gt;&quot;Is something wrong?&quot;&lt;/p&gt; 
&lt;p class=&quot;tNPC2&quot;&gt;&quot;Please follow me to the hall.&quot;&lt;/p&gt;
As you enter the hall, you notice Kumala and Leon already waiting there.
&lt;p class=&quot;tNPC2&quot;&gt;&lt;/p&gt;
...
&lt;div id=&#39;select5&#39; &gt; So what are you going to tell them?&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select5&quot;,&quot;div#choice5a&quot;)&#39;&gt;&quot;For sure I am an acolythe.&quot;&lt;/a&gt;&lt;/br&gt;&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select5&quot;,&quot;div#choice5b&quot;)&#39;&gt;&quot;I touched some kind of idol and then I appeared here.&quot;&lt;/a&gt;&lt;/br&gt;
&lt;/div&gt;&lt;div id=&#39;choice5a&#39; hidden&gt;&lt;/br&gt;
    Leon snorts &lt;p class=&quot;tNPC1&quot;&gt;&quot;No way, you dont even know the simplest rites.&quot;&lt;/p&gt;
    &lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select5&quot;,&quot;div#choice5c&quot;)&#39;&gt;&quot;For sure I am an acolythe.&quot;&lt;/a&gt;&lt;/br&gt;
&lt;/div&gt;
&lt;div id=&#39;choice5b&#39; hidden&gt;&lt;/br&gt;
    &lt;p class=&quot;tNPC3&quot;&gt;&quot;But that doesnt explain why you had the robes on you.&quot;&lt;/p&gt; Kumala points at your clothes.
    &lt;p class=&quot;tNPC3&quot;&gt;&quot;...and I also think that they don&#39;t just leave those idols lying around in the open.&quot;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#39;choice5c&#39; hidden&gt;&lt;/br&gt;
&lt;p class=&quot;tNPC2&quot;&gt;&quot;You still try to make up a tale ! I will have to make you leave.&quot;&lt;/p&gt;
&lt;div id=&#39;select10&#39; &gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select10&quot;,&quot;div#choice10a&quot;)&#39;&gt;&quot;you will send me back?&quot;&lt;/a&gt;&lt;/br&gt;
&lt;/div&gt;&lt;div id=&#39;choice10a&#39; hidden&gt;&lt;/br&gt;
    &lt;p class=&quot;tNPC2&quot;&gt;&quot;No. You would probably tell everyone that this place exists and that would only attract more curious people. &quot;&lt;/p&gt;
    &lt;p class=&quot;tNPC2&quot;&gt;&quot;There are only 2 possibilitys I can think of: &quot;&lt;/p&gt;
    &lt;p class=&quot;tPC&quot;&gt;&#39;Damit. I really hoped they send me back right away...&#39;&lt;/p&gt;
    &lt;p class=&quot;tNPC2&quot;&gt;The first option is to make you a poper member of the rite. You will have to serve your time here as usual. And then you might return - if we see fit.&lt;/p&gt;
    Leon trys to object. Most likely because that isn&#39;t enough punishment in his eyes.&lt;/br&gt;
    But Cyril silences him with a wave of his hand.
    &lt;p class=&quot;tNPC2&quot;&gt;&quot;The other option would be to banish you to the netherworld. There you would have to roam the wilderness amongst the beast. I doubt it would take long until you fall prey to some of them.&quot;&lt;/p&gt;
    &lt;p class=&quot;tNPC2&quot;&gt;&quot;What will you choose then?&quot;&lt;/p&gt;
    &lt;div id=&#39;select15&#39; &gt; TODO
        &lt;p&gt;That word &quot;banish&quot; didn&#39;t sound like &quot;I will send you to garden eden&quot;. There might be nastier places then the mountain or forest whose you already visited. And even those might not be fun to live in without a roof over your head.
        Maybe becoming a member of this cult is the easier approach and there is still the possibility to find an escape route later.&lt;/p&gt;
        &lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select15&quot;,&quot;div#choice15a&quot;)&#39;&gt;choose to become a acolyte&lt;/a&gt;&lt;/br&gt;
        [[choose to be banished]]
        &lt;/div&gt;&lt;div id=&#39;choice15a&#39; hidden&gt;&lt;/br&gt; &lt;a0 onclick=&#39;lvl4()&#39;&gt;Go to your room  TODO initiating ritual?&lt;/a&gt;.
        &lt;/div&gt;
        &lt;div id=&#39;choice15b&#39; hidden&gt;&lt;/br&gt;
        &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;function lvl4(){
    window.gm.player.Inv.removeItem(&quot;IgneumPage&quot;,5);
    window.story.state.DngSY.dngLevel=4;
    window.story.state.DngSY.remainingNights=2;
    window.story.show(&quot;DngSY_Your_Room&quot;);
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="436" name="DngMN_F1" tags="" position="725,5475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
A large nest is enthroned on a rocky peak that protrudes from the rock face a few dozen meters above you.
&lt;p class=&quot;tPC&quot;&gt;&quot;Oh my thats quite a big collection of sticks up there.&quot;&lt;/p&gt;
&lt;%if(!window.story.state.DngMN.tmp.page[window.passage.name]){%&gt;
&lt;div id=&#39;select5&#39;&gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select5&quot;,&quot;div#choice5a&quot;)&#39;&gt;Grab the page&lt;/a&gt;&lt;/br&gt;
&lt;/div&gt;&lt;div id=&#39;choice5a&#39; hidden&gt; Just as you are fishing among the branches for the paper, the owner of the nest appears. It is a hawk, but with a wingspan of easily 3m.
    &lt;a0 onclick=&#39;fightHawk()&#39;&gt;Defend yourself&lt;/a&gt;&lt;/br&gt;
&lt;/div&gt;
&lt;%}else{%&gt;&lt;%=window.gm.printNav()%&gt;&lt;%}%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngMN_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="437" name="DngMN_F2" tags="" position="850,5475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;

&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngMN_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="438" name="DngMN_G2" tags="" position="975,5475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;

&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="439" name="DngMN_H2" tags="" position="1100,5475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
A wolf seems to follow you in your track. You should &lt;a0 onclick=&#39;fightWolf();&#39;&gt;show it&lt;/a&gt; that you want to be left alone. 
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngMN_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="440" name="DngMN_I2" tags="" position="1225,5475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
You wonder if you could &lt;a0 onclick=&#39;explore()&#39;&gt;find&lt;/a&gt; something useful here.&lt;/br&gt;
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngMN_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="441" name="DngMN_J2" tags="" position="100,5600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;

&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="442" name="DngMN_I3" tags="" position="225,5600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
The portal is located near the edge of a deep canyon that has carved itself into the bottom of a valley surrounded by high mountains.
From here you have a great view of the lower valley and a large waterfall on the other side of the crevasse.&lt;/br&gt; 
&lt;%if(window.story.state.DngSY.dngLevel===3 &amp;&amp; window.gm.player.Inv.countItem(&#39;IgneumPage&#39;)&gt;=2){%&gt;
    &lt;/br&gt;The portal has opened, time for your return.&lt;/br&gt;
    &lt;p&gt;[[Into the portal|DngMN_Success]]&lt;/p&gt;
&lt;%}else{%&gt;
    &lt;/br&gt;Once you have at least 2 pages from a missing book, the portal should reapear opening your way back to the sanctuary.&lt;/br&gt;
&lt;%}%&gt; 
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="443" name="DngMN_J3" tags="" position="350,5600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;

&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="444" name="DngMN_K3" tags="" position="475,5600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;

&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="445" name="DngMN_K4" tags="" position="600,5600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
This rickety, wooden bridge has seen better days. Hopefully it won&#39;t fall into the canyon when you cross it.
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="446" name="DngMN_H5" tags="" position="725,5600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;

&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="447" name="DngMN_I5" tags="" position="850,5600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
A log cabin stands in a clearing. A few sheds stand leaning askew against the trees. 
&lt;%if(!window.story.state.DngMN.tmp.page[&#39;DngMN_I5&#39;]){%&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;Is that some sheet of paper flapping on the roof there?.&quot;&lt;/p&gt;
The house isn&#39;t really big but you would have to find a way to get on the roof.&lt;/br&gt;
A crooked pine tree grows near the hut. It would be easy enough to climb and then you could slide onto the roof.&lt;/br&gt;
&lt;div id=&#39;select1&#39;&gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;)&#39;&gt;Knock at the door&lt;/a&gt;&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1b&quot;)&#39;&gt;Climb the tree&lt;/a&gt;&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1c&quot;)&#39;&gt;Check the surrounding&lt;/a&gt;&lt;/br&gt;
&lt;%=window.gm.printNav(&#39;walk away&#39;,&#39;east&#39;)%&gt;
&lt;/div&gt;&lt;div id=&#39;choice1a&#39; hidden&gt;&lt;/br&gt;
    Before knocking at the door, you listen carefully for any sound from inside the hut. &lt;/br&gt; 
    You wait some seconds for response on your knock.
    &lt;p class=&quot;tPC&quot;&gt;&#39;Maybe I didnt knock loud enough or no one is here.&#39;&lt;/p&gt;
    &lt;div id=&#39;select2&#39; &gt;
    &lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select2&quot;,&quot;div#choice2a&quot;)&#39;&gt;Knock again&lt;/a&gt;&lt;/br&gt;
    &lt;/div&gt;&lt;div id=&#39;choice2a&#39; hidden&gt;&lt;/br&gt;
    &lt;p class=&quot;tNPC4&quot;&gt;&quot;Hey, what are you doing here?&quot;&lt;/p&gt;
    A large man walks around the corner of the shed.
    &lt;p class=&quot;tPC&quot;&gt;&quot;Sorry sir, I thought no one is around here. I just wanted to ask for a favor...&quot;&lt;/p&gt;
    &lt;p class=&quot;tNPC4&quot;&gt;&quot;Favors? I dont know you and for sure dont owe you an favour, am I!&quot;&lt;/p&gt;
    [[You need that paper|DngMN_I5_TalkPaper]]
    &lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#39;choice1b&#39; hidden&gt;&lt;/br&gt;
    The lower branches of the tree are cut off, but there is enough remaining to make it easy to climb.&lt;/br&gt;
    You expected that the tree would bend under your weight but its thougher then it looks.&lt;/br&gt;
    &lt;div id=&#39;select10&#39; &gt;
    &lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select10&quot;,&quot;div#choice10a&quot;)&#39;&gt;Jump on the roof&lt;/a&gt;&lt;/br&gt;
    &lt;/div&gt;&lt;div id=&#39;choice10a&#39; hidden&gt;&lt;/br&gt;
        You guess the angle and push yourself away from the tree. Just in that moment you consider of what material the roof is and how resilent it would be to your impact.&lt;/br&gt;
        That tought comes a little late though. While you arent heavy by all means, the mellow old wood can&#39;t bear you and you fall right through into the inside of the hut. 
        &lt;div id=&#39;select11&#39; &gt;
        &lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select11&quot;,&quot;div#choice11a&quot;)&#39;&gt;Now you are stuck headfirst halfway through the roof....&lt;/a&gt;&lt;/br&gt;
        &lt;/div&gt;&lt;div id=&#39;choice11a&#39; hidden&gt;&lt;/br&gt;
            You try to free yourself but you cant move forward nor backward. &lt;/br&gt;
            &lt;p class=&quot;tNPC4&quot;&gt;&quot;Hey, what the hell are you doing to my roof!&quot;&lt;/p&gt;
            You hear a loud shout from outside the hut and a shortly after the opening and closing of the front door.
            A large man stomps into your view. His grimace and the way he presses his fists into his sides makes it very clear that he is all then amused.
            &lt;p class=&quot;tNPC4&quot;&gt;&quot;Did a griffin drop you or why are you upside down in my house?&quot;&lt;/p&gt;
            &lt;div id=&#39;select12&#39; &gt;
            &lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select12&quot;,&quot;div#choice12a&quot;)&#39;&gt;Tell him a lie&lt;/a&gt;&lt;/br&gt;
            &lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select12&quot;,&quot;div#choice12b&quot;)&#39;&gt;Tell him the truth&lt;/a&gt;&lt;/br&gt;
            &lt;/div&gt;&lt;div id=&#39;choice12a&#39; hidden&gt;&lt;/br&gt;
                &lt;p class=&quot;tPC&quot;&gt;&quot;Yes exactly, a large eagle grabbed me as I walked through the mountains. I struggled and thrashed around until it lost grip on me.&quot;&lt;/p&gt;
                The man looks suspicious and rubs his chin as you tell him that story.
                &lt;p class=&quot;tNPC4&quot;&gt;&quot;Hmm,.. there aren&#39;t big enough eagles around here. but might be that griffin. You strange city dwellers can&#39;t even tell an eagle from a griffin.&quot;&lt;/p&gt;
                Did he really buy that? Netherless he is grabing you by his arms, pulling hard to get you from your unfortunate position.&lt;/br&gt;
                [[Explain him the situation|DngMN_I5_TalkPaper]]
            &lt;/div&gt;
            &lt;div id=&#39;choice12b&#39; hidden&gt;&lt;/br&gt;
                &lt;p class=&quot;tPC&quot;&gt;&quot;I tried to climb on the roof, because there is some kind of paper stuck there I need to gather. I know this sounds hilarious but I really need that.&quot;&lt;/p&gt;
                &lt;p class=&quot;tNPC4&quot;&gt;&quot;Damit, I knew it. That shred is a bad omen I said. And now I have a broken roof.&quot;&lt;/p&gt;
                [[Ask for the paper|DngMN_I5_TalkPaper]]
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;div id=&#39;choice1c&#39; hidden&gt;
    You decide to check the other sheds, maybe there is a ladder that you could use.&lt;/br&gt;
    &lt;span class=&quot;tPC&quot;&gt;&quot;Aiiehh&quot;&lt;/span&gt; you scream as a snare trap closes around your ankle and catapults you into the sky.&lt;/br&gt;
    You are now dangling helplessly at a height of several meters. If you make an effort, you might be able to reach your foot and cut the rope. Unfortunately,
    &lt;div id=&#39;select30&#39; &gt;
    &lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select30&quot;,&quot;div#choice30a&quot;)&#39;&gt;you don&#39;t have a knife.&lt;/a&gt;&lt;/br&gt;
    &lt;/div&gt;&lt;div id=&#39;choice30a&#39; hidden&gt;&lt;/br&gt;
        As you spin around another, body upside down, a large man comes into view.
        &lt;p class=&quot;tNPC4&quot;&gt;&quot;My, my , what do we have here. Some troublemaker sneeking around, causing troubles and stealing things.&quot;&lt;/p&gt;
        &lt;p class=&quot;tPC&quot;&gt;&quot;No-No sir. I was just looking around for someone to help me. I dont steal anything.&quot;&lt;/p&gt;
        Fortunately, the blood has already risen to your head, otherwise it would be noticeable that you blush because of the lie.&lt;/br&gt;
        &lt;p class=&quot;tNPC4&quot;&gt;&quot;Help you? I will help you...&quot;&lt;/p&gt;
        He pulls a huge hunting knife from his belt and you fear the worst. Some tales of cannibals &lt;div id=&#39;select31&#39; &gt;
        &lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select31&quot;,&quot;div#choice31a&quot;)&#39;&gt;slaughtering&lt;/a&gt; lonely travelers come into your mind.
        &lt;/div&gt;&lt;div id=&#39;choice31a&#39; hidden&gt;&lt;/br&gt;
            With a practiced cut of the sharp blade he cuts the rope.
            &lt;span class=&quot;tPC&quot;&gt;&quot;Ouch&quot;&lt;/span&gt; bouncing on the leaf covered floor dampens your impact, but your head is still spinning.&lt;/br&gt;
            &lt;p class=&quot;tNPC4&quot;&gt;&quot;You said you need help. Help with what? And what is in for me?&quot;&lt;/p&gt;
            [[Explain him the situation|DngMN_I5_TalkPaper]]
        &lt;/div&gt;
    &lt;/div&gt;

&lt;/div&gt;
&lt;div id=&#39;select5&#39; &gt;
&lt;%}else{%&gt;
&lt;%=window.gm.printNav()%&gt;
&lt;%}%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="448" name="DngMN_I5_TalkPaper" tags="" position="975,5600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
Todo: 
You explain him that your task is to get that scrap paper. You will get it if you help him fixing the roof. It was broken anyway and it is much easier to do it if 2 people work together.
&lt;div id=&#39;select5&#39;&gt;
&lt;a0 onclick=&#39;window.story.state.DngMN.tmp.page[&quot;DngMN_I5&quot;]=true;window.gm.player.Inv.addItem(new window.gm.ItemsLib[&quot;IgneumPage&quot;]());window.gm.printTalkLink(&quot;div#select5&quot;,&quot;div#choice5a&quot;)&#39;&gt;Grab the page&lt;/a&gt;&lt;/br&gt;
&lt;/div&gt;&lt;div id=&#39;choice5a&#39; hidden&gt; &lt;/br&gt;You got a page.&lt;p&gt;[[Leave|DngMN_J5]]&lt;/p&gt;
&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="449" name="DngMN_J5" tags="" position="1100,5600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;

&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngMN_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="450" name="DngMN_K5" tags="" position="1225,5600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
This seems to be a crossroad adorned by a roten signpost:
East:&quot;Lowlands&quot;,North:&quot;Highlands&quot;,West: you cant read that 
&lt;%=window.gm.printNav()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="451" name="DngMN_L5" tags="" position="100,5725" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
In eastern direction, the path winds further down the valley.
&lt;div id=&#39;select1&#39; &gt;
&lt;p class=&quot;tPC&quot;&gt;&#39;If I follow this path, I could possibly escape. But I have no idea where it is leading. Should I try and abandon my mission?&#39;&lt;/p&gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;)&#39;&gt;Yes&lt;/a&gt;&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1b&quot;)&#39;&gt;Better not&lt;/a&gt;&lt;/br&gt;
&lt;/div&gt;&lt;div id=&#39;choice1a&#39; hidden&gt;
    Looking cautiously around you decide that you should try your luck and make an escape. But after a short walk you notice a strange drag hindering your forward movement.
    Still you try your best and you have the feeling that the barrier will sooner or later give away.&lt;/br&gt;
    And just as it does everything goes black.&lt;/br&gt;
    &lt;a0 onclick=&#39;window.gm.respawn();&#39;&gt;Next&lt;/a&gt;
&lt;/div&gt;
&lt;div id=&#39;choice1b&#39; hidden&gt;
&lt;%=window.gm.printNav()%&gt;
&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="452" name="DngNG_MAP" tags="_back_" position="225,5725" size="100,100">&lt;hr&gt;&lt;div id=&#39;canvas&#39; style=&#39;max-height: 256px;overflow: auto;&#39;&gt;&lt;/div&gt;&lt;div id=&#39;svgpopup&#39;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;script&gt; window.gm.printMap2(window.story.state.DngSY.dngMap,window.gm.player.location.replace(window.story.state.DngSY.dng+&#39;_&#39;,&#39;&#39;),
    window.story.state.DngNG.mapReveal,window.story.state.DngNG.visitedTiles);
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="453" name="DngNG_Action" tags="" position="350,5725" size="100,100">&lt;%if(window.passage.name===&quot;DngNG_F3&quot;){%&gt;&lt;a0 onclick=&#39;&#39;&gt;Bang against the door to let you out of this place.&lt;/a&gt;&lt;%}%&gt;
&lt;a0 onclick=&#39;window.gm.addTime(30);window.gm.refreshAllPanel()&#39;&gt;Wait&lt;/a&gt;</tw-passagedata><tw-passagedata pid="454" name="DngNG_Encounters" tags="" position="475,5725" size="100,100">&lt;script&gt;window.gm.doMobAi();&lt;/script&gt;</tw-passagedata><tw-passagedata pid="455" name="DngNG_Retreat" tags="" position="600,5725" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
It felt like taking forever to get that gate open until you are able to squeeze through it.
&lt;/br&gt;[[Leave this place|DngNG_Home]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="456" name="DngNG_Respawn" tags="_nosave_ _nodeffered_" position="725,5725" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
You find yourself in the middle of a facility. &lt;/br&gt;
Walk aroound an keep a watchful eye for anyone that pounce you. Or pounce them and try to make them submit.&lt;/br&gt;
When the clock reaches 7AM, the game ends and the ranking will be calculated depending on your performance:
&lt;/br&gt;- how many underwear you were able to steal (minus the one you lost)  
&lt;/br&gt;- how many foes you subdued
&lt;/br&gt;- if you fullfilled the special task  

Depending on your ranking you receive some prize - or punishment:
&lt;/br&gt;- money from the pot. First gets 40%, second 20%, third 10% and the others have to share the rest.  
&lt;/br&gt;- every combatant gets their participation bonus
&lt;/br&gt;- the first can select a punishment for any partipicant except himself
&lt;/br&gt;- the second can select a punishment for the last one

&lt;/br&gt;&lt;/br&gt;&lt;a0 onclick= &#39;window.story.state.tmp.msg=&quot;&quot;,window.story.show(window.story.state.DngNG.Exit)&#39;&gt;Get hunting&lt;/a&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
    var s = window.story.state,map,data;
    ({map,data}=window.gm.build_DngNG());
    s.DngNG=data;
    s.DngSY.dngMap=map;s.DngSY.dng=&#39;DngNG&#39;;
    s.vars.spawnAt=&quot;DngNG_Respawn&quot;;
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="457" name="DngNG_Ruff_Talk" tags="_back_" position="850,5725" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
Ruff is just growling menacingly at you.&lt;/br&gt; Maybe if you would have something tasty for him...
&lt;a0 onclick=&#39;foo()&#39;&gt;Get closer&lt;/a&gt;
&lt;/br&gt;[[Back|_back_]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt; function foo(){
    window.gm.encounters[&quot;Ruff&quot;]({noStart:true});
    var _oldVictory=window.gm.Encounter.onVictory.bind(window.gm.Encounter);
    window.gm.Encounter.onVictory= function(){window.story.state.DngNG.getMobById(&quot;Ruff&quot;).state=-1;return(_oldVictory());}
    window.gm.Encounter.initCombat(); return;
}&lt;/script&gt;</tw-passagedata><tw-passagedata pid="458" name="DngNG_Tmpl" tags="" position="975,5725" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;%=window.gm.renderRoomNG(window.passage.name)%&gt;&lt;/br&gt;
&lt;%=window.gm.renderRoom(window.passage.name)%&gt;&lt;/br&gt;
&lt;div id=&#39;output&#39;&gt;&lt;/div&gt;
&lt;/br&gt;&lt;%=window.story.render(&#39;DngNG_Action&#39;)%&gt;&lt;/br&gt;&lt;div id=&quot;navpanel&quot;&gt;&lt;%=window.gm.printNav2()%&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;window.gm.doMobAi();&lt;/script&gt;</tw-passagedata><tw-passagedata pid="459" name="DngNG_appletree" tags="_fragm_" position="1100,5725" size="100,100">A scrawny appletree is growing here.</tw-passagedata><tw-passagedata pid="460" name="DngNG_entry" tags="_fragm_" position="1225,5725" size="100,100">The path here winds back to the city.
However, you first have to solve your task which is: TODO
else
With your task solved you might [[leave this place|DngNG_ReturnFromHunt]]&lt;/br&gt;.</tw-passagedata><tw-passagedata pid="461" name="DngNG_Mushroom" tags="_fragm_" position="100,5850" size="100,100">&lt;/br&gt;&lt;%if(window.story.state.DngNG.tmp.evtSpawn[window.passage.name][&quot;mushroom&quot;].state===0){%&gt;There is a &lt;%=window.story.state.DngNG.tmp.evtSpawn[window.passage.name][&quot;mushroom&quot;].loot%&gt;. Do you collect it?
&lt;div id=&#39;select992&#39; &gt;
&lt;a0 onclick=&#39;var _evt=window.story.state.DngNG.tmp.evtSpawn[window.passage.name][&quot;mushroom&quot;];_evt.state=1;_evt.tick=window.gm.getTime();window.gm.player.changeInventory(window.gm.ItemsLib[_evt.loot](),1);window.gm.printTalkLink(&quot;div#select992&quot;,&quot;div#choice992a&quot;)&#39;&gt;Yes&lt;/a&gt;&lt;/br&gt;
&lt;/div&gt;&lt;div id=&#39;choice992a&#39; hidden&gt;&lt;/br&gt; You collected some mushroom.
&lt;/div&gt;
&lt;%}else{%&gt;
No mushrooms growing here right now.
&lt;%}%&gt;</tw-passagedata><tw-passagedata pid="462" name="DngNG_Lectern_Take" tags="_nosave_" position="225,5850" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;div id=&#39;select1&#39;&gt;&lt;div id=&#39;output&#39;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;/div&gt;&lt;div id=&#39;choice1a&#39; hidden&gt;&lt;/br&gt;&lt;/div&gt;
&lt;div id=&#39;choice1b&#39; hidden&gt;&lt;/br&gt;
  Might be a good decision to not touch that and &lt;a0 onclick=&#39;window.story.show(window.gm.player.location)&#39;&gt;walk away&lt;/a&gt;.
&lt;/div&gt;&lt;div id=&#39;output2&#39;&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
var pickupyes,pickupno,msg=&#39;&#39;,Items=[];
var loot=window.story.state.tmp.args[1];
function addLoot(){
  //for(let n of Items){ msg+=n.name+&quot;, &quot;;};
  pickupyes=function(){ window.story.state.tmp.args=[];msg=&#39;&#39;;
    //for(let n of Items){window.gm.player.changeInventory(n,1);}
    if(loot===&#39;pierce&#39;) {
            msg+=&#39;\&quot;Its a trap damit..\&quot;&lt;/br&gt;&#39;
            if(window.gm.player.Outfit.getItemForSlot(&quot;pEars&quot;)){
                msg+= &#39;&lt;/br&gt;But nothing happens after.&#39;
            } else {
                window.gm.player.Wardrobe.addItem(Items[0]),window.gm.player.Outfit.addItem(Items[0]);
                msg+= &#39;A short, sharp pain in both earlobes lets your hands immediately shoot up and check whats going on: &#39;;
                msg+= &#39;Your ears got some jewelery: &#39;+Items[0].desc;
                msg+= &#39;&lt;/br&gt; Well, you have to live with that for now.&#39;
            }
    }
    if(loot===&#39;ring&#39;) {
        if(window.gm.player.Outfit.getItemForSlot(&quot;uLHand&quot;)){
            msg+= &#39;&lt;/br&gt;You already have a ring.&#39;
        } else {
            window.gm.player.Wardrobe.addItem(Items[0]),window.gm.player.Outfit.addItem(Items[0]);
            msg+= &#39;You now carry a &#39;+Items[0].desc;
        }
    }
    window.gm.printOutput(msg+&#39;&lt;/br&gt;&#39;+window.gm.printLink(&#39;Continue&#39;,&#39;window.story.show(window.gm.player.location)&#39;),&#39;div#choice1a&#39;);
    }
}
msg=&#39;&#39;;
if(loot===&quot;ring&quot;){
    msg+=&quot;There is a small ring laying on the ground. &quot;+window.gm.printLink(&quot;Pick it up&quot;,&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;),pickupyes()&#39;)
    +&quot; or &quot;+window.gm.printLink(&quot;dont&quot;,&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;),pickupno()&#39;);
    Items.push(window.gm.ItemsLib.RingFinger());
    addLoot();
} else if(loot===&quot;pierce&quot;){
    msg+=&quot;There is a small ring laying on the ground. &quot;+window.gm.printLink(&quot;Pick it up&quot;,&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;),pickupyes()&#39;)
    +&quot; or &quot;+window.gm.printLink(&quot;dont&quot;,&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;),pickupno()&#39;);
    Items.push(window.gm.ItemsLib.PiercingEars());
    addLoot();
} else {
  msg+=&#39;nothing ! &#39;+window.gm.printLink(&quot;Walk away disappointed.&quot;,&quot;pickupno()&quot;,&quot;div#output2&quot;);
}
pickupno=function(){window.story.show(window.gm.player.location);};
window.gm.printOutput(msg);
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="463" name="DngNG_Lectern" tags="_nosave_" position="350,5850" size="100,100">&lt;script&gt; function randomLoot(){ //generate loot[0]= item , loot[1]= effect //see combinations above
//loot depends on tier and present fetishs/gear
    var rnd=_.random(0,100),rnd2=_.random(0,100),where=window.gm.player.location;
    var loot=[],trap=[&#39;arouse&#39;,&#39;pierce&#39;,&#39;ravage&#39;,&#39;drug&#39;,&#39;bound&#39;,&#39;cursed&#39;]
    if(rnd&gt;199) {//good
        loot.push(&quot;strengthUp&quot;);
    } else if(rnd&gt;50) {//good
        loot.push(&quot;ring&quot;);
    } else {//bad
        loot.push(&quot;pierce&quot;);
    }
    window.story.state.tmp.args[1]=loot[0];
    window.story.state.DngNG.tmp.evtSpawn[where][&quot;lectern&quot;].state=1;
}
randomLoot();
window.story.show(&quot;DngNG_Lectern_Take&quot;)
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="464" name="DngNG_00_00" tags="" position="475,5850" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="465" name="DngNG_00_01" tags="" position="600,5850" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="466" name="DngNG_00_02" tags="" position="725,5850" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="467" name="DngNG_00_03" tags="" position="850,5850" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="468" name="DngNG_00_04" tags="" position="975,5850" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="469" name="DngNG_00_05" tags="" position="1100,5850" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="470" name="DngNG_00_06" tags="" position="1225,5850" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="471" name="DngNG_00_07" tags="" position="100,5975" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="472" name="DngNG_00_08" tags="" position="225,5975" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="473" name="DngNG_00_09" tags="" position="350,5975" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="474" name="DngNG_00_10" tags="" position="475,5975" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="475" name="DngNG_01_00" tags="" position="600,5975" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="476" name="DngNG_01_01" tags="" position="725,5975" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="477" name="DngNG_01_02" tags="" position="850,5975" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="478" name="DngNG_01_03" tags="" position="975,5975" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="479" name="DngNG_01_04" tags="" position="1100,5975" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="480" name="DngNG_01_05" tags="" position="1225,5975" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="481" name="DngNG_01_06" tags="" position="100,6100" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="482" name="DngNG_01_07" tags="" position="225,6100" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="483" name="DngNG_01_08" tags="" position="350,6100" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="484" name="DngNG_01_09" tags="" position="475,6100" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="485" name="DngNG_01_10" tags="" position="600,6100" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="486" name="DngNG_02_00" tags="" position="725,6100" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="487" name="DngNG_02_01" tags="" position="850,6100" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="488" name="DngNG_02_02" tags="" position="975,6100" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="489" name="DngNG_02_03" tags="" position="1100,6100" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="490" name="DngNG_02_04" tags="" position="1225,6100" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="491" name="DngNG_02_05" tags="" position="100,6225" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="492" name="DngNG_02_06" tags="" position="225,6225" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="493" name="DngNG_02_07" tags="" position="350,6225" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="494" name="DngNG_02_08" tags="" position="475,6225" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="495" name="DngNG_02_09" tags="" position="600,6225" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="496" name="DngNG_02_10" tags="" position="725,6225" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="497" name="DngNG_03_00" tags="" position="850,6225" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="498" name="DngNG_03_01" tags="" position="975,6225" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="499" name="DngNG_03_02" tags="" position="1100,6225" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="500" name="DngNG_03_03" tags="" position="1225,6225" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="501" name="DngNG_03_04" tags="" position="100,6350" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="502" name="DngNG_03_05" tags="" position="225,6350" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="503" name="DngNG_03_06" tags="" position="350,6350" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="504" name="DngNG_03_07" tags="" position="475,6350" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="505" name="DngNG_03_08" tags="" position="600,6350" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="506" name="DngNG_03_09" tags="" position="725,6350" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="507" name="DngNG_03_10" tags="" position="850,6350" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="508" name="DngNG_04_00" tags="" position="975,6350" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="509" name="DngNG_04_01" tags="" position="1100,6350" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="510" name="DngNG_04_02" tags="" position="1225,6350" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="511" name="DngNG_04_03" tags="" position="100,6475" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="512" name="DngNG_04_04" tags="" position="225,6475" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="513" name="DngNG_04_05" tags="" position="350,6475" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="514" name="DngNG_04_06" tags="" position="475,6475" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="515" name="DngNG_04_07" tags="" position="600,6475" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="516" name="DngNG_04_08" tags="" position="725,6475" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="517" name="DngNG_04_09" tags="" position="850,6475" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="518" name="DngNG_04_10" tags="" position="975,6475" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="519" name="DngNG_05_00" tags="" position="1100,6475" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="520" name="DngNG_05_01" tags="" position="1225,6475" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="521" name="DngNG_05_02" tags="" position="100,6600" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="522" name="DngNG_05_03" tags="" position="225,6600" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="523" name="DngNG_05_04" tags="" position="350,6600" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="524" name="DngNG_05_05" tags="" position="475,6600" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="525" name="DngNG_05_06" tags="" position="600,6600" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="526" name="DngNG_05_07" tags="" position="725,6600" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="527" name="DngNG_05_08" tags="" position="850,6600" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="528" name="DngNG_05_09" tags="" position="975,6600" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="529" name="DngNG_05_10" tags="" position="1100,6600" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="530" name="DngNG_06_00" tags="" position="1225,6600" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="531" name="DngNG_06_01" tags="" position="100,6725" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="532" name="DngNG_06_02" tags="" position="225,6725" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="533" name="DngNG_06_03" tags="" position="350,6725" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="534" name="DngNG_06_04" tags="" position="475,6725" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="535" name="DngNG_06_05" tags="" position="600,6725" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="536" name="DngNG_06_06" tags="" position="725,6725" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="537" name="DngNG_06_07" tags="" position="850,6725" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="538" name="DngNG_06_08" tags="" position="975,6725" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="539" name="DngNG_06_09" tags="" position="1100,6725" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="540" name="DngNG_06_10" tags="" position="1225,6725" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="541" name="DngNG_07_00" tags="" position="100,6850" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="542" name="DngNG_07_01" tags="" position="225,6850" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="543" name="DngNG_07_02" tags="" position="350,6850" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="544" name="DngNG_07_03" tags="" position="475,6850" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="545" name="DngNG_07_04" tags="" position="600,6850" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="546" name="DngNG_07_05" tags="" position="725,6850" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="547" name="DngNG_07_06" tags="" position="850,6850" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="548" name="DngNG_07_07" tags="" position="975,6850" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="549" name="DngNG_07_08" tags="" position="1100,6850" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="550" name="DngNG_07_09" tags="" position="1225,6850" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="551" name="DngNG_07_10" tags="" position="100,6975" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="552" name="DngNG_08_00" tags="" position="225,6975" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="553" name="DngNG_08_01" tags="" position="350,6975" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="554" name="DngNG_08_02" tags="" position="475,6975" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="555" name="DngNG_08_03" tags="" position="600,6975" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="556" name="DngNG_08_04" tags="" position="725,6975" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="557" name="DngNG_08_05" tags="" position="850,6975" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="558" name="DngNG_08_06" tags="" position="975,6975" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="559" name="DngNG_08_07" tags="" position="1100,6975" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="560" name="DngNG_08_08" tags="" position="1225,6975" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="561" name="DngNG_08_09" tags="" position="100,7100" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="562" name="DngNG_08_10" tags="" position="225,7100" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="563" name="DngNG_09_00" tags="" position="350,7100" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="564" name="DngNG_09_01" tags="" position="475,7100" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="565" name="DngNG_09_02" tags="" position="600,7100" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="566" name="DngNG_09_03" tags="" position="725,7100" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="567" name="DngNG_09_04" tags="" position="850,7100" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="568" name="DngNG_09_05" tags="" position="975,7100" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="569" name="DngNG_09_06" tags="" position="1100,7100" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="570" name="DngNG_09_07" tags="" position="1225,7100" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="571" name="DngNG_09_08" tags="" position="100,7225" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="572" name="DngNG_09_09" tags="" position="225,7225" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="573" name="DngNG_09_10" tags="" position="350,7225" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="574" name="DngNG_10_00" tags="" position="475,7225" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="575" name="DngNG_10_01" tags="" position="600,7225" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="576" name="DngNG_10_02" tags="" position="725,7225" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="577" name="DngNG_10_03" tags="" position="850,7225" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="578" name="DngNG_10_04" tags="" position="975,7225" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="579" name="DngNG_10_05" tags="" position="1100,7225" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="580" name="DngNG_10_06" tags="" position="1225,7225" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="581" name="DngNG_10_07" tags="" position="100,7350" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="582" name="DngNG_10_08" tags="" position="225,7350" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="583" name="DngNG_10_09" tags="" position="350,7350" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="584" name="DngNG_10_10" tags="" position="475,7350" size="100,100">&lt;%=window.story.render(&#39;DngNG_Tmpl&#39;)%&gt;</tw-passagedata><tw-passagedata pid="585" name="DngNG_F2" tags="" position="600,7350" size="100,100">&lt;%=window.story.render(&quot;DngNG_A1&quot;)%&gt;</tw-passagedata><tw-passagedata pid="586" name="DngNG_G2" tags="" position="725,7350" size="100,100">&lt;%=window.story.render(&quot;DngNG_A1&quot;)%&gt;</tw-passagedata><tw-passagedata pid="587" name="DngNG_H2" tags="" position="850,7350" size="100,100">&lt;%=window.story.render(&quot;DngNG_A1&quot;)%&gt;</tw-passagedata><tw-passagedata pid="588" name="DngNG_I2" tags="" position="975,7350" size="100,100">&lt;%=window.story.render(&quot;DngNG_A1&quot;)%&gt;</tw-passagedata><tw-passagedata pid="589" name="DngNG_J2" tags="" position="1100,7350" size="100,100">&lt;%=window.story.render(&quot;DngNG_A1&quot;)%&gt;</tw-passagedata><tw-passagedata pid="590" name="DngNG_H3" tags="" position="1225,7350" size="100,100">&lt;%=window.story.render(&quot;DngNG_A1&quot;)%&gt;</tw-passagedata><tw-passagedata pid="591" name="DngNG_I3" tags="" position="100,7475" size="100,100">&lt;%=window.story.render(&quot;DngNG_A1&quot;)%&gt;</tw-passagedata><tw-passagedata pid="592" name="DngNG_J3" tags="" position="225,7475" size="100,100">&lt;%=window.story.render(&quot;DngNG_A1&quot;)%&gt;</tw-passagedata><tw-passagedata pid="593" name="DngNG_Home" tags="" position="350,7475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;/br&gt;
This is the main hall. Where would you like to go?&lt;/br&gt;
[[Loot Trader|DngNG_LootTrader]] [[Gear Trader|DngNG_GearTrader]] 
&lt;/br&gt;[[Crafting]]  [[Temple of divination|DngNG_Temple]]
&lt;/br&gt;[[Check on your comrades]] [[Manage Loadout|DngNG_Loadout]]
Or get some rest before your hunt starts.
&lt;hr&gt;
What locattion should you search next ?
&lt;/br&gt;&lt;a0 onclick= &#39;window.story.state.tmp.msg=&quot;&quot;,window.story.show(window.story.state.DngNG.Exit)&#39;&gt;the forest&lt;/a&gt;
&lt;/br&gt;the plains - need to sell items worth 1000gold first
&lt;/br&gt;??? 
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
    var s = window.story.state,map,data;
    ({map,data}=window.gm.build_DngNG());
    s.DngNG=data;
    s.DngSY.dngMap=map;s.DngSY.dng=&#39;DngNG&#39;;
    s.vars.spawnAt=&quot;DngNG_Respawn&quot;;
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="594" name="DngNG_ReturnFromHunt" tags="" position="475,7475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;/br&gt;
TODO&lt;/br&gt;
Either you returned by fainting, using the escape-rune or
because you solved your mission.
&lt;/br&gt;
Sum up what you found and lost.
&lt;/br&gt;[[Next|DngNG_Home]]
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="595" name="DngNG_LootTrader" tags="" position="600,7475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;/br&gt;
TODO Here you see a list of trinkets you carry that you could possibly sell or ask for other services.&lt;a0 id=&#39;helploottrader&#39; onclick=&#39;(function($event){document.querySelector(&quot;#&quot;+id+&quot;~p&quot;).toggleAttribute(&quot;hidden&quot;);})(this);&#39;&gt;Hint&lt;/a&gt;
&lt;p hidden&gt;
&lt;/br&gt; SELL: the trinket is removed and you get the displayed number of gold. You cannot rebuy the item.
&lt;/br&gt; UNBIND: spend some money to unbind the trinket. This means you can unequip/equip it freely and keep it for yourself.
&lt;/p&gt;
Trinkets equipped: &lt;/br&gt;
Trinkets inventory: &lt;/br&gt;
&lt;/br&gt;[[Back|DngNG_Home]]
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="596" name="DngNG_GearTrader" tags="" position="725,7475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;/br&gt;
TODO Browse the wares of the different traders. &lt;a0 id=&#39;helpgeartrader&#39; onclick=&#39;(function($event){document.querySelector(&quot;#&quot;+id+&quot;~p&quot;).toggleAttribute(&quot;hidden&quot;);})(this);&#39;&gt;Hint&lt;/a&gt;
&lt;p hidden&gt; Weapons are used in combat (or to intimidate someone to avoid combat). &lt;/br&gt;
Wearables are clothing or armor and improve your stats or at least they cover privates. They have a limited durability.&lt;/br&gt; 
More gear gets unlocked on progress.&lt;/br&gt;&lt;/p&gt;

Consumables available/owned: scroll of identificaton, clothing-patchkit, health-potion,...  &lt;/br&gt;
Weapons: &lt;/br&gt;
Wearables:&lt;/br&gt;
&lt;/br&gt;[[Back|DngNG_Home]]
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="597" name="DngNG_Temple" tags="" position="850,7475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;/br&gt;
TODO Lets see what the acolyte of the temple can do for you.&lt;/br&gt;&lt;a0 id=&#39;helptemple&#39; onclick=&#39;(function($event){document.querySelector(&quot;#&quot;+id+&quot;~p&quot;).toggleAttribute(&quot;hidden&quot;);})(this);&#39;&gt;Hint&lt;/a&gt;
&lt;p hidden&gt;
&lt;/br&gt; DONATE: Offer some gold. Maybe the gods look benevolently at you. (Chance to temporary increase a stat on your next run)
&lt;/br&gt; UNCURSE: For a donation, removes a (active,negative) effect from a trinket. But it might also break the positive spell bound to the curse.   
&lt;/br&gt; INFUSE: Infuse a trinket into your body to increase a stat. There might be sideeffects if the trinket is cursed. 
&lt;/br&gt; CLENSE: Remove a blemish (tattoo,??) from your body.
&lt;/p&gt;
&lt;/br&gt;[[Back|DngNG_Home]]
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="598" name="DngNG_Loadout" tags="" position="975,7475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;/br&gt;
TODO Configure what gear you want to use on your next journey. &lt;a0 id=&#39;helploadout&#39; onclick=&#39;(function($event){document.querySelector(&quot;#&quot;+id+&quot;~p&quot;).toggleAttribute(&quot;hidden&quot;);})(this);&#39;&gt;Hint&lt;/a&gt;
&lt;p hidden&gt;
You can buy standard-gear from gear-traders and you only need to buy once. If you loose it on your journey, it will respawn here.&lt;/br&gt;
Also, trinkets you own will respawn here if you loose them. But if they get cursed, the curse will stick to them.&lt;/br&gt;
You can take a limited number of consumables with you. &lt;/br&gt;
&lt;/p&gt;
Choosen:&lt;/br&gt;
&lt;hr&gt;
consumables:&lt;/br&gt;
standard-wearables:&lt;/br&gt;
standard-weapons:&lt;/br&gt;
trinkets:&lt;/br&gt;

&lt;/br&gt;[[Back|DngNG_Home]]
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="599" name="DngPC_MAP" tags="_back_" position="1100,7475" size="100,100">&lt;hr&gt;&lt;div id=&#39;canvas&#39;&gt;&lt;/div&gt;&lt;div id=&#39;svgpopup&#39;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;script&gt; window.gm.printMap2(window.story.state.DngSY.dngMap,window.gm.player.location.replace(window.story.state.DngSY.dng+&#39;_&#39;,&#39;&#39;),
    window.story.state.DngPC.mapReveal,window.story.state.DngPC.visitedTiles);
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="600" name="DngPC_Respawn" tags="_nosave_ _nodeffered_" position="1225,7475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
It&#39;s impossible to say how long you have passed out and how you ended up here. &lt;/br&gt;
But at least you are alive and - mostly - unharmed.&lt;/br&gt;
&lt;%=window.story.state.tmp.msg%&gt;
&lt;/br&gt;&lt;a0 onclick= &#39;window.story.state.tmp.msg=&quot;&quot;,window.story.show(&quot;DngPC_G4&quot;)&#39;&gt;Next&lt;/a&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngPC_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="601" name="DngPC_Entry" tags="" position="100,7600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
As punishment for your transgressions, you were put into a dungeon-like prison.&lt;/br&gt; But you arent going to sit around until your sentence is over. This is a kind of re-education camp to bring you back to the right path and reveal your hidden potential.&lt;/br&gt;
You must earn your release by taking on tasks and completing them on your own.&lt;/br&gt;
&lt;/br&gt;&lt;p&gt; [[Next|DngPC_G4]] &lt;/br&gt;&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
    var s = window.story.state,map,data;
    ({map,data}=window.gm.build_DngPC());
    s.DngPC=data;
    s.DngSY.dngMap=map;s.DngSY.dng=&#39;DngPC&#39;;
    s.vars.spawnAt=&quot;DngPC_Respawn&quot;;
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="602" name="DngPC_Door_Closed" tags="_nosave_" position="225,7600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
There is a gate in front of you but it is locked.&lt;/br&gt;
&lt;div id=&#39;output&#39;&gt;&lt;/div&gt;
&lt;a0 onclick=&#39;window.story.show(window.story.state.DngSY.prevLocation)&#39;&gt;Go back&lt;/a&gt;. 
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;function requiredKey(){
    var msg=&#39;&#39;,dng=window.story.state.DngSY.dng,doors=window.story.state.DngPC.tmp.doors;
    var x=window.story.state.DngSY.prevLocation.replace(dng+&#39;_&#39;,&#39;&#39;),y=window.story.state.DngSY.nextLocation.replace(dng+&#39;_&#39;,&#39;&#39;);
    var door = (doors[x]&amp;&amp;doors[x][y])||(doors[y]&amp;&amp;doors[y][x]);
    window.gm.dbgHelper();
    if(door){
        msg=&#39;Someone with a high enough tier might be able to unlock this door.&#39;;
    } else {
        msg=&#39;I dont know how to unlock that door.&#39;;
    }
    window.gm.printOutput(msg+&quot;&lt;/br&gt;&quot;);
}
requiredKey()
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="603" name="DngPC_Fungus" tags="_fragm_" position="350,7600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
Some strange kind of fungi are growing here. They are rather large, raising up to your waistline. You would have to &lt;a0 onclick=&#39;fight()&#39;&gt;push through&lt;/a&gt; them to get forward or you just might &lt;a0 onclick=&#39;window.story.show(window.story.state.DngSY.prevLocation)&#39;&gt;turn back&lt;/a&gt;. &lt;/br&gt;
&lt;div id=&#39;output&#39;&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;function fight(){
  window.gm.encounters[&#39;fungus&#39;]({noFlee:true});              
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="604" name="DngPC_wolf" tags="_fragm_" position="475,7600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
There is wolf resting on the ground. It might be sleeping. &lt;/br&gt;
You may try your luck and &lt;a0 onclick=&#39;&#39;&gt;sneak around&lt;/a&gt; , boldly &lt;a0 onclick=&#39;&#39;&gt;walk toward it&lt;/a&gt; or rush and try to &lt;a0 onclick=&#39;fight()&#39;&gt;strike first&lt;/a&gt;. 
&lt;/br&gt;Safest option would be to retreat &lt;a0 onclick=&#39;window.story.show(window.story.state.DngSY.prevLocation)&#39;&gt;retreat&lt;/a&gt;.
&lt;div id=&#39;output&#39;&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;function fight(){
  window.gm.encounters[&#39;wolf&#39;]({type:&#39;AlphaWolf&#39;,noFlee:true});               
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="605" name="DngPC_Mushroom" tags="_fragm_" position="600,7600" size="100,100">&lt;/br&gt;&lt;%if(window.story.state.DngPC.tmp.evtSpawn[window.passage.name][&quot;mushroom&quot;].state===0){%&gt;There is a &lt;%=window.story.state.DngPC.tmp.evtSpawn[window.passage.name][&quot;mushroom&quot;].loot%&gt;. Do you collect it?
&lt;div id=&#39;select992&#39; &gt;
&lt;a0 onclick=&#39;var _evt=window.story.state.DngPC.tmp.evtSpawn[window.passage.name][&quot;mushroom&quot;];_evt.state=1;_evt.tick=window.gm.getTime();window.gm.player.changeInventory(window.gm.ItemsLib[_evt.loot](),1);window.gm.printTalkLink(&quot;div#select992&quot;,&quot;div#choice992a&quot;)&#39;&gt;Yes&lt;/a&gt;&lt;/br&gt;
&lt;/div&gt;&lt;div id=&#39;choice992a&#39; hidden&gt;&lt;/br&gt; You collected some mushroom.
&lt;/div&gt;
&lt;%}else{%&gt;
No mushrooms growing here right now.
&lt;%}%&gt;</tw-passagedata><tw-passagedata pid="606" name="DngPC_Box" tags="_nosave_" position="725,7600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
You spot a box right on your way. Maybe someone lost it but even more likely placed it here on full intent.&lt;/br&gt; Are you going to open it?&lt;/br&gt;
&lt;div id=&#39;output&#39;&gt;&lt;/div&gt;
&lt;div id=&#39;select1&#39; &gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;),genLoot()&#39;&gt;Look inside&lt;/a&gt;&lt;/br&gt;
&lt;a0 onclick=&#39;window.story.show(window.story.state.DngSY.prevLocation)&#39;&gt;Dont touch the box&lt;/a&gt;.&lt;/br&gt;
&lt;/div&gt;&lt;div id=&#39;choice1a&#39; hidden&gt;&lt;/br&gt;&lt;a0 onclick=&#39;window.story.show(window.story.state.DngSY.prevLocation)&#39;&gt;Next&lt;/a&gt;&lt;/br&gt;
&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngPC_Encounters&quot;)%&gt;
&lt;script&gt; function genLoot(){
    let rnd = _.random(0,100), rnd2=_.random(0,100);
    if(rnd&gt;50){//bad
        window.gm.printOutput(&#39;As you open the box a pink smoke puffs out of it, surrounding you in a cloudy mist.&lt;/br&gt;Unfortunatly you inhale some of it.&#39;)
        window.gm.player.Stats.increment(&quot;arousal&quot;,4)
    } else {
        window.story.state.tmp.args[1]=rnd2;window.story.state.tmp.args[2]=window.gm.player.location;
        window.story.show(&quot;DngPC_LootChest&quot;)
    }
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="607" name="DngPC_Lectern" tags="_nosave_" position="850,7600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;div id=&#39;select1&#39;&gt;Some kind of lectern or stand is placed in an alcoven.&lt;/br&gt;Looks like some note is placed on it.&lt;/br&gt;It might be useful. On the other hand it could also be a trap. So, are you going to  
&lt;a0 onclick=&#39;grab();window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;)&#39;&gt;take a look at&lt;/a&gt; or just 
&lt;a0 onclick=&#39;loot=null,window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1b&quot;)&#39;&gt;ignore it&lt;/a&gt;?&lt;/br&gt;
&lt;/div&gt;&lt;div id=&#39;choice1a&#39; hidden&gt;&lt;/br&gt;&lt;/div&gt;
&lt;div id=&#39;choice1b&#39; hidden&gt;&lt;/br&gt;
  Might be a good decision to not touch that lectern and &lt;a0 onclick=&#39;window.story.show(window.gm.player.location)&#39;&gt;walk away&lt;/a&gt;.
&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt; function grab(){
    let item,msg=&#39;&#39;,where=window.gm.player.location;//window.story.state.DngSY.nextLocation;
    window.story.state.DngPC.tmp.evtSpawn[where][&quot;lectern&quot;].state=1;
    if(loot[1]===&quot;&quot;){
        msg=&#39;You found a &#39;+loot[0]+&#39;. &#39;;
        window.gm.player.changeInventory(window.gm.ItemsLib[loot[0]](),1);
    } else {
    msg=&#39;As you try to decypher the scroll, a sudden shiver travels down your spine. &#39;;
        if(loot[1]===&#39;pierce&#39;) {
            msg+=&#39;\&quot;Its a trap damit..\&quot;&lt;/br&gt;&#39;
            if(window.gm.player.Outfit.getItemForSlot(&quot;pEars&quot;)){
                msg+= &#39;&lt;/br&gt;But nothing happens after.&#39;
            } else {
                item=window.gm.ItemsLib[&#39;PiercingEars&#39;](),window.gm.player.Wardrobe.addItem(item),window.gm.player.Outfit.addItem(item);
                msg+= &#39;A short, sharp pain in both earlobes lets your hands immediately shoot up and check whats going on: &#39;;
                msg+= &#39;Your ears got some jewelery: &#39;+item.desc;
                msg+= &#39;&lt;/br&gt; Well, you have to live with that for now.&#39;
            }
        } else if(&quot;strengthUp&quot;) {
            msg+=&#39;You feel a little bit stronger then before.&lt;/br&gt;&#39;
            window.gm.player.Stats.increment(&quot;strength&quot;,2);
        }
    }
    window.gm.printOutput(msg+&#39;&lt;/br&gt;&#39;+window.gm.printLink(&#39;Continue&#39;,&#39;window.story.show(window.gm.player.location)&#39;),&#39;div#choice1a&#39;);
}
function randomLoot(){ //generate loot[0]= item , loot[1]= effect //see combinations above
//loot depends on tier and present fetishs/gear
  var rnd=_.random(0,100),rnd2=_.random(0,100);
  var trap=[&#39;arouse&#39;,&#39;pierce&#39;,&#39;ravage&#39;,&#39;drug&#39;,&#39;bound&#39;,&#39;cursed&#39;]
  var chest=[&#39;Scroll&#39;]
  if(!loot){
    loot=[];
    loot.push(&quot;&quot;);//todo no loot?
    if(rnd&gt;50) {//good
        loot.push(&quot;strengthUp&quot;);
    } else {//bad
        loot.push(&quot;pierce&quot;);
    }
  }
}
var loot;randomLoot();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="608" name="DngPC_Trap_Gas" tags="_nosave_" position="975,7600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
While walking down the corridor you notice that on of the slabs you set a foot onto gives away. Suddenly gas is fuming out of holes in the walls.&lt;/br&gt; You just triggered a trap! &lt;/br&gt;
&lt;div id=&#39;output&#39;&gt;&lt;/div&gt;
&lt;a0 onclick=&#39;_done=false,window.story.show(window.story.state.DngSY.prevLocation)&#39;&gt;retreat&lt;/a&gt;.
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngPC_Encounters&quot;)%&gt;
&lt;script&gt;
{var _triggered,_done,_x=window.gm.player.Stats.get(&quot;savagenessMax&quot;).value-window.gm.player.Stats.get(&quot;savageness&quot;).value;
if(!_done){
    _done=true;
    if(_x&gt;=5){
        window.gm.player.Stats.increment(&quot;savageness&quot;,_x/3);
        _triggered=true;
    } else {
        _triggered=false;
    }
}
if(_triggered){
    window.gm.printOutput(&quot;That gas somehow clouds your mind, you need to get out of here ! &lt;/br&gt; Your savageness increased.&quot;)
} else {
    window.gm.printOutput(&quot;Whatever the fumes should do, you dont notice any effect. But better get out of here quick.&quot;)
}}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="609" name="DngPC_Trap_Tentacle" tags="_nosave_" position="1100,7600" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
You notice some odd gooey puddles on the floor and even on the walls. But you have to press forward and step carefully around them. &lt;div id=&#39;output&#39;&gt;&lt;/div&gt;
&lt;a0 onclick=&#39;_done=false,window.story.show(window.story.state.DngSY.prevLocation)&#39;&gt;retreat&lt;/a&gt;.
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngPC_Encounters&quot;)%&gt;
&lt;script&gt;
{var _triggered,_done,_x=window.gm.player.Stats.get(&quot;savagenessMax&quot;).value-window.gm.player.Stats.get(&quot;savageness&quot;).value;
if(!_done){
    _done=true;
        _triggered=false;
}
if(_triggered){
    window.gm.printOutput(&quot;todo tentacles ravage your holes, bonus if bound&quot;)
} else {
    window.gm.printOutput(&quot;&lt;/br&gt;At some point you have to cross a blotch with a big step. As you do so the puddles around you suddenly bow outwards, elongating into slimy tentacles, swiveling around aimlessly.&lt;/br&gt; You quickly dive through them to get away.&lt;/br&gt;&quot;)
}}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="610" name="DngPC_Chest" tags="" position="1225,7600" size="100,100">&lt;/br&gt;&lt;%if(window.story.state.DngPC.tmp.evtSpawn[window.passage.name][&quot;chest&quot;].state===0){%&gt;There is a chest. Do you dare open it?
&lt;a0 onclick=&#39;window.story.state.DngPC.tmp.evtSpawn[window.passage.name][&quot;chest&quot;].state=1;window.story.state.tmp.args[1]=window.story.state.DngPC.tmp.evtSpawn[window.passage.name][&quot;chest&quot;].loot;window.story.state.tmp.args[2]=window.passage.name;window.story.show(&quot;DngPC_LootChest&quot;)&#39;&gt;Yes&lt;/a&gt;&lt;/br&gt;
&lt;%}else{%&gt;
An empty chest sits over there.
&lt;%}%&gt;</tw-passagedata><tw-passagedata pid="611" name="DngPC_LootChest" tags="_nosave_" position="100,7725" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
You open the chest and find...&lt;div id=&#39;output&#39;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;a0 onclick=&#39;foo()&#39;&gt;Next&lt;/a&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
var foo,msg=&#39;&#39;,Items=[],rnd=window.story.state.tmp.args[1],next=window.story.state.tmp.args[2]; //see window.gm.cursedChest
function addLoot(){
  for(let n of Items){ msg+=n.name+&quot;, &quot;;};
  foo=function(){ window.story.state.tmp.args=[];
    for(let n of Items){window.gm.player.changeInventory(n,1);}
    window.story.show(next); //adding to inventory only if player is leaving the passage, otherwise he could glitch if switching to status-pane and back
  }
}
if(rnd.length&gt;0) { //todo how to randomize loot/loottable
    for(var _itm of rnd){
        Items.push(window.gm.ItemsLib[_itm.id]());
    }
    addLoot();
} else if(rnd&lt;10){
  Items.push(window.gm.ItemsLib.HorsePotion());
  addLoot();
} else if(rnd&gt;40){
  Items.push(window.gm.ItemsLib.HealthPotionSmall());
  if(rnd&gt;60){
    Items.push(window.gm.ItemsLib.HorsePotion());
  }
  addLoot();
} else {
  msg+=&#39;nothing !&#39;;foo=function(){window.story.show(next);};
  /*foo=(function(){ window.story.state.tmp.args=[]; 
    window.gm.fightArena(&quot;mole&quot;,{amount:2},[{id:&quot;Money&quot;,count:30}],next);});*/
}
window.gm.printOutput(msg);
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="612" name="DngPC_Encounters" tags="" position="225,7725" size="100,100">&lt;script&gt;function tick(){
    let here = window.gm.player.location,_d=window.story.state.DngPC.tmp;
    if(here===_d.tickPass) return;
    _d.tickPass=here;
    for(var i=_d.mobs.length-1;i&gt;=0;i--){ //check persistent mobs
      var mob=_d.mobs[i];
      window.gm.mobAI(mob);
      if(window.story.state.DngSY.dng+&quot;_&quot;+mob.pos===here){
        //if mob is at same position as player: trigger passage or just show note
        if(mob.state===0){
          window.gm.encounters[mob.mob]({noStart:true});
          var _oldVictory=window.gm.Encounter.onVictory.bind(window.gm.Encounter);
          window.gm.Encounter.onVictory= function(){mob.state=1;return(_oldVictory());}
          window.gm.Encounter.initCombat(); return;
        }
      }
    }
    let _t=_d.tier,_allChances=0,_choice=[];
    switch(here){//foes; traps are handled in window.gm.navEvent, there might also be evtLeave added elsewhere
        case &quot;DngPC_D4&quot;:_choice.push({id:&#39;Ruff&#39;, amount:1,chance:100});//boss
            break;
        case &quot;DngPC_E4&quot;: 
            _choice.push({id:&#39;succubus&#39;,type:&quot;succubus&quot;,levelUp:(-2+_t), amount:1, chance:100});
        case &quot;DngPC_H4&quot;:
        case &quot;DngPC_I4&quot;: 
        case &quot;DngPC_F4&quot;:
        case &quot;DngPC_F5&quot;:
            _choice.push({id:&#39;lapine&#39;,levelUp:(-2+_t), amount:1, chance:50});
            _choice.push({id:&#39;slime&#39;,type:&quot;Slime&quot;,levelUp:(-2+_t), amount:1, chance:50});
            if(_t&lt;=3)_choice.push({id:&#39;spider&#39;,type:&quot;spiderswarm&quot;,levelUp:(-2+_t), amount:1, chance:50});
            if(_t&gt;1)_choice.push({id:&#39;slime&#39;,type:&quot;SlimeBig&quot;,levelUp:(-2+_t), amount:1, chance:100});
            if(_t&gt;1)_choice.push({id:&#39;anthrocat&#39;, amount:1, chance:100});
            if(_t&gt;3)_choice.push({id:&#39;wolf&#39;, amount:1, chance:100});
            break;
        case &quot;DngPC_J4&quot;:
            _choice.push({id:&#39;succubus&#39;,type:&quot;succubus&quot;,levelUp:(+2+_t), amount:1, chance:100});
            break;
        case &quot;DngPC_H5&quot;:
            if(_t&gt;1)_choice.push({id:&#39;dryad&#39;, amount:1, chance:100});
            if(_t&gt;1)_choice.push({id:&#39;anthrocat&#39;, amount:1, chance:100});
            if(_t&gt;3)_choice.push({id:&#39;anthrocat&#39;, amount:2, chance:100});
            break;
        case &quot;DngPC_H6&quot;:
            _choice.push({id:&#39;hornett&#39;,levelUp:(-2+_t), amount:2, chance:100});
            _choice.push({id:&#39;leech&#39;, amount:1,levelUp:(-2+_t), chance:100});
            if(_t&gt;1)_choice.push({id:&#39;anthrocat&#39;, amount:1, chance:100});
            if(_t&gt;3)_choice.push({id:&#39;wolf&#39;, amount:2, chance:100});
            break;
        case &quot;DngPC_F6&quot;:_choice.push({id:&#39;slug&#39;, amount:1,chance:100});//boss
            break; 
        case &quot;DngPC_K4&quot;:
        case &quot;DngPC_G6&quot;: 
            _choice.push({id:&#39;hornetthive&#39;,type:&quot;&quot;,levelUp:(-2+_t), amount:1, chance:100});//
            _choice.push({id:&#39;succubus&#39;,type:&quot;Nurse&quot;,levelUp:(-2+_t), amount:1, chance:100});//
            break;
        default:
    }  
    _choice.forEach(x=&gt;(_allChances+=x.chance));
    if(_allChances&gt;0){//choose rnd enemy
        var _rnd=_.random(0,_allChances-0.01);
        for(var i = _choice.length-1;i&gt;=0;i--){ 
            if(_rnd&lt;_allChances &amp;&amp; _rnd&gt;=(_allChances-_choice[i].chance)){
                if(false &amp;&amp; [&#39;_Lectern&#39;].includes(_choice[i].id)){ //scene
                    window.story.show(window.story.state.DngSY.dng+_choice[i].id);
                } else { //foe
                    window.gm.encounters[_choice[i].id]({type:_choice[i].type, amount:_choice[i].amount,levelUp:_choice[i].levelUp,noFlee:true});  
                }          
                break;
            }
            _allChances-=_choice[i].chance;
        }
    }
}
tick();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="613" name="DngPC_Sleep" tags="" position="350,7725" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;% window.story.state.DngPC.task.help=0;%&gt;
Wrapping yourself in that shaggy, old quilt, you try to get some rest.&lt;/br&gt;
&lt;/br&gt;&lt;div id=&#39;output&#39;&gt;&lt;/div&gt;
&lt;/br&gt;&lt;a0 onclick=&#39;window.story.show(&quot;DngPC_G4&quot;)&#39;&gt;Next&lt;/a&gt;&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="614" name="DngPC_Shrine" tags="_nosave_" position="475,7725" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;/br&gt;
The gatekeeper is waiting here to assign a task to anyone send here for punishment. There is a stone altar with a large chest for donations.&lt;/br&gt;&lt;/br&gt;
Your current donation-tier is: &lt;%=window.story.state.DngPC.tmp.tier%&gt;&lt;a0 id=&#39;tier&#39; onclick=&#39;(function($event){document.querySelector(&quot;#&quot;+id+&quot;~p&quot;).toggleAttribute(&quot;hidden&quot;);})(this);&#39;&gt;Hint&lt;/a&gt;
&lt;p class=&#39;speech&#39; hidden&gt; Gates need to be unlocked to gain access to the deeper areas of the dungeon. A gate of your choosing might be unlocked by donating a GoldVoucher. Those items are earned every 3 tiers. Tiers are gained by finishing tasks assigned by the shrine.
&lt;/p&gt;&lt;a0 id=&#39;vouchers&#39; onclick=&#39;(function($event){document.querySelector(&quot;#&quot;+id+&quot;~p&quot;).toggleAttribute(&quot;hidden&quot;);})(this);&#39;&gt;Hint&lt;/a&gt;
&lt;p class=&#39;speech&#39; hidden&gt; Where do I find...&lt;/br&gt;
Money: randomly found in loot, loot from foes&lt;/br&gt;
Iron-Vouchers: randomly found in loot; can be bought for money from vendor&lt;/br&gt;
Bronze-Vouchers: loot from foes&lt;/br&gt;
Silver-Vouchers: loot from bosses&lt;/br&gt;
Gold-Vouchers: gained after finishing a set of tasks&lt;/br&gt;
&lt;/p&gt;&lt;/br&gt;&lt;/br&gt;
By taking over tasks you show a sense of responsibility and reduce your punishment. 
&lt;hr&gt;&lt;div id=&#39;choice&#39;&gt;&lt;/div&gt;&lt;/br&gt;&lt;hr&gt;&lt;/br&gt;
If you are a whimp, you might [[ask for help|DngPC_Shrine_Help]].&lt;/br&gt;
Check out what doors you can [[unlock|DngPC_Shrine_Doors]].&lt;/br&gt;
&lt;p&gt;[[Back|DngPC_G4]]&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;window.gm.getAvailableTasks()&lt;/script&gt;</tw-passagedata><tw-passagedata pid="615" name="DngPC_Shrine_Doors" tags="_nosave_" position="600,7725" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;/br&gt;
&lt;p&gt;A certain tier and gold tokens are required to unlock a door. But maybe those doors are locked for a reason...&lt;/p&gt;&lt;a0 id=&#39;map&#39; onclick=&#39;(function($event){document.querySelector(&quot;#&quot;+id+&quot;~p&quot;).toggleAttribute(&quot;hidden&quot;);})(this);&#39;&gt;Hint&lt;/a&gt;
&lt;p hidden&gt; Hover over the map to display the coordinate of the rooms.&lt;/p&gt;
&lt;div id=&#39;output&#39;&gt;&lt;/div&gt;&lt;p&gt;[[Back|DngPC_G4]]&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;function list(){
    window.gm.dbgHelper();
    var msg=&#39;&#39;,door,doors2,tier=window.story.state.DngPC.tmp.tier,token=window.gm.player.Inv.countItem(&quot;VoucherGold&quot;),doors=Object.keys(window.story.state.DngPC.tmp.doors);
    for(var i=doors.length-1;i&gt;=0;i--){
        doors2=Object.keys(window.story.state.DngPC.tmp.doors[doors[i]]);
        for(var k=doors2.length-1;k&gt;=0;k--){
            door=window.story.state.DngPC.tmp.doors[doors[i]][doors2[k]];
            if(door.state&lt;1){
                if(door.token&lt;=token &amp;&amp; door.tier&lt;=tier) msg+=window.gm.printLink(&quot;Unlock&quot;,&quot;window.gm.player.Inv.removeItem(\&quot;VoucherSilver\&quot;,&quot;+door.token+&quot;),window.story.state.DngPC.tmp.doors[\&quot;&quot;+doors[i]+&quot;\&quot;][\&quot;&quot;+doors2[k]+&quot;\&quot;].state=1;window.story.show(window.passage.name);&quot;);
                else msg+=&quot;Unlock&quot;;
                msg+=&quot; door between &quot;+doors[i]+&quot;-&quot;+doors2[k]+&quot; for &quot;+door.token+&quot; tokens at tier &quot;+door.tier+&quot;&lt;/br&gt;&quot;;
            }
        }
    }
    window.gm.printOutput(msg);
}
list();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="616" name="DngPC_Shrine_Help" tags="_nosave_" position="725,7725" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;p&gt;[[Back|DngPC_Shrine]]&lt;/p&gt;
&lt;a0 onclick=&#39;window.story.show(&quot;NOP&quot;)&#39;&gt;Ask for some tips about your current task&lt;/a&gt;&lt;/br&gt;
&lt;a0 onclick=&#39;randomHint()&#39;&gt;Ask for some more general tips&lt;/a&gt;&lt;div id=&#39;output&#39;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;%if(window.story.state.DngPC.task.help===0 &amp;&amp; window.story.state.DngPC.tmp.tier&lt;2 &amp;&amp; window.story.state.DngPC.task.id===&#39;bringMoney&#39;){%&gt;
&lt;div id=&#39;select400&#39; &gt;
&lt;a0 onclick=&#39;window.story.state.DngPC.task.help=1,window.gm.player.Inv.addItem(window.gm.ItemsLib.BrownPill(),2),window.gm.printTalkLink(&quot;div#select400&quot;,&quot;div#choice400a&quot;)&#39;&gt;Beg for some more direct help for your task&lt;/a&gt;&lt;/br&gt;
&lt;/div&gt;&lt;div id=&#39;choice400a&#39; hidden&gt;&lt;/br&gt; &quot;Dont tell anyone, but I can give you &lt;b&gt;those pills&lt;/b&gt;. The poisonous critters should then be less harmfull.&quot;&lt;/br&gt;
    He places some pills on the desk and you quickly pocket them, even if you are unsure if it would be wise to use them.&lt;/br&gt;
&lt;/div&gt;
&lt;%}else if(window.story.state.DngPC.task.help===0 &amp;&amp; window.story.state.DngPC.tmp.tier&gt;=1 &amp;&amp; window.story.state.DngPC.task.id===&#39;bringIron&#39;){%&gt;
&lt;div id=&#39;select400&#39; &gt;
&lt;a0 onclick=&#39;window.story.state.DngPC.task.help=1;var item=window.gm.ItemsLib[&quot;PendantLuck&quot;]();window.gm.player.Wardrobe.addItem(item),window.gm.printTalkLink(&quot;div#select400&quot;,&quot;div#choice400a&quot;)&#39;&gt;Beg for some more direct help for your task&lt;/a&gt;&lt;/br&gt;
&lt;/div&gt;&lt;div id=&#39;choice400a&#39; hidden&gt;&lt;/br&gt; &quot;This &lt;b&gt;pendant&lt;/b&gt;&quot; he shows you some lucky paw attached to a leather thread &quot;is rumored to increase someones luck. Might be helpful to find rare stuff.&quot;&lt;/br&gt;
    It cant do any harm wearing it, right?&lt;/br&gt;
&lt;/div&gt;
&lt;%}else if(window.story.state.DngPC.task.help===0 &amp;&amp; window.story.state.DngPC.tmp.tier&gt;=1 &amp;&amp; window.story.state.DngPC.task.id===&#39;freeEnslaved&#39;){%&gt;
&lt;div id=&#39;select400&#39; &gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select400&quot;,&quot;div#choice400a&quot;)&#39;&gt;Beg for some more direct help for your task&lt;/a&gt;&lt;/br&gt;
&lt;/div&gt;&lt;div id=&#39;choice400a&#39; hidden&gt;&lt;/br&gt; &quot;Explore the dungeon to find a slave. Defeat their owner or make a trade to free them. But be cautious...&quot;&lt;/br&gt;
&lt;/div&gt;
&lt;%}else{%&gt;
&quot;Right now I cant help you with your task. Maybe tomorrow.&quot;&lt;/br&gt;
&lt;%}%&gt;
&lt;p&gt;For a fee you can also get some helpful services:TODO&lt;/br&gt;&lt;!--
    permanent gear: receive better gear on respawn
    empower: temporary increase a stat
    ward piercings and tattoos: 
    learn skill: learn or train a skill, you might need to perform a task to do so
    cure addiction/sickness: you might need to perform a task to do so
  trade curse: get rid of a curse by trading it against a different one 
  remove cursed gear: get rid of some unhealthy gear locked on you. There is a risk that the curse still remains on you. Only once every 3 days
  remove curse: get rid of a curse, you might need to perform a task to do so
  --&gt;
&lt;/p&gt;
&lt;p&gt;[[Back|DngPC_Shrine]]&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt; 
var generalHints=[&quot;\&quot;Hornetts have a strong poison. But I have some pills that could block that....\&quot;&quot;
,&quot;\&quot;The hives of the hornetts are sensitive to fire.\&quot;&quot;
,&quot;\&quot;Saving some money for better gear from the trader would be an idea.\&quot;&quot;];
function randomHint(){
    var msg=&quot;&lt;/br&gt;&quot;+generalHints[_.random(0,generalHints.length-1)];
    window.gm.printOutput(msg);
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="617" name="DngPC_Vendor" tags="_nosave_" position="850,7725" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
A vendor sells some gear and might also buy some of your loot.&lt;br&gt; &quot;Would you like to &lt;a0 onclick=&quot;_sell=false;window.gm.refreshAllPanel()&quot;&gt;buy&lt;/a&gt; something or &lt;a0 onclick=&quot;_sell=true;window.gm.refreshAllPanel()&quot;&gt;sell&lt;/a&gt;?&quot;&lt;/br&gt;[[Back|DngPC_G4]]&lt;/br&gt;
&lt;div id=&quot;choice&quot;&gt;&lt;/div&gt;&lt;/br&gt;&lt;/br&gt;   &lt;!--display buy message--&gt;
&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;&lt;/br&gt;    &lt;!--display wares list--&gt;
&lt;p&gt;&lt;!--
    basic weapon
    spell tome
    potions
    food
    keys for chest and locked gear
    surprise box
    vouchers
  --&gt;
&lt;/p&gt;
&lt;p&gt;[[Back|DngPC_G4]]&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
var _sell;
function findWares(){
    let item,item2,list = [],list2 = [],_d=window.story.state.DngPC,_t=_d.tmp.tier;
    list=[window.gm.ItemsLib[&#39;HealthPotionSmall&#39;](),window.gm.ItemsLib[&#39;HealthPotion&#39;]()
    ,window.gm.ItemsLib[&#39;SpearWodden&#39;]()
    ,window.gm.ItemsLib[&#39;DaggerSteel&#39;]()
    ,window.gm.ItemsLib[&#39;SerenityPotionSmall&#39;]()
    //window.gm.ItemsLib[&#39;Vaginarium&#39;](),
    //window.gm.ItemsLib[&#39;Penilium&#39;]()
    ];
    if(_t&gt;=1){
        item = window.gm.ItemsLib[&#39;BracerLeather&#39;]();
        item = window.gm.makeCursedItem(item,{minItems:2,convert:&#39;GlovesRubber&#39;});
        item = window.gm.makeBonusItem(item,{statBoost:&#39;agility&#39;, statBonus:2});
        list.push(item);
        list.push(window.gm.ItemsLib[&#39;VoucherIron&#39;]())
    }
    if(_t&gt;=0){
        item = window.gm.ItemsLib[&#39;Box&#39;]();
        item.addItem(window.gm.ItemsLib[&#39;SerenityPotionSmall&#39;](),3)
        item.name=&quot;Mysterious,grey Box&quot;,item.price=20;
        list.push(item);
        item2 = window.gm.ItemsLib[&#39;AnalPlugSmall&#39;](); //todo how to wrap this in mysteriousBox
        item2.name= &quot;Plug of the fire spell&quot;
        item2 = window.gm.makeBonusItem(item2,{skillid:&quot;SkillFireball&quot;,skillname:&#39;PlugFireBall&#39;});
        item = window.gm.ItemsLib[&#39;Box&#39;]();
        item.addItem(item2)
        item.name=&quot;Mysterious,red Box&quot;,item.price=40;
        list.push(item);
    }
    for(var n of list){  //todo sort by tag - name
        let cost = window.gm.shop.calculateBuyPrice(n);
        if(cost){
            list2.push({item:n,cost:cost});
        }
    }
    window.gm.shop.WaresToBuy = list2;
    window.gm.shop.findWaresToSell(window.gm.player,[window.gm.ItemTags.Ingredient]);
}
findWares();
if(_sell){renderToSelector(&quot;#panel&quot;, &quot;listsell&quot;) }else{ renderToSelector(&quot;#panel&quot;, &quot;listbuy&quot;)};
&lt;/script&gt; 

&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="618" name="DngPC_Retreat" tags="" position="975,7725" size="100,100">&lt;div&gt;&lt;a href=&quot;javascript:void(0)&quot; id=&#39;retreat&#39; onclick=&#39;(function($event){document.querySelector(&quot;#&quot;+id+&quot;~p&quot;).toggleAttribute(&quot;hidden&quot;);})(this);&#39;&gt;Retreat to sanctuary&lt;/a&gt;&lt;p hidden&gt;Do you relly want to abort your run and return with what you have earned so far?&lt;a0 onclick=&#39;window.gm.addTime(120),window.story.show(&quot;DngPC_G4&quot;)&#39;&gt; Yes &lt;/a&gt;&lt;/p&gt;&lt;/br&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="619" name="DngPC_Cell" tags="" position="1100,7725" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
This is your &quot;home&quot;, a small cell carved out of the stone with a splintering, wodden door and a shaggy cot.&lt;/br&gt;
You could rest here to recover health and energy. It might also be a good idea to save your progress.
&lt;%if(window.gm.getTimeStruct().hour&lt;11){ %&gt;
&lt;a0 onclick=&#39;($(&quot;tw-passage&quot;).fadeOut(1000, function(){window.gm.player.sleep(1800);window.story.show(&quot;DngPC_Sleep&quot;);}));&#39;&gt;Sleep Until Evening&lt;/a&gt; 
&lt;%} else {%&gt;
&lt;a0 onclick=&#39;($(&quot;tw-passage&quot;).fadeOut(1000, function(){window.gm.player.sleep(700);window.story.show(&quot;DngPC_Sleep&quot;);}));&#39;&gt;Sleep Until Morning&lt;/a&gt;
&lt;%}%&gt;
&lt;%=window.gm.renderRoom(window.passage.name)%&gt;
[[Sanctuary|DngPC_G4]] [[Storage Chest|GlobalChest]]&lt;/br&gt;&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngPC_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="620" name="DngPC_G4" tags="" position="1225,7725" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
You are now in a large hall with adjoining cells set into the walls. One of them is reserved as your private space.&lt;/br&gt;
&lt;a0 id=&#39;howtoplay&#39; onclick=&#39;(function($event){document.querySelector(&quot;#&quot;+id+&quot;~p&quot;).toggleAttribute(&quot;hidden&quot;);})(this);&#39;&gt;Hint&lt;/a&gt;
&lt;p class=&#39;speech&#39; hidden&gt;You were send to this dungeon to pay up for your crimes.&lt;/br&gt;
The dungeon consist of several connected rooms that you have to pass one after another.If you pass the test in the arena, you gain money and loot. &lt;/br&gt;
However, if you are defeated you will loose most of the things you carry with you (except money and &quot;special&quot; gear) and respawn in the starting zone.&lt;/br&gt;
There is a chest in your cell where you can store anything that you dont want to take with you on your trials.&lt;/br&gt;
It might need several attempts to find your way to the next room. Occasional you might find something useful, but there could also be traps or crude magic.&lt;/br&gt;
You should weight the option to retreat early and invest earned money in better gear. That might give you better chances to survive the tougher fights at the cost of fighting the previous foes again.&lt;/br&gt;
By donating to the &quot;shrine of jurisprudence&quot; you pay off your surcharge. If you dont do so regulary, you might get some bonus punishment. There are also some services available for a fee.&lt;/br&gt;
&lt;/p&gt;
&lt;a0 id=&#39;howtoplay2&#39; onclick=&#39;(function($event){document.querySelector(&quot;#&quot;+id+&quot;~p&quot;).toggleAttribute(&quot;hidden&quot;);})(this);&#39;&gt;Hint&lt;/a&gt;
&lt;p class=&#39;speech&#39; hidden&gt;Keep an eye on your savagness-stat.&lt;/br&gt;
It increases when experiencing ignoble situations. If the stat hits its maximum, bad end for you.&lt;/br&gt;
There are consumables and items to reduce the score and just having a good rest helps.&lt;/br&gt;
Notice that the maximum might increase in some situations, meaning you can experience more savageness. And thats a good thing, right? &lt;/br&gt;
&lt;/p&gt;
&lt;%=window.gm.renderRoom(window.passage.name)%&gt;
[[Your cell|DngPC_Cell]] [[Shrine|DngPC_Shrine]] [[Vendor|DngPC_Vendor]] &lt;/br&gt;&lt;/br&gt;
Some heavy doors lead into the dungeon: &lt;%=window.gm.printNav2()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngPC_Encounters&quot;)%&gt;
&lt;script&gt;function checkTask(){ //if a task is running but time is over -&gt; punishment
    let s=window.story.state,_t=s.DngPC.task;
    if(!_t || !_t.id) return;
    if(_t.time!==0,window.gm.getDeltaTime(window.gm.getTime(),_t.start)&gt;_t.time){
        s.DngPC.task={};
        window.story.show(&#39;DngPC_Timeout&#39;);
    }
}
checkTask();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="621" name="DngPC_Timeout" tags="_nosave_" position="100,7850" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
todo you failed to finish the given task and get punished &lt;/br&gt;
get 2xmoney deducted if bringMoney task&lt;/br&gt;
get one of your items cursed &lt;/br&gt;
&lt;p&gt;[[Back|DngPC_G4]]&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="622" name="DngPC_I2" tags="" position="225,7850" size="100,100">&lt;%=window.story.render(&quot;DngPC_F4&quot;)%&gt;</tw-passagedata><tw-passagedata pid="623" name="DngPC_J2" tags="" position="350,7850" size="100,100">&lt;%=window.story.render(&quot;DngPC_F4&quot;)%&gt;</tw-passagedata><tw-passagedata pid="624" name="DngPC_H3" tags="" position="475,7850" size="100,100">&lt;%=window.story.render(&quot;DngPC_F4&quot;)%&gt;</tw-passagedata><tw-passagedata pid="625" name="DngPC_I3" tags="" position="600,7850" size="100,100">&lt;%=window.story.render(&quot;DngPC_F4&quot;)%&gt;</tw-passagedata><tw-passagedata pid="626" name="DngPC_J3" tags="" position="725,7850" size="100,100">&lt;%=window.story.render(&quot;DngPC_F4&quot;)%&gt;</tw-passagedata><tw-passagedata pid="627" name="DngPC_F4" tags="" position="850,7850" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
Another Arena&lt;/br&gt;&lt;%=window.story.render(&quot;DngPC_Retreat&quot;)%&gt;
&lt;%=window.gm.renderRoom(window.passage.name)%&gt;&lt;%=window.gm.printNav2()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngPC_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="628" name="DngPC_H4" tags="" position="975,7850" size="100,100">&lt;%=window.story.render(&quot;DngPC_F4&quot;)%&gt;</tw-passagedata><tw-passagedata pid="629" name="DngPC_I4" tags="" position="1100,7850" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;

&lt;div id=&#39;select1&#39; &gt;Water ripples out from a tap into a scoop bassin.
&lt;a0 onclick=&#39;window.gm.player.Stats.increment(&quot;health&quot;,50);window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;),window.gm.refreshSidePanel()&#39;&gt;Sipping&lt;/a&gt; some of that clear water might give you back some energy.&lt;/br&gt;
&lt;/div&gt;&lt;div id=&#39;choice1a&#39; hidden&gt;You feel surprisingly refreshed after some gulps of that clear water.
&lt;/div&gt;
&lt;%=window.gm.renderRoom(window.passage.name)%&gt;
Something tells you that a bigger threat then before awaits to the east.&lt;/br&gt;&lt;/br&gt;&lt;%=window.story.render(&quot;DngPC_Retreat&quot;)%&gt;&lt;%=window.gm.printNav2()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngPC_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="630" name="DngPC_J4" tags="" position="1225,7850" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;div id=&#39;select1&#39;&gt;There is something valueable here. Grab it before you leave:
&lt;a0 onclick=&#39;window.gm.player.Inv.addItem(window.gm.ItemsLib[&quot;VoucherSilver&quot;]());window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;)&#39;&gt;1x Silver Voucher&lt;/a&gt;&lt;/br&gt;
&lt;/div&gt;&lt;div id=&#39;choice1a&#39; hidden&gt;Loot aquired&lt;/br&gt;&lt;/div&gt;
&lt;/br&gt;&lt;%=window.story.render(&quot;DngPC_Retreat&quot;)%&gt;
&lt;%=window.gm.renderRoom(window.passage.name)%&gt;&lt;%=window.gm.printNav2()%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;%=window.story.render(&quot;DngPC_Encounters&quot;)%&gt;</tw-passagedata><tw-passagedata pid="631" name="DngPC_F5" tags="" position="100,7975" size="100,100">&lt;%=window.story.render(&quot;DngPC_F4&quot;)%&gt;</tw-passagedata><tw-passagedata pid="632" name="DngPC_G5" tags="" position="225,7975" size="100,100">&lt;%=window.story.render(&quot;DngPC_F4&quot;)%&gt;</tw-passagedata><tw-passagedata pid="633" name="DngPC_H5" tags="" position="350,7975" size="100,100">&lt;%=window.story.render(&quot;DngPC_F4&quot;)%&gt;</tw-passagedata><tw-passagedata pid="634" name="DngPC_I5" tags="" position="475,7975" size="100,100">&lt;%=window.story.render(&quot;DngPC_F4&quot;)%&gt;</tw-passagedata><tw-passagedata pid="635" name="DngPC_F6" tags="" position="600,7975" size="100,100">&lt;%=window.story.render(&quot;DngPC_F4&quot;)%&gt;</tw-passagedata><tw-passagedata pid="636" name="DngPC_G6" tags="" position="725,7975" size="100,100">&lt;%=window.story.render(&quot;DngPC_F4&quot;)%&gt;</tw-passagedata><tw-passagedata pid="637" name="DngPC_H6" tags="" position="850,7975" size="100,100">&lt;%=window.story.render(&quot;DngPC_F4&quot;)%&gt;</tw-passagedata><tw-passagedata pid="638" name="DngSA_Entry" tags="" position="975,7975" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
This is an area where apprentices are to perform sports and martial exercises.&lt;/br&gt;
&lt;% if(window.gm.player.Skills.countItem(&#39;Tease&#39;)&gt;0){%&gt;
Train your [[Tease-ability|DngSA_TeaseTraining]]&lt;/br&gt;
&lt;%}%&gt;
Do some hands on combat in the [[arena|NOP]].&lt;/br&gt;
&lt;p&gt;[[Back|DngSY_Hall]]&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="639" name="DngSA_Arena" tags="" position="1100,7975" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
A door is leading from the fortress into a circular arena that reminds you of a giant bowl.&lt;/br&gt; 
That place is also open to the sky that is curently light blue except where some fluffy louds are floating.&lt;/br&gt;
Because a high stonewall is surrounding the outer ring, you cant see what is below the horizon.&lt;/br&gt;
&lt;a0 onclick=&#39;&#39; hidden&gt;hawk-&quot;Training&quot;&lt;/a&gt;&lt;/br&gt;
&lt;a0 onclick=&#39;&#39; hidden&gt;hornett-&quot;Training&quot;&lt;/a&gt;&lt;/br&gt;
&lt;a0 onclick=&#39;&#39; hidden&gt;lapine-&quot;Training&quot;&lt;/a&gt;&lt;/br&gt;
&lt;a0 onclick=&#39;&#39; hidden&gt;lizan-&quot;Training&quot;&lt;/a&gt;&lt;/br&gt;
&lt;a0 onclick=&#39;&#39; hidden&gt;wolf-&quot;Training&quot;&lt;/a&gt;&lt;/br&gt;
&lt;p&gt;[[Back|DngSY_Hall]]&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="640" name="DngSA_TeaseLv1" tags="" position="1225,7975" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
Kumala is again at work in the lab.
&lt;p class=&quot;tPC&quot;&gt;&quot;Good morning Kumala. I found your note.&quot;&lt;/p&gt;
&lt;span class=&quot;tNPC1&quot;&gt;&quot;Yes the note, I should have told you yesterday when you were here. You were already in your room when I remeered and I didnt know if you were.. &quot;&lt;/span&gt;
She makes a strange pause &lt;span class=&quot;tNPC1&quot;&gt;&quot;..busy or so.&quot;&lt;/span&gt;
&lt;p class=&quot;tNPC1&quot;&gt;&quot;Please follow me.&quot;&lt;/p&gt;
&lt;div id=&#39;select5&#39;&gt; You fall into step 
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select5&quot;,&quot;div#choice5a&quot;)&#39;&gt;behind her&lt;/a&gt; as she leaves the room.&lt;/br&gt;
&lt;/div&gt;&lt;div id=&#39;choice5a&#39; hidden&gt;&lt;/br&gt;
    You two walk down the corridor to another door, this one a little bigger then the others. After you entered the room, she 
    &lt;div id=&#39;select6&#39; style=&#39;display: inline;&#39;&gt;
    &lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select6&quot;,&quot;div#choice6a&quot;)&#39;&gt;closes&lt;/a&gt; the door.&lt;/br&gt;
    &lt;/div&gt;&lt;div id=&#39;choice6a&#39; hidden&gt;&lt;/br&gt;
        &lt;p class=&quot;tNPC1&quot;&gt;&quot;This is our training ground, a part of it at least. You will run into some people out there and it might be necessary to take care of them the one way or another.&quot;&lt;/p&gt;
        &lt;p class=&quot;tNPC1&quot;&gt;&quot;To say it bluntly, you dont look like someone familiar with though situations.&quot;&lt;/p&gt;
        &lt;div id=&#39;select7&#39; &gt;
        &lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select7&quot;,&quot;div#choice7a&quot;)&#39;&gt;Brag&lt;/a&gt;&lt;/br&gt;
        &lt;/div&gt;&lt;div id=&#39;choice7a&#39; hidden&gt;&lt;/br&gt;
            &lt;p class=&quot;tPC&quot;&gt;&quot;Well, I had to talk my way out of some troubles in the past, or just be quick on the foot.&quot;&lt;/p&gt;
            &lt;p class=&quot;tNPC1&quot;&gt;&quot;Sure, but sooner or later you will have to stand your ground. Thatswhy we will do some training.&quot;&lt;/p&gt;
            &lt;p class=&quot;tPC&quot;&gt;&quot;Like stabbing some one in their back or shooting with a bow?&quot;&lt;/p&gt;
            &lt;p class=&quot;tNPC1&quot;&gt;&quot;Physical combat is more Cyrils area of expertise. I&#39;m more specialised in the non-combat related subjects.&quot;&lt;/p&gt;
            &lt;p class=&quot;tNPC1&quot;&gt; Today I want to introduce you to some technique that might be useful when violence is not the best choice.&quot;&lt;/p&gt;
            &lt;p class=&quot;tPC&quot;&gt;&quot;By blinding them or using some mirror trick?&quot;&lt;/p&gt;
            &lt;div id=&#39;select8&#39; &gt;
            &lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select8&quot;,&quot;div#choice8a&quot;)&#39;&gt;you ask puzzled&lt;/a&gt;&lt;/br&gt;
            &lt;/div&gt;&lt;div id=&#39;choice8a&#39; hidden&gt;&lt;/br&gt;
                &lt;p class=&quot;tNPC1&quot;&gt;&quot;What? Oh, you think because of all the mirrors around? They are here so that you can watch yourself when performing.&quot;&lt;/p&gt;
                &lt;p class=&quot;tNPC1&quot;&gt;&quot;See, sometimes a roll of your hips can be as effective as a kick with your boots. Therefoe you should learn how to use your assets.&quot;&lt;/p&gt;
                Kumala shows you how to move seductively. You arent sure for what reason or in what kind of situation this would be helpful.&lt;/br&gt;
                &lt;div id=&#39;select9&#39; &gt;
                &lt;a0 onclick=&#39;window.gm.player.Skills.addItem(new window.storage.constructors.SkillTease()),window.gm.printTalkLink(&quot;div#select9&quot;,&quot;div#choice9a&quot;)&#39;&gt;Time passes&lt;/a&gt;&lt;/br&gt;
                &lt;/div&gt;&lt;div id=&#39;choice9a&#39; hidden&gt;&lt;/br&gt;
                    &lt;p class=&quot;tNPC1&quot;&gt;&quot;You learned the basics on how to &lt;statup&gt;tease&lt;/statup&gt; someone. But dont think you are an expert now. It might require some repeated training to be effective.&quot;&lt;/p&gt;
                    She doesnt seem to be fully satisfied with your performance. But you both are tired right now and a nap on [[your bed|DngSY_Your_Room]] seems a good idea.
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section</tw-passagedata><tw-passagedata pid="641" name="DngSA_TeaseTraining" tags="" position="100,8100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
TODO: Train your Tease-skill by checking your performance in the mirrors. Upgrade dance/Poledance?
Consumes some energy, progress is capped
&lt;/br&gt;&lt;p&gt;[[Finish|DngSA_Entry]]&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="642" name="DngSA_OralLv1" tags="" position="225,8100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
&lt;p class=&quot;tNPC1&quot;&gt;&quot;I suggest you both work on your sexual skills. Sometimes this can greatly simplify problem solving. Besides, it&#39;s fun to learn new things, right?&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC3&quot;&gt;&quot;Sexual skills? But we just arrived here. You dont even know what we are capable of!&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC1&quot;&gt;&quot;Is that so? Well what do you think?&quot;&lt;/p&gt;
&lt;div id=&#39;select1&#39; &gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;)&#39;&gt;We should learn something practical&lt;/a&gt;&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1b&quot;)&#39;&gt;I dont even know what you mean by sexual skills&lt;/a&gt;&lt;/br&gt;
&lt;/div&gt;&lt;div id=&#39;choice1a&#39; hidden&gt;&lt;/br&gt;
    &lt;p class=&quot;tNPC3&quot;&gt;&quot;Thats the spirit!&quot;&lt;/p&gt; Leon chuckles on your statemment.
    &lt;div id=&#39;select2&#39; class=&quot;tPC&quot; &gt;&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select2&quot;,&quot;div#choice2a&quot;)&#39;&gt;&#39;At least this time he gives me support.&#39;&lt;/a&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#39;choice1b&#39; hidden&gt;&lt;/br&gt;
    &lt;p class=&quot;tNPC3&quot;&gt;&quot;Sounds like virgin to me.&quot;&lt;/p&gt; Leon chuckles on your statemment.
    &lt;div id=&#39;select3&#39; class=&quot;tPC&quot; &gt;&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select3&quot;,&quot;div#choice2a&quot;)&#39;&gt;&#39;Asshole&#39;&lt;/a&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;div id=&#39;choice2a&#39; hidden&gt;&lt;/br&gt;
    Kumala just ignores what you both said.
    &lt;p class=&quot;tNPC1&quot;&gt;&quot;Endurance, capability, technique. Honestly I think you lack on all of them. If you want to impress someone, or at least met some minimum requirements, you need to improve these.&quot;&lt;/p&gt;
    &lt;p class=&quot;tNPC3&quot;&gt;&quot;So, YOU are going to train with us?&quot;&lt;/p&gt; Leons smirks lecherously.
    &lt;p class=&quot;tNPC1&quot;&gt;&quot;This would be an arduous lesson for you.&quot; &lt;/p&gt; she twinkles &lt;span class=&quot;tNPC1&quot;&gt;&quot;No, you will train for yourself.&quot;&lt;/span&gt;
    &lt;p class=&quot;tNPC1&quot;&gt;&quot;So the first thing we will start are your oral abilitys.&quot;&lt;/p&gt;
    &lt;p class=&quot;tPC&quot;&gt;&quot;You mean to approach someone and win them over?&quot;&lt;/p&gt;
    &lt;p class=&quot;tNPC1&quot;&gt;&quot;No, I mean giving head.&quot;&lt;/p&gt; she presents you a small peg two times the size of your thumb. You blush hottly as you notice that it ressembles a phallus.
    &lt;p class=&quot;tNPC1&quot;&gt;&quot;Take this into your mouth and lavish it with your tongue, squeeze it with your lips and suckle on it. Just be careful that you do not scratch it with your teeth or choke on it.&quot;&lt;/p&gt;
    Leon recovers from the shock first: &lt;p class=&quot;tNPC3&quot;&gt;&quot;What ! I&#39;m not going to suck this! I would never suck a man&#39;s cock! &quot;&lt;/p&gt;
    &lt;div id=&#39;select10&#39; &gt;
    &lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select10&quot;,&quot;div#choice10a&quot;)&#39;&gt;Leon exclaims.&lt;/a&gt;&lt;/br&gt;
    &lt;/div&gt;&lt;div id=&#39;choice10a&#39; hidden&gt;&lt;/br&gt;
        &lt;p class=&quot;tNPC1&quot;&gt;&quot;Fine. Then how about this?&quot;&lt;/p&gt; 
        she presents you a tube with a very distinct feature. The tube is as thick as your lower arm and half as long.
        &lt;p class=&quot;tNPC1&quot;&gt;&quot;Is that more alluring to you?&quot;&lt;/p&gt;
        she presents you the very distinct feature of this gadget - the tubes opening resembles female genitals very detailed. Your blush deepens even more. 
        The material the gadget is made of seems to be some squisshy, rubberlike material. 
        &lt;p class=&quot;tNPC3&quot;&gt;&quot;Well, I could live with that. The real thing would be even better though&quot;&lt;/p&gt; he grins broadly.
        &lt;p class=&quot;tNPC1&quot;&gt;&quot;Mastery comes through frequent practice, as they say. So, I want you to train on these whenever you are idle in your room and have no other task.&quot;&lt;/p&gt;
        &lt;p class=&quot;tPC&quot;&gt;&#39;I bet he will try to stick his dick into that.&#39;&lt;/p&gt; crosses your mind when you notice Leon starring eagerly at those fleshy lips.
        &lt;p class=&quot;tNPC1&quot;&gt;&quot;and just to be clear this is oral only - not for any other use.&quot; &lt;/p&gt; 
        It takes him a lot of effort to replace the grin with a serious face. 
        &lt;div id=&#39;select11&#39; &gt;
        &lt;a0 onclick=&#39;window.story.state.DngSY.dildo=1,window.gm.printTalkLink(&quot;div#select11&quot;,&quot;div#choice11a&quot;)&#39;&gt;&quot;Why is this necessary?&quot;&lt;/a&gt;&lt;/br&gt;
        &lt;a0 onclick=&#39;window.story.state.DngSY.dildo=1,window.gm.printTalkLink(&quot;div#select11&quot;,&quot;div#choice11b&quot;)&#39;&gt;&quot;I too would prefer something else then.. this&quot;&lt;/a&gt; you point at the phallus.&lt;/br&gt;
        &lt;a0 onclick=&#39;window.story.state.DngSY.pussy=1,window.gm.printTalkLink(&quot;div#select11&quot;,&quot;div#choice11c&quot;)&#39;&gt;Snatch the pussy before he does&lt;/a&gt;&lt;/br&gt;
        &lt;/div&gt;&lt;div id=&#39;choice11a&#39; hidden&gt;&lt;/br&gt;
            &lt;p class=&quot;tPC&quot;&gt;&quot;Why is this necessary? I mean, that doesnt really sound like a common training for acolytes.&quot;&lt;/p&gt;
            As Kumala is distracted by your upspeek, he snatches the pussy and holds it tight.
            &lt;p class=&quot;tNPC1&quot;&gt;&quot;I didnt know you are an expert in tuition&quot;&lt;/p&gt; she seems to be offended somewhat by that question.  
            &lt;div id=&#39;select12&#39;&gt;&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select12&quot;,&quot;div#choice12&quot;)&#39;&gt;Next&lt;/a&gt;&lt;/br&gt;&lt;/div&gt;
        &lt;/div&gt;
        &lt;div id=&#39;choice11b&#39; hidden&gt;&lt;/br&gt;
            &lt;p class=&quot;tNPC1&quot;&gt;&quot;Oh, I&#39;m sorry... &quot;&lt;/p&gt; just as Kumala starts explaining, Leon snatches the tube from her hand and hides it behind his back
            &lt;p class=&quot;tNPC1&quot;&gt;&quot;.. but there is only that one. You will have to stik with that peg or maybe Leon is willing to share.&quot;&lt;/p&gt;
            As smug as he grins at you, thats unlikely.
            &lt;div id=&#39;select12&#39;&gt;&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select12&quot;,&quot;div#choice12&quot;)&#39;&gt;Next&lt;/a&gt;&lt;/br&gt;&lt;/div&gt;
        &lt;/div&gt;
        &lt;div id=&#39;choice11c&#39; hidden&gt;&lt;/br&gt;
            You snatch the pussy before Leon does, keeping it save between your arms.
            &lt;p class=&quot;tNPC1&quot;&gt;&quot;I only have that one. Maybe you both can share it. Here Leon take the peg anyway, maybe you change your mind.&quot;&lt;/p&gt;
            Leon scowls at you. For sure he doesnt like to have to stick to the phallus. But you doubt he would ask you to share the tube.
            &lt;div id=&#39;select12&#39;&gt;&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select12&quot;,&quot;div#choice12&quot;)&#39;&gt;Next&lt;/a&gt;&lt;/br&gt;&lt;/div&gt;
        &lt;/div&gt;
        &lt;div id=&#39;choice12&#39; hidden&gt;&lt;/br&gt;
            &lt;p class=&quot;tNPC1&quot;&gt;&quot;Thats all for now. But dont forget your homework, I will check on that soon enough&quot;&lt;/p&gt;
            With that you both leave.
            Leon mutters &lt;p class=&quot;tNPC3&quot;&gt;&quot;How will she check? With some hands on demonstration?&quot;&lt;/p&gt;
            [[Leave|DngSY_Hall]]
        &lt;/div&gt;
    &lt;/div&gt;    
&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="643" name="DngSA_Train_Oral_Leon" tags="" position="350,8100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
Later on, you through the dorms hallway and some muffled squelches are coming from his room.
[[sneak a peek]][[Nah]]
Leon is lying on his bed and is busy lavishing that artifical vulva with his tongue.
[[retreat]][[wait]]
He suddenly shifts his cloth aside and you notice his hardon.
&quot;I will show ya where that cunt belongs&quot; he mumbles to himself and impales the artifical vulva with his manmeat
&quot;Oh yes, nice and wet.&quot;
You get aroused at the sight.
[[retreat !]][[wait]]
When you realize that you are still here and spying on a lad masturbating, you ask yourself &#39;Am I pervert?&#39;
Maybe you just want to know how he performs - just for comparission of course. 
Your thoughts are interuppted as you hear a frantic &quot;yes mmh yes, take it baby..&quot; 
With eager bucks of his hips he fires his load into the artifical pussy.
[[better leave now before he notice]]
Kumala will not be pleased if she ever got a hint on that. But you can&#39;t tell her without giving away that you were watching the lad rubbing one of.
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="644" name="DngSA_OralLv2" tags="" position="475,8100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
&lt;p class=&quot;tNPC1&quot;&gt;&quot;Whats that!&quot;&lt;/p&gt; Leon blushs furiously as Kumala inspects the tool.
&lt;p class=&quot;tNPC3&quot;&gt;&quot;I couldnt resist, it was just to big of a tease.&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC1&quot;&gt;&quot;And you didnt even care to clean it properly.&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC3&quot;&gt;&quot;I tried but its a blind hole and some...some of it got stuck down there.&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC3&quot;&gt;&quot;Thats your excuse? You will clean that!&quot;&lt;/p&gt; annoyed she pushs the tool back into his hands.
&lt;p class=&quot;tNPC1&quot;&gt;&quot;Yes maa`m&quot;&lt;/p&gt; intimidated as he is by Kumala&#39;s appearance you could almost feel sorry for him - almost.
&lt;p class=&quot;tNPC1&quot;&gt;&quot;I said clean it - now!&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC3&quot;&gt;&quot;What...how?&quot;&lt;/p&gt; he asks confused.
&lt;p class=&quot;tNPC1&quot;&gt;&quot;Use your mouth and your tongue. Suck it out if you cant reach that far.&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC1&quot;&gt;&quot;Thats what you should have trained anyway. Now you are going to learn the hard way.&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC3&quot;&gt;&quot;Can...can he at least leave?&quot;&lt;/p&gt; 
&lt;p class=&quot;tPC&quot;&gt;&quot;No, thats a lesson for both of you.&quot;&lt;/p&gt;
[[Look away]] [[watch]] [[smirk at his predicament]]
&lt;p class=&quot;tNPC1&quot;&gt;&quot;What are you grinning at? Do you think I&#39;m funny?&quot;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;No,..&quot;&lt;/p&gt; you shake your head.
&lt;p class=&quot;tNPC1&quot;&gt;&quot;Maybe you need a lesson too. You both are going to switch turns.&quot;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;What ? I cant...with my mouth...his spunk....&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC1&quot;&gt;&quot;You can and you will!&quot;&lt;/p&gt;
She snatches the pussy from Leons hands and presents you the opening.
[[start working]]
You take the toy and hesitantly give it a lick that makes you shudder.
&lt;p class=&quot;tNPC1&quot;&gt;&quot;Whenever one of you has to catch their breath, the other takes over.&quot;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&#39;What is she doing to us? At least Cyril doesnt see this. I couldnt look him in the eyes again. Kumala isnt going to tell him, right?&#39;&lt;/p&gt;
PussyLover++ CumSlurper++
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="645" name="DngSA_Train_OralLv1" tags="" position="600,8100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
&lt;div id=&#39;select1&#39; &gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;)&#39;&gt;Put it in your mouth&lt;/a&gt;&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1b&quot;)&#39;&gt;Dont do it&lt;/a&gt;&lt;/br&gt;
&lt;/div&gt;&lt;div id=&#39;choice1a&#39; hidden&gt;&lt;/br&gt;
&lt;/div&gt;
&lt;div id=&#39;choice1b&#39; hidden&gt;&lt;/br&gt;
Why would you put that thing in your mouth? It is so silly, maybe its just some kind of test.
&lt;/div&gt;
&lt;/br&gt;&lt;p&gt; &lt;a0 onclick=&#39;window.story.show(&quot;DngSY_Your_Room&quot;);&#39;&gt;Start&lt;/a&gt;&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="646" name="DngSA_Train_Parcour" tags="" position="725,8100" size="100,100">Cyril has setup a course with obstacles for your training. This should help you train your agility and endurance.
---
You are still equipped with the plugs and the bondage restraints. &quot;Sir please I cant do this. Its to difficult with...with all that.&quot; you let your chaines chime.
&quot;And thatswhy you need to train. You can&#39;t expect that you&#39;ll always be in the most favorable circumstances.&quot;
The parcours is a pain in the ass -literary - The plug is already noticeable when walking but if you then still have to cope with the obstacles...5579</tw-passagedata><tw-passagedata pid="647" name="SC_Lvx_MAP" tags="_back_" position="850,8100" size="100,100">&lt;hr&gt;&lt;div id=&#39;canvas&#39;&gt;&lt;/div&gt;&lt;div id=&#39;svgpopup&#39;&gt;&lt;/div&gt;&lt;/br&gt;
&lt;script&gt; window.gm.printMap2(window.story.state.DngSY.dngMap,window.gm.player.location.replace(window.story.state.DngSY.dng+&#39;_&#39;,&#39;&#39;),
    window.story.state.DngSC.mapReveal,window.story.state.DngSC.visitedTiles);
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="648" name="SC_Lvx_Entry" tags="" position="975,8100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;&lt;%=window.story.render(window.story.state.DngSY.dng+&quot;_MAP&quot;)%&gt;
TODO Another scary, ruined dungeon..
&lt;/br&gt;&lt;p&gt; [[Next|SC_Lvx_I4]] &lt;/br&gt;&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
function buildRooms(){
    const _m=[
        &#39;    H2--I2--J2        &#39;,//todo write parser for this
        &#39;    |       |         &#39;,
        &#39;    H3  I3--J3--K3    &#39;,
        &#39;    |   |       |     &#39;,
        &#39;G4--H4--I4      K4    &#39;,
        &#39;    |           |     &#39;,
        &#39;    H5--I5--J5--K5--L5&#39;,
        &#39;                    | &#39;,
        &#39;            J6--K6--L6&#39;];

}
    var s = window.story.state;
    /*s.DngSY.dng=&#39;SC_Lvx&#39;;
    s.vars.spawnAt=&quot;DngSY_Recover_Death&quot;;
    s.DngAT.leverG4=false;
    buildRooms();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="649" name="DngSY_Intro" tags="" position="1100,8100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
Todo better intro, meet Cyril, ly to him you are acolythe, get sanctuary tour, get told whats expected from you&lt;/br&gt;
You accidently went through a portal and end up in the netherworld.&lt;/br&gt;
You were lucky that you didnt end in one of the more unpleasent areas but in the &quot;Sanctuary&quot;.&lt;/br&gt;
Of course you dont want to stay here forever, so better get started making an escape plan.&lt;/br&gt;
&lt;p&gt;[[Next|DngSY_Your_Room]]&lt;p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="650" name="DngSY_Hallway_Dorms" tags="" position="1225,8100" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
This corridor connects the dorms with the [[Hallway|DngSY_Hall]]. Most of the doors on both sides of the corridor seem to lead to rooms for the guests here. One of them is assigned as [[Your room|DngSY_Your_Room]].&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="651" name="DngSY_Your_Room" tags="" position="100,8225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
&lt;%if(window.story.state.DngSY.remainingNights&lt;=0){%&gt;
    You better get equipped and ready for your next task.&lt;/br&gt;
    &lt;p class=&quot;author&quot;&gt;Now is a good time to save and and stow everything you don&#39;t want to lose in the trunk.&lt;/p&gt;
    &lt;p&gt;&lt;a0 onclick=&#39;window.story.show(nextDng());&#39;&gt;Seek the portal&lt;/a&gt;&lt;/p&gt;
&lt;%}else{%&gt;
    This is your own private room. You can &lt;a href=&quot;javascript:void(0)&quot; onclick=&#39;($(&quot;tw-passage&quot;).fadeOut(1000, function(){window.gm.player.sleep(700);window.story.state.DngSY.remainingNights-=1;window.story.show(&quot;DngSY_Your_Room_Sleep&quot;);}));&#39;&gt;sleep&lt;/a&gt; here to regain health and energy.
    &lt;/br&gt;But maybe you shouldnt do that all day, even if you are tired. Look around in the sanctuary, maybe you can find someone to talk to or get some training.
    &lt;p&gt; You can sleep &lt;b&gt;&lt;%=window.story.state.DngSY.remainingNights%&gt; more nights&lt;/b&gt; before you have to start another adventure. So better use the time here for preping.&lt;/p&gt;
    &lt;p&gt; &lt;%=(window.story.state.DngSY.dildo &amp; 0x1)?&#39;[[Train your oral skills...|DngSA_Train_OralLv1]]&#39;:&#39;&#39;%&gt;&lt;/p&gt;
    &lt;p&gt; Go to: [[Dorms|DngSY_Hallway_Dorms]] [[Hallway|DngSY_Hall]]&lt;/p&gt;
&lt;%}%&gt;
&lt;/br&gt;There is a [[trunk|GlobalChest]] to store anything you dont want to lose. You might also change your [[Wardrobe]] and take a closer look on yourself in the [[Mirror]].
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
function nextDng(){return(&quot;DngSY_Lv&quot;+window.story.state.DngSY.dngLevel.toString());}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="652" name="DngSY_Your_Room_Sleep" tags="_nosave_" position="225,8225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
You awake in your room.
&lt;%if(window.story.state.DngSY.dngLevel===2 &amp;&amp; window.gm.player.Skills.countItem(&#39;Tease&#39;)&lt;1){%&gt;
    Someone slipped a note through the gap below your door: &quot;meet me in the lab, Kumala&quot;. &lt;/br&gt;
    So Kumala want you to [[visit her|DngSA_TeaseLv1]].
&lt;%}else if(window.story.state.DngSY.remainingNights&lt;=0){%&gt;
    The thought is poking at your mind that you have to go through the portal today.&lt;/br&gt;
    Startled you notice that Cyril is waiting in the doorframe.&lt;span class=&quot;tNPC2&quot;&gt;&quot;It is time now. Meet me in the hall.&quot;&lt;/span&gt;
    &lt;p&gt; [[Get up|DngSY_Your_Room]]&lt;/p&gt;
&lt;%}else{%&gt;
    Cyril said that you soon have to go through the portal again and that you should prepare for that. &lt;/br&gt;
    You can sleep &lt;b&gt;&lt;%=window.story.state.DngSY.remainingNights%&gt; more nights&lt;/b&gt; before you have to start another adventure.
    &lt;p&gt; [[Get up|DngSY_Your_Room]]&lt;/br&gt;&lt;/p&gt;
&lt;%}%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="653" name="DngSY_Recover_Death" tags="_nosave_" position="350,8225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
Suddenly snapping awake, you find yourself back into Sanctuary. For sure it was just a nightmare you awoke from, a sick dream about a horrible fate. &lt;/br&gt;
You cant even remember what you exactly dreamed, and maybe thats a good thing.
&lt;/br&gt;[[Next|DngSY_Your_Room]]
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="654" name="DngSY_Portal" tags="" position="475,8225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
&lt;div id=&#39;choice&#39;&gt;&lt;/div&gt; &lt;!--choice is rendered here--&gt;
&lt;p&gt; [[Back|DngSY_Hall]]&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
var msg=&#39;&#39;,lvl=window.story.state.DngSY.dngLevel;
msg+=(lvl&gt;=4)?&#39;&lt;p&gt;&lt;a0 onclick=\&#39;window.story.state.DngSY.dngOW=true;window.story.show(\&quot;HC_Entry\&quot;);\&#39;&gt;Haunted Castle&lt;/a&gt;&lt;/p&gt;&#39;:&#39;&#39;;
msg+=(lvl&gt;=4)?&#39;&lt;p&gt;&lt;a0 onclick=\&#39;window.story.state.DngSY.dngOW=true;window.story.show(\&quot;DngFM_Entry\&quot;);\&#39;&gt;Farm&lt;/a&gt;&lt;/p&gt;&#39;:&#39;&#39;;
msg+=(lvl&gt;=2)?&#39;&lt;p&gt;&lt;a0 onclick=\&#39;window.story.state.DngSY.dngOW=true;window.story.show(\&quot;DngCV_Entry\&quot;);\&#39;&gt;Crystal Cave&lt;/a&gt;&lt;/p&gt;&#39;:&#39;&#39;;
msg+=(lvl&gt;=5)?&#39;&lt;p&gt;&lt;a0 onclick=\&#39;window.story.state.DngSY.dngOW=true;window.story.show(\&quot;DngDF_Entry\&quot;);\&#39;&gt;Lush forest&lt;/a&gt;&lt;/p&gt;&#39;:&#39;&#39;;
msg+=(lvl&gt;=4)?&#39;&lt;p&gt;&lt;a0 onclick=\&#39;window.story.state.DngSY.dngOW=true;window.story.show(\&quot;DngMN_Entry\&quot;);\&#39;&gt;Silver Mountains&lt;/a&gt;&lt;/p&gt;&#39;:&#39;&#39;;
msg+=(lvl&gt;=5)?&#39;&lt;p&gt;&lt;a0 onclick=\&#39;window.story.state.DngSY.dngOW=true;window.story.show(\&quot;DngAT_Entry\&quot;);\&#39;&gt;Ancient Temple&lt;/a&gt;&lt;/p&gt;&#39;:&#39;&#39;;
msg+=(false)?&#39;&lt;p&gt;&lt;a0 onclick=\&#39;window.story.state.DngSY.dngOW=true;window.story.show(\&quot;DngLB_Entry\&quot;);\&#39;&gt;Smudgy Bog&lt;/a&gt;&lt;/p&gt;&#39;:&#39;&#39;;
msg+=(false)?&#39;&lt;p&gt;&lt;a0 onclick=\&#39;window.story.state.DngSY.dngOW=true;window.story.show(\&quot;SC_Entry\&quot;);\&#39;&gt;Sunken City&lt;/a&gt;&lt;/p&gt;&#39;:&#39;&#39;;
msg+=(false)?&#39;&lt;p&gt;&lt;a0 onclick=\&#39;window.story.state.DngSY.dngOW=true;window.story.show(\&quot;\&quot;);\&#39;&gt;Jungle Ruins&lt;/a&gt;&lt;/p&gt;&#39;:&#39;&#39;;
msg+=(false)?&#39;&lt;p&gt;&lt;a0 onclick=\&#39;window.story.state.DngSY.dngOW=true;window.story.show(\&quot;\&quot;);\&#39;&gt;Steam Glacier&lt;/a&gt;&lt;/p&gt;&#39;:&#39;&#39;;
msg+=(false)?&#39;&lt;p&gt;&lt;a0 onclick=\&#39;window.story.state.DngSY.dngOW=true;window.story.show(\&quot;\&quot;);\&#39;&gt;Savanah Rift&lt;/a&gt;&lt;/p&gt;&#39;:&#39;&#39;;
msg+=(false)?&#39;&lt;p&gt;&lt;a0 onclick=\&#39;window.story.state.DngSY.dngOW=true;window.story.show(\&quot;\&quot;);\&#39;&gt;Sky scrapers&lt;/a&gt;&lt;/p&gt;&#39;:&#39;&#39;;
if(msg===&#39;&#39;){
    msg=&#39;Behind the heavy door, is a dome-like hall. There seem to be no other door beside the one you walked through.&lt;/br&gt;&#39;;
}else{
    msg=&#39;In the center of this round hall, a magic portal can be summoned.&lt;/br&gt;So far, its the only exit you know from this fortress. While you are not busy with other task, you could explore some of the areas that you already visited.&lt;/br&gt;But why not stay in this cozy home?&lt;/br&gt;The portal could you bring to the following places:&lt;/br&gt;&#39;+msg;
}
window.gm.printOutput(msg,&#39;#choice&#39;);
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="655" name="DngSY_Hall" tags="" position="600,8225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
The great hall is the center of this complex. Several large pendant chandeliers spread a pleasantly bright light.&lt;/br&gt;
&lt;!--There is something like a [[Shop]] setup on one side but a sign displays: &gt;&gt;Closed&lt;&lt;.&lt;/br&gt;--&gt;
&lt;/br&gt;[[Cyril|Talk_Cyril]] is waiting idle right next to the [[impressive door|DngSY_Portal]] at the end of the hall.&lt;/br&gt; 
Speak to him to get a clue where you are heading next.&lt;/br&gt;
&lt;/br&gt; On the left side of the hall a corridor is leading back to the [[dorms|DngSY_Hallway_Dorms]] or to the [[library|DngSY_Library]] if you follow it to the end.&lt;/br&gt;
&lt;%if(window.story.state.DngSY.dngLevel&gt;=4){%&gt;
    A secluded room nearby contains a [[shrine|DngSY_Shrine]] where you can mediate or pray to whatever god you see fit.&lt;/br&gt;
&lt;%}%&gt;
&lt;%if(window.story.state.DngSY.dngLevel&gt;=2){%&gt;
    The corridor on the right side leads to the [[Training grounds|DngSA_Entry]] and [[Laboratory|DngSY_Lab]].&lt;/br&gt; 
&lt;%}%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="656" name="DngSY_Library" tags="" position="725,8225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
A lot of books and scrolls are waiting for someone to read them. &lt;/br&gt;
You can spend some time reading, maybe you learn a spell or some ancient language. Or at least find something to distract your thoughts.&lt;/br&gt;
[[Browse for some food for your mind|NOP]]
&lt;p&gt;[[Back|DngSY_Hall]]&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;&lt;/script&gt;</tw-passagedata><tw-passagedata pid="657" name="DngSY_Book" tags="_back_" position="850,8225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
TODO: soothe mind / learn arcana / learn language
&lt;p&gt; [[Back|_back_]] &lt;/br&gt;&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;&lt;/script&gt;</tw-passagedata><tw-passagedata pid="658" name="DngSY_Shrine" tags="" position="975,8225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
TODO: what gods?  mediation helps with? confession both to revel in your perverted thoughts?&lt;/br&gt;
On one side of the room a ornate chest is placed on a desk. It is used for [[donations|NOP]] to the community.&lt;/br&gt;
&lt;p&gt;[[Back|DngSY_Hall]]&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;&lt;/script&gt;</tw-passagedata><tw-passagedata pid="659" name="DngSY_Donation" tags="_back_" position="1100,8225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
TODO: The keepers expect that you show your dedication by offering donations.&lt;/br&gt;
Contributing something valuable might improve your standing and secure you the benevolence of fate.&lt;/br&gt;
An improper offering on the other side could have some consequences.&lt;/br&gt;
Actually, your offerings might rank: damnable unworthy disappointing bad aberrant nothing low frugal good significant high enormous&lt;/br&gt;
Would you like to [[offer|NOP]] something?&lt;/br&gt;
&lt;p&gt; [[Back|_back_]]&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;&lt;/script&gt;</tw-passagedata><tw-passagedata pid="660" name="DngSY_Lab" tags="" position="1225,8225" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
This is [[Kumalas|NOP]] Laboratory. And Kitchen. &lt;/br&gt;
As usual she is busy on some of the retorts, concentratin on reading some recipe book and stiring a pot with a spoon in her free hand.&lt;/br&gt; 
Maybe you can [[ask her|NOP]] about mixing up some potions or if she needs something.&lt;/br&gt;
&lt;p&gt;[[Back|DngSY_Hall]]&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="661" name="DngSY_Lv1" tags="" position="100,8350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;p class=&quot;tNPC2&quot;&gt;&quot;Your task is to take this glas and fill it with the water from the crystal lake and make your way back to the portal.&quot;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;Crystal lake? I dont know where that is. And where does that portal lead anyway?&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC2&quot;&gt;&quot;The portal brings you into a cave system. Just follow the lights down the tunnels until you find a cavern  where you see large blue crystals growing around an underground lake.&quot;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;And thats all? Go to the lake, fill that glas and walk back? Why does it have to be a glas, dont you have a bottle or waterskin?&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC2&quot;&gt;&quot;No, it has to be the glass. The path should be lightened with candles but sometime they just go out.&quot;&lt;/p&gt;
You grab the glas.&lt;/br&gt;
&lt;p class=&quot;tNPC2&quot;&gt;&quot;Just follow the candles, dont strive into the darker areas.&quot;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;I know, I know, pitfalls and such.&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC2&quot;&gt;&quot;Yes...and such.&quot;&lt;/p&gt;
That somehow sounds like more dangers than falling into a hole might be waiting for you.&lt;/br&gt;
&lt;p&gt; &lt;a0 onclick=&#39;window.story.state.DngSY.dngOW=false,window.story.show(&quot;DngCV_Entry&quot;);&#39;&gt;Lets go&lt;/a&gt;&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="662" name="DngSY_Lv2" tags="" position="225,8350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;p class=&quot;tNPC2&quot;&gt;&quot;Your task is to gather 3 ripe plums from the trees growing in the forest.&quot;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;Only 3? From this no one gets full.&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC2&quot;&gt;&quot;Feel free to collect more if you like.&quot;&lt;/p&gt;
Did he just snicker? 
&lt;p class=&quot;tPC&quot;&gt;&quot;Fine.&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC2&quot;&gt;&quot;Wait, Kumala asked me to give you those &quot;&lt;/p&gt; He hands you some small brown pellets.
&lt;p class=&quot;tPC&quot;&gt;&quot;And those are ?...&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC2&quot;&gt;&quot;Oh she said something about antitoxin or so. I guess its not really necessary to use them&quot;&lt;/p&gt; 
Pocketing the pills you wonder what they are good for - if they have any use at all.
&lt;p&gt; &lt;a0 onclick=&#39;window.story.state.DngSY.dngOW=false,window.gm.player.Inv.addItem(window.gm.ItemsLib.BrownPill(),2),window.story.show(&quot;DngDF_Entry&quot;);&#39;&gt;Lets go&lt;/a&gt;&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="663" name="DngSY_Lv3" tags="" position="350,8350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;p class=&quot;tNPC2&quot;&gt;&quot;As you may have seen we have a large library. Unfortunatly some books have gone missing due to some - unfortunate circumstance.&lt;/br&gt;
Your task would be to gather pages from a book called Igneum Frigus Thalamum. At least 2 pages should be somewhere in a valley.&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;Somewhere in a valley? Some more information would be helpful.&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC2&quot;&gt;&quot;Well, one seems to be used as building material for a nest. A rather large nest located near a crevice somewhere in the northern wall of the valley.&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC2&quot;&gt;&quot;The other one is stuck on the roof of a hut. That one is part of a small settlement but I dont have a clue where this settlement is.&quot;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;Its still not clear to me how to find them, but whatever....&quot;&lt;/p&gt;
....
&lt;p class=&quot;tNPC2&quot;&gt;&quot;Thats some rough territory. Take those potions, they might be handy if you get hurt&quot;&lt;/p&gt; 
&lt;p&gt; &lt;a0 onclick=&#39;window.story.state.DngSY.dngOW=false,window.gm.player.Inv.addItem(window.gm.ItemsLib.HealthPotionSmall(),3),window.story.show(&quot;DngMN_Entry&quot;);&#39;&gt;Lets go&lt;/a&gt;&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="664" name="DngSY_Lv4" tags="" position="475,8350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;p class=&quot;tNPC2&quot;&gt;&quot;I&#39;m not sure we can trust you with a job. Therefore, you will work on the farm until we decide how to proceed.&quot;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;There is a farm? &quot;&lt;/p&gt;
&lt;p class=&quot;tNPC2&quot;&gt;&quot;Yes. Where do you think all the food is coming from.&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC2&quot;&gt;&quot;Kelly is the boss there, she will explain what you have to do. I dont need to remind you that you have to earn your stay here, do I?&quot;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;No sir.&quot;&lt;/p&gt;
&lt;p&gt; &lt;a0 onclick=&#39;window.story.state.DngSY.dngOW=false,window.story.show(&quot;DngFM_Entry&quot;);&#39;&gt;Lets go&lt;/a&gt;&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="665" name="DngSY_Lv5" tags="" position="600,8350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;p class=&quot;tNPC1&quot;&gt;&quot;I need some BogBovus from the forest. Thats a kind of mushroom, bloated with a purple bulb and yellow splotches. Please be careful when you collect it.&quot;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;Are they safe? I mean they arent poisonous or something ? &quot;&lt;/p&gt;
&lt;p class=&quot;tNPC1&quot;&gt;&quot;I recommend not to get in contact with the yellow splotches or the milky sap. It doesn&#39;t kill you, but it might already be uncomfortable.&quot;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;How muh do you need?&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC1&quot;&gt;&quot;4 or 5 should be enough. Just make sure they have the right color: yellow on purple.&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC1&quot;&gt;&quot;And stay on the path. Dont wander into the muddier hollows. And stay away from the water.&quot;&lt;/p&gt;
&lt;p&gt;You wonder what water she means, last time you didnt see any water there. &lt;/p&gt;
&lt;p&gt; &lt;a0 onclick=&#39;window.story.state.DngSY.dngOW=false,window.story.show(&quot;DngLB_Entry&quot;);&#39;&gt;Lets go&lt;/a&gt;&lt;/p&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="666" name="DngSY_Lv6" tags="" position="725,8350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;p class=&quot;tNPC2&quot;&gt;&quot;According to the information we have gathered from the pages, the &quot;Ring of Burden&quot; should be located in an ancient temple.&lt;/br&gt;
Most likely it is in the central chamber.&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&#39;What exactly is this ring good for?&#39;&lt;/p&gt;
&lt;p class=&quot;tNPC2&quot;&gt;&quot;Right now I dont know. But I think it would be give us an advantage if we get it in our hand before someone else does.&quot;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;And what kind of temple is that? Its not some kind bloodbowl of the crazy maneaters, or?&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC2&quot;&gt;&quot;I dont think there is anyone. Maybe some guard.&quot;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;You mean armor clad, bored men with spikey halberds?&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC2&quot;&gt;&quot;Not exactly. There was a hint about some minotaur roaming the temple.&quot;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;A what! You send me into a cursed ancient temple guarded by some bloody minotaur!&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC2&quot;&gt;&quot;Not bloody. There was just a sentence of a &#39;minotaur guardian made of bronze&#39;. I assume its just a statue.&quot;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&quot;Oh, you mean those decorations I also saw in the temple at home.&quot;&lt;/p&gt;
&lt;p class=&quot;tNPC2&quot;&gt;&quot;Take this. Those are some flares you can use to lighten your path. They might also scare of or divert anything that prefers darkness.&quot;&lt;/p&gt;
He hands you a couple thumb-thick rolls. They are made of cardboard and a handspan long.&lt;/br&gt;
&lt;p class=&quot;tNPC2&quot;&gt;&quot;They ignite if you undo the cap. They even burn in water.&quot;&lt;/p&gt;
&lt;p class=&quot;tPC&quot;&gt;&#39;Great, a stick and some flares. What else would I need to handle a minotaur.&#39;&lt;/p&gt;
You mumble before &lt;a0 onclick=&#39;window.story.state.DngSY.dngOW=false,window.story.show(&quot;DngAT_Entry&quot;);&#39;&gt;stepping&lt;/a&gt; into the portal.
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="667" name="SC_BarbarianMeetup" tags="_nosave_" position="850,8350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;!--todo--&gt;
&quot;Hey you, what are you doing here ?&quot;&lt;/br&gt;
- you have to prove yourself to gain their trust&lt;/br&gt;
- they might ignore if you arent a threat&lt;/br&gt;
- they might attack if you attacked them before  &lt;/br&gt;
- if you have high trust, they might share a meal, a drink and even a &quot;good time&quot; with you&lt;/br&gt;
- they might take advantage of you if you dont have a good standing or sense your horniness&lt;/br&gt;
&lt;div&gt; &lt;a0 onclick=&#39;window.gm.dng.resumeRoom();&#39;&gt;Leave&lt;/a&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;&lt;/script&gt;</tw-passagedata><tw-passagedata pid="668" name="Campus" tags="" position="825,825" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
&lt;%if(!window.gm.quests.hasActiveQuest(&quot;qFindAJob&quot;)){  %&gt;
    As you arrive at the campus you check your purse.&lt;/br&gt;
    &#39;I&#39;m running out of money soon if I dont find some job or other possibilities to earn some. &#39;&lt;/br&gt;
    &lt;a0 onclick=&#39;window.gm.quests.addQuest(&quot;qFindAJob&quot;,1); window.story.show(window.passage.name);&#39;&gt;Mental note to yourself&lt;/a&gt;&lt;/br&gt;
&lt;%} else { %&gt;
    This is the campus of the Institute of Technology and Development.&lt;/br&gt;
    A lot of people are hurrying along or stand by in idle chatter.&lt;/br&gt;
    &lt;!--todo--&gt; In den größeren Gebäuden sind die Vorlesungsräume und Labore der Fachabteilungen untergebracht. &lt;/br&gt;
    Natürlich gibt es eine Mensa und auch ein Archiv bzw. Library. In einem Hochhaus ist die Verwaltung und sonstige Dienste für die Studenten untergebracht.  &lt;/br&gt;
    &lt;/br&gt;
    &lt;a0 onclick=&#39;window.story.show(&quot;attend lecture&quot;)&#39;&gt;Attend a lecture&lt;/a&gt;&lt;/br&gt;
    &lt;div&gt;Where would you like to go?&lt;/br&gt;
    [[Electrical &amp; Mechanical Engineering|NOP]]  [Chemistry &amp; Process Engineering] [Micro-Power &amp; Nano-Engineering] [[Dining Hall]]  [[ITD Office]]  Library &lt;/br&gt;
    [[Into the city]]&lt;/br&gt;&lt;/div&gt; 
&lt;%}%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="669" name="ITD Office" tags="" position="1100,8350" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
This is the office-building of the Institute.&lt;/br&gt;
The [[counsellor|NOP]] might be available to give you some guidance about institutional affairs.&lt;/br&gt;
Here in the lobby of the building is also a [[blackboard]]. Maybe you can find some job offers there or informations about upcoming events. &lt;/br&gt;
&lt;div&gt;&lt;/br&gt;
[[Campus]]&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="670" name="Dining Hall" tags="" position="1225,8350" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
Die Mensa ist wahrscheinlich das beliebteste Gebäude des Campus bei den Studenten; es gibt was zu essen und an kann miteinander quatschen.&lt;/br&gt;
Das Essen ist vielleicht nicht gerade das beste auf der Welt aber dafür ist es recht günstig. Hast du Hunger?&lt;/br&gt;
&lt;div&gt;&lt;/br&gt;
[[Campus]]&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="671" name="blackboard" tags="_back_" position="100,8475" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
&#39;Lets see if there is anything interesting.&#39;&lt;/br&gt;
&lt;%if(window.gm.quests.hasActiveQuest(&quot;qFindAJob&quot;,1)){%&gt;
There is an announce from Harcon Health Inc. for a [[job|Harcon_Logistic_Ad]] in logistics-department.&lt;/br&gt;
&lt;%}%&gt;
&lt;div&gt;&lt;/br&gt;
[[Back|_back_]]&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="672" name="attend lecture" tags="" position="225,8475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
todo You attend to lectures all morning.&lt;/br&gt;
&lt;div&gt;&lt;/br&gt;
&lt;a0 onclick=&#39;work()&#39;&gt;You are done for today&lt;/a&gt;&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
function work(){
    window.gm.player.Stats.increment(&quot;energy&quot;,-40);
    window.gm.forwardTime(1300);
    window.story.show(&quot;Campus&quot;);
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="673" name="Harcon_Logistic_Ad" tags="_back_" position="350,8475" size="100,100">&lt;section&gt;&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
The typewritten note advertises a part-time position in the logistics department.&lt;/br&gt;
&lt;p class=&quot;tPC&quot;&gt;&#39;Logistic doesnt sound that interesting and I doubt that position is targeted to an engineer. But maybe I should show up there in person and see what it is about.&#39;&lt;/p&gt;&lt;/br&gt;
The adress points to be somehwere around downtonw.&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.quests.forceQuestMilestone(&quot;qFindAJob&quot;,100,1); window.story.show(&quot;ITD Office&quot;);&#39;&gt;Note down the adress&lt;/a&gt;&lt;/br&gt;
&lt;div&gt;&lt;/br&gt;
[[Back|_back_]]&lt;/br&gt;&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="674" name="Harcon_Health" tags="" position="475,8475" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
&lt;%if(window.gm.quests.hasActiveQuest(&quot;qFindAJob&quot;,100)){  %&gt;
    Harcon Health Inc. scheint eine Fabrik oder Lagerhalle zu sein die wie so üblich eingezäunt ist. Du läufst also drumherum bis du ein (geschlossenes) Eingangstor findest.&lt;/br&gt;
    Gleich daneben befindet sich ein Gebäude in Form eines kleinen Glaswürfels das wohl den Torwächter beherbergt.&lt;/br&gt;
    &quot;Hallo?.. uhm Ich bin wegen der Stellenazeige hier.&quot;&lt;/br&gt;
    &quot;Stellenanzeige?...gehts etwas genauer...haben Sie einen Termin?&quot;&lt;/br&gt;
    Harcon Health Inc. seems to be a factory or warehouse that is fenced in as usual. So you walk around it until you find a (closed) entrance gate.&lt;/br&gt;
    Right next to it is a building in the form of a small glas cube that probably houses the gatekeeper.&lt;/br&gt;
    &lt;p class=&quot;tPC&quot;&gt;&quot;Hello? ... I am here because of the job offer.&quot;&lt;/p&gt;&lt;/br&gt;
    &quot;Job offer? Well, can you give some more details? Do you have an appointment?&quot;&lt;/br&gt;
    &lt;div id=&#39;select1&#39; &gt;
    &lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;)&#39;&gt;&quot;Unfortunatly not&quot;&lt;/a&gt;
    &lt;/div&gt;
    &lt;div id=&#39;choice1a&#39; hidden&gt;&lt;/br&gt;
    &lt;p class=&quot;tPC&quot;&gt;No. I just saw that ad on the universitys blackboard about a position in your logistics department. So I wanted to show up as soon as possible to see what it is about... &lt;/p&gt;
    The guard frowns as he hears your rumblings. Clearly he doesnt understand how anyone would bother him WITHOUT having setup an appointment.&lt;/br&gt;
    Then he grunt&#39;s because another huge load seems to be put onto his shoulders. He thoughtfully picks up the phone and calls someone.&lt;/br&gt;
    &quot;Yes, hello Elfred this is Frank from the gate. Here is a young man that asks about a position in your department do you know that..&quot;&lt;/br&gt;
    ...&lt;/br&gt;
    &quot;No, he says he is from university and saw an add there.....no, he hasnt bothered for an appointment...&quot;&lt;/br&gt;
    You cringe internally when he says &#39;bothered&#39;. Somehow you know it was lazzy to just come here without announcing yourself before.&lt;/br&gt;
    The guard places the phone back on its holder and looks at you.&lt;/br&gt;
    &quot;So listen, Mr.Erichson , a groupleader from logistics will speak to you. I will let you in. But just that you know there are cameras all over the place and I will see if you try anything stupid.&quot;&lt;/br&gt;
    &lt;p class=&quot;tPC&quot;&gt;&quot;Thank you..of course I will behave myself. So where do I need to go.&quot;&lt;/p&gt;
    &quot;That door other there&quot; he point at a metal door next to a loading ramp &quot;and just right through. There are some office-doors, one of them has his name on it - Erichson.&quot;&lt;/br&gt;
    After a moment where you try to memorize the name he asks mockingly &quot;You can read?&quot;&lt;/br&gt;
    &lt;span class=&quot;tPC&quot;&gt;&#39;Of course I an read you asshole, I&#39;m from university&#39;&lt;/span&gt; - well thats what came into your mind but you just say &lt;span class=&quot;tPC&quot;&gt;&quot;Sure&quot;&lt;/span&gt;&lt;/br&gt;
    He buzzes you through the revolving door adjoining the car gate and you walk to Mr. Erichsons office.&lt;/br&gt;
    &lt;div&gt;&lt;/br&gt;[[Go to logistics|Harcon_Logistic_Intro]]&lt;/br&gt;&lt;/div&gt;
    &lt;/div&gt; 
&lt;% } else {%&gt;
    This seems to be some kind of factory. You have no business here.&lt;/br&gt;
    &lt;div&gt;&lt;/br&gt;[[Downtown]]&lt;/br&gt;&lt;/div&gt;
&lt;%}%&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="675" name="Harcon_Logistic_Intro" tags="" position="600,8475" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
...!--todo--

&quot;Actually Carl needs only some help here and there, so this is only a parttime-job.&quot;&lt;/br&gt;
&quot;If you work at least 2 shifts a week here, you will get 25$ the shift every week.&quot;&lt;/br&gt;
&quot;So, do you want the job?&quot; he looks at you.&lt;/br&gt;
&lt;div id=&#39;select1&#39; &gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1a&quot;, function(){window.gm.quests.forceQuestMilestone(&quot;qFindAJob&quot;,200,100);})&#39;&gt;&quot;Yes, of course.&quot;&lt;/a&gt;
&lt;a0 onclick=&#39;window.gm.printTalkLink(&quot;div#select1&quot;,&quot;div#choice1b&quot;)&#39;&gt;&quot;I have to think about it&quot;&lt;/a&gt;
&lt;/div&gt;
&lt;div id=&#39;choice1a&#39; hidden&gt;&lt;/br&gt;
    You shake hands to make the deal and you are quite proud of yourself that you got your first employment in a smooth move.&lt;/br&gt;
    &quot;Please remember to be here on time !&quot; are the final words Mr.Erichson as he sees you off.&lt;/br&gt; 
    [[Next|Downtown]]&lt;/br&gt; 
&lt;/div&gt;
&lt;div id=&#39;choice1b&#39; hidden&gt;&lt;/br&gt;
    Mr. Erichson looks quite disappointed.  &lt;/br&gt;
    [[Next|Downtown]]&lt;/br&gt; 
&lt;/div&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="676" name="Harcon_work" tags="" position="725,8475" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;)%&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
&lt;%if(window.gm.quests.hasActiveQuest(&quot;qFindAJob&quot;,200)){  %&gt;
    --todo--  You work your first shift and get stuff explained.&lt;/br&gt;
&lt;% } else {%&gt;
    --todo--Work a shift.&lt;/br&gt;
&lt;%}%&gt;
&lt;a0 onclick=&#39;work()&#39;&gt;Finish the shift&lt;/a&gt;&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
function work(){
    window.gm.addTime(4*60);
    window.gm.player.Stats.increment(&quot;energy&quot;,-40);
    window.gm.quests.getQuestState(&quot;qFindAJob&quot;).flags+=1;
    window.story.show(&quot;Downtown&quot;);
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="677" name="Mall 0F" tags="" position="1250,850" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
You are actually at [[&lt;%=window.gm.player.location%&gt;]].&lt;/br&gt;
As you wander around you find a [[Bookstore]], a fine grocerie , [[Boots and Shoes]].&lt;/br&gt;
If you need some tools for your hobby you should check the [[craft store]].&lt;/br&gt;
There are also [[Restrooms]].&lt;/br&gt;
&lt;div id=&quot;choice&quot;&gt;&lt;/div&gt;&lt;/br&gt;&lt;/br&gt;   &lt;!--display buy message--&gt;
&lt;div id=&quot;panel&quot;&gt;&lt;/div&gt;&lt;/br&gt;&lt;/br&gt;    &lt;!--display wares list--&gt;
Where would you like to go from here?&lt;/br&gt;
[[Mall 1F|Mall Floor 1]]
[[Mall -1F|Mall Floor -1]]
[[Exit|Into the city]]
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;
&lt;script&gt;
window.gm.shop.findWaresToBuy(&quot;Mall:GeneralStore&quot;);
renderToSelector(&quot;#panel&quot;, &quot;listbuy&quot;); 
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="678" name="Mall Floor 1" tags="" position="1125,850" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
&lt;%window.gm.printShopBuyEntry(&quot;Lube&quot;,4,cbCanBuy=(function(itemid){return window.gm.cbCanBuyPerverse(itemid,15,10)}),cbPostBuy=(function(itemid){window.gm.defaultPostBuy(itemid,15)}))%&gt;
&lt;%window.gm.printShopBuyEntry(&quot;Batteries&quot;,40,cbCanBuy=(function(itemid){return window.gm.defaultCanBuy(itemid,6)}),cbPostBuy=(function(itemid){window.gm.defaultPostBuy(itemid,6)}))%&gt;
You are actually at [[&lt;%=window.gm.player.location%&gt;]].&lt;/br&gt;
Several snack bars and smaller shops are cirling around the wall side of the mall.&lt;/br&gt; 
One of them is [[Alice treasures]], a place where women can buy more private cloths.&lt;/br&gt;
In a more shady corner you find a shop whose windows are just coverd with dark red and black foils. 
Its name is &#39;Adult books and tools&#39; and there is an &quot;adults only&quot; sign at the entrance.&lt;/br&gt;
if(window.gm.player.Stats.get(&#39;corruption&#39;).value&lt;=10){%&gt;
&lt;p class=&#39;tPC&#39;&gt;No way I&#39;m going in to that smut-shop. Only perverts do that. &lt;/p&gt;
&lt;%} else {%&gt; [[Adult books and tools]] &lt;/br&gt; &lt;%} %&gt;
Where would you like to go from here?&lt;/br&gt;
[[Mall 0F|Mall 0F]]
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="679" name="Mall Floor -1" tags="" position="1000,825" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
You are actually at [[&lt;%=window.gm.player.location%&gt;]].&lt;/br&gt;
This level of the mall seems to be reserved for the less fancy business. &lt;/br&gt; 
Most of the space is occupied by the usual [[electronics store]] and a [[food store]].
Where would you like to go from here?&lt;/br&gt;
[[Mall 0F|Mall 0F]]
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="680" name="Adult books and tools" tags="" position="1025,650" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
You are actually at [[&lt;%=window.gm.player.location%&gt;]].&lt;/br&gt;
Various Items are on sale: &lt;/br&gt;
&lt;div id=&quot;choice&quot;&gt;&lt;/div&gt;
&lt;a href=&quot;javascript:void(0)&quot; id=&quot;lube&quot; onclick=&#39;choice(this,&quot;div#choice&quot;)&#39;&gt;Lube&lt;/a&gt;&lt;/br&gt;
if(window.gm.player.Stats.get(&#39;corruption&#39;).value&lt;=15){%&gt;
No way I&#39;m going in to that smut-shop. Only perverts do that. &lt;/br&gt;
&lt;%} else {%&gt;
&lt;%} %&gt;
Where would you like to go from here?&lt;/br&gt;
[[Mall 0F|Mall 0F]]
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="681" name="Buy" tags="_back_" position="850,350" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;

[[Back|_back_]]&lt;/br&gt;
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="682" name="Mall 0F (postapocalypse)" tags="" position="225,8600" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
You are actually at [[&lt;%=window.gm.player.location%&gt;]].&lt;/br&gt;
You could try to dig through the rubble in the demolished shops. But you doubt that there is much useful left worth to [[scavenge|Mall_scavenge]]. &lt;/br&gt;
The door to the [[Restrooms]] was torn by brute force.&lt;/br&gt;

Where would you like to go from here?&lt;/br&gt;
[[Mall 1F|Mall Floor 1 (postapocalypse)]]
The stairway to the lower floor is blocked by parts of the building that fell down from top. But there might be other options to get there. &lt;/br&gt; 
[[Exit|Into the city]]
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="683" name="Mall Floor 1 (postapocalypse)" tags="" position="350,8600" size="100,100">&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;

Where would you like to go from here?&lt;/br&gt;
[[Mall 0F|Mall 0F]]
&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;

[[Mall_scavenge]]
&lt;section&gt; 
&lt;aside id=&quot;sidebar&quot;&gt;&lt;/aside&gt;&lt;article&gt;&lt;%=window.story.render(&quot;CenterDialogs&quot;) %&gt;
&lt;%window.gm.player.location=window.passage.name;%&gt;
You are on the hunt for useful resources as...
&lt;a href=&quot;javascript:void(0)&quot; onclick=&#39;window.gm.encounters.mole(window.gm.player.location);&#39;&gt;Next&lt;/a&gt; &lt;/br&gt;

&lt;/article&gt;&lt;article id=&quot;LogPanel&quot;&gt;&lt;/article&gt;&lt;/section&gt;</tw-passagedata><tw-passagedata pid="684" name="skCooking" tags="" position="825,625" size="100,100">You can create tasty meals from basic ingredients. No need to rely on fastfood.
[[Back|&lt;%=window.gm.player.location%&gt;]]</tw-passagedata><tw-passagedata pid="685" name="skSporty" tags="" position="725,625" size="100,100">You like to do sports.
[[Back|&lt;%=window.gm.player.location%&gt;]]</tw-passagedata><tw-passagedata pid="686" name="skTechy" tags="" position="825,525" size="100,100">Tinkering and repairing gadgets is your thing.
[[Back|&lt;%=window.gm.player.location%&gt;]]</tw-passagedata><tw-passagedata pid="687" name="skMoneymaker" tags="" position="725,525" size="100,100">You often find ways to increase your profit a little bit.
[[Back|&lt;%=window.gm.player.location%&gt;]]</tw-passagedata><tw-passagedata pid="688" name="Start" tags="" position="975,8600" size="100,100">Select a Link:
&lt;ul&gt;
    &lt;li&gt;[[_SuperSimpleStory_]]&lt;/li&gt;
	&lt;li&gt;[[_ImagesAndOtherMedia_]]&lt;/li&gt;
    &lt;li&gt;[[_VariablesAndScript_]]&lt;/li&gt;
	&lt;li&gt;[[_ControlElements_]]&lt;/li&gt;
    &lt;li&gt;[[_Inventory_]]&lt;/li&gt;
    &lt;li&gt;[[_SaveAndRestore_]]&lt;/li&gt;
    &lt;li&gt;[[StartPage]]&lt;/li&gt;
&lt;/ul&gt;</tw-passagedata><tw-passagedata pid="689" name="NewGamePlus" tags="" position="1100,8600" size="100,100">You finished the game in some way but maybe you have missed something. &lt;/br&gt;
Would you like to start a new game while taking some of your equipment/skills with you?&lt;/br&gt;
&lt;a0 onclick=&#39;window.gm.newGamePlus()&#39;&gt;Start new game plus&lt;/a&gt;&lt;/br&gt;</tw-passagedata><tw-passagedata pid="690" name="TowerOfKinks" tags="" position="1225,8600" size="100,100">ClitPiercing of Stamina

resistance to   poisoned air, slime, cold

reduce energy drain of 2 items by 1
reduce hunger by 2 but increases thirst by 1

amplifies all items with cold resistance by 33%

reduces mallus-effects from items on legs by 25% 

improves charisma by 2

improves energy-regeneration by 2/h

for each piercing, add 2 to energy-regeneration

improves appearane to bondage-inclined foes but induces bondage-fetish

slowly increaes milk-fetish when worn visible

increases relation to lupines by 1

increases chance to sneak around an enemy 

increases chance of valuables in loot

increases chance of items with stronger effects (good or bad)

requires masochism-fetish of 10

requires 1 energy/h to work

trader to buy tools, items and food
librarian to identify hidden item-enchantments or remove curse
artesan to unlock items, improve items, repair items
medic to remove parasites and addiction, create potions
campfire to rest, fasttravel, storage-chest

every third dungeon is handdrawn and has boss
other dungeons are randomized with same theme like boss-level

you can revisit boss-levels; foe-respawn after 48h

castle:
    archer, knight, nun
    boss: gryphon

desert: hot, dry, quicksand, sandstorm
    naga, cheetah, lizardman
    boss: 

forest: 
    dryad, hunter, wolf
    boss: witch

caves: cold, wet, slippery, dark
    slime, imp, gnoll

jungle: hot, humid, poisonous
    panther, giant-snake, raptor

laboratory: chemicals
    tentacle, golem, alchemmist

pyramids: chaste
    priest, acolythe, anubis, scarab

underworld:
    succubus, hellhound,</tw-passagedata><tw-passagedata pid="691" name="SucubusTrade" tags="" position="100,8725" size="100,100">&quot;I could help you and increase the size of your load.&quot;
&quot;Whats the catch?&quot;
Your apple-sized gonads are heavy with spunk. Staying blueballed like this might set you at risk to give in to the next person offering you a good fuck.

Even while they are full to the brim, your sperm glands still run their curse, adding more spunk to your swollen scrotum. Your balls have enlarged again and their size and wheight now matches grapefruits.
How much further ould they grow?

After delivering quite a load, your gonads can ease up and shrink back a bit.

Try as you might, but masturbating might get you riled up but you ant sent yourself over the edge. You need a real fuck to find release.</tw-passagedata></tw-storydata>
		<script>
		(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";window.either=function(){for(var n=[],t=0;t<arguments.length;t++)if(arguments[t]instanceof Array)for(var r=0;r<arguments[t].length;r++)n.push(arguments[t][r]);else n.push(arguments[t]);return n[_.random(n.length-1)]},window.hasVisited=function(){var n=null;if(1===arguments.length)return null!=(n=window.story.passage(arguments[0]))&&window.story.history.includes(n.id);for(var t=0;t<arguments.length;t++)if(null===(n=window.story.passage(arguments[t]))||!1===window.story.history.includes(n.id))return!1;return!0},window.visited=function(){for(var n=[],t=[],r=0;r<arguments.length;r++){var e=window.story.passage(arguments[r]);null!==e&&(t=window.story.history.filter(function(n){return n===e.id})),n.push(t.length)}return Math.min.apply(Math,n)},window.renderToSelector=function(n,t){var r=window.story.passage(t);null!==r&&$(n).html(r.render())},window.getStyles=function(){return $.when.apply($,$.map(arguments,function(n){return $.get(n,function(n){$("<style>"+n+"</style>").appendTo("head")})}))};

},{}],2:[function(require,module,exports){
"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var a=0;a<r.length;a++){var t=r[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function _createClass(e,r,a){return r&&_defineProperties(e.prototype,r),a&&_defineProperties(e,a),e}var Passage=function(){function e(r,a,t,s){if(_classCallCheck(this,e),"undefined"==typeof $||null===$)throw new Error("Global '$' not defined!");if("undefined"==typeof _||null===_)throw new Error("Global '_' not defined!");if("undefined"==typeof marked||null===marked)throw new Error("Global 'marked' not defined!");this.id=r||1,this.name=a||"Default",this.tags=t||[],this.source=_.unescape(s)}return _createClass(e,[{key:"render",value:function(e){null==e&&(e=this.source);var r="";try{r=_.template(e)({s:window.story.state,$:$})}catch(e){$.event.trigger("sm.story.error",[e,"Passage.render() using _.template()"])}function a(e){for(var r="",a=0;"-"===e[a]||"0"===e[a];a++)switch(e[a]){case"-":r+='style="display:none" ';break;case"0":r+='href="javascript:void(0)" '}for(var t=[],s=null,n=/([#\.])([^#\.]+)/g,i=n.exec(e);null!==i;){switch(i[1]){case"#":s=i[2];break;case".":t.push(i[2])}i=n.exec(e)}return null!==s&&(r+='id="'+s+'" '),t.length>0&&(r+='class="'+t.join(" ")+'"'),r.trim()}r=(r=(r=r.replace(/<([a-z]+)([\.#\-0].*?)(?=[\s>])/gi,function(e,r,t){return"<"+r+" "+a(t)})).replace(/\[\[(.*?)\]\]\{(.*?)\}/g,function(e,r,t){var s=r,n=r.indexOf("|");if(-1!==n)s=r.substr(0,n),r=r.substr(n+1);else{var i=r.indexOf("->");if(-1!==i)s=r.substr(0,i),r=r.substr(i+2);else{var o=r.indexOf("<-");-1!==o&&(s=r.substr(o+2),r=r.substr(0,o))}}return null!==window.story.passage(r)?'<a href="javascript:void(0)" data-passage="'+r+'" '+a(t)+">"+s+"</a>":'<a href="javascript:void(0)" data-passage="'+r+'" '+a(t)+'" style="text-decoration: line-through double red;">!!!'+s+"!!!</a>"})).replace(/\[\[(.*?)\]\]/g,function(e,r){var a=r,t=r.indexOf("|");if(-1!==t)a=r.substr(0,t),r=r.substr(t+1);else{var s=r.indexOf("->");if(-1!==s)a=r.substr(0,s),r=r.substr(s+2);else{var n=r.indexOf("<-");-1!==n&&(a=r.substr(n+2),r=r.substr(0,n))}}return null!==window.story.passage(r)?'<a href="javascript:void(0)" data-passage="'+r+'">'+a+"</a>":'<a href="javascript:void(0)" data-passage="'+r+'" style="text-decoration: line-through double red;">!!!'+a+"!!!</a>"});var t=new marked.Renderer;t.code=function(e){return e},marked.setOptions({smartypants:!0,renderer:t});var s=marked(r);return!r.endsWith("</p>\n")&&s.endsWith("</p>\n")&&(s=s.replace(/^<p>|<\/p>$|<\/p>\n$/g,"")),s}}]),e}();module.exports=Passage;

},{}],3:[function(require,module,exports){
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var s=0;s<e.length;s++){var r=e[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _createClass(t,e,s){return e&&_defineProperties(t.prototype,e),s&&_defineProperties(t,s),t}var LZString=require("lz-string"),Passage=require("./Passage.js"),Story=function(){function Story(t){var e=this;if(_classCallCheck(this,Story),"undefined"==typeof $||null===$)throw new Error("Global $ not defined!");if("undefined"==typeof _||null===_)throw new Error("Global _ not defined!");this.dataEl=t,this.name=this.dataEl.attr("name"),this.startPassage=parseInt(this.dataEl.attr("startnode")),this.creator=this.dataEl.attr("creator"),this.creatorVersion=this.dataEl.attr("creator-version"),this.history=[],this.state={},this.checkpointName="",this.ignoreErrors=!1,this.errorMessage="",this.atCheckpoint=!1,this.passages=[];var s=[];t.children("tw-passagedata").each(function(){var t=$(this),e=parseInt(t.attr("pid")),r=t.attr("tags");s[e]=new Passage(e,t.attr("name"),""!==r&&void 0!==r?r.split(" "):[],t.html())}),this.passages=s,this.userScripts=[],$('*[type="text/twine-javascript"]').each(function(t,s){e.userScripts.push($(s).html())}),this.userStyles=[],$('*[type="text/twine-css"]').each(function(t,s){e.userStyles.push($(s).html())}),window.onerror=function(t,e,s,r,a){$.event.trigger("sm.story.error",[a,"Browser"])},$(window).on("sm.story.error",function(t,s,r){e.errorMessage="In "+r+": "+s.name+": "+s.stack,!1===e.ignoreErrors&&$("tw-story").html(e.errorMessage)})}return _createClass(Story,[{key:"start",value:function start(el){var _this2=this;this.$el=$(el),this.$passageEl=$('<tw-passage class="passage" aria-live="polite"></tw-passage>'),this.$el.append(this.$passageEl),$(window).on("popstate",function(t){var e=t.originalEvent.state;e?(_this2.state=e.state,_this2.history=e.history,_this2.checkpointName=e.checkpointName,_this2.show(_this2.history[_this2.history.length-1],!0)):_this2.history.length>1&&(_this2.state={},_this2.history=[],_this2.checkpointName="",_this2.show(_this2.startPassage,!0))}),$(window).on("hashchange",function(){_this2.restore(window.location.hash.replace("#",""))}),this.userStyles.forEach(function(t){_this2.$el.append("<style>"+t+"</style>")}),this.userScripts.forEach(function(script){try{eval(script)}catch(t){$.event.trigger("sm.story.error",[t,"Story JavaScript Eval()"])}}),this.$el.on("click","a[data-passage]",function(t){_this2.show(_.unescape($(t.target).closest("[data-passage]").data("passage")))}),$.event.trigger("sm.story.started",{story:this}),""!==window.location.hash&&this.restore(window.location.hash.replace("#",""))||(this.show(this.startPassage),this.atCheckpoint=!0)}},{key:"passage",value:function(t){var e=null;if(_.isNumber(t))t<this.passages.length&&(e=this.passages[t]);else if(_.isString(t)){var s=this.passages.filter(function(e){return e.name===t});0!==s.length&&(e=s[0])}return e}},{key:"show",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=this.passage(t);if(null===s)throw new Error('There is no passage with the ID or name "'+t+'"');if(this.$passageEl.trigger("sm.passage.hidden",{passage:window.passage}),this.$passageEl.trigger("sm.passage.showing",{passage:s}),!1===e){this.history.push(s.id);try{this.atCheckpoint?window.history.pushState({state:this.state,history:this.history,checkpointName:this.checkpointName},"",""):window.history.replaceState({state:this.state,history:this.history,checkpointName:this.checkpointName},"","")}catch(t){$.event.trigger("sm.checkpoint.failed",{error:t})}$.event.trigger("sm.checkpoint.added",{name:t})}window.passage=s,this.atCheckpoint=!1;try{this.$passageEl.html(s.render())}catch(t){$.event.trigger("sm.story.error",[t,"Story.show()"])}this.$passageEl.trigger("sm.passage.shown",{passage:s})}},{key:"render",value:function(t){var e=this.passage(t);if(!e)throw new Error("There is no passage with the ID or name "+t);return e.render()}},{key:"checkpoint",value:function(t){void 0!==t?(document.title=this.name+": "+t,this.checkpointName=t):this.checkpointName="",this.atCheckpoint=!0,$.event.trigger("sm.checkpoint.adding",{name:t})}},{key:"save",value:function(t){window.location.hash=t,$.event.trigger("sm.story.saved")}},{key:"saveHash",value:function(){return LZString.compressToBase64(JSON.stringify({state:this.state,history:this.history,checkpointName:this.checkpointName}))}},{key:"restore",value:function(t){try{var e=JSON.parse(LZString.decompressFromBase64(t));this.state=e.state,this.history=e.history,this.checkpointName=e.checkpointName,this.show(this.history[this.history.length-1],!0)}catch(t){return $.event.trigger("sm.restore.failed",{error:t}),!1}return $.event.trigger("sm.restore.success"),!0}}]),Story}();module.exports=Story;

},{"./Passage.js":2,"lz-string":312}],4:[function(require,module,exports){
"use strict";var polyfill=require("@babel/polyfill"),$=window.$=window.jQuery=require("jquery"),_=window._=require("underscore"),marked=window.marked=require("marked"),Story=window.Story=require("./Story.js"),Passage=window.Passage=require("./Passage.js");require("./Misc.js"),$(function(){window.story=new Story($("tw-storydata")),window.story.start($("tw-story"))});

},{"./Misc.js":1,"./Passage.js":2,"./Story.js":3,"@babel/polyfill":5,"jquery":311,"marked":313,"underscore":315}],5:[function(require,module,exports){
"use strict";require("./noConflict");var _global=_interopRequireDefault(require("core-js/library/fn/global"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}_global.default._babelPolyfill&&"undefined"!=typeof console&&console.warn&&console.warn("@babel/polyfill is loaded more than once on this page. This is probably not desirable/intended and may have consequences if different versions of the polyfills are applied sequentially. If you do need to load the polyfill more than once, use @babel/polyfill/noConflict instead to bypass the warning."),_global.default._babelPolyfill=!0;

},{"./noConflict":6,"core-js/library/fn/global":19}],6:[function(require,module,exports){
"use strict";require("core-js/es6"),require("core-js/fn/array/includes"),require("core-js/fn/array/flat-map"),require("core-js/fn/string/pad-start"),require("core-js/fn/string/pad-end"),require("core-js/fn/string/trim-start"),require("core-js/fn/string/trim-end"),require("core-js/fn/symbol/async-iterator"),require("core-js/fn/object/get-own-property-descriptors"),require("core-js/fn/object/values"),require("core-js/fn/object/entries"),require("core-js/fn/promise/finally"),require("core-js/web"),require("regenerator-runtime/runtime");

},{"core-js/es6":7,"core-js/fn/array/flat-map":8,"core-js/fn/array/includes":9,"core-js/fn/object/entries":10,"core-js/fn/object/get-own-property-descriptors":11,"core-js/fn/object/values":12,"core-js/fn/promise/finally":13,"core-js/fn/string/pad-end":14,"core-js/fn/string/pad-start":15,"core-js/fn/string/trim-end":16,"core-js/fn/string/trim-start":17,"core-js/fn/symbol/async-iterator":18,"core-js/web":310,"regenerator-runtime/runtime":314}],7:[function(require,module,exports){
require("../modules/es6.symbol"),require("../modules/es6.object.create"),require("../modules/es6.object.define-property"),require("../modules/es6.object.define-properties"),require("../modules/es6.object.get-own-property-descriptor"),require("../modules/es6.object.get-prototype-of"),require("../modules/es6.object.keys"),require("../modules/es6.object.get-own-property-names"),require("../modules/es6.object.freeze"),require("../modules/es6.object.seal"),require("../modules/es6.object.prevent-extensions"),require("../modules/es6.object.is-frozen"),require("../modules/es6.object.is-sealed"),require("../modules/es6.object.is-extensible"),require("../modules/es6.object.assign"),require("../modules/es6.object.is"),require("../modules/es6.object.set-prototype-of"),require("../modules/es6.object.to-string"),require("../modules/es6.function.bind"),require("../modules/es6.function.name"),require("../modules/es6.function.has-instance"),require("../modules/es6.parse-int"),require("../modules/es6.parse-float"),require("../modules/es6.number.constructor"),require("../modules/es6.number.to-fixed"),require("../modules/es6.number.to-precision"),require("../modules/es6.number.epsilon"),require("../modules/es6.number.is-finite"),require("../modules/es6.number.is-integer"),require("../modules/es6.number.is-nan"),require("../modules/es6.number.is-safe-integer"),require("../modules/es6.number.max-safe-integer"),require("../modules/es6.number.min-safe-integer"),require("../modules/es6.number.parse-float"),require("../modules/es6.number.parse-int"),require("../modules/es6.math.acosh"),require("../modules/es6.math.asinh"),require("../modules/es6.math.atanh"),require("../modules/es6.math.cbrt"),require("../modules/es6.math.clz32"),require("../modules/es6.math.cosh"),require("../modules/es6.math.expm1"),require("../modules/es6.math.fround"),require("../modules/es6.math.hypot"),require("../modules/es6.math.imul"),require("../modules/es6.math.log10"),require("../modules/es6.math.log1p"),require("../modules/es6.math.log2"),require("../modules/es6.math.sign"),require("../modules/es6.math.sinh"),require("../modules/es6.math.tanh"),require("../modules/es6.math.trunc"),require("../modules/es6.string.from-code-point"),require("../modules/es6.string.raw"),require("../modules/es6.string.trim"),require("../modules/es6.string.iterator"),require("../modules/es6.string.code-point-at"),require("../modules/es6.string.ends-with"),require("../modules/es6.string.includes"),require("../modules/es6.string.repeat"),require("../modules/es6.string.starts-with"),require("../modules/es6.string.anchor"),require("../modules/es6.string.big"),require("../modules/es6.string.blink"),require("../modules/es6.string.bold"),require("../modules/es6.string.fixed"),require("../modules/es6.string.fontcolor"),require("../modules/es6.string.fontsize"),require("../modules/es6.string.italics"),require("../modules/es6.string.link"),require("../modules/es6.string.small"),require("../modules/es6.string.strike"),require("../modules/es6.string.sub"),require("../modules/es6.string.sup"),require("../modules/es6.date.now"),require("../modules/es6.date.to-json"),require("../modules/es6.date.to-iso-string"),require("../modules/es6.date.to-string"),require("../modules/es6.date.to-primitive"),require("../modules/es6.array.is-array"),require("../modules/es6.array.from"),require("../modules/es6.array.of"),require("../modules/es6.array.join"),require("../modules/es6.array.slice"),require("../modules/es6.array.sort"),require("../modules/es6.array.for-each"),require("../modules/es6.array.map"),require("../modules/es6.array.filter"),require("../modules/es6.array.some"),require("../modules/es6.array.every"),require("../modules/es6.array.reduce"),require("../modules/es6.array.reduce-right"),require("../modules/es6.array.index-of"),require("../modules/es6.array.last-index-of"),require("../modules/es6.array.copy-within"),require("../modules/es6.array.fill"),require("../modules/es6.array.find"),require("../modules/es6.array.find-index"),require("../modules/es6.array.species"),require("../modules/es6.array.iterator"),require("../modules/es6.regexp.constructor"),require("../modules/es6.regexp.exec"),require("../modules/es6.regexp.to-string"),require("../modules/es6.regexp.flags"),require("../modules/es6.regexp.match"),require("../modules/es6.regexp.replace"),require("../modules/es6.regexp.search"),require("../modules/es6.regexp.split"),require("../modules/es6.promise"),require("../modules/es6.map"),require("../modules/es6.set"),require("../modules/es6.weak-map"),require("../modules/es6.weak-set"),require("../modules/es6.typed.array-buffer"),require("../modules/es6.typed.data-view"),require("../modules/es6.typed.int8-array"),require("../modules/es6.typed.uint8-array"),require("../modules/es6.typed.uint8-clamped-array"),require("../modules/es6.typed.int16-array"),require("../modules/es6.typed.uint16-array"),require("../modules/es6.typed.int32-array"),require("../modules/es6.typed.uint32-array"),require("../modules/es6.typed.float32-array"),require("../modules/es6.typed.float64-array"),require("../modules/es6.reflect.apply"),require("../modules/es6.reflect.construct"),require("../modules/es6.reflect.define-property"),require("../modules/es6.reflect.delete-property"),require("../modules/es6.reflect.enumerate"),require("../modules/es6.reflect.get"),require("../modules/es6.reflect.get-own-property-descriptor"),require("../modules/es6.reflect.get-prototype-of"),require("../modules/es6.reflect.has"),require("../modules/es6.reflect.is-extensible"),require("../modules/es6.reflect.own-keys"),require("../modules/es6.reflect.prevent-extensions"),require("../modules/es6.reflect.set"),require("../modules/es6.reflect.set-prototype-of"),module.exports=require("../modules/_core");

},{"../modules/_core":56,"../modules/es6.array.copy-within":158,"../modules/es6.array.every":159,"../modules/es6.array.fill":160,"../modules/es6.array.filter":161,"../modules/es6.array.find":163,"../modules/es6.array.find-index":162,"../modules/es6.array.for-each":164,"../modules/es6.array.from":165,"../modules/es6.array.index-of":166,"../modules/es6.array.is-array":167,"../modules/es6.array.iterator":168,"../modules/es6.array.join":169,"../modules/es6.array.last-index-of":170,"../modules/es6.array.map":171,"../modules/es6.array.of":172,"../modules/es6.array.reduce":174,"../modules/es6.array.reduce-right":173,"../modules/es6.array.slice":175,"../modules/es6.array.some":176,"../modules/es6.array.sort":177,"../modules/es6.array.species":178,"../modules/es6.date.now":179,"../modules/es6.date.to-iso-string":180,"../modules/es6.date.to-json":181,"../modules/es6.date.to-primitive":182,"../modules/es6.date.to-string":183,"../modules/es6.function.bind":184,"../modules/es6.function.has-instance":185,"../modules/es6.function.name":186,"../modules/es6.map":187,"../modules/es6.math.acosh":188,"../modules/es6.math.asinh":189,"../modules/es6.math.atanh":190,"../modules/es6.math.cbrt":191,"../modules/es6.math.clz32":192,"../modules/es6.math.cosh":193,"../modules/es6.math.expm1":194,"../modules/es6.math.fround":195,"../modules/es6.math.hypot":196,"../modules/es6.math.imul":197,"../modules/es6.math.log10":198,"../modules/es6.math.log1p":199,"../modules/es6.math.log2":200,"../modules/es6.math.sign":201,"../modules/es6.math.sinh":202,"../modules/es6.math.tanh":203,"../modules/es6.math.trunc":204,"../modules/es6.number.constructor":205,"../modules/es6.number.epsilon":206,"../modules/es6.number.is-finite":207,"../modules/es6.number.is-integer":208,"../modules/es6.number.is-nan":209,"../modules/es6.number.is-safe-integer":210,"../modules/es6.number.max-safe-integer":211,"../modules/es6.number.min-safe-integer":212,"../modules/es6.number.parse-float":213,"../modules/es6.number.parse-int":214,"../modules/es6.number.to-fixed":215,"../modules/es6.number.to-precision":216,"../modules/es6.object.assign":217,"../modules/es6.object.create":218,"../modules/es6.object.define-properties":219,"../modules/es6.object.define-property":220,"../modules/es6.object.freeze":221,"../modules/es6.object.get-own-property-descriptor":222,"../modules/es6.object.get-own-property-names":223,"../modules/es6.object.get-prototype-of":224,"../modules/es6.object.is":228,"../modules/es6.object.is-extensible":225,"../modules/es6.object.is-frozen":226,"../modules/es6.object.is-sealed":227,"../modules/es6.object.keys":229,"../modules/es6.object.prevent-extensions":230,"../modules/es6.object.seal":231,"../modules/es6.object.set-prototype-of":232,"../modules/es6.object.to-string":233,"../modules/es6.parse-float":234,"../modules/es6.parse-int":235,"../modules/es6.promise":236,"../modules/es6.reflect.apply":237,"../modules/es6.reflect.construct":238,"../modules/es6.reflect.define-property":239,"../modules/es6.reflect.delete-property":240,"../modules/es6.reflect.enumerate":241,"../modules/es6.reflect.get":244,"../modules/es6.reflect.get-own-property-descriptor":242,"../modules/es6.reflect.get-prototype-of":243,"../modules/es6.reflect.has":245,"../modules/es6.reflect.is-extensible":246,"../modules/es6.reflect.own-keys":247,"../modules/es6.reflect.prevent-extensions":248,"../modules/es6.reflect.set":250,"../modules/es6.reflect.set-prototype-of":249,"../modules/es6.regexp.constructor":251,"../modules/es6.regexp.exec":252,"../modules/es6.regexp.flags":253,"../modules/es6.regexp.match":254,"../modules/es6.regexp.replace":255,"../modules/es6.regexp.search":256,"../modules/es6.regexp.split":257,"../modules/es6.regexp.to-string":258,"../modules/es6.set":259,"../modules/es6.string.anchor":260,"../modules/es6.string.big":261,"../modules/es6.string.blink":262,"../modules/es6.string.bold":263,"../modules/es6.string.code-point-at":264,"../modules/es6.string.ends-with":265,"../modules/es6.string.fixed":266,"../modules/es6.string.fontcolor":267,"../modules/es6.string.fontsize":268,"../modules/es6.string.from-code-point":269,"../modules/es6.string.includes":270,"../modules/es6.string.italics":271,"../modules/es6.string.iterator":272,"../modules/es6.string.link":273,"../modules/es6.string.raw":274,"../modules/es6.string.repeat":275,"../modules/es6.string.small":276,"../modules/es6.string.starts-with":277,"../modules/es6.string.strike":278,"../modules/es6.string.sub":279,"../modules/es6.string.sup":280,"../modules/es6.string.trim":281,"../modules/es6.symbol":282,"../modules/es6.typed.array-buffer":283,"../modules/es6.typed.data-view":284,"../modules/es6.typed.float32-array":285,"../modules/es6.typed.float64-array":286,"../modules/es6.typed.int16-array":287,"../modules/es6.typed.int32-array":288,"../modules/es6.typed.int8-array":289,"../modules/es6.typed.uint16-array":290,"../modules/es6.typed.uint32-array":291,"../modules/es6.typed.uint8-array":292,"../modules/es6.typed.uint8-clamped-array":293,"../modules/es6.weak-map":294,"../modules/es6.weak-set":295}],8:[function(require,module,exports){
require("../../modules/es7.array.flat-map"),module.exports=require("../../modules/_core").Array.flatMap;

},{"../../modules/_core":56,"../../modules/es7.array.flat-map":296}],9:[function(require,module,exports){
require("../../modules/es7.array.includes"),module.exports=require("../../modules/_core").Array.includes;

},{"../../modules/_core":56,"../../modules/es7.array.includes":297}],10:[function(require,module,exports){
require("../../modules/es7.object.entries"),module.exports=require("../../modules/_core").Object.entries;

},{"../../modules/_core":56,"../../modules/es7.object.entries":298}],11:[function(require,module,exports){
require("../../modules/es7.object.get-own-property-descriptors"),module.exports=require("../../modules/_core").Object.getOwnPropertyDescriptors;

},{"../../modules/_core":56,"../../modules/es7.object.get-own-property-descriptors":299}],12:[function(require,module,exports){
require("../../modules/es7.object.values"),module.exports=require("../../modules/_core").Object.values;

},{"../../modules/_core":56,"../../modules/es7.object.values":300}],13:[function(require,module,exports){
"use strict";require("../../modules/es6.promise"),require("../../modules/es7.promise.finally"),module.exports=require("../../modules/_core").Promise.finally;

},{"../../modules/_core":56,"../../modules/es6.promise":236,"../../modules/es7.promise.finally":301}],14:[function(require,module,exports){
require("../../modules/es7.string.pad-end"),module.exports=require("../../modules/_core").String.padEnd;

},{"../../modules/_core":56,"../../modules/es7.string.pad-end":302}],15:[function(require,module,exports){
require("../../modules/es7.string.pad-start"),module.exports=require("../../modules/_core").String.padStart;

},{"../../modules/_core":56,"../../modules/es7.string.pad-start":303}],16:[function(require,module,exports){
require("../../modules/es7.string.trim-right"),module.exports=require("../../modules/_core").String.trimRight;

},{"../../modules/_core":56,"../../modules/es7.string.trim-right":305}],17:[function(require,module,exports){
require("../../modules/es7.string.trim-left"),module.exports=require("../../modules/_core").String.trimLeft;

},{"../../modules/_core":56,"../../modules/es7.string.trim-left":304}],18:[function(require,module,exports){
require("../../modules/es7.symbol.async-iterator"),module.exports=require("../../modules/_wks-ext").f("asyncIterator");

},{"../../modules/_wks-ext":155,"../../modules/es7.symbol.async-iterator":306}],19:[function(require,module,exports){
require("../modules/es7.global"),module.exports=require("../modules/_core").global;

},{"../modules/_core":22,"../modules/es7.global":36}],20:[function(require,module,exports){
module.exports=function(o){if("function"!=typeof o)throw TypeError(o+" is not a function!");return o};

},{}],21:[function(require,module,exports){
var isObject=require("./_is-object");module.exports=function(e){if(!isObject(e))throw TypeError(e+" is not an object!");return e};

},{"./_is-object":32}],22:[function(require,module,exports){
var core=module.exports={version:"2.6.11"};"number"==typeof __e&&(__e=core);

},{}],23:[function(require,module,exports){
var aFunction=require("./_a-function");module.exports=function(n,r,t){if(aFunction(n),void 0===r)return n;switch(t){case 1:return function(t){return n.call(r,t)};case 2:return function(t,u){return n.call(r,t,u)};case 3:return function(t,u,e){return n.call(r,t,u,e)}}return function(){return n.apply(r,arguments)}};

},{"./_a-function":20}],24:[function(require,module,exports){
module.exports=!require("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a});

},{"./_fails":27}],25:[function(require,module,exports){
var isObject=require("./_is-object"),document=require("./_global").document,is=isObject(document)&&isObject(document.createElement);module.exports=function(e){return is?document.createElement(e):{}};

},{"./_global":28,"./_is-object":32}],26:[function(require,module,exports){
var global=require("./_global"),core=require("./_core"),ctx=require("./_ctx"),hide=require("./_hide"),has=require("./_has"),PROTOTYPE="prototype",$export=function(e,r,t){var o,n,p,i=e&$export.F,x=e&$export.G,c=e&$export.S,a=e&$export.P,u=e&$export.B,l=e&$export.W,$=x?core:core[r]||(core[r]={}),P=$[PROTOTYPE],s=x?global:c?global[r]:(global[r]||{})[PROTOTYPE];for(o in x&&(t=r),t)(n=!i&&s&&void 0!==s[o])&&has($,o)||(p=n?s[o]:t[o],$[o]=x&&"function"!=typeof s[o]?t[o]:u&&n?ctx(p,global):l&&s[o]==p?function(e){var r=function(r,t,o){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(r);case 2:return new e(r,t)}return new e(r,t,o)}return e.apply(this,arguments)};return r[PROTOTYPE]=e[PROTOTYPE],r}(p):a&&"function"==typeof p?ctx(Function.call,p):p,a&&(($.virtual||($.virtual={}))[o]=p,e&$export.R&&P&&!P[o]&&hide(P,o,p)))};$export.F=1,$export.G=2,$export.S=4,$export.P=8,$export.B=16,$export.W=32,$export.U=64,$export.R=128,module.exports=$export;

},{"./_core":22,"./_ctx":23,"./_global":28,"./_has":29,"./_hide":30}],27:[function(require,module,exports){
module.exports=function(r){try{return!!r()}catch(r){return!0}};

},{}],28:[function(require,module,exports){
var global=module.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=global);

},{}],29:[function(require,module,exports){
var hasOwnProperty={}.hasOwnProperty;module.exports=function(r,e){return hasOwnProperty.call(r,e)};

},{}],30:[function(require,module,exports){
var dP=require("./_object-dp"),createDesc=require("./_property-desc");module.exports=require("./_descriptors")?function(e,r,t){return dP.f(e,r,createDesc(1,t))}:function(e,r,t){return e[r]=t,e};

},{"./_descriptors":24,"./_object-dp":33,"./_property-desc":34}],31:[function(require,module,exports){
module.exports=!require("./_descriptors")&&!require("./_fails")(function(){return 7!=Object.defineProperty(require("./_dom-create")("div"),"a",{get:function(){return 7}}).a});

},{"./_descriptors":24,"./_dom-create":25,"./_fails":27}],32:[function(require,module,exports){
module.exports=function(o){return"object"==typeof o?null!==o:"function"==typeof o};

},{}],33:[function(require,module,exports){
var anObject=require("./_an-object"),IE8_DOM_DEFINE=require("./_ie8-dom-define"),toPrimitive=require("./_to-primitive"),dP=Object.defineProperty;exports.f=require("./_descriptors")?Object.defineProperty:function(e,r,t){if(anObject(e),r=toPrimitive(r,!0),anObject(t),IE8_DOM_DEFINE)try{return dP(e,r,t)}catch(e){}if("get"in t||"set"in t)throw TypeError("Accessors not supported!");return"value"in t&&(e[r]=t.value),e};

},{"./_an-object":21,"./_descriptors":24,"./_ie8-dom-define":31,"./_to-primitive":35}],34:[function(require,module,exports){
module.exports=function(e,r){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:r}};

},{}],35:[function(require,module,exports){
var isObject=require("./_is-object");module.exports=function(t,e){if(!isObject(t))return t;var r,i;if(e&&"function"==typeof(r=t.toString)&&!isObject(i=r.call(t)))return i;if("function"==typeof(r=t.valueOf)&&!isObject(i=r.call(t)))return i;if(!e&&"function"==typeof(r=t.toString)&&!isObject(i=r.call(t)))return i;throw TypeError("Can't convert object to primitive value")};

},{"./_is-object":32}],36:[function(require,module,exports){
var $export=require("./_export");$export($export.G,{global:require("./_global")});

},{"./_export":26,"./_global":28}],37:[function(require,module,exports){
module.exports=function(o){if("function"!=typeof o)throw TypeError(o+" is not a function!");return o};

},{}],38:[function(require,module,exports){
var cof=require("./_cof");module.exports=function(r,e){if("number"!=typeof r&&"Number"!=cof(r))throw TypeError(e);return+r};

},{"./_cof":52}],39:[function(require,module,exports){
var UNSCOPABLES=require("./_wks")("unscopables"),ArrayProto=Array.prototype;null==ArrayProto[UNSCOPABLES]&&require("./_hide")(ArrayProto,UNSCOPABLES,{}),module.exports=function(r){ArrayProto[UNSCOPABLES][r]=!0};

},{"./_hide":76,"./_wks":156}],40:[function(require,module,exports){
"use strict";var at=require("./_string-at")(!0);module.exports=function(t,r,e){return r+(e?at(t,r).length:1)};

},{"./_string-at":133}],41:[function(require,module,exports){
module.exports=function(o,n,r,i){if(!(o instanceof n)||void 0!==i&&i in o)throw TypeError(r+": incorrect invocation!");return o};

},{}],42:[function(require,module,exports){
var isObject=require("./_is-object");module.exports=function(e){if(!isObject(e))throw TypeError(e+" is not an object!");return e};

},{"./_is-object":85}],43:[function(require,module,exports){
"use strict";var toObject=require("./_to-object"),toAbsoluteIndex=require("./_to-absolute-index"),toLength=require("./_to-length");module.exports=[].copyWithin||function(t,e){var o=toObject(this),n=toLength(o.length),i=toAbsoluteIndex(t,n),r=toAbsoluteIndex(e,n),u=arguments.length>2?arguments[2]:void 0,l=Math.min((void 0===u?n:toAbsoluteIndex(u,n))-r,n-i),d=1;for(r<i&&i<r+l&&(d=-1,r+=l-1,i+=l-1);l-- >0;)r in o?o[i]=o[r]:delete o[i],i+=d,r+=d;return o};

},{"./_to-absolute-index":141,"./_to-length":145,"./_to-object":146}],44:[function(require,module,exports){
"use strict";var toObject=require("./_to-object"),toAbsoluteIndex=require("./_to-absolute-index"),toLength=require("./_to-length");module.exports=function(t){for(var e=toObject(this),o=toLength(e.length),r=arguments.length,n=toAbsoluteIndex(r>1?arguments[1]:void 0,o),u=r>2?arguments[2]:void 0,i=void 0===u?o:toAbsoluteIndex(u,o);i>n;)e[n++]=t;return e};

},{"./_to-absolute-index":141,"./_to-length":145,"./_to-object":146}],45:[function(require,module,exports){
var toIObject=require("./_to-iobject"),toLength=require("./_to-length"),toAbsoluteIndex=require("./_to-absolute-index");module.exports=function(e){return function(t,o,r){var n,u=toIObject(t),i=toLength(u.length),f=toAbsoluteIndex(r,i);if(e&&o!=o){for(;i>f;)if((n=u[f++])!=n)return!0}else for(;i>f;f++)if((e||f in u)&&u[f]===o)return e||f||0;return!e&&-1}};

},{"./_to-absolute-index":141,"./_to-iobject":144,"./_to-length":145}],46:[function(require,module,exports){
var ctx=require("./_ctx"),IObject=require("./_iobject"),toObject=require("./_to-object"),toLength=require("./_to-length"),asc=require("./_array-species-create");module.exports=function(e,r){var t=1==e,c=2==e,i=3==e,n=4==e,u=6==e,o=5==e||u,s=r||asc;return function(r,a,f){for(var b,h,j=toObject(r),l=IObject(j),q=ctx(a,f,3),_=toLength(l.length),g=0,v=t?s(r,_):c?s(r,0):void 0;_>g;g++)if((o||g in l)&&(h=q(b=l[g],g,j),e))if(t)v[g]=h;else if(h)switch(e){case 3:return!0;case 5:return b;case 6:return g;case 2:v.push(b)}else if(n)return!1;return u?-1:i||n?n:v}};

},{"./_array-species-create":49,"./_ctx":58,"./_iobject":81,"./_to-length":145,"./_to-object":146}],47:[function(require,module,exports){
var aFunction=require("./_a-function"),toObject=require("./_to-object"),IObject=require("./_iobject"),toLength=require("./_to-length");module.exports=function(e,t,r,o,i){aFunction(t);var n=toObject(e),u=IObject(n),c=toLength(n.length),a=i?c-1:0,f=i?-1:1;if(r<2)for(;;){if(a in u){o=u[a],a+=f;break}if(a+=f,i?a<0:c<=a)throw TypeError("Reduce of empty array with no initial value")}for(;i?a>=0:c>a;a+=f)a in u&&(o=t(o,u[a],a,n));return o};

},{"./_a-function":37,"./_iobject":81,"./_to-length":145,"./_to-object":146}],48:[function(require,module,exports){
var isObject=require("./_is-object"),isArray=require("./_is-array"),SPECIES=require("./_wks")("species");module.exports=function(r){var e;return isArray(r)&&("function"!=typeof(e=r.constructor)||e!==Array&&!isArray(e.prototype)||(e=void 0),isObject(e)&&null===(e=e[SPECIES])&&(e=void 0)),void 0===e?Array:e};

},{"./_is-array":83,"./_is-object":85,"./_wks":156}],49:[function(require,module,exports){
var speciesConstructor=require("./_array-species-constructor");module.exports=function(r,e){return new(speciesConstructor(r))(e)};

},{"./_array-species-constructor":48}],50:[function(require,module,exports){
"use strict";var aFunction=require("./_a-function"),isObject=require("./_is-object"),invoke=require("./_invoke"),arraySlice=[].slice,factories={},construct=function(t,r,e){if(!(r in factories)){for(var i=[],n=0;n<r;n++)i[n]="a["+n+"]";factories[r]=Function("F,a","return new F("+i.join(",")+")")}return factories[r](t,e)};module.exports=Function.bind||function(t){var r=aFunction(this),e=arraySlice.call(arguments,1),i=function(){var n=e.concat(arraySlice.call(arguments));return this instanceof i?construct(r,n.length,n):invoke(r,n,t)};return isObject(r.prototype)&&(i.prototype=r.prototype),i};

},{"./_a-function":37,"./_invoke":80,"./_is-object":85}],51:[function(require,module,exports){
var cof=require("./_cof"),TAG=require("./_wks")("toStringTag"),ARG="Arguments"==cof(function(){return arguments}()),tryGet=function(t,e){try{return t[e]}catch(t){}};module.exports=function(t){var e,r,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=tryGet(e=Object(t),TAG))?r:ARG?cof(e):"Object"==(n=cof(e))&&"function"==typeof e.callee?"Arguments":n};

},{"./_cof":52,"./_wks":156}],52:[function(require,module,exports){
var toString={}.toString;module.exports=function(t){return toString.call(t).slice(8,-1)};

},{}],53:[function(require,module,exports){
"use strict";var dP=require("./_object-dp").f,create=require("./_object-create"),redefineAll=require("./_redefine-all"),ctx=require("./_ctx"),anInstance=require("./_an-instance"),forOf=require("./_for-of"),$iterDefine=require("./_iter-define"),step=require("./_iter-step"),setSpecies=require("./_set-species"),DESCRIPTORS=require("./_descriptors"),fastKey=require("./_meta").fastKey,validate=require("./_validate-collection"),SIZE=DESCRIPTORS?"_s":"size",getEntry=function(e,t){var r,i=fastKey(t);if("F"!==i)return e._i[i];for(r=e._f;r;r=r.n)if(r.k==t)return r};module.exports={getConstructor:function(e,t,r,i){var n=e(function(e,f){anInstance(e,n,t,"_i"),e._t=t,e._i=create(null),e._f=void 0,e._l=void 0,e[SIZE]=0,null!=f&&forOf(f,r,e[i],e)});return redefineAll(n.prototype,{clear:function(){for(var e=validate(this,t),r=e._i,i=e._f;i;i=i.n)i.r=!0,i.p&&(i.p=i.p.n=void 0),delete r[i.i];e._f=e._l=void 0,e[SIZE]=0},delete:function(e){var r=validate(this,t),i=getEntry(r,e);if(i){var n=i.n,f=i.p;delete r._i[i.i],i.r=!0,f&&(f.n=n),n&&(n.p=f),r._f==i&&(r._f=n),r._l==i&&(r._l=f),r[SIZE]--}return!!i},forEach:function(e){validate(this,t);for(var r,i=ctx(e,arguments.length>1?arguments[1]:void 0,3);r=r?r.n:this._f;)for(i(r.v,r.k,this);r&&r.r;)r=r.p},has:function(e){return!!getEntry(validate(this,t),e)}}),DESCRIPTORS&&dP(n.prototype,"size",{get:function(){return validate(this,t)[SIZE]}}),n},def:function(e,t,r){var i,n,f=getEntry(e,t);return f?f.v=r:(e._l=f={i:n=fastKey(t,!0),k:t,v:r,p:i=e._l,n:void 0,r:!1},e._f||(e._f=f),i&&(i.n=f),e[SIZE]++,"F"!==n&&(e._i[n]=f)),e},getEntry:getEntry,setStrong:function(e,t,r){$iterDefine(e,t,function(e,r){this._t=validate(e,t),this._k=r,this._l=void 0},function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?step(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,step(1))},r?"entries":"values",!r,!0),setSpecies(t)}};

},{"./_an-instance":41,"./_ctx":58,"./_descriptors":62,"./_for-of":72,"./_iter-define":89,"./_iter-step":91,"./_meta":98,"./_object-create":102,"./_object-dp":103,"./_redefine-all":121,"./_set-species":127,"./_validate-collection":153}],54:[function(require,module,exports){
"use strict";var redefineAll=require("./_redefine-all"),getWeak=require("./_meta").getWeak,anObject=require("./_an-object"),isObject=require("./_is-object"),anInstance=require("./_an-instance"),forOf=require("./_for-of"),createArrayMethod=require("./_array-methods"),$has=require("./_has"),validate=require("./_validate-collection"),arrayFind=createArrayMethod(5),arrayFindIndex=createArrayMethod(6),id=0,uncaughtFrozenStore=function(e){return e._l||(e._l=new UncaughtFrozenStore)},UncaughtFrozenStore=function(){this.a=[]},findUncaughtFrozen=function(e,t){return arrayFind(e.a,function(e){return e[0]===t})};UncaughtFrozenStore.prototype={get:function(e){var t=findUncaughtFrozen(this,e);if(t)return t[1]},has:function(e){return!!findUncaughtFrozen(this,e)},set:function(e,t){var r=findUncaughtFrozen(this,e);r?r[1]=t:this.a.push([e,t])},delete:function(e){var t=arrayFindIndex(this.a,function(t){return t[0]===e});return~t&&this.a.splice(t,1),!!~t}},module.exports={getConstructor:function(e,t,r,n){var a=e(function(e,i){anInstance(e,a,t,"_i"),e._t=t,e._i=id++,e._l=void 0,null!=i&&forOf(i,r,e[n],e)});return redefineAll(a.prototype,{delete:function(e){if(!isObject(e))return!1;var r=getWeak(e);return!0===r?uncaughtFrozenStore(validate(this,t)).delete(e):r&&$has(r,this._i)&&delete r[this._i]},has:function(e){if(!isObject(e))return!1;var r=getWeak(e);return!0===r?uncaughtFrozenStore(validate(this,t)).has(e):r&&$has(r,this._i)}}),a},def:function(e,t,r){var n=getWeak(anObject(t),!0);return!0===n?uncaughtFrozenStore(e).set(t,r):n[e._i]=r,e},ufstore:uncaughtFrozenStore};

},{"./_an-instance":41,"./_an-object":42,"./_array-methods":46,"./_for-of":72,"./_has":75,"./_is-object":85,"./_meta":98,"./_redefine-all":121,"./_validate-collection":153}],55:[function(require,module,exports){
"use strict";var global=require("./_global"),$export=require("./_export"),redefine=require("./_redefine"),redefineAll=require("./_redefine-all"),meta=require("./_meta"),forOf=require("./_for-of"),anInstance=require("./_an-instance"),isObject=require("./_is-object"),fails=require("./_fails"),$iterDetect=require("./_iter-detect"),setToStringTag=require("./_set-to-string-tag"),inheritIfRequired=require("./_inherit-if-required");module.exports=function(e,t,r,i,n,o){var a=global[e],u=a,f=n?"set":"add",s=u&&u.prototype,c={},l=function(e){var t=s[e];redefine(s,e,"delete"==e?function(e){return!(o&&!isObject(e))&&t.call(this,0===e?0:e)}:"has"==e?function(e){return!(o&&!isObject(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return o&&!isObject(e)?void 0:t.call(this,0===e?0:e)}:"add"==e?function(e){return t.call(this,0===e?0:e),this}:function(e,r){return t.call(this,0===e?0:e,r),this})};if("function"==typeof u&&(o||s.forEach&&!fails(function(){(new u).entries().next()}))){var d=new u,h=d[f](o?{}:-0,1)!=d,q=fails(function(){d.has(1)}),p=$iterDetect(function(e){new u(e)}),g=!o&&fails(function(){for(var e=new u,t=5;t--;)e[f](t,t);return!e.has(-0)});p||((u=t(function(t,r){anInstance(t,u,e);var i=inheritIfRequired(new a,t,u);return null!=r&&forOf(r,n,i[f],i),i})).prototype=s,s.constructor=u),(q||g)&&(l("delete"),l("has"),n&&l("get")),(g||h)&&l(f),o&&s.clear&&delete s.clear}else u=i.getConstructor(t,e,n,f),redefineAll(u.prototype,r),meta.NEED=!0;return setToStringTag(u,e),c[e]=u,$export($export.G+$export.W+$export.F*(u!=a),c),o||i.setStrong(u,e,n),u};

},{"./_an-instance":41,"./_export":66,"./_fails":68,"./_for-of":72,"./_global":74,"./_inherit-if-required":79,"./_is-object":85,"./_iter-detect":90,"./_meta":98,"./_redefine":122,"./_redefine-all":121,"./_set-to-string-tag":128}],56:[function(require,module,exports){
var core=module.exports={version:"2.6.11"};"number"==typeof __e&&(__e=core);

},{}],57:[function(require,module,exports){
"use strict";var $defineProperty=require("./_object-dp"),createDesc=require("./_property-desc");module.exports=function(e,r,t){r in e?$defineProperty.f(e,r,createDesc(0,t)):e[r]=t};

},{"./_object-dp":103,"./_property-desc":120}],58:[function(require,module,exports){
var aFunction=require("./_a-function");module.exports=function(n,r,t){if(aFunction(n),void 0===r)return n;switch(t){case 1:return function(t){return n.call(r,t)};case 2:return function(t,u){return n.call(r,t,u)};case 3:return function(t,u,e){return n.call(r,t,u,e)}}return function(){return n.apply(r,arguments)}};

},{"./_a-function":37}],59:[function(require,module,exports){
"use strict";var fails=require("./_fails"),getTime=Date.prototype.getTime,$toISOString=Date.prototype.toISOString,lz=function(t){return t>9?t:"0"+t};module.exports=fails(function(){return"0385-07-25T07:06:39.999Z"!=$toISOString.call(new Date(-5e13-1))})||!fails(function(){$toISOString.call(new Date(NaN))})?function(){if(!isFinite(getTime.call(this)))throw RangeError("Invalid time value");var t=this,e=t.getUTCFullYear(),i=t.getUTCMilliseconds(),l=e<0?"-":e>9999?"+":"";return l+("00000"+Math.abs(e)).slice(l?-6:-4)+"-"+lz(t.getUTCMonth()+1)+"-"+lz(t.getUTCDate())+"T"+lz(t.getUTCHours())+":"+lz(t.getUTCMinutes())+":"+lz(t.getUTCSeconds())+"."+(i>99?i:"0"+lz(i))+"Z"}:$toISOString;

},{"./_fails":68}],60:[function(require,module,exports){
"use strict";var anObject=require("./_an-object"),toPrimitive=require("./_to-primitive"),NUMBER="number";module.exports=function(r){if("string"!==r&&r!==NUMBER&&"default"!==r)throw TypeError("Incorrect hint");return toPrimitive(anObject(this),r!=NUMBER)};

},{"./_an-object":42,"./_to-primitive":147}],61:[function(require,module,exports){
module.exports=function(o){if(null==o)throw TypeError("Can't call method on  "+o);return o};

},{}],62:[function(require,module,exports){
module.exports=!require("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a});

},{"./_fails":68}],63:[function(require,module,exports){
var isObject=require("./_is-object"),document=require("./_global").document,is=isObject(document)&&isObject(document.createElement);module.exports=function(e){return is?document.createElement(e):{}};

},{"./_global":74,"./_is-object":85}],64:[function(require,module,exports){
module.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",");

},{}],65:[function(require,module,exports){
var getKeys=require("./_object-keys"),gOPS=require("./_object-gops"),pIE=require("./_object-pie");module.exports=function(e){var r=getKeys(e),t=gOPS.f;if(t)for(var o,u=t(e),g=pIE.f,i=0;u.length>i;)g.call(e,o=u[i++])&&r.push(o);return r};

},{"./_object-gops":108,"./_object-keys":111,"./_object-pie":112}],66:[function(require,module,exports){
var global=require("./_global"),core=require("./_core"),hide=require("./_hide"),redefine=require("./_redefine"),ctx=require("./_ctx"),PROTOTYPE="prototype",$export=function(e,o,r){var t,x,p,l,i=e&$export.F,$=e&$export.G,c=e&$export.S,a=e&$export.P,n=e&$export.B,P=$?global:c?global[o]||(global[o]={}):(global[o]||{})[PROTOTYPE],u=$?core:core[o]||(core[o]={}),b=u[PROTOTYPE]||(u[PROTOTYPE]={});for(t in $&&(r=o),r)p=((x=!i&&P&&void 0!==P[t])?P:r)[t],l=n&&x?ctx(p,global):a&&"function"==typeof p?ctx(Function.call,p):p,P&&redefine(P,t,p,e&$export.U),u[t]!=p&&hide(u,t,l),a&&b[t]!=p&&(b[t]=p)};global.core=core,$export.F=1,$export.G=2,$export.S=4,$export.P=8,$export.B=16,$export.W=32,$export.U=64,$export.R=128,module.exports=$export;

},{"./_core":56,"./_ctx":58,"./_global":74,"./_hide":76,"./_redefine":122}],67:[function(require,module,exports){
var MATCH=require("./_wks")("match");module.exports=function(r){var t=/./;try{"/./"[r](t)}catch(c){try{return t[MATCH]=!1,!"/./"[r](t)}catch(r){}}return!0};

},{"./_wks":156}],68:[function(require,module,exports){
module.exports=function(r){try{return!!r()}catch(r){return!0}};

},{}],69:[function(require,module,exports){
"use strict";require("./es6.regexp.exec");var redefine=require("./_redefine"),hide=require("./_hide"),fails=require("./_fails"),defined=require("./_defined"),wks=require("./_wks"),regexpExec=require("./_regexp-exec"),SPECIES=wks("species"),REPLACE_SUPPORTS_NAMED_GROUPS=!fails(function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}),SPLIT_WORKS_WITH_OVERWRITTEN_EXEC=function(){var e=/(?:)/,r=e.exec;e.exec=function(){return r.apply(this,arguments)};var n="ab".split(e);return 2===n.length&&"a"===n[0]&&"b"===n[1]}();module.exports=function(e,r,n){var i=wks(e),t=!fails(function(){var r={};return r[i]=function(){return 7},7!=""[e](r)}),u=t?!fails(function(){var r=!1,n=/a/;return n.exec=function(){return r=!0,null},"split"===e&&(n.constructor={},n.constructor[SPECIES]=function(){return n}),n[i](""),!r}):void 0;if(!t||!u||"replace"===e&&!REPLACE_SUPPORTS_NAMED_GROUPS||"split"===e&&!SPLIT_WORKS_WITH_OVERWRITTEN_EXEC){var c=/./[i],a=n(defined,i,""[e],function(e,r,n,i,u){return r.exec===regexpExec?t&&!u?{done:!0,value:c.call(r,n,i)}:{done:!0,value:e.call(n,r,i)}:{done:!1}}),o=a[0],f=a[1];redefine(String.prototype,e,o),hide(RegExp.prototype,i,2==r?function(e,r){return f.call(e,this,r)}:function(e){return f.call(e,this)})}};

},{"./_defined":61,"./_fails":68,"./_hide":76,"./_redefine":122,"./_regexp-exec":124,"./_wks":156,"./es6.regexp.exec":252}],70:[function(require,module,exports){
"use strict";var anObject=require("./_an-object");module.exports=function(){var e=anObject(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t};

},{"./_an-object":42}],71:[function(require,module,exports){
"use strict";var isArray=require("./_is-array"),isObject=require("./_is-object"),toLength=require("./_to-length"),ctx=require("./_ctx"),IS_CONCAT_SPREADABLE=require("./_wks")("isConcatSpreadable");function flattenIntoArray(r,e,t,i,a,n,o,s){for(var A,c,u=a,_=0,f=!!o&&ctx(o,s,3);_<i;){if(_ in t){if(A=f?f(t[_],_,e):t[_],c=!1,isObject(A)&&(c=void 0!==(c=A[IS_CONCAT_SPREADABLE])?!!c:isArray(A)),c&&n>0)u=flattenIntoArray(r,e,A,toLength(A.length),u,n-1)-1;else{if(u>=9007199254740991)throw TypeError();r[u]=A}u++}_++}return u}module.exports=flattenIntoArray;

},{"./_ctx":58,"./_is-array":83,"./_is-object":85,"./_to-length":145,"./_wks":156}],72:[function(require,module,exports){
var ctx=require("./_ctx"),call=require("./_iter-call"),isArrayIter=require("./_is-array-iter"),anObject=require("./_an-object"),toLength=require("./_to-length"),getIterFn=require("./core.get-iterator-method"),BREAK={},RETURN={},exports=module.exports=function(e,r,t,o,i){var n,a,R,c,l=i?function(){return e}:getIterFn(e),u=ctx(t,o,r?2:1),E=0;if("function"!=typeof l)throw TypeError(e+" is not iterable!");if(isArrayIter(l)){for(n=toLength(e.length);n>E;E++)if((c=r?u(anObject(a=e[E])[0],a[1]):u(e[E]))===BREAK||c===RETURN)return c}else for(R=l.call(e);!(a=R.next()).done;)if((c=call(R,u,a.value,r))===BREAK||c===RETURN)return c};exports.BREAK=BREAK,exports.RETURN=RETURN;

},{"./_an-object":42,"./_ctx":58,"./_is-array-iter":82,"./_iter-call":87,"./_to-length":145,"./core.get-iterator-method":157}],73:[function(require,module,exports){
module.exports=require("./_shared")("native-function-to-string",Function.toString);

},{"./_shared":130}],74:[function(require,module,exports){
var global=module.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=global);

},{}],75:[function(require,module,exports){
var hasOwnProperty={}.hasOwnProperty;module.exports=function(r,e){return hasOwnProperty.call(r,e)};

},{}],76:[function(require,module,exports){
var dP=require("./_object-dp"),createDesc=require("./_property-desc");module.exports=require("./_descriptors")?function(e,r,t){return dP.f(e,r,createDesc(1,t))}:function(e,r,t){return e[r]=t,e};

},{"./_descriptors":62,"./_object-dp":103,"./_property-desc":120}],77:[function(require,module,exports){
var document=require("./_global").document;module.exports=document&&document.documentElement;

},{"./_global":74}],78:[function(require,module,exports){
module.exports=!require("./_descriptors")&&!require("./_fails")(function(){return 7!=Object.defineProperty(require("./_dom-create")("div"),"a",{get:function(){return 7}}).a});

},{"./_descriptors":62,"./_dom-create":63,"./_fails":68}],79:[function(require,module,exports){
var isObject=require("./_is-object"),setPrototypeOf=require("./_set-proto").set;module.exports=function(t,e,o){var r,p=e.constructor;return p!==o&&"function"==typeof p&&(r=p.prototype)!==o.prototype&&isObject(r)&&setPrototypeOf&&setPrototypeOf(t,r),t};

},{"./_is-object":85,"./_set-proto":126}],80:[function(require,module,exports){
module.exports=function(e,r,l){var a=void 0===l;switch(r.length){case 0:return a?e():e.call(l);case 1:return a?e(r[0]):e.call(l,r[0]);case 2:return a?e(r[0],r[1]):e.call(l,r[0],r[1]);case 3:return a?e(r[0],r[1],r[2]):e.call(l,r[0],r[1],r[2]);case 4:return a?e(r[0],r[1],r[2],r[3]):e.call(l,r[0],r[1],r[2],r[3])}return e.apply(l,r)};

},{}],81:[function(require,module,exports){
var cof=require("./_cof");module.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==cof(e)?e.split(""):Object(e)};

},{"./_cof":52}],82:[function(require,module,exports){
var Iterators=require("./_iterators"),ITERATOR=require("./_wks")("iterator"),ArrayProto=Array.prototype;module.exports=function(r){return void 0!==r&&(Iterators.Array===r||ArrayProto[ITERATOR]===r)};

},{"./_iterators":92,"./_wks":156}],83:[function(require,module,exports){
var cof=require("./_cof");module.exports=Array.isArray||function(r){return"Array"==cof(r)};

},{"./_cof":52}],84:[function(require,module,exports){
var isObject=require("./_is-object"),floor=Math.floor;module.exports=function(o){return!isObject(o)&&isFinite(o)&&floor(o)===o};

},{"./_is-object":85}],85:[function(require,module,exports){
module.exports=function(o){return"object"==typeof o?null!==o:"function"==typeof o};

},{}],86:[function(require,module,exports){
var isObject=require("./_is-object"),cof=require("./_cof"),MATCH=require("./_wks")("match");module.exports=function(e){var r;return isObject(e)&&(void 0!==(r=e[MATCH])?!!r:"RegExp"==cof(e))};

},{"./_cof":52,"./_is-object":85,"./_wks":156}],87:[function(require,module,exports){
var anObject=require("./_an-object");module.exports=function(r,t,e,a){try{return a?t(anObject(e)[0],e[1]):t(e)}catch(t){var c=r.return;throw void 0!==c&&anObject(c.call(r)),t}};

},{"./_an-object":42}],88:[function(require,module,exports){
"use strict";var create=require("./_object-create"),descriptor=require("./_property-desc"),setToStringTag=require("./_set-to-string-tag"),IteratorPrototype={};require("./_hide")(IteratorPrototype,require("./_wks")("iterator"),function(){return this}),module.exports=function(r,t,e){r.prototype=create(IteratorPrototype,{next:descriptor(1,e)}),setToStringTag(r,t+" Iterator")};

},{"./_hide":76,"./_object-create":102,"./_property-desc":120,"./_set-to-string-tag":128,"./_wks":156}],89:[function(require,module,exports){
"use strict";var LIBRARY=require("./_library"),$export=require("./_export"),redefine=require("./_redefine"),hide=require("./_hide"),Iterators=require("./_iterators"),$iterCreate=require("./_iter-create"),setToStringTag=require("./_set-to-string-tag"),getPrototypeOf=require("./_object-gpo"),ITERATOR=require("./_wks")("iterator"),BUGGY=!([].keys&&"next"in[].keys()),FF_ITERATOR="@@iterator",KEYS="keys",VALUES="values",returnThis=function(){return this};module.exports=function(e,r,t,i,n,o,s){$iterCreate(t,r,i);var u,a,T,R=function(e){if(!BUGGY&&e in E)return E[e];switch(e){case KEYS:case VALUES:return function(){return new t(this,e)}}return function(){return new t(this,e)}},f=r+" Iterator",A=n==VALUES,c=!1,E=e.prototype,I=E[ITERATOR]||E[FF_ITERATOR]||n&&E[n],p=I||R(n),h=n?A?R("entries"):p:void 0,y="Array"==r&&E.entries||I;if(y&&(T=getPrototypeOf(y.call(new e)))!==Object.prototype&&T.next&&(setToStringTag(T,f,!0),LIBRARY||"function"==typeof T[ITERATOR]||hide(T,ITERATOR,returnThis)),A&&I&&I.name!==VALUES&&(c=!0,p=function(){return I.call(this)}),LIBRARY&&!s||!BUGGY&&!c&&E[ITERATOR]||hide(E,ITERATOR,p),Iterators[r]=p,Iterators[f]=returnThis,n)if(u={values:A?p:R(VALUES),keys:o?p:R(KEYS),entries:h},s)for(a in u)a in E||redefine(E,a,u[a]);else $export($export.P+$export.F*(BUGGY||c),r,u);return u};

},{"./_export":66,"./_hide":76,"./_iter-create":88,"./_iterators":92,"./_library":93,"./_object-gpo":109,"./_redefine":122,"./_set-to-string-tag":128,"./_wks":156}],90:[function(require,module,exports){
var ITERATOR=require("./_wks")("iterator"),SAFE_CLOSING=!1;try{var riter=[7][ITERATOR]();riter.return=function(){SAFE_CLOSING=!0},Array.from(riter,function(){throw 2})}catch(r){}module.exports=function(r,t){if(!t&&!SAFE_CLOSING)return!1;var n=!1;try{var e=[7],u=e[ITERATOR]();u.next=function(){return{done:n=!0}},e[ITERATOR]=function(){return u},r(e)}catch(r){}return n};

},{"./_wks":156}],91:[function(require,module,exports){
module.exports=function(e,n){return{value:n,done:!!e}};

},{}],92:[function(require,module,exports){
module.exports={};

},{}],93:[function(require,module,exports){
module.exports=!1;

},{}],94:[function(require,module,exports){
var $expm1=Math.expm1;module.exports=!$expm1||$expm1(10)>22025.465794806718||$expm1(10)<22025.465794806718||-2e-17!=$expm1(-2e-17)?function(e){return 0==(e=+e)?e:e>-1e-6&&e<1e-6?e+e*e/2:Math.exp(e)-1}:$expm1;

},{}],95:[function(require,module,exports){
var sign=require("./_math-sign"),pow=Math.pow,EPSILON=pow(2,-52),EPSILON32=pow(2,-23),MAX32=pow(2,127)*(2-EPSILON32),MIN32=pow(2,-126),roundTiesToEven=function(o){return o+1/EPSILON-1/EPSILON};module.exports=Math.fround||function(o){var n,I,N=Math.abs(o),r=sign(o);return N<MIN32?r*roundTiesToEven(N/MIN32/EPSILON32)*MIN32*EPSILON32:(I=(n=(1+EPSILON32/EPSILON)*N)-(n-N))>MAX32||I!=I?r*(1/0):r*I};

},{"./_math-sign":97}],96:[function(require,module,exports){
module.exports=Math.log1p||function(e){return(e=+e)>-1e-8&&e<1e-8?e-e*e/2:Math.log(1+e)};

},{}],97:[function(require,module,exports){
module.exports=Math.sign||function(n){return 0==(n=+n)||n!=n?n:n<0?-1:1};

},{}],98:[function(require,module,exports){
var META=require("./_uid")("meta"),isObject=require("./_is-object"),has=require("./_has"),setDesc=require("./_object-dp").f,id=0,isExtensible=Object.isExtensible||function(){return!0},FREEZE=!require("./_fails")(function(){return isExtensible(Object.preventExtensions({}))}),setMeta=function(e){setDesc(e,META,{value:{i:"O"+ ++id,w:{}}})},fastKey=function(e,t){if(!isObject(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!has(e,META)){if(!isExtensible(e))return"F";if(!t)return"E";setMeta(e)}return e[META].i},getWeak=function(e,t){if(!has(e,META)){if(!isExtensible(e))return!0;if(!t)return!1;setMeta(e)}return e[META].w},onFreeze=function(e){return FREEZE&&meta.NEED&&isExtensible(e)&&!has(e,META)&&setMeta(e),e},meta=module.exports={KEY:META,NEED:!1,fastKey:fastKey,getWeak:getWeak,onFreeze:onFreeze};

},{"./_fails":68,"./_has":75,"./_is-object":85,"./_object-dp":103,"./_uid":151}],99:[function(require,module,exports){
var global=require("./_global"),macrotask=require("./_task").set,Observer=global.MutationObserver||global.WebKitMutationObserver,process=global.process,Promise=global.Promise,isNode="process"==require("./_cof")(process);module.exports=function(){var e,o,r,a=function(){var a,s;for(isNode&&(a=process.domain)&&a.exit();e;){s=e.fn,e=e.next;try{s()}catch(a){throw e?r():o=void 0,a}}o=void 0,a&&a.enter()};if(isNode)r=function(){process.nextTick(a)};else if(!Observer||global.navigator&&global.navigator.standalone)if(Promise&&Promise.resolve){var s=Promise.resolve(void 0);r=function(){s.then(a)}}else r=function(){macrotask.call(global,a)};else{var t=!0,i=document.createTextNode("");new Observer(a).observe(i,{characterData:!0}),r=function(){i.data=t=!t}}return function(a){var s={fn:a,next:void 0};o&&(o.next=s),e||(e=s,r()),o=s}};

},{"./_cof":52,"./_global":74,"./_task":140}],100:[function(require,module,exports){
"use strict";var aFunction=require("./_a-function");function PromiseCapability(i){var o,r;this.promise=new i(function(i,t){if(void 0!==o||void 0!==r)throw TypeError("Bad Promise constructor");o=i,r=t}),this.resolve=aFunction(o),this.reject=aFunction(r)}module.exports.f=function(i){return new PromiseCapability(i)};

},{"./_a-function":37}],101:[function(require,module,exports){
"use strict";var DESCRIPTORS=require("./_descriptors"),getKeys=require("./_object-keys"),gOPS=require("./_object-gops"),pIE=require("./_object-pie"),toObject=require("./_to-object"),IObject=require("./_iobject"),$assign=Object.assign;module.exports=!$assign||require("./_fails")(function(){var e={},t={},r=Symbol(),s="abcdefghijklmnopqrst";return e[r]=7,s.split("").forEach(function(e){t[e]=e}),7!=$assign({},e)[r]||Object.keys($assign({},t)).join("")!=s})?function(e,t){for(var r=toObject(e),s=arguments.length,i=1,o=gOPS.f,c=pIE.f;s>i;)for(var n,a=IObject(arguments[i++]),g=o?getKeys(a).concat(o(a)):getKeys(a),u=g.length,b=0;u>b;)n=g[b++],DESCRIPTORS&&!c.call(a,n)||(r[n]=a[n]);return r}:$assign;

},{"./_descriptors":62,"./_fails":68,"./_iobject":81,"./_object-gops":108,"./_object-keys":111,"./_object-pie":112,"./_to-object":146}],102:[function(require,module,exports){
var anObject=require("./_an-object"),dPs=require("./_object-dps"),enumBugKeys=require("./_enum-bug-keys"),IE_PROTO=require("./_shared-key")("IE_PROTO"),Empty=function(){},PROTOTYPE="prototype",createDict=function(){var e,t=require("./_dom-create")("iframe"),r=enumBugKeys.length;for(t.style.display="none",require("./_html").appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),createDict=e.F;r--;)delete createDict[PROTOTYPE][enumBugKeys[r]];return createDict()};module.exports=Object.create||function(e,t){var r;return null!==e?(Empty[PROTOTYPE]=anObject(e),r=new Empty,Empty[PROTOTYPE]=null,r[IE_PROTO]=e):r=createDict(),void 0===t?r:dPs(r,t)};

},{"./_an-object":42,"./_dom-create":63,"./_enum-bug-keys":64,"./_html":77,"./_object-dps":104,"./_shared-key":129}],103:[function(require,module,exports){
var anObject=require("./_an-object"),IE8_DOM_DEFINE=require("./_ie8-dom-define"),toPrimitive=require("./_to-primitive"),dP=Object.defineProperty;exports.f=require("./_descriptors")?Object.defineProperty:function(e,r,t){if(anObject(e),r=toPrimitive(r,!0),anObject(t),IE8_DOM_DEFINE)try{return dP(e,r,t)}catch(e){}if("get"in t||"set"in t)throw TypeError("Accessors not supported!");return"value"in t&&(e[r]=t.value),e};

},{"./_an-object":42,"./_descriptors":62,"./_ie8-dom-define":78,"./_to-primitive":147}],104:[function(require,module,exports){
var dP=require("./_object-dp"),anObject=require("./_an-object"),getKeys=require("./_object-keys");module.exports=require("./_descriptors")?Object.defineProperties:function(e,r){anObject(e);for(var t,o=getKeys(r),c=o.length,i=0;c>i;)dP.f(e,t=o[i++],r[t]);return e};

},{"./_an-object":42,"./_descriptors":62,"./_object-dp":103,"./_object-keys":111}],105:[function(require,module,exports){
var pIE=require("./_object-pie"),createDesc=require("./_property-desc"),toIObject=require("./_to-iobject"),toPrimitive=require("./_to-primitive"),has=require("./_has"),IE8_DOM_DEFINE=require("./_ie8-dom-define"),gOPD=Object.getOwnPropertyDescriptor;exports.f=require("./_descriptors")?gOPD:function(e,r){if(e=toIObject(e),r=toPrimitive(r,!0),IE8_DOM_DEFINE)try{return gOPD(e,r)}catch(e){}if(has(e,r))return createDesc(!pIE.f.call(e,r),e[r])};

},{"./_descriptors":62,"./_has":75,"./_ie8-dom-define":78,"./_object-pie":112,"./_property-desc":120,"./_to-iobject":144,"./_to-primitive":147}],106:[function(require,module,exports){
var toIObject=require("./_to-iobject"),gOPN=require("./_object-gopn").f,toString={}.toString,windowNames="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],getWindowNames=function(e){try{return gOPN(e)}catch(e){return windowNames.slice()}};module.exports.f=function(e){return windowNames&&"[object Window]"==toString.call(e)?getWindowNames(e):gOPN(toIObject(e))};

},{"./_object-gopn":107,"./_to-iobject":144}],107:[function(require,module,exports){
var $keys=require("./_object-keys-internal"),hiddenKeys=require("./_enum-bug-keys").concat("length","prototype");exports.f=Object.getOwnPropertyNames||function(e){return $keys(e,hiddenKeys)};

},{"./_enum-bug-keys":64,"./_object-keys-internal":110}],108:[function(require,module,exports){
exports.f=Object.getOwnPropertySymbols;

},{}],109:[function(require,module,exports){
var has=require("./_has"),toObject=require("./_to-object"),IE_PROTO=require("./_shared-key")("IE_PROTO"),ObjectProto=Object.prototype;module.exports=Object.getPrototypeOf||function(t){return t=toObject(t),has(t,IE_PROTO)?t[IE_PROTO]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?ObjectProto:null};

},{"./_has":75,"./_shared-key":129,"./_to-object":146}],110:[function(require,module,exports){
var has=require("./_has"),toIObject=require("./_to-iobject"),arrayIndexOf=require("./_array-includes")(!1),IE_PROTO=require("./_shared-key")("IE_PROTO");module.exports=function(r,e){var a,t=toIObject(r),u=0,O=[];for(a in t)a!=IE_PROTO&&has(t,a)&&O.push(a);for(;e.length>u;)has(t,a=e[u++])&&(~arrayIndexOf(O,a)||O.push(a));return O};

},{"./_array-includes":45,"./_has":75,"./_shared-key":129,"./_to-iobject":144}],111:[function(require,module,exports){
var $keys=require("./_object-keys-internal"),enumBugKeys=require("./_enum-bug-keys");module.exports=Object.keys||function(e){return $keys(e,enumBugKeys)};

},{"./_enum-bug-keys":64,"./_object-keys-internal":110}],112:[function(require,module,exports){
exports.f={}.propertyIsEnumerable;

},{}],113:[function(require,module,exports){
var $export=require("./_export"),core=require("./_core"),fails=require("./_fails");module.exports=function(e,r){var o=(core.Object||{})[e]||Object[e],t={};t[e]=r(o),$export($export.S+$export.F*fails(function(){o(1)}),"Object",t)};

},{"./_core":56,"./_export":66,"./_fails":68}],114:[function(require,module,exports){
var DESCRIPTORS=require("./_descriptors"),getKeys=require("./_object-keys"),toIObject=require("./_to-iobject"),isEnum=require("./_object-pie").f;module.exports=function(e){return function(r){for(var t,o=toIObject(r),u=getKeys(o),i=u.length,c=0,n=[];i>c;)t=u[c++],DESCRIPTORS&&!isEnum.call(o,t)||n.push(e?[t,o[t]]:o[t]);return n}};

},{"./_descriptors":62,"./_object-keys":111,"./_object-pie":112,"./_to-iobject":144}],115:[function(require,module,exports){
var gOPN=require("./_object-gopn"),gOPS=require("./_object-gops"),anObject=require("./_an-object"),Reflect=require("./_global").Reflect;module.exports=Reflect&&Reflect.ownKeys||function(e){var r=gOPN.f(anObject(e)),t=gOPS.f;return t?r.concat(t(e)):r};

},{"./_an-object":42,"./_global":74,"./_object-gopn":107,"./_object-gops":108}],116:[function(require,module,exports){
var $parseFloat=require("./_global").parseFloat,$trim=require("./_string-trim").trim;module.exports=1/$parseFloat(require("./_string-ws")+"-0")!=-1/0?function(r){var t=$trim(String(r),3),a=$parseFloat(t);return 0===a&&"-"==t.charAt(0)?-0:a}:$parseFloat;

},{"./_global":74,"./_string-trim":138,"./_string-ws":139}],117:[function(require,module,exports){
var $parseInt=require("./_global").parseInt,$trim=require("./_string-trim").trim,ws=require("./_string-ws"),hex=/^[-+]?0[xX]/;module.exports=8!==$parseInt(ws+"08")||22!==$parseInt(ws+"0x16")?function(r,e){var t=$trim(String(r),3);return $parseInt(t,e>>>0||(hex.test(t)?16:10))}:$parseInt;

},{"./_global":74,"./_string-trim":138,"./_string-ws":139}],118:[function(require,module,exports){
module.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}};

},{}],119:[function(require,module,exports){
var anObject=require("./_an-object"),isObject=require("./_is-object"),newPromiseCapability=require("./_new-promise-capability");module.exports=function(e,r){if(anObject(e),isObject(r)&&r.constructor===e)return r;var i=newPromiseCapability.f(e);return(0,i.resolve)(r),i.promise};

},{"./_an-object":42,"./_is-object":85,"./_new-promise-capability":100}],120:[function(require,module,exports){
module.exports=function(e,r){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:r}};

},{}],121:[function(require,module,exports){
var redefine=require("./_redefine");module.exports=function(e,r,n){for(var i in r)redefine(e,i,r[i],n);return e};

},{"./_redefine":122}],122:[function(require,module,exports){
var global=require("./_global"),hide=require("./_hide"),has=require("./_has"),SRC=require("./_uid")("src"),$toString=require("./_function-to-string"),TO_STRING="toString",TPL=(""+$toString).split(TO_STRING);require("./_core").inspectSource=function(e){return $toString.call(e)},(module.exports=function(e,i,t,r){var n="function"==typeof t;n&&(has(t,"name")||hide(t,"name",i)),e[i]!==t&&(n&&(has(t,SRC)||hide(t,SRC,e[i]?""+e[i]:TPL.join(String(i)))),e===global?e[i]=t:r?e[i]?e[i]=t:hide(e,i,t):(delete e[i],hide(e,i,t)))})(Function.prototype,TO_STRING,function(){return"function"==typeof this&&this[SRC]||$toString.call(this)});

},{"./_core":56,"./_function-to-string":73,"./_global":74,"./_has":75,"./_hide":76,"./_uid":151}],123:[function(require,module,exports){
"use strict";var classof=require("./_classof"),builtinExec=RegExp.prototype.exec;module.exports=function(e,r){var t=e.exec;if("function"==typeof t){var o=t.call(e,r);if("object"!=typeof o)throw new TypeError("RegExp exec method returned something other than an Object or null");return o}if("RegExp"!==classof(e))throw new TypeError("RegExp#exec called on incompatible receiver");return builtinExec.call(e,r)};

},{"./_classof":51}],124:[function(require,module,exports){
"use strict";var regexpFlags=require("./_flags"),nativeExec=RegExp.prototype.exec,nativeReplace=String.prototype.replace,patchedExec=nativeExec,LAST_INDEX="lastIndex",UPDATES_LAST_INDEX_WRONG=function(){var e=/a/,a=/b*/g;return nativeExec.call(e,"a"),nativeExec.call(a,"a"),0!==e[LAST_INDEX]||0!==a[LAST_INDEX]}(),NPCG_INCLUDED=void 0!==/()??/.exec("")[1],PATCH=UPDATES_LAST_INDEX_WRONG||NPCG_INCLUDED;PATCH&&(patchedExec=function(e){var a,t,E,c,l=this;return NPCG_INCLUDED&&(t=new RegExp("^"+l.source+"$(?!\\s)",regexpFlags.call(l))),UPDATES_LAST_INDEX_WRONG&&(a=l[LAST_INDEX]),E=nativeExec.call(l,e),UPDATES_LAST_INDEX_WRONG&&E&&(l[LAST_INDEX]=l.global?E.index+E[0].length:a),NPCG_INCLUDED&&E&&E.length>1&&nativeReplace.call(E[0],t,function(){for(c=1;c<arguments.length-2;c++)void 0===arguments[c]&&(E[c]=void 0)}),E}),module.exports=patchedExec;

},{"./_flags":70}],125:[function(require,module,exports){
module.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t};

},{}],126:[function(require,module,exports){
var isObject=require("./_is-object"),anObject=require("./_an-object"),check=function(t,e){if(anObject(t),!isObject(e)&&null!==e)throw TypeError(e+": can't set as prototype!")};module.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,e,c){try{(c=require("./_ctx")(Function.call,require("./_object-gopd").f(Object.prototype,"__proto__").set,2))(t,[]),e=!(t instanceof Array)}catch(t){e=!0}return function(t,r){return check(t,r),e?t.__proto__=r:c(t,r),t}}({},!1):void 0),check:check};

},{"./_an-object":42,"./_ctx":58,"./_is-object":85,"./_object-gopd":105}],127:[function(require,module,exports){
"use strict";var global=require("./_global"),dP=require("./_object-dp"),DESCRIPTORS=require("./_descriptors"),SPECIES=require("./_wks")("species");module.exports=function(e){var r=global[e];DESCRIPTORS&&r&&!r[SPECIES]&&dP.f(r,SPECIES,{configurable:!0,get:function(){return this}})};

},{"./_descriptors":62,"./_global":74,"./_object-dp":103,"./_wks":156}],128:[function(require,module,exports){
var def=require("./_object-dp").f,has=require("./_has"),TAG=require("./_wks")("toStringTag");module.exports=function(e,r,o){e&&!has(e=o?e:e.prototype,TAG)&&def(e,TAG,{configurable:!0,value:r})};

},{"./_has":75,"./_object-dp":103,"./_wks":156}],129:[function(require,module,exports){
var shared=require("./_shared")("keys"),uid=require("./_uid");module.exports=function(e){return shared[e]||(shared[e]=uid(e))};

},{"./_shared":130,"./_uid":151}],130:[function(require,module,exports){
var core=require("./_core"),global=require("./_global"),SHARED="__core-js_shared__",store=global[SHARED]||(global[SHARED]={});(module.exports=function(r,e){return store[r]||(store[r]=void 0!==e?e:{})})("versions",[]).push({version:core.version,mode:require("./_library")?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"});

},{"./_core":56,"./_global":74,"./_library":93}],131:[function(require,module,exports){
var anObject=require("./_an-object"),aFunction=require("./_a-function"),SPECIES=require("./_wks")("species");module.exports=function(e,n){var r,t=anObject(e).constructor;return void 0===t||null==(r=anObject(t)[SPECIES])?n:aFunction(r)};

},{"./_a-function":37,"./_an-object":42,"./_wks":156}],132:[function(require,module,exports){
"use strict";var fails=require("./_fails");module.exports=function(l,n){return!!l&&fails(function(){n?l.call(null,function(){},1):l.call(null)})};

},{"./_fails":68}],133:[function(require,module,exports){
var toInteger=require("./_to-integer"),defined=require("./_defined");module.exports=function(e){return function(r,t){var n,i,d=String(defined(r)),o=toInteger(t),u=d.length;return o<0||o>=u?e?"":void 0:(n=d.charCodeAt(o))<55296||n>56319||o+1===u||(i=d.charCodeAt(o+1))<56320||i>57343?e?d.charAt(o):n:e?d.slice(o,o+2):i-56320+(n-55296<<10)+65536}};

},{"./_defined":61,"./_to-integer":143}],134:[function(require,module,exports){
var isRegExp=require("./_is-regexp"),defined=require("./_defined");module.exports=function(e,r,i){if(isRegExp(r))throw TypeError("String#"+i+" doesn't accept regex!");return String(defined(e))};

},{"./_defined":61,"./_is-regexp":86}],135:[function(require,module,exports){
var $export=require("./_export"),fails=require("./_fails"),defined=require("./_defined"),quot=/"/g,createHTML=function(e,r,t,i){var n=String(defined(e)),o="<"+r;return""!==t&&(o+=" "+t+'="'+String(i).replace(quot,"&quot;")+'"'),o+">"+n+"</"+r+">"};module.exports=function(e,r){var t={};t[e]=r(createHTML),$export($export.P+$export.F*fails(function(){var r=""[e]('"');return r!==r.toLowerCase()||r.split('"').length>3}),"String",t)};

},{"./_defined":61,"./_export":66,"./_fails":68}],136:[function(require,module,exports){
var toLength=require("./_to-length"),repeat=require("./_string-repeat"),defined=require("./_defined");module.exports=function(e,r,t,n){var i=String(defined(e)),g=i.length,l=void 0===t?" ":String(t),a=toLength(r);if(a<=g||""==l)return i;var d=a-g,h=repeat.call(l,Math.ceil(d/l.length));return h.length>d&&(h=h.slice(0,d)),n?h+i:i+h};

},{"./_defined":61,"./_string-repeat":137,"./_to-length":145}],137:[function(require,module,exports){
"use strict";var toInteger=require("./_to-integer"),defined=require("./_defined");module.exports=function(e){var r=String(defined(this)),t="",n=toInteger(e);if(n<0||n==1/0)throw RangeError("Count can't be negative");for(;n>0;(n>>>=1)&&(r+=r))1&n&&(t+=r);return t};

},{"./_defined":61,"./_to-integer":143}],138:[function(require,module,exports){
var $export=require("./_export"),defined=require("./_defined"),fails=require("./_fails"),spaces=require("./_string-ws"),space="["+spaces+"]",non="​",ltrim=RegExp("^"+space+space+"*"),rtrim=RegExp(space+space+"*$"),exporter=function(e,r,t){var i={},p=fails(function(){return!!spaces[e]()||non[e]()!=non}),n=i[e]=p?r(trim):spaces[e];t&&(i[t]=n),$export($export.P+$export.F*p,"String",i)},trim=exporter.trim=function(e,r){return e=String(defined(e)),1&r&&(e=e.replace(ltrim,"")),2&r&&(e=e.replace(rtrim,"")),e};module.exports=exporter;

},{"./_defined":61,"./_export":66,"./_fails":68,"./_string-ws":139}],139:[function(require,module,exports){
module.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff";

},{}],140:[function(require,module,exports){
var defer,channel,port,ctx=require("./_ctx"),invoke=require("./_invoke"),html=require("./_html"),cel=require("./_dom-create"),global=require("./_global"),process=global.process,setTask=global.setImmediate,clearTask=global.clearImmediate,MessageChannel=global.MessageChannel,Dispatch=global.Dispatch,counter=0,queue={},ONREADYSTATECHANGE="onreadystatechange",run=function(){var e=+this;if(queue.hasOwnProperty(e)){var t=queue[e];delete queue[e],t()}},listener=function(e){run.call(e.data)};setTask&&clearTask||(setTask=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return queue[++counter]=function(){invoke("function"==typeof e?e:Function(e),t)},defer(counter),counter},clearTask=function(e){delete queue[e]},"process"==require("./_cof")(process)?defer=function(e){process.nextTick(ctx(run,e,1))}:Dispatch&&Dispatch.now?defer=function(e){Dispatch.now(ctx(run,e,1))}:MessageChannel?(port=(channel=new MessageChannel).port2,channel.port1.onmessage=listener,defer=ctx(port.postMessage,port,1)):global.addEventListener&&"function"==typeof postMessage&&!global.importScripts?(defer=function(e){global.postMessage(e+"","*")},global.addEventListener("message",listener,!1)):defer=ONREADYSTATECHANGE in cel("script")?function(e){html.appendChild(cel("script"))[ONREADYSTATECHANGE]=function(){html.removeChild(this),run.call(e)}}:function(e){setTimeout(ctx(run,e,1),0)}),module.exports={set:setTask,clear:clearTask};

},{"./_cof":52,"./_ctx":58,"./_dom-create":63,"./_global":74,"./_html":77,"./_invoke":80}],141:[function(require,module,exports){
var toInteger=require("./_to-integer"),max=Math.max,min=Math.min;module.exports=function(e,t){return(e=toInteger(e))<0?max(e+t,0):min(e,t)};

},{"./_to-integer":143}],142:[function(require,module,exports){
var toInteger=require("./_to-integer"),toLength=require("./_to-length");module.exports=function(e){if(void 0===e)return 0;var r=toInteger(e),t=toLength(r);if(r!==t)throw RangeError("Wrong length!");return t};

},{"./_to-integer":143,"./_to-length":145}],143:[function(require,module,exports){
var ceil=Math.ceil,floor=Math.floor;module.exports=function(o){return isNaN(o=+o)?0:(o>0?floor:ceil)(o)};

},{}],144:[function(require,module,exports){
var IObject=require("./_iobject"),defined=require("./_defined");module.exports=function(e){return IObject(defined(e))};

},{"./_defined":61,"./_iobject":81}],145:[function(require,module,exports){
var toInteger=require("./_to-integer"),min=Math.min;module.exports=function(e){return e>0?min(toInteger(e),9007199254740991):0};

},{"./_to-integer":143}],146:[function(require,module,exports){
var defined=require("./_defined");module.exports=function(e){return Object(defined(e))};

},{"./_defined":61}],147:[function(require,module,exports){
var isObject=require("./_is-object");module.exports=function(t,e){if(!isObject(t))return t;var r,i;if(e&&"function"==typeof(r=t.toString)&&!isObject(i=r.call(t)))return i;if("function"==typeof(r=t.valueOf)&&!isObject(i=r.call(t)))return i;if(!e&&"function"==typeof(r=t.toString)&&!isObject(i=r.call(t)))return i;throw TypeError("Can't convert object to primitive value")};

},{"./_is-object":85}],148:[function(require,module,exports){
"use strict";if(require("./_descriptors")){var LIBRARY=require("./_library"),global=require("./_global"),fails=require("./_fails"),$export=require("./_export"),$typed=require("./_typed"),$buffer=require("./_typed-buffer"),ctx=require("./_ctx"),anInstance=require("./_an-instance"),propertyDesc=require("./_property-desc"),hide=require("./_hide"),redefineAll=require("./_redefine-all"),toInteger=require("./_to-integer"),toLength=require("./_to-length"),toIndex=require("./_to-index"),toAbsoluteIndex=require("./_to-absolute-index"),toPrimitive=require("./_to-primitive"),has=require("./_has"),classof=require("./_classof"),isObject=require("./_is-object"),toObject=require("./_to-object"),isArrayIter=require("./_is-array-iter"),create=require("./_object-create"),getPrototypeOf=require("./_object-gpo"),gOPN=require("./_object-gopn").f,getIterFn=require("./core.get-iterator-method"),uid=require("./_uid"),wks=require("./_wks"),createArrayMethod=require("./_array-methods"),createArrayIncludes=require("./_array-includes"),speciesConstructor=require("./_species-constructor"),ArrayIterators=require("./es6.array.iterator"),Iterators=require("./_iterators"),$iterDetect=require("./_iter-detect"),setSpecies=require("./_set-species"),arrayFill=require("./_array-fill"),arrayCopyWithin=require("./_array-copy-within"),$DP=require("./_object-dp"),$GOPD=require("./_object-gopd"),dP=$DP.f,gOPD=$GOPD.f,RangeError=global.RangeError,TypeError=global.TypeError,Uint8Array=global.Uint8Array,ARRAY_BUFFER="ArrayBuffer",SHARED_BUFFER="Shared"+ARRAY_BUFFER,BYTES_PER_ELEMENT="BYTES_PER_ELEMENT",PROTOTYPE="prototype",ArrayProto=Array[PROTOTYPE],$ArrayBuffer=$buffer.ArrayBuffer,$DataView=$buffer.DataView,arrayForEach=createArrayMethod(0),arrayFilter=createArrayMethod(2),arraySome=createArrayMethod(3),arrayEvery=createArrayMethod(4),arrayFind=createArrayMethod(5),arrayFindIndex=createArrayMethod(6),arrayIncludes=createArrayIncludes(!0),arrayIndexOf=createArrayIncludes(!1),arrayValues=ArrayIterators.values,arrayKeys=ArrayIterators.keys,arrayEntries=ArrayIterators.entries,arrayLastIndexOf=ArrayProto.lastIndexOf,arrayReduce=ArrayProto.reduce,arrayReduceRight=ArrayProto.reduceRight,arrayJoin=ArrayProto.join,arraySort=ArrayProto.sort,arraySlice=ArrayProto.slice,arrayToString=ArrayProto.toString,arrayToLocaleString=ArrayProto.toLocaleString,ITERATOR=wks("iterator"),TAG=wks("toStringTag"),TYPED_CONSTRUCTOR=uid("typed_constructor"),DEF_CONSTRUCTOR=uid("def_constructor"),ALL_CONSTRUCTORS=$typed.CONSTR,TYPED_ARRAY=$typed.TYPED,VIEW=$typed.VIEW,WRONG_LENGTH="Wrong length!",$map=createArrayMethod(1,function(r,e){return allocate(speciesConstructor(r,r[DEF_CONSTRUCTOR]),e)}),LITTLE_ENDIAN=fails(function(){return 1===new Uint8Array(new Uint16Array([1]).buffer)[0]}),FORCED_SET=!!Uint8Array&&!!Uint8Array[PROTOTYPE].set&&fails(function(){new Uint8Array(1).set({})}),toOffset=function(r,e){var t=toInteger(r);if(t<0||t%e)throw RangeError("Wrong offset!");return t},validate=function(r){if(isObject(r)&&TYPED_ARRAY in r)return r;throw TypeError(r+" is not a typed array!")},allocate=function(r,e){if(!(isObject(r)&&TYPED_CONSTRUCTOR in r))throw TypeError("It is not a typed array constructor!");return new r(e)},speciesFromList=function(r,e){return fromList(speciesConstructor(r,r[DEF_CONSTRUCTOR]),e)},fromList=function(r,e){for(var t=0,a=e.length,i=allocate(r,a);a>t;)i[t]=e[t++];return i},addGetter=function(r,e,t){dP(r,e,{get:function(){return this._d[t]}})},$from=function(r){var e,t,a,i,o,n,s=toObject(r),c=arguments.length,u=c>1?arguments[1]:void 0,l=void 0!==u,f=getIterFn(s);if(null!=f&&!isArrayIter(f)){for(n=f.call(s),a=[],e=0;!(o=n.next()).done;e++)a.push(o.value);s=a}for(l&&c>2&&(u=ctx(u,arguments[2],2)),e=0,t=toLength(s.length),i=allocate(this,t);t>e;e++)i[e]=l?u(s[e],e):s[e];return i},$of=function(){for(var r=0,e=arguments.length,t=allocate(this,e);e>r;)t[r]=arguments[r++];return t},TO_LOCALE_BUG=!!Uint8Array&&fails(function(){arrayToLocaleString.call(new Uint8Array(1))}),$toLocaleString=function(){return arrayToLocaleString.apply(TO_LOCALE_BUG?arraySlice.call(validate(this)):validate(this),arguments)},proto={copyWithin:function(r,e){return arrayCopyWithin.call(validate(this),r,e,arguments.length>2?arguments[2]:void 0)},every:function(r){return arrayEvery(validate(this),r,arguments.length>1?arguments[1]:void 0)},fill:function(r){return arrayFill.apply(validate(this),arguments)},filter:function(r){return speciesFromList(this,arrayFilter(validate(this),r,arguments.length>1?arguments[1]:void 0))},find:function(r){return arrayFind(validate(this),r,arguments.length>1?arguments[1]:void 0)},findIndex:function(r){return arrayFindIndex(validate(this),r,arguments.length>1?arguments[1]:void 0)},forEach:function(r){arrayForEach(validate(this),r,arguments.length>1?arguments[1]:void 0)},indexOf:function(r){return arrayIndexOf(validate(this),r,arguments.length>1?arguments[1]:void 0)},includes:function(r){return arrayIncludes(validate(this),r,arguments.length>1?arguments[1]:void 0)},join:function(r){return arrayJoin.apply(validate(this),arguments)},lastIndexOf:function(r){return arrayLastIndexOf.apply(validate(this),arguments)},map:function(r){return $map(validate(this),r,arguments.length>1?arguments[1]:void 0)},reduce:function(r){return arrayReduce.apply(validate(this),arguments)},reduceRight:function(r){return arrayReduceRight.apply(validate(this),arguments)},reverse:function(){for(var r,e=validate(this).length,t=Math.floor(e/2),a=0;a<t;)r=this[a],this[a++]=this[--e],this[e]=r;return this},some:function(r){return arraySome(validate(this),r,arguments.length>1?arguments[1]:void 0)},sort:function(r){return arraySort.call(validate(this),r)},subarray:function(r,e){var t=validate(this),a=t.length,i=toAbsoluteIndex(r,a);return new(speciesConstructor(t,t[DEF_CONSTRUCTOR]))(t.buffer,t.byteOffset+i*t.BYTES_PER_ELEMENT,toLength((void 0===e?a:toAbsoluteIndex(e,a))-i))}},$slice=function(r,e){return speciesFromList(this,arraySlice.call(validate(this),r,e))},$set=function(r){validate(this);var e=toOffset(arguments[1],1),t=this.length,a=toObject(r),i=toLength(a.length),o=0;if(i+e>t)throw RangeError(WRONG_LENGTH);for(;o<i;)this[e+o]=a[o++]},$iterators={entries:function(){return arrayEntries.call(validate(this))},keys:function(){return arrayKeys.call(validate(this))},values:function(){return arrayValues.call(validate(this))}},isTAIndex=function(r,e){return isObject(r)&&r[TYPED_ARRAY]&&"symbol"!=typeof e&&e in r&&String(+e)==String(e)},$getDesc=function(r,e){return isTAIndex(r,e=toPrimitive(e,!0))?propertyDesc(2,r[e]):gOPD(r,e)},$setDesc=function(r,e,t){return!(isTAIndex(r,e=toPrimitive(e,!0))&&isObject(t)&&has(t,"value"))||has(t,"get")||has(t,"set")||t.configurable||has(t,"writable")&&!t.writable||has(t,"enumerable")&&!t.enumerable?dP(r,e,t):(r[e]=t.value,r)};ALL_CONSTRUCTORS||($GOPD.f=$getDesc,$DP.f=$setDesc),$export($export.S+$export.F*!ALL_CONSTRUCTORS,"Object",{getOwnPropertyDescriptor:$getDesc,defineProperty:$setDesc}),fails(function(){arrayToString.call({})})&&(arrayToString=arrayToLocaleString=function(){return arrayJoin.call(this)});var $TypedArrayPrototype$=redefineAll({},proto);redefineAll($TypedArrayPrototype$,$iterators),hide($TypedArrayPrototype$,ITERATOR,$iterators.values),redefineAll($TypedArrayPrototype$,{slice:$slice,set:$set,constructor:function(){},toString:arrayToString,toLocaleString:$toLocaleString}),addGetter($TypedArrayPrototype$,"buffer","b"),addGetter($TypedArrayPrototype$,"byteOffset","o"),addGetter($TypedArrayPrototype$,"byteLength","l"),addGetter($TypedArrayPrototype$,"length","e"),dP($TypedArrayPrototype$,TAG,{get:function(){return this[TYPED_ARRAY]}}),module.exports=function(r,e,t,a){var i=r+((a=!!a)?"Clamped":"")+"Array",o="get"+r,n="set"+r,s=global[i],c=s||{},u=s&&getPrototypeOf(s),l=!s||!$typed.ABV,f={},y=s&&s[PROTOTYPE],d=function(r,t){dP(r,t,{get:function(){return function(r,t){var a=r._d;return a.v[o](t*e+a.o,LITTLE_ENDIAN)}(this,t)},set:function(r){return function(r,t,i){var o=r._d;a&&(i=(i=Math.round(i))<0?0:i>255?255:255&i),o.v[n](t*e+o.o,i,LITTLE_ENDIAN)}(this,t,r)},enumerable:!0})};l?(s=t(function(r,t,a,o){anInstance(r,s,i,"_d");var n,c,u,l,f=0,y=0;if(isObject(t)){if(!(t instanceof $ArrayBuffer||(l=classof(t))==ARRAY_BUFFER||l==SHARED_BUFFER))return TYPED_ARRAY in t?fromList(s,t):$from.call(s,t);n=t,y=toOffset(a,e);var h=t.byteLength;if(void 0===o){if(h%e)throw RangeError(WRONG_LENGTH);if((c=h-y)<0)throw RangeError(WRONG_LENGTH)}else if((c=toLength(o)*e)+y>h)throw RangeError(WRONG_LENGTH);u=c/e}else u=toIndex(t),n=new $ArrayBuffer(c=u*e);for(hide(r,"_d",{b:n,o:y,l:c,e:u,v:new $DataView(n)});f<u;)d(r,f++)}),y=s[PROTOTYPE]=create($TypedArrayPrototype$),hide(y,"constructor",s)):fails(function(){s(1)})&&fails(function(){new s(-1)})&&$iterDetect(function(r){new s,new s(null),new s(1.5),new s(r)},!0)||(s=t(function(r,t,a,o){var n;return anInstance(r,s,i),isObject(t)?t instanceof $ArrayBuffer||(n=classof(t))==ARRAY_BUFFER||n==SHARED_BUFFER?void 0!==o?new c(t,toOffset(a,e),o):void 0!==a?new c(t,toOffset(a,e)):new c(t):TYPED_ARRAY in t?fromList(s,t):$from.call(s,t):new c(toIndex(t))}),arrayForEach(u!==Function.prototype?gOPN(c).concat(gOPN(u)):gOPN(c),function(r){r in s||hide(s,r,c[r])}),s[PROTOTYPE]=y,LIBRARY||(y.constructor=s));var h=y[ITERATOR],p=!!h&&("values"==h.name||null==h.name),T=$iterators.values;hide(s,TYPED_CONSTRUCTOR,!0),hide(y,TYPED_ARRAY,i),hide(y,VIEW,!0),hide(y,DEF_CONSTRUCTOR,s),(a?new s(1)[TAG]==i:TAG in y)||dP(y,TAG,{get:function(){return i}}),f[i]=s,$export($export.G+$export.W+$export.F*(s!=c),f),$export($export.S,i,{BYTES_PER_ELEMENT:e}),$export($export.S+$export.F*fails(function(){c.of.call(s,1)}),i,{from:$from,of:$of}),BYTES_PER_ELEMENT in y||hide(y,BYTES_PER_ELEMENT,e),$export($export.P,i,proto),setSpecies(i),$export($export.P+$export.F*FORCED_SET,i,{set:$set}),$export($export.P+$export.F*!p,i,$iterators),LIBRARY||y.toString==arrayToString||(y.toString=arrayToString),$export($export.P+$export.F*fails(function(){new s(1).slice()}),i,{slice:$slice}),$export($export.P+$export.F*(fails(function(){return[1,2].toLocaleString()!=new s([1,2]).toLocaleString()})||!fails(function(){y.toLocaleString.call([1,2])})),i,{toLocaleString:$toLocaleString}),Iterators[i]=p?h:T,LIBRARY||p||hide(y,ITERATOR,T)}}else module.exports=function(){};

},{"./_an-instance":41,"./_array-copy-within":43,"./_array-fill":44,"./_array-includes":45,"./_array-methods":46,"./_classof":51,"./_ctx":58,"./_descriptors":62,"./_export":66,"./_fails":68,"./_global":74,"./_has":75,"./_hide":76,"./_is-array-iter":82,"./_is-object":85,"./_iter-detect":90,"./_iterators":92,"./_library":93,"./_object-create":102,"./_object-dp":103,"./_object-gopd":105,"./_object-gopn":107,"./_object-gpo":109,"./_property-desc":120,"./_redefine-all":121,"./_set-species":127,"./_species-constructor":131,"./_to-absolute-index":141,"./_to-index":142,"./_to-integer":143,"./_to-length":145,"./_to-object":146,"./_to-primitive":147,"./_typed":150,"./_typed-buffer":149,"./_uid":151,"./_wks":156,"./core.get-iterator-method":157,"./es6.array.iterator":168}],149:[function(require,module,exports){
"use strict";var global=require("./_global"),DESCRIPTORS=require("./_descriptors"),LIBRARY=require("./_library"),$typed=require("./_typed"),hide=require("./_hide"),redefineAll=require("./_redefine-all"),fails=require("./_fails"),anInstance=require("./_an-instance"),toInteger=require("./_to-integer"),toLength=require("./_to-length"),toIndex=require("./_to-index"),gOPN=require("./_object-gopn").f,dP=require("./_object-dp").f,arrayFill=require("./_array-fill"),setToStringTag=require("./_set-to-string-tag"),ARRAY_BUFFER="ArrayBuffer",DATA_VIEW="DataView",PROTOTYPE="prototype",WRONG_LENGTH="Wrong length!",WRONG_INDEX="Wrong index!",$ArrayBuffer=global[ARRAY_BUFFER],$DataView=global[DATA_VIEW],Math=global.Math,RangeError=global.RangeError,Infinity=global.Infinity,BaseBuffer=$ArrayBuffer,abs=Math.abs,pow=Math.pow,floor=Math.floor,log=Math.log,LN2=Math.LN2,BUFFER="buffer",BYTE_LENGTH="byteLength",BYTE_OFFSET="byteOffset",$BUFFER=DESCRIPTORS?"_b":BUFFER,$LENGTH=DESCRIPTORS?"_l":BYTE_LENGTH,$OFFSET=DESCRIPTORS?"_o":BYTE_OFFSET;function packIEEE754(t,e,r){var n,a,i,f=new Array(r),o=8*r-e-1,u=(1<<o)-1,s=u>>1,E=23===e?pow(2,-24)-pow(2,-77):0,c=0,I=t<0||0===t&&1/t<0?1:0;for((t=abs(t))!=t||t===Infinity?(a=t!=t?1:0,n=u):(n=floor(log(t)/LN2),t*(i=pow(2,-n))<1&&(n--,i*=2),(t+=n+s>=1?E/i:E*pow(2,1-s))*i>=2&&(n++,i/=2),n+s>=u?(a=0,n=u):n+s>=1?(a=(t*i-1)*pow(2,e),n+=s):(a=t*pow(2,s-1)*pow(2,e),n=0));e>=8;f[c++]=255&a,a/=256,e-=8);for(n=n<<e|a,o+=e;o>0;f[c++]=255&n,n/=256,o-=8);return f[--c]|=128*I,f}function unpackIEEE754(t,e,r){var n,a=8*r-e-1,i=(1<<a)-1,f=i>>1,o=a-7,u=r-1,s=t[u--],E=127&s;for(s>>=7;o>0;E=256*E+t[u],u--,o-=8);for(n=E&(1<<-o)-1,E>>=-o,o+=e;o>0;n=256*n+t[u],u--,o-=8);if(0===E)E=1-f;else{if(E===i)return n?NaN:s?-Infinity:Infinity;n+=pow(2,e),E-=f}return(s?-1:1)*n*pow(2,E-e)}function unpackI32(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]}function packI8(t){return[255&t]}function packI16(t){return[255&t,t>>8&255]}function packI32(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]}function packF64(t){return packIEEE754(t,52,8)}function packF32(t){return packIEEE754(t,23,4)}function addGetter(t,e,r){dP(t[PROTOTYPE],e,{get:function(){return this[r]}})}function get(t,e,r,n){var a=toIndex(+r);if(a+e>t[$LENGTH])throw RangeError(WRONG_INDEX);var i=t[$BUFFER]._b,f=a+t[$OFFSET],o=i.slice(f,f+e);return n?o:o.reverse()}function set(t,e,r,n,a,i){var f=toIndex(+r);if(f+e>t[$LENGTH])throw RangeError(WRONG_INDEX);for(var o=t[$BUFFER]._b,u=f+t[$OFFSET],s=n(+a),E=0;E<e;E++)o[u+E]=s[i?E:e-E-1]}if($typed.ABV){if(!fails(function(){$ArrayBuffer(1)})||!fails(function(){new $ArrayBuffer(-1)})||fails(function(){return new $ArrayBuffer,new $ArrayBuffer(1.5),new $ArrayBuffer(NaN),$ArrayBuffer.name!=ARRAY_BUFFER})){for(var key,ArrayBufferProto=($ArrayBuffer=function(t){return anInstance(this,$ArrayBuffer),new BaseBuffer(toIndex(t))})[PROTOTYPE]=BaseBuffer[PROTOTYPE],keys=gOPN(BaseBuffer),j=0;keys.length>j;)(key=keys[j++])in $ArrayBuffer||hide($ArrayBuffer,key,BaseBuffer[key]);LIBRARY||(ArrayBufferProto.constructor=$ArrayBuffer)}var view=new $DataView(new $ArrayBuffer(2)),$setInt8=$DataView[PROTOTYPE].setInt8;view.setInt8(0,2147483648),view.setInt8(1,2147483649),!view.getInt8(0)&&view.getInt8(1)||redefineAll($DataView[PROTOTYPE],{setInt8:function(t,e){$setInt8.call(this,t,e<<24>>24)},setUint8:function(t,e){$setInt8.call(this,t,e<<24>>24)}},!0)}else $ArrayBuffer=function(t){anInstance(this,$ArrayBuffer,ARRAY_BUFFER);var e=toIndex(t);this._b=arrayFill.call(new Array(e),0),this[$LENGTH]=e},$DataView=function(t,e,r){anInstance(this,$DataView,DATA_VIEW),anInstance(t,$ArrayBuffer,DATA_VIEW);var n=t[$LENGTH],a=toInteger(e);if(a<0||a>n)throw RangeError("Wrong offset!");if(a+(r=void 0===r?n-a:toLength(r))>n)throw RangeError(WRONG_LENGTH);this[$BUFFER]=t,this[$OFFSET]=a,this[$LENGTH]=r},DESCRIPTORS&&(addGetter($ArrayBuffer,BYTE_LENGTH,"_l"),addGetter($DataView,BUFFER,"_b"),addGetter($DataView,BYTE_LENGTH,"_l"),addGetter($DataView,BYTE_OFFSET,"_o")),redefineAll($DataView[PROTOTYPE],{getInt8:function(t){return get(this,1,t)[0]<<24>>24},getUint8:function(t){return get(this,1,t)[0]},getInt16:function(t){var e=get(this,2,t,arguments[1]);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=get(this,2,t,arguments[1]);return e[1]<<8|e[0]},getInt32:function(t){return unpackI32(get(this,4,t,arguments[1]))},getUint32:function(t){return unpackI32(get(this,4,t,arguments[1]))>>>0},getFloat32:function(t){return unpackIEEE754(get(this,4,t,arguments[1]),23,4)},getFloat64:function(t){return unpackIEEE754(get(this,8,t,arguments[1]),52,8)},setInt8:function(t,e){set(this,1,t,packI8,e)},setUint8:function(t,e){set(this,1,t,packI8,e)},setInt16:function(t,e){set(this,2,t,packI16,e,arguments[2])},setUint16:function(t,e){set(this,2,t,packI16,e,arguments[2])},setInt32:function(t,e){set(this,4,t,packI32,e,arguments[2])},setUint32:function(t,e){set(this,4,t,packI32,e,arguments[2])},setFloat32:function(t,e){set(this,4,t,packF32,e,arguments[2])},setFloat64:function(t,e){set(this,8,t,packF64,e,arguments[2])}});setToStringTag($ArrayBuffer,ARRAY_BUFFER),setToStringTag($DataView,DATA_VIEW),hide($DataView[PROTOTYPE],$typed.VIEW,!0),exports[ARRAY_BUFFER]=$ArrayBuffer,exports[DATA_VIEW]=$DataView;

},{"./_an-instance":41,"./_array-fill":44,"./_descriptors":62,"./_fails":68,"./_global":74,"./_hide":76,"./_library":93,"./_object-dp":103,"./_object-gopn":107,"./_redefine-all":121,"./_set-to-string-tag":128,"./_to-index":142,"./_to-integer":143,"./_to-length":145,"./_typed":150}],150:[function(require,module,exports){
for(var Typed,global=require("./_global"),hide=require("./_hide"),uid=require("./_uid"),TYPED=uid("typed_array"),VIEW=uid("view"),ABV=!(!global.ArrayBuffer||!global.DataView),CONSTR=ABV,i=0,l=9,TypedArrayConstructors="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");i<l;)(Typed=global[TypedArrayConstructors[i++]])?(hide(Typed.prototype,TYPED,!0),hide(Typed.prototype,VIEW,!0)):CONSTR=!1;module.exports={ABV:ABV,CONSTR:CONSTR,TYPED:TYPED,VIEW:VIEW};

},{"./_global":74,"./_hide":76,"./_uid":151}],151:[function(require,module,exports){
var id=0,px=Math.random();module.exports=function(o){return"Symbol(".concat(void 0===o?"":o,")_",(++id+px).toString(36))};

},{}],152:[function(require,module,exports){
var global=require("./_global"),navigator=global.navigator;module.exports=navigator&&navigator.userAgent||"";

},{"./_global":74}],153:[function(require,module,exports){
var isObject=require("./_is-object");module.exports=function(e,r){if(!isObject(e)||e._t!==r)throw TypeError("Incompatible receiver, "+r+" required!");return e};

},{"./_is-object":85}],154:[function(require,module,exports){
var global=require("./_global"),core=require("./_core"),LIBRARY=require("./_library"),wksExt=require("./_wks-ext"),defineProperty=require("./_object-dp").f;module.exports=function(e){var r=core.Symbol||(core.Symbol=LIBRARY?{}:global.Symbol||{});"_"==e.charAt(0)||e in r||defineProperty(r,e,{value:wksExt.f(e)})};

},{"./_core":56,"./_global":74,"./_library":93,"./_object-dp":103,"./_wks-ext":155}],155:[function(require,module,exports){
exports.f=require("./_wks");

},{"./_wks":156}],156:[function(require,module,exports){
var store=require("./_shared")("wks"),uid=require("./_uid"),Symbol=require("./_global").Symbol,USE_SYMBOL="function"==typeof Symbol,$exports=module.exports=function(o){return store[o]||(store[o]=USE_SYMBOL&&Symbol[o]||(USE_SYMBOL?Symbol:uid)("Symbol."+o))};$exports.store=store;

},{"./_global":74,"./_shared":130,"./_uid":151}],157:[function(require,module,exports){
var classof=require("./_classof"),ITERATOR=require("./_wks")("iterator"),Iterators=require("./_iterators");module.exports=require("./_core").getIteratorMethod=function(r){if(null!=r)return r[ITERATOR]||r["@@iterator"]||Iterators[classof(r)]};

},{"./_classof":51,"./_core":56,"./_iterators":92,"./_wks":156}],158:[function(require,module,exports){
var $export=require("./_export");$export($export.P,"Array",{copyWithin:require("./_array-copy-within")}),require("./_add-to-unscopables")("copyWithin");

},{"./_add-to-unscopables":39,"./_array-copy-within":43,"./_export":66}],159:[function(require,module,exports){
"use strict";var $export=require("./_export"),$every=require("./_array-methods")(4);$export($export.P+$export.F*!require("./_strict-method")([].every,!0),"Array",{every:function(r){return $every(this,r,arguments[1])}});

},{"./_array-methods":46,"./_export":66,"./_strict-method":132}],160:[function(require,module,exports){
var $export=require("./_export");$export($export.P,"Array",{fill:require("./_array-fill")}),require("./_add-to-unscopables")("fill");

},{"./_add-to-unscopables":39,"./_array-fill":44,"./_export":66}],161:[function(require,module,exports){
"use strict";var $export=require("./_export"),$filter=require("./_array-methods")(2);$export($export.P+$export.F*!require("./_strict-method")([].filter,!0),"Array",{filter:function(r){return $filter(this,r,arguments[1])}});

},{"./_array-methods":46,"./_export":66,"./_strict-method":132}],162:[function(require,module,exports){
"use strict";var $export=require("./_export"),$find=require("./_array-methods")(6),KEY="findIndex",forced=!0;KEY in[]&&Array(1)[KEY](function(){forced=!1}),$export($export.P+$export.F*forced,"Array",{findIndex:function(r){return $find(this,r,arguments.length>1?arguments[1]:void 0)}}),require("./_add-to-unscopables")(KEY);

},{"./_add-to-unscopables":39,"./_array-methods":46,"./_export":66}],163:[function(require,module,exports){
"use strict";var $export=require("./_export"),$find=require("./_array-methods")(5),KEY="find",forced=!0;KEY in[]&&Array(1)[KEY](function(){forced=!1}),$export($export.P+$export.F*forced,"Array",{find:function(r){return $find(this,r,arguments.length>1?arguments[1]:void 0)}}),require("./_add-to-unscopables")(KEY);

},{"./_add-to-unscopables":39,"./_array-methods":46,"./_export":66}],164:[function(require,module,exports){
"use strict";var $export=require("./_export"),$forEach=require("./_array-methods")(0),STRICT=require("./_strict-method")([].forEach,!0);$export($export.P+$export.F*!STRICT,"Array",{forEach:function(r){return $forEach(this,r,arguments[1])}});

},{"./_array-methods":46,"./_export":66,"./_strict-method":132}],165:[function(require,module,exports){
"use strict";var ctx=require("./_ctx"),$export=require("./_export"),toObject=require("./_to-object"),call=require("./_iter-call"),isArrayIter=require("./_is-array-iter"),toLength=require("./_to-length"),createProperty=require("./_create-property"),getIterFn=require("./core.get-iterator-method");$export($export.S+$export.F*!require("./_iter-detect")(function(e){Array.from(e)}),"Array",{from:function(e){var r,t,o,i,a=toObject(e),c="function"==typeof this?this:Array,n=arguments.length,l=n>1?arguments[1]:void 0,u=void 0!==l,y=0,p=getIterFn(a);if(u&&(l=ctx(l,n>2?arguments[2]:void 0,2)),null==p||c==Array&&isArrayIter(p))for(t=new c(r=toLength(a.length));r>y;y++)createProperty(t,y,u?l(a[y],y):a[y]);else for(i=p.call(a),t=new c;!(o=i.next()).done;y++)createProperty(t,y,u?call(i,l,[o.value,y],!0):o.value);return t.length=y,t}});

},{"./_create-property":57,"./_ctx":58,"./_export":66,"./_is-array-iter":82,"./_iter-call":87,"./_iter-detect":90,"./_to-length":145,"./_to-object":146,"./core.get-iterator-method":157}],166:[function(require,module,exports){
"use strict";var $export=require("./_export"),$indexOf=require("./_array-includes")(!1),$native=[].indexOf,NEGATIVE_ZERO=!!$native&&1/[1].indexOf(1,-0)<0;$export($export.P+$export.F*(NEGATIVE_ZERO||!require("./_strict-method")($native)),"Array",{indexOf:function(e){return NEGATIVE_ZERO?$native.apply(this,arguments)||0:$indexOf(this,e,arguments[1])}});

},{"./_array-includes":45,"./_export":66,"./_strict-method":132}],167:[function(require,module,exports){
var $export=require("./_export");$export($export.S,"Array",{isArray:require("./_is-array")});

},{"./_export":66,"./_is-array":83}],168:[function(require,module,exports){
"use strict";var addToUnscopables=require("./_add-to-unscopables"),step=require("./_iter-step"),Iterators=require("./_iterators"),toIObject=require("./_to-iobject");module.exports=require("./_iter-define")(Array,"Array",function(e,t){this._t=toIObject(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,s=this._i++;return!e||s>=e.length?(this._t=void 0,step(1)):step(0,"keys"==t?s:"values"==t?e[s]:[s,e[s]])},"values"),Iterators.Arguments=Iterators.Array,addToUnscopables("keys"),addToUnscopables("values"),addToUnscopables("entries");

},{"./_add-to-unscopables":39,"./_iter-define":89,"./_iter-step":91,"./_iterators":92,"./_to-iobject":144}],169:[function(require,module,exports){
"use strict";var $export=require("./_export"),toIObject=require("./_to-iobject"),arrayJoin=[].join;$export($export.P+$export.F*(require("./_iobject")!=Object||!require("./_strict-method")(arrayJoin)),"Array",{join:function(r){return arrayJoin.call(toIObject(this),void 0===r?",":r)}});

},{"./_export":66,"./_iobject":81,"./_strict-method":132,"./_to-iobject":144}],170:[function(require,module,exports){
"use strict";var $export=require("./_export"),toIObject=require("./_to-iobject"),toInteger=require("./_to-integer"),toLength=require("./_to-length"),$native=[].lastIndexOf,NEGATIVE_ZERO=!!$native&&1/[1].lastIndexOf(1,-0)<0;$export($export.P+$export.F*(NEGATIVE_ZERO||!require("./_strict-method")($native)),"Array",{lastIndexOf:function(t){if(NEGATIVE_ZERO)return $native.apply(this,arguments)||0;var e=toIObject(this),r=toLength(e.length),n=r-1;for(arguments.length>1&&(n=Math.min(n,toInteger(arguments[1]))),n<0&&(n=r+n);n>=0;n--)if(n in e&&e[n]===t)return n||0;return-1}});

},{"./_export":66,"./_strict-method":132,"./_to-integer":143,"./_to-iobject":144,"./_to-length":145}],171:[function(require,module,exports){
"use strict";var $export=require("./_export"),$map=require("./_array-methods")(1);$export($export.P+$export.F*!require("./_strict-method")([].map,!0),"Array",{map:function(r){return $map(this,r,arguments[1])}});

},{"./_array-methods":46,"./_export":66,"./_strict-method":132}],172:[function(require,module,exports){
"use strict";var $export=require("./_export"),createProperty=require("./_create-property");$export($export.S+$export.F*require("./_fails")(function(){function r(){}return!(Array.of.call(r)instanceof r)}),"Array",{of:function(){for(var r=0,e=arguments.length,t=new("function"==typeof this?this:Array)(e);e>r;)createProperty(t,r,arguments[r++]);return t.length=e,t}});

},{"./_create-property":57,"./_export":66,"./_fails":68}],173:[function(require,module,exports){
"use strict";var $export=require("./_export"),$reduce=require("./_array-reduce");$export($export.P+$export.F*!require("./_strict-method")([].reduceRight,!0),"Array",{reduceRight:function(e){return $reduce(this,e,arguments.length,arguments[1],!0)}});

},{"./_array-reduce":47,"./_export":66,"./_strict-method":132}],174:[function(require,module,exports){
"use strict";var $export=require("./_export"),$reduce=require("./_array-reduce");$export($export.P+$export.F*!require("./_strict-method")([].reduce,!0),"Array",{reduce:function(e){return $reduce(this,e,arguments.length,arguments[1],!1)}});

},{"./_array-reduce":47,"./_export":66,"./_strict-method":132}],175:[function(require,module,exports){
"use strict";var $export=require("./_export"),html=require("./_html"),cof=require("./_cof"),toAbsoluteIndex=require("./_to-absolute-index"),toLength=require("./_to-length"),arraySlice=[].slice;$export($export.P+$export.F*require("./_fails")(function(){html&&arraySlice.call(html)}),"Array",{slice:function(r,e){var t=toLength(this.length),i=cof(this);if(e=void 0===e?t:e,"Array"==i)return arraySlice.call(this,r,e);for(var o=toAbsoluteIndex(r,t),l=toAbsoluteIndex(e,t),a=toLength(l-o),n=new Array(a),h=0;h<a;h++)n[h]="String"==i?this.charAt(o+h):this[o+h];return n}});

},{"./_cof":52,"./_export":66,"./_fails":68,"./_html":77,"./_to-absolute-index":141,"./_to-length":145}],176:[function(require,module,exports){
"use strict";var $export=require("./_export"),$some=require("./_array-methods")(3);$export($export.P+$export.F*!require("./_strict-method")([].some,!0),"Array",{some:function(r){return $some(this,r,arguments[1])}});

},{"./_array-methods":46,"./_export":66,"./_strict-method":132}],177:[function(require,module,exports){
"use strict";var $export=require("./_export"),aFunction=require("./_a-function"),toObject=require("./_to-object"),fails=require("./_fails"),$sort=[].sort,test=[1,2,3];$export($export.P+$export.F*(fails(function(){test.sort(void 0)})||!fails(function(){test.sort(null)})||!require("./_strict-method")($sort)),"Array",{sort:function(t){return void 0===t?$sort.call(toObject(this)):$sort.call(toObject(this),aFunction(t))}});

},{"./_a-function":37,"./_export":66,"./_fails":68,"./_strict-method":132,"./_to-object":146}],178:[function(require,module,exports){
require("./_set-species")("Array");

},{"./_set-species":127}],179:[function(require,module,exports){
var $export=require("./_export");$export($export.S,"Date",{now:function(){return(new Date).getTime()}});

},{"./_export":66}],180:[function(require,module,exports){
var $export=require("./_export"),toISOString=require("./_date-to-iso-string");$export($export.P+$export.F*(Date.prototype.toISOString!==toISOString),"Date",{toISOString:toISOString});

},{"./_date-to-iso-string":59,"./_export":66}],181:[function(require,module,exports){
"use strict";var $export=require("./_export"),toObject=require("./_to-object"),toPrimitive=require("./_to-primitive");$export($export.P+$export.F*require("./_fails")(function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}),"Date",{toJSON:function(t){var e=toObject(this),r=toPrimitive(e);return"number"!=typeof r||isFinite(r)?e.toISOString():null}});

},{"./_export":66,"./_fails":68,"./_to-object":146,"./_to-primitive":147}],182:[function(require,module,exports){
var TO_PRIMITIVE=require("./_wks")("toPrimitive"),proto=Date.prototype;TO_PRIMITIVE in proto||require("./_hide")(proto,TO_PRIMITIVE,require("./_date-to-primitive"));

},{"./_date-to-primitive":60,"./_hide":76,"./_wks":156}],183:[function(require,module,exports){
var DateProto=Date.prototype,INVALID_DATE="Invalid Date",TO_STRING="toString",$toString=DateProto[TO_STRING],getTime=DateProto.getTime;new Date(NaN)+""!=INVALID_DATE&&require("./_redefine")(DateProto,TO_STRING,function(){var t=getTime.call(this);return t==t?$toString.call(this):INVALID_DATE});

},{"./_redefine":122}],184:[function(require,module,exports){
var $export=require("./_export");$export($export.P,"Function",{bind:require("./_bind")});

},{"./_bind":50,"./_export":66}],185:[function(require,module,exports){
"use strict";var isObject=require("./_is-object"),getPrototypeOf=require("./_object-gpo"),HAS_INSTANCE=require("./_wks")("hasInstance"),FunctionProto=Function.prototype;HAS_INSTANCE in FunctionProto||require("./_object-dp").f(FunctionProto,HAS_INSTANCE,{value:function(t){if("function"!=typeof this||!isObject(t))return!1;if(!isObject(this.prototype))return t instanceof this;for(;t=getPrototypeOf(t);)if(this.prototype===t)return!0;return!1}});

},{"./_is-object":85,"./_object-dp":103,"./_object-gpo":109,"./_wks":156}],186:[function(require,module,exports){
var dP=require("./_object-dp").f,FProto=Function.prototype,nameRE=/^\s*function ([^ (]*)/,NAME="name";NAME in FProto||require("./_descriptors")&&dP(FProto,NAME,{configurable:!0,get:function(){try{return(""+this).match(nameRE)[1]}catch(r){return""}}});

},{"./_descriptors":62,"./_object-dp":103}],187:[function(require,module,exports){
"use strict";var strong=require("./_collection-strong"),validate=require("./_validate-collection"),MAP="Map";module.exports=require("./_collection")(MAP,function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{get:function(t){var e=strong.getEntry(validate(this,MAP),t);return e&&e.v},set:function(t,e){return strong.def(validate(this,MAP),0===t?0:t,e)}},strong,!0);

},{"./_collection":55,"./_collection-strong":53,"./_validate-collection":153}],188:[function(require,module,exports){
var $export=require("./_export"),log1p=require("./_math-log1p"),sqrt=Math.sqrt,$acosh=Math.acosh;$export($export.S+$export.F*!($acosh&&710==Math.floor($acosh(Number.MAX_VALUE))&&$acosh(1/0)==1/0),"Math",{acosh:function(o){return(o=+o)<1?NaN:o>94906265.62425156?Math.log(o)+Math.LN2:log1p(o-1+sqrt(o-1)*sqrt(o+1))}});

},{"./_export":66,"./_math-log1p":96}],189:[function(require,module,exports){
var $export=require("./_export"),$asinh=Math.asinh;function asinh(a){return isFinite(a=+a)&&0!=a?a<0?-asinh(-a):Math.log(a+Math.sqrt(a*a+1)):a}$export($export.S+$export.F*!($asinh&&1/$asinh(0)>0),"Math",{asinh:asinh});

},{"./_export":66}],190:[function(require,module,exports){
var $export=require("./_export"),$atanh=Math.atanh;$export($export.S+$export.F*!($atanh&&1/$atanh(-0)<0),"Math",{atanh:function(t){return 0==(t=+t)?t:Math.log((1+t)/(1-t))/2}});

},{"./_export":66}],191:[function(require,module,exports){
var $export=require("./_export"),sign=require("./_math-sign");$export($export.S,"Math",{cbrt:function(r){return sign(r=+r)*Math.pow(Math.abs(r),1/3)}});

},{"./_export":66,"./_math-sign":97}],192:[function(require,module,exports){
var $export=require("./_export");$export($export.S,"Math",{clz32:function(r){return(r>>>=0)?31-Math.floor(Math.log(r+.5)*Math.LOG2E):32}});

},{"./_export":66}],193:[function(require,module,exports){
var $export=require("./_export"),exp=Math.exp;$export($export.S,"Math",{cosh:function(e){return(exp(e=+e)+exp(-e))/2}});

},{"./_export":66}],194:[function(require,module,exports){
var $export=require("./_export"),$expm1=require("./_math-expm1");$export($export.S+$export.F*($expm1!=Math.expm1),"Math",{expm1:$expm1});

},{"./_export":66,"./_math-expm1":94}],195:[function(require,module,exports){
var $export=require("./_export");$export($export.S,"Math",{fround:require("./_math-fround")});

},{"./_export":66,"./_math-fround":95}],196:[function(require,module,exports){
var $export=require("./_export"),abs=Math.abs;$export($export.S,"Math",{hypot:function(r,t){for(var a,e,o=0,h=0,p=arguments.length,n=0;h<p;)n<(a=abs(arguments[h++]))?(o=o*(e=n/a)*e+1,n=a):o+=a>0?(e=a/n)*e:a;return n===1/0?1/0:n*Math.sqrt(o)}});

},{"./_export":66}],197:[function(require,module,exports){
var $export=require("./_export"),$imul=Math.imul;$export($export.S+$export.F*require("./_fails")(function(){return-5!=$imul(4294967295,5)||2!=$imul.length}),"Math",{imul:function(r,e){var t=+r,u=+e,i=65535&t,l=65535&u;return 0|i*l+((65535&t>>>16)*l+i*(65535&u>>>16)<<16>>>0)}});

},{"./_export":66,"./_fails":68}],198:[function(require,module,exports){
var $export=require("./_export");$export($export.S,"Math",{log10:function(r){return Math.log(r)*Math.LOG10E}});

},{"./_export":66}],199:[function(require,module,exports){
var $export=require("./_export");$export($export.S,"Math",{log1p:require("./_math-log1p")});

},{"./_export":66,"./_math-log1p":96}],200:[function(require,module,exports){
var $export=require("./_export");$export($export.S,"Math",{log2:function(r){return Math.log(r)/Math.LN2}});

},{"./_export":66}],201:[function(require,module,exports){
var $export=require("./_export");$export($export.S,"Math",{sign:require("./_math-sign")});

},{"./_export":66,"./_math-sign":97}],202:[function(require,module,exports){
var $export=require("./_export"),expm1=require("./_math-expm1"),exp=Math.exp;$export($export.S+$export.F*require("./_fails")(function(){return-2e-17!=!Math.sinh(-2e-17)}),"Math",{sinh:function(e){return Math.abs(e=+e)<1?(expm1(e)-expm1(-e))/2:(exp(e-1)-exp(-e-1))*(Math.E/2)}});

},{"./_export":66,"./_fails":68,"./_math-expm1":94}],203:[function(require,module,exports){
var $export=require("./_export"),expm1=require("./_math-expm1"),exp=Math.exp;$export($export.S,"Math",{tanh:function(e){var p=expm1(e=+e),r=expm1(-e);return p==1/0?1:r==1/0?-1:(p-r)/(exp(e)+exp(-e))}});

},{"./_export":66,"./_math-expm1":94}],204:[function(require,module,exports){
var $export=require("./_export");$export($export.S,"Math",{trunc:function(r){return(r>0?Math.floor:Math.ceil)(r)}});

},{"./_export":66}],205:[function(require,module,exports){
"use strict";var global=require("./_global"),has=require("./_has"),cof=require("./_cof"),inheritIfRequired=require("./_inherit-if-required"),toPrimitive=require("./_to-primitive"),fails=require("./_fails"),gOPN=require("./_object-gopn").f,gOPD=require("./_object-gopd").f,dP=require("./_object-dp").f,$trim=require("./_string-trim").trim,NUMBER="Number",$Number=global[NUMBER],Base=$Number,proto=$Number.prototype,BROKEN_COF=cof(require("./_object-create")(proto))==NUMBER,TRIM="trim"in String.prototype,toNumber=function(e){var r=toPrimitive(e,!1);if("string"==typeof r&&r.length>2){var t,i,o,u=(r=TRIM?r.trim():$trim(r,3)).charCodeAt(0);if(43===u||45===u){if(88===(t=r.charCodeAt(2))||120===t)return NaN}else if(48===u){switch(r.charCodeAt(1)){case 66:case 98:i=2,o=49;break;case 79:case 111:i=8,o=55;break;default:return+r}for(var a,N=r.slice(2),s=0,n=N.length;s<n;s++)if((a=N.charCodeAt(s))<48||a>o)return NaN;return parseInt(N,i)}}return+r};if(!$Number(" 0o1")||!$Number("0b1")||$Number("+0x1")){$Number=function(e){var r=arguments.length<1?0:e,t=this;return t instanceof $Number&&(BROKEN_COF?fails(function(){proto.valueOf.call(t)}):cof(t)!=NUMBER)?inheritIfRequired(new Base(toNumber(r)),t,$Number):toNumber(r)};for(var key,keys=require("./_descriptors")?gOPN(Base):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),j=0;keys.length>j;j++)has(Base,key=keys[j])&&!has($Number,key)&&dP($Number,key,gOPD(Base,key));$Number.prototype=proto,proto.constructor=$Number,require("./_redefine")(global,NUMBER,$Number)}

},{"./_cof":52,"./_descriptors":62,"./_fails":68,"./_global":74,"./_has":75,"./_inherit-if-required":79,"./_object-create":102,"./_object-dp":103,"./_object-gopd":105,"./_object-gopn":107,"./_redefine":122,"./_string-trim":138,"./_to-primitive":147}],206:[function(require,module,exports){
var $export=require("./_export");$export($export.S,"Number",{EPSILON:Math.pow(2,-52)});

},{"./_export":66}],207:[function(require,module,exports){
var $export=require("./_export"),_isFinite=require("./_global").isFinite;$export($export.S,"Number",{isFinite:function(e){return"number"==typeof e&&_isFinite(e)}});

},{"./_export":66,"./_global":74}],208:[function(require,module,exports){
var $export=require("./_export");$export($export.S,"Number",{isInteger:require("./_is-integer")});

},{"./_export":66,"./_is-integer":84}],209:[function(require,module,exports){
var $export=require("./_export");$export($export.S,"Number",{isNaN:function(r){return r!=r}});

},{"./_export":66}],210:[function(require,module,exports){
var $export=require("./_export"),isInteger=require("./_is-integer"),abs=Math.abs;$export($export.S,"Number",{isSafeInteger:function(e){return isInteger(e)&&abs(e)<=9007199254740991}});

},{"./_export":66,"./_is-integer":84}],211:[function(require,module,exports){
var $export=require("./_export");$export($export.S,"Number",{MAX_SAFE_INTEGER:9007199254740991});

},{"./_export":66}],212:[function(require,module,exports){
var $export=require("./_export");$export($export.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991});

},{"./_export":66}],213:[function(require,module,exports){
var $export=require("./_export"),$parseFloat=require("./_parse-float");$export($export.S+$export.F*(Number.parseFloat!=$parseFloat),"Number",{parseFloat:$parseFloat});

},{"./_export":66,"./_parse-float":116}],214:[function(require,module,exports){
var $export=require("./_export"),$parseInt=require("./_parse-int");$export($export.S+$export.F*(Number.parseInt!=$parseInt),"Number",{parseInt:$parseInt});

},{"./_export":66,"./_parse-int":117}],215:[function(require,module,exports){
"use strict";var $export=require("./_export"),toInteger=require("./_to-integer"),aNumberValue=require("./_a-number-value"),repeat=require("./_string-repeat"),$toFixed=1..toFixed,floor=Math.floor,data=[0,0,0,0,0,0],ERROR="Number.toFixed: incorrect invocation!",ZERO="0",multiply=function(e,r){for(var t=-1,i=r;++t<6;)i+=e*data[t],data[t]=i%1e7,i=floor(i/1e7)},divide=function(e){for(var r=6,t=0;--r>=0;)t+=data[r],data[r]=floor(t/e),t=t%e*1e7},numToString=function(){for(var e=6,r="";--e>=0;)if(""!==r||0===e||0!==data[e]){var t=String(data[e]);r=""===r?t:r+repeat.call(ZERO,7-t.length)+t}return r},pow=function(e,r,t){return 0===r?t:r%2==1?pow(e,r-1,t*e):pow(e*e,r/2,t)},log=function(e){for(var r=0,t=e;t>=4096;)r+=12,t/=4096;for(;t>=2;)r+=1,t/=2;return r};$export($export.P+$export.F*(!!$toFixed&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!require("./_fails")(function(){$toFixed.call({})})),"Number",{toFixed:function(e){var r,t,i,o,a=aNumberValue(this,ERROR),n=toInteger(e),l="",u=ZERO;if(n<0||n>20)throw RangeError(ERROR);if(a!=a)return"NaN";if(a<=-1e21||a>=1e21)return String(a);if(a<0&&(l="-",a=-a),a>1e-21)if(t=(r=log(a*pow(2,69,1))-69)<0?a*pow(2,-r,1):a/pow(2,r,1),t*=4503599627370496,(r=52-r)>0){for(multiply(0,t),i=n;i>=7;)multiply(1e7,0),i-=7;for(multiply(pow(10,i,1),0),i=r-1;i>=23;)divide(1<<23),i-=23;divide(1<<i),multiply(1,1),divide(2),u=numToString()}else multiply(0,t),multiply(1<<-r,0),u=numToString()+repeat.call(ZERO,n);return u=n>0?l+((o=u.length)<=n?"0."+repeat.call(ZERO,n-o)+u:u.slice(0,o-n)+"."+u.slice(o-n)):l+u}});

},{"./_a-number-value":38,"./_export":66,"./_fails":68,"./_string-repeat":137,"./_to-integer":143}],216:[function(require,module,exports){
"use strict";var $export=require("./_export"),$fails=require("./_fails"),aNumberValue=require("./_a-number-value"),$toPrecision=1..toPrecision;$export($export.P+$export.F*($fails(function(){return"1"!==$toPrecision.call(1,void 0)})||!$fails(function(){$toPrecision.call({})})),"Number",{toPrecision:function(i){var r=aNumberValue(this,"Number#toPrecision: incorrect invocation!");return void 0===i?$toPrecision.call(r):$toPrecision.call(r,i)}});

},{"./_a-number-value":38,"./_export":66,"./_fails":68}],217:[function(require,module,exports){
var $export=require("./_export");$export($export.S+$export.F,"Object",{assign:require("./_object-assign")});

},{"./_export":66,"./_object-assign":101}],218:[function(require,module,exports){
var $export=require("./_export");$export($export.S,"Object",{create:require("./_object-create")});

},{"./_export":66,"./_object-create":102}],219:[function(require,module,exports){
var $export=require("./_export");$export($export.S+$export.F*!require("./_descriptors"),"Object",{defineProperties:require("./_object-dps")});

},{"./_descriptors":62,"./_export":66,"./_object-dps":104}],220:[function(require,module,exports){
var $export=require("./_export");$export($export.S+$export.F*!require("./_descriptors"),"Object",{defineProperty:require("./_object-dp").f});

},{"./_descriptors":62,"./_export":66,"./_object-dp":103}],221:[function(require,module,exports){
var isObject=require("./_is-object"),meta=require("./_meta").onFreeze;require("./_object-sap")("freeze",function(e){return function(r){return e&&isObject(r)?e(meta(r)):r}});

},{"./_is-object":85,"./_meta":98,"./_object-sap":113}],222:[function(require,module,exports){
var toIObject=require("./_to-iobject"),$getOwnPropertyDescriptor=require("./_object-gopd").f;require("./_object-sap")("getOwnPropertyDescriptor",function(){return function(r,e){return $getOwnPropertyDescriptor(toIObject(r),e)}});

},{"./_object-gopd":105,"./_object-sap":113,"./_to-iobject":144}],223:[function(require,module,exports){
require("./_object-sap")("getOwnPropertyNames",function(){return require("./_object-gopn-ext").f});

},{"./_object-gopn-ext":106,"./_object-sap":113}],224:[function(require,module,exports){
var toObject=require("./_to-object"),$getPrototypeOf=require("./_object-gpo");require("./_object-sap")("getPrototypeOf",function(){return function(t){return $getPrototypeOf(toObject(t))}});

},{"./_object-gpo":109,"./_object-sap":113,"./_to-object":146}],225:[function(require,module,exports){
var isObject=require("./_is-object");require("./_object-sap")("isExtensible",function(e){return function(i){return!!isObject(i)&&(!e||e(i))}});

},{"./_is-object":85,"./_object-sap":113}],226:[function(require,module,exports){
var isObject=require("./_is-object");require("./_object-sap")("isFrozen",function(e){return function(r){return!isObject(r)||!!e&&e(r)}});

},{"./_is-object":85,"./_object-sap":113}],227:[function(require,module,exports){
var isObject=require("./_is-object");require("./_object-sap")("isSealed",function(e){return function(r){return!isObject(r)||!!e&&e(r)}});

},{"./_is-object":85,"./_object-sap":113}],228:[function(require,module,exports){
var $export=require("./_export");$export($export.S,"Object",{is:require("./_same-value")});

},{"./_export":66,"./_same-value":125}],229:[function(require,module,exports){
var toObject=require("./_to-object"),$keys=require("./_object-keys");require("./_object-sap")("keys",function(){return function(e){return $keys(toObject(e))}});

},{"./_object-keys":111,"./_object-sap":113,"./_to-object":146}],230:[function(require,module,exports){
var isObject=require("./_is-object"),meta=require("./_meta").onFreeze;require("./_object-sap")("preventExtensions",function(e){return function(r){return e&&isObject(r)?e(meta(r)):r}});

},{"./_is-object":85,"./_meta":98,"./_object-sap":113}],231:[function(require,module,exports){
var isObject=require("./_is-object"),meta=require("./_meta").onFreeze;require("./_object-sap")("seal",function(e){return function(r){return e&&isObject(r)?e(meta(r)):r}});

},{"./_is-object":85,"./_meta":98,"./_object-sap":113}],232:[function(require,module,exports){
var $export=require("./_export");$export($export.S,"Object",{setPrototypeOf:require("./_set-proto").set});

},{"./_export":66,"./_set-proto":126}],233:[function(require,module,exports){
"use strict";var classof=require("./_classof"),test={};test[require("./_wks")("toStringTag")]="z",test+""!="[object z]"&&require("./_redefine")(Object.prototype,"toString",function(){return"[object "+classof(this)+"]"},!0);

},{"./_classof":51,"./_redefine":122,"./_wks":156}],234:[function(require,module,exports){
var $export=require("./_export"),$parseFloat=require("./_parse-float");$export($export.G+$export.F*(parseFloat!=$parseFloat),{parseFloat:$parseFloat});

},{"./_export":66,"./_parse-float":116}],235:[function(require,module,exports){
var $export=require("./_export"),$parseInt=require("./_parse-int");$export($export.G+$export.F*(parseInt!=$parseInt),{parseInt:$parseInt});

},{"./_export":66,"./_parse-int":117}],236:[function(require,module,exports){
"use strict";var Internal,newGenericPromiseCapability,OwnPromiseCapability,Wrapper,LIBRARY=require("./_library"),global=require("./_global"),ctx=require("./_ctx"),classof=require("./_classof"),$export=require("./_export"),isObject=require("./_is-object"),aFunction=require("./_a-function"),anInstance=require("./_an-instance"),forOf=require("./_for-of"),speciesConstructor=require("./_species-constructor"),task=require("./_task").set,microtask=require("./_microtask")(),newPromiseCapabilityModule=require("./_new-promise-capability"),perform=require("./_perform"),userAgent=require("./_user-agent"),promiseResolve=require("./_promise-resolve"),PROMISE="Promise",TypeError=global.TypeError,process=global.process,versions=process&&process.versions,v8=versions&&versions.v8||"",$Promise=global[PROMISE],isNode="process"==classof(process),empty=function(){},newPromiseCapability=newGenericPromiseCapability=newPromiseCapabilityModule.f,USE_NATIVE=!!function(){try{var e=$Promise.resolve(1),r=(e.constructor={})[require("./_wks")("species")]=function(e){e(empty,empty)};return(isNode||"function"==typeof PromiseRejectionEvent)&&e.then(empty)instanceof r&&0!==v8.indexOf("6.6")&&-1===userAgent.indexOf("Chrome/66")}catch(e){}}(),isThenable=function(e){var r;return!(!isObject(e)||"function"!=typeof(r=e.then))&&r},notify=function(e,r){if(!e._n){e._n=!0;var i=e._c;microtask(function(){for(var o=e._v,t=1==e._s,n=0,s=function(r){var i,n,s,a=t?r.ok:r.fail,c=r.resolve,l=r.reject,p=r.domain;try{a?(t||(2==e._h&&onHandleUnhandled(e),e._h=1),!0===a?i=o:(p&&p.enter(),i=a(o),p&&(p.exit(),s=!0)),i===r.promise?l(TypeError("Promise-chain cycle")):(n=isThenable(i))?n.call(i,c,l):c(i)):l(o)}catch(e){p&&!s&&p.exit(),l(e)}};i.length>n;)s(i[n++]);e._c=[],e._n=!1,r&&!e._h&&onUnhandled(e)})}},onUnhandled=function(e){task.call(global,function(){var r,i,o,t=e._v,n=isUnhandled(e);if(n&&(r=perform(function(){isNode?process.emit("unhandledRejection",t,e):(i=global.onunhandledrejection)?i({promise:e,reason:t}):(o=global.console)&&o.error&&o.error("Unhandled promise rejection",t)}),e._h=isNode||isUnhandled(e)?2:1),e._a=void 0,n&&r.e)throw r.v})},isUnhandled=function(e){return 1!==e._h&&0===(e._a||e._c).length},onHandleUnhandled=function(e){task.call(global,function(){var r;isNode?process.emit("rejectionHandled",e):(r=global.onrejectionhandled)&&r({promise:e,reason:e._v})})},$reject=function(e){var r=this;r._d||(r._d=!0,(r=r._w||r)._v=e,r._s=2,r._a||(r._a=r._c.slice()),notify(r,!0))},$resolve=function(e){var r,i=this;if(!i._d){i._d=!0,i=i._w||i;try{if(i===e)throw TypeError("Promise can't be resolved itself");(r=isThenable(e))?microtask(function(){var o={_w:i,_d:!1};try{r.call(e,ctx($resolve,o,1),ctx($reject,o,1))}catch(e){$reject.call(o,e)}}):(i._v=e,i._s=1,notify(i,!1))}catch(e){$reject.call({_w:i,_d:!1},e)}}};USE_NATIVE||($Promise=function(e){anInstance(this,$Promise,PROMISE,"_h"),aFunction(e),Internal.call(this);try{e(ctx($resolve,this,1),ctx($reject,this,1))}catch(e){$reject.call(this,e)}},(Internal=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=require("./_redefine-all")($Promise.prototype,{then:function(e,r){var i=newPromiseCapability(speciesConstructor(this,$Promise));return i.ok="function"!=typeof e||e,i.fail="function"==typeof r&&r,i.domain=isNode?process.domain:void 0,this._c.push(i),this._a&&this._a.push(i),this._s&&notify(this,!1),i.promise},catch:function(e){return this.then(void 0,e)}}),OwnPromiseCapability=function(){var e=new Internal;this.promise=e,this.resolve=ctx($resolve,e,1),this.reject=ctx($reject,e,1)},newPromiseCapabilityModule.f=newPromiseCapability=function(e){return e===$Promise||e===Wrapper?new OwnPromiseCapability(e):newGenericPromiseCapability(e)}),$export($export.G+$export.W+$export.F*!USE_NATIVE,{Promise:$Promise}),require("./_set-to-string-tag")($Promise,PROMISE),require("./_set-species")(PROMISE),Wrapper=require("./_core")[PROMISE],$export($export.S+$export.F*!USE_NATIVE,PROMISE,{reject:function(e){var r=newPromiseCapability(this);return(0,r.reject)(e),r.promise}}),$export($export.S+$export.F*(LIBRARY||!USE_NATIVE),PROMISE,{resolve:function(e){return promiseResolve(LIBRARY&&this===Wrapper?$Promise:this,e)}}),$export($export.S+$export.F*!(USE_NATIVE&&require("./_iter-detect")(function(e){$Promise.all(e).catch(empty)})),PROMISE,{all:function(e){var r=this,i=newPromiseCapability(r),o=i.resolve,t=i.reject,n=perform(function(){var i=[],n=0,s=1;forOf(e,!1,function(e){var a=n++,c=!1;i.push(void 0),s++,r.resolve(e).then(function(e){c||(c=!0,i[a]=e,--s||o(i))},t)}),--s||o(i)});return n.e&&t(n.v),i.promise},race:function(e){var r=this,i=newPromiseCapability(r),o=i.reject,t=perform(function(){forOf(e,!1,function(e){r.resolve(e).then(i.resolve,o)})});return t.e&&o(t.v),i.promise}});

},{"./_a-function":37,"./_an-instance":41,"./_classof":51,"./_core":56,"./_ctx":58,"./_export":66,"./_for-of":72,"./_global":74,"./_is-object":85,"./_iter-detect":90,"./_library":93,"./_microtask":99,"./_new-promise-capability":100,"./_perform":118,"./_promise-resolve":119,"./_redefine-all":121,"./_set-species":127,"./_set-to-string-tag":128,"./_species-constructor":131,"./_task":140,"./_user-agent":152,"./_wks":156}],237:[function(require,module,exports){
var $export=require("./_export"),aFunction=require("./_a-function"),anObject=require("./_an-object"),rApply=(require("./_global").Reflect||{}).apply,fApply=Function.apply;$export($export.S+$export.F*!require("./_fails")(function(){rApply(function(){})}),"Reflect",{apply:function(e,p,r){var n=aFunction(e),t=anObject(r);return rApply?rApply(n,p,t):fApply.call(n,p,t)}});

},{"./_a-function":37,"./_an-object":42,"./_export":66,"./_fails":68,"./_global":74}],238:[function(require,module,exports){
var $export=require("./_export"),create=require("./_object-create"),aFunction=require("./_a-function"),anObject=require("./_an-object"),isObject=require("./_is-object"),fails=require("./_fails"),bind=require("./_bind"),rConstruct=(require("./_global").Reflect||{}).construct,NEW_TARGET_BUG=fails(function(){function e(){}return!(rConstruct(function(){},[],e)instanceof e)}),ARGS_BUG=!fails(function(){rConstruct(function(){})});$export($export.S+$export.F*(NEW_TARGET_BUG||ARGS_BUG),"Reflect",{construct:function(e,t){aFunction(e),anObject(t);var r=arguments.length<3?e:aFunction(arguments[2]);if(ARGS_BUG&&!NEW_TARGET_BUG)return rConstruct(e,t,r);if(e==r){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var n=[null];return n.push.apply(n,t),new(bind.apply(e,n))}var c=r.prototype,u=create(isObject(c)?c:Object.prototype),i=Function.apply.call(e,u,t);return isObject(i)?i:u}});

},{"./_a-function":37,"./_an-object":42,"./_bind":50,"./_export":66,"./_fails":68,"./_global":74,"./_is-object":85,"./_object-create":102}],239:[function(require,module,exports){
var dP=require("./_object-dp"),$export=require("./_export"),anObject=require("./_an-object"),toPrimitive=require("./_to-primitive");$export($export.S+$export.F*require("./_fails")(function(){Reflect.defineProperty(dP.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(e,r,t){anObject(e),r=toPrimitive(r,!0),anObject(t);try{return dP.f(e,r,t),!0}catch(e){return!1}}});

},{"./_an-object":42,"./_export":66,"./_fails":68,"./_object-dp":103,"./_to-primitive":147}],240:[function(require,module,exports){
var $export=require("./_export"),gOPD=require("./_object-gopd").f,anObject=require("./_an-object");$export($export.S,"Reflect",{deleteProperty:function(e,r){var t=gOPD(anObject(e),r);return!(t&&!t.configurable)&&delete e[r]}});

},{"./_an-object":42,"./_export":66,"./_object-gopd":105}],241:[function(require,module,exports){
"use strict";var $export=require("./_export"),anObject=require("./_an-object"),Enumerate=function(e){this._t=anObject(e),this._i=0;var t,r=this._k=[];for(t in e)r.push(t)};require("./_iter-create")(Enumerate,"Object",function(){var e,t=this._k;do{if(this._i>=t.length)return{value:void 0,done:!0}}while(!((e=t[this._i++])in this._t));return{value:e,done:!1}}),$export($export.S,"Reflect",{enumerate:function(e){return new Enumerate(e)}});

},{"./_an-object":42,"./_export":66,"./_iter-create":88}],242:[function(require,module,exports){
var gOPD=require("./_object-gopd"),$export=require("./_export"),anObject=require("./_an-object");$export($export.S,"Reflect",{getOwnPropertyDescriptor:function(e,r){return gOPD.f(anObject(e),r)}});

},{"./_an-object":42,"./_export":66,"./_object-gopd":105}],243:[function(require,module,exports){
var $export=require("./_export"),getProto=require("./_object-gpo"),anObject=require("./_an-object");$export($export.S,"Reflect",{getPrototypeOf:function(e){return getProto(anObject(e))}});

},{"./_an-object":42,"./_export":66,"./_object-gpo":109}],244:[function(require,module,exports){
var gOPD=require("./_object-gopd"),getPrototypeOf=require("./_object-gpo"),has=require("./_has"),$export=require("./_export"),isObject=require("./_is-object"),anObject=require("./_an-object");function get(e,t){var r,o,g=arguments.length<3?e:arguments[2];return anObject(e)===g?e[t]:(r=gOPD.f(e,t))?has(r,"value")?r.value:void 0!==r.get?r.get.call(g):void 0:isObject(o=getPrototypeOf(e))?get(o,t,g):void 0}$export($export.S,"Reflect",{get:get});

},{"./_an-object":42,"./_export":66,"./_has":75,"./_is-object":85,"./_object-gopd":105,"./_object-gpo":109}],245:[function(require,module,exports){
var $export=require("./_export");$export($export.S,"Reflect",{has:function(e,r){return r in e}});

},{"./_export":66}],246:[function(require,module,exports){
var $export=require("./_export"),anObject=require("./_an-object"),$isExtensible=Object.isExtensible;$export($export.S,"Reflect",{isExtensible:function(e){return anObject(e),!$isExtensible||$isExtensible(e)}});

},{"./_an-object":42,"./_export":66}],247:[function(require,module,exports){
var $export=require("./_export");$export($export.S,"Reflect",{ownKeys:require("./_own-keys")});

},{"./_export":66,"./_own-keys":115}],248:[function(require,module,exports){
var $export=require("./_export"),anObject=require("./_an-object"),$preventExtensions=Object.preventExtensions;$export($export.S,"Reflect",{preventExtensions:function(e){anObject(e);try{return $preventExtensions&&$preventExtensions(e),!0}catch(e){return!1}}});

},{"./_an-object":42,"./_export":66}],249:[function(require,module,exports){
var $export=require("./_export"),setProto=require("./_set-proto");setProto&&$export($export.S,"Reflect",{setPrototypeOf:function(t,e){setProto.check(t,e);try{return setProto.set(t,e),!0}catch(t){return!1}}});

},{"./_export":66,"./_set-proto":126}],250:[function(require,module,exports){
var dP=require("./_object-dp"),gOPD=require("./_object-gopd"),getPrototypeOf=require("./_object-gpo"),has=require("./_has"),$export=require("./_export"),createDesc=require("./_property-desc"),anObject=require("./_an-object"),isObject=require("./_is-object");function set(e,t,r){var i,c,s=arguments.length<4?e:arguments[3],o=gOPD.f(anObject(e),t);if(!o){if(isObject(c=getPrototypeOf(e)))return set(c,t,r,s);o=createDesc(0)}if(has(o,"value")){if(!1===o.writable||!isObject(s))return!1;if(i=gOPD.f(s,t)){if(i.get||i.set||!1===i.writable)return!1;i.value=r,dP.f(s,t,i)}else dP.f(s,t,createDesc(0,r));return!0}return void 0!==o.set&&(o.set.call(s,r),!0)}$export($export.S,"Reflect",{set:set});

},{"./_an-object":42,"./_export":66,"./_has":75,"./_is-object":85,"./_object-dp":103,"./_object-gopd":105,"./_object-gpo":109,"./_property-desc":120}],251:[function(require,module,exports){
var global=require("./_global"),inheritIfRequired=require("./_inherit-if-required"),dP=require("./_object-dp").f,gOPN=require("./_object-gopn").f,isRegExp=require("./_is-regexp"),$flags=require("./_flags"),$RegExp=global.RegExp,Base=$RegExp,proto=$RegExp.prototype,re1=/a/g,re2=/a/g,CORRECT_NEW=new $RegExp(re1)!==re1;if(require("./_descriptors")&&(!CORRECT_NEW||require("./_fails")(function(){return re2[require("./_wks")("match")]=!1,$RegExp(re1)!=re1||$RegExp(re2)==re2||"/a/i"!=$RegExp(re1,"i")}))){$RegExp=function(e,r){var i=this instanceof $RegExp,g=isRegExp(e),o=void 0===r;return!i&&g&&e.constructor===$RegExp&&o?e:inheritIfRequired(CORRECT_NEW?new Base(g&&!o?e.source:e,r):Base((g=e instanceof $RegExp)?e.source:e,g&&o?$flags.call(e):r),i?this:proto,$RegExp)};for(var proxy=function(e){e in $RegExp||dP($RegExp,e,{configurable:!0,get:function(){return Base[e]},set:function(r){Base[e]=r}})},keys=gOPN(Base),i=0;keys.length>i;)proxy(keys[i++]);proto.constructor=$RegExp,$RegExp.prototype=proto,require("./_redefine")(global,"RegExp",$RegExp)}require("./_set-species")("RegExp");

},{"./_descriptors":62,"./_fails":68,"./_flags":70,"./_global":74,"./_inherit-if-required":79,"./_is-regexp":86,"./_object-dp":103,"./_object-gopn":107,"./_redefine":122,"./_set-species":127,"./_wks":156}],252:[function(require,module,exports){
"use strict";var regexpExec=require("./_regexp-exec");require("./_export")({target:"RegExp",proto:!0,forced:regexpExec!==/./.exec},{exec:regexpExec});

},{"./_export":66,"./_regexp-exec":124}],253:[function(require,module,exports){
require("./_descriptors")&&"g"!=/./g.flags&&require("./_object-dp").f(RegExp.prototype,"flags",{configurable:!0,get:require("./_flags")});

},{"./_descriptors":62,"./_flags":70,"./_object-dp":103}],254:[function(require,module,exports){
"use strict";var anObject=require("./_an-object"),toLength=require("./_to-length"),advanceStringIndex=require("./_advance-string-index"),regExpExec=require("./_regexp-exec-abstract");require("./_fix-re-wks")("match",1,function(e,r,n,t){return[function(n){var t=e(this),a=null==n?void 0:n[r];return void 0!==a?a.call(n,t):new RegExp(n)[r](String(t))},function(e){var r=t(n,e,this);if(r.done)return r.value;var a=anObject(e),i=String(this);if(!a.global)return regExpExec(a,i);var u=a.unicode;a.lastIndex=0;for(var c,x=[],g=0;null!==(c=regExpExec(a,i));){var l=String(c[0]);x[g]=l,""===l&&(a.lastIndex=advanceStringIndex(i,toLength(a.lastIndex),u)),g++}return 0===g?null:x}]});

},{"./_advance-string-index":40,"./_an-object":42,"./_fix-re-wks":69,"./_regexp-exec-abstract":123,"./_to-length":145}],255:[function(require,module,exports){
"use strict";var anObject=require("./_an-object"),toObject=require("./_to-object"),toLength=require("./_to-length"),toInteger=require("./_to-integer"),advanceStringIndex=require("./_advance-string-index"),regExpExec=require("./_regexp-exec-abstract"),max=Math.max,min=Math.min,floor=Math.floor,SUBSTITUTION_SYMBOLS=/\$([$&`']|\d\d?|<[^>]*>)/g,SUBSTITUTION_SYMBOLS_NO_NAMED=/\$([$&`']|\d\d?)/g,maybeToString=function(e){return void 0===e?e:String(e)};require("./_fix-re-wks")("replace",2,function(e,r,t,n){return[function(n,a){var i=e(this),o=null==n?void 0:n[r];return void 0!==o?o.call(n,i,a):t.call(String(i),n,a)},function(e,r){var i=n(t,e,this,r);if(i.done)return i.value;var o=anObject(e),c=String(this),u="function"==typeof r;u||(r=String(r));var l=o.global;if(l){var g=o.unicode;o.lastIndex=0}for(var v=[];;){var s=regExpExec(o,c);if(null===s)break;if(v.push(s),!l)break;""===String(s[0])&&(o.lastIndex=advanceStringIndex(c,toLength(o.lastIndex),g))}for(var S="",d=0,f=0;f<v.length;f++){s=v[f];for(var h=String(s[0]),x=max(min(toInteger(s.index),c.length),0),I=[],_=1;_<s.length;_++)I.push(maybeToString(s[_]));var O=s.groups;if(u){var T=[h].concat(I,x,c);void 0!==O&&T.push(O);var b=String(r.apply(void 0,T))}else b=a(h,c,x,I,O,r);x>=d&&(S+=c.slice(d,x)+b,d=x+h.length)}return S+c.slice(d)}];function a(e,r,n,a,i,o){var c=n+e.length,u=a.length,l=SUBSTITUTION_SYMBOLS_NO_NAMED;return void 0!==i&&(i=toObject(i),l=SUBSTITUTION_SYMBOLS),t.call(o,l,function(t,o){var l;switch(o.charAt(0)){case"$":return"$";case"&":return e;case"`":return r.slice(0,n);case"'":return r.slice(c);case"<":l=i[o.slice(1,-1)];break;default:var g=+o;if(0===g)return t;if(g>u){var v=floor(g/10);return 0===v?t:v<=u?void 0===a[v-1]?o.charAt(1):a[v-1]+o.charAt(1):t}l=a[g-1]}return void 0===l?"":l})}});

},{"./_advance-string-index":40,"./_an-object":42,"./_fix-re-wks":69,"./_regexp-exec-abstract":123,"./_to-integer":143,"./_to-length":145,"./_to-object":146}],256:[function(require,module,exports){
"use strict";var anObject=require("./_an-object"),sameValue=require("./_same-value"),regExpExec=require("./_regexp-exec-abstract");require("./_fix-re-wks")("search",1,function(e,r,a,n){return[function(a){var n=e(this),t=null==a?void 0:a[r];return void 0!==t?t.call(a,n):new RegExp(a)[r](String(n))},function(e){var r=n(a,e,this);if(r.done)return r.value;var t=anObject(e),u=String(this),i=t.lastIndex;sameValue(i,0)||(t.lastIndex=0);var s=regExpExec(t,u);return sameValue(t.lastIndex,i)||(t.lastIndex=i),null===s?-1:s.index}]});

},{"./_an-object":42,"./_fix-re-wks":69,"./_regexp-exec-abstract":123,"./_same-value":125}],257:[function(require,module,exports){
"use strict";var isRegExp=require("./_is-regexp"),anObject=require("./_an-object"),speciesConstructor=require("./_species-constructor"),advanceStringIndex=require("./_advance-string-index"),toLength=require("./_to-length"),callRegExpExec=require("./_regexp-exec-abstract"),regexpExec=require("./_regexp-exec"),fails=require("./_fails"),$min=Math.min,$push=[].push,$SPLIT="split",LENGTH="length",LAST_INDEX="lastIndex",MAX_UINT32=4294967295,SUPPORTS_Y=!fails(function(){RegExp(MAX_UINT32,"y")});require("./_fix-re-wks")("split",2,function(e,i,r,n){var t;return t="c"=="abbc"[$SPLIT](/(b)*/)[1]||4!="test"[$SPLIT](/(?:)/,-1)[LENGTH]||2!="ab"[$SPLIT](/(?:ab)*/)[LENGTH]||4!="."[$SPLIT](/(.?)(.?)/)[LENGTH]||"."[$SPLIT](/()()/)[LENGTH]>1||""[$SPLIT](/.?/)[LENGTH]?function(e,i){var n=String(this);if(void 0===e&&0===i)return[];if(!isRegExp(e))return r.call(n,e,i);for(var t,s,u,l=[],c=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),a=0,T=void 0===i?MAX_UINT32:i>>>0,o=new RegExp(e.source,c+"g");(t=regexpExec.call(o,n))&&!((s=o[LAST_INDEX])>a&&(l.push(n.slice(a,t.index)),t[LENGTH]>1&&t.index<n[LENGTH]&&$push.apply(l,t.slice(1)),u=t[0][LENGTH],a=s,l[LENGTH]>=T));)o[LAST_INDEX]===t.index&&o[LAST_INDEX]++;return a===n[LENGTH]?!u&&o.test("")||l.push(""):l.push(n.slice(a)),l[LENGTH]>T?l.slice(0,T):l}:"0"[$SPLIT](void 0,0)[LENGTH]?function(e,i){return void 0===e&&0===i?[]:r.call(this,e,i)}:r,[function(r,n){var s=e(this),u=null==r?void 0:r[i];return void 0!==u?u.call(r,s,n):t.call(String(s),r,n)},function(e,i){var s=n(t,e,this,i,t!==r);if(s.done)return s.value;var u=anObject(e),l=String(this),c=speciesConstructor(u,RegExp),a=u.unicode,T=(u.ignoreCase?"i":"")+(u.multiline?"m":"")+(u.unicode?"u":"")+(SUPPORTS_Y?"y":"g"),o=new c(SUPPORTS_Y?u:"^(?:"+u.source+")",T),g=void 0===i?MAX_UINT32:i>>>0;if(0===g)return[];if(0===l.length)return null===callRegExpExec(o,l)?[l]:[];for(var x=0,E=0,p=[];E<l.length;){o.lastIndex=SUPPORTS_Y?E:0;var S,L=callRegExpExec(o,SUPPORTS_Y?l:l.slice(E));if(null===L||(S=$min(toLength(o.lastIndex+(SUPPORTS_Y?0:E)),l.length))===x)E=advanceStringIndex(l,E,a);else{if(p.push(l.slice(x,E)),p.length===g)return p;for(var h=1;h<=L.length-1;h++)if(p.push(L[h]),p.length===g)return p;E=x=S}}return p.push(l.slice(x)),p}]});

},{"./_advance-string-index":40,"./_an-object":42,"./_fails":68,"./_fix-re-wks":69,"./_is-regexp":86,"./_regexp-exec":124,"./_regexp-exec-abstract":123,"./_species-constructor":131,"./_to-length":145}],258:[function(require,module,exports){
"use strict";require("./es6.regexp.flags");var anObject=require("./_an-object"),$flags=require("./_flags"),DESCRIPTORS=require("./_descriptors"),TO_STRING="toString",$toString=/./[TO_STRING],define=function(e){require("./_redefine")(RegExp.prototype,TO_STRING,e,!0)};require("./_fails")(function(){return"/a/b"!=$toString.call({source:"a",flags:"b"})})?define(function(){var e=anObject(this);return"/".concat(e.source,"/","flags"in e?e.flags:!DESCRIPTORS&&e instanceof RegExp?$flags.call(e):void 0)}):$toString.name!=TO_STRING&&define(function(){return $toString.call(this)});

},{"./_an-object":42,"./_descriptors":62,"./_fails":68,"./_flags":70,"./_redefine":122,"./es6.regexp.flags":253}],259:[function(require,module,exports){
"use strict";var strong=require("./_collection-strong"),validate=require("./_validate-collection"),SET="Set";module.exports=require("./_collection")(SET,function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return strong.def(validate(this,SET),t=0===t?0:t,t)}},strong);

},{"./_collection":55,"./_collection-strong":53,"./_validate-collection":153}],260:[function(require,module,exports){
"use strict";require("./_string-html")("anchor",function(n){return function(r){return n(this,"a","name",r)}});

},{"./_string-html":135}],261:[function(require,module,exports){
"use strict";require("./_string-html")("big",function(t){return function(){return t(this,"big","","")}});

},{"./_string-html":135}],262:[function(require,module,exports){
"use strict";require("./_string-html")("blink",function(n){return function(){return n(this,"blink","","")}});

},{"./_string-html":135}],263:[function(require,module,exports){
"use strict";require("./_string-html")("bold",function(t){return function(){return t(this,"b","","")}});

},{"./_string-html":135}],264:[function(require,module,exports){
"use strict";var $export=require("./_export"),$at=require("./_string-at")(!1);$export($export.P,"String",{codePointAt:function(t){return $at(this,t)}});

},{"./_export":66,"./_string-at":133}],265:[function(require,module,exports){
"use strict";var $export=require("./_export"),toLength=require("./_to-length"),context=require("./_string-context"),ENDS_WITH="endsWith",$endsWith=""[ENDS_WITH];$export($export.P+$export.F*require("./_fails-is-regexp")(ENDS_WITH),"String",{endsWith:function(t){var e=context(this,t,ENDS_WITH),n=arguments.length>1?arguments[1]:void 0,r=toLength(e.length),i=void 0===n?r:Math.min(toLength(n),r),o=String(t);return $endsWith?$endsWith.call(e,o,i):e.slice(i-o.length,i)===o}});

},{"./_export":66,"./_fails-is-regexp":67,"./_string-context":134,"./_to-length":145}],266:[function(require,module,exports){
"use strict";require("./_string-html")("fixed",function(t){return function(){return t(this,"tt","","")}});

},{"./_string-html":135}],267:[function(require,module,exports){
"use strict";require("./_string-html")("fontcolor",function(t){return function(r){return t(this,"font","color",r)}});

},{"./_string-html":135}],268:[function(require,module,exports){
"use strict";require("./_string-html")("fontsize",function(t){return function(n){return t(this,"font","size",n)}});

},{"./_string-html":135}],269:[function(require,module,exports){
var $export=require("./_export"),toAbsoluteIndex=require("./_to-absolute-index"),fromCharCode=String.fromCharCode,$fromCodePoint=String.fromCodePoint;$export($export.S+$export.F*(!!$fromCodePoint&&1!=$fromCodePoint.length),"String",{fromCodePoint:function(o){for(var r,e=[],t=arguments.length,n=0;t>n;){if(r=+arguments[n++],toAbsoluteIndex(r,1114111)!==r)throw RangeError(r+" is not a valid code point");e.push(r<65536?fromCharCode(r):fromCharCode(55296+((r-=65536)>>10),r%1024+56320))}return e.join("")}});

},{"./_export":66,"./_to-absolute-index":141}],270:[function(require,module,exports){
"use strict";var $export=require("./_export"),context=require("./_string-context"),INCLUDES="includes";$export($export.P+$export.F*require("./_fails-is-regexp")(INCLUDES),"String",{includes:function(e){return!!~context(this,e,INCLUDES).indexOf(e,arguments.length>1?arguments[1]:void 0)}});

},{"./_export":66,"./_fails-is-regexp":67,"./_string-context":134}],271:[function(require,module,exports){
"use strict";require("./_string-html")("italics",function(t){return function(){return t(this,"i","","")}});

},{"./_string-html":135}],272:[function(require,module,exports){
"use strict";var $at=require("./_string-at")(!0);require("./_iter-define")(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,i=this._t,e=this._i;return e>=i.length?{value:void 0,done:!0}:(t=$at(i,e),this._i+=t.length,{value:t,done:!1})});

},{"./_iter-define":89,"./_string-at":133}],273:[function(require,module,exports){
"use strict";require("./_string-html")("link",function(r){return function(t){return r(this,"a","href",t)}});

},{"./_string-html":135}],274:[function(require,module,exports){
var $export=require("./_export"),toIObject=require("./_to-iobject"),toLength=require("./_to-length");$export($export.S,"String",{raw:function(t){for(var r=toIObject(t.raw),e=toLength(r.length),o=arguments.length,n=[],i=0;e>i;)n.push(String(r[i++])),i<o&&n.push(String(arguments[i]));return n.join("")}});

},{"./_export":66,"./_to-iobject":144,"./_to-length":145}],275:[function(require,module,exports){
var $export=require("./_export");$export($export.P,"String",{repeat:require("./_string-repeat")});

},{"./_export":66,"./_string-repeat":137}],276:[function(require,module,exports){
"use strict";require("./_string-html")("small",function(t){return function(){return t(this,"small","","")}});

},{"./_string-html":135}],277:[function(require,module,exports){
"use strict";var $export=require("./_export"),toLength=require("./_to-length"),context=require("./_string-context"),STARTS_WITH="startsWith",$startsWith=""[STARTS_WITH];$export($export.P+$export.F*require("./_fails-is-regexp")(STARTS_WITH),"String",{startsWith:function(t){var e=context(this,t,STARTS_WITH),r=toLength(Math.min(arguments.length>1?arguments[1]:void 0,e.length)),i=String(t);return $startsWith?$startsWith.call(e,i,r):e.slice(r,r+i.length)===i}});

},{"./_export":66,"./_fails-is-regexp":67,"./_string-context":134,"./_to-length":145}],278:[function(require,module,exports){
"use strict";require("./_string-html")("strike",function(t){return function(){return t(this,"strike","","")}});

},{"./_string-html":135}],279:[function(require,module,exports){
"use strict";require("./_string-html")("sub",function(t){return function(){return t(this,"sub","","")}});

},{"./_string-html":135}],280:[function(require,module,exports){
"use strict";require("./_string-html")("sup",function(t){return function(){return t(this,"sup","","")}});

},{"./_string-html":135}],281:[function(require,module,exports){
"use strict";require("./_string-trim")("trim",function(r){return function(){return r(this,3)}});

},{"./_string-trim":138}],282:[function(require,module,exports){
"use strict";var global=require("./_global"),has=require("./_has"),DESCRIPTORS=require("./_descriptors"),$export=require("./_export"),redefine=require("./_redefine"),META=require("./_meta").KEY,$fails=require("./_fails"),shared=require("./_shared"),setToStringTag=require("./_set-to-string-tag"),uid=require("./_uid"),wks=require("./_wks"),wksExt=require("./_wks-ext"),wksDefine=require("./_wks-define"),enumKeys=require("./_enum-keys"),isArray=require("./_is-array"),anObject=require("./_an-object"),isObject=require("./_is-object"),toObject=require("./_to-object"),toIObject=require("./_to-iobject"),toPrimitive=require("./_to-primitive"),createDesc=require("./_property-desc"),_create=require("./_object-create"),gOPNExt=require("./_object-gopn-ext"),$GOPD=require("./_object-gopd"),$GOPS=require("./_object-gops"),$DP=require("./_object-dp"),$keys=require("./_object-keys"),gOPD=$GOPD.f,dP=$DP.f,gOPN=gOPNExt.f,$Symbol=global.Symbol,$JSON=global.JSON,_stringify=$JSON&&$JSON.stringify,PROTOTYPE="prototype",HIDDEN=wks("_hidden"),TO_PRIMITIVE=wks("toPrimitive"),isEnum={}.propertyIsEnumerable,SymbolRegistry=shared("symbol-registry"),AllSymbols=shared("symbols"),OPSymbols=shared("op-symbols"),ObjectProto=Object[PROTOTYPE],USE_NATIVE="function"==typeof $Symbol&&!!$GOPS.f,QObject=global.QObject,setter=!QObject||!QObject[PROTOTYPE]||!QObject[PROTOTYPE].findChild,setSymbolDesc=DESCRIPTORS&&$fails(function(){return 7!=_create(dP({},"a",{get:function(){return dP(this,"a",{value:7}).a}})).a})?function(e,r,t){var o=gOPD(ObjectProto,r);o&&delete ObjectProto[r],dP(e,r,t),o&&e!==ObjectProto&&dP(ObjectProto,r,o)}:dP,wrap=function(e){var r=AllSymbols[e]=_create($Symbol[PROTOTYPE]);return r._k=e,r},isSymbol=USE_NATIVE&&"symbol"==typeof $Symbol.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof $Symbol},$defineProperty=function(e,r,t){return e===ObjectProto&&$defineProperty(OPSymbols,r,t),anObject(e),r=toPrimitive(r,!0),anObject(t),has(AllSymbols,r)?(t.enumerable?(has(e,HIDDEN)&&e[HIDDEN][r]&&(e[HIDDEN][r]=!1),t=_create(t,{enumerable:createDesc(0,!1)})):(has(e,HIDDEN)||dP(e,HIDDEN,createDesc(1,{})),e[HIDDEN][r]=!0),setSymbolDesc(e,r,t)):dP(e,r,t)},$defineProperties=function(e,r){anObject(e);for(var t,o=enumKeys(r=toIObject(r)),i=0,s=o.length;s>i;)$defineProperty(e,t=o[i++],r[t]);return e},$create=function(e,r){return void 0===r?_create(e):$defineProperties(_create(e),r)},$propertyIsEnumerable=function(e){var r=isEnum.call(this,e=toPrimitive(e,!0));return!(this===ObjectProto&&has(AllSymbols,e)&&!has(OPSymbols,e))&&(!(r||!has(this,e)||!has(AllSymbols,e)||has(this,HIDDEN)&&this[HIDDEN][e])||r)},$getOwnPropertyDescriptor=function(e,r){if(e=toIObject(e),r=toPrimitive(r,!0),e!==ObjectProto||!has(AllSymbols,r)||has(OPSymbols,r)){var t=gOPD(e,r);return!t||!has(AllSymbols,r)||has(e,HIDDEN)&&e[HIDDEN][r]||(t.enumerable=!0),t}},$getOwnPropertyNames=function(e){for(var r,t=gOPN(toIObject(e)),o=[],i=0;t.length>i;)has(AllSymbols,r=t[i++])||r==HIDDEN||r==META||o.push(r);return o},$getOwnPropertySymbols=function(e){for(var r,t=e===ObjectProto,o=gOPN(t?OPSymbols:toIObject(e)),i=[],s=0;o.length>s;)!has(AllSymbols,r=o[s++])||t&&!has(ObjectProto,r)||i.push(AllSymbols[r]);return i};USE_NATIVE||(redefine(($Symbol=function(){if(this instanceof $Symbol)throw TypeError("Symbol is not a constructor!");var e=uid(arguments.length>0?arguments[0]:void 0),r=function(t){this===ObjectProto&&r.call(OPSymbols,t),has(this,HIDDEN)&&has(this[HIDDEN],e)&&(this[HIDDEN][e]=!1),setSymbolDesc(this,e,createDesc(1,t))};return DESCRIPTORS&&setter&&setSymbolDesc(ObjectProto,e,{configurable:!0,set:r}),wrap(e)})[PROTOTYPE],"toString",function(){return this._k}),$GOPD.f=$getOwnPropertyDescriptor,$DP.f=$defineProperty,require("./_object-gopn").f=gOPNExt.f=$getOwnPropertyNames,require("./_object-pie").f=$propertyIsEnumerable,$GOPS.f=$getOwnPropertySymbols,DESCRIPTORS&&!require("./_library")&&redefine(ObjectProto,"propertyIsEnumerable",$propertyIsEnumerable,!0),wksExt.f=function(e){return wrap(wks(e))}),$export($export.G+$export.W+$export.F*!USE_NATIVE,{Symbol:$Symbol});for(var es6Symbols="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),j=0;es6Symbols.length>j;)wks(es6Symbols[j++]);for(var wellKnownSymbols=$keys(wks.store),k=0;wellKnownSymbols.length>k;)wksDefine(wellKnownSymbols[k++]);$export($export.S+$export.F*!USE_NATIVE,"Symbol",{for:function(e){return has(SymbolRegistry,e+="")?SymbolRegistry[e]:SymbolRegistry[e]=$Symbol(e)},keyFor:function(e){if(!isSymbol(e))throw TypeError(e+" is not a symbol!");for(var r in SymbolRegistry)if(SymbolRegistry[r]===e)return r},useSetter:function(){setter=!0},useSimple:function(){setter=!1}}),$export($export.S+$export.F*!USE_NATIVE,"Object",{create:$create,defineProperty:$defineProperty,defineProperties:$defineProperties,getOwnPropertyDescriptor:$getOwnPropertyDescriptor,getOwnPropertyNames:$getOwnPropertyNames,getOwnPropertySymbols:$getOwnPropertySymbols});var FAILS_ON_PRIMITIVES=$fails(function(){$GOPS.f(1)});$export($export.S+$export.F*FAILS_ON_PRIMITIVES,"Object",{getOwnPropertySymbols:function(e){return $GOPS.f(toObject(e))}}),$JSON&&$export($export.S+$export.F*(!USE_NATIVE||$fails(function(){var e=$Symbol();return"[null]"!=_stringify([e])||"{}"!=_stringify({a:e})||"{}"!=_stringify(Object(e))})),"JSON",{stringify:function(e){for(var r,t,o=[e],i=1;arguments.length>i;)o.push(arguments[i++]);if(t=r=o[1],(isObject(r)||void 0!==e)&&!isSymbol(e))return isArray(r)||(r=function(e,r){if("function"==typeof t&&(r=t.call(this,e,r)),!isSymbol(r))return r}),o[1]=r,_stringify.apply($JSON,o)}}),$Symbol[PROTOTYPE][TO_PRIMITIVE]||require("./_hide")($Symbol[PROTOTYPE],TO_PRIMITIVE,$Symbol[PROTOTYPE].valueOf),setToStringTag($Symbol,"Symbol"),setToStringTag(Math,"Math",!0),setToStringTag(global.JSON,"JSON",!0);

},{"./_an-object":42,"./_descriptors":62,"./_enum-keys":65,"./_export":66,"./_fails":68,"./_global":74,"./_has":75,"./_hide":76,"./_is-array":83,"./_is-object":85,"./_library":93,"./_meta":98,"./_object-create":102,"./_object-dp":103,"./_object-gopd":105,"./_object-gopn":107,"./_object-gopn-ext":106,"./_object-gops":108,"./_object-keys":111,"./_object-pie":112,"./_property-desc":120,"./_redefine":122,"./_set-to-string-tag":128,"./_shared":130,"./_to-iobject":144,"./_to-object":146,"./_to-primitive":147,"./_uid":151,"./_wks":156,"./_wks-define":154,"./_wks-ext":155}],283:[function(require,module,exports){
"use strict";var $export=require("./_export"),$typed=require("./_typed"),buffer=require("./_typed-buffer"),anObject=require("./_an-object"),toAbsoluteIndex=require("./_to-absolute-index"),toLength=require("./_to-length"),isObject=require("./_is-object"),ArrayBuffer=require("./_global").ArrayBuffer,speciesConstructor=require("./_species-constructor"),$ArrayBuffer=buffer.ArrayBuffer,$DataView=buffer.DataView,$isView=$typed.ABV&&ArrayBuffer.isView,$slice=$ArrayBuffer.prototype.slice,VIEW=$typed.VIEW,ARRAY_BUFFER="ArrayBuffer";$export($export.G+$export.W+$export.F*(ArrayBuffer!==$ArrayBuffer),{ArrayBuffer:$ArrayBuffer}),$export($export.S+$export.F*!$typed.CONSTR,ARRAY_BUFFER,{isView:function(e){return $isView&&$isView(e)||isObject(e)&&VIEW in e}}),$export($export.P+$export.U+$export.F*require("./_fails")(function(){return!new $ArrayBuffer(2).slice(1,void 0).byteLength}),ARRAY_BUFFER,{slice:function(e,r){if(void 0!==$slice&&void 0===r)return $slice.call(anObject(this),e);for(var t=anObject(this).byteLength,i=toAbsoluteIndex(e,t),o=toAbsoluteIndex(void 0===r?t:r,t),u=new(speciesConstructor(this,$ArrayBuffer))(toLength(o-i)),f=new $DataView(this),s=new $DataView(u),n=0;i<o;)s.setUint8(n++,f.getUint8(i++));return u}}),require("./_set-species")(ARRAY_BUFFER);

},{"./_an-object":42,"./_export":66,"./_fails":68,"./_global":74,"./_is-object":85,"./_set-species":127,"./_species-constructor":131,"./_to-absolute-index":141,"./_to-length":145,"./_typed":150,"./_typed-buffer":149}],284:[function(require,module,exports){
var $export=require("./_export");$export($export.G+$export.W+$export.F*!require("./_typed").ABV,{DataView:require("./_typed-buffer").DataView});

},{"./_export":66,"./_typed":150,"./_typed-buffer":149}],285:[function(require,module,exports){
require("./_typed-array")("Float32",4,function(r){return function(t,n,e){return r(this,t,n,e)}});

},{"./_typed-array":148}],286:[function(require,module,exports){
require("./_typed-array")("Float64",8,function(r){return function(t,n,e){return r(this,t,n,e)}});

},{"./_typed-array":148}],287:[function(require,module,exports){
require("./_typed-array")("Int16",2,function(r){return function(n,t,e){return r(this,n,t,e)}});

},{"./_typed-array":148}],288:[function(require,module,exports){
require("./_typed-array")("Int32",4,function(r){return function(n,t,e){return r(this,n,t,e)}});

},{"./_typed-array":148}],289:[function(require,module,exports){
require("./_typed-array")("Int8",1,function(r){return function(n,t,e){return r(this,n,t,e)}});

},{"./_typed-array":148}],290:[function(require,module,exports){
require("./_typed-array")("Uint16",2,function(r){return function(n,t,e){return r(this,n,t,e)}});

},{"./_typed-array":148}],291:[function(require,module,exports){
require("./_typed-array")("Uint32",4,function(r){return function(n,t,e){return r(this,n,t,e)}});

},{"./_typed-array":148}],292:[function(require,module,exports){
require("./_typed-array")("Uint8",1,function(r){return function(n,t,e){return r(this,n,t,e)}});

},{"./_typed-array":148}],293:[function(require,module,exports){
require("./_typed-array")("Uint8",1,function(r){return function(n,t,e){return r(this,n,t,e)}},!0);

},{"./_typed-array":148}],294:[function(require,module,exports){
"use strict";var InternalMap,global=require("./_global"),each=require("./_array-methods")(0),redefine=require("./_redefine"),meta=require("./_meta"),assign=require("./_object-assign"),weak=require("./_collection-weak"),isObject=require("./_is-object"),validate=require("./_validate-collection"),NATIVE_WEAK_MAP=require("./_validate-collection"),IS_IE11=!global.ActiveXObject&&"ActiveXObject"in global,WEAK_MAP="WeakMap",getWeak=meta.getWeak,isExtensible=Object.isExtensible,uncaughtFrozenStore=weak.ufstore,wrapper=function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},methods={get:function(e){if(isObject(e)){var t=getWeak(e);return!0===t?uncaughtFrozenStore(validate(this,WEAK_MAP)).get(e):t?t[this._i]:void 0}},set:function(e,t){return weak.def(validate(this,WEAK_MAP),e,t)}},$WeakMap=module.exports=require("./_collection")(WEAK_MAP,wrapper,methods,weak,!0,!0);NATIVE_WEAK_MAP&&IS_IE11&&(assign((InternalMap=weak.getConstructor(wrapper,WEAK_MAP)).prototype,methods),meta.NEED=!0,each(["delete","has","get","set"],function(e){var t=$WeakMap.prototype,r=t[e];redefine(t,e,function(t,i){if(isObject(t)&&!isExtensible(t)){this._f||(this._f=new InternalMap);var a=this._f[e](t,i);return"set"==e?this:a}return r.call(this,t,i)})}));

},{"./_array-methods":46,"./_collection":55,"./_collection-weak":54,"./_global":74,"./_is-object":85,"./_meta":98,"./_object-assign":101,"./_redefine":122,"./_validate-collection":153}],295:[function(require,module,exports){
"use strict";var weak=require("./_collection-weak"),validate=require("./_validate-collection"),WEAK_SET="WeakSet";require("./_collection")(WEAK_SET,function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{add:function(e){return weak.def(validate(this,WEAK_SET),e,!0)}},weak,!1,!0);

},{"./_collection":55,"./_collection-weak":54,"./_validate-collection":153}],296:[function(require,module,exports){
"use strict";var $export=require("./_export"),flattenIntoArray=require("./_flatten-into-array"),toObject=require("./_to-object"),toLength=require("./_to-length"),aFunction=require("./_a-function"),arraySpeciesCreate=require("./_array-species-create");$export($export.P,"Array",{flatMap:function(e){var r,t,a=toObject(this);return aFunction(e),r=toLength(a.length),t=arraySpeciesCreate(a,0),flattenIntoArray(t,a,a,r,0,1,e,arguments[1]),t}}),require("./_add-to-unscopables")("flatMap");

},{"./_a-function":37,"./_add-to-unscopables":39,"./_array-species-create":49,"./_export":66,"./_flatten-into-array":71,"./_to-length":145,"./_to-object":146}],297:[function(require,module,exports){
"use strict";var $export=require("./_export"),$includes=require("./_array-includes")(!0);$export($export.P,"Array",{includes:function(e){return $includes(this,e,arguments.length>1?arguments[1]:void 0)}}),require("./_add-to-unscopables")("includes");

},{"./_add-to-unscopables":39,"./_array-includes":45,"./_export":66}],298:[function(require,module,exports){
var $export=require("./_export"),$entries=require("./_object-to-array")(!0);$export($export.S,"Object",{entries:function(e){return $entries(e)}});

},{"./_export":66,"./_object-to-array":114}],299:[function(require,module,exports){
var $export=require("./_export"),ownKeys=require("./_own-keys"),toIObject=require("./_to-iobject"),gOPD=require("./_object-gopd"),createProperty=require("./_create-property");$export($export.S,"Object",{getOwnPropertyDescriptors:function(e){for(var r,t,o=toIObject(e),p=gOPD.f,c=ownKeys(o),i={},n=0;c.length>n;)void 0!==(t=p(o,r=c[n++]))&&createProperty(i,r,t);return i}});

},{"./_create-property":57,"./_export":66,"./_object-gopd":105,"./_own-keys":115,"./_to-iobject":144}],300:[function(require,module,exports){
var $export=require("./_export"),$values=require("./_object-to-array")(!1);$export($export.S,"Object",{values:function(e){return $values(e)}});

},{"./_export":66,"./_object-to-array":114}],301:[function(require,module,exports){
"use strict";var $export=require("./_export"),core=require("./_core"),global=require("./_global"),speciesConstructor=require("./_species-constructor"),promiseResolve=require("./_promise-resolve");$export($export.P+$export.R,"Promise",{finally:function(e){var r=speciesConstructor(this,core.Promise||global.Promise),o="function"==typeof e;return this.then(o?function(o){return promiseResolve(r,e()).then(function(){return o})}:e,o?function(o){return promiseResolve(r,e()).then(function(){throw o})}:e)}});

},{"./_core":56,"./_export":66,"./_global":74,"./_promise-resolve":119,"./_species-constructor":131}],302:[function(require,module,exports){
"use strict";var $export=require("./_export"),$pad=require("./_string-pad"),userAgent=require("./_user-agent"),WEBKIT_BUG=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(userAgent);$export($export.P+$export.F*WEBKIT_BUG,"String",{padEnd:function(e){return $pad(this,e,arguments.length>1?arguments[1]:void 0,!1)}});

},{"./_export":66,"./_string-pad":136,"./_user-agent":152}],303:[function(require,module,exports){
"use strict";var $export=require("./_export"),$pad=require("./_string-pad"),userAgent=require("./_user-agent"),WEBKIT_BUG=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(userAgent);$export($export.P+$export.F*WEBKIT_BUG,"String",{padStart:function(e){return $pad(this,e,arguments.length>1?arguments[1]:void 0,!0)}});

},{"./_export":66,"./_string-pad":136,"./_user-agent":152}],304:[function(require,module,exports){
"use strict";require("./_string-trim")("trimLeft",function(t){return function(){return t(this,1)}},"trimStart");

},{"./_string-trim":138}],305:[function(require,module,exports){
"use strict";require("./_string-trim")("trimRight",function(t){return function(){return t(this,2)}},"trimEnd");

},{"./_string-trim":138}],306:[function(require,module,exports){
require("./_wks-define")("asyncIterator");

},{"./_wks-define":154}],307:[function(require,module,exports){
for(var $iterators=require("./es6.array.iterator"),getKeys=require("./_object-keys"),redefine=require("./_redefine"),global=require("./_global"),hide=require("./_hide"),Iterators=require("./_iterators"),wks=require("./_wks"),ITERATOR=wks("iterator"),TO_STRING_TAG=wks("toStringTag"),ArrayValues=Iterators.Array,DOMIterables={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},collections=getKeys(DOMIterables),i=0;i<collections.length;i++){var key,NAME=collections[i],explicit=DOMIterables[NAME],Collection=global[NAME],proto=Collection&&Collection.prototype;if(proto&&(proto[ITERATOR]||hide(proto,ITERATOR,ArrayValues),proto[TO_STRING_TAG]||hide(proto,TO_STRING_TAG,NAME),Iterators[NAME]=ArrayValues,explicit))for(key in $iterators)proto[key]||redefine(proto,key,$iterators[key],!0)}

},{"./_global":74,"./_hide":76,"./_iterators":92,"./_object-keys":111,"./_redefine":122,"./_wks":156,"./es6.array.iterator":168}],308:[function(require,module,exports){
var $export=require("./_export"),$task=require("./_task");$export($export.G+$export.B,{setImmediate:$task.set,clearImmediate:$task.clear});

},{"./_export":66,"./_task":140}],309:[function(require,module,exports){
var global=require("./_global"),$export=require("./_export"),userAgent=require("./_user-agent"),slice=[].slice,MSIE=/MSIE .\./.test(userAgent),wrap=function(e){return function(t,r){var n=arguments.length>2,o=!!n&&slice.call(arguments,2);return e(n?function(){("function"==typeof t?t:Function(t)).apply(this,o)}:t,r)}};$export($export.G+$export.B+$export.F*MSIE,{setTimeout:wrap(global.setTimeout),setInterval:wrap(global.setInterval)});

},{"./_export":66,"./_global":74,"./_user-agent":152}],310:[function(require,module,exports){
require("../modules/web.timers"),require("../modules/web.immediate"),require("../modules/web.dom.iterable"),module.exports=require("../modules/_core");

},{"../modules/_core":56,"../modules/web.dom.iterable":307,"../modules/web.immediate":308,"../modules/web.timers":309}],311:[function(require,module,exports){
!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(e,t){"use strict";var n=[],r=Object.getPrototypeOf,i=n.slice,o=n.flat?function(e){return n.flat.call(e)}:function(e){return n.concat.apply([],e)},a=n.push,s=n.indexOf,u={},l=u.toString,c=u.hasOwnProperty,f=c.toString,p=f.call(Object),d={},h=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType},g=function(e){return null!=e&&e===e.window},v=e.document,y={type:!0,src:!0,nonce:!0,noModule:!0};function m(e,t,n){var r,i,o=(n=n||v).createElement("script");if(o.text=e,t)for(r in y)(i=t[r]||t.getAttribute&&t.getAttribute(r))&&o.setAttribute(r,i);n.head.appendChild(o).parentNode.removeChild(o)}function x(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?u[l.call(e)]||"object":typeof e}var b=function(e,t){return new b.fn.init(e,t)};function w(e){var t=!!e&&"length"in e&&e.length,n=x(e);return!h(e)&&!g(e)&&("array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e)}b.fn=b.prototype={jquery:"3.5.1",constructor:b,length:0,toArray:function(){return i.call(this)},get:function(e){return null==e?i.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=b.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return b.each(this,e)},map:function(e){return this.pushStack(b.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(i.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(b.grep(this,function(e,t){return(t+1)%2}))},odd:function(){return this.pushStack(b.grep(this,function(e,t){return t%2}))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:a,sort:n.sort,splice:n.splice},b.extend=b.fn.extend=function(){var e,t,n,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[s]||{},s++),"object"==typeof a||h(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(e=arguments[s]))for(t in e)r=e[t],"__proto__"!==t&&a!==r&&(l&&r&&(b.isPlainObject(r)||(i=Array.isArray(r)))?(n=a[t],o=i&&!Array.isArray(n)?[]:i||b.isPlainObject(n)?n:{},i=!1,a[t]=b.extend(l,o,r)):void 0!==r&&(a[t]=r));return a},b.extend({expando:"jQuery"+("3.5.1"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==l.call(e))&&(!(t=r(e))||"function"==typeof(n=c.call(t,"constructor")&&t.constructor)&&f.call(n)===p)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){m(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,r=0;if(w(e))for(n=e.length;r<n&&!1!==t.call(e[r],r,e[r]);r++);else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},makeArray:function(e,t){var n=t||[];return null!=e&&(w(Object(e))?b.merge(n,"string"==typeof e?[e]:e):a.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:s.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,o=e.length,a=!n;i<o;i++)!t(e[i],i)!==a&&r.push(e[i]);return r},map:function(e,t,n){var r,i,a=0,s=[];if(w(e))for(r=e.length;a<r;a++)null!=(i=t(e[a],a,n))&&s.push(i);else for(a in e)null!=(i=t(e[a],a,n))&&s.push(i);return o(s)},guid:1,support:d}),"function"==typeof Symbol&&(b.fn[Symbol.iterator]=n[Symbol.iterator]),b.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){u["[object "+t+"]"]=t.toLowerCase()});var T=function(e){var t,n,r,i,o,a,s,u,l,c,f,p,d,h,g,v,y,m,x,b="sizzle"+1*new Date,w=e.document,T=0,C=0,E=ue(),S=ue(),k=ue(),A=ue(),N=function(e,t){return e===t&&(f=!0),0},D={}.hasOwnProperty,j=[],q=j.pop,L=j.push,H=j.push,O=j.slice,P=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},R="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",M="[\\x20\\t\\r\\n\\f]",I="(?:\\\\[\\da-fA-F]{1,6}"+M+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",W="\\["+M+"*("+I+")(?:"+M+"*([*^$|!~]?=)"+M+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+I+"))|)"+M+"*\\]",F=":("+I+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+W+")*)|.*)\\)|)",B=new RegExp(M+"+","g"),$=new RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g"),_=new RegExp("^"+M+"*,"+M+"*"),z=new RegExp("^"+M+"*([>+~]|"+M+")"+M+"*"),U=new RegExp(M+"|>"),X=new RegExp(F),V=new RegExp("^"+I+"$"),G={ID:new RegExp("^#("+I+")"),CLASS:new RegExp("^\\.("+I+")"),TAG:new RegExp("^("+I+"|[*])"),ATTR:new RegExp("^"+W),PSEUDO:new RegExp("^"+F),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),bool:new RegExp("^(?:"+R+")$","i"),needsContext:new RegExp("^"+M+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)","i")},Y=/HTML$/i,Q=/^(?:input|select|textarea|button)$/i,J=/^h\d$/i,K=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,te=new RegExp("\\\\[\\da-fA-F]{1,6}"+M+"?|\\\\([^\\r\\n\\f])","g"),ne=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},re=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ie=function(e,t){return t?"\0"===e?"�":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},oe=function(){p()},ae=be(function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{H.apply(j=O.call(w.childNodes),w.childNodes),j[w.childNodes.length].nodeType}catch(e){H={apply:j.length?function(e,t){L.apply(e,O.call(t))}:function(e,t){for(var n=e.length,r=0;e[n++]=t[r++];);e.length=n-1}}}function se(e,t,r,i){var o,s,l,c,f,h,y,m=t&&t.ownerDocument,w=t?t.nodeType:9;if(r=r||[],"string"!=typeof e||!e||1!==w&&9!==w&&11!==w)return r;if(!i&&(p(t),t=t||d,g)){if(11!==w&&(f=Z.exec(e)))if(o=f[1]){if(9===w){if(!(l=t.getElementById(o)))return r;if(l.id===o)return r.push(l),r}else if(m&&(l=m.getElementById(o))&&x(t,l)&&l.id===o)return r.push(l),r}else{if(f[2])return H.apply(r,t.getElementsByTagName(e)),r;if((o=f[3])&&n.getElementsByClassName&&t.getElementsByClassName)return H.apply(r,t.getElementsByClassName(o)),r}if(n.qsa&&!A[e+" "]&&(!v||!v.test(e))&&(1!==w||"object"!==t.nodeName.toLowerCase())){if(y=e,m=t,1===w&&(U.test(e)||z.test(e))){for((m=ee.test(e)&&ye(t.parentNode)||t)===t&&n.scope||((c=t.getAttribute("id"))?c=c.replace(re,ie):t.setAttribute("id",c=b)),s=(h=a(e)).length;s--;)h[s]=(c?"#"+c:":scope")+" "+xe(h[s]);y=h.join(",")}try{return H.apply(r,m.querySelectorAll(y)),r}catch(t){A(e,!0)}finally{c===b&&t.removeAttribute("id")}}}return u(e.replace($,"$1"),t,r,i)}function ue(){var e=[];return function t(n,i){return e.push(n+" ")>r.cacheLength&&delete t[e.shift()],t[n+" "]=i}}function le(e){return e[b]=!0,e}function ce(e){var t=d.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function fe(e,t){for(var n=e.split("|"),i=n.length;i--;)r.attrHandle[n[i]]=t}function pe(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function de(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function he(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function ge(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&ae(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function ve(e){return le(function(t){return t=+t,le(function(n,r){for(var i,o=e([],n.length,t),a=o.length;a--;)n[i=o[a]]&&(n[i]=!(r[i]=n[i]))})})}function ye(e){return e&&void 0!==e.getElementsByTagName&&e}for(t in n=se.support={},o=se.isXML=function(e){var t=e.namespaceURI,n=(e.ownerDocument||e).documentElement;return!Y.test(t||n&&n.nodeName||"HTML")},p=se.setDocument=function(e){var t,i,a=e?e.ownerDocument||e:w;return a!=d&&9===a.nodeType&&a.documentElement?(h=(d=a).documentElement,g=!o(d),w!=d&&(i=d.defaultView)&&i.top!==i&&(i.addEventListener?i.addEventListener("unload",oe,!1):i.attachEvent&&i.attachEvent("onunload",oe)),n.scope=ce(function(e){return h.appendChild(e).appendChild(d.createElement("div")),void 0!==e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length}),n.attributes=ce(function(e){return e.className="i",!e.getAttribute("className")}),n.getElementsByTagName=ce(function(e){return e.appendChild(d.createComment("")),!e.getElementsByTagName("*").length}),n.getElementsByClassName=K.test(d.getElementsByClassName),n.getById=ce(function(e){return h.appendChild(e).id=b,!d.getElementsByName||!d.getElementsByName(b).length}),n.getById?(r.filter.ID=function(e){var t=e.replace(te,ne);return function(e){return e.getAttribute("id")===t}},r.find.ID=function(e,t){if(void 0!==t.getElementById&&g){var n=t.getElementById(e);return n?[n]:[]}}):(r.filter.ID=function(e){var t=e.replace(te,ne);return function(e){var n=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}},r.find.ID=function(e,t){if(void 0!==t.getElementById&&g){var n,r,i,o=t.getElementById(e);if(o){if((n=o.getAttributeNode("id"))&&n.value===e)return[o];for(i=t.getElementsByName(e),r=0;o=i[r++];)if((n=o.getAttributeNode("id"))&&n.value===e)return[o]}return[]}}),r.find.TAG=n.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):n.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){for(;n=o[i++];)1===n.nodeType&&r.push(n);return r}return o},r.find.CLASS=n.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&g)return t.getElementsByClassName(e)},y=[],v=[],(n.qsa=K.test(d.querySelectorAll))&&(ce(function(e){var t;h.appendChild(e).innerHTML="<a id='"+b+"'></a><select id='"+b+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&v.push("[*^$]="+M+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||v.push("\\["+M+"*(?:value|"+R+")"),e.querySelectorAll("[id~="+b+"-]").length||v.push("~="),(t=d.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||v.push("\\["+M+"*name"+M+"*="+M+"*(?:''|\"\")"),e.querySelectorAll(":checked").length||v.push(":checked"),e.querySelectorAll("a#"+b+"+*").length||v.push(".#.+[+~]"),e.querySelectorAll("\\\f"),v.push("[\\r\\n\\f]")}),ce(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=d.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&v.push("name"+M+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&v.push(":enabled",":disabled"),h.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&v.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),v.push(",.*:")})),(n.matchesSelector=K.test(m=h.matches||h.webkitMatchesSelector||h.mozMatchesSelector||h.oMatchesSelector||h.msMatchesSelector))&&ce(function(e){n.disconnectedMatch=m.call(e,"*"),m.call(e,"[s!='']:x"),y.push("!=",F)}),v=v.length&&new RegExp(v.join("|")),y=y.length&&new RegExp(y.join("|")),t=K.test(h.compareDocumentPosition),x=t||K.test(h.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},N=t?function(e,t){if(e===t)return f=!0,0;var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r||(1&(r=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!n.sortDetached&&t.compareDocumentPosition(e)===r?e==d||e.ownerDocument==w&&x(w,e)?-1:t==d||t.ownerDocument==w&&x(w,t)?1:c?P(c,e)-P(c,t):0:4&r?-1:1)}:function(e,t){if(e===t)return f=!0,0;var n,r=0,i=e.parentNode,o=t.parentNode,a=[e],s=[t];if(!i||!o)return e==d?-1:t==d?1:i?-1:o?1:c?P(c,e)-P(c,t):0;if(i===o)return pe(e,t);for(n=e;n=n.parentNode;)a.unshift(n);for(n=t;n=n.parentNode;)s.unshift(n);for(;a[r]===s[r];)r++;return r?pe(a[r],s[r]):a[r]==w?-1:s[r]==w?1:0},d):d},se.matches=function(e,t){return se(e,null,null,t)},se.matchesSelector=function(e,t){if(p(e),n.matchesSelector&&g&&!A[t+" "]&&(!y||!y.test(t))&&(!v||!v.test(t)))try{var r=m.call(e,t);if(r||n.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(e){A(t,!0)}return se(t,d,null,[e]).length>0},se.contains=function(e,t){return(e.ownerDocument||e)!=d&&p(e),x(e,t)},se.attr=function(e,t){(e.ownerDocument||e)!=d&&p(e);var i=r.attrHandle[t.toLowerCase()],o=i&&D.call(r.attrHandle,t.toLowerCase())?i(e,t,!g):void 0;return void 0!==o?o:n.attributes||!g?e.getAttribute(t):(o=e.getAttributeNode(t))&&o.specified?o.value:null},se.escape=function(e){return(e+"").replace(re,ie)},se.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},se.uniqueSort=function(e){var t,r=[],i=0,o=0;if(f=!n.detectDuplicates,c=!n.sortStable&&e.slice(0),e.sort(N),f){for(;t=e[o++];)t===e[o]&&(i=r.push(o));for(;i--;)e.splice(r[i],1)}return c=null,e},i=se.getText=function(e){var t,n="",r=0,o=e.nodeType;if(o){if(1===o||9===o||11===o){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=i(e)}else if(3===o||4===o)return e.nodeValue}else for(;t=e[r++];)n+=i(t);return n},(r=se.selectors={cacheLength:50,createPseudo:le,match:G,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ne),e[3]=(e[3]||e[4]||e[5]||"").replace(te,ne),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||se.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&se.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return G.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&X.test(n)&&(t=a(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ne).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=E[e+" "];return t||(t=new RegExp("(^|"+M+")"+e+"("+M+"|$)"))&&E(e,function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=se.attr(r,e);return null==i?"!="===t:!t||(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i.replace(B," ")+" ").indexOf(n)>-1:"|="===t&&(i===n||i.slice(0,n.length+1)===n+"-"))}},CHILD:function(e,t,n,r,i){var o="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,u){var l,c,f,p,d,h,g=o!==a?"nextSibling":"previousSibling",v=t.parentNode,y=s&&t.nodeName.toLowerCase(),m=!u&&!s,x=!1;if(v){if(o){for(;g;){for(p=t;p=p[g];)if(s?p.nodeName.toLowerCase()===y:1===p.nodeType)return!1;h=g="only"===e&&!h&&"nextSibling"}return!0}if(h=[a?v.firstChild:v.lastChild],a&&m){for(x=(d=(l=(c=(f=(p=v)[b]||(p[b]={}))[p.uniqueID]||(f[p.uniqueID]={}))[e]||[])[0]===T&&l[1])&&l[2],p=d&&v.childNodes[d];p=++d&&p&&p[g]||(x=d=0)||h.pop();)if(1===p.nodeType&&++x&&p===t){c[e]=[T,d,x];break}}else if(m&&(x=d=(l=(c=(f=(p=t)[b]||(p[b]={}))[p.uniqueID]||(f[p.uniqueID]={}))[e]||[])[0]===T&&l[1]),!1===x)for(;(p=++d&&p&&p[g]||(x=d=0)||h.pop())&&((s?p.nodeName.toLowerCase()!==y:1!==p.nodeType)||!++x||(m&&((c=(f=p[b]||(p[b]={}))[p.uniqueID]||(f[p.uniqueID]={}))[e]=[T,x]),p!==t)););return(x-=i)===r||x%r==0&&x/r>=0}}},PSEUDO:function(e,t){var n,i=r.pseudos[e]||r.setFilters[e.toLowerCase()]||se.error("unsupported pseudo: "+e);return i[b]?i(t):i.length>1?(n=[e,e,"",t],r.setFilters.hasOwnProperty(e.toLowerCase())?le(function(e,n){for(var r,o=i(e,t),a=o.length;a--;)e[r=P(e,o[a])]=!(n[r]=o[a])}):function(e){return i(e,0,n)}):i}},pseudos:{not:le(function(e){var t=[],n=[],r=s(e.replace($,"$1"));return r[b]?le(function(e,t,n,i){for(var o,a=r(e,null,i,[]),s=e.length;s--;)(o=a[s])&&(e[s]=!(t[s]=o))}):function(e,i,o){return t[0]=e,r(t,null,o,n),t[0]=null,!n.pop()}}),has:le(function(e){return function(t){return se(e,t).length>0}}),contains:le(function(e){return e=e.replace(te,ne),function(t){return(t.textContent||i(t)).indexOf(e)>-1}}),lang:le(function(e){return V.test(e||"")||se.error("unsupported lang: "+e),e=e.replace(te,ne).toLowerCase(),function(t){var n;do{if(n=g?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(n=n.toLowerCase())===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===h},focus:function(e){return e===d.activeElement&&(!d.hasFocus||d.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:ge(!1),disabled:ge(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!r.pseudos.empty(e)},header:function(e){return J.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:ve(function(){return[0]}),last:ve(function(e,t){return[t-1]}),eq:ve(function(e,t,n){return[n<0?n+t:n]}),even:ve(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:ve(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:ve(function(e,t,n){for(var r=n<0?n+t:n>t?t:n;--r>=0;)e.push(r);return e}),gt:ve(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=r.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[t]=de(t);for(t in{submit:!0,reset:!0})r.pseudos[t]=he(t);function me(){}function xe(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function be(e,t,n){var r=t.dir,i=t.next,o=i||r,a=n&&"parentNode"===o,s=C++;return t.first?function(t,n,i){for(;t=t[r];)if(1===t.nodeType||a)return e(t,n,i);return!1}:function(t,n,u){var l,c,f,p=[T,s];if(u){for(;t=t[r];)if((1===t.nodeType||a)&&e(t,n,u))return!0}else for(;t=t[r];)if(1===t.nodeType||a)if(c=(f=t[b]||(t[b]={}))[t.uniqueID]||(f[t.uniqueID]={}),i&&i===t.nodeName.toLowerCase())t=t[r]||t;else{if((l=c[o])&&l[0]===T&&l[1]===s)return p[2]=l[2];if(c[o]=p,p[2]=e(t,n,u))return!0}return!1}}function we(e){return e.length>1?function(t,n,r){for(var i=e.length;i--;)if(!e[i](t,n,r))return!1;return!0}:e[0]}function Te(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;s<u;s++)(o=e[s])&&(n&&!n(o,r,i)||(a.push(o),l&&t.push(s)));return a}function Ce(e,t,n,r,i,o){return r&&!r[b]&&(r=Ce(r)),i&&!i[b]&&(i=Ce(i,o)),le(function(o,a,s,u){var l,c,f,p=[],d=[],h=a.length,g=o||function(e,t,n){for(var r=0,i=t.length;r<i;r++)se(e,t[r],n);return n}(t||"*",s.nodeType?[s]:s,[]),v=!e||!o&&t?g:Te(g,p,e,s,u),y=n?i||(o?e:h||r)?[]:a:v;if(n&&n(v,y,s,u),r)for(l=Te(y,d),r(l,[],s,u),c=l.length;c--;)(f=l[c])&&(y[d[c]]=!(v[d[c]]=f));if(o){if(i||e){if(i){for(l=[],c=y.length;c--;)(f=y[c])&&l.push(v[c]=f);i(null,y=[],l,u)}for(c=y.length;c--;)(f=y[c])&&(l=i?P(o,f):p[c])>-1&&(o[l]=!(a[l]=f))}}else y=Te(y===a?y.splice(h,y.length):y),i?i(null,a,y,u):H.apply(a,y)})}function Ee(e){for(var t,n,i,o=e.length,a=r.relative[e[0].type],s=a||r.relative[" "],u=a?1:0,c=be(function(e){return e===t},s,!0),f=be(function(e){return P(t,e)>-1},s,!0),p=[function(e,n,r){var i=!a&&(r||n!==l)||((t=n).nodeType?c(e,n,r):f(e,n,r));return t=null,i}];u<o;u++)if(n=r.relative[e[u].type])p=[be(we(p),n)];else{if((n=r.filter[e[u].type].apply(null,e[u].matches))[b]){for(i=++u;i<o&&!r.relative[e[i].type];i++);return Ce(u>1&&we(p),u>1&&xe(e.slice(0,u-1).concat({value:" "===e[u-2].type?"*":""})).replace($,"$1"),n,u<i&&Ee(e.slice(u,i)),i<o&&Ee(e=e.slice(i)),i<o&&xe(e))}p.push(n)}return we(p)}return me.prototype=r.filters=r.pseudos,r.setFilters=new me,a=se.tokenize=function(e,t){var n,i,o,a,s,u,l,c=S[e+" "];if(c)return t?0:c.slice(0);for(s=e,u=[],l=r.preFilter;s;){for(a in n&&!(i=_.exec(s))||(i&&(s=s.slice(i[0].length)||s),u.push(o=[])),n=!1,(i=z.exec(s))&&(n=i.shift(),o.push({value:n,type:i[0].replace($," ")}),s=s.slice(n.length)),r.filter)!(i=G[a].exec(s))||l[a]&&!(i=l[a](i))||(n=i.shift(),o.push({value:n,type:a,matches:i}),s=s.slice(n.length));if(!n)break}return t?s.length:s?se.error(e):S(e,u).slice(0)},s=se.compile=function(e,t){var n,i=[],o=[],s=k[e+" "];if(!s){for(t||(t=a(e)),n=t.length;n--;)(s=Ee(t[n]))[b]?i.push(s):o.push(s);(s=k(e,function(e,t){var n=t.length>0,i=e.length>0,o=function(o,a,s,u,c){var f,h,v,y=0,m="0",x=o&&[],b=[],w=l,C=o||i&&r.find.TAG("*",c),E=T+=null==w?1:Math.random()||.1,S=C.length;for(c&&(l=a==d||a||c);m!==S&&null!=(f=C[m]);m++){if(i&&f){for(h=0,a||f.ownerDocument==d||(p(f),s=!g);v=e[h++];)if(v(f,a||d,s)){u.push(f);break}c&&(T=E)}n&&((f=!v&&f)&&y--,o&&x.push(f))}if(y+=m,n&&m!==y){for(h=0;v=t[h++];)v(x,b,a,s);if(o){if(y>0)for(;m--;)x[m]||b[m]||(b[m]=q.call(u));b=Te(b)}H.apply(u,b),c&&!o&&b.length>0&&y+t.length>1&&se.uniqueSort(u)}return c&&(T=E,l=w),x};return n?le(o):o}(o,i))).selector=e}return s},u=se.select=function(e,t,n,i){var o,u,l,c,f,p="function"==typeof e&&e,d=!i&&a(e=p.selector||e);if(n=n||[],1===d.length){if((u=d[0]=d[0].slice(0)).length>2&&"ID"===(l=u[0]).type&&9===t.nodeType&&g&&r.relative[u[1].type]){if(!(t=(r.find.ID(l.matches[0].replace(te,ne),t)||[])[0]))return n;p&&(t=t.parentNode),e=e.slice(u.shift().value.length)}for(o=G.needsContext.test(e)?0:u.length;o--&&(l=u[o],!r.relative[c=l.type]);)if((f=r.find[c])&&(i=f(l.matches[0].replace(te,ne),ee.test(u[0].type)&&ye(t.parentNode)||t))){if(u.splice(o,1),!(e=i.length&&xe(u)))return H.apply(n,i),n;break}}return(p||s(e,d))(i,t,!g,n,!t||ee.test(e)&&ye(t.parentNode)||t),n},n.sortStable=b.split("").sort(N).join("")===b,n.detectDuplicates=!!f,p(),n.sortDetached=ce(function(e){return 1&e.compareDocumentPosition(d.createElement("fieldset"))}),ce(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||fe("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),n.attributes&&ce(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||fe("value",function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),ce(function(e){return null==e.getAttribute("disabled")})||fe(R,function(e,t,n){var r;if(!n)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),se}(e);b.find=T,b.expr=T.selectors,b.expr[":"]=b.expr.pseudos,b.uniqueSort=b.unique=T.uniqueSort,b.text=T.getText,b.isXMLDoc=T.isXML,b.contains=T.contains,b.escapeSelector=T.escape;var C=function(e,t,n){for(var r=[],i=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(i&&b(e).is(n))break;r.push(e)}return r},E=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},S=b.expr.match.needsContext;function k(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var A=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function N(e,t,n){return h(t)?b.grep(e,function(e,r){return!!t.call(e,r,e)!==n}):t.nodeType?b.grep(e,function(e){return e===t!==n}):"string"!=typeof t?b.grep(e,function(e){return s.call(t,e)>-1!==n}):b.filter(t,e,n)}b.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?b.find.matchesSelector(r,e)?[r]:[]:b.find.matches(e,b.grep(t,function(e){return 1===e.nodeType}))},b.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(b(e).filter(function(){for(t=0;t<r;t++)if(b.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)b.find(e,i[t],n);return r>1?b.uniqueSort(n):n},filter:function(e){return this.pushStack(N(this,e||[],!1))},not:function(e){return this.pushStack(N(this,e||[],!0))},is:function(e){return!!N(this,"string"==typeof e&&S.test(e)?b(e):e||[],!1).length}});var D,j=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(b.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||D,"string"==typeof e){if(!(r="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:j.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof b?t[0]:t,b.merge(this,b.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:v,!0)),A.test(r[1])&&b.isPlainObject(t))for(r in t)h(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(i=v.getElementById(r[2]))&&(this[0]=i,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):h(e)?void 0!==n.ready?n.ready(e):e(b):b.makeArray(e,this)}).prototype=b.fn,D=b(v);var q=/^(?:parents|prev(?:Until|All))/,L={children:!0,contents:!0,next:!0,prev:!0};function H(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}b.fn.extend({has:function(e){var t=b(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(b.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,o=[],a="string"!=typeof e&&b(e);if(!S.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?a.index(n)>-1:1===n.nodeType&&b.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(o.length>1?b.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?s.call(b(e),this[0]):s.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(b.uniqueSort(b.merge(this.get(),b(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),b.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return C(e,"parentNode")},parentsUntil:function(e,t,n){return C(e,"parentNode",n)},next:function(e){return H(e,"nextSibling")},prev:function(e){return H(e,"previousSibling")},nextAll:function(e){return C(e,"nextSibling")},prevAll:function(e){return C(e,"previousSibling")},nextUntil:function(e,t,n){return C(e,"nextSibling",n)},prevUntil:function(e,t,n){return C(e,"previousSibling",n)},siblings:function(e){return E((e.parentNode||{}).firstChild,e)},children:function(e){return E(e.firstChild)},contents:function(e){return null!=e.contentDocument&&r(e.contentDocument)?e.contentDocument:(k(e,"template")&&(e=e.content||e),b.merge([],e.childNodes))}},function(e,t){b.fn[e]=function(n,r){var i=b.map(this,t,n);return"Until"!==e.slice(-5)&&(r=n),r&&"string"==typeof r&&(i=b.filter(r,i)),this.length>1&&(L[e]||b.uniqueSort(i),q.test(e)&&i.reverse()),this.pushStack(i)}});var O=/[^\x20\t\r\n\f]+/g;function P(e){return e}function R(e){throw e}function M(e,t,n,r){var i;try{e&&h(i=e.promise)?i.call(e).done(t).fail(n):e&&h(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}b.Callbacks=function(e){e="string"==typeof e?function(e){var t={};return b.each(e.match(O)||[],function(e,n){t[n]=!0}),t}(e):b.extend({},e);var t,n,r,i,o=[],a=[],s=-1,u=function(){for(i=i||e.once,r=t=!0;a.length;s=-1)for(n=a.shift();++s<o.length;)!1===o[s].apply(n[0],n[1])&&e.stopOnFalse&&(s=o.length,n=!1);e.memory||(n=!1),t=!1,i&&(o=n?[]:"")},l={add:function(){return o&&(n&&!t&&(s=o.length-1,a.push(n)),function t(n){b.each(n,function(n,r){h(r)?e.unique&&l.has(r)||o.push(r):r&&r.length&&"string"!==x(r)&&t(r)})}(arguments),n&&!t&&u()),this},remove:function(){return b.each(arguments,function(e,t){for(var n;(n=b.inArray(t,o,n))>-1;)o.splice(n,1),n<=s&&s--}),this},has:function(e){return e?b.inArray(e,o)>-1:o.length>0},empty:function(){return o&&(o=[]),this},disable:function(){return i=a=[],o=n="",this},disabled:function(){return!o},lock:function(){return i=a=[],n||t||(o=n=""),this},locked:function(){return!!i},fireWith:function(e,n){return i||(n=[e,(n=n||[]).slice?n.slice():n],a.push(n),t||u()),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!r}};return l},b.extend({Deferred:function(t){var n=[["notify","progress",b.Callbacks("memory"),b.Callbacks("memory"),2],["resolve","done",b.Callbacks("once memory"),b.Callbacks("once memory"),0,"resolved"],["reject","fail",b.Callbacks("once memory"),b.Callbacks("once memory"),1,"rejected"]],r="pending",i={state:function(){return r},always:function(){return o.done(arguments).fail(arguments),this},catch:function(e){return i.then(null,e)},pipe:function(){var e=arguments;return b.Deferred(function(t){b.each(n,function(n,r){var i=h(e[r[4]])&&e[r[4]];o[r[1]](function(){var e=i&&i.apply(this,arguments);e&&h(e.promise)?e.promise().progress(t.notify).done(t.resolve).fail(t.reject):t[r[0]+"With"](this,i?[e]:arguments)})}),e=null}).promise()},then:function(t,r,i){var o=0;function a(t,n,r,i){return function(){var s=this,u=arguments,l=function(){var e,l;if(!(t<o)){if((e=r.apply(s,u))===n.promise())throw new TypeError("Thenable self-resolution");l=e&&("object"==typeof e||"function"==typeof e)&&e.then,h(l)?i?l.call(e,a(o,n,P,i),a(o,n,R,i)):(o++,l.call(e,a(o,n,P,i),a(o,n,R,i),a(o,n,P,n.notifyWith))):(r!==P&&(s=void 0,u=[e]),(i||n.resolveWith)(s,u))}},c=i?l:function(){try{l()}catch(e){b.Deferred.exceptionHook&&b.Deferred.exceptionHook(e,c.stackTrace),t+1>=o&&(r!==R&&(s=void 0,u=[e]),n.rejectWith(s,u))}};t?c():(b.Deferred.getStackHook&&(c.stackTrace=b.Deferred.getStackHook()),e.setTimeout(c))}}return b.Deferred(function(e){n[0][3].add(a(0,e,h(i)?i:P,e.notifyWith)),n[1][3].add(a(0,e,h(t)?t:P)),n[2][3].add(a(0,e,h(r)?r:R))}).promise()},promise:function(e){return null!=e?b.extend(e,i):i}},o={};return b.each(n,function(e,t){var a=t[2],s=t[5];i[t[1]]=a.add,s&&a.add(function(){r=s},n[3-e][2].disable,n[3-e][3].disable,n[0][2].lock,n[0][3].lock),a.add(t[3].fire),o[t[0]]=function(){return o[t[0]+"With"](this===o?void 0:this,arguments),this},o[t[0]+"With"]=a.fireWith}),i.promise(o),t&&t.call(o,o),o},when:function(e){var t=arguments.length,n=t,r=Array(n),o=i.call(arguments),a=b.Deferred(),s=function(e){return function(n){r[e]=this,o[e]=arguments.length>1?i.call(arguments):n,--t||a.resolveWith(r,o)}};if(t<=1&&(M(e,a.done(s(n)).resolve,a.reject,!t),"pending"===a.state()||h(o[n]&&o[n].then)))return a.then();for(;n--;)M(o[n],s(n),a.reject);return a.promise()}});var I=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;b.Deferred.exceptionHook=function(t,n){e.console&&e.console.warn&&t&&I.test(t.name)&&e.console.warn("jQuery.Deferred exception: "+t.message,t.stack,n)},b.readyException=function(t){e.setTimeout(function(){throw t})};var W=b.Deferred();function F(){v.removeEventListener("DOMContentLoaded",F),e.removeEventListener("load",F),b.ready()}b.fn.ready=function(e){return W.then(e).catch(function(e){b.readyException(e)}),this},b.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--b.readyWait:b.isReady)||(b.isReady=!0,!0!==e&&--b.readyWait>0||W.resolveWith(v,[b]))}}),b.ready.then=W.then,"complete"===v.readyState||"loading"!==v.readyState&&!v.documentElement.doScroll?e.setTimeout(b.ready):(v.addEventListener("DOMContentLoaded",F),e.addEventListener("load",F));var B=function(e,t,n,r,i,o,a){var s=0,u=e.length,l=null==n;if("object"===x(n))for(s in i=!0,n)B(e,t,s,n[s],!0,o,a);else if(void 0!==r&&(i=!0,h(r)||(a=!0),l&&(a?(t.call(e,r),t=null):(l=t,t=function(e,t,n){return l.call(b(e),n)})),t))for(;s<u;s++)t(e[s],n,a?r:r.call(e[s],s,t(e[s],n)));return i?e:l?t.call(e):u?t(e[0],n):o},$=/^-ms-/,_=/-([a-z])/g;function z(e,t){return t.toUpperCase()}function U(e){return e.replace($,"ms-").replace(_,z)}var X=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function V(){this.expando=b.expando+V.uid++}V.uid=1,V.prototype={cache:function(e){var t=e[this.expando];return t||(t={},X(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[U(t)]=n;else for(r in t)i[U(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][U(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(U):(t=U(t))in r?[t]:t.match(O)||[]).length;for(;n--;)delete r[t[n]]}(void 0===t||b.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!b.isEmptyObject(t)}};var G=new V,Y=new V,Q=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,J=/[A-Z]/g;function K(e,t,n){var r;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(J,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n=function(e){return"true"===e||"false"!==e&&("null"===e?null:e===+e+""?+e:Q.test(e)?JSON.parse(e):e)}(n)}catch(e){}Y.set(e,t,n)}else n=void 0;return n}b.extend({hasData:function(e){return Y.hasData(e)||G.hasData(e)},data:function(e,t,n){return Y.access(e,t,n)},removeData:function(e,t){Y.remove(e,t)},_data:function(e,t,n){return G.access(e,t,n)},_removeData:function(e,t){G.remove(e,t)}}),b.fn.extend({data:function(e,t){var n,r,i,o=this[0],a=o&&o.attributes;if(void 0===e){if(this.length&&(i=Y.get(o),1===o.nodeType&&!G.get(o,"hasDataAttrs"))){for(n=a.length;n--;)a[n]&&0===(r=a[n].name).indexOf("data-")&&(r=U(r.slice(5)),K(o,r,i[r]));G.set(o,"hasDataAttrs",!0)}return i}return"object"==typeof e?this.each(function(){Y.set(this,e)}):B(this,function(t){var n;if(o&&void 0===t)return void 0!==(n=Y.get(o,e))?n:void 0!==(n=K(o,e))?n:void 0;this.each(function(){Y.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){Y.remove(this,e)})}}),b.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=G.get(e,t),n&&(!r||Array.isArray(n)?r=G.access(e,t,b.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=b.queue(e,t),r=n.length,i=n.shift(),o=b._queueHooks(e,t);"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,function(){b.dequeue(e,t)},o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return G.get(e,n)||G.access(e,n,{empty:b.Callbacks("once memory").add(function(){G.remove(e,[t+"queue",n])})})}}),b.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?b.queue(this[0],e):void 0===t?this:this.each(function(){var n=b.queue(this,e,t);b._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&b.dequeue(this,e)})},dequeue:function(e){return this.each(function(){b.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=b.Deferred(),o=this,a=this.length,s=function(){--r||i.resolveWith(o,[o])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";a--;)(n=G.get(o[a],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var Z=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ee=new RegExp("^(?:([+-])=|)("+Z+")([a-z%]*)$","i"),te=["Top","Right","Bottom","Left"],ne=v.documentElement,re=function(e){return b.contains(e.ownerDocument,e)},ie={composed:!0};ne.getRootNode&&(re=function(e){return b.contains(e.ownerDocument,e)||e.getRootNode(ie)===e.ownerDocument});var oe=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&re(e)&&"none"===b.css(e,"display")};function ae(e,t,n,r){var i,o,a=20,s=r?function(){return r.cur()}:function(){return b.css(e,t,"")},u=s(),l=n&&n[3]||(b.cssNumber[t]?"":"px"),c=e.nodeType&&(b.cssNumber[t]||"px"!==l&&+u)&&ee.exec(b.css(e,t));if(c&&c[3]!==l){for(u/=2,l=l||c[3],c=+u||1;a--;)b.style(e,t,c+l),(1-o)*(1-(o=s()/u||.5))<=0&&(a=0),c/=o;c*=2,b.style(e,t,c+l),n=n||[]}return n&&(c=+c||+u||0,i=n[1]?c+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=c,r.end=i)),i}var se={};function ue(e){var t,n=e.ownerDocument,r=e.nodeName,i=se[r];return i||(t=n.body.appendChild(n.createElement(r)),i=b.css(t,"display"),t.parentNode.removeChild(t),"none"===i&&(i="block"),se[r]=i,i)}function le(e,t){for(var n,r,i=[],o=0,a=e.length;o<a;o++)(r=e[o]).style&&(n=r.style.display,t?("none"===n&&(i[o]=G.get(r,"display")||null,i[o]||(r.style.display="")),""===r.style.display&&oe(r)&&(i[o]=ue(r))):"none"!==n&&(i[o]="none",G.set(r,"display",n)));for(o=0;o<a;o++)null!=i[o]&&(e[o].style.display=i[o]);return e}b.fn.extend({show:function(){return le(this,!0)},hide:function(){return le(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){oe(this)?b(this).show():b(this).hide()})}});var ce,fe,pe=/^(?:checkbox|radio)$/i,de=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,he=/^$|^module$|\/(?:java|ecma)script/i;ce=v.createDocumentFragment().appendChild(v.createElement("div")),(fe=v.createElement("input")).setAttribute("type","radio"),fe.setAttribute("checked","checked"),fe.setAttribute("name","t"),ce.appendChild(fe),d.checkClone=ce.cloneNode(!0).cloneNode(!0).lastChild.checked,ce.innerHTML="<textarea>x</textarea>",d.noCloneChecked=!!ce.cloneNode(!0).lastChild.defaultValue,ce.innerHTML="<option></option>",d.option=!!ce.lastChild;var ge={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function ve(e,t){var n;return n=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&k(e,t)?b.merge([e],n):n}function ye(e,t){for(var n=0,r=e.length;n<r;n++)G.set(e[n],"globalEval",!t||G.get(t[n],"globalEval"))}ge.tbody=ge.tfoot=ge.colgroup=ge.caption=ge.thead,ge.th=ge.td,d.option||(ge.optgroup=ge.option=[1,"<select multiple='multiple'>","</select>"]);var me=/<|&#?\w+;/;function xe(e,t,n,r,i){for(var o,a,s,u,l,c,f=t.createDocumentFragment(),p=[],d=0,h=e.length;d<h;d++)if((o=e[d])||0===o)if("object"===x(o))b.merge(p,o.nodeType?[o]:o);else if(me.test(o)){for(a=a||f.appendChild(t.createElement("div")),s=(de.exec(o)||["",""])[1].toLowerCase(),u=ge[s]||ge._default,a.innerHTML=u[1]+b.htmlPrefilter(o)+u[2],c=u[0];c--;)a=a.lastChild;b.merge(p,a.childNodes),(a=f.firstChild).textContent=""}else p.push(t.createTextNode(o));for(f.textContent="",d=0;o=p[d++];)if(r&&b.inArray(o,r)>-1)i&&i.push(o);else if(l=re(o),a=ve(f.appendChild(o),"script"),l&&ye(a),n)for(c=0;o=a[c++];)he.test(o.type||"")&&n.push(o);return f}var be=/^key/,we=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Te=/^([^.]*)(?:\.(.+)|)/;function Ce(){return!0}function Ee(){return!1}function Se(e,t){return e===function(){try{return v.activeElement}catch(e){}}()==("focus"===t)}function ke(e,t,n,r,i,o){var a,s;if("object"==typeof t){for(s in"string"!=typeof n&&(r=r||n,n=void 0),t)ke(e,s,n,r,t[s],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=Ee;else if(!i)return e;return 1===o&&(a=i,(i=function(e){return b().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=b.guid++)),e.each(function(){b.event.add(this,t,i,r,n)})}function Ae(e,t,n){n?(G.set(e,t,!1),b.event.add(e,t,{namespace:!1,handler:function(e){var r,o,a=G.get(this,t);if(1&e.isTrigger&&this[t]){if(a.length)(b.event.special[t]||{}).delegateType&&e.stopPropagation();else if(a=i.call(arguments),G.set(this,t,a),r=n(this,t),this[t](),a!==(o=G.get(this,t))||r?G.set(this,t,!1):o={},a!==o)return e.stopImmediatePropagation(),e.preventDefault(),o.value}else a.length&&(G.set(this,t,{value:b.event.trigger(b.extend(a[0],b.Event.prototype),a.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===G.get(e,t)&&b.event.add(e,t,Ce)}b.event={global:{},add:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=G.get(e);if(X(e))for(n.handler&&(n=(o=n).handler,i=o.selector),i&&b.find.matchesSelector(ne,i),n.guid||(n.guid=b.guid++),(u=v.events)||(u=v.events=Object.create(null)),(a=v.handle)||(a=v.handle=function(t){return void 0!==b&&b.event.triggered!==t.type?b.event.dispatch.apply(e,arguments):void 0}),l=(t=(t||"").match(O)||[""]).length;l--;)d=g=(s=Te.exec(t[l])||[])[1],h=(s[2]||"").split(".").sort(),d&&(f=b.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=b.event.special[d]||{},c=b.extend({type:d,origType:g,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&b.expr.match.needsContext.test(i),namespace:h.join(".")},o),(p=u[d])||((p=u[d]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(e,r,h,a)||e.addEventListener&&e.addEventListener(d,a)),f.add&&(f.add.call(e,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),b.event.global[d]=!0)},remove:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=G.hasData(e)&&G.get(e);if(v&&(u=v.events)){for(l=(t=(t||"").match(O)||[""]).length;l--;)if(d=g=(s=Te.exec(t[l])||[])[1],h=(s[2]||"").split(".").sort(),d){for(f=b.event.special[d]||{},p=u[d=(r?f.delegateType:f.bindType)||d]||[],s=s[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=p.length;o--;)c=p[o],!i&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,f.remove&&f.remove.call(e,c));a&&!p.length&&(f.teardown&&!1!==f.teardown.call(e,h,v.handle)||b.removeEvent(e,d,v.handle),delete u[d])}else for(d in u)b.event.remove(e,d+t[l],n,r,!0);b.isEmptyObject(u)&&G.remove(e,"handle events")}},dispatch:function(e){var t,n,r,i,o,a,s=new Array(arguments.length),u=b.event.fix(e),l=(G.get(this,"events")||Object.create(null))[u.type]||[],c=b.event.special[u.type]||{};for(s[0]=u,t=1;t<arguments.length;t++)s[t]=arguments[t];if(u.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,u)){for(a=b.event.handlers.call(this,u,l),t=0;(i=a[t++])&&!u.isPropagationStopped();)for(u.currentTarget=i.elem,n=0;(o=i.handlers[n++])&&!u.isImmediatePropagationStopped();)u.rnamespace&&!1!==o.namespace&&!u.rnamespace.test(o.namespace)||(u.handleObj=o,u.data=o.data,void 0!==(r=((b.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,s))&&!1===(u.result=r)&&(u.preventDefault(),u.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,u),u.result}},handlers:function(e,t){var n,r,i,o,a,s=[],u=t.delegateCount,l=e.target;if(u&&l.nodeType&&!("click"===e.type&&e.button>=1))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==e.type||!0!==l.disabled)){for(o=[],a={},n=0;n<u;n++)void 0===a[i=(r=t[n]).selector+" "]&&(a[i]=r.needsContext?b(i,this).index(l)>-1:b.find(i,this,null,[l]).length),a[i]&&o.push(r);o.length&&s.push({elem:l,handlers:o})}return l=this,u<t.length&&s.push({elem:l,handlers:t.slice(u)}),s},addProp:function(e,t){Object.defineProperty(b.Event.prototype,e,{enumerable:!0,configurable:!0,get:h(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[b.expando]?e:new b.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return pe.test(t.type)&&t.click&&k(t,"input")&&Ae(t,"click",Ce),!1},trigger:function(e){var t=this||e;return pe.test(t.type)&&t.click&&k(t,"input")&&Ae(t,"click"),!0},_default:function(e){var t=e.target;return pe.test(t.type)&&t.click&&k(t,"input")&&G.get(t,"click")||k(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},b.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},b.Event=function(e,t){if(!(this instanceof b.Event))return new b.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?Ce:Ee,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&b.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[b.expando]=!0},b.Event.prototype={constructor:b.Event,isDefaultPrevented:Ee,isPropagationStopped:Ee,isImmediatePropagationStopped:Ee,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Ce,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Ce,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Ce,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},b.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&be.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&we.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},b.event.addProp),b.each({focus:"focusin",blur:"focusout"},function(e,t){b.event.special[e]={setup:function(){return Ae(this,e,Se),!1},trigger:function(){return Ae(this,e),!0},delegateType:t}}),b.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){b.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=e.relatedTarget,i=e.handleObj;return r&&(r===this||b.contains(this,r))||(e.type=i.origType,n=i.handler.apply(this,arguments),e.type=t),n}}}),b.fn.extend({on:function(e,t,n,r){return ke(this,e,t,n,r)},one:function(e,t,n,r){return ke(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,b(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=Ee),this.each(function(){b.event.remove(this,e,n,t)})}});var Ne=/<script|<style|<link/i,De=/checked\s*(?:[^=]|=\s*.checked.)/i,je=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function qe(e,t){return k(e,"table")&&k(11!==t.nodeType?t:t.firstChild,"tr")&&b(e).children("tbody")[0]||e}function Le(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function He(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Oe(e,t){var n,r,i,o,a,s;if(1===t.nodeType){if(G.hasData(e)&&(s=G.get(e).events))for(i in G.remove(t,"handle events"),s)for(n=0,r=s[i].length;n<r;n++)b.event.add(t,i,s[i][n]);Y.hasData(e)&&(o=Y.access(e),a=b.extend({},o),Y.set(t,a))}}function Pe(e,t,n,r){t=o(t);var i,a,s,u,l,c,f=0,p=e.length,g=p-1,v=t[0],y=h(v);if(y||p>1&&"string"==typeof v&&!d.checkClone&&De.test(v))return e.each(function(i){var o=e.eq(i);y&&(t[0]=v.call(this,i,o.html())),Pe(o,t,n,r)});if(p&&(a=(i=xe(t,e[0].ownerDocument,!1,e,r)).firstChild,1===i.childNodes.length&&(i=a),a||r)){for(u=(s=b.map(ve(i,"script"),Le)).length;f<p;f++)l=i,f!==g&&(l=b.clone(l,!0,!0),u&&b.merge(s,ve(l,"script"))),n.call(e[f],l,f);if(u)for(c=s[s.length-1].ownerDocument,b.map(s,He),f=0;f<u;f++)l=s[f],he.test(l.type||"")&&!G.access(l,"globalEval")&&b.contains(c,l)&&(l.src&&"module"!==(l.type||"").toLowerCase()?b._evalUrl&&!l.noModule&&b._evalUrl(l.src,{nonce:l.nonce||l.getAttribute("nonce")},c):m(l.textContent.replace(je,""),l,c))}return e}function Re(e,t,n){for(var r,i=t?b.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||b.cleanData(ve(r)),r.parentNode&&(n&&re(r)&&ye(ve(r,"script")),r.parentNode.removeChild(r));return e}b.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var r,i,o,a,s,u,l,c=e.cloneNode(!0),f=re(e);if(!(d.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||b.isXMLDoc(e)))for(a=ve(c),r=0,i=(o=ve(e)).length;r<i;r++)s=o[r],u=a[r],l=void 0,"input"===(l=u.nodeName.toLowerCase())&&pe.test(s.type)?u.checked=s.checked:"input"!==l&&"textarea"!==l||(u.defaultValue=s.defaultValue);if(t)if(n)for(o=o||ve(e),a=a||ve(c),r=0,i=o.length;r<i;r++)Oe(o[r],a[r]);else Oe(e,c);return(a=ve(c,"script")).length>0&&ye(a,!f&&ve(e,"script")),c},cleanData:function(e){for(var t,n,r,i=b.event.special,o=0;void 0!==(n=e[o]);o++)if(X(n)){if(t=n[G.expando]){if(t.events)for(r in t.events)i[r]?b.event.remove(n,r):b.removeEvent(n,r,t.handle);n[G.expando]=void 0}n[Y.expando]&&(n[Y.expando]=void 0)}}}),b.fn.extend({detach:function(e){return Re(this,e,!0)},remove:function(e){return Re(this,e)},text:function(e){return B(this,function(e){return void 0===e?b.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return Pe(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||qe(this,e).appendChild(e)})},prepend:function(){return Pe(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=qe(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return Pe(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return Pe(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(b.cleanData(ve(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return b.clone(this,e,t)})},html:function(e){return B(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Ne.test(e)&&!ge[(de.exec(e)||["",""])[1].toLowerCase()]){e=b.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(b.cleanData(ve(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=[];return Pe(this,arguments,function(t){var n=this.parentNode;b.inArray(this,e)<0&&(b.cleanData(ve(this)),n&&n.replaceChild(t,this))},e)}}),b.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){b.fn[e]=function(e){for(var n,r=[],i=b(e),o=i.length-1,s=0;s<=o;s++)n=s===o?this:this.clone(!0),b(i[s])[t](n),a.apply(r,n.get());return this.pushStack(r)}});var Me=new RegExp("^("+Z+")(?!px)[a-z%]+$","i"),Ie=function(t){var n=t.ownerDocument.defaultView;return n&&n.opener||(n=e),n.getComputedStyle(t)},We=function(e,t,n){var r,i,o={};for(i in t)o[i]=e.style[i],e.style[i]=t[i];for(i in r=n.call(e),t)e.style[i]=o[i];return r},Fe=new RegExp(te.join("|"),"i");function Be(e,t,n){var r,i,o,a,s=e.style;return(n=n||Ie(e))&&(""!==(a=n.getPropertyValue(t)||n[t])||re(e)||(a=b.style(e,t)),!d.pixelBoxStyles()&&Me.test(a)&&Fe.test(t)&&(r=s.width,i=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=n.width,s.width=r,s.minWidth=i,s.maxWidth=o)),void 0!==a?a+"":a}function $e(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function t(){if(c){l.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",c.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",ne.appendChild(l).appendChild(c);var t=e.getComputedStyle(c);r="1%"!==t.top,u=12===n(t.marginLeft),c.style.right="60%",a=36===n(t.right),i=36===n(t.width),c.style.position="absolute",o=12===n(c.offsetWidth/3),ne.removeChild(l),c=null}}function n(e){return Math.round(parseFloat(e))}var r,i,o,a,s,u,l=v.createElement("div"),c=v.createElement("div");c.style&&(c.style.backgroundClip="content-box",c.cloneNode(!0).style.backgroundClip="",d.clearCloneStyle="content-box"===c.style.backgroundClip,b.extend(d,{boxSizingReliable:function(){return t(),i},pixelBoxStyles:function(){return t(),a},pixelPosition:function(){return t(),r},reliableMarginLeft:function(){return t(),u},scrollboxSize:function(){return t(),o},reliableTrDimensions:function(){var t,n,r,i;return null==s&&(t=v.createElement("table"),n=v.createElement("tr"),r=v.createElement("div"),t.style.cssText="position:absolute;left:-11111px",n.style.height="1px",r.style.height="9px",ne.appendChild(t).appendChild(n).appendChild(r),i=e.getComputedStyle(n),s=parseInt(i.height)>3,ne.removeChild(t)),s}}))}();var _e=["Webkit","Moz","ms"],ze=v.createElement("div").style,Ue={};function Xe(e){var t=b.cssProps[e]||Ue[e];return t||(e in ze?e:Ue[e]=function(e){for(var t=e[0].toUpperCase()+e.slice(1),n=_e.length;n--;)if((e=_e[n]+t)in ze)return e}(e)||e)}var Ve=/^(none|table(?!-c[ea]).+)/,Ge=/^--/,Ye={position:"absolute",visibility:"hidden",display:"block"},Qe={letterSpacing:"0",fontWeight:"400"};function Je(e,t,n){var r=ee.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function Ke(e,t,n,r,i,o){var a="width"===t?1:0,s=0,u=0;if(n===(r?"border":"content"))return 0;for(;a<4;a+=2)"margin"===n&&(u+=b.css(e,n+te[a],!0,i)),r?("content"===n&&(u-=b.css(e,"padding"+te[a],!0,i)),"margin"!==n&&(u-=b.css(e,"border"+te[a]+"Width",!0,i))):(u+=b.css(e,"padding"+te[a],!0,i),"padding"!==n?u+=b.css(e,"border"+te[a]+"Width",!0,i):s+=b.css(e,"border"+te[a]+"Width",!0,i));return!r&&o>=0&&(u+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-o-u-s-.5))||0),u}function Ze(e,t,n){var r=Ie(e),i=(!d.boxSizingReliable()||n)&&"border-box"===b.css(e,"boxSizing",!1,r),o=i,a=Be(e,t,r),s="offset"+t[0].toUpperCase()+t.slice(1);if(Me.test(a)){if(!n)return a;a="auto"}return(!d.boxSizingReliable()&&i||!d.reliableTrDimensions()&&k(e,"tr")||"auto"===a||!parseFloat(a)&&"inline"===b.css(e,"display",!1,r))&&e.getClientRects().length&&(i="border-box"===b.css(e,"boxSizing",!1,r),(o=s in e)&&(a=e[s])),(a=parseFloat(a)||0)+Ke(e,t,n||(i?"border":"content"),o,r,a)+"px"}function et(e,t,n,r,i){return new et.prototype.init(e,t,n,r,i)}b.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Be(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,a,s=U(t),u=Ge.test(t),l=e.style;if(u||(t=Xe(s)),a=b.cssHooks[t]||b.cssHooks[s],void 0===n)return a&&"get"in a&&void 0!==(i=a.get(e,!1,r))?i:l[t];"string"===(o=typeof n)&&(i=ee.exec(n))&&i[1]&&(n=ae(e,t,i),o="number"),null!=n&&n==n&&("number"!==o||u||(n+=i&&i[3]||(b.cssNumber[s]?"":"px")),d.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,r))||(u?l.setProperty(t,n):l[t]=n))}},css:function(e,t,n,r){var i,o,a,s=U(t);return Ge.test(t)||(t=Xe(s)),(a=b.cssHooks[t]||b.cssHooks[s])&&"get"in a&&(i=a.get(e,!0,n)),void 0===i&&(i=Be(e,t,r)),"normal"===i&&t in Qe&&(i=Qe[t]),""===n||n?(o=parseFloat(i),!0===n||isFinite(o)?o||0:i):i}}),b.each(["height","width"],function(e,t){b.cssHooks[t]={get:function(e,n,r){if(n)return!Ve.test(b.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?Ze(e,t,r):We(e,Ye,function(){return Ze(e,t,r)})},set:function(e,n,r){var i,o=Ie(e),a=!d.scrollboxSize()&&"absolute"===o.position,s=(a||r)&&"border-box"===b.css(e,"boxSizing",!1,o),u=r?Ke(e,t,r,s,o):0;return s&&a&&(u-=Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-parseFloat(o[t])-Ke(e,t,"border",!1,o)-.5)),u&&(i=ee.exec(n))&&"px"!==(i[3]||"px")&&(e.style[t]=n,n=b.css(e,t)),Je(0,n,u)}}}),b.cssHooks.marginLeft=$e(d.reliableMarginLeft,function(e,t){if(t)return(parseFloat(Be(e,"marginLeft"))||e.getBoundingClientRect().left-We(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),b.each({margin:"",padding:"",border:"Width"},function(e,t){b.cssHooks[e+t]={expand:function(n){for(var r=0,i={},o="string"==typeof n?n.split(" "):[n];r<4;r++)i[e+te[r]+t]=o[r]||o[r-2]||o[0];return i}},"margin"!==e&&(b.cssHooks[e+t].set=Je)}),b.fn.extend({css:function(e,t){return B(this,function(e,t,n){var r,i,o={},a=0;if(Array.isArray(t)){for(r=Ie(e),i=t.length;a<i;a++)o[t[a]]=b.css(e,t[a],!1,r);return o}return void 0!==n?b.style(e,t,n):b.css(e,t)},e,t,arguments.length>1)}}),b.Tween=et,et.prototype={constructor:et,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||b.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(b.cssNumber[n]?"":"px")},cur:function(){var e=et.propHooks[this.prop];return e&&e.get?e.get(this):et.propHooks._default.get(this)},run:function(e){var t,n=et.propHooks[this.prop];return this.options.duration?this.pos=t=b.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):et.propHooks._default.set(this),this}},et.prototype.init.prototype=et.prototype,et.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=b.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){b.fx.step[e.prop]?b.fx.step[e.prop](e):1!==e.elem.nodeType||!b.cssHooks[e.prop]&&null==e.elem.style[Xe(e.prop)]?e.elem[e.prop]=e.now:b.style(e.elem,e.prop,e.now+e.unit)}}},et.propHooks.scrollTop=et.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},b.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},b.fx=et.prototype.init,b.fx.step={};var tt,nt,rt=/^(?:toggle|show|hide)$/,it=/queueHooks$/;function ot(){nt&&(!1===v.hidden&&e.requestAnimationFrame?e.requestAnimationFrame(ot):e.setTimeout(ot,b.fx.interval),b.fx.tick())}function at(){return e.setTimeout(function(){tt=void 0}),tt=Date.now()}function st(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i["margin"+(n=te[r])]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function ut(e,t,n){for(var r,i=(lt.tweeners[t]||[]).concat(lt.tweeners["*"]),o=0,a=i.length;o<a;o++)if(r=i[o].call(n,t,e))return r}function lt(e,t,n){var r,i,o=0,a=lt.prefilters.length,s=b.Deferred().always(function(){delete u.elem}),u=function(){if(i)return!1;for(var t=tt||at(),n=Math.max(0,l.startTime+l.duration-t),r=1-(n/l.duration||0),o=0,a=l.tweens.length;o<a;o++)l.tweens[o].run(r);return s.notifyWith(e,[l,r,n]),r<1&&a?n:(a||s.notifyWith(e,[l,1,0]),s.resolveWith(e,[l]),!1)},l=s.promise({elem:e,props:b.extend({},t),opts:b.extend(!0,{specialEasing:{},easing:b.easing._default},n),originalProperties:t,originalOptions:n,startTime:tt||at(),duration:n.duration,tweens:[],createTween:function(t,n){var r=b.Tween(e,l.opts,t,n,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(r),r},stop:function(t){var n=0,r=t?l.tweens.length:0;if(i)return this;for(i=!0;n<r;n++)l.tweens[n].run(1);return t?(s.notifyWith(e,[l,1,0]),s.resolveWith(e,[l,t])):s.rejectWith(e,[l,t]),this}}),c=l.props;for(!function(e,t){var n,r,i,o,a;for(n in e)if(i=t[r=U(n)],o=e[n],Array.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),(a=b.cssHooks[r])&&"expand"in a)for(n in o=a.expand(o),delete e[r],o)n in e||(e[n]=o[n],t[n]=i);else t[r]=i}(c,l.opts.specialEasing);o<a;o++)if(r=lt.prefilters[o].call(l,e,c,l.opts))return h(r.stop)&&(b._queueHooks(l.elem,l.opts.queue).stop=r.stop.bind(r)),r;return b.map(c,ut,l),h(l.opts.start)&&l.opts.start.call(e,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),b.fx.timer(b.extend(u,{elem:e,anim:l,queue:l.opts.queue})),l}b.Animation=b.extend(lt,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return ae(n.elem,e,ee.exec(t),n),n}]},tweener:function(e,t){h(e)?(t=e,e=["*"]):e=e.match(O);for(var n,r=0,i=e.length;r<i;r++)n=e[r],lt.tweeners[n]=lt.tweeners[n]||[],lt.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,i,o,a,s,u,l,c,f="width"in t||"height"in t,p=this,d={},h=e.style,g=e.nodeType&&oe(e),v=G.get(e,"fxshow");for(r in n.queue||(null==(a=b._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,p.always(function(){p.always(function(){a.unqueued--,b.queue(e,"fx").length||a.empty.fire()})})),t)if(i=t[r],rt.test(i)){if(delete t[r],o=o||"toggle"===i,i===(g?"hide":"show")){if("show"!==i||!v||void 0===v[r])continue;g=!0}d[r]=v&&v[r]||b.style(e,r)}if((u=!b.isEmptyObject(t))||!b.isEmptyObject(d))for(r in f&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],null==(l=v&&v.display)&&(l=G.get(e,"display")),"none"===(c=b.css(e,"display"))&&(l?c=l:(le([e],!0),l=e.style.display||l,c=b.css(e,"display"),le([e]))),("inline"===c||"inline-block"===c&&null!=l)&&"none"===b.css(e,"float")&&(u||(p.done(function(){h.display=l}),null==l&&(c=h.display,l="none"===c?"":c)),h.display="inline-block")),n.overflow&&(h.overflow="hidden",p.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),u=!1,d)u||(v?"hidden"in v&&(g=v.hidden):v=G.access(e,"fxshow",{display:l}),o&&(v.hidden=!g),g&&le([e],!0),p.done(function(){for(r in g||le([e]),G.remove(e,"fxshow"),d)b.style(e,r,d[r])})),u=ut(g?v[r]:0,r,p),r in v||(v[r]=u.start,g&&(u.end=u.start,u.start=0))}],prefilter:function(e,t){t?lt.prefilters.unshift(e):lt.prefilters.push(e)}}),b.speed=function(e,t,n){var r=e&&"object"==typeof e?b.extend({},e):{complete:n||!n&&t||h(e)&&e,duration:e,easing:n&&t||t&&!h(t)&&t};return b.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in b.fx.speeds?r.duration=b.fx.speeds[r.duration]:r.duration=b.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){h(r.old)&&r.old.call(this),r.queue&&b.dequeue(this,r.queue)},r},b.fn.extend({fadeTo:function(e,t,n,r){return this.filter(oe).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=b.isEmptyObject(e),o=b.speed(t,n,r),a=function(){var t=lt(this,b.extend({},e),o);(i||G.get(this,"finish"))&&t.stop(!0)};return a.finish=a,i||!1===o.queue?this.each(a):this.queue(o.queue,a)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&this.queue(e||"fx",[]),this.each(function(){var t=!0,i=null!=e&&e+"queueHooks",o=b.timers,a=G.get(this);if(i)a[i]&&a[i].stop&&r(a[i]);else for(i in a)a[i]&&a[i].stop&&it.test(i)&&r(a[i]);for(i=o.length;i--;)o[i].elem!==this||null!=e&&o[i].queue!==e||(o[i].anim.stop(n),t=!1,o.splice(i,1));!t&&n||b.dequeue(this,e)})},finish:function(e){return!1!==e&&(e=e||"fx"),this.each(function(){var t,n=G.get(this),r=n[e+"queue"],i=n[e+"queueHooks"],o=b.timers,a=r?r.length:0;for(n.finish=!0,b.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;t<a;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),b.each(["toggle","show","hide"],function(e,t){var n=b.fn[t];b.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(st(t,!0),e,r,i)}}),b.each({slideDown:st("show"),slideUp:st("hide"),slideToggle:st("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){b.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),b.timers=[],b.fx.tick=function(){var e,t=0,n=b.timers;for(tt=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||b.fx.stop(),tt=void 0},b.fx.timer=function(e){b.timers.push(e),b.fx.start()},b.fx.interval=13,b.fx.start=function(){nt||(nt=!0,ot())},b.fx.stop=function(){nt=null},b.fx.speeds={slow:600,fast:200,_default:400},b.fn.delay=function(t,n){return t=b.fx&&b.fx.speeds[t]||t,n=n||"fx",this.queue(n,function(n,r){var i=e.setTimeout(n,t);r.stop=function(){e.clearTimeout(i)}})},function(){var e=v.createElement("input"),t=v.createElement("select").appendChild(v.createElement("option"));e.type="checkbox",d.checkOn=""!==e.value,d.optSelected=t.selected,(e=v.createElement("input")).value="t",e.type="radio",d.radioValue="t"===e.value}();var ct,ft=b.expr.attrHandle;b.fn.extend({attr:function(e,t){return B(this,b.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){b.removeAttr(this,e)})}}),b.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return void 0===e.getAttribute?b.prop(e,t,n):(1===o&&b.isXMLDoc(e)||(i=b.attrHooks[t.toLowerCase()]||(b.expr.match.bool.test(t)?ct:void 0)),void 0!==n?null===n?void b.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):i&&"get"in i&&null!==(r=i.get(e,t))?r:null==(r=b.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!d.radioValue&&"radio"===t&&k(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(O);if(i&&1===e.nodeType)for(;n=i[r++];)e.removeAttribute(n)}}),ct={set:function(e,t,n){return!1===t?b.removeAttr(e,n):e.setAttribute(n,n),n}},b.each(b.expr.match.bool.source.match(/\w+/g),function(e,t){var n=ft[t]||b.find.attr;ft[t]=function(e,t,r){var i,o,a=t.toLowerCase();return r||(o=ft[a],ft[a]=i,i=null!=n(e,t,r)?a:null,ft[a]=o),i}});var pt=/^(?:input|select|textarea|button)$/i,dt=/^(?:a|area)$/i;function ht(e){return(e.match(O)||[]).join(" ")}function gt(e){return e.getAttribute&&e.getAttribute("class")||""}function vt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(O)||[]}b.fn.extend({prop:function(e,t){return B(this,b.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[b.propFix[e]||e]})}}),b.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&b.isXMLDoc(e)||(t=b.propFix[t]||t,i=b.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=b.find.attr(e,"tabindex");return t?parseInt(t,10):pt.test(e.nodeName)||dt.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),d.optSelected||(b.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),b.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){b.propFix[this.toLowerCase()]=this}),b.fn.extend({addClass:function(e){var t,n,r,i,o,a,s,u=0;if(h(e))return this.each(function(t){b(this).addClass(e.call(this,t,gt(this)))});if((t=vt(e)).length)for(;n=this[u++];)if(i=gt(n),r=1===n.nodeType&&" "+ht(i)+" "){for(a=0;o=t[a++];)r.indexOf(" "+o+" ")<0&&(r+=o+" ");i!==(s=ht(r))&&n.setAttribute("class",s)}return this},removeClass:function(e){var t,n,r,i,o,a,s,u=0;if(h(e))return this.each(function(t){b(this).removeClass(e.call(this,t,gt(this)))});if(!arguments.length)return this.attr("class","");if((t=vt(e)).length)for(;n=this[u++];)if(i=gt(n),r=1===n.nodeType&&" "+ht(i)+" "){for(a=0;o=t[a++];)for(;r.indexOf(" "+o+" ")>-1;)r=r.replace(" "+o+" "," ");i!==(s=ht(r))&&n.setAttribute("class",s)}return this},toggleClass:function(e,t){var n=typeof e,r="string"===n||Array.isArray(e);return"boolean"==typeof t&&r?t?this.addClass(e):this.removeClass(e):h(e)?this.each(function(n){b(this).toggleClass(e.call(this,n,gt(this),t),t)}):this.each(function(){var t,i,o,a;if(r)for(i=0,o=b(this),a=vt(e);t=a[i++];)o.hasClass(t)?o.removeClass(t):o.addClass(t);else void 0!==e&&"boolean"!==n||((t=gt(this))&&G.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",t||!1===e?"":G.get(this,"__className__")||""))})},hasClass:function(e){var t,n,r=0;for(t=" "+e+" ";n=this[r++];)if(1===n.nodeType&&(" "+ht(gt(n))+" ").indexOf(t)>-1)return!0;return!1}});var yt=/\r/g;b.fn.extend({val:function(e){var t,n,r,i=this[0];return arguments.length?(r=h(e),this.each(function(n){var i;1===this.nodeType&&(null==(i=r?e.call(this,n,b(this).val()):e)?i="":"number"==typeof i?i+="":Array.isArray(i)&&(i=b.map(i,function(e){return null==e?"":e+""})),(t=b.valHooks[this.type]||b.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,i,"value")||(this.value=i))})):i?(t=b.valHooks[i.type]||b.valHooks[i.nodeName.toLowerCase()])&&"get"in t&&void 0!==(n=t.get(i,"value"))?n:"string"==typeof(n=i.value)?n.replace(yt,""):null==n?"":n:void 0}}),b.extend({valHooks:{option:{get:function(e){var t=b.find.attr(e,"value");return null!=t?t:ht(b.text(e))}},select:{get:function(e){var t,n,r,i=e.options,o=e.selectedIndex,a="select-one"===e.type,s=a?null:[],u=a?o+1:i.length;for(r=o<0?u:a?o:0;r<u;r++)if(((n=i[r]).selected||r===o)&&!n.disabled&&(!n.parentNode.disabled||!k(n.parentNode,"optgroup"))){if(t=b(n).val(),a)return t;s.push(t)}return s},set:function(e,t){for(var n,r,i=e.options,o=b.makeArray(t),a=i.length;a--;)((r=i[a]).selected=b.inArray(b.valHooks.option.get(r),o)>-1)&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),b.each(["radio","checkbox"],function(){b.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=b.inArray(b(e).val(),t)>-1}},d.checkOn||(b.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),d.focusin="onfocusin"in e;var mt=/^(?:focusinfocus|focusoutblur)$/,xt=function(e){e.stopPropagation()};b.extend(b.event,{trigger:function(t,n,r,i){var o,a,s,u,l,f,p,d,y=[r||v],m=c.call(t,"type")?t.type:t,x=c.call(t,"namespace")?t.namespace.split("."):[];if(a=d=s=r=r||v,3!==r.nodeType&&8!==r.nodeType&&!mt.test(m+b.event.triggered)&&(m.indexOf(".")>-1&&(x=m.split("."),m=x.shift(),x.sort()),l=m.indexOf(":")<0&&"on"+m,(t=t[b.expando]?t:new b.Event(m,"object"==typeof t&&t)).isTrigger=i?2:3,t.namespace=x.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+x.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=r),n=null==n?[t]:b.makeArray(n,[t]),p=b.event.special[m]||{},i||!p.trigger||!1!==p.trigger.apply(r,n))){if(!i&&!p.noBubble&&!g(r)){for(u=p.delegateType||m,mt.test(u+m)||(a=a.parentNode);a;a=a.parentNode)y.push(a),s=a;s===(r.ownerDocument||v)&&y.push(s.defaultView||s.parentWindow||e)}for(o=0;(a=y[o++])&&!t.isPropagationStopped();)d=a,t.type=o>1?u:p.bindType||m,(f=(G.get(a,"events")||Object.create(null))[t.type]&&G.get(a,"handle"))&&f.apply(a,n),(f=l&&a[l])&&f.apply&&X(a)&&(t.result=f.apply(a,n),!1===t.result&&t.preventDefault());return t.type=m,i||t.isDefaultPrevented()||p._default&&!1!==p._default.apply(y.pop(),n)||!X(r)||l&&h(r[m])&&!g(r)&&((s=r[l])&&(r[l]=null),b.event.triggered=m,t.isPropagationStopped()&&d.addEventListener(m,xt),r[m](),t.isPropagationStopped()&&d.removeEventListener(m,xt),b.event.triggered=void 0,s&&(r[l]=s)),t.result}},simulate:function(e,t,n){var r=b.extend(new b.Event,n,{type:e,isSimulated:!0});b.event.trigger(r,null,t)}}),b.fn.extend({trigger:function(e,t){return this.each(function(){b.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return b.event.trigger(e,t,n,!0)}}),d.focusin||b.each({focus:"focusin",blur:"focusout"},function(e,t){var n=function(e){b.event.simulate(t,e.target,b.event.fix(e))};b.event.special[t]={setup:function(){var r=this.ownerDocument||this.document||this,i=G.access(r,t);i||r.addEventListener(e,n,!0),G.access(r,t,(i||0)+1)},teardown:function(){var r=this.ownerDocument||this.document||this,i=G.access(r,t)-1;i?G.access(r,t,i):(r.removeEventListener(e,n,!0),G.remove(r,t))}}});var bt=e.location,wt={guid:Date.now()},Tt=/\?/;b.parseXML=function(t){var n;if(!t||"string"!=typeof t)return null;try{n=(new e.DOMParser).parseFromString(t,"text/xml")}catch(e){n=void 0}return n&&!n.getElementsByTagName("parsererror").length||b.error("Invalid XML: "+t),n};var Ct=/\[\]$/,Et=/\r?\n/g,St=/^(?:submit|button|image|reset|file)$/i,kt=/^(?:input|select|textarea|keygen)/i;function At(e,t,n,r){var i;if(Array.isArray(t))b.each(t,function(t,i){n||Ct.test(e)?r(e,i):At(e+"["+("object"==typeof i&&null!=i?t:"")+"]",i,n,r)});else if(n||"object"!==x(t))r(e,t);else for(i in t)At(e+"["+i+"]",t[i],n,r)}b.param=function(e,t){var n,r=[],i=function(e,t){var n=h(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!b.isPlainObject(e))b.each(e,function(){i(this.name,this.value)});else for(n in e)At(n,e[n],t,i);return r.join("&")},b.fn.extend({serialize:function(){return b.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=b.prop(this,"elements");return e?b.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!b(this).is(":disabled")&&kt.test(this.nodeName)&&!St.test(e)&&(this.checked||!pe.test(e))}).map(function(e,t){var n=b(this).val();return null==n?null:Array.isArray(n)?b.map(n,function(e){return{name:t.name,value:e.replace(Et,"\r\n")}}):{name:t.name,value:n.replace(Et,"\r\n")}}).get()}});var Nt=/%20/g,Dt=/#.*$/,jt=/([?&])_=[^&]*/,qt=/^(.*?):[ \t]*([^\r\n]*)$/gm,Lt=/^(?:GET|HEAD)$/,Ht=/^\/\//,Ot={},Pt={},Rt="*/".concat("*"),Mt=v.createElement("a");function It(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,o=t.toLowerCase().match(O)||[];if(h(n))for(;r=o[i++];)"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function Wt(e,t,n,r){var i={},o=e===Pt;function a(s){var u;return i[s]=!0,b.each(e[s]||[],function(e,s){var l=s(t,n,r);return"string"!=typeof l||o||i[l]?o?!(u=l):void 0:(t.dataTypes.unshift(l),a(l),!1)}),u}return a(t.dataTypes[0])||!i["*"]&&a("*")}function Ft(e,t){var n,r,i=b.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&b.extend(!0,e,r),e}Mt.href=bt.href,b.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:bt.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(bt.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Rt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":b.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Ft(Ft(e,b.ajaxSettings),t):Ft(b.ajaxSettings,e)},ajaxPrefilter:It(Ot),ajaxTransport:It(Pt),ajax:function(t,n){"object"==typeof t&&(n=t,t=void 0),n=n||{};var r,i,o,a,s,u,l,c,f,p,d=b.ajaxSetup({},n),h=d.context||d,g=d.context&&(h.nodeType||h.jquery)?b(h):b.event,y=b.Deferred(),m=b.Callbacks("once memory"),x=d.statusCode||{},w={},T={},C="canceled",E={readyState:0,getResponseHeader:function(e){var t;if(l){if(!a)for(a={};t=qt.exec(o);)a[t[1].toLowerCase()+" "]=(a[t[1].toLowerCase()+" "]||[]).concat(t[2]);t=a[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return l?o:null},setRequestHeader:function(e,t){return null==l&&(e=T[e.toLowerCase()]=T[e.toLowerCase()]||e,w[e]=t),this},overrideMimeType:function(e){return null==l&&(d.mimeType=e),this},statusCode:function(e){var t;if(e)if(l)E.always(e[E.status]);else for(t in e)x[t]=[x[t],e[t]];return this},abort:function(e){var t=e||C;return r&&r.abort(t),S(0,t),this}};if(y.promise(E),d.url=((t||d.url||bt.href)+"").replace(Ht,bt.protocol+"//"),d.type=n.method||n.type||d.method||d.type,d.dataTypes=(d.dataType||"*").toLowerCase().match(O)||[""],null==d.crossDomain){u=v.createElement("a");try{u.href=d.url,u.href=u.href,d.crossDomain=Mt.protocol+"//"+Mt.host!=u.protocol+"//"+u.host}catch(e){d.crossDomain=!0}}if(d.data&&d.processData&&"string"!=typeof d.data&&(d.data=b.param(d.data,d.traditional)),Wt(Ot,d,n,E),l)return E;for(f in(c=b.event&&d.global)&&0==b.active++&&b.event.trigger("ajaxStart"),d.type=d.type.toUpperCase(),d.hasContent=!Lt.test(d.type),i=d.url.replace(Dt,""),d.hasContent?d.data&&d.processData&&0===(d.contentType||"").indexOf("application/x-www-form-urlencoded")&&(d.data=d.data.replace(Nt,"+")):(p=d.url.slice(i.length),d.data&&(d.processData||"string"==typeof d.data)&&(i+=(Tt.test(i)?"&":"?")+d.data,delete d.data),!1===d.cache&&(i=i.replace(jt,"$1"),p=(Tt.test(i)?"&":"?")+"_="+wt.guid+++p),d.url=i+p),d.ifModified&&(b.lastModified[i]&&E.setRequestHeader("If-Modified-Since",b.lastModified[i]),b.etag[i]&&E.setRequestHeader("If-None-Match",b.etag[i])),(d.data&&d.hasContent&&!1!==d.contentType||n.contentType)&&E.setRequestHeader("Content-Type",d.contentType),E.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+("*"!==d.dataTypes[0]?", "+Rt+"; q=0.01":""):d.accepts["*"]),d.headers)E.setRequestHeader(f,d.headers[f]);if(d.beforeSend&&(!1===d.beforeSend.call(h,E,d)||l))return E.abort();if(C="abort",m.add(d.complete),E.done(d.success),E.fail(d.error),r=Wt(Pt,d,n,E)){if(E.readyState=1,c&&g.trigger("ajaxSend",[E,d]),l)return E;d.async&&d.timeout>0&&(s=e.setTimeout(function(){E.abort("timeout")},d.timeout));try{l=!1,r.send(w,S)}catch(e){if(l)throw e;S(-1,e)}}else S(-1,"No Transport");function S(t,n,a,u){var f,p,v,w,T,C=n;l||(l=!0,s&&e.clearTimeout(s),r=void 0,o=u||"",E.readyState=t>0?4:0,f=t>=200&&t<300||304===t,a&&(w=function(e,t,n){for(var r,i,o,a,s=e.contents,u=e.dataTypes;"*"===u[0];)u.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in s)if(s[i]&&s[i].test(r)){u.unshift(i);break}if(u[0]in n)o=u[0];else{for(i in n){if(!u[0]||e.converters[i+" "+u[0]]){o=i;break}a||(a=i)}o=o||a}if(o)return o!==u[0]&&u.unshift(o),n[o]}(d,E,a)),!f&&b.inArray("script",d.dataTypes)>-1&&(d.converters["text script"]=function(){}),w=function(e,t,n,r){var i,o,a,s,u,l={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)l[a.toLowerCase()]=e.converters[a];for(o=c.shift();o;)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=c.shift())if("*"===o)o=u;else if("*"!==u&&u!==o){if(!(a=l[u+" "+o]||l["* "+o]))for(i in l)if((s=i.split(" "))[1]===o&&(a=l[u+" "+s[0]]||l["* "+s[0]])){!0===a?a=l[i]:!0!==l[i]&&(o=s[0],c.unshift(s[1]));break}if(!0!==a)if(a&&e.throws)t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+u+" to "+o}}}return{state:"success",data:t}}(d,w,E,f),f?(d.ifModified&&((T=E.getResponseHeader("Last-Modified"))&&(b.lastModified[i]=T),(T=E.getResponseHeader("etag"))&&(b.etag[i]=T)),204===t||"HEAD"===d.type?C="nocontent":304===t?C="notmodified":(C=w.state,p=w.data,f=!(v=w.error))):(v=C,!t&&C||(C="error",t<0&&(t=0))),E.status=t,E.statusText=(n||C)+"",f?y.resolveWith(h,[p,C,E]):y.rejectWith(h,[E,C,v]),E.statusCode(x),x=void 0,c&&g.trigger(f?"ajaxSuccess":"ajaxError",[E,d,f?p:v]),m.fireWith(h,[E,C]),c&&(g.trigger("ajaxComplete",[E,d]),--b.active||b.event.trigger("ajaxStop")))}return E},getJSON:function(e,t,n){return b.get(e,t,n,"json")},getScript:function(e,t){return b.get(e,void 0,t,"script")}}),b.each(["get","post"],function(e,t){b[t]=function(e,n,r,i){return h(n)&&(i=i||r,r=n,n=void 0),b.ajax(b.extend({url:e,type:t,dataType:i,data:n,success:r},b.isPlainObject(e)&&e))}}),b.ajaxPrefilter(function(e){var t;for(t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")}),b._evalUrl=function(e,t,n){return b.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){b.globalEval(e,t,n)}})},b.fn.extend({wrapAll:function(e){var t;return this[0]&&(h(e)&&(e=e.call(this[0])),t=b(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(e){return h(e)?this.each(function(t){b(this).wrapInner(e.call(this,t))}):this.each(function(){var t=b(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=h(e);return this.each(function(n){b(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(e){return this.parent(e).not("body").each(function(){b(this).replaceWith(this.childNodes)}),this}}),b.expr.pseudos.hidden=function(e){return!b.expr.pseudos.visible(e)},b.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},b.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch(e){}};var Bt={0:200,1223:204},$t=b.ajaxSettings.xhr();d.cors=!!$t&&"withCredentials"in $t,d.ajax=$t=!!$t,b.ajaxTransport(function(t){var n,r;if(d.cors||$t&&!t.crossDomain)return{send:function(i,o){var a,s=t.xhr();if(s.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(a in t.xhrFields)s[a]=t.xhrFields[a];for(a in t.mimeType&&s.overrideMimeType&&s.overrideMimeType(t.mimeType),t.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest"),i)s.setRequestHeader(a,i[a]);n=function(e){return function(){n&&(n=r=s.onload=s.onerror=s.onabort=s.ontimeout=s.onreadystatechange=null,"abort"===e?s.abort():"error"===e?"number"!=typeof s.status?o(0,"error"):o(s.status,s.statusText):o(Bt[s.status]||s.status,s.statusText,"text"!==(s.responseType||"text")||"string"!=typeof s.responseText?{binary:s.response}:{text:s.responseText},s.getAllResponseHeaders()))}},s.onload=n(),r=s.onerror=s.ontimeout=n("error"),void 0!==s.onabort?s.onabort=r:s.onreadystatechange=function(){4===s.readyState&&e.setTimeout(function(){n&&r()})},n=n("abort");try{s.send(t.hasContent&&t.data||null)}catch(e){if(n)throw e}},abort:function(){n&&n()}}}),b.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),b.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return b.globalEval(e),e}}}),b.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),b.ajaxTransport("script",function(e){var t,n;if(e.crossDomain||e.scriptAttrs)return{send:function(r,i){t=b("<script>").attr(e.scriptAttrs||{}).prop({charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&i("error"===e.type?404:200,e.type)}),v.head.appendChild(t[0])},abort:function(){n&&n()}}});var _t,zt=[],Ut=/(=)\?(?=&|$)|\?\?/;b.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=zt.pop()||b.expando+"_"+wt.guid++;return this[e]=!0,e}}),b.ajaxPrefilter("json jsonp",function(t,n,r){var i,o,a,s=!1!==t.jsonp&&(Ut.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&Ut.test(t.data)&&"data");if(s||"jsonp"===t.dataTypes[0])return i=t.jsonpCallback=h(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,s?t[s]=t[s].replace(Ut,"$1"+i):!1!==t.jsonp&&(t.url+=(Tt.test(t.url)?"&":"?")+t.jsonp+"="+i),t.converters["script json"]=function(){return a||b.error(i+" was not called"),a[0]},t.dataTypes[0]="json",o=e[i],e[i]=function(){a=arguments},r.always(function(){void 0===o?b(e).removeProp(i):e[i]=o,t[i]&&(t.jsonpCallback=n.jsonpCallback,zt.push(i)),a&&h(o)&&o(a[0]),a=o=void 0}),"script"}),d.createHTMLDocument=((_t=v.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===_t.childNodes.length),b.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(d.createHTMLDocument?((r=(t=v.implementation.createHTMLDocument("")).createElement("base")).href=v.location.href,t.head.appendChild(r)):t=v),o=!n&&[],(i=A.exec(e))?[t.createElement(i[1])]:(i=xe([e],t,o),o&&o.length&&b(o).remove(),b.merge([],i.childNodes)));var r,i,o},b.fn.load=function(e,t,n){var r,i,o,a=this,s=e.indexOf(" ");return s>-1&&(r=ht(e.slice(s)),e=e.slice(0,s)),h(t)?(n=t,t=void 0):t&&"object"==typeof t&&(i="POST"),a.length>0&&b.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done(function(e){o=arguments,a.html(r?b("<div>").append(b.parseHTML(e)).find(r):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,o||[e.responseText,t,e])})}),this},b.expr.pseudos.animated=function(e){return b.grep(b.timers,function(t){return e===t.elem}).length},b.offset={setOffset:function(e,t,n){var r,i,o,a,s,u,l=b.css(e,"position"),c=b(e),f={};"static"===l&&(e.style.position="relative"),s=c.offset(),o=b.css(e,"top"),u=b.css(e,"left"),("absolute"===l||"fixed"===l)&&(o+u).indexOf("auto")>-1?(a=(r=c.position()).top,i=r.left):(a=parseFloat(o)||0,i=parseFloat(u)||0),h(t)&&(t=t.call(e,n,b.extend({},s))),null!=t.top&&(f.top=t.top-s.top+a),null!=t.left&&(f.left=t.left-s.left+i),"using"in t?t.using.call(e,f):("number"==typeof f.top&&(f.top+="px"),"number"==typeof f.left&&(f.left+="px"),c.css(f))}},b.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){b.offset.setOffset(this,e,t)});var t,n,r=this[0];return r?r.getClientRects().length?(t=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:t.top+n.pageYOffset,left:t.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if("fixed"===b.css(r,"position"))t=r.getBoundingClientRect();else{for(t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;e&&(e===n.body||e===n.documentElement)&&"static"===b.css(e,"position");)e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=b(e).offset()).top+=b.css(e,"borderTopWidth",!0),i.left+=b.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-b.css(r,"marginTop",!0),left:t.left-i.left-b.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&"static"===b.css(e,"position");)e=e.offsetParent;return e||ne})}}),b.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var n="pageYOffset"===t;b.fn[e]=function(r){return B(this,function(e,r,i){var o;if(g(e)?o=e:9===e.nodeType&&(o=e.defaultView),void 0===i)return o?o[t]:e[r];o?o.scrollTo(n?o.pageXOffset:i,n?i:o.pageYOffset):e[r]=i},e,r,arguments.length)}}),b.each(["top","left"],function(e,t){b.cssHooks[t]=$e(d.pixelPosition,function(e,n){if(n)return n=Be(e,t),Me.test(n)?b(e).position()[t]+"px":n})}),b.each({Height:"height",Width:"width"},function(e,t){b.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,r){b.fn[r]=function(i,o){var a=arguments.length&&(n||"boolean"!=typeof i),s=n||(!0===i||!0===o?"margin":"border");return B(this,function(t,n,i){var o;return g(t)?0===r.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(o=t.documentElement,Math.max(t.body["scroll"+e],o["scroll"+e],t.body["offset"+e],o["offset"+e],o["client"+e])):void 0===i?b.css(t,n,s):b.style(t,n,i,s)},t,a?i:void 0,a)}})}),b.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){b.fn[t]=function(e){return this.on(t,e)}}),b.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),b.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,t){b.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}});var Xt=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;b.proxy=function(e,t){var n,r,o;if("string"==typeof t&&(n=e[t],t=e,e=n),h(e))return r=i.call(arguments,2),(o=function(){return e.apply(t||this,r.concat(i.call(arguments)))}).guid=e.guid=e.guid||b.guid++,o},b.holdReady=function(e){e?b.readyWait++:b.ready(!0)},b.isArray=Array.isArray,b.parseJSON=JSON.parse,b.nodeName=k,b.isFunction=h,b.isWindow=g,b.camelCase=U,b.type=x,b.now=Date.now,b.isNumeric=function(e){var t=b.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},b.trim=function(e){return null==e?"":(e+"").replace(Xt,"")},"function"==typeof define&&define.amd&&define("jquery",[],function(){return b});var Vt=e.jQuery,Gt=e.$;return b.noConflict=function(t){return e.$===b&&(e.$=Gt),t&&e.jQuery===b&&(e.jQuery=Vt),b},void 0===t&&(e.jQuery=e.$=b),b});

},{}],312:[function(require,module,exports){
var LZString=function(){var o=String.fromCharCode,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",e={};function t(o,r){if(!e[o]){e[o]={};for(var n=0;n<o.length;n++)e[o][o.charAt(n)]=n}return e[o][r]}var i={compressToBase64:function(o){if(null==o)return"";var n=i._compress(o,6,function(o){return r.charAt(o)});switch(n.length%4){default:case 0:return n;case 1:return n+"===";case 2:return n+"==";case 3:return n+"="}},decompressFromBase64:function(o){return null==o?"":""==o?null:i._decompress(o.length,32,function(n){return t(r,o.charAt(n))})},compressToUTF16:function(r){return null==r?"":i._compress(r,15,function(r){return o(r+32)})+" "},decompressFromUTF16:function(o){return null==o?"":""==o?null:i._decompress(o.length,16384,function(r){return o.charCodeAt(r)-32})},compressToUint8Array:function(o){for(var r=i.compress(o),n=new Uint8Array(2*r.length),e=0,t=r.length;e<t;e++){var s=r.charCodeAt(e);n[2*e]=s>>>8,n[2*e+1]=s%256}return n},decompressFromUint8Array:function(r){if(null==r)return i.decompress(r);for(var n=new Array(r.length/2),e=0,t=n.length;e<t;e++)n[e]=256*r[2*e]+r[2*e+1];var s=[];return n.forEach(function(r){s.push(o(r))}),i.decompress(s.join(""))},compressToEncodedURIComponent:function(o){return null==o?"":i._compress(o,6,function(o){return n.charAt(o)})},decompressFromEncodedURIComponent:function(o){return null==o?"":""==o?null:(o=o.replace(/ /g,"+"),i._decompress(o.length,32,function(r){return t(n,o.charAt(r))}))},compress:function(r){return i._compress(r,16,function(r){return o(r)})},_compress:function(o,r,n){if(null==o)return"";var e,t,i,s={},p={},u="",c="",a="",l=2,f=3,h=2,d=[],m=0,v=0;for(i=0;i<o.length;i+=1)if(u=o.charAt(i),Object.prototype.hasOwnProperty.call(s,u)||(s[u]=f++,p[u]=!0),c=a+u,Object.prototype.hasOwnProperty.call(s,c))a=c;else{if(Object.prototype.hasOwnProperty.call(p,a)){if(a.charCodeAt(0)<256){for(e=0;e<h;e++)m<<=1,v==r-1?(v=0,d.push(n(m)),m=0):v++;for(t=a.charCodeAt(0),e=0;e<8;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1}else{for(t=1,e=0;e<h;e++)m=m<<1|t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t=0;for(t=a.charCodeAt(0),e=0;e<16;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1}0==--l&&(l=Math.pow(2,h),h++),delete p[a]}else for(t=s[a],e=0;e<h;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1;0==--l&&(l=Math.pow(2,h),h++),s[c]=f++,a=String(u)}if(""!==a){if(Object.prototype.hasOwnProperty.call(p,a)){if(a.charCodeAt(0)<256){for(e=0;e<h;e++)m<<=1,v==r-1?(v=0,d.push(n(m)),m=0):v++;for(t=a.charCodeAt(0),e=0;e<8;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1}else{for(t=1,e=0;e<h;e++)m=m<<1|t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t=0;for(t=a.charCodeAt(0),e=0;e<16;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1}0==--l&&(l=Math.pow(2,h),h++),delete p[a]}else for(t=s[a],e=0;e<h;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1;0==--l&&(l=Math.pow(2,h),h++)}for(t=2,e=0;e<h;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1;for(;;){if(m<<=1,v==r-1){d.push(n(m));break}v++}return d.join("")},decompress:function(o){return null==o?"":""==o?null:i._decompress(o.length,32768,function(r){return o.charCodeAt(r)})},_decompress:function(r,n,e){var t,i,s,p,u,c,a,l=[],f=4,h=4,d=3,m="",v=[],w={val:e(0),position:n,index:1};for(t=0;t<3;t+=1)l[t]=t;for(s=0,u=Math.pow(2,2),c=1;c!=u;)p=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=e(w.index++)),s|=(p>0?1:0)*c,c<<=1;switch(s){case 0:for(s=0,u=Math.pow(2,8),c=1;c!=u;)p=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=e(w.index++)),s|=(p>0?1:0)*c,c<<=1;a=o(s);break;case 1:for(s=0,u=Math.pow(2,16),c=1;c!=u;)p=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=e(w.index++)),s|=(p>0?1:0)*c,c<<=1;a=o(s);break;case 2:return""}for(l[3]=a,i=a,v.push(a);;){if(w.index>r)return"";for(s=0,u=Math.pow(2,d),c=1;c!=u;)p=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=e(w.index++)),s|=(p>0?1:0)*c,c<<=1;switch(a=s){case 0:for(s=0,u=Math.pow(2,8),c=1;c!=u;)p=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=e(w.index++)),s|=(p>0?1:0)*c,c<<=1;l[h++]=o(s),a=h-1,f--;break;case 1:for(s=0,u=Math.pow(2,16),c=1;c!=u;)p=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=e(w.index++)),s|=(p>0?1:0)*c,c<<=1;l[h++]=o(s),a=h-1,f--;break;case 2:return v.join("")}if(0==f&&(f=Math.pow(2,d),d++),l[a])m=l[a];else{if(a!==h)return null;m=i+i.charAt(0)}v.push(m),l[h++]=i+m.charAt(0),i=m,0==--f&&(f=Math.pow(2,d),d++)}}};return i}();"function"==typeof define&&define.amd?define(function(){return LZString}):"undefined"!=typeof module&&null!=module&&(module.exports=LZString);

},{}],313:[function(require,module,exports){
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).marked=t()}(this,function(){"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function n(e,n){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,n){if(e){if("string"==typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){r&&(e=r);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(r=e[Symbol.iterator]()).next.bind(r)}var r,i=(function(e){function t(){return{baseUrl:null,breaks:!1,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartLists:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1}}e.exports={defaults:{baseUrl:null,breaks:!1,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartLists:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1},getDefaults:t,changeDefaults:function(t){e.exports.defaults=t}}}(r={exports:{}},r.exports),r.exports),s=(i.defaults,i.getDefaults,i.changeDefaults,/[&<>"']/),l=/[&<>"']/g,a=/[<>"']|&(?!#?\w+;)/,o=/[<>"']|&(?!#?\w+;)/g,c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},u=function(e){return c[e]};var p=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi;function h(e){return e.replace(p,function(e,t){return"colon"===(t=t.toLowerCase())?":":"#"===t.charAt(0)?"x"===t.charAt(1)?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""})}var g=/(^|[^\[])\^/g;var f=/[^\w:]/g,d=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;var k={},b=/^[^:]+:\/*[^/]*$/,m=/^([^:]+:)[\s\S]*$/,x=/^([^:]+:\/*[^/]*)[\s\S]*$/;function v(e,t){k[" "+e]||(b.test(e)?k[" "+e]=e+"/":k[" "+e]=w(e,"/",!0));var n=-1===(e=k[" "+e]).indexOf(":");return"//"===t.substring(0,2)?n?t:e.replace(m,"$1")+t:"/"===t.charAt(0)?n?t:e.replace(x,"$1")+t:e+t}function w(e,t,n){var r=e.length;if(0===r)return"";for(var i=0;i<r;){var s=e.charAt(r-i-1);if(s!==t||n){if(s===t||!n)break;i++}else i++}return e.substr(0,r-i)}var _=function(e,t){if(t){if(s.test(e))return e.replace(l,u)}else if(a.test(e))return e.replace(o,u);return e},y=h,z=function(e,t){e=e.source||e,t=t||"";var n={replace:function(t,r){return r=(r=r.source||r).replace(g,"$1"),e=e.replace(t,r),n},getRegex:function(){return new RegExp(e,t)}};return n},S=function(e,t,n){if(e){var r;try{r=decodeURIComponent(h(n)).replace(f,"").toLowerCase()}catch(e){return null}if(0===r.indexOf("javascript:")||0===r.indexOf("vbscript:")||0===r.indexOf("data:"))return null}t&&!d.test(n)&&(n=v(t,n));try{n=encodeURI(n).replace(/%25/g,"%")}catch(e){return null}return n},$={exec:function(){}},A=function(e){for(var t,n,r=1;r<arguments.length;r++)for(n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},R=function(e,t){var n=e.replace(/\|/g,function(e,t,n){for(var r=!1,i=t;--i>=0&&"\\"===n[i];)r=!r;return r?"|":" |"}).split(/ \|/),r=0;if(n.length>t)n.splice(t);else for(;n.length<t;)n.push("");for(;r<n.length;r++)n[r]=n[r].trim().replace(/\\\|/g,"|");return n},T=w,I=function(e,t){if(-1===e.indexOf(t[1]))return-1;for(var n=e.length,r=0,i=0;i<n;i++)if("\\"===e[i])i++;else if(e[i]===t[0])r++;else if(e[i]===t[1]&&--r<0)return i;return-1},Z=function(e){e&&e.sanitize&&!e.silent&&console.warn("marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options")},q=i.defaults,O=T,U=R,C=_,j=I;function E(e,t,n){var r=t.href,i=t.title?C(t.title):null,s=e[1].replace(/\\([\[\]])/g,"$1");return"!"!==e[0].charAt(0)?{type:"link",raw:n,href:r,title:i,text:s}:{type:"image",raw:n,href:r,title:i,text:C(s)}}var P=function(){function e(e){this.options=e||q}var t=e.prototype;return t.space=function(e){var t=this.rules.block.newline.exec(e);if(t)return t[0].length>1?{type:"space",raw:t[0]}:{raw:"\n"}},t.code=function(e,t){var n=this.rules.block.code.exec(e);if(n){var r=t[t.length-1];if(r&&"paragraph"===r.type)return{raw:n[0],text:n[0].trimRight()};var i=n[0].replace(/^ {4}/gm,"");return{type:"code",raw:n[0],codeBlockStyle:"indented",text:this.options.pedantic?i:O(i,"\n")}}},t.fences=function(e){var t=this.rules.block.fences.exec(e);if(t){var n=t[0],r=function(e,t){var n=e.match(/^(\s+)(?:```)/);if(null===n)return t;var r=n[1];return t.split("\n").map(function(e){var t=e.match(/^\s+/);return null===t?e:t[0].length>=r.length?e.slice(r.length):e}).join("\n")}(n,t[3]||"");return{type:"code",raw:n,lang:t[2]?t[2].trim():t[2],text:r}}},t.heading=function(e){var t=this.rules.block.heading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[1].length,text:t[2]}},t.nptable=function(e){var t=this.rules.block.nptable.exec(e);if(t){var n={type:"table",header:U(t[1].replace(/^ *| *\| *$/g,"")),align:t[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:t[3]?t[3].replace(/\n$/,"").split("\n"):[],raw:t[0]};if(n.header.length===n.align.length){var r,i=n.align.length;for(r=0;r<i;r++)/^ *-+: *$/.test(n.align[r])?n.align[r]="right":/^ *:-+: *$/.test(n.align[r])?n.align[r]="center":/^ *:-+ *$/.test(n.align[r])?n.align[r]="left":n.align[r]=null;for(i=n.cells.length,r=0;r<i;r++)n.cells[r]=U(n.cells[r],n.header.length);return n}}},t.hr=function(e){var t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:t[0]}},t.blockquote=function(e){var t=this.rules.block.blockquote.exec(e);if(t){var n=t[0].replace(/^ *> ?/gm,"");return{type:"blockquote",raw:t[0],text:n}}},t.list=function(e){var t=this.rules.block.list.exec(e);if(t){for(var n,r,i,s,l,a,o,c=t[0],u=t[2],p=u.length>1,h=")"===u[u.length-1],g={type:"list",raw:c,ordered:p,start:p?+u.slice(0,-1):"",loose:!1,items:[]},f=t[0].match(this.rules.block.item),d=!1,k=f.length,b=0;b<k;b++)c=n=f[b],r=n.length,~(n=n.replace(/^ *([*+-]|\d+[.)]) */,"")).indexOf("\n ")&&(r-=n.length,n=this.options.pedantic?n.replace(/^ {1,4}/gm,""):n.replace(new RegExp("^ {1,"+r+"}","gm"),"")),b!==k-1&&(i=this.rules.block.bullet.exec(f[b+1])[0],(p?1===i.length||!h&&")"===i[i.length-1]:i.length>1||this.options.smartLists&&i!==u)&&(s=f.slice(b+1).join("\n"),g.raw=g.raw.substring(0,g.raw.length-s.length),b=k-1)),l=d||/\n\n(?!\s*$)/.test(n),b!==k-1&&(d="\n"===n.charAt(n.length-1),l||(l=d)),l&&(g.loose=!0),o=void 0,(a=/^\[[ xX]\] /.test(n))&&(o=" "!==n[1],n=n.replace(/^\[[ xX]\] +/,"")),g.items.push({type:"list_item",raw:c,task:a,checked:o,loose:l,text:n});return g}},t.html=function(e){var t=this.rules.block.html.exec(e);if(t)return{type:this.options.sanitize?"paragraph":"html",raw:t[0],pre:!this.options.sanitizer&&("pre"===t[1]||"script"===t[1]||"style"===t[1]),text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(t[0]):C(t[0]):t[0]}},t.def=function(e){var t=this.rules.block.def.exec(e);if(t)return t[3]&&(t[3]=t[3].substring(1,t[3].length-1)),{tag:t[1].toLowerCase().replace(/\s+/g," "),raw:t[0],href:t[2],title:t[3]}},t.table=function(e){var t=this.rules.block.table.exec(e);if(t){var n={type:"table",header:U(t[1].replace(/^ *| *\| *$/g,"")),align:t[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:t[3]?t[3].replace(/\n$/,"").split("\n"):[]};if(n.header.length===n.align.length){n.raw=t[0];var r,i=n.align.length;for(r=0;r<i;r++)/^ *-+: *$/.test(n.align[r])?n.align[r]="right":/^ *:-+: *$/.test(n.align[r])?n.align[r]="center":/^ *:-+ *$/.test(n.align[r])?n.align[r]="left":n.align[r]=null;for(i=n.cells.length,r=0;r<i;r++)n.cells[r]=U(n.cells[r].replace(/^ *\| *| *\| *$/g,""),n.header.length);return n}}},t.lheading=function(e){var t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:"="===t[2].charAt(0)?1:2,text:t[1]}},t.paragraph=function(e){var t=this.rules.block.paragraph.exec(e);if(t)return{type:"paragraph",raw:t[0],text:"\n"===t[1].charAt(t[1].length-1)?t[1].slice(0,-1):t[1]}},t.text=function(e,t){var n=this.rules.block.text.exec(e);if(n){var r=t[t.length-1];return r&&"text"===r.type?{raw:n[0],text:n[0]}:{type:"text",raw:n[0],text:n[0]}}},t.escape=function(e){var t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:C(t[1])}},t.tag=function(e,t,n){var r=this.rules.inline.tag.exec(e);if(r)return!t&&/^<a /i.test(r[0])?t=!0:t&&/^<\/a>/i.test(r[0])&&(t=!1),!n&&/^<(pre|code|kbd|script)(\s|>)/i.test(r[0])?n=!0:n&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(r[0])&&(n=!1),{type:this.options.sanitize?"text":"html",raw:r[0],inLink:t,inRawBlock:n,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(r[0]):C(r[0]):r[0]}},t.link=function(e){var t=this.rules.inline.link.exec(e);if(t){var n=j(t[2],"()");if(n>-1){var r=(0===t[0].indexOf("!")?5:4)+t[1].length+n;t[2]=t[2].substring(0,n),t[0]=t[0].substring(0,r).trim(),t[3]=""}var i=t[2],s="";if(this.options.pedantic){var l=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(i);l?(i=l[1],s=l[3]):s=""}else s=t[3]?t[3].slice(1,-1):"";return E(t,{href:(i=i.trim().replace(/^<([\s\S]*)>$/,"$1"))?i.replace(this.rules.inline._escapes,"$1"):i,title:s?s.replace(this.rules.inline._escapes,"$1"):s},t[0])}},t.reflink=function(e,t){var n;if((n=this.rules.inline.reflink.exec(e))||(n=this.rules.inline.nolink.exec(e))){var r=(n[2]||n[1]).replace(/\s+/g," ");if(!(r=t[r.toLowerCase()])||!r.href){var i=n[0].charAt(0);return{type:"text",raw:i,text:i}}return E(n,r,n[0])}},t.strong=function(e,t,n){void 0===n&&(n="");var r=this.rules.inline.strong.start.exec(e);if(r&&(!r[1]||r[1]&&(""===n||this.rules.inline.punctuation.exec(n)))){t=t.slice(-1*e.length);var i,s="**"===r[0]?this.rules.inline.strong.endAst:this.rules.inline.strong.endUnd;for(s.lastIndex=0;null!=(r=s.exec(t));)if(i=this.rules.inline.strong.middle.exec(t.slice(0,r.index+3)))return{type:"strong",raw:e.slice(0,i[0].length),text:e.slice(2,i[0].length-2)}}},t.em=function(e,t,n){void 0===n&&(n="");var r=this.rules.inline.em.start.exec(e);if(r&&(!r[1]||r[1]&&(""===n||this.rules.inline.punctuation.exec(n)))){t=t.slice(-1*e.length);var i,s="*"===r[0]?this.rules.inline.em.endAst:this.rules.inline.em.endUnd;for(s.lastIndex=0;null!=(r=s.exec(t));)if(i=this.rules.inline.em.middle.exec(t.slice(0,r.index+2)))return{type:"em",raw:e.slice(0,i[0].length),text:e.slice(1,i[0].length-1)}}},t.codespan=function(e){var t=this.rules.inline.code.exec(e);if(t){var n=t[2].replace(/\n/g," "),r=/[^ ]/.test(n),i=n.startsWith(" ")&&n.endsWith(" ");return r&&i&&(n=n.substring(1,n.length-1)),n=C(n,!0),{type:"codespan",raw:t[0],text:n}}},t.br=function(e){var t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}},t.del=function(e){var t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[1]}},t.autolink=function(e,t){var n,r,i=this.rules.inline.autolink.exec(e);if(i)return r="@"===i[2]?"mailto:"+(n=C(this.options.mangle?t(i[1]):i[1])):n=C(i[1]),{type:"link",raw:i[0],text:n,href:r,tokens:[{type:"text",raw:n,text:n}]}},t.url=function(e,t){var n;if(n=this.rules.inline.url.exec(e)){var r,i;if("@"===n[2])i="mailto:"+(r=C(this.options.mangle?t(n[0]):n[0]));else{var s;do{s=n[0],n[0]=this.rules.inline._backpedal.exec(n[0])[0]}while(s!==n[0]);r=C(n[0]),i="www."===n[1]?"http://"+r:r}return{type:"link",raw:n[0],text:r,href:i,tokens:[{type:"text",raw:r,text:r}]}}},t.inlineText=function(e,t,n){var r,i=this.rules.inline.text.exec(e);if(i)return r=t?this.options.sanitize?this.options.sanitizer?this.options.sanitizer(i[0]):C(i[0]):i[0]:C(this.options.smartypants?n(i[0]):i[0]),{type:"text",raw:i[0],text:r}},e}(),D=$,L=z,B=A,F={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*\n)|~{3,})([^\n]*)\n(?:|([\s\S]*?)\n)(?: {0,3}\1[~`]* *(?:\n+|$)|$)/,hr:/^ {0,3}((?:- *){3,}|(?:_ *){3,}|(?:\* *){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6}) +([^\n]*?)(?: +#+)? *(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3})(bull) [\s\S]+?(?:hr|def|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:"^ {0,3}(?:<(script|pre|style)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?\\?>\\n*|<![A-Z][\\s\\S]*?>\\n*|<!\\[CDATA\\[[\\s\\S]*?\\]\\]>\\n*|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:\\n{2,}|$)|<(?!script|pre|style)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:\\n{2,}|$)|</(?!script|pre|style)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:\\n{2,}|$))",def:/^ {0,3}\[(label)\]: *\n? *<?([^\s>]+)>?(?:(?: +\n? *| *\n *)(title))? *(?:\n+|$)/,nptable:D,table:D,lheading:/^([^\n]+)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html)[^\n]+)*)/,text:/^[^\n]+/,_label:/(?!\s*\])(?:\\[\[\]]|[^\[\]])+/,_title:/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/};F.def=L(F.def).replace("label",F._label).replace("title",F._title).getRegex(),F.bullet=/(?:[*+-]|\d{1,9}[.)])/,F.item=/^( *)(bull) ?[^\n]*(?:\n(?!\1bull ?)[^\n]*)*/,F.item=L(F.item,"gm").replace(/bull/g,F.bullet).getRegex(),F.list=L(F.list).replace(/bull/g,F.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+F.def.source+")").getRegex(),F._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",F._comment=/<!--(?!-?>)[\s\S]*?-->/,F.html=L(F.html,"i").replace("comment",F._comment).replace("tag",F._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),F.paragraph=L(F._paragraph).replace("hr",F.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|!--)").replace("tag",F._tag).getRegex(),F.blockquote=L(F.blockquote).replace("paragraph",F.paragraph).getRegex(),F.normal=B({},F),F.gfm=B({},F.normal,{nptable:"^ *([^|\\n ].*\\|.*)\\n *([-:]+ *\\|[-| :]*)(?:\\n((?:(?!\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)",table:"^ *\\|(.+)\\n *\\|?( *[-:]+[-| :]*)(?:\\n *((?:(?!\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"}),F.gfm.nptable=L(F.gfm.nptable).replace("hr",F.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|!--)").replace("tag",F._tag).getRegex(),F.gfm.table=L(F.gfm.table).replace("hr",F.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|!--)").replace("tag",F._tag).getRegex(),F.pedantic=B({},F.normal,{html:L("^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:\"[^\"]*\"|'[^']*'|\\s[^'\"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))").replace("comment",F._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *(?:#+ *)?(?:\n+|$)/,fences:D,paragraph:L(F.normal._paragraph).replace("hr",F.hr).replace("heading"," *#{1,6} *[^\n]").replace("lheading",F.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()});var M={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:D,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(?!\s*\])((?:\\[\[\]]?|[^\[\]\\])+)\]/,nolink:/^!?\[(?!\s*\])((?:\[[^\[\]]*\]|\\[\[\]]|[^\[\]])*)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",strong:{start:/^(?:(\*\*(?=[*punctuation]))|\*\*)(?![\s])|__/,middle:/^\*\*(?:(?:(?!overlapSkip)(?:[^*]|\\\*)|overlapSkip)|\*(?:(?!overlapSkip)(?:[^*]|\\\*)|overlapSkip)*?\*)+?\*\*$|^__(?![\s])((?:(?:(?!overlapSkip)(?:[^_]|\\_)|overlapSkip)|_(?:(?!overlapSkip)(?:[^_]|\\_)|overlapSkip)*?_)+?)__$/,endAst:/[^punctuation\s]\*\*(?!\*)|[punctuation]\*\*(?!\*)(?:(?=[punctuation\s]|$))/,endUnd:/[^\s]__(?!_)(?:(?=[punctuation\s])|$)/},em:{start:/^(?:(\*(?=[punctuation]))|\*)(?![*\s])|_/,middle:/^\*(?:(?:(?!overlapSkip)(?:[^*]|\\\*)|overlapSkip)|\*(?:(?!overlapSkip)(?:[^*]|\\\*)|overlapSkip)*?\*)+?\*$|^_(?![_\s])(?:(?:(?!overlapSkip)(?:[^_]|\\_)|overlapSkip)|_(?:(?!overlapSkip)(?:[^_]|\\_)|overlapSkip)*?_)+?_$/,endAst:/[^punctuation\s]\*(?!\*)|[punctuation]\*(?!\*)(?:(?=[punctuation\s]|$))/,endUnd:/[^\s]_(?!_)(?:(?=[punctuation\s])|$)/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:D,text:/^(`+|[^`])(?:[\s\S]*?(?:(?=[\\<!\[`*]|\b_|$)|[^ ](?= {2,}\n))|(?= {2,}\n))/,punctuation:/^([\s*punctuation])/,_punctuation:"!\"#$%&'()+\\-.,/:;<=>?@\\[\\]`^{|}~"};M.punctuation=L(M.punctuation).replace(/punctuation/g,M._punctuation).getRegex(),M._blockSkip="\\[[^\\]]*?\\]\\([^\\)]*?\\)|`[^`]*?`|<[^>]*?>",M._overlapSkip="__[^_]*?__|\\*\\*\\[^\\*\\]*?\\*\\*",M.em.start=L(M.em.start).replace(/punctuation/g,M._punctuation).getRegex(),M.em.middle=L(M.em.middle).replace(/punctuation/g,M._punctuation).replace(/overlapSkip/g,M._overlapSkip).getRegex(),M.em.endAst=L(M.em.endAst,"g").replace(/punctuation/g,M._punctuation).getRegex(),M.em.endUnd=L(M.em.endUnd,"g").replace(/punctuation/g,M._punctuation).getRegex(),M.strong.start=L(M.strong.start).replace(/punctuation/g,M._punctuation).getRegex(),M.strong.middle=L(M.strong.middle).replace(/punctuation/g,M._punctuation).replace(/blockSkip/g,M._blockSkip).getRegex(),M.strong.endAst=L(M.strong.endAst,"g").replace(/punctuation/g,M._punctuation).getRegex(),M.strong.endUnd=L(M.strong.endUnd,"g").replace(/punctuation/g,M._punctuation).getRegex(),M.blockSkip=L(M._blockSkip,"g").getRegex(),M.overlapSkip=L(M._overlapSkip,"g").getRegex(),M._escapes=/\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/g,M._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/,M._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/,M.autolink=L(M.autolink).replace("scheme",M._scheme).replace("email",M._email).getRegex(),M._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/,M.tag=L(M.tag).replace("comment",F._comment).replace("attribute",M._attribute).getRegex(),M._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,M._href=/<(?:\\[<>]?|[^\s<>\\])*>|[^\s\x00-\x1f]*/,M._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/,M.link=L(M.link).replace("label",M._label).replace("href",M._href).replace("title",M._title).getRegex(),M.reflink=L(M.reflink).replace("label",M._label).getRegex(),M.reflinkSearch=L(M.reflinkSearch,"g").replace("reflink",M.reflink).replace("nolink",M.nolink).getRegex(),M.normal=B({},M),M.pedantic=B({},M.normal,{strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:L(/^!?\[(label)\]\((.*?)\)/).replace("label",M._label).getRegex(),reflink:L(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",M._label).getRegex()}),M.gfm=B({},M.normal,{escape:L(M.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_~)]+(?!$))+/,del:/^~+(?=\S)([\s\S]*?\S)~+/,text:/^(`+|[^`])(?:[\s\S]*?(?:(?=[\\<!\[`*~]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@))|(?= {2,}\n|[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@))/}),M.gfm.url=L(M.gfm.url,"i").replace("email",M.gfm._extended_email).getRegex(),M.breaks=B({},M.gfm,{br:L(M.br).replace("{2,}","*").getRegex(),text:L(M.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()});var N={block:F,inline:M},W=i.defaults,X=N.block,G=N.inline;function V(e){return e.replace(/---/g,"—").replace(/--/g,"–").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1‘").replace(/'/g,"’").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1“").replace(/"/g,"”").replace(/\.{3}/g,"…")}function H(e){var t,n,r="",i=e.length;for(t=0;t<i;t++)n=e.charCodeAt(t),Math.random()>.5&&(n="x"+n.toString(16)),r+="&#"+n+";";return r}var J=function(){function t(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||W,this.options.tokenizer=this.options.tokenizer||new P,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options;var t={block:X.normal,inline:G.normal};this.options.pedantic?(t.block=X.pedantic,t.inline=G.pedantic):this.options.gfm&&(t.block=X.gfm,this.options.breaks?t.inline=G.breaks:t.inline=G.gfm),this.tokenizer.rules=t}t.lex=function(e,n){return new t(n).lex(e)};var n,r,i,s=t.prototype;return s.lex=function(e){return e=e.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    "),this.blockTokens(e,this.tokens,!0),this.inline(this.tokens),this.tokens},s.blockTokens=function(e,t,n){var r,i,s,l;for(void 0===t&&(t=[]),void 0===n&&(n=!0),e=e.replace(/^ +$/gm,"");e;)if(r=this.tokenizer.space(e))e=e.substring(r.raw.length),r.type&&t.push(r);else if(r=this.tokenizer.code(e,t))e=e.substring(r.raw.length),r.type?t.push(r):((l=t[t.length-1]).raw+="\n"+r.raw,l.text+="\n"+r.text);else if(r=this.tokenizer.fences(e))e=e.substring(r.raw.length),t.push(r);else if(r=this.tokenizer.heading(e))e=e.substring(r.raw.length),t.push(r);else if(r=this.tokenizer.nptable(e))e=e.substring(r.raw.length),t.push(r);else if(r=this.tokenizer.hr(e))e=e.substring(r.raw.length),t.push(r);else if(r=this.tokenizer.blockquote(e))e=e.substring(r.raw.length),r.tokens=this.blockTokens(r.text,[],n),t.push(r);else if(r=this.tokenizer.list(e)){for(e=e.substring(r.raw.length),s=r.items.length,i=0;i<s;i++)r.items[i].tokens=this.blockTokens(r.items[i].text,[],!1);t.push(r)}else if(r=this.tokenizer.html(e))e=e.substring(r.raw.length),t.push(r);else if(n&&(r=this.tokenizer.def(e)))e=e.substring(r.raw.length),this.tokens.links[r.tag]||(this.tokens.links[r.tag]={href:r.href,title:r.title});else if(r=this.tokenizer.table(e))e=e.substring(r.raw.length),t.push(r);else if(r=this.tokenizer.lheading(e))e=e.substring(r.raw.length),t.push(r);else if(n&&(r=this.tokenizer.paragraph(e)))e=e.substring(r.raw.length),t.push(r);else if(r=this.tokenizer.text(e,t))e=e.substring(r.raw.length),r.type?t.push(r):((l=t[t.length-1]).raw+="\n"+r.raw,l.text+="\n"+r.text);else if(e){var a="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(a);break}throw new Error(a)}return t},s.inline=function(e){var t,n,r,i,s,l,a=e.length;for(t=0;t<a;t++)switch((l=e[t]).type){case"paragraph":case"text":case"heading":l.tokens=[],this.inlineTokens(l.text,l.tokens);break;case"table":for(l.tokens={header:[],cells:[]},i=l.header.length,n=0;n<i;n++)l.tokens.header[n]=[],this.inlineTokens(l.header[n],l.tokens.header[n]);for(i=l.cells.length,n=0;n<i;n++)for(s=l.cells[n],l.tokens.cells[n]=[],r=0;r<s.length;r++)l.tokens.cells[n][r]=[],this.inlineTokens(s[r],l.tokens.cells[n][r]);break;case"blockquote":this.inline(l.tokens);break;case"list":for(i=l.items.length,n=0;n<i;n++)this.inline(l.items[n].tokens)}return e},s.inlineTokens=function(e,t,n,r,i){var s;void 0===t&&(t=[]),void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===i&&(i="");var l,a=e;if(this.tokens.links){var o=Object.keys(this.tokens.links);if(o.length>0)for(;null!=(l=this.tokenizer.rules.inline.reflinkSearch.exec(a));)o.includes(l[0].slice(l[0].lastIndexOf("[")+1,-1))&&(a=a.slice(0,l.index)+"["+"a".repeat(l[0].length-2)+"]"+a.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;null!=(l=this.tokenizer.rules.inline.blockSkip.exec(a));)a=a.slice(0,l.index)+"["+"a".repeat(l[0].length-2)+"]"+a.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;e;)if(s=this.tokenizer.escape(e))e=e.substring(s.raw.length),t.push(s);else if(s=this.tokenizer.tag(e,n,r))e=e.substring(s.raw.length),n=s.inLink,r=s.inRawBlock,t.push(s);else if(s=this.tokenizer.link(e))e=e.substring(s.raw.length),"link"===s.type&&(s.tokens=this.inlineTokens(s.text,[],!0,r)),t.push(s);else if(s=this.tokenizer.reflink(e,this.tokens.links))e=e.substring(s.raw.length),"link"===s.type&&(s.tokens=this.inlineTokens(s.text,[],!0,r)),t.push(s);else if(s=this.tokenizer.strong(e,a,i))e=e.substring(s.raw.length),s.tokens=this.inlineTokens(s.text,[],n,r),t.push(s);else if(s=this.tokenizer.em(e,a,i))e=e.substring(s.raw.length),s.tokens=this.inlineTokens(s.text,[],n,r),t.push(s);else if(s=this.tokenizer.codespan(e))e=e.substring(s.raw.length),t.push(s);else if(s=this.tokenizer.br(e))e=e.substring(s.raw.length),t.push(s);else if(s=this.tokenizer.del(e))e=e.substring(s.raw.length),s.tokens=this.inlineTokens(s.text,[],n,r),t.push(s);else if(s=this.tokenizer.autolink(e,H))e=e.substring(s.raw.length),t.push(s);else if(n||!(s=this.tokenizer.url(e,H))){if(s=this.tokenizer.inlineText(e,r,V))e=e.substring(s.raw.length),i=s.raw.slice(-1),t.push(s);else if(e){var c="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(c);break}throw new Error(c)}}else e=e.substring(s.raw.length),t.push(s);return t},n=t,i=[{key:"rules",get:function(){return{block:X,inline:G}}}],(r=null)&&e(n.prototype,r),i&&e(n,i),t}(),K=i.defaults,Q=S,Y=_,ee=function(){function e(e){this.options=e||K}var t=e.prototype;return t.code=function(e,t,n){var r=(t||"").match(/\S*/)[0];if(this.options.highlight){var i=this.options.highlight(e,r);null!=i&&i!==e&&(n=!0,e=i)}return r?'<pre><code class="'+this.options.langPrefix+Y(r,!0)+'">'+(n?e:Y(e,!0))+"</code></pre>\n":"<pre><code>"+(n?e:Y(e,!0))+"</code></pre>\n"},t.blockquote=function(e){return"<blockquote>\n"+e+"</blockquote>\n"},t.html=function(e){return e},t.heading=function(e,t,n,r){return this.options.headerIds?"<h"+t+' id="'+this.options.headerPrefix+r.slug(n)+'">'+e+"</h"+t+">\n":"<h"+t+">"+e+"</h"+t+">\n"},t.hr=function(){return this.options.xhtml?"<hr/>\n":"<hr>\n"},t.list=function(e,t,n){var r=t?"ol":"ul";return"<"+r+(t&&1!==n?' start="'+n+'"':"")+">\n"+e+"</"+r+">\n"},t.listitem=function(e){return"<li>"+e+"</li>\n"},t.checkbox=function(e){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "},t.paragraph=function(e){return"<p>"+e+"</p>\n"},t.table=function(e,t){return t&&(t="<tbody>"+t+"</tbody>"),"<table>\n<thead>\n"+e+"</thead>\n"+t+"</table>\n"},t.tablerow=function(e){return"<tr>\n"+e+"</tr>\n"},t.tablecell=function(e,t){var n=t.header?"th":"td";return(t.align?"<"+n+' align="'+t.align+'">':"<"+n+">")+e+"</"+n+">\n"},t.strong=function(e){return"<strong>"+e+"</strong>"},t.em=function(e){return"<em>"+e+"</em>"},t.codespan=function(e){return"<code>"+e+"</code>"},t.br=function(){return this.options.xhtml?"<br/>":"<br>"},t.del=function(e){return"<del>"+e+"</del>"},t.link=function(e,t,n){if(null===(e=Q(this.options.sanitize,this.options.baseUrl,e)))return n;var r='<a href="'+Y(e)+'"';return t&&(r+=' title="'+t+'"'),r+=">"+n+"</a>"},t.image=function(e,t,n){if(null===(e=Q(this.options.sanitize,this.options.baseUrl,e)))return n;var r='<img src="'+e+'" alt="'+n+'"';return t&&(r+=' title="'+t+'"'),r+=this.options.xhtml?"/>":">"},t.text=function(e){return e},e}(),te=function(){function e(){}var t=e.prototype;return t.strong=function(e){return e},t.em=function(e){return e},t.codespan=function(e){return e},t.del=function(e){return e},t.html=function(e){return e},t.text=function(e){return e},t.link=function(e,t,n){return""+n},t.image=function(e,t,n){return""+n},t.br=function(){return""},e}(),ne=function(){function e(){this.seen={}}return e.prototype.slug=function(e){var t=e.toLowerCase().trim().replace(/<[!\/a-z].*?>/gi,"").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,./:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-");if(this.seen.hasOwnProperty(t)){var n=t;do{this.seen[n]++,t=n+"-"+this.seen[n]}while(this.seen.hasOwnProperty(t))}return this.seen[t]=0,t},e}(),re=i.defaults,ie=y,se=function(){function e(e){this.options=e||re,this.options.renderer=this.options.renderer||new ee,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new te,this.slugger=new ne}e.parse=function(t,n){return new e(n).parse(t)};var t=e.prototype;return t.parse=function(e,t){void 0===t&&(t=!0);var n,r,i,s,l,a,o,c,u,p,h,g,f,d,k,b,m,x,v="",w=e.length;for(n=0;n<w;n++)switch((p=e[n]).type){case"space":continue;case"hr":v+=this.renderer.hr();continue;case"heading":v+=this.renderer.heading(this.parseInline(p.tokens),p.depth,ie(this.parseInline(p.tokens,this.textRenderer)),this.slugger);continue;case"code":v+=this.renderer.code(p.text,p.lang,p.escaped);continue;case"table":for(c="",o="",s=p.header.length,r=0;r<s;r++)o+=this.renderer.tablecell(this.parseInline(p.tokens.header[r]),{header:!0,align:p.align[r]});for(c+=this.renderer.tablerow(o),u="",s=p.cells.length,r=0;r<s;r++){for(o="",l=(a=p.tokens.cells[r]).length,i=0;i<l;i++)o+=this.renderer.tablecell(this.parseInline(a[i]),{header:!1,align:p.align[i]});u+=this.renderer.tablerow(o)}v+=this.renderer.table(c,u);continue;case"blockquote":u=this.parse(p.tokens),v+=this.renderer.blockquote(u);continue;case"list":for(h=p.ordered,g=p.start,f=p.loose,s=p.items.length,u="",r=0;r<s;r++)b=(k=p.items[r]).checked,m=k.task,d="",k.task&&(x=this.renderer.checkbox(b),f?k.tokens.length>0&&"text"===k.tokens[0].type?(k.tokens[0].text=x+" "+k.tokens[0].text,k.tokens[0].tokens&&k.tokens[0].tokens.length>0&&"text"===k.tokens[0].tokens[0].type&&(k.tokens[0].tokens[0].text=x+" "+k.tokens[0].tokens[0].text)):k.tokens.unshift({type:"text",text:x}):d+=x),d+=this.parse(k.tokens,f),u+=this.renderer.listitem(d,m,b);v+=this.renderer.list(u,h,g);continue;case"html":v+=this.renderer.html(p.text);continue;case"paragraph":v+=this.renderer.paragraph(this.parseInline(p.tokens));continue;case"text":for(u=p.tokens?this.parseInline(p.tokens):p.text;n+1<w&&"text"===e[n+1].type;)u+="\n"+((p=e[++n]).tokens?this.parseInline(p.tokens):p.text);v+=t?this.renderer.paragraph(u):u;continue;default:var _='Token with "'+p.type+'" type was not found.';if(this.options.silent)return void console.error(_);throw new Error(_)}return v},t.parseInline=function(e,t){t=t||this.renderer;var n,r,i="",s=e.length;for(n=0;n<s;n++)switch((r=e[n]).type){case"escape":i+=t.text(r.text);break;case"html":i+=t.html(r.text);break;case"link":i+=t.link(r.href,r.title,this.parseInline(r.tokens,t));break;case"image":i+=t.image(r.href,r.title,r.text);break;case"strong":i+=t.strong(this.parseInline(r.tokens,t));break;case"em":i+=t.em(this.parseInline(r.tokens,t));break;case"codespan":i+=t.codespan(r.text);break;case"br":i+=t.br();break;case"del":i+=t.del(this.parseInline(r.tokens,t));break;case"text":i+=t.text(r.text);break;default:var l='Token with "'+r.type+'" type was not found.';if(this.options.silent)return void console.error(l);throw new Error(l)}return i},e}(),le=A,ae=Z,oe=_,ce=i.getDefaults,ue=i.changeDefaults,pe=i.defaults;function he(e,t,n){if(null==e)throw new Error("marked(): input parameter is undefined or null");if("string"!=typeof e)throw new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected");if("function"==typeof t&&(n=t,t=null),t=le({},he.defaults,t||{}),ae(t),n){var r,i=t.highlight;try{r=J.lex(e,t)}catch(e){return n(e)}var s=function(e){var s;if(!e)try{s=se.parse(r,t)}catch(t){e=t}return t.highlight=i,e?n(e):n(null,s)};if(!i||i.length<3)return s();if(delete t.highlight,!r.length)return s();var l=0;return he.walkTokens(r,function(e){"code"===e.type&&(l++,setTimeout(function(){i(e.text,e.lang,function(t,n){if(t)return s(t);null!=n&&n!==e.text&&(e.text=n,e.escaped=!0),0===--l&&s()})},0))}),void(0===l&&s())}try{var a=J.lex(e,t);return t.walkTokens&&he.walkTokens(a,t.walkTokens),se.parse(a,t)}catch(e){if(e.message+="\nPlease report this to https://github.com/markedjs/marked.",t.silent)return"<p>An error occurred:</p><pre>"+oe(e.message+"",!0)+"</pre>";throw e}}return he.options=he.setOptions=function(e){return le(he.defaults,e),ue(he.defaults),he},he.getDefaults=ce,he.defaults=pe,he.use=function(e){var t=le({},e);if(e.renderer&&function(){var n=he.defaults.renderer||new ee,r=function(t){var r=n[t];n[t]=function(){for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];var a=e.renderer[t].apply(n,s);return!1===a&&(a=r.apply(n,s)),a}};for(var i in e.renderer)r(i);t.renderer=n}(),e.tokenizer&&function(){var n=he.defaults.tokenizer||new P,r=function(t){var r=n[t];n[t]=function(){for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];var a=e.tokenizer[t].apply(n,s);return!1===a&&(a=r.apply(n,s)),a}};for(var i in e.tokenizer)r(i);t.tokenizer=n}(),e.walkTokens){var n=he.defaults.walkTokens;t.walkTokens=function(t){e.walkTokens(t),n&&n(t)}}he.setOptions(t)},he.walkTokens=function(e,t){for(var r,i=n(e);!(r=i()).done;){var s=r.value;switch(t(s),s.type){case"table":for(var l,a=n(s.tokens.header);!(l=a()).done;){var o=l.value;he.walkTokens(o,t)}for(var c,u=n(s.tokens.cells);!(c=u()).done;)for(var p,h=n(c.value);!(p=h()).done;){var g=p.value;he.walkTokens(g,t)}break;case"list":he.walkTokens(s.items,t);break;default:s.tokens&&he.walkTokens(s.tokens,t)}}},he.Parser=se,he.parser=se.parse,he.Renderer=ee,he.TextRenderer=te,he.Lexer=J,he.lexer=J.lex,he.Tokenizer=P,he.Slugger=ne,he.parse=he,he});

},{}],314:[function(require,module,exports){
var runtime=function(t){"use strict";var r,e=Object.prototype,n=e.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(t,r,e,n){var o=r&&r.prototype instanceof v?r:v,i=Object.create(o.prototype),a=new k(n||[]);return i._invoke=function(t,r,e){var n=f;return function(o,i){if(n===l)throw new Error("Generator is already running");if(n===p){if("throw"===o)throw i;return N()}for(e.method=o,e.arg=i;;){var a=e.delegate;if(a){var c=_(a,e);if(c){if(c===y)continue;return c}}if("next"===e.method)e.sent=e._sent=e.arg;else if("throw"===e.method){if(n===f)throw n=p,e.arg;e.dispatchException(e.arg)}else"return"===e.method&&e.abrupt("return",e.arg);n=l;var u=h(t,r,e);if("normal"===u.type){if(n=e.done?p:s,u.arg===y)continue;return{value:u.arg,done:e.done}}"throw"===u.type&&(n=p,e.method="throw",e.arg=u.arg)}}}(t,e,a),i}function h(t,r,e){try{return{type:"normal",arg:t.call(r,e)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var f="suspendedStart",s="suspendedYield",l="executing",p="completed",y={};function v(){}function d(){}function g(){}var m={};m[i]=function(){return this};var w=Object.getPrototypeOf,L=w&&w(w(G([])));L&&L!==e&&n.call(L,i)&&(m=L);var x=g.prototype=v.prototype=Object.create(m);function E(t){["next","throw","return"].forEach(function(r){t[r]=function(t){return this._invoke(r,t)}})}function b(t,r){var e;this._invoke=function(o,i){function a(){return new r(function(e,a){!function e(o,i,a,c){var u=h(t[o],t,i);if("throw"!==u.type){var f=u.arg,s=f.value;return s&&"object"==typeof s&&n.call(s,"__await")?r.resolve(s.__await).then(function(t){e("next",t,a,c)},function(t){e("throw",t,a,c)}):r.resolve(s).then(function(t){f.value=t,a(f)},function(t){return e("throw",t,a,c)})}c(u.arg)}(o,i,e,a)})}return e=e?e.then(a,a):a()}}function _(t,e){var n=t.iterator[e.method];if(n===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=r,_(t,e),"throw"===e.method))return y;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return y}var o=h(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,y;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=r),e.delegate=null,y):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,y)}function j(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function O(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(j,this),this.reset(!0)}function G(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function e(){for(;++o<t.length;)if(n.call(t,o))return e.value=t[o],e.done=!1,e;return e.value=r,e.done=!0,e};return a.next=a}}return{next:N}}function N(){return{value:r,done:!0}}return d.prototype=x.constructor=g,g.constructor=d,g[c]=d.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===d||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,c in t||(t[c]="GeneratorFunction")),t.prototype=Object.create(x),t},t.awrap=function(t){return{__await:t}},E(b.prototype),b.prototype[a]=function(){return this},t.AsyncIterator=b,t.async=function(r,e,n,o,i){void 0===i&&(i=Promise);var a=new b(u(r,e,n,o),i);return t.isGeneratorFunction(e)?a:a.next().then(function(t){return t.done?t.value:a.next()})},E(x),x[c]="Generator",x[i]=function(){return this},x.toString=function(){return"[object Generator]"},t.keys=function(t){var r=[];for(var e in t)r.push(e);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=G,k.prototype={constructor:k,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(O),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=r)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function o(n,o){return c.type="throw",c.arg=t,e.next=n,o&&(e.method="next",e.arg=r),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),h=n.call(a,"finallyLoc");if(u&&h){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,r){for(var e=this.tryEntries.length-1;e>=0;--e){var o=this.tryEntries[e];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=r&&r<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=r,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),y},finish:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),O(e),y}},catch:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.tryLoc===t){var n=e.completion;if("throw"===n.type){var o=n.arg;O(e)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:G(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=r),y}},t}("object"==typeof module?module.exports:{});try{regeneratorRuntime=runtime}catch(t){Function("r","regeneratorRuntime = r")(runtime)}

},{}],315:[function(require,module,exports){
(function (global){
!function(n,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define("underscore",r):function(){var t=n._,e=r();n._=e,e.noConflict=function(){return n._=t,e}}()}(this,function(){var n="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||Function("return this")()||{},r=Array.prototype,t=Object.prototype,e="undefined"!=typeof Symbol?Symbol.prototype:null,u=r.push,o=r.slice,i=t.toString,a=t.hasOwnProperty,f=Array.isArray,c=Object.keys,l=Object.create,p=n.isNaN,s=n.isFinite,v=function(){};function h(n){return n instanceof h?n:this instanceof h?void(this._wrapped=n):new h(n)}var y=h.VERSION="1.10.2";function g(n,r,t){if(void 0===r)return n;switch(null==t?3:t){case 1:return function(t){return n.call(r,t)};case 3:return function(t,e,u){return n.call(r,t,e,u)};case 4:return function(t,e,u,o){return n.call(r,t,e,u,o)}}return function(){return n.apply(r,arguments)}}function d(n,r,t){return null==n?ur:Cn(n)?g(n,r,t):Ln(n)&&!Kn(n)?ir(n):or(n)}function m(n,r){return d(n,r,1/0)}function b(n,r,t){return h.iteratee!==m?h.iteratee(n,r):d(n,r,t)}function j(n,r){return r=null==r?n.length-1:+r,function(){for(var t=Math.max(arguments.length-r,0),e=Array(t),u=0;u<t;u++)e[u]=arguments[u+r];switch(r){case 0:return n.call(this,e);case 1:return n.call(this,arguments[0],e);case 2:return n.call(this,arguments[0],arguments[1],e)}var o=Array(r+1);for(u=0;u<r;u++)o[u]=arguments[u];return o[r]=e,n.apply(this,o)}}function _(n){if(!Ln(n))return{};if(l)return l(n);v.prototype=n;var r=new v;return v.prototype=null,r}function w(n){return function(r){return null==r?void 0:r[n]}}function x(n,r){return null!=n&&a.call(n,r)}function S(n,r){for(var t=r.length,e=0;e<t;e++){if(null==n)return;n=n[r[e]]}return t?n:void 0}h.iteratee=m;var A=Math.pow(2,53)-1,O=w("length");function M(n){var r=O(n);return"number"==typeof r&&r>=0&&r<=A}function E(n,r,t){var e,u;if(r=g(r,t),M(n))for(e=0,u=n.length;e<u;e++)r(n[e],e,n);else{var o=Sn(n);for(e=0,u=o.length;e<u;e++)r(n[o[e]],o[e],n)}return n}function N(n,r,t){r=b(r,t);for(var e=!M(n)&&Sn(n),u=(e||n).length,o=Array(u),i=0;i<u;i++){var a=e?e[i]:i;o[i]=r(n[a],a,n)}return o}function k(n){return function(r,t,e,u){var o=arguments.length>=3;return function(r,t,e,u){var o=!M(r)&&Sn(r),i=(o||r).length,a=n>0?0:i-1;for(u||(e=r[o?o[a]:a],a+=n);a>=0&&a<i;a+=n){var f=o?o[a]:a;e=t(e,r[f],f,r)}return e}(r,g(t,u,4),e,o)}}var I=k(1),T=k(-1);function B(n,r,t){var e=(M(n)?on:Tn)(n,r,t);if(void 0!==e&&-1!==e)return n[e]}function R(n,r,t){var e=[];return r=b(r,t),E(n,function(n,t,u){r(n,t,u)&&e.push(n)}),e}function F(n,r,t){r=b(r,t);for(var e=!M(n)&&Sn(n),u=(e||n).length,o=0;o<u;o++){var i=e?e[o]:o;if(!r(n[i],i,n))return!1}return!0}function q(n,r,t){r=b(r,t);for(var e=!M(n)&&Sn(n),u=(e||n).length,o=0;o<u;o++){var i=e?e[o]:o;if(r(n[i],i,n))return!0}return!1}function D(n,r,t,e){return M(n)||(n=On(n)),("number"!=typeof t||e)&&(t=0),ln(n,r,t)>=0}var W=j(function(n,r,t){var e,u;return Cn(r)?u=r:Kn(r)&&(e=r.slice(0,-1),r=r[r.length-1]),N(n,function(n){var o=u;if(!o){if(e&&e.length&&(n=S(n,e)),null==n)return;o=n[r]}return null==o?o:o.apply(n,t)})});function z(n,r){return N(n,or(r))}function P(n,r,t){var e,u,o=-1/0,i=-1/0;if(null==r||"number"==typeof r&&"object"!=typeof n[0]&&null!=n)for(var a=0,f=(n=M(n)?n:On(n)).length;a<f;a++)null!=(e=n[a])&&e>o&&(o=e);else r=b(r,t),E(n,function(n,t,e){((u=r(n,t,e))>i||u===-1/0&&o===-1/0)&&(o=n,i=u)});return o}function K(n,r,t){if(null==r||t)return M(n)||(n=On(n)),n[ar(n.length-1)];var e=M(n)?Dn(n):On(n),u=O(e);r=Math.max(Math.min(r,u),0);for(var o=u-1,i=0;i<r;i++){var a=ar(i,o),f=e[i];e[i]=e[a],e[a]=f}return e.slice(0,r)}function L(n,r){return function(t,e,u){var o=r?[[],[]]:{};return e=b(e,u),E(t,function(r,u){var i=e(r,u,t);n(o,r,i)}),o}}var V=L(function(n,r,t){x(n,t)?n[t].push(r):n[t]=[r]}),C=L(function(n,r,t){n[t]=r}),J=L(function(n,r,t){x(n,t)?n[t]++:n[t]=1}),U=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;var $=L(function(n,r,t){n[t?0:1].push(r)},!0);function G(n,r,t){return null==n||n.length<1?null==r?void 0:[]:null==r||t?n[0]:H(n,n.length-r)}function H(n,r,t){return o.call(n,0,Math.max(0,n.length-(null==r||t?1:r)))}function Q(n,r,t){return o.call(n,null==r||t?1:r)}function X(n,r,t,e){for(var u=(e=e||[]).length,o=0,i=O(n);o<i;o++){var a=n[o];if(M(a)&&(Kn(a)||Vn(a)))if(r)for(var f=0,c=a.length;f<c;)e[u++]=a[f++];else X(a,r,t,e),u=e.length;else t||(e[u++]=a)}return e}var Y=j(function(n,r){return rn(n,r)});function Z(n,r,t,e){er(r)||(e=t,t=r,r=!1),null!=t&&(t=b(t,e));for(var u=[],o=[],i=0,a=O(n);i<a;i++){var f=n[i],c=t?t(f,i,n):f;r&&!t?(i&&o===c||u.push(f),o=c):t?D(o,c)||(o.push(c),u.push(f)):D(u,f)||u.push(f)}return u}var nn=j(function(n){return Z(X(n,!0,!0))});var rn=j(function(n,r){return r=X(r,!0,!0),R(n,function(n){return!D(r,n)})});function tn(n){for(var r=n&&P(n,O).length||0,t=Array(r),e=0;e<r;e++)t[e]=z(n,e);return t}var en=j(tn);function un(n){return function(r,t,e){t=b(t,e);for(var u=O(r),o=n>0?0:u-1;o>=0&&o<u;o+=n)if(t(r[o],o,r))return o;return-1}}var on=un(1),an=un(-1);function fn(n,r,t,e){for(var u=(t=b(t,e,1))(r),o=0,i=O(n);o<i;){var a=Math.floor((o+i)/2);t(n[a])<u?o=a+1:i=a}return o}function cn(n,r,t){return function(e,u,i){var a=0,f=O(e);if("number"==typeof i)n>0?a=i>=0?i:Math.max(i+f,a):f=i>=0?Math.min(i+1,f):i+f+1;else if(t&&i&&f)return e[i=t(e,u)]===u?i:-1;if(u!=u)return(i=r(o.call(e,a,f),tr))>=0?i+a:-1;for(i=n>0?a:f-1;i>=0&&i<f;i+=n)if(e[i]===u)return i;return-1}}var ln=cn(1,on,fn),pn=cn(-1,an);function sn(n,r,t,e,u){if(!(e instanceof r))return n.apply(t,u);var o=_(n.prototype),i=n.apply(o,u);return Ln(i)?i:o}var vn=j(function(n,r,t){if(!Cn(n))throw new TypeError("Bind must be called on a function");var e=j(function(u){return sn(n,e,r,this,t.concat(u))});return e}),hn=j(function(n,r){var t=hn.placeholder,e=function(){for(var u=0,o=r.length,i=Array(o),a=0;a<o;a++)i[a]=r[a]===t?arguments[u++]:r[a];for(;u<arguments.length;)i.push(arguments[u++]);return sn(n,e,this,this,i)};return e});hn.placeholder=h;var yn=j(function(n,r){var t=(r=X(r,!1,!1)).length;if(t<1)throw new Error("bindAll must be passed function names");for(;t--;){var e=r[t];n[e]=vn(n[e],n)}});var gn=j(function(n,r,t){return setTimeout(function(){return n.apply(null,t)},r)}),dn=hn(gn,h,1);function mn(n){return function(){return!n.apply(this,arguments)}}function bn(n,r){var t;return function(){return--n>0&&(t=r.apply(this,arguments)),n<=1&&(r=null),t}}var jn=hn(bn,2),_n=!{toString:null}.propertyIsEnumerable("toString"),wn=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];function xn(n,r){var e=wn.length,u=n.constructor,o=Cn(u)&&u.prototype||t,i="constructor";for(x(n,i)&&!D(r,i)&&r.push(i);e--;)(i=wn[e])in n&&n[i]!==o[i]&&!D(r,i)&&r.push(i)}function Sn(n){if(!Ln(n))return[];if(c)return c(n);var r=[];for(var t in n)x(n,t)&&r.push(t);return _n&&xn(n,r),r}function An(n){if(!Ln(n))return[];var r=[];for(var t in n)r.push(t);return _n&&xn(n,r),r}function On(n){for(var r=Sn(n),t=r.length,e=Array(t),u=0;u<t;u++)e[u]=n[r[u]];return e}function Mn(n){for(var r={},t=Sn(n),e=0,u=t.length;e<u;e++)r[n[t[e]]]=t[e];return r}function En(n){var r=[];for(var t in n)Cn(n[t])&&r.push(t);return r.sort()}function Nn(n,r){return function(t){var e=arguments.length;if(r&&(t=Object(t)),e<2||null==t)return t;for(var u=1;u<e;u++)for(var o=arguments[u],i=n(o),a=i.length,f=0;f<a;f++){var c=i[f];r&&void 0!==t[c]||(t[c]=o[c])}return t}}var kn=Nn(An),In=Nn(Sn);function Tn(n,r,t){r=b(r,t);for(var e,u=Sn(n),o=0,i=u.length;o<i;o++)if(r(n[e=u[o]],e,n))return e}function Bn(n,r,t){return r in t}var Rn=j(function(n,r){var t={},e=r[0];if(null==n)return t;Cn(e)?(r.length>1&&(e=g(e,r[1])),r=An(n)):(e=Bn,r=X(r,!1,!1),n=Object(n));for(var u=0,o=r.length;u<o;u++){var i=r[u],a=n[i];e(a,i,n)&&(t[i]=a)}return t}),Fn=j(function(n,r){var t,e=r[0];return Cn(e)?(e=mn(e),r.length>1&&(t=r[1])):(r=N(X(r,!1,!1),String),e=function(n,t){return!D(r,t)}),Rn(n,e,t)}),qn=Nn(An,!0);function Dn(n){return Ln(n)?Kn(n)?n.slice():kn({},n):n}function Wn(n,r){var t=Sn(r),e=t.length;if(null==n)return!e;for(var u=Object(n),o=0;o<e;o++){var i=t[o];if(r[i]!==u[i]||!(i in u))return!1}return!0}function zn(n,r,t,u){if(n===r)return 0!==n||1/n==1/r;if(null==n||null==r)return!1;if(n!=n)return r!=r;var o=typeof n;return("function"===o||"object"===o||"object"==typeof r)&&function(n,r,t,u){n instanceof h&&(n=n._wrapped);r instanceof h&&(r=r._wrapped);var o=i.call(n);if(o!==i.call(r))return!1;switch(o){case"[object RegExp]":case"[object String]":return""+n==""+r;case"[object Number]":return+n!=+n?+r!=+r:0==+n?1/+n==1/r:+n==+r;case"[object Date]":case"[object Boolean]":return+n==+r;case"[object Symbol]":return e.valueOf.call(n)===e.valueOf.call(r)}var a="[object Array]"===o;if(!a){if("object"!=typeof n||"object"!=typeof r)return!1;var f=n.constructor,c=r.constructor;if(f!==c&&!(Cn(f)&&f instanceof f&&Cn(c)&&c instanceof c)&&"constructor"in n&&"constructor"in r)return!1}u=u||[];var l=(t=t||[]).length;for(;l--;)if(t[l]===n)return u[l]===r;if(t.push(n),u.push(r),a){if((l=n.length)!==r.length)return!1;for(;l--;)if(!zn(n[l],r[l],t,u))return!1}else{var p,s=Sn(n);if(l=s.length,Sn(r).length!==l)return!1;for(;l--;)if(p=s[l],!x(r,p)||!zn(n[p],r[p],t,u))return!1}return t.pop(),u.pop(),!0}(n,r,t,u)}function Pn(n){return function(r){return i.call(r)==="[object "+n+"]"}}var Kn=f||Pn("Array");function Ln(n){var r=typeof n;return"function"===r||"object"===r&&!!n}var Vn=Pn("Arguments"),Cn=Pn("Function"),Jn=Pn("String"),Un=Pn("Number"),$n=Pn("Date"),Gn=Pn("RegExp"),Hn=Pn("Error"),Qn=Pn("Symbol"),Xn=Pn("Map"),Yn=Pn("WeakMap"),Zn=Pn("Set"),nr=Pn("WeakSet");!function(){Vn(arguments)||(Vn=function(n){return x(n,"callee")})}();var rr=n.document&&n.document.childNodes;function tr(n){return Un(n)&&p(n)}function er(n){return!0===n||!1===n||"[object Boolean]"===i.call(n)}function ur(n){return n}function or(n){return Kn(n)?function(r){return S(r,n)}:w(n)}function ir(n){return n=In({},n),function(r){return Wn(r,n)}}function ar(n,r){return null==r&&(r=n,n=0),n+Math.floor(Math.random()*(r-n+1))}"function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof rr&&(Cn=function(n){return"function"==typeof n||!1});var fr=Date.now||function(){return(new Date).getTime()},cr={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},lr=Mn(cr);function pr(n){var r=function(r){return n[r]},t="(?:"+Sn(n).join("|")+")",e=RegExp(t),u=RegExp(t,"g");return function(n){return n=null==n?"":""+n,e.test(n)?n.replace(u,r):n}}var sr=pr(cr),vr=pr(lr);var hr=0;var yr=h.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},gr=/(.)^/,dr={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},mr=/\\|'|\r|\n|\u2028|\u2029/g,br=function(n){return"\\"+dr[n]};function jr(n,r){return n._chain?h(r).chain():r}function _r(n){return E(En(n),function(r){var t=h[r]=n[r];h.prototype[r]=function(){var n=[this._wrapped];return u.apply(n,arguments),jr(this,t.apply(h,n))}}),h}E(["pop","push","reverse","shift","sort","splice","unshift"],function(n){var t=r[n];h.prototype[n]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!==n&&"splice"!==n||0!==r.length||delete r[0],jr(this,r)}}),E(["concat","join","slice"],function(n){var t=r[n];h.prototype[n]=function(){return jr(this,t.apply(this._wrapped,arguments))}}),h.prototype.value=function(){return this._wrapped},h.prototype.valueOf=h.prototype.toJSON=h.prototype.value,h.prototype.toString=function(){return String(this._wrapped)};var wr=_r({default:h,VERSION:y,iteratee:m,restArguments:j,each:E,forEach:E,map:N,collect:N,reduce:I,foldl:I,inject:I,reduceRight:T,foldr:T,find:B,detect:B,filter:R,select:R,reject:function(n,r,t){return R(n,mn(b(r)),t)},every:F,all:F,some:q,any:q,contains:D,includes:D,include:D,invoke:W,pluck:z,where:function(n,r){return R(n,ir(r))},findWhere:function(n,r){return B(n,ir(r))},max:P,min:function(n,r,t){var e,u,o=1/0,i=1/0;if(null==r||"number"==typeof r&&"object"!=typeof n[0]&&null!=n)for(var a=0,f=(n=M(n)?n:On(n)).length;a<f;a++)null!=(e=n[a])&&e<o&&(o=e);else r=b(r,t),E(n,function(n,t,e){((u=r(n,t,e))<i||u===1/0&&o===1/0)&&(o=n,i=u)});return o},shuffle:function(n){return K(n,1/0)},sample:K,sortBy:function(n,r,t){var e=0;return r=b(r,t),z(N(n,function(n,t,u){return{value:n,index:e++,criteria:r(n,t,u)}}).sort(function(n,r){var t=n.criteria,e=r.criteria;if(t!==e){if(t>e||void 0===t)return 1;if(t<e||void 0===e)return-1}return n.index-r.index}),"value")},groupBy:V,indexBy:C,countBy:J,toArray:function(n){return n?Kn(n)?o.call(n):Jn(n)?n.match(U):M(n)?N(n,ur):On(n):[]},size:function(n){return null==n?0:M(n)?n.length:Sn(n).length},partition:$,first:G,head:G,take:G,initial:H,last:function(n,r,t){return null==n||n.length<1?null==r?void 0:[]:null==r||t?n[n.length-1]:Q(n,Math.max(0,n.length-r))},rest:Q,tail:Q,drop:Q,compact:function(n){return R(n,Boolean)},flatten:function(n,r){return X(n,r,!1)},without:Y,uniq:Z,unique:Z,union:nn,intersection:function(n){for(var r=[],t=arguments.length,e=0,u=O(n);e<u;e++){var o=n[e];if(!D(r,o)){var i;for(i=1;i<t&&D(arguments[i],o);i++);i===t&&r.push(o)}}return r},difference:rn,unzip:tn,zip:en,object:function(n,r){for(var t={},e=0,u=O(n);e<u;e++)r?t[n[e]]=r[e]:t[n[e][0]]=n[e][1];return t},findIndex:on,findLastIndex:an,sortedIndex:fn,indexOf:ln,lastIndexOf:pn,range:function(n,r,t){null==r&&(r=n||0,n=0),t||(t=r<n?-1:1);for(var e=Math.max(Math.ceil((r-n)/t),0),u=Array(e),o=0;o<e;o++,n+=t)u[o]=n;return u},chunk:function(n,r){if(null==r||r<1)return[];for(var t=[],e=0,u=n.length;e<u;)t.push(o.call(n,e,e+=r));return t},bind:vn,partial:hn,bindAll:yn,memoize:function(n,r){var t=function(e){var u=t.cache,o=""+(r?r.apply(this,arguments):e);return x(u,o)||(u[o]=n.apply(this,arguments)),u[o]};return t.cache={},t},delay:gn,defer:dn,throttle:function(n,r,t){var e,u,o,i,a=0;t||(t={});var f=function(){a=!1===t.leading?0:fr(),e=null,i=n.apply(u,o),e||(u=o=null)},c=function(){var c=fr();a||!1!==t.leading||(a=c);var l=r-(c-a);return u=this,o=arguments,l<=0||l>r?(e&&(clearTimeout(e),e=null),a=c,i=n.apply(u,o),e||(u=o=null)):e||!1===t.trailing||(e=setTimeout(f,l)),i};return c.cancel=function(){clearTimeout(e),a=0,e=u=o=null},c},debounce:function(n,r,t){var e,u,o=function(r,t){e=null,t&&(u=n.apply(r,t))},i=j(function(i){if(e&&clearTimeout(e),t){var a=!e;e=setTimeout(o,r),a&&(u=n.apply(this,i))}else e=gn(o,r,this,i);return u});return i.cancel=function(){clearTimeout(e),e=null},i},wrap:function(n,r){return hn(r,n)},negate:mn,compose:function(){var n=arguments,r=n.length-1;return function(){for(var t=r,e=n[r].apply(this,arguments);t--;)e=n[t].call(this,e);return e}},after:function(n,r){return function(){if(--n<1)return r.apply(this,arguments)}},before:bn,once:jn,keys:Sn,allKeys:An,values:On,mapObject:function(n,r,t){r=b(r,t);for(var e=Sn(n),u=e.length,o={},i=0;i<u;i++){var a=e[i];o[a]=r(n[a],a,n)}return o},pairs:function(n){for(var r=Sn(n),t=r.length,e=Array(t),u=0;u<t;u++)e[u]=[r[u],n[r[u]]];return e},invert:Mn,functions:En,methods:En,extend:kn,extendOwn:In,assign:In,findKey:Tn,pick:Rn,omit:Fn,defaults:qn,create:function(n,r){var t=_(n);return r&&In(t,r),t},clone:Dn,tap:function(n,r){return r(n),n},isMatch:Wn,isEqual:function(n,r){return zn(n,r)},isEmpty:function(n){return null==n||(M(n)&&(Kn(n)||Jn(n)||Vn(n))?0===n.length:0===Sn(n).length)},isElement:function(n){return!(!n||1!==n.nodeType)},isArray:Kn,isObject:Ln,isArguments:Vn,isFunction:Cn,isString:Jn,isNumber:Un,isDate:$n,isRegExp:Gn,isError:Hn,isSymbol:Qn,isMap:Xn,isWeakMap:Yn,isSet:Zn,isWeakSet:nr,isFinite:function(n){return!Qn(n)&&s(n)&&!p(parseFloat(n))},isNaN:tr,isBoolean:er,isNull:function(n){return null===n},isUndefined:function(n){return void 0===n},has:function(n,r){if(!Kn(r))return x(n,r);for(var t=r.length,e=0;e<t;e++){var u=r[e];if(null==n||!a.call(n,u))return!1;n=n[u]}return!!t},identity:ur,constant:function(n){return function(){return n}},noop:function(){},property:or,propertyOf:function(n){return null==n?function(){}:function(r){return Kn(r)?S(n,r):n[r]}},matcher:ir,matches:ir,times:function(n,r,t){var e=Array(Math.max(0,n));r=g(r,t,1);for(var u=0;u<n;u++)e[u]=r(u);return e},random:ar,now:fr,escape:sr,unescape:vr,result:function(n,r,t){Kn(r)||(r=[r]);var e=r.length;if(!e)return Cn(t)?t.call(n):t;for(var u=0;u<e;u++){var o=null==n?void 0:n[r[u]];void 0===o&&(o=t,u=e),n=Cn(o)?o.call(n):o}return n},uniqueId:function(n){var r=++hr+"";return n?n+r:r},templateSettings:yr,template:function(n,r,t){!r&&t&&(r=t),r=qn({},r,h.templateSettings);var e,u=RegExp([(r.escape||gr).source,(r.interpolate||gr).source,(r.evaluate||gr).source].join("|")+"|$","g"),o=0,i="__p+='";n.replace(u,function(r,t,e,u,a){return i+=n.slice(o,a).replace(mr,br),o=a+r.length,t?i+="'+\n((__t=("+t+"))==null?'':_.escape(__t))+\n'":e?i+="'+\n((__t=("+e+"))==null?'':__t)+\n'":u&&(i+="';\n"+u+"\n__p+='"),r}),i+="';\n",r.variable||(i="with(obj||{}){\n"+i+"}\n"),i="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+i+"return __p;\n";try{e=new Function(r.variable||"obj","_",i)}catch(n){throw n.source=i,n}var a=function(n){return e.call(this,n,h)},f=r.variable||"obj";return a.source="function("+f+"){\n"+i+"}",a},chain:function(n){var r=h(n);return r._chain=!0,r},mixin:_r});return wr._=wr,wr});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}]},{},[4]);

		</script>
	</body>
</html>
